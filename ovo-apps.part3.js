const _0x28e739=_0xc1ca;(function(_0x1c000b,_0x18ba44){const _0x339b89=_0xc1ca,_0x379bb9=_0x1c000b();while(!![]){try{const _0x151eb3=parseInt(_0x339b89(0x897))/0x1+parseInt(_0x339b89(0x2b8))/0x2+-parseInt(_0x339b89(0x6df))/0x3*(parseInt(_0x339b89(0x258))/0x4)+parseInt(_0x339b89(0x267))/0x5+parseInt(_0x339b89(0x495))/0x6+parseInt(_0x339b89(0x596))/0x7*(-parseInt(_0x339b89(0x1b1))/0x8)+-parseInt(_0x339b89(0x2d1))/0x9;if(_0x151eb3===_0x18ba44)break;else _0x379bb9['push'](_0x379bb9['shift']());}catch(_0x3e47bd){_0x379bb9['push'](_0x379bb9['shift']());}}}(_0x2c65,0x60188));try{if(typeof __ovoOnlineGate===_0x28e739(0x48c))__ovoOnlineGate(!![]);else throw new Error(_0x28e739(0x901));}catch(_0x1ea451){throw _0x1ea451;}const DIARY_CSS_TEMPLATE=_0x28e739(0x648);function getDiaryCssTemplate(){return DIARY_CSS_TEMPLATE;}function resolveApiMaxOutputTokens(_0x3a63e5,_0x193bf9=0xfa0){const _0xa55500=_0x28e739,_0x183be4=_0x3a63e5?.[_0xa55500(0x359)],_0x1901ee=Number(_0x183be4);if(Number[_0xa55500(0x795)](_0x1901ee)&&_0x1901ee>0x0)return Math['trunc'](_0x1901ee);return _0x193bf9;}let diaryStyleInjected=![];function ensureDiaryStyleInjected(){const _0x33d54f=_0x28e739;if(diaryStyleInjected)return;const _0x1d4db9=document[_0x33d54f(0x761)](_0x33d54f(0x1e0));if(_0x1d4db9){diaryStyleInjected=!![];return;}const _0x5aba9d=document[_0x33d54f(0x5e5)](_0x33d54f(0x577));_0x5aba9d['id']=_0x33d54f(0x1e0),_0x5aba9d[_0x33d54f(0x7dc)]=getDiaryCssTemplate(),document[_0x33d54f(0x68e)][_0x33d54f(0x3de)](_0x5aba9d),diaryStyleInjected=!![];}const DIARY_COLLAPSE_CHAR_THRESHOLD=0x4b0,DIARY_COLLAPSE_MAX_HEIGHT=0x168,DIARY_LAZY_RANGE=0x2,DIARY_LAZY_INITIAL_RENDER_COUNT=0x3;function normalizeDiaryContentHtml(_0x40c514){const _0x5d5c16=String(_0x40c514||'')['trim']();return _0x5d5c16||'<p>（无内容）</p>';}function shouldCollapseDiaryContent(_0x3a41f0){const _0x4a7029=_0x28e739;if(!_0x3a41f0)return![];const _0x517af4=String(_0x3a41f0||'')[_0x4a7029(0x568)](/<[^>]*>/g,'\x20')[_0x4a7029(0x568)](/\s+/g,'\x20')['trim']();return _0x517af4[_0x4a7029(0x6ea)]>=DIARY_COLLAPSE_CHAR_THRESHOLD;}function bindDiaryEntryToggle(_0x5d87dc){const _0x33a719=_0x28e739;if(!_0x5d87dc)return;const _0x1576b2=_0x5d87dc['querySelector'](_0x33a719(0x5d9)),_0x3eaceb=_0x5d87dc[_0x33a719(0x768)](_0x33a719(0x895));if(!_0x1576b2||!_0x3eaceb)return;if(_0x3eaceb[_0x33a719(0x672)][_0x33a719(0x517)]===_0x33a719(0x2b2))return;_0x3eaceb[_0x33a719(0x672)]['bound']='true',_0x3eaceb[_0x33a719(0x55d)]('click',()=>{const _0xbcdca3=_0x33a719,_0xfa0b34=_0x1576b2['classList'][_0xbcdca3(0x93a)](_0xbcdca3(0x879));_0x3eaceb['textContent']=_0xfa0b34?_0xbcdca3(0x7c5):'收起',_0x3eaceb['setAttribute'](_0xbcdca3(0x5e6),_0xfa0b34?_0xbcdca3(0x17c):'true');});}function applyDiaryEntryCollapse(_0x3ec1b4){const _0x22bd93=_0x28e739;if(!_0x3ec1b4)return;const _0x1fff02=_0x3ec1b4['querySelector']('.diary-entry-content');if(!_0x1fff02)return;const _0x2e4435=_0x1fff02[_0x22bd93(0x7ec)];if(!_0x2e4435)return;const _0x58b102=_0x1fff02[_0x22bd93(0x3d5)]>DIARY_COLLAPSE_MAX_HEIGHT+0x2;let _0x309933=_0x3ec1b4[_0x22bd93(0x768)]('.diary-entry-toggle');if(_0x58b102)_0x1fff02[_0x22bd93(0x421)]['add'](_0x22bd93(0x7b5),_0x22bd93(0x879)),!_0x309933?(_0x309933=document[_0x22bd93(0x5e5)](_0x22bd93(0x52d)),_0x309933[_0x22bd93(0x3a3)]=_0x22bd93(0x52d),_0x309933['className']='diary-entry-toggle',_0x309933[_0x22bd93(0x1d9)]('aria-expanded',_0x22bd93(0x17c)),_0x309933[_0x22bd93(0x7dc)]=_0x22bd93(0x7c5),_0x2e4435[_0x22bd93(0x3de)](_0x309933)):(_0x309933['setAttribute'](_0x22bd93(0x5e6),_0x22bd93(0x17c)),_0x309933[_0x22bd93(0x7dc)]=_0x22bd93(0x7c5)),bindDiaryEntryToggle(_0x3ec1b4);else{_0x1fff02[_0x22bd93(0x421)]['remove'](_0x22bd93(0x7b5),_0x22bd93(0x879));if(_0x309933)_0x309933[_0x22bd93(0x403)]();}}function buildDiaryPlaceholder(_0x4724d1,_0x9ab76e,_0x4f2973=null){const _0x26c0cb=_0x28e739,_0x341dc5=document['createElement'](_0x26c0cb(0x6a4));return _0x341dc5['className']=_0x26c0cb(0x53c),_0x341dc5['id']=_0x26c0cb(0x466)+_0x4724d1,_0x341dc5[_0x26c0cb(0x672)][_0x26c0cb(0x826)]=_0x9ab76e,_0x341dc5[_0x26c0cb(0x672)][_0x26c0cb(0x5f0)]=_0x26c0cb(0x2b2),_0x4f2973&&_0x4f2973[_0x26c0cb(0x421)][_0x26c0cb(0x6e3)](_0x26c0cb(0x81f))&&_0x341dc5['classList'][_0x26c0cb(0x5e3)](_0x26c0cb(0x81f)),_0x341dc5;}function applyDiaryEntryCollapseWindow(_0x48ce37){const _0x281cfb=_0x28e739;if(!diaryRenderData||!diaryRenderData['diaryEntries'])return;const _0x604edb=diaryRenderData[_0x281cfb(0x229)]['length'];if(_0x604edb<=0x0)return;const _0x35dce5=Math[_0x281cfb(0x738)](0x2,Number(_0x48ce37)||0x2),_0x513822=Math[_0x281cfb(0x738)](0x2,_0x35dce5-DIARY_LAZY_RANGE),_0x14c2f3=Math[_0x281cfb(0x730)](_0x604edb+0x1,_0x35dce5+DIARY_LAZY_RANGE);for(let _0x45eb04=_0x513822;_0x45eb04<=_0x14c2f3;_0x45eb04++){const _0x2fadb0=document[_0x281cfb(0x761)](_0x281cfb(0x466)+_0x45eb04);if(!_0x2fadb0||_0x2fadb0[_0x281cfb(0x672)][_0x281cfb(0x5f0)])continue;applyDiaryEntryCollapse(_0x2fadb0);}}function pruneDiaryPages(_0x5590f1){const _0x28f9a4=_0x28e739;if(!diaryLazyLoadEnabled||!diaryRenderData||!diaryRenderData[_0x28f9a4(0x229)])return;const _0x53f1b0=diaryRenderData[_0x28f9a4(0x229)][_0x28f9a4(0x6ea)];if(_0x53f1b0<=0x0)return;const _0x5ee538=Math[_0x28f9a4(0x738)](0x2,Number(_0x5590f1)||0x2),_0x16c249=Math[_0x28f9a4(0x738)](0x2,_0x5ee538-DIARY_LAZY_RANGE),_0x4263e1=Math[_0x28f9a4(0x730)](_0x53f1b0+0x1,_0x5ee538+DIARY_LAZY_RANGE);for(let _0x27fbf7=0x2;_0x27fbf7<=_0x53f1b0+0x1;_0x27fbf7++){if(_0x27fbf7>=_0x16c249&&_0x27fbf7<=_0x4263e1)continue;const _0x577c3f=document[_0x28f9a4(0x761)](_0x28f9a4(0x466)+_0x27fbf7);if(!_0x577c3f||_0x577c3f[_0x28f9a4(0x672)][_0x28f9a4(0x5f0)])continue;const _0x3e581d=buildDiaryPlaceholder(_0x27fbf7,_0x27fbf7-0x2,_0x577c3f);_0x577c3f['replaceWith'](_0x3e581d);}}let currentCharProfileData=null,musicPlayerLyricsInterval=null;async function openCharProfile(){const _0x528062=_0x28e739,_0x3374a0=document[_0x528062(0x761)](_0x528062(0x3c5)),_0x57cb7f=document[_0x528062(0x761)]('charProfileBackdrop');if(!_0x3374a0)return;const _0x5541c8=await getCurrentChatCharacter();if(!_0x5541c8)return;currentCharProfileData=_0x5541c8,renderCharProfileData(_0x5541c8);const _0x1970fc=_0x5541c8['id'],_0x59bf6d=await loadCharacterStatus(_0x1970fc,currentSessionId);updateCharProfileStatusDisplay(_0x59bf6d),_0x3374a0[_0x528062(0x421)][_0x528062(0x403)](_0x528062(0x789));if(_0x57cb7f)_0x57cb7f[_0x528062(0x421)]['add']('active');_0x3374a0['classList'][_0x528062(0x5e3)](_0x528062(0x525)),initMusicPlayerLyrics(),loadAlbumCoversFromDB();}function closeCharProfile(){const _0x29c981=_0x28e739,_0x5aa88c=document['getElementById'](_0x29c981(0x3c5)),_0x52ff75=document[_0x29c981(0x761)]('charProfileBackdrop'),_0x112bd5=document[_0x29c981(0x761)](_0x29c981(0x37d));_0x5aa88c&&(_0x5aa88c['classList'][_0x29c981(0x403)](_0x29c981(0x525)),_0x5aa88c[_0x29c981(0x421)][_0x29c981(0x403)]('show-playlist')),_0x52ff75&&_0x52ff75[_0x29c981(0x421)][_0x29c981(0x403)](_0x29c981(0x525)),_0x112bd5&&_0x112bd5['classList'][_0x29c981(0x403)]('active'),musicPlayerLyricsInterval&&(clearInterval(musicPlayerLyricsInterval),musicPlayerLyricsInterval=null),currentCharProfileData=null;}function togglePlaylistView(){const _0x2c233f=_0x28e739,_0x5b828c=document[_0x2c233f(0x761)](_0x2c233f(0x3c5));_0x5b828c&&_0x5b828c[_0x2c233f(0x421)][_0x2c233f(0x93a)](_0x2c233f(0x789));}let userPlaylistPageReady=![],userPlaylistViewEl=null,userPlaylistStreamEl=null,userPlaylistScrollEl=null,userPlaylistHeaderEl=null,userPlaylistCanvas=null,userPlaylistCtx=null,userPlaylistOverlayLayer=null,userPlaylistOverlayContent=null,userPlaylistOverlayCanvas=null,userPlaylistOverlayCtx=null,userPlaylistOverlayCloseTimer=null,userPlaylistViewMounted=![];const USER_PLAYLIST_VIEW_TEMPLATE=_0x28e739(0x436)[_0x28e739(0x28e)]();function ensureUserPlaylistViewMounted(){const _0x10a254=_0x28e739;if(userPlaylistViewMounted||document['getElementById'](_0x10a254(0x5c0)))return userPlaylistViewMounted=!![],!![];const _0x11d82b=document[_0x10a254(0x761)](_0x10a254(0x4b9));if(!_0x11d82b)return![];return _0x11d82b['innerHTML']=USER_PLAYLIST_VIEW_TEMPLATE,userPlaylistViewMounted=!![],!![];}let playlists=[];const poemLines=[_0x28e739(0x5b0),'Connecting\x20stars\x20in\x20vacant\x20heads',_0x28e739(0x4d2),'Nothing\x20to\x20win\x20and\x20nothing\x20to\x20lose','The\x20river\x20flows\x20upwards\x20to\x20the\x20sky',_0x28e739(0x7fc),_0x28e739(0x37a),_0x28e739(0x1d8),_0x28e739(0x33a),_0x28e739(0x954),'...'],poemContent=Array(0x32)['fill'](poemLines['join']('\x0a\x0a'))['join']('\x0a\x0a'),userPlaylistLyricPool=[_0x28e739(0x1a8),_0x28e739(0x6cb),_0x28e739(0x675),'Rewinding\x20the\x20memories.',_0x28e739(0x8b5),_0x28e739(0x94c),_0x28e739(0x337),_0x28e739(0x78b),_0x28e739(0x1fe),'Floating\x20in\x20pink\x20clouds.'];let userPlaylistLyricIndex=0x0,userPlaylistNodeElements=[],userPlaylistWidth=0x0,userPlaylistHeight=0x0,userPlaylistTime=0x0,userPlaylistOverlayAnimationId,userPlaylistActiveMode=null,userPlaylistCurrentIndex=-0x1,userPlaylistAvatarObserver=null,userPlaylistStorageKey='';const USER_PLAYLIST_STORAGE_KEY='userPlaylistData_global',USER_PLAYLIST_STORAGE_VERSION=0x1,USER_PLAYLIST_DEFAULT_SCOPE='user',USER_PLAYLIST_DEFAULT_SONG_SOURCE='netease',USER_PLAYLIST_SELECTED_KEY_SUFFIX=_0x28e739(0x34e),USER_PLAYLIST_DB_PROFILE_FALLBACK=_0x28e739(0x79f),USER_PLAYLIST_SELECTED_INDEX_KEY_PREFIX=_0x28e739(0x91c);let userPlaylistPlaybackIndex=-0x1,userPlaylistPlaybackSongIndex=0x0,userPlaylistPlaybackAudio=null,userPlaylistPlaybackLyrics=[],userPlaylistPlaybackLyricIndex=0x0,userPlaylistPlaybackSongList=[],userPlaylistPlaybackIsPlaying=![],userPlaylistPlaybackPendingSwitch=![],userPlaylistPlaybackNowPlaying=null,userPlaylistPlaybackForceStop=![],userPlaylistPlayerControlsBound=![],userPlaylistPlaybackRequestToken=0x0,userPlaylistVolume=0.5,userPlaylistVolumeBound=![],musicWidgetReady=![],musicWidgetDragState=null,musicWidgetSuppressClickUntil=0x0,musicWidgetLyricDragState=null,musicWidgetForceHidden=![],musicWidgetLyricStyleActive='',musicWidgetLyricLineIndex=-0x1,musicWidgetLyricLineText='',musicWidgetListMode=_0x28e739(0x646),musicWidgetListPlaylistIndex=-0x1,musicWidgetOrbImage='',musicWidgetOrbSize=0x30,musicWidgetOrbSkinLoaded=![],musicWidgetLyricColor='',musicWidgetLyricColorLoaded=![];const USER_PLAYLIST_AUDIO_CACHE_TTL=0x6*0x3c*0x3c*0x3e8,USER_PLAYLIST_LYRIC_CACHE_TTL=0x1e*0x18*0x3c*0x3c*0x3e8,userPlaylistMediaCache=new Map(),USER_PLAYLIST_AUDIO_BITRATE=0x140,USER_PLAYLIST_VOLUME_KEY=_0x28e739(0x44e),MUSIC_WIDGET_LYRIC_COLOR_KEY=_0x28e739(0x6bb),MUSIC_WIDGET_ORB_IMAGE_KEY=_0x28e739(0x847),MUSIC_WIDGET_ORB_SIZE_KEY=_0x28e739(0x7bb),MUSIC_WIDGET_ORB_POSITION_KEY='musicWidgetOrbPosition',MUSIC_WIDGET_LYRIC_POSITION_KEY=_0x28e739(0x2cd);function getUserPlaylistMediaCache(_0x32e7ff,_0x5e5df4){const _0x21da93=_0x28e739,_0xd21e14=userPlaylistMediaCache[_0x21da93(0x309)](_0x32e7ff);if(!_0xd21e14)return null;if(Number[_0x21da93(0x795)](_0x5e5df4)&&_0x5e5df4>0x0&&Date[_0x21da93(0x2cb)]()-_0xd21e14['ts']>_0x5e5df4)return userPlaylistMediaCache[_0x21da93(0x6c2)](_0x32e7ff),null;return _0xd21e14['data'];}function setUserPlaylistMediaCache(_0x501bf4,_0x3508aa){const _0x1cd9ac=_0x28e739;userPlaylistMediaCache['set'](_0x501bf4,{'ts':Date[_0x1cd9ac(0x2cb)](),'data':_0x3508aa});}function clearUserPlaylistMediaCache(_0xdbfcbe){const _0x144f6c=_0x28e739;userPlaylistMediaCache[_0x144f6c(0x6c2)](_0xdbfcbe);}async function invalidateUserPlaylistAudioCache(_0x4a2006,_0xc55f6f){const _0x1acb0c=_0x28e739,_0x2417b4=String(_0x4a2006||'')[_0x1acb0c(0x28e)](),_0x6438d6=String(_0xc55f6f||'')[_0x1acb0c(0x28e)]();if(!_0x2417b4||!_0x6438d6)return![];const _0x563e08='audio|'+_0x2417b4+'|'+_0x6438d6;clearUserPlaylistMediaCache(_0x563e08);if(!db?.[_0x1acb0c(0x4fd)])return!![];try{const _0xe97ee0=buildUserPlaylistMediaCacheId(_0x2417b4,_0x6438d6);await db[_0x1acb0c(0x4fd)][_0x1acb0c(0x301)](_0xe97ee0,{'audioUrl':'','audioUpdatedAt':null,'updatedAt':Date[_0x1acb0c(0x2cb)]()});}catch(_0x1fe023){}return!![];}async function getUserPlaylistMediaCacheRecord(_0x53e82c,_0x315a6b){const _0x2824b0=_0x28e739;if(!db?.[_0x2824b0(0x4fd)])return null;const _0x48d81c=buildUserPlaylistMediaCacheId(_0x53e82c,_0x315a6b);try{return await db[_0x2824b0(0x4fd)][_0x2824b0(0x309)](_0x48d81c);}catch(_0x3611d1){return console[_0x2824b0(0x56c)](_0x2824b0(0x557),_0x3611d1),null;}}async function saveUserPlaylistMediaCacheRecord(_0x1f276c){const _0x14f630=_0x28e739;if(!db?.[_0x14f630(0x4fd)]||!_0x1f276c)return;try{await db[_0x14f630(0x4fd)][_0x14f630(0x720)](_0x1f276c);}catch(_0x266bc9){console[_0x14f630(0x56c)](_0x14f630(0x535),_0x266bc9);}}async function deleteUserPlaylistMediaCacheRecord(_0x264037,_0x4230f4){const _0x26a96f=_0x28e739;if(!db?.[_0x26a96f(0x4fd)])return;const _0x19f99e=buildUserPlaylistMediaCacheId(_0x264037,_0x4230f4);try{await db[_0x26a96f(0x4fd)][_0x26a96f(0x6c2)](_0x19f99e);}catch(_0x48103a){}}async function deleteUserPlaylistMediaCacheByPlaylist(_0x2ede49){const _0x1f7bd2=_0x28e739;if(!db?.['playlistMediaCache'])return;const _0x43c5fe=String(_0x2ede49||'')['trim']();if(!_0x43c5fe)return;try{await db[_0x1f7bd2(0x4fd)][_0x1f7bd2(0x56a)](_0x1f7bd2(0x807))[_0x1f7bd2(0x82f)](_0x43c5fe)['delete']();}catch(_0x9a8352){}}async function resolveUserPlaylistProfileContext(){const _0x166269=_0x28e739;let _0x46657d=normalizeId(currentChatId||window[_0x166269(0x29e)]||''),_0x16b28f=currentSessionId||_0x166269(0x79f),_0x1f85be='';if(isValidIdValue(_0x46657d)){try{const _0x22339a=await getActiveSessionIdForChat(_0x46657d);if(isValidIdValue(_0x22339a))_0x16b28f=_0x22339a;}catch(_0x57614a){}try{const _0x33c008=await db[_0x166269(0x30f)][_0x166269(0x309)](_0x46657d);_0x1f85be=resolveUserProfileIdFromChatSettings(_0x33c008,_0x16b28f)||'';}catch(_0x101d75){_0x1f85be='';}if(!isValidIdValue(_0x1f85be))try{const _0x143325=await db[_0x166269(0x183)][_0x166269(0x309)](_0x46657d);isValidIdValue(_0x143325?.[_0x166269(0x634)])&&(_0x1f85be=normalizeId(_0x143325[_0x166269(0x634)]));}catch(_0x285caf){}}if(!isValidIdValue(_0x1f85be))try{const _0x1ab735=await db[_0x166269(0x175)][_0x166269(0x309)](_0x166269(0x619));isValidIdValue(_0x1ab735?.[_0x166269(0x29c)])&&(_0x1f85be=normalizeId(_0x1ab735['value']));}catch(_0x36c2d0){}return{'chatId':_0x46657d,'sessionId':_0x16b28f,'profileId':_0x1f85be};}async function resolveUserPlaylistStorageKey(){const _0x15b332=_0x28e739,{profileId:_0x2e9656,chatId:_0x485530}=await resolveUserPlaylistProfileContext(),_0x4698cc=isValidIdValue(_0x2e9656)?normalizeId(_0x2e9656):USER_PLAYLIST_DB_PROFILE_FALLBACK,_0x26c333=normalizeId(_0x485530||'');return _0x15b332(0x7d2)+_0x4698cc+'|'+(_0x26c333||_0x15b332(0x70b));}function generateUserPlaylistId(){const _0x29860d=_0x28e739,_0x148928=Math[_0x29860d(0x266)]()[_0x29860d(0x7f6)](0x24)[_0x29860d(0x73d)](0x2,0x8);return _0x29860d(0x668)+Date[_0x29860d(0x2cb)]()[_0x29860d(0x7f6)](0x24)+'_'+_0x148928;}function buildUserPlaylistPlaybackIndexKey(_0x3c2908,_0x68f49){const _0x13f740=_0x28e739,_0x58c336=isValidIdValue(_0x3c2908)?normalizeId(_0x3c2908):USER_PLAYLIST_DB_PROFILE_FALLBACK,_0x192c16=normalizeId(_0x68f49||'');return USER_PLAYLIST_SELECTED_INDEX_KEY_PREFIX+'|'+_0x58c336+'|'+(_0x192c16||_0x13f740(0x70b));}function buildUserPlaylistSongKey(_0xacb0b0){const _0x50326a=_0x28e739;if(!_0xacb0b0)return'';const _0x7e4225=String(_0xacb0b0['source']||USER_PLAYLIST_DEFAULT_SONG_SOURCE)[_0x50326a(0x28e)](),_0x175af7=String(_0xacb0b0['id']||'')['trim']();if(_0x175af7)return _0x7e4225+'|'+_0x175af7;const _0x334e01=String(_0xacb0b0[_0x50326a(0x76a)]||_0xacb0b0[_0x50326a(0x81a)]||_0xacb0b0[_0x50326a(0x880)]||'')[_0x50326a(0x28e)](),_0x10330f=Array['isArray'](_0xacb0b0[_0x50326a(0x52a)])?_0xacb0b0[_0x50326a(0x52a)]['join']('/'):String(_0xacb0b0[_0x50326a(0x52a)]||'')[_0x50326a(0x28e)](),_0x4fadfe=String(_0xacb0b0['album']||'')[_0x50326a(0x28e)](),_0x4bace9=[_0x334e01,_0x10330f,_0x4fadfe][_0x50326a(0x911)](Boolean)[_0x50326a(0x943)]('|');return _0x4bace9?_0x7e4225+'|'+_0x4bace9:'';}function buildUserPlaylistMediaCacheId(_0x12b397,_0x40c82f){const _0x14ce4a=_0x28e739,_0x8b7d2b=String(_0x12b397||'')[_0x14ce4a(0x28e)]()||_0x14ce4a(0x6a0),_0x4f0a4f=String(_0x40c82f||'')[_0x14ce4a(0x28e)]()||_0x14ce4a(0x6a0);return _0x8b7d2b+'||'+_0x4f0a4f;}function getUserPlaylistAlign(_0x1b248c){const _0x24bd01=_0x28e739,_0x457617=_0x1b248c%0x3;if(_0x457617===0x0)return _0x24bd01(0x460);if(_0x457617===0x1)return'right';return _0x24bd01(0x717);}function getNextUserPlaylistLyric(){const _0x4871ef=_0x28e739,_0x146043=userPlaylistLyricPool[userPlaylistLyricIndex%userPlaylistLyricPool[_0x4871ef(0x6ea)]];return userPlaylistLyricIndex+=0x1,_0x146043;}function normalizeUserPlaylistSong(_0x33e7be){const _0x1cf641=_0x28e739;if(typeof _0x33e7be===_0x1cf641(0x7a1)){const _0x32cd55=_0x33e7be[_0x1cf641(0x28e)]();return _0x32cd55?_0x32cd55:null;}if(_0x33e7be&&typeof _0x33e7be==='object'){const _0x245fe2=String(_0x33e7be[_0x1cf641(0x76a)]||_0x33e7be['title']||_0x33e7be[_0x1cf641(0x880)]||'')['trim'](),_0x2cee6f=String(_0x33e7be['id']||_0x33e7be[_0x1cf641(0x351)]||'')[_0x1cf641(0x28e)](),_0x4d5162=Array[_0x1cf641(0x851)](_0x33e7be[_0x1cf641(0x52a)])?_0x33e7be[_0x1cf641(0x52a)][_0x1cf641(0x962)](_0x36eb4c=>String(_0x36eb4c))['filter'](Boolean):_0x33e7be[_0x1cf641(0x52a)]?[String(_0x33e7be[_0x1cf641(0x52a)])]:[],_0x3a2f5c=_0x33e7be[_0x1cf641(0x5a6)]?String(_0x33e7be[_0x1cf641(0x5a6)]):'',_0xd5be2c=_0x33e7be[_0x1cf641(0x44c)]?String(_0x33e7be[_0x1cf641(0x44c)]):USER_PLAYLIST_DEFAULT_SONG_SOURCE;if(!_0x245fe2&&!_0x2cee6f)return null;return{'name':_0x245fe2,'id':_0x2cee6f,'artist':_0x4d5162,'album':_0x3a2f5c,'source':_0xd5be2c};}return null;}function normalizeUserPlaylistEntry(_0x4070b5,_0x3e25b7){const _0x119e93=_0x28e739,_0x3b6e33=String(_0x4070b5?.['title']||'')[_0x119e93(0x28e)]();if(!_0x3b6e33)return null;const _0x347d56=String(_0x4070b5?.[_0x119e93(0x19e)]||'')[_0x119e93(0x28e)]()||getNextUserPlaylistLyric(),_0xb8f6ea=_0x4070b5?.[_0x119e93(0x712)]===_0x119e93(0x460)||_0x4070b5?.[_0x119e93(0x712)]===_0x119e93(0x29a)||_0x4070b5?.['align']==='center'?_0x4070b5[_0x119e93(0x712)]:getUserPlaylistAlign(_0x3e25b7),_0x292f09=Array[_0x119e93(0x851)](_0x4070b5?.[_0x119e93(0x646)])?_0x4070b5[_0x119e93(0x646)][_0x119e93(0x962)](_0xcc1635=>normalizeUserPlaylistSong(_0xcc1635))[_0x119e93(0x911)](Boolean):[],_0x5ec30b=_0x4070b5?.[_0x119e93(0x92e)]===_0x119e93(0x887)||_0x4070b5?.[_0x119e93(0x92e)]===_0x119e93(0x8dd)?_0x4070b5['origin']:USER_PLAYLIST_DEFAULT_SCOPE,_0x1e1e98=normalizeId(_0x4070b5?.[_0x119e93(0x955)]||_0x4070b5?.[_0x119e93(0x4d0)]||_0x4070b5?.[_0x119e93(0x555)]||''),_0x541e70={'id':String(_0x4070b5?.['id']||'')[_0x119e93(0x28e)]()||generateUserPlaylistId(),'title':_0x3b6e33,'lyric':_0x347d56,'align':_0xb8f6ea,'songs':_0x292f09,'origin':_0x5ec30b,'order':Number[_0x119e93(0x795)](_0x4070b5?.[_0x119e93(0x8a4)])?_0x4070b5[_0x119e93(0x8a4)]:_0x3e25b7,'createdAt':_0x4070b5?.[_0x119e93(0x42b)]||_0x4070b5?.[_0x119e93(0x368)]||Date['now']()};if(_0x1e1e98)_0x541e70[_0x119e93(0x955)]=_0x1e1e98;return _0x541e70;}function createUserPlaylistEntry(_0x13a00d){const _0x55cedd=_0x28e739,_0x1946ef=getNextUserPlaylistLyric();return{'id':generateUserPlaylistId(),'title':_0x13a00d,'lyric':_0x1946ef,'align':getUserPlaylistAlign(playlists[_0x55cedd(0x6ea)]),'songs':[],'origin':USER_PLAYLIST_DEFAULT_SCOPE,'createdAt':Date[_0x55cedd(0x2cb)]()};}function createCharacterPlaylistEntry(_0x185ec0,_0x1adc3e=''){const _0x517a43=_0x28e739,_0x70b3bf=String(_0x1adc3e||'')['trim'](),_0x31746c=_0x70b3bf||getNextUserPlaylistLyric(),_0x520dcd=normalizeId(currentChatId||window['currentChatId']||''),_0x10653e={'id':generateUserPlaylistId(),'title':_0x185ec0,'lyric':_0x31746c,'align':getUserPlaylistAlign(playlists['length']),'songs':[],'origin':_0x517a43(0x887),'createdAt':Date[_0x517a43(0x2cb)]()};if(_0x520dcd)_0x10653e[_0x517a43(0x955)]=_0x520dcd;return _0x10653e;}function initUserPlaylistPage(){const _0x4c996b=_0x28e739;if(userPlaylistPageReady)return;if(!ensureUserPlaylistViewMounted())return;userPlaylistViewEl=document[_0x4c996b(0x761)](_0x4c996b(0x5c0));if(!userPlaylistViewEl)return;const _0xff12bc=document[_0x4c996b(0x761)]('bgText');if(_0xff12bc)_0xff12bc[_0x4c996b(0x3cd)]=poemContent;userPlaylistStreamEl=document[_0x4c996b(0x761)](_0x4c996b(0x850)),userPlaylistScrollEl=document['getElementById'](_0x4c996b(0x909)),userPlaylistHeaderEl=document['getElementById'](_0x4c996b(0x662)),userPlaylistCanvas=document[_0x4c996b(0x761)](_0x4c996b(0x2eb)),userPlaylistCtx=userPlaylistCanvas?userPlaylistCanvas[_0x4c996b(0x891)]('2d'):null,userPlaylistOverlayLayer=document[_0x4c996b(0x761)](_0x4c996b(0x7b4)),userPlaylistOverlayContent=document[_0x4c996b(0x761)](_0x4c996b(0x25e)),userPlaylistOverlayCanvas=document['getElementById']('overlay-canvas'),userPlaylistOverlayCtx=userPlaylistOverlayCanvas?userPlaylistOverlayCanvas[_0x4c996b(0x891)]('2d'):null,syncUserPlaylistAvatar(),observeUserPlaylistAvatar(),observeUserPlaylistViewLifecycle(),bindUserPlaylistPlayerControls(),loadUserPlaylistVolume(),bindUserPlaylistVolumeControl(),void loadUserPlaylistData(),userPlaylistResize(),drawUserPlaylistLines(),window['addEventListener']('resize',userPlaylistResize),userPlaylistPageReady=!![];}const pendingChatDetailRefreshSet=new Set();let lastChatIdBeforePlaylistView=null,userPlaylistViewObserver=null;function togetherInviteDebugEnabled(){const _0xf08ebb=_0x28e739;return!!window[_0xf08ebb(0x484)];}function togetherInviteDebugLog(..._0x40b315){const _0x1ea3f9=_0x28e739;if(!togetherInviteDebugEnabled())return;try{console[_0x1ea3f9(0x41f)](_0x1ea3f9(0x2bb),..._0x40b315);}catch(_0x51995a){}}function requestChatDetailRefresh(_0x1f0fd7){const _0x26ec12=_0x28e739,_0x10e158=normalizeId(_0x1f0fd7);if(!isValidIdValue(_0x10e158))return;pendingChatDetailRefreshSet['add'](_0x10e158),togetherInviteDebugLog(_0x26ec12(0x510),{'chatId':_0x10e158,'pending':Array[_0x26ec12(0x822)](pendingChatDetailRefreshSet)});}function resolveChatIdForChatRefresh(_0x480f4e=''){const _0x58e54d=normalizeId(_0x480f4e);if(isValidIdValue(_0x58e54d))return _0x58e54d;const _0x5c5ca9=normalizeId(currentChatId||window['currentChatId']||'');if(isValidIdValue(_0x5c5ca9))return _0x5c5ca9;const _0x17b3df=normalizeId(lastChatIdBeforePlaylistView||'');if(isValidIdValue(_0x17b3df))return _0x17b3df;return'';}async function flushChatDetailRefreshIfNeeded(_0x4c4ced='',_0x1ba57f=''){const _0x5a3aaf=_0x28e739,_0x40fcc1=resolveChatIdForChatRefresh(_0x1ba57f);togetherInviteDebugLog(_0x5a3aaf(0x217),{'reason':_0x4c4ced,'preferredChatId':_0x1ba57f,'resolvedChatId':_0x40fcc1,'currentChatId':currentChatId,'windowChatId':window[_0x5a3aaf(0x29e)],'lastChatIdBeforePlaylistView':lastChatIdBeforePlaylistView,'pending':Array[_0x5a3aaf(0x822)](pendingChatDetailRefreshSet)});if(!isValidIdValue(_0x40fcc1))return![];if(!pendingChatDetailRefreshSet[_0x5a3aaf(0x345)](_0x40fcc1))return![];pendingChatDetailRefreshSet[_0x5a3aaf(0x6c2)](_0x40fcc1);try{if(!isValidIdValue(currentChatId)||!isSameId(normalizeId(currentChatId),_0x40fcc1)){const _0x353b32=document[_0x5a3aaf(0x761)](_0x5a3aaf(0x1c9));_0x353b32&&_0x353b32[_0x5a3aaf(0x421)][_0x5a3aaf(0x6e3)]('active')&&(currentChatId=_0x40fcc1,window[_0x5a3aaf(0x29e)]=_0x40fcc1);}if(typeof reloadCurrentChatMessages===_0x5a3aaf(0x48c))await reloadCurrentChatMessages();else{if(typeof renderChatMessages===_0x5a3aaf(0x48c)){const _0x16f7fe=await db[_0x5a3aaf(0x183)][_0x5a3aaf(0x309)](_0x40fcc1);if(_0x16f7fe)await renderChatMessages(_0x16f7fe,_0x5a3aaf(0x564));}}return togetherInviteDebugLog(_0x5a3aaf(0x706),{'chatId':_0x40fcc1}),!![];}catch(_0x521e7b){return console[_0x5a3aaf(0x516)](_0x5a3aaf(0x172),_0x4c4ced||_0x5a3aaf(0x6a0),_0x521e7b),togetherInviteDebugLog('flushChatDetailRefreshIfNeeded:error',{'chatId':_0x40fcc1,'error':_0x521e7b}),![];}}async function openUserPlaylistView(){const _0x56e477=_0x28e739,_0x51e7f1=normalizeId(currentChatId||window['currentChatId']||'');isValidIdValue(_0x51e7f1)&&(lastChatIdBeforePlaylistView=_0x51e7f1);ensureUserPlaylistViewMounted(),initUserPlaylistPage(),await loadUserPlaylistData();const _0x131bae=userPlaylistViewEl||document[_0x56e477(0x761)]('userPlaylistView');if(!_0x131bae)return;if(typeof closeCharProfile===_0x56e477(0x48c))closeCharProfile();syncUserPlaylistAvatar(),_0x131bae[_0x56e477(0x421)][_0x56e477(0x5e3)](_0x56e477(0x525)),_0x131bae[_0x56e477(0x1d9)](_0x56e477(0x931),_0x56e477(0x17c)),_0x131bae['removeAttribute'](_0x56e477(0x354)),userPlaylistResize();}function closeUserPlaylistView(){const _0x5cc61b=_0x28e739,_0x56c942=userPlaylistViewEl||document['getElementById'](_0x5cc61b(0x5c0));if(!_0x56c942)return;if(_0x56c942[_0x5cc61b(0x6e3)](document[_0x5cc61b(0x275)]))try{document[_0x5cc61b(0x275)][_0x5cc61b(0x620)]();}catch(_0x373adb){}_0x56c942[_0x5cc61b(0x421)]['remove'](_0x5cc61b(0x525)),_0x56c942[_0x5cc61b(0x1d9)](_0x5cc61b(0x931),_0x5cc61b(0x2b2)),_0x56c942[_0x5cc61b(0x1d9)]('inert',''),closeUserPlaylistOverlay(),void flushChatDetailRefreshIfNeeded(_0x5cc61b(0x746),lastChatIdBeforePlaylistView||'');}function getUserPlaylistAvatarPlaceholder(){const _0x4ae409=_0x28e739;return _0x4ae409(0x3a7);}async function loadUserPlaylistAvatarFromActiveProfile(){const _0x51dd1c=_0x28e739,_0x3f9331=document[_0x51dd1c(0x761)](_0x51dd1c(0x753));if(!_0x3f9331)return;let _0xa79caa='',_0x523322='我';const {profileId:_0x4ec247}=await resolveUserPlaylistProfileContext();if(isValidIdValue(_0x4ec247))try{const _0x439d91=await db[_0x51dd1c(0x70f)][_0x51dd1c(0x309)](_0x4ec247);_0xa79caa=_0x439d91?.[_0x51dd1c(0x708)]||'',_0x523322=_0x439d91?.[_0x51dd1c(0x76a)]||_0x439d91?.[_0x51dd1c(0x2ae)]||'我';}catch(_0x31869e){}_0x3f9331['innerHTML']=_0xa79caa?_0x51dd1c(0x6da)+_0xa79caa+_0x51dd1c(0x3d9)+_0x523322+'\x22>':getUserPlaylistAvatarPlaceholder();}function syncUserPlaylistAvatar(){void loadUserPlaylistAvatarFromActiveProfile();}function observeUserPlaylistAvatar(){const _0x47e7cf=_0x28e739;if(userPlaylistAvatarObserver)return;const _0x482007=document['getElementById'](_0x47e7cf(0x6e9));if(!_0x482007||typeof MutationObserver==='undefined')return;userPlaylistAvatarObserver=new MutationObserver(()=>{syncUserPlaylistAvatar();}),userPlaylistAvatarObserver[_0x47e7cf(0x289)](_0x482007,{'childList':!![],'subtree':!![],'attributes':!![]});}function observeUserPlaylistViewLifecycle(){const _0x4b8793=_0x28e739;if(userPlaylistViewObserver||typeof MutationObserver==='undefined')return;const _0x55dc2d=userPlaylistViewEl||document['getElementById'](_0x4b8793(0x5c0));if(!_0x55dc2d)return;userPlaylistViewObserver=new MutationObserver(()=>{const _0x20a046=_0x4b8793,_0x1066f0=_0x55dc2d[_0x20a046(0x421)]['contains'](_0x20a046(0x525));togetherInviteDebugLog(_0x20a046(0x1cc),{'isActive':_0x1066f0,'className':_0x55dc2d[_0x20a046(0x51f)],'ariaHidden':_0x55dc2d['getAttribute']('aria-hidden')});if(_0x1066f0){const _0x4f4562=normalizeId(currentChatId||window[_0x20a046(0x29e)]||'');isValidIdValue(_0x4f4562)&&(lastChatIdBeforePlaylistView=_0x4f4562,togetherInviteDebugLog('captureChatId',{'capturedChatId':_0x4f4562}));return;}pendingChatDetailRefreshSet['size']>0x0&&void flushChatDetailRefreshIfNeeded(_0x20a046(0x392),lastChatIdBeforePlaylistView||'');}),userPlaylistViewObserver[_0x4b8793(0x289)](_0x55dc2d,{'attributes':!![],'attributeFilter':[_0x4b8793(0x91d),_0x4b8793(0x931)]});}function buildUserPlaylistPayload(){const _0x40653b=_0x28e739,_0x2d6bc4=Array[_0x40653b(0x851)](playlists)?playlists[_0x40653b(0x962)](_0xd7d6c9=>({..._0xd7d6c9,'origin':_0xd7d6c9?.[_0x40653b(0x92e)]==='character'||_0xd7d6c9?.['origin']===_0x40653b(0x8dd)?_0xd7d6c9[_0x40653b(0x92e)]:USER_PLAYLIST_DEFAULT_SCOPE})):[];return{'version':USER_PLAYLIST_STORAGE_VERSION,'scope':USER_PLAYLIST_DEFAULT_SCOPE,'updatedAt':Date[_0x40653b(0x2cb)](),'items':_0x2d6bc4};}async function fetchUserPlaylistItemsFromDb(){const _0x13a95f=_0x28e739;if(!db?.[_0x13a95f(0x89c)])return[];const {profileId:_0x2900a7,chatId:_0x4098e9}=await resolveUserPlaylistProfileContext(),_0x194ed8=isValidIdValue(_0x2900a7)?normalizeId(_0x2900a7):USER_PLAYLIST_DB_PROFILE_FALLBACK,_0x144fd1=normalizeId(_0x4098e9||'');let _0x36b2ca=[];try{_0x36b2ca=await db[_0x13a95f(0x89c)][_0x13a95f(0x56a)]('profileId')['equals'](_0x194ed8)[_0x13a95f(0x5fd)]();}catch(_0x3e453d){return console[_0x13a95f(0x56c)](_0x13a95f(0x2fa),_0x3e453d),[];}const _0x10633f=_0x36b2ca[_0x13a95f(0x911)](_0xcdef9d=>{const _0x1cf390=_0x13a95f,_0x23b728=_0xcdef9d?.[_0x1cf390(0x1f3)]==='character'?_0x1cf390(0x887):_0x1cf390(0x8dd);if(_0x23b728===_0x1cf390(0x8dd))return!![];if(!_0x144fd1)return![];return normalizeId(_0xcdef9d?.['ownerChatId']||'')===_0x144fd1;});_0x10633f[_0x13a95f(0x8da)]((_0x12c840,_0x2bbefb)=>{const _0x6c3326=_0x13a95f,_0x42f62c=Number['isFinite'](_0x12c840?.[_0x6c3326(0x8a4)])?_0x12c840[_0x6c3326(0x8a4)]:Number['POSITIVE_INFINITY'],_0x687357=Number['isFinite'](_0x2bbefb?.[_0x6c3326(0x8a4)])?_0x2bbefb[_0x6c3326(0x8a4)]:Number[_0x6c3326(0x767)];if(_0x42f62c!==_0x687357)return _0x42f62c-_0x687357;const _0x303518=new Date(_0x12c840?.[_0x6c3326(0x42b)]||_0x12c840?.['updatedAt']||0x0)[_0x6c3326(0x278)](),_0x3f0f28=new Date(_0x2bbefb?.[_0x6c3326(0x42b)]||_0x2bbefb?.['updatedAt']||0x0)[_0x6c3326(0x278)]();return _0x303518-_0x3f0f28;});const _0x47bb6a=[];return _0x10633f[_0x13a95f(0x7b6)]((_0x46e766,_0x5d44cf)=>{const _0x569ce2=_0x13a95f,_0x252bce=normalizeUserPlaylistEntry(_0x46e766,_0x5d44cf);if(_0x252bce)_0x47bb6a[_0x569ce2(0x2c4)](_0x252bce);}),_0x47bb6a;}async function getUserPlaylistItemsForPrompt(){const _0x346db3=_0x28e739;if(Array[_0x346db3(0x851)](playlists)&&playlists[_0x346db3(0x6ea)]>0x0)return playlists[_0x346db3(0x962)](_0x46f4b0=>({..._0x46f4b0}));return await fetchUserPlaylistItemsFromDb();}async function getUserPlaylistNamesForPrompt(){const _0x5c622a=_0x28e739,_0x73a495=await getUserPlaylistItemsForPrompt(),_0x4e8060=[];_0x73a495[_0x5c622a(0x7b6)](_0x283839=>{const _0x2dc21c=_0x5c622a,_0x995892=String(_0x283839?.[_0x2dc21c(0x81a)]||'')[_0x2dc21c(0x28e)](),_0x5d8778=_0x283839?.[_0x2dc21c(0x92e)]===_0x2dc21c(0x887)||_0x283839?.[_0x2dc21c(0x92e)]===_0x2dc21c(0x8dd)?_0x283839[_0x2dc21c(0x92e)]:USER_PLAYLIST_DEFAULT_SCOPE;if(_0x995892&&_0x5d8778===_0x2dc21c(0x8dd))_0x4e8060[_0x2dc21c(0x2c4)](_0x995892);});const _0x360a7c=Array[_0x5c622a(0x822)](new Set(_0x4e8060));return _0x360a7c['slice'](0x0,0x3c);}async function getCharacterPlaylistSummariesForPrompt(){const _0x569d4f=_0x28e739,_0x156822=await getUserPlaylistItemsForPrompt(),_0xcbb756=[],_0x2f065f=getActiveChatIdForPlaylists();return _0x156822['forEach'](_0x402c28=>{const _0x45bcea=_0xc1ca,_0x48dd08=String(_0x402c28?.[_0x45bcea(0x81a)]||'')['trim'](),_0x49bbd0=String(_0x402c28?.[_0x45bcea(0x19e)]||'')[_0x45bcea(0x28e)](),_0x1d8767=_0x402c28?.[_0x45bcea(0x92e)]===_0x45bcea(0x887)||_0x402c28?.[_0x45bcea(0x92e)]==='user'?_0x402c28['origin']:USER_PLAYLIST_DEFAULT_SCOPE;if(_0x48dd08&&_0x1d8767===_0x45bcea(0x887)){const _0x27f3c0=getPlaylistOwnerChatId(_0x402c28);if(_0x2f065f&&_0x27f3c0!==_0x2f065f)return;_0xcbb756['push']({'title':_0x48dd08,'note':_0x49bbd0});}}),_0xcbb756[_0x569d4f(0x73d)](0x0,0x3c);}function getLegacyUserPlaylistKeys(){const _0x1dd7fb=_0x28e739,_0x48f472=[];try{for(let _0x2e9db8=0x0;_0x2e9db8<localStorage[_0x1dd7fb(0x6ea)];_0x2e9db8+=0x1){const _0x14175b=localStorage[_0x1dd7fb(0x5f8)](_0x2e9db8);if(!_0x14175b)continue;if(_0x14175b===USER_PLAYLIST_STORAGE_KEY)continue;if(_0x14175b[_0x1dd7fb(0x414)](_0x1dd7fb(0x5b9)))_0x48f472[_0x1dd7fb(0x2c4)](_0x14175b);}}catch(_0x2a2a64){}return _0x48f472;}function collectLegacyUserPlaylistItems(){const _0x6c037b=_0x28e739,_0x293fda=getLegacyUserPlaylistKeys();if(_0x293fda['length']===0x0)return[];const _0x50f49d=[];return _0x293fda[_0x6c037b(0x7b6)](_0x27e057=>{const _0x55840c=_0x6c037b;try{const _0x56e8f5=localStorage[_0x55840c(0x488)](_0x27e057);if(!_0x56e8f5)return;const _0x3953ea=JSON['parse'](_0x56e8f5);if(Array['isArray'](_0x3953ea))_0x3953ea[_0x55840c(0x7b6)](_0x49837c=>_0x50f49d[_0x55840c(0x2c4)](_0x49837c));else _0x3953ea&&typeof _0x3953ea===_0x55840c(0x1f7)&&Array[_0x55840c(0x851)](_0x3953ea[_0x55840c(0x46f)])&&_0x3953ea[_0x55840c(0x46f)]['forEach'](_0x8c69d3=>_0x50f49d['push'](_0x8c69d3));}catch(_0x1fb554){}}),_0x50f49d;}async function loadUserPlaylistData(_0x21c768=![]){const _0x5b3afe=_0x28e739;let _0x309185='';try{_0x309185=await resolveUserPlaylistStorageKey();}catch(_0x3fcf1c){_0x309185='';}if(!_0x309185){playlists=[],initUserPlaylistNodes();return;}if(!_0x21c768&&_0x309185===userPlaylistStorageKey&&Array['isArray'](playlists))return;userPlaylistStorageKey=_0x309185,userPlaylistLyricIndex=0x0;const _0xea7566=await fetchUserPlaylistItemsFromDb();playlists=Array[_0x5b3afe(0x851)](_0xea7566)?_0xea7566:[];const _0x229aff=getActiveChatIdForPlaylists();let _0x476df8=![];_0x229aff&&playlists[_0x5b3afe(0x7b6)](_0x3fe73c=>{const _0xb43bdf=_0x5b3afe;_0x3fe73c?.[_0xb43bdf(0x92e)]==='character'&&!_0x3fe73c[_0xb43bdf(0x955)]&&(_0x3fe73c['ownerChatId']=_0x229aff,_0x476df8=!![]);});await loadUserPlaylistPlaybackIndex(),initUserPlaylistNodes();if(_0x476df8)saveUserPlaylistData();}function saveUserPlaylistData(){void persistUserPlaylistDataToDb();}async function persistUserPlaylistDataToDb(){const _0x152f40=_0x28e739;if(!db?.[_0x152f40(0x89c)])return;const {profileId:_0x3c4346,chatId:_0x665472}=await resolveUserPlaylistProfileContext(),_0xae9df5=isValidIdValue(_0x3c4346)?normalizeId(_0x3c4346):USER_PLAYLIST_DB_PROFILE_FALLBACK,_0x365e17=normalizeId(_0x665472||''),_0x247d91=Date[_0x152f40(0x2cb)](),_0x1fea9f=[];Array['isArray'](playlists)&&playlists[_0x152f40(0x7b6)]((_0x5b7d5d,_0xd33f36)=>{const _0x1d0c91=_0x152f40;if(!_0x5b7d5d)return;const _0x567524=_0x5b7d5d?.['origin']===_0x1d0c91(0x887)||_0x5b7d5d?.[_0x1d0c91(0x92e)]===_0x1d0c91(0x8dd)?_0x5b7d5d[_0x1d0c91(0x92e)]:USER_PLAYLIST_DEFAULT_SCOPE,_0x39011d=String(_0x5b7d5d['id']||'')[_0x1d0c91(0x28e)]()||generateUserPlaylistId();_0x5b7d5d['id']=_0x39011d;const _0x43de2a=_0x567524===_0x1d0c91(0x887)?normalizeId(_0x5b7d5d['ownerChatId']||_0x365e17||''):'';_0x1fea9f[_0x1d0c91(0x2c4)]({'id':_0x39011d,'profileId':_0xae9df5,'owner':_0x567524,'ownerChatId':_0x43de2a||null,'title':String(_0x5b7d5d[_0x1d0c91(0x81a)]||'')[_0x1d0c91(0x28e)](),'lyric':String(_0x5b7d5d[_0x1d0c91(0x19e)]||'')[_0x1d0c91(0x28e)](),'align':_0x5b7d5d[_0x1d0c91(0x712)]||getUserPlaylistAlign(_0xd33f36),'songs':Array[_0x1d0c91(0x851)](_0x5b7d5d[_0x1d0c91(0x646)])?_0x5b7d5d[_0x1d0c91(0x646)]:[],'order':_0xd33f36,'createdAt':_0x5b7d5d['createdAt']||_0x247d91,'updatedAt':_0x247d91});});try{_0x1fea9f[_0x152f40(0x6ea)]>0x0&&await db[_0x152f40(0x89c)][_0x152f40(0x61a)](_0x1fea9f);}catch(_0x3a629e){console[_0x152f40(0x56c)](_0x152f40(0x7a7),_0x3a629e);return;}try{const _0x376818=await db[_0x152f40(0x89c)][_0x152f40(0x56a)]('profileId')['equals'](_0xae9df5)[_0x152f40(0x5fd)](),_0x4a8c46=new Set(_0x1fea9f['map'](_0x5e96c8=>_0x5e96c8['id'])),_0x5ea088=_0x376818['filter'](_0x16855f=>{const _0x32205a=_0x152f40,_0x23462e=_0x16855f?.[_0x32205a(0x1f3)]===_0x32205a(0x887)?_0x32205a(0x887):_0x32205a(0x8dd);if(_0x23462e===_0x32205a(0x8dd))return!_0x4a8c46[_0x32205a(0x345)](_0x16855f['id']);if(!_0x365e17)return![];if(normalizeId(_0x16855f?.[_0x32205a(0x955)]||'')!==_0x365e17)return![];return!_0x4a8c46[_0x32205a(0x345)](_0x16855f['id']);});_0x5ea088[_0x152f40(0x6ea)]>0x0&&await db[_0x152f40(0x89c)][_0x152f40(0x80c)](_0x5ea088['map'](_0x42084e=>_0x42084e['id']));}catch(_0x25ab37){console[_0x152f40(0x56c)](_0x152f40(0x5e7),_0x25ab37);}}async function loadUserPlaylistPlaybackIndex(){const _0x160194=_0x28e739,{profileId:_0x3f6942,chatId:_0x5bd264}=await resolveUserPlaylistProfileContext(),_0x55a273=buildUserPlaylistPlaybackIndexKey(_0x3f6942,_0x5bd264);if(!_0x55a273){userPlaylistPlaybackIndex=-0x1;return;}try{const _0x5cf4ae=await db[_0x160194(0x175)][_0x160194(0x309)](_0x55a273),_0x12ca0d=Number[_0x160194(0x390)](_0x5cf4ae?.[_0x160194(0x29c)],0xa);if(Number[_0x160194(0x795)](_0x12ca0d)&&_0x12ca0d>=0x0&&_0x12ca0d<playlists[_0x160194(0x6ea)]){userPlaylistPlaybackIndex=_0x12ca0d;return;}}catch(_0x252b24){}userPlaylistPlaybackIndex=-0x1;}function persistUserPlaylistPlaybackIndex(){(async()=>{const _0x1f60a8=_0xc1ca,{profileId:_0x1e9e7b,chatId:_0xa225a5}=await resolveUserPlaylistProfileContext(),_0x40f944=buildUserPlaylistPlaybackIndexKey(_0x1e9e7b,_0xa225a5);if(!_0x40f944)return;userPlaylistPlaybackIndex>=0x0?await db[_0x1f60a8(0x175)][_0x1f60a8(0x720)]({'id':_0x40f944,'value':String(userPlaylistPlaybackIndex)}):await db['globalSettings'][_0x1f60a8(0x6c2)](_0x40f944);})()['catch'](()=>{});}function renderUserPlaylistEmptyHint(){const _0xca788=_0x28e739;if(!userPlaylistStreamEl)return;userPlaylistStreamEl['classList']['add'](_0xca788(0x259)),userPlaylistStreamEl[_0xca788(0x5b8)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22playlist-empty-hint\x22\x20id=\x22playlistEmptyHint\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22empty-title\x22>Silence,\x20before\x20the\x20first\x20note.</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22empty-sub\x22>Tap\x20the\x20circle\x20above\x20to\x20name\x20your\x20first\x20playlist.</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20',userPlaylistNodeElements=[],userPlaylistStreamEl[_0xca788(0x577)][_0xca788(0x5ea)]=_0xca788(0x205);}function initUserPlaylistNodes(){const _0x371e20=_0x28e739;if(!userPlaylistStreamEl)return;userPlaylistStreamEl[_0x371e20(0x5b8)]='',userPlaylistNodeElements=[];if(!Array['isArray'](playlists)||playlists['length']===0x0){renderUserPlaylistEmptyHint();return;}userPlaylistStreamEl[_0x371e20(0x421)][_0x371e20(0x403)](_0x371e20(0x259));let _0x518047=0x0;const _0x524f31=0x8c;playlists[_0x371e20(0x7b6)]((_0x190196,_0x412bee)=>{const _0x32f262=_0x371e20,_0x5aabfa=document['createElement'](_0x32f262(0x6a4));_0x5aabfa['className']='node-item';let _0x2864cb;if(_0x190196['align']===_0x32f262(0x460))_0x2864cb=_0x32f262(0x4cb);else{if(_0x190196[_0x32f262(0x712)]===_0x32f262(0x29a))_0x2864cb=_0x32f262(0x8e6);else _0x2864cb='35%';}const _0x24f306=Math[_0x32f262(0x266)]()*0xa-0x5;_0x5aabfa['style'][_0x32f262(0x460)]='calc('+_0x2864cb+_0x32f262(0x80d)+_0x24f306+_0x32f262(0x2fd),_0x5aabfa[_0x32f262(0x577)][_0x32f262(0x78d)]=_0x518047+'px',_0x5aabfa[_0x32f262(0x462)]=()=>openSongManager(_0x412bee),_0x5aabfa[_0x32f262(0x5b8)]=_0x32f262(0x24c)+_0x190196[_0x32f262(0x81a)]+_0x32f262(0x8f8)+_0x190196[_0x32f262(0x19e)]+_0x32f262(0x974),_0x412bee===userPlaylistPlaybackIndex&&_0x5aabfa['classList'][_0x32f262(0x5e3)]('is-playing'),userPlaylistStreamEl[_0x32f262(0x3de)](_0x5aabfa),userPlaylistNodeElements['push'](_0x5aabfa),_0x518047+=_0x524f31;}),userPlaylistStreamEl[_0x371e20(0x577)][_0x371e20(0x5ea)]=_0x518047+0xc8+'px';}function userPlaylistResize(){const _0x2c571a=_0x28e739;if(!userPlaylistViewEl||!userPlaylistCanvas||!userPlaylistOverlayCanvas)return;const _0x5f3b43=userPlaylistViewEl[_0x2c571a(0x627)](),_0x5bea2b=Math[_0x2c571a(0x738)](0x1,Math['floor'](_0x5f3b43['width'])),_0xf65cab=Math[_0x2c571a(0x738)](0x1,Math['floor'](_0x5f3b43[_0x2c571a(0x5ea)]));userPlaylistWidth=_0x5bea2b,userPlaylistHeight=_0xf65cab,userPlaylistCanvas[_0x2c571a(0x4bf)]=_0x5bea2b,userPlaylistCanvas[_0x2c571a(0x5ea)]=_0xf65cab,userPlaylistOverlayCanvas[_0x2c571a(0x4bf)]=_0x5bea2b,userPlaylistOverlayCanvas['height']=_0xf65cab;}function drawUserPlaylistLines(){const _0x1ddd6d=_0x28e739;if(!userPlaylistCtx||!userPlaylistViewEl||!userPlaylistHeaderEl){requestAnimationFrame(drawUserPlaylistLines);return;}userPlaylistCtx[_0x1ddd6d(0x915)](0x0,0x0,userPlaylistWidth,userPlaylistHeight);const _0x27d22d=document[_0x1ddd6d(0x4df)][_0x1ddd6d(0x7f3)](_0x1ddd6d(0x3e1))===_0x1ddd6d(0x30a),_0x5c7d56=_0x27d22d?_0x1ddd6d(0x6cd):_0x1ddd6d(0x7e2),_0x38d768=_0x27d22d?_0x1ddd6d(0x946):_0x1ddd6d(0x43f),_0x51fb0c=userPlaylistViewEl[_0x1ddd6d(0x627)](),_0x441e1d=userPlaylistHeaderEl[_0x1ddd6d(0x627)](),_0x14e6b1=_0x441e1d['left']-_0x51fb0c[_0x1ddd6d(0x460)]+_0x441e1d[_0x1ddd6d(0x4bf)]/0x2,_0x46f9e1=_0x441e1d[_0x1ddd6d(0x78d)]-_0x51fb0c[_0x1ddd6d(0x78d)]+_0x441e1d[_0x1ddd6d(0x5ea)]/0x2,_0x265a79=_0x51fb0c[_0x1ddd6d(0x78d)],_0x520fa6=_0x51fb0c[_0x1ddd6d(0x78d)]+userPlaylistHeight,_0x1a271=userPlaylistNodeElements[_0x1ddd6d(0x962)](_0x342837=>{const _0x2c5469=_0x1ddd6d,_0x163873=_0x342837[_0x2c5469(0x627)]();return{'x':_0x163873['left']-_0x51fb0c[_0x2c5469(0x460)]+0x5,'y':_0x163873[_0x2c5469(0x78d)]-_0x51fb0c['top']+0x5,'visible':_0x163873[_0x2c5469(0x78d)]<_0x520fa6&&_0x163873[_0x2c5469(0x5db)]>_0x265a79};});userPlaylistCtx[_0x1ddd6d(0x25a)]=0x1,userPlaylistCtx['lineCap']=_0x1ddd6d(0x247);if(_0x1a271[_0x1ddd6d(0x6ea)]>0x0){const _0x33cdd9=_0x1a271[0x0];(_0x33cdd9['visible']||_0x46f9e1>-0x64)&&drawUserPlaylistFluidLine(userPlaylistCtx,_0x14e6b1,_0x46f9e1,_0x33cdd9['x'],_0x33cdd9['y'],_0x38d768,userPlaylistTime);}for(let _0x5c627a=0x0;_0x5c627a<_0x1a271[_0x1ddd6d(0x6ea)]-0x1;_0x5c627a++){const _0x136f20=_0x1a271[_0x5c627a],_0x2e3b24=_0x1a271[_0x5c627a+0x1];(_0x136f20[_0x1ddd6d(0x256)]||_0x2e3b24[_0x1ddd6d(0x256)])&&drawUserPlaylistFluidLine(userPlaylistCtx,_0x136f20['x'],_0x136f20['y'],_0x2e3b24['x'],_0x2e3b24['y'],_0x5c7d56,userPlaylistTime+_0x5c627a);}for(let _0x4285bb=0x0;_0x4285bb<_0x1a271[_0x1ddd6d(0x6ea)]-0x2;_0x4285bb++){if(_0x4285bb%0x2===0x0){const _0x234c83=_0x1a271[_0x4285bb],_0x231e9f=_0x1a271[_0x4285bb+0x2];(_0x234c83[_0x1ddd6d(0x256)]||_0x231e9f['visible'])&&(userPlaylistCtx['strokeStyle']=_0x5c7d56,userPlaylistCtx['beginPath'](),userPlaylistCtx[_0x1ddd6d(0x89e)](_0x234c83['x'],_0x234c83['y']),userPlaylistCtx['lineTo'](_0x231e9f['x'],_0x231e9f['y']),userPlaylistCtx[_0x1ddd6d(0x72c)]());}}userPlaylistTime+=0.05,requestAnimationFrame(drawUserPlaylistLines);}function drawUserPlaylistFluidLine(_0x68339a,_0x1507b7,_0x262bfe,_0x1b3488,_0x4d92db,_0x283bb6,_0xa72c71){const _0x260371=_0x28e739;_0x68339a[_0x260371(0x1a6)]=_0x283bb6,_0x68339a['beginPath'](),_0x68339a[_0x260371(0x89e)](_0x1507b7,_0x262bfe);const _0x823044=(_0x1507b7+_0x1b3488)/0x2,_0x283c59=(_0x1507b7+_0x1b3488)/0x2,_0x313cd2=0xa,_0x520419=Math[_0x260371(0x947)](_0xa72c71*0.5)*_0x313cd2,_0x35073f=_0x823044+_0x520419,_0xdc3026=(_0x262bfe+_0x4d92db)/0x2;_0x68339a['quadraticCurveTo'](_0x35073f,_0xdc3026,_0x1b3488,_0x4d92db),_0x68339a[_0x260371(0x72c)]();}function closeUserPlaylistOverlay(){const _0x146815=_0x28e739;if(!userPlaylistOverlayLayer)return;userPlaylistOverlayLayer[_0x146815(0x421)][_0x146815(0x403)](_0x146815(0x525)),userPlaylistActiveMode=null,userPlaylistOverlayCloseTimer&&(clearTimeout(userPlaylistOverlayCloseTimer),userPlaylistOverlayCloseTimer=null),userPlaylistOverlayCloseTimer=setTimeout(()=>{const _0x26f9f0=_0x146815;userPlaylistOverlayContent&&userPlaylistOverlayContent[_0x26f9f0(0x421)][_0x26f9f0(0x403)](_0x26f9f0(0x2a6));if(userPlaylistOverlayAnimationId)cancelAnimationFrame(userPlaylistOverlayAnimationId);if(userPlaylistOverlayCtx)userPlaylistOverlayCtx['clearRect'](0x0,0x0,userPlaylistWidth,userPlaylistHeight);userPlaylistOverlayCloseTimer=null;},0x104);}function setUserPlaylistOverlayModeClass(_0x2b7657){const _0x159be4=_0x28e739;if(!userPlaylistOverlayContent)return;userPlaylistOverlayContent[_0x159be4(0x421)][_0x159be4(0x403)](_0x159be4(0x2a6)),_0x2b7657===_0x159be4(0x79e)&&userPlaylistOverlayContent['classList']['add']('is-together');}let userPlaylistCategoryNodes=[];function openCategoryManager(){const _0x3aad76=_0x28e739;initUserPlaylistPage();if(!userPlaylistOverlayContent||!userPlaylistOverlayLayer)return;userPlaylistActiveMode=_0x3aad76(0x42e),setUserPlaylistOverlayModeClass(null),userPlaylistOverlayContent[_0x3aad76(0x5b8)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22overlay-title\x22>Universe</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22overlay-subtitle\x22>Managing\x20the\x20chaos\x20of\x20categories</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22newCatInput\x22\x20class=\x22ghost-input\x22\x20placeholder=\x22New\x20Category...\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22action-btn-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22circle-btn\x22\x20onclick=\x22addCategory()\x22>+</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22circle-btn\x22\x20onclick=\x22closeUserPlaylistOverlay()\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+(playlists[_0x3aad76(0x6ea)]===0x0?_0x3aad76(0x502):'')+'\x0a\x20\x20\x20\x20\x20\x20';const _0x1c16c6=playlists[_0x3aad76(0x962)](_0x59e83f=>_0x59e83f['title']);userPlaylistCategoryNodes=_0x1c16c6['map'](_0xc72b26=>({'text':_0xc72b26,'x':Math[_0x3aad76(0x266)]()*userPlaylistWidth,'y':Math[_0x3aad76(0x266)]()*userPlaylistHeight*0.6+0x64,'vx':(Math[_0x3aad76(0x266)]()-0.5)*0.5,'vy':(Math[_0x3aad76(0x266)]()-0.5)*0.5})),userPlaylistOverlayLayer[_0x3aad76(0x421)][_0x3aad76(0x5e3)]('active'),animateUserPlaylistCategoryWeb();}function addCategory(){const _0x4b0bd7=_0x28e739,_0x5911d2=document['getElementById']('newCatInput'),_0x14981b=_0x5911d2?_0x5911d2[_0x4b0bd7(0x29c)][_0x4b0bd7(0x28e)]():'';if(_0x14981b){playlists[_0x4b0bd7(0x2c4)](createUserPlaylistEntry(_0x14981b)),userPlaylistCategoryNodes[_0x4b0bd7(0x2c4)]({'text':_0x14981b,'x':userPlaylistWidth/0x2,'y':userPlaylistHeight/0x2,'vx':(Math['random']()-0.5)*0x2,'vy':(Math['random']()-0.5)*0x2}),initUserPlaylistNodes();if(userPlaylistOverlayContent){const _0x56f3ec=userPlaylistOverlayContent[_0x4b0bd7(0x768)](_0x4b0bd7(0x3b6));if(_0x56f3ec)_0x56f3ec[_0x4b0bd7(0x403)]();}saveUserPlaylistData();if(_0x5911d2)_0x5911d2[_0x4b0bd7(0x29c)]='';}}function animateUserPlaylistCategoryWeb(){const _0x3da0b2=_0x28e739;if(userPlaylistActiveMode!==_0x3da0b2(0x42e)||!userPlaylistOverlayCtx)return;userPlaylistOverlayCtx['clearRect'](0x0,0x0,userPlaylistWidth,userPlaylistHeight);const _0x11041e=document[_0x3da0b2(0x4df)]['getAttribute']('data-theme')===_0x3da0b2(0x30a),_0x13b597=_0x11041e?_0x3da0b2(0x43b):_0x3da0b2(0x44a),_0x47f268=_0x11041e?'rgba(255,255,255,0.1)':_0x3da0b2(0x944);userPlaylistCategoryNodes[_0x3da0b2(0x7b6)]((_0x17aa31,_0x12bc1f)=>{const _0x4f959c=_0x3da0b2;_0x17aa31['x']+=_0x17aa31['vx'],_0x17aa31['y']+=_0x17aa31['vy'];if(_0x17aa31['x']<0x0||_0x17aa31['x']>userPlaylistWidth)_0x17aa31['vx']*=-0x1;if(_0x17aa31['y']<0x0||_0x17aa31['y']>userPlaylistHeight)_0x17aa31['vy']*=-0x1;userPlaylistOverlayCtx[_0x4f959c(0x7ba)]=_0x13b597,userPlaylistOverlayCtx[_0x4f959c(0x8d8)]=_0x4f959c(0x8cd),userPlaylistOverlayCtx[_0x4f959c(0x2a1)](_0x17aa31[_0x4f959c(0x7e6)],_0x17aa31['x'],_0x17aa31['y']);for(let _0x59ce50=_0x12bc1f+0x1;_0x59ce50<userPlaylistCategoryNodes[_0x4f959c(0x6ea)];_0x59ce50++){const _0x4d9947=userPlaylistCategoryNodes[_0x59ce50],_0x502166=Math['hypot'](_0x17aa31['x']-_0x4d9947['x'],_0x17aa31['y']-_0x4d9947['y']);_0x502166<0xc8&&(userPlaylistOverlayCtx[_0x4f959c(0x291)](),userPlaylistOverlayCtx[_0x4f959c(0x1a6)]=_0x47f268,userPlaylistOverlayCtx['lineWidth']=0x1-_0x502166/0xc8,userPlaylistOverlayCtx[_0x4f959c(0x89e)](_0x17aa31['x'],_0x17aa31['y']-0x5),userPlaylistOverlayCtx['lineTo'](_0x4d9947['x'],_0x4d9947['y']-0x5),userPlaylistOverlayCtx[_0x4f959c(0x72c)]());}}),userPlaylistOverlayAnimationId=requestAnimationFrame(animateUserPlaylistCategoryWeb);}function openSongManager(_0x277a94){const _0x10e21a=_0x28e739;initUserPlaylistPage();if(!userPlaylistOverlayContent||!userPlaylistOverlayLayer)return;userPlaylistActiveMode=_0x10e21a(0x5fe),setUserPlaylistOverlayModeClass(null),userPlaylistCurrentIndex=_0x277a94;const _0x2cf05c=playlists[_0x277a94];userPlaylistOverlayContent['innerHTML']=_0x10e21a(0x255)+_0x2cf05c[_0x10e21a(0x81a)]+_0x10e21a(0x40a)+_0x2cf05c[_0x10e21a(0x19e)]+_0x10e21a(0x6d2),renderSongs(_0x2cf05c[_0x10e21a(0x646)]),initSongSearchUI(),userPlaylistOverlayLayer[_0x10e21a(0x421)]['add'](_0x10e21a(0x525)),animateUserPlaylistRain();}async function openTogetherInviteUI(){const _0x4b5f73=_0x28e739;initUserPlaylistPage();if(!userPlaylistOverlayContent||!userPlaylistOverlayLayer)return;userPlaylistActiveMode=_0x4b5f73(0x79e),setUserPlaylistOverlayModeClass('together'),userPlaylistOverlayContent[_0x4b5f73(0x5b8)]=_0x4b5f73(0x2b5),userPlaylistOverlayLayer[_0x4b5f73(0x421)]['add']('active');userPlaylistOverlayCtx&&userPlaylistOverlayCtx[_0x4b5f73(0x915)](0x0,0x0,userPlaylistWidth,userPlaylistHeight);const _0xcfda75=document['getElementById'](_0x4b5f73(0x663));if(_0xcfda75){const _0x2d49c0=document[_0x4b5f73(0x5e5)](_0x4b5f73(0x6a4));_0x2d49c0[_0x4b5f73(0x51f)]='together-empty',_0x2d49c0[_0x4b5f73(0x7dc)]=_0x4b5f73(0x659),_0xcfda75[_0x4b5f73(0x3de)](_0x2d49c0);}const _0xc9c600=async()=>{const _0x50b435=_0x4b5f73;if(userPlaylistActiveMode!=='together')return;try{const _0x48e4e8=await db['chats'][_0x50b435(0x5fd)](),_0x58d9fd=getUserCreatedCharactersFromChats(_0x48e4e8);renderTogetherInviteList(_0x58d9fd);}catch(_0x4fc4b1){console['error'](_0x50b435(0x224),_0x4fc4b1),renderTogetherInviteList([]);}};requestAnimationFrame(()=>requestAnimationFrame(_0xc9c600));}function renderTogetherInviteList(_0x4654ec){const _0x484333=_0x28e739,_0x50ae88=document[_0x484333(0x761)](_0x484333(0x663));if(!_0x50ae88)return;_0x50ae88[_0x484333(0x5b8)]='';if(!Array['isArray'](_0x4654ec)||_0x4654ec[_0x484333(0x6ea)]===0x0){const _0xa871d2=document[_0x484333(0x5e5)](_0x484333(0x6a4));_0xa871d2[_0x484333(0x51f)]='together-empty',_0xa871d2['textContent']=_0x484333(0x41a),_0x50ae88[_0x484333(0x3de)](_0xa871d2);return;}const _0x48c55d=_0x471914=>{const _0x175c9b=_0x484333,_0x316567=typeof _0x471914===_0x175c9b(0x7a1)?_0x471914[_0x175c9b(0x28e)]():'';if(!_0x316567)return'';const _0x2c0f4f=_0x316567[_0x175c9b(0x6eb)]();if(_0x2c0f4f[_0x175c9b(0x414)](_0x175c9b(0x615)))return'';if(_0x2c0f4f[_0x175c9b(0x414)]('data:')&&!_0x2c0f4f[_0x175c9b(0x414)](_0x175c9b(0x31c)))return'';return _0x316567;},_0xef09c1=document[_0x484333(0x3e4)]();_0x4654ec['forEach'](_0x10d638=>{const _0x37c593=_0x484333,_0x122c82=document[_0x37c593(0x5e5)]('button');_0x122c82[_0x37c593(0x3a3)]='button',_0x122c82[_0x37c593(0x51f)]=_0x37c593(0x8b4);const _0x93db92=document[_0x37c593(0x5e5)]('div');_0x93db92[_0x37c593(0x51f)]=_0x37c593(0x719);const _0x3634d0=_0x48c55d(_0x10d638?.[_0x37c593(0x6ff)]?.[_0x37c593(0x922)]);if(_0x3634d0){const _0x3e8a70=document['createElement'](_0x37c593(0x870));_0x3e8a70[_0x37c593(0x273)]=_0x3634d0,_0x3e8a70[_0x37c593(0x817)]=_0x10d638?.[_0x37c593(0x76a)]||'角色',_0x93db92[_0x37c593(0x3de)](_0x3e8a70);}else _0x93db92['innerHTML']=_0x37c593(0x76c);const _0x48de0a=document[_0x37c593(0x5e5)](_0x37c593(0x6a4));_0x48de0a[_0x37c593(0x51f)]=_0x37c593(0x5ac);const _0xdacd14=document[_0x37c593(0x5e5)](_0x37c593(0x6a4));_0xdacd14[_0x37c593(0x51f)]=_0x37c593(0x6b6),_0xdacd14[_0x37c593(0x7dc)]=_0x10d638?.[_0x37c593(0x76a)]||_0x37c593(0x598);const _0x480b63=document[_0x37c593(0x5e5)]('div');_0x480b63[_0x37c593(0x51f)]=_0x37c593(0x8e4);const _0x1f4b5a=typeof _0x10d638?.[_0x37c593(0x581)]===_0x37c593(0x7a1)?_0x10d638[_0x37c593(0x581)][_0x37c593(0x28e)]():'';_0x480b63[_0x37c593(0x7dc)]=_0x1f4b5a||_0x37c593(0x808),_0x48de0a[_0x37c593(0x3de)](_0xdacd14),_0x48de0a[_0x37c593(0x3de)](_0x480b63);const _0x3ae9eb=document[_0x37c593(0x5e5)](_0x37c593(0x6a4));_0x3ae9eb[_0x37c593(0x51f)]=_0x37c593(0x498),_0x3ae9eb[_0x37c593(0x7dc)]='INVITE',_0x122c82['appendChild'](_0x93db92),_0x122c82['appendChild'](_0x48de0a),_0x122c82[_0x37c593(0x3de)](_0x3ae9eb),_0x122c82[_0x37c593(0x55d)](_0x37c593(0x7bd),()=>{sendTogetherInviteToChat(_0x10d638);}),_0xef09c1['appendChild'](_0x122c82);}),_0x50ae88[_0x484333(0x3de)](_0xef09c1);}const TOGETHER_INVITE_DEFAULT_TITLE=_0x28e739(0x2ed),TOGETHER_INVITE_DEFAULT_ARTIST=_0x28e739(0x7e8),TOGETHER_INVITE_EXPIRE_MS=0x1e*0x3c*0x3e8,togetherInviteExpiryTimers=new Map();function resolveTogetherInviteSongMeta(){const _0x26d638=_0x28e739;let _0x3cfcfd=TOGETHER_INVITE_DEFAULT_TITLE,_0x556526=TOGETHER_INVITE_DEFAULT_ARTIST,_0x2b37a0='',_0x4db497=null;const _0x120b5a=[],_0x56a112=_0x411c65=>{const _0xf39877=_0xc1ca;if(!Number[_0xf39877(0x795)](_0x411c65)||_0x411c65<0x0||_0x411c65>=playlists[_0xf39877(0x6ea)])return;if(!_0x120b5a[_0xf39877(0x44b)](_0x411c65))_0x120b5a[_0xf39877(0x2c4)](_0x411c65);};_0x56a112(userPlaylistPlaybackIndex),_0x56a112(userPlaylistCurrentIndex);for(let _0x5125de=0x0;_0x5125de<playlists[_0x26d638(0x6ea)];_0x5125de++)_0x56a112(_0x5125de);for(const _0x320d44 of _0x120b5a){const _0xef86f4=playlists[_0x320d44];if(!_0xef86f4)continue;if(!_0x4db497)_0x4db497=_0xef86f4;if(Array[_0x26d638(0x851)](_0xef86f4[_0x26d638(0x646)])&&_0xef86f4[_0x26d638(0x646)][_0x26d638(0x6ea)]>0x0){_0x4db497=_0xef86f4;break;}}if(_0x4db497){_0x2b37a0=String(_0x4db497['title']||'')[_0x26d638(0x28e)]();const _0x331a31=Array['isArray'](_0x4db497[_0x26d638(0x646)])?_0x4db497[_0x26d638(0x646)][_0x26d638(0x30c)](Boolean):null;if(_0x331a31){if(typeof _0x331a31==='string'){const _0x571b6c=_0x331a31['trim']();if(_0x571b6c)_0x3cfcfd=_0x571b6c;}else{if(typeof _0x331a31===_0x26d638(0x1f7)){const _0xc81ca4=String(_0x331a31[_0x26d638(0x76a)]||_0x331a31[_0x26d638(0x81a)]||_0x331a31['label']||'')[_0x26d638(0x28e)]();if(_0xc81ca4)_0x3cfcfd=_0xc81ca4;const _0x181e14=Array[_0x26d638(0x851)](_0x331a31[_0x26d638(0x52a)])?_0x331a31[_0x26d638(0x52a)]:_0x331a31['artist']?[_0x331a31['artist']]:[],_0x1ae9dd=_0x181e14[_0x26d638(0x962)](_0x335364=>String(_0x335364)[_0x26d638(0x28e)]())[_0x26d638(0x911)](Boolean)[_0x26d638(0x943)](_0x26d638(0x8ca));if(_0x1ae9dd)_0x556526=_0x1ae9dd;}}}}return{'songTitle':_0x3cfcfd,'songArtist':_0x556526,'playlistTitle':_0x2b37a0};}function resolveTogetherInviteCreatedAt(_0x1f9fcd,_0x26eb2e){const _0x267e92=_0x28e739,_0x409e41=Number(_0x1f9fcd?.[_0x267e92(0x42b)]||0x0);if(Number[_0x267e92(0x795)](_0x409e41)&&_0x409e41>0x0)return _0x409e41;const _0x1b43ac=_0x26eb2e?.['timestamp'];if(Number['isFinite'](_0x1b43ac)&&_0x1b43ac>0x0)return _0x1b43ac;if(typeof _0x1b43ac===_0x267e92(0x7a1)){const _0x1f6cea=Date[_0x267e92(0x4de)](_0x1b43ac);if(Number[_0x267e92(0x795)](_0x1f6cea))return _0x1f6cea;}return 0x0;}function isTogetherInviteExpired(_0x3a549c,_0x5b3ada){const _0x459f56=_0x28e739,_0x45ec52=resolveTogetherInviteCreatedAt(_0x3a549c,_0x5b3ada);if(!_0x45ec52)return![];return Date[_0x459f56(0x2cb)]()-_0x45ec52>=TOGETHER_INVITE_EXPIRE_MS;}async function updateTogetherInviteMessage(_0x589eab,_0x225bb5,_0x3c6133){const _0x32244c=_0x28e739;if(!_0x589eab||!_0x225bb5||!_0x3c6133)return![];const _0x4f01eb=String(_0x3c6133['id']||_0x225bb5?.[_0x32244c(0x4b7)]||'')[_0x32244c(0x28e)]();if(!_0x4f01eb)return![];_0x225bb5[_0x32244c(0x632)]='',_0x225bb5[_0x32244c(0x51a)]=_0x3c6133[_0x32244c(0x664)],_0x225bb5[_0x32244c(0x2d0)]=_0x3c6133[_0x32244c(0x593)]||TOGETHER_INVITE_DEFAULT_TITLE,_0x225bb5['togetherInviteArtist']=_0x3c6133['songArtist']||TOGETHER_INVITE_DEFAULT_ARTIST,_0x225bb5[_0x32244c(0x96f)]=_0x3c6133['playlistTitle']||'',_0x225bb5[_0x32244c(0x432)]=_0x3c6133;const _0x148b2b=db?.[_0x32244c(0x698)]&&typeof db['chatMessages']['update']===_0x32244c(0x48c);if(_0x148b2b&&_0x225bb5[_0x32244c(0x5c9)])try{await db[_0x32244c(0x698)][_0x32244c(0x301)](_0x225bb5[_0x32244c(0x5c9)],{'content':'','togetherInviteStatus':_0x225bb5[_0x32244c(0x51a)],'togetherInviteTitle':_0x225bb5[_0x32244c(0x2d0)],'togetherInviteArtist':_0x225bb5[_0x32244c(0x4b1)],'togetherInvitePlaylistTitle':_0x225bb5[_0x32244c(0x96f)],'_togetherInvite':_0x3c6133});}catch(_0x1dfa6b){}else{if(db?.['chatMessages']?.[_0x32244c(0x56a)]&&_0x4f01eb)try{await db['chatMessages']['where'](_0x32244c(0x4b7))[_0x32244c(0x82f)](_0x4f01eb)[_0x32244c(0x3ab)]({'content':'','togetherInviteStatus':_0x225bb5['togetherInviteStatus'],'togetherInviteTitle':_0x225bb5[_0x32244c(0x2d0)],'togetherInviteArtist':_0x225bb5[_0x32244c(0x4b1)],'togetherInvitePlaylistTitle':_0x225bb5[_0x32244c(0x96f)],'_togetherInvite':_0x3c6133});}catch(_0x259de7){}}return!![];}async function expireTogetherInviteById(_0x54f569,_0x58745d){const _0x419a11=_0x28e739,_0x3ca7bc=normalizeId(_0x54f569||'');if(!_0x3ca7bc||!_0x58745d||!db?.[_0x419a11(0x183)])return![];let _0x46f210=null;try{_0x46f210=await db[_0x419a11(0x183)][_0x419a11(0x309)](_0x3ca7bc);}catch(_0x23638e){_0x46f210=null;}if(!_0x46f210||!Array[_0x419a11(0x851)](_0x46f210['chatbox']))return![];const _0x36c2dd=_0x46f210[_0x419a11(0x4a6)]['find'](_0x39a944=>{const _0x52839f=_0x419a11;if(!_0x39a944)return![];const _0xa7d506=_0x39a944['_togetherInvite']||null,_0x135c19=String(_0xa7d506?.['id']||_0x39a944[_0x52839f(0x4b7)]||'')[_0x52839f(0x28e)]();if(_0x135c19!==_0x58745d)return![];const _0x51d937=String(_0x39a944[_0x52839f(0x51a)]||_0xa7d506?.['status']||'')[_0x52839f(0x28e)]()['toLowerCase']();return!_0x51d937||_0x51d937===_0x52839f(0x284);});if(!_0x36c2dd)return![];const _0x4ec4a9=_0x36c2dd[_0x419a11(0x432)]||{},_0x39e2b7={..._0x4ec4a9,'id':_0x58745d,'status':_0x419a11(0x24b)};return await updateTogetherInviteMessage(_0x46f210,_0x36c2dd,_0x39e2b7),isChatDetailActiveForChat(_0x46f210['id'])&&await renderChatMessages(_0x46f210),!![];}function scheduleTogetherInviteExpiry(_0x6c26e4,_0x138319,_0x215d18){const _0x4ab9df=_0x28e739;if(!_0x138319||!_0x215d18)return;const _0x4ce621=TOGETHER_INVITE_EXPIRE_MS-(Date[_0x4ab9df(0x2cb)]()-_0x215d18);if(_0x4ce621<=0x0){expireTogetherInviteById(_0x6c26e4,_0x138319);return;}if(togetherInviteExpiryTimers['has'](_0x138319))return;const _0x541a11=setTimeout(()=>{const _0x2d52fe=_0x4ab9df;togetherInviteExpiryTimers[_0x2d52fe(0x6c2)](_0x138319),expireTogetherInviteById(_0x6c26e4,_0x138319);},_0x4ce621);togetherInviteExpiryTimers['set'](_0x138319,_0x541a11);}async function syncTogetherInviteExpiryForChat(_0x335160){const _0x5f2464=_0x28e739;if(!_0x335160||!Array[_0x5f2464(0x851)](_0x335160[_0x5f2464(0x4a6)]))return![];let _0x380db7=![];for(const _0x4cae63 of _0x335160[_0x5f2464(0x4a6)]){if(!_0x4cae63||_0x4cae63[_0x5f2464(0x3a3)]!=='together-card')continue;const _0x243172=_0x4cae63[_0x5f2464(0x432)]||{},_0x346358=String(_0x4cae63[_0x5f2464(0x51a)]||_0x243172['status']||'')['trim']()['toLowerCase']()||_0x5f2464(0x284);if(_0x346358!==_0x5f2464(0x284))continue;const _0x4347a3=String(_0x243172['id']||_0x4cae63[_0x5f2464(0x4b7)]||'')[_0x5f2464(0x28e)](),_0x3319b6=resolveTogetherInviteCreatedAt(_0x243172,_0x4cae63);_0x4347a3&&_0x3319b6&&scheduleTogetherInviteExpiry(_0x335160['id'],_0x4347a3,_0x3319b6);if(!isTogetherInviteExpired(_0x243172,_0x4cae63))continue;if(!_0x4347a3)continue;const _0x1616be={..._0x243172,'id':_0x4347a3,'status':_0x5f2464(0x24b)};await updateTogetherInviteMessage(_0x335160,_0x4cae63,_0x1616be),_0x380db7=!![];}return _0x380db7;}function buildTogetherInviteCardHtml(_0x49b404,_0x187379={}){const _0x239e94=_0x28e739,{status:status=_0x239e94(0x284),inviteId:inviteId='',pendingText:pendingText=''}=_0x187379,_0x91ae41=escapeHtml(String(_0x49b404?.['songTitle']||TOGETHER_INVITE_DEFAULT_TITLE)),_0xbb4cca=escapeHtml(String(_0x49b404?.[_0x239e94(0x49e)]||TOGETHER_INVITE_DEFAULT_ARTIST)),_0x414df6=escapeHtml(String(inviteId||'')),_0x129e14=status==='connected'||status===_0x239e94(0x24b)||status===_0x239e94(0x262)?status:'pending',_0x1581bf=_0x129e14===_0x239e94(0x520)?'Synced':_0x129e14===_0x239e94(0x24b)?'Declined':_0x129e14==='ended'?_0x239e94(0x967):pendingText||_0x239e94(0x35b),_0x4ae1a5=_0x129e14===_0x239e94(0x520)?_0x239e94(0x2bf):'∞';if(_0x129e14===_0x239e94(0x520))return _0x239e94(0x320)+_0x91ae41+_0x239e94(0x36e)+_0xbb4cca+_0x239e94(0x482)+_0x1581bf+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22timer\x22\x20data-together-timer=\x221\x22>'+_0x4ae1a5+_0x239e94(0x7a8);return'\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22freq-card\x20card-broadcast\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card-meta\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x91ae41+_0x239e94(0x2e0)+_0xbb4cca+_0x239e94(0x729)+_0x1581bf+_0x239e94(0x430)+_0x4ae1a5+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20';}function resolveTogetherRequestTarget(_0x305283={}){const _0x57676a=_0x28e739,_0x18ab0f=normalizeTogetherPlaylistOwner(_0x305283['owner']),_0x5630fb=resolveTogetherPlaylistTargetIndex({'owner':_0x18ab0f,'playlist':_0x305283[_0x57676a(0x76f)],'index':_0x305283['index']});if(_0x5630fb<0x0||!Array['isArray'](playlists)||_0x5630fb>=playlists[_0x57676a(0x6ea)])return null;return{'owner':_0x18ab0f,'index':_0x5630fb,'playlist':playlists[_0x5630fb]};}function _0xc1ca(_0x256202,_0x41330e){const _0x2c65d0=_0x2c65();return _0xc1ca=function(_0xc1ca7e,_0x4cb9fe){_0xc1ca7e=_0xc1ca7e-0x172;let _0x4630fc=_0x2c65d0[_0xc1ca7e];return _0x4630fc;},_0xc1ca(_0x256202,_0x41330e);}function pickRandomPlayableSongIndex(_0x42fe19){const _0x178cdb=_0x28e739,_0x5451af=Array[_0x178cdb(0x851)](_0x42fe19?.[_0x178cdb(0x646)])?_0x42fe19[_0x178cdb(0x646)]:[],_0x34486c=[];_0x5451af[_0x178cdb(0x7b6)]((_0x1a5e8c,_0x5276a4)=>{const _0x11b0ae=_0x178cdb,_0x570c79=normalizeUserPlaylistPlaybackSong(_0x1a5e8c);_0x570c79&&_0x570c79['id']&&_0x34486c[_0x11b0ae(0x2c4)]({'idx':_0x5276a4,'song':_0x570c79});});if(_0x34486c['length']===0x0)return{'index':-0x1,'song':null};const _0x51cb6a=_0x34486c[Math[_0x178cdb(0x64b)](Math[_0x178cdb(0x266)]()*_0x34486c[_0x178cdb(0x6ea)])];return{'index':_0x51cb6a[_0x178cdb(0x894)],'song':_0x51cb6a[_0x178cdb(0x5fe)]};}function resolveTogetherSongMetaFromPlaylist(_0x3b3823,_0x57273d){const _0xc0374a=_0x28e739,_0x587c85=String(_0x3b3823?.['title']||'')[_0xc0374a(0x28e)]();let _0x4022c8=TOGETHER_INVITE_DEFAULT_TITLE,_0x5d9298=TOGETHER_INVITE_DEFAULT_ARTIST;if(_0x57273d){const _0x57d1a8=String(_0x57273d[_0xc0374a(0x76a)]||_0x57273d[_0xc0374a(0x81a)]||_0x57273d[_0xc0374a(0x880)]||'')['trim']();if(_0x57d1a8)_0x4022c8=_0x57d1a8;const _0x181255=buildSongArtistText(_0x57273d);if(_0x181255)_0x5d9298=_0x181255;}return{'songTitle':_0x4022c8,'songArtist':_0x5d9298,'playlistTitle':_0x587c85};}async function sendTogetherRequestToChat(_0x52ace7,_0x30443c={},_0x4d61d2={}){const _0x27276a=_0x28e739;if(!_0x52ace7||!db?.[_0x27276a(0x183)]||!db?.[_0x27276a(0x698)])return![];try{await loadUserPlaylistData();}catch(_0x3697e4){}const _0x53b322=resolveTogetherRequestTarget(_0x30443c);if(!_0x53b322)return showIslandNotification(_0x27276a(0x31f),_0x27276a(0x85b),_0x27276a(0x537)),![];const {index:_0x4242a1,playlist:_0x2b3d19,owner:_0x41d98f}=_0x53b322,_0x47a6ed=pickRandomPlayableSongIndex(_0x2b3d19),_0x5fc3ed=resolveTogetherSongMetaFromPlaylist(_0x2b3d19,_0x47a6ed['song']),_0x2ed2df=_0x27276a(0x395)+Date['now']()+'_'+Math['random']()[_0x27276a(0x7f6)](0x24)[_0x27276a(0x73d)](0x2,0x8),_0x5da475=Date[_0x27276a(0x2cb)](),_0xc31b6f=String(_0x4d61d2[_0x27276a(0x27f)]||'')[_0x27276a(0x28e)]()||(_0x52ace7?.['name']||'角色'),_0x3d0118=String(_0x4d61d2[_0x27276a(0x5de)]||'')[_0x27276a(0x28e)]()||'用户',_0x2b9503={'id':_0x2ed2df,'status':_0x27276a(0x284),'songTitle':_0x5fc3ed[_0x27276a(0x593)],'songArtist':_0x5fc3ed[_0x27276a(0x49e)],'playlistTitle':_0x5fc3ed['playlistTitle']||'','createdAt':_0x5da475,'initiatorRole':_0x27276a(0x887),'initiatorName':_0xc31b6f,'initiatorId':String(_0x52ace7['id']||'')[_0x27276a(0x28e)](),'inviteeRole':_0x27276a(0x8dd),'inviteeName':_0x3d0118,'playlistOwner':_0x41d98f||_0x27276a(0x887),'playlistIndex':_0x4242a1};_0x52ace7[_0x27276a(0x4a6)]=Array[_0x27276a(0x851)](_0x52ace7['chatbox'])?_0x52ace7['chatbox']:[];const _0x31753a={'role':_0x27276a(0x1c7),'type':'together-card','content':'','timestamp':_0x5da475,'read':![],'togetherInviteId':_0x2ed2df,'togetherInviteStatus':_0x27276a(0x284),'togetherInviteTitle':_0x5fc3ed[_0x27276a(0x593)],'togetherInviteArtist':_0x5fc3ed[_0x27276a(0x49e)],'togetherInvitePlaylistTitle':_0x5fc3ed[_0x27276a(0x6c1)]||'','_togetherInvite':_0x2b9503};_0x52ace7['chatbox'][_0x27276a(0x2c4)](_0x31753a);const _0x36a951=await db[_0x27276a(0x698)][_0x27276a(0x5e3)]({'characterId':normalizeId(_0x52ace7['id']||''),'sessionId':await getActiveSessionIdForChat(_0x52ace7['id'])||'default','role':_0x27276a(0x1c7),'type':_0x27276a(0x875),'content':'','timestamp':new Date(_0x5da475)['toISOString'](),'togetherInviteId':_0x2ed2df,'togetherInviteStatus':_0x27276a(0x284),'togetherInviteTitle':_0x5fc3ed[_0x27276a(0x593)],'togetherInviteArtist':_0x5fc3ed['songArtist'],'togetherInvitePlaylistTitle':_0x5fc3ed[_0x27276a(0x6c1)]||'','_togetherInvite':_0x2b9503});return _0x31753a[_0x27276a(0x5c9)]=_0x36a951,_0x52ace7[_0x27276a(0x7d5)]='一起听邀请',_0x52ace7[_0x27276a(0x4fa)]=_0x5da475,await db[_0x27276a(0x183)]['put'](_0x52ace7),updateChatListItemLastMessage(_0x52ace7['id'],_0x52ace7['lastMessage'],_0x52ace7[_0x27276a(0x4fa)])&&bumpChatListItemToTop(_0x52ace7['id']),scheduleTogetherInviteExpiry(_0x52ace7['id'],_0x2ed2df,_0x5da475),isChatDetailActiveForChat(_0x52ace7['id'])&&await renderChatMessages(_0x52ace7),!![];}async function joinTogetherInviteFromCharacter(_0x466b47){const _0x1b9efe=_0x28e739,_0x3b08fe=normalizeId(currentChatId||window['currentChatId']||'');if(!_0x3b08fe||!db?.['chats'])return![];let _0x558b54=null;try{_0x558b54=await db[_0x1b9efe(0x183)][_0x1b9efe(0x309)](_0x3b08fe);}catch(_0x49e42a){_0x558b54=null;}if(!_0x558b54||!Array[_0x1b9efe(0x851)](_0x558b54[_0x1b9efe(0x4a6)]))return![];const _0x29a3c1=_0x558b54['chatbox'][_0x1b9efe(0x30c)](_0x53fd17=>{const _0x588003=_0x1b9efe;if(!_0x53fd17||_0x53fd17[_0x588003(0x3a3)]!==_0x588003(0x875))return![];const _0x731c70=_0x53fd17[_0x588003(0x432)]||{},_0x3b2013=String(_0x731c70['id']||_0x53fd17[_0x588003(0x4b7)]||'')['trim']();if(_0x3b2013!==_0x466b47)return![];const _0xb15fe3=String(_0x53fd17[_0x588003(0x51a)]||_0x731c70[_0x588003(0x664)]||'')['trim']()['toLowerCase']();return!_0xb15fe3||_0xb15fe3===_0x588003(0x284);});if(!_0x29a3c1)return![];const _0x5901bf=_0x29a3c1[_0x1b9efe(0x432)]||{};if(isTogetherInviteExpired(_0x5901bf,_0x29a3c1)){const _0x198d92=String(_0x5901bf['id']||_0x29a3c1[_0x1b9efe(0x4b7)]||'')[_0x1b9efe(0x28e)]();if(_0x198d92)await expireTogetherInviteById(_0x3b08fe,_0x198d92);return![];}if(String(_0x5901bf[_0x1b9efe(0x4ad)]||'')[_0x1b9efe(0x28e)]()[_0x1b9efe(0x6eb)]()!==_0x1b9efe(0x887))return![];const _0x9013d4={..._0x5901bf,'id':String(_0x5901bf['id']||_0x29a3c1[_0x1b9efe(0x4b7)]||'')[_0x1b9efe(0x28e)](),'status':'connected'};await updateTogetherInviteMessage(_0x558b54,_0x29a3c1,_0x9013d4);const _0x3ce949=Number[_0x1b9efe(0x795)](_0x5901bf[_0x1b9efe(0x242)])?_0x5901bf[_0x1b9efe(0x242)]:-0x1;let _0x33c5ef=_0x3ce949;_0x33c5ef<0x0&&(_0x33c5ef=resolveTogetherPlaylistTargetIndex({'owner':_0x5901bf['playlistOwner'],'playlist':_0x5901bf[_0x1b9efe(0x6c1)],'index':_0x5901bf[_0x1b9efe(0x242)]}));try{await loadUserPlaylistData();}catch(_0x54a465){}if(!Array[_0x1b9efe(0x851)](playlists)||_0x33c5ef<0x0||_0x33c5ef>=playlists[_0x1b9efe(0x6ea)])showIslandNotification(_0x1b9efe(0x31f),_0x1b9efe(0x558),_0x1b9efe(0x537));else{const _0x19a2fa=playlists[_0x33c5ef],_0x9109f7=pickRandomPlayableSongIndex(_0x19a2fa);if(_0x9109f7[_0x1b9efe(0x6c0)]<0x0)return showIslandNotification(_0x1b9efe(0x31f),_0x1b9efe(0x938),_0x1b9efe(0x537)),!![];const _0x52073a=_0x9109f7[_0x1b9efe(0x6c0)],_0xfcf764=0.15+Math[_0x1b9efe(0x266)]()*0.55;userPlaylistCurrentIndex=_0x33c5ef,userPlaylistPlaybackIndex=_0x33c5ef,userPlaylistPlaybackSongIndex=_0x52073a,userPlaylistPlaybackPendingSwitch=![],persistUserPlaylistPlaybackIndex(),applyUserPlaylistPlaybackHighlight(),await playUserPlaylistSongAtIndex(_0x52073a,{'autoplay':!![],'startRatio':_0xfcf764});}return isChatDetailActiveForChat(_0x3b08fe)&&await renderChatMessages(_0x558b54),!![];}async function sendTogetherInviteToChat(_0x52629a){const _0x3e7658=_0x28e739;if(!_0x52629a||!db?.[_0x3e7658(0x183)]||!db?.['chatMessages'])return;const _0x391ee5=normalizeId(_0x52629a[_0x3e7658(0x4d0)]||''),_0x18fa0b=normalizeId(_0x52629a['id']||''),_0xba76f1=normalizeId(_0x52629a[_0x3e7658(0x3ae)]||'')||_0x18fa0b;let _0x314fdc=null;isValidIdValue(_0x391ee5)&&(_0x314fdc=await db[_0x3e7658(0x183)]['get'](_0x391ee5));!_0x314fdc&&isValidIdValue(_0x18fa0b)&&(_0x314fdc=await db['chats'][_0x3e7658(0x309)](_0x18fa0b));if(_0x314fdc&&typeof isUserCreatedCharacterRecord===_0x3e7658(0x48c)&&isUserCreatedCharacterRecord(_0x314fdc)){const _0x18e933=await findChatRecordForCharacter(_0x314fdc['id']);_0x18e933&&(togetherInviteDebugLog('sendTogetherInviteToChat:mapCharacterToChat',{'from':_0x314fdc['id'],'to':_0x18e933['id']}),_0x314fdc=_0x18e933);}!_0x314fdc&&isValidIdValue(_0xba76f1)&&(_0x314fdc=await findChatRecordForCharacter(_0xba76f1));if(!_0x314fdc)return;const _0x41fd54=normalizeId(_0x314fdc['id']||''),_0x2df2fb=normalizeId(getCharacterIdFromChat(_0x314fdc)||'')||_0xba76f1||_0x18fa0b;if(!_0x41fd54)return;togetherInviteDebugLog(_0x3e7658(0x35c),{'chatId':_0x41fd54,'characterId':_0x2df2fb,'currentChatId':currentChatId,'windowChatId':window['currentChatId']});const _0x19139c=await getActiveSessionIdForChat(_0x41fd54),_0x2754b8='together_'+Date[_0x3e7658(0x2cb)]()+'_'+Math['random']()['toString'](0x24)[_0x3e7658(0x73d)](0x2,0x8),_0xf1421b=resolveTogetherInviteSongMeta(),_0x46a969=Date[_0x3e7658(0x2cb)](),_0x1f1c34=await resolveChatUserProfileName(_0x41fd54,_0x314fdc),_0x5a78d2=String(_0x52629a?.[_0x3e7658(0x76a)]||_0x314fdc?.['name']||'')[_0x3e7658(0x28e)]()||'角色',_0x57e9d8={'id':_0x2754b8,'status':_0x3e7658(0x284),'songTitle':_0xf1421b['songTitle'],'songArtist':_0xf1421b['songArtist'],'playlistTitle':_0xf1421b['playlistTitle']||'','createdAt':_0x46a969,'initiatorRole':_0x3e7658(0x8dd),'initiatorName':_0x1f1c34,'initiatorId':_0x1f1c34,'inviteeRole':_0x3e7658(0x887),'inviteeName':_0x5a78d2,'playlistOwner':_0x3e7658(0x8dd)};_0x314fdc['chatbox']=Array['isArray'](_0x314fdc[_0x3e7658(0x4a6)])?_0x314fdc[_0x3e7658(0x4a6)]:[];const _0x117661={'role':_0x3e7658(0x8dd),'type':_0x3e7658(0x875),'content':'','timestamp':_0x46a969,'read':![],'togetherInviteId':_0x2754b8,'togetherInviteStatus':_0x3e7658(0x284),'togetherInviteTitle':_0xf1421b[_0x3e7658(0x593)],'togetherInviteArtist':_0xf1421b[_0x3e7658(0x49e)],'togetherInvitePlaylistTitle':_0xf1421b['playlistTitle']||'','_togetherInvite':_0x57e9d8};_0x314fdc[_0x3e7658(0x4a6)][_0x3e7658(0x2c4)](_0x117661);const _0x7d0b95=await db[_0x3e7658(0x698)][_0x3e7658(0x5e3)]({'chatId':_0x41fd54,'characterId':_0x2df2fb,'sessionId':_0x19139c||_0x3e7658(0x79f),'role':_0x3e7658(0x8dd),'type':'together-card','content':'','timestamp':new Date(_0x46a969)[_0x3e7658(0x7db)](),'togetherInviteId':_0x2754b8,'togetherInviteStatus':_0x3e7658(0x284),'togetherInviteTitle':_0xf1421b[_0x3e7658(0x593)],'togetherInviteArtist':_0xf1421b[_0x3e7658(0x49e)],'togetherInvitePlaylistTitle':_0xf1421b['playlistTitle']||'','_togetherInvite':_0x57e9d8});_0x117661['_dbMessageId']=_0x7d0b95,_0x314fdc['lastMessage']='一起听邀请',_0x314fdc[_0x3e7658(0x4fa)]=_0x46a969,await db['chats'][_0x3e7658(0x720)](_0x314fdc),scheduleTogetherInviteExpiry(_0x314fdc['id'],_0x2754b8,_0x46a969);updateChatListItemLastMessage(_0x314fdc['id'],_0x314fdc[_0x3e7658(0x7d5)],_0x314fdc[_0x3e7658(0x4fa)])&&bumpChatListItemToTop(_0x314fdc['id']);try{const _0x4758f1=userPlaylistViewEl||document['getElementById']('userPlaylistView'),_0x526c2b=!!(_0x4758f1&&_0x4758f1['classList'][_0x3e7658(0x6e3)](_0x3e7658(0x525)));(_0x526c2b||!isChatDetailActiveForChat(_0x314fdc['id']))&&requestChatDetailRefresh(_0x41fd54);}catch(_0xbd284a){}try{const _0x4826a8=normalizeId(currentChatId||window[_0x3e7658(0x29e)]||'');if(_0x4826a8&&isSameId(_0x4826a8,_0x314fdc['id'])){const _0x51b25c=window[_0x3e7658(0x77d)];if(_0x51b25c&&isSameId(normalizeId(_0x51b25c['id']),normalizeId(_0x314fdc['id'])))_0x51b25c[_0x3e7658(0x4a6)]=Array[_0x3e7658(0x851)](_0x51b25c[_0x3e7658(0x4a6)])?_0x51b25c[_0x3e7658(0x4a6)]:[],_0x51b25c['chatbox']['push'](_0x117661),await renderChatMessages(_0x51b25c,_0x3e7658(0x564));else{if(typeof reloadCurrentChatMessages==='function')await reloadCurrentChatMessages();else typeof renderChatMessages===_0x3e7658(0x48c)&&await renderChatMessages(_0x314fdc,'instant');}}else{if(isChatDetailActiveForChat(_0x314fdc['id'])){const _0x4fcb8d=window[_0x3e7658(0x77d)];_0x4fcb8d&&isSameId(normalizeId(_0x4fcb8d['id']),normalizeId(_0x314fdc['id']))?(_0x4fcb8d[_0x3e7658(0x4a6)]=Array[_0x3e7658(0x851)](_0x4fcb8d[_0x3e7658(0x4a6)])?_0x4fcb8d[_0x3e7658(0x4a6)]:[],_0x4fcb8d[_0x3e7658(0x4a6)][_0x3e7658(0x2c4)](_0x117661),await renderChatMessages(_0x4fcb8d,_0x3e7658(0x564))):await renderChatMessages(_0x314fdc,_0x3e7658(0x564));}}}catch(_0x54b8fe){}togetherInviteDebugLog(_0x3e7658(0x721),{'chatId':_0x41fd54,'inviteId':_0x2754b8}),showIslandNotification('一起听邀请','已发送给\x20'+(_0x52629a[_0x3e7658(0x76a)]||'角色'),_0x3e7658(0x4bc));}function selectPlaylistForPlayback(_0x51146b={}){const _0x475454=_0x28e739;if(!Array['isArray'](playlists)||playlists['length']===0x0)return;if(userPlaylistCurrentIndex===-0x1)return;const _0x57082d=userPlaylistPlaybackIndex,_0x6d0338=isUserPlaylistPlayingNow();userPlaylistPlaybackIndex=userPlaylistCurrentIndex,persistUserPlaylistPlaybackIndex(),applyUserPlaylistPlaybackHighlight();_0x6d0338?_0x57082d!==userPlaylistPlaybackIndex&&(userPlaylistPlaybackPendingSwitch=!![],userPlaylistPlaybackSongIndex=-0x1):(userPlaylistPlaybackPendingSwitch=![],userPlaylistPlaybackSongIndex=0x0,_0x57082d!==userPlaylistPlaybackIndex&&stopUserPlaylistPlayback({'reset':!![]}));refreshUserPlaylistPlaybackSongList();const _0x15acec=playlists[userPlaylistPlaybackIndex]?.['title']||_0x475454(0x792);showIslandNotification(_0x475454(0x7e4),_0x475454(0x926)+_0x15acec,_0x475454(0x4bc)),_0x51146b[_0x475454(0x8d3)]===!![]&&void addTogetherMusicSystemMessageForActiveChat({'chat':_0x51146b[_0x475454(0x864)],'action':_0x475454(0x673),'actorRole':_0x51146b[_0x475454(0x952)],'actorName':_0x51146b[_0x475454(0x1f6)],'playlistTitle':_0x15acec});}function applyUserPlaylistPlaybackHighlight(){const _0x6ffb8e=_0x28e739;if(!Array[_0x6ffb8e(0x851)](userPlaylistNodeElements))return;userPlaylistNodeElements[_0x6ffb8e(0x7b6)]((_0x8e4bc2,_0x498fb6)=>{const _0x590bbd=_0x6ffb8e;if(!_0x8e4bc2)return;_0x498fb6===userPlaylistPlaybackIndex?_0x8e4bc2[_0x590bbd(0x421)]['add'](_0x590bbd(0x89a)):_0x8e4bc2[_0x590bbd(0x421)]['remove']('is-playing');});}function isUserPlaylistPlayingNow(){const _0x4664ff=_0x28e739;if(userPlaylistPlaybackIsPlaying)return!![];if(userPlaylistPlaybackAudio&&userPlaylistPlaybackAudio[_0x4664ff(0x732)]===![])return!![];return![];}function initMusicWidgetUI(){const _0x1910cf=_0x28e739;if(musicWidgetReady)return;const _0x1db597=document[_0x1910cf(0x761)](_0x1910cf(0x54b)),_0x8fa6e=document[_0x1910cf(0x761)](_0x1910cf(0x6fe));if(!_0x1db597||!_0x8fa6e)return;musicWidgetReady=!![],_0x1db597[_0x1910cf(0x577)]['display']=_0x1910cf(0x562);try{_0x8fa6e[_0x1910cf(0x577)][_0x1910cf(0x2f7)]='none';}catch(_0x583da6){}initMusicWidgetDrag(_0x1db597,_0x8fa6e);const _0x4d7ea3=getMusicWidgetLyricStageEl();if(_0x4d7ea3){try{_0x4d7ea3[_0x1910cf(0x577)][_0x1910cf(0x2f7)]=_0x1910cf(0x562);}catch(_0x212d83){}initMusicWidgetLyricDrag(_0x4d7ea3);}setMusicWidgetLyricStageVisibility(!!musicWidgetLyricStyleActive),initMusicWidgetLyricColorPicker(),loadMusicWidgetOrbSkin(),initMusicWidgetOrbSkinEditor(),loadMusicWidgetPositions(),updateMusicWidgetPlaybackState(isUserPlaylistPlayingNow()),updateMusicWidgetSongInfo(userPlaylistPlaybackNowPlaying),bindMusicWidgetOverlayControls();}function hasUserPlaylistAudioSource(){const _0x1deaec=_0x28e739;if(!userPlaylistPlaybackAudio)return![];try{if(typeof userPlaylistPlaybackAudio['getAttribute']==='function'){const _0x541d5f=String(userPlaylistPlaybackAudio[_0x1deaec(0x7f3)]('src')||'')[_0x1deaec(0x28e)]();return!!_0x541d5f;}}catch(_0x1ef478){}return![];}function updateMusicWidgetVisibility(_0x16f19e){const _0x309872=_0x28e739,_0x58d38f=document[_0x309872(0x761)](_0x309872(0x54b));if(!_0x58d38f)return;const _0x2f02ba=hasUserPlaylistAudioSource();if(musicWidgetForceHidden&&!_0x16f19e){_0x58d38f[_0x309872(0x577)]['display']=_0x309872(0x562),_0x58d38f[_0x309872(0x577)]['visibility']=_0x309872(0x48b),_0x58d38f[_0x309872(0x577)]['pointerEvents']=_0x309872(0x562);return;}musicWidgetForceHidden&&_0x16f19e&&(musicWidgetForceHidden=![]);const _0x2cd75a=_0x16f19e||_0x2f02ba;_0x58d38f['style'][_0x309872(0x475)]=_0x2cd75a?_0x309872(0x439):'none',_0x58d38f[_0x309872(0x577)]['visibility']=_0x2cd75a?_0x309872(0x256):_0x309872(0x48b),_0x58d38f['style'][_0x309872(0x3b2)]=_0x2cd75a?_0x309872(0x4e2):_0x309872(0x562);}function updateMusicWidgetPlaybackState(_0x266947){const _0x5454c7=_0x28e739,_0x3b8ef0=document[_0x5454c7(0x761)](_0x5454c7(0x6fe)),_0x2cef49=document['getElementById']('playPauseBtn');_0x3b8ef0&&_0x3b8ef0[_0x5454c7(0x421)][_0x5454c7(0x93a)](_0x5454c7(0x603),!!_0x266947);_0x2cef49&&(_0x2cef49[_0x5454c7(0x5b8)]=_0x266947?_0x5454c7(0x7e5):'<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M8\x205v14l11-7z\x22/></svg>');const _0x2036f6=_0x3b8ef0?_0x3b8ef0['querySelector'](_0x5454c7(0x470)):null;_0x2036f6&&(_0x2036f6[_0x5454c7(0x577)][_0x5454c7(0x756)]=_0x266947?'running':'paused');}function updateMusicWidgetSongInfo(_0x433ef2){const _0x18a464=_0x28e739,_0x590008=document[_0x18a464(0x761)](_0x18a464(0x282)),_0x2adb34=document[_0x18a464(0x761)](_0x18a464(0x854));if(!_0x590008||!_0x2adb34)return;if(!_0x433ef2){_0x590008[_0x18a464(0x7dc)]='',_0x2adb34[_0x18a464(0x7dc)]='',refreshMusicWidgetOverlayList(),updateMusicWidgetFloatingLyric(!![]);return;}const _0x1b94a9=String(_0x433ef2[_0x18a464(0x76a)]||_0x433ef2['title']||_0x433ef2['label']||'')['trim'](),_0xf091d7=buildSongArtistText(_0x433ef2);_0x590008['textContent']=_0x1b94a9||'\x20',_0x2adb34[_0x18a464(0x7dc)]=_0xf091d7||'\x20',refreshMusicWidgetOverlayList(),updateMusicWidgetFloatingLyric(!![]);}function bindMusicWidgetOverlayControls(){const _0x13bc69=_0x28e739,_0x21633c=document[_0x13bc69(0x761)](_0x13bc69(0x6ef));_0x21633c&&_0x21633c['dataset'][_0x13bc69(0x517)]!=='1'&&(_0x21633c[_0x13bc69(0x672)][_0x13bc69(0x517)]='1',_0x21633c[_0x13bc69(0x55d)]('click',()=>{const _0xe73de6=_0x13bc69;if(Date[_0xe73de6(0x2cb)]()<musicWidgetSuppressClickUntil)return;showMusicWidgetPlaylistList();}));}function getMusicWidgetListScrollEl(){const _0x3e684f=_0x28e739;return document[_0x3e684f(0x761)](_0x3e684f(0x7c3));}function resolveMusicWidgetPlaylistIndex(_0x411a4d){const _0x17bbb5=_0x28e739,_0x33b661=getUserPlaylistIndicesByOwner('');if(_0x33b661[_0x17bbb5(0x6ea)]===0x0)return-0x1;if(Number['isFinite'](_0x411a4d)&&_0x33b661['includes'](_0x411a4d))return _0x411a4d;if(Number[_0x17bbb5(0x795)](userPlaylistPlaybackIndex)&&_0x33b661[_0x17bbb5(0x44b)](userPlaylistPlaybackIndex))return userPlaylistPlaybackIndex;if(Number[_0x17bbb5(0x795)](userPlaylistCurrentIndex)&&_0x33b661[_0x17bbb5(0x44b)](userPlaylistCurrentIndex))return userPlaylistCurrentIndex;return _0x33b661[0x0];}function showMusicWidgetSongList(_0x28b3ed){const _0x4bb5aa=resolveMusicWidgetPlaylistIndex(_0x28b3ed);musicWidgetListMode='songs',musicWidgetListPlaylistIndex=_0x4bb5aa,renderMusicWidgetSongList(_0x4bb5aa);}function showMusicWidgetPlaylistList(){musicWidgetListMode='playlists',musicWidgetListPlaylistIndex=-0x1,renderMusicWidgetPlaylistList();}function renderMusicWidgetSongList(_0x4891d1){const _0xe8f4f1=_0x28e739,_0x58fb7d=getMusicWidgetListScrollEl();if(!_0x58fb7d)return;_0x58fb7d[_0xe8f4f1(0x5b8)]='';if(!Array['isArray'](playlists)||playlists[_0xe8f4f1(0x6ea)]===0x0){const _0x24e860=document[_0xe8f4f1(0x5e5)](_0xe8f4f1(0x6a4));_0x24e860[_0xe8f4f1(0x51f)]=_0xe8f4f1(0x44f);const _0x22e926=document[_0xe8f4f1(0x5e5)](_0xe8f4f1(0x221));_0x22e926['textContent']=_0xe8f4f1(0x2a2);const _0xa2d421=document[_0xe8f4f1(0x5e5)]('span');_0xa2d421[_0xe8f4f1(0x7dc)]='',_0x24e860['appendChild'](_0x22e926),_0x24e860[_0xe8f4f1(0x3de)](_0xa2d421),_0x58fb7d[_0xe8f4f1(0x3de)](_0x24e860);return;}const _0x2bcb20=resolveMusicWidgetPlaylistIndex(_0x4891d1);musicWidgetListPlaylistIndex=_0x2bcb20;if(_0x2bcb20<0x0||_0x2bcb20>=playlists['length']){const _0x240f5e=document['createElement']('div');_0x240f5e[_0xe8f4f1(0x51f)]=_0xe8f4f1(0x44f);const _0x60c1da=document['createElement'](_0xe8f4f1(0x221));_0x60c1da[_0xe8f4f1(0x7dc)]=_0xe8f4f1(0x508);const _0x2963ea=document[_0xe8f4f1(0x5e5)](_0xe8f4f1(0x221));_0x2963ea[_0xe8f4f1(0x7dc)]='',_0x240f5e['appendChild'](_0x60c1da),_0x240f5e[_0xe8f4f1(0x3de)](_0x2963ea),_0x58fb7d['appendChild'](_0x240f5e);return;}const _0xf2ac72=playlists[_0x2bcb20],_0x31ac2b=Array[_0xe8f4f1(0x851)](_0xf2ac72?.[_0xe8f4f1(0x646)])?_0xf2ac72['songs']:[];if(_0x31ac2b[_0xe8f4f1(0x6ea)]===0x0){const _0x15e4df=document[_0xe8f4f1(0x5e5)]('div');_0x15e4df[_0xe8f4f1(0x51f)]=_0xe8f4f1(0x44f);const _0xee8acc=document[_0xe8f4f1(0x5e5)](_0xe8f4f1(0x221));_0xee8acc[_0xe8f4f1(0x7dc)]=_0xe8f4f1(0x2a5);const _0x11ccae=document[_0xe8f4f1(0x5e5)](_0xe8f4f1(0x221));_0x11ccae[_0xe8f4f1(0x7dc)]='',_0x15e4df[_0xe8f4f1(0x3de)](_0xee8acc),_0x15e4df[_0xe8f4f1(0x3de)](_0x11ccae),_0x58fb7d[_0xe8f4f1(0x3de)](_0x15e4df);return;}_0x31ac2b[_0xe8f4f1(0x7b6)]((_0x598463,_0x3583d3)=>{const _0x2c7b5e=_0xe8f4f1,_0x33a802=document[_0x2c7b5e(0x5e5)](_0x2c7b5e(0x6a4));_0x33a802[_0x2c7b5e(0x51f)]=_0x2c7b5e(0x44f);const _0x4562b=buildUserPlaylistSongLabel(_0x598463)||String(_0x598463?.[_0x2c7b5e(0x76a)]||_0x598463?.[_0x2c7b5e(0x81a)]||_0x598463||'')[_0x2c7b5e(0x28e)]()||'Track\x20'+(_0x3583d3+0x1),_0x59862f=document[_0x2c7b5e(0x5e5)]('span');_0x59862f[_0x2c7b5e(0x7dc)]=_0x4562b;const _0x40fc98=document[_0x2c7b5e(0x5e5)](_0x2c7b5e(0x221)),_0x5bb7f3=_0x2bcb20===userPlaylistPlaybackIndex&&_0x3583d3===userPlaylistPlaybackSongIndex;_0x5bb7f3?(_0x33a802[_0x2c7b5e(0x421)][_0x2c7b5e(0x5e3)](_0x2c7b5e(0x525)),_0x40fc98['textContent']=_0x2c7b5e(0x755)):_0x40fc98[_0x2c7b5e(0x7dc)]=String(_0x3583d3+0x1)[_0x2c7b5e(0x90f)](0x2,'0'),_0x33a802[_0x2c7b5e(0x3de)](_0x59862f),_0x33a802[_0x2c7b5e(0x3de)](_0x40fc98),_0x33a802[_0x2c7b5e(0x55d)](_0x2c7b5e(0x7bd),()=>{const _0x53a99e=_0x2c7b5e;if(Date[_0x53a99e(0x2cb)]()<musicWidgetSuppressClickUntil)return;playMusicWidgetSong(_0x2bcb20,_0x3583d3);}),_0x58fb7d[_0x2c7b5e(0x3de)](_0x33a802);});}function renderMusicWidgetPlaylistList(){const _0x513413=_0x28e739,_0x3b237b=getMusicWidgetListScrollEl();if(!_0x3b237b)return;_0x3b237b[_0x513413(0x5b8)]='';if(!Array[_0x513413(0x851)](playlists)||playlists['length']===0x0){const _0x19fa3c=document[_0x513413(0x5e5)]('div');_0x19fa3c[_0x513413(0x51f)]='list-item';const _0x2c2e4d=document[_0x513413(0x5e5)]('span');_0x2c2e4d[_0x513413(0x7dc)]='暂无歌单';const _0x1d7f36=document[_0x513413(0x5e5)](_0x513413(0x221));_0x1d7f36[_0x513413(0x7dc)]='',_0x19fa3c[_0x513413(0x3de)](_0x2c2e4d),_0x19fa3c[_0x513413(0x3de)](_0x1d7f36),_0x3b237b[_0x513413(0x3de)](_0x19fa3c);return;}const _0x941f08=getUserPlaylistIndicesByOwner('');if(_0x941f08[_0x513413(0x6ea)]===0x0){const _0x100885=document[_0x513413(0x5e5)](_0x513413(0x6a4));_0x100885[_0x513413(0x51f)]='list-item';const _0x408ca3=document[_0x513413(0x5e5)](_0x513413(0x221));_0x408ca3['textContent']=_0x513413(0x748);const _0x574db6=document['createElement']('span');_0x574db6[_0x513413(0x7dc)]='',_0x100885[_0x513413(0x3de)](_0x408ca3),_0x100885[_0x513413(0x3de)](_0x574db6),_0x3b237b['appendChild'](_0x100885);return;}_0x941f08[_0x513413(0x7b6)](_0x5378fd=>{const _0x16948c=_0x513413,_0x26ce4b=playlists[_0x5378fd],_0x5aba4b=document['createElement'](_0x16948c(0x6a4));_0x5aba4b[_0x16948c(0x51f)]=_0x16948c(0x44f);const _0x1c2191=document[_0x16948c(0x5e5)](_0x16948c(0x221));_0x1c2191[_0x16948c(0x7dc)]=_0x26ce4b?.[_0x16948c(0x81a)]||_0x16948c(0x47e);const _0x29c8e6=document['createElement'](_0x16948c(0x221)),_0xbef5e4=_0x5378fd===userPlaylistPlaybackIndex;_0xbef5e4?(_0x5aba4b['classList'][_0x16948c(0x5e3)](_0x16948c(0x525)),_0x29c8e6['textContent']='Playing'):_0x29c8e6[_0x16948c(0x7dc)]='',_0x5aba4b[_0x16948c(0x3de)](_0x1c2191),_0x5aba4b[_0x16948c(0x3de)](_0x29c8e6),_0x5aba4b[_0x16948c(0x55d)](_0x16948c(0x7bd),()=>{const _0x364540=_0x16948c;if(Date[_0x364540(0x2cb)]()<musicWidgetSuppressClickUntil)return;showMusicWidgetSongList(_0x5378fd);}),_0x3b237b[_0x16948c(0x3de)](_0x5aba4b);});}async function playMusicWidgetSong(_0x39a302,_0x4ef4e1){const _0x56f9b=_0x28e739;if(!Array[_0x56f9b(0x851)](playlists)||_0x39a302<0x0||_0x39a302>=playlists[_0x56f9b(0x6ea)])return;const _0x39f779=userPlaylistPlaybackIndex;userPlaylistCurrentIndex=_0x39a302,userPlaylistPlaybackIndex=_0x39a302,userPlaylistPlaybackSongIndex=_0x4ef4e1,userPlaylistPlaybackPendingSwitch=![],persistUserPlaylistPlaybackIndex(),applyUserPlaylistPlaybackHighlight();const _0x28db27=_0x39f779!==_0x39a302?'switch_playlist':_0x56f9b(0x348),_0x45b50f=playlists[_0x39a302]?.[_0x56f9b(0x81a)]?String(playlists[_0x39a302][_0x56f9b(0x81a)]):'';await playUserPlaylistSongAtIndex(_0x4ef4e1,{'autoplay':!![],'emitSystem':!![],'systemAction':_0x28db27,'actorRole':_0x56f9b(0x8dd),'systemPlaylistTitle':_0x45b50f});}function refreshMusicWidgetOverlayList(){const _0x5d5ff9=_0x28e739,_0x42dcb5=document[_0x5d5ff9(0x761)](_0x5d5ff9(0x373));if(!_0x42dcb5||!_0x42dcb5[_0x5d5ff9(0x421)][_0x5d5ff9(0x6e3)]('show'))return;musicWidgetListMode===_0x5d5ff9(0x7e1)?renderMusicWidgetPlaylistList():renderMusicWidgetSongList(musicWidgetListPlaylistIndex);}function getMusicWidgetLyricStageEl(){return document['getElementById']('lyricBox');}function getMusicWidgetLyricStyleOverlay(){const _0x3be515=_0x28e739;return document['getElementById'](_0x3be515(0x33d));}function getMusicWidgetLyricColorPickerEl(){return document['getElementById']('musicWidgetLyricColorPicker');}function getMusicWidgetLyricColorSwatchEl(){const _0x5cce30=_0x28e739;return document[_0x5cce30(0x761)](_0x5cce30(0x82b));}function getMusicWidgetLyricColorBtnEl(){const _0x581748=_0x28e739;return document['getElementById'](_0x581748(0x77b));}function isValidMusicWidgetLyricColor(_0x59cdcc){const _0x22b5f5=_0x28e739,_0x47ac76=String(_0x59cdcc||'')[_0x22b5f5(0x28e)]();return/^#([0-9a-fA-F]{6}|[0-9a-fA-F]{3})$/[_0x22b5f5(0x5b6)](_0x47ac76);}function applyMusicWidgetLyricColor(_0x143b7b,_0xdf987a={}){const _0x1e1177=_0x28e739,{persist:persist=!![]}=_0xdf987a,_0x402bb5=String(_0x143b7b||'')[_0x1e1177(0x28e)](),_0x548dd8=isValidMusicWidgetLyricColor(_0x402bb5)?_0x402bb5:'';musicWidgetLyricColor=_0x548dd8;const _0x2e76b9=getMusicWidgetLyricStageEl();_0x2e76b9&&(_0x548dd8?_0x2e76b9[_0x1e1177(0x577)][_0x1e1177(0x4c5)](_0x1e1177(0x5af),_0x548dd8):_0x2e76b9[_0x1e1177(0x577)]['removeProperty'](_0x1e1177(0x5af)));const _0x31f967=getMusicWidgetLyricColorSwatchEl();_0x31f967&&(_0x31f967['style'][_0x1e1177(0x55f)]=_0x548dd8||_0x1e1177(0x28a));const _0x359c55=getMusicWidgetLyricColorPickerEl();_0x359c55&&_0x548dd8&&_0x359c55[_0x1e1177(0x29c)]!==_0x548dd8&&(_0x359c55[_0x1e1177(0x29c)]=_0x548dd8);if(persist)try{localStorage[_0x1e1177(0x676)](MUSIC_WIDGET_LYRIC_COLOR_KEY,_0x548dd8);}catch(_0x3c44c3){}}function loadMusicWidgetLyricColor(){const _0x31bee7=_0x28e739;if(musicWidgetLyricColorLoaded)return;musicWidgetLyricColorLoaded=!![];let _0x15d07a='';try{_0x15d07a=localStorage[_0x31bee7(0x488)](MUSIC_WIDGET_LYRIC_COLOR_KEY)||'';}catch(_0x1b6462){_0x15d07a='';}!isValidMusicWidgetLyricColor(_0x15d07a)&&(_0x15d07a='');applyMusicWidgetLyricColor(_0x15d07a,{'persist':![]});const _0x3c2095=getMusicWidgetLyricColorPickerEl();_0x3c2095&&!_0x15d07a&&(_0x3c2095[_0x31bee7(0x29c)]=_0x31bee7(0x6bf));}function initMusicWidgetLyricColorPicker(){const _0x2aa4e2=_0x28e739,_0x581ef4=getMusicWidgetLyricColorBtnEl(),_0x3dc73c=getMusicWidgetLyricColorPickerEl();if(!_0x581ef4||!_0x3dc73c)return;if(_0x581ef4[_0x2aa4e2(0x672)][_0x2aa4e2(0x517)]==='1')return;_0x581ef4[_0x2aa4e2(0x672)][_0x2aa4e2(0x517)]='1',_0x581ef4[_0x2aa4e2(0x55d)]('click',_0x17aa25=>{const _0x1ed108=_0x2aa4e2;_0x17aa25[_0x1ed108(0x442)](),_0x17aa25[_0x1ed108(0x722)](),_0x3dc73c['click']();}),_0x3dc73c[_0x2aa4e2(0x55d)](_0x2aa4e2(0x914),_0x3a9c5d=>{const _0x11cab0=_0x2aa4e2;applyMusicWidgetLyricColor(_0x3a9c5d[_0x11cab0(0x6e4)]?.['value'],{'persist':!![]});}),_0x3dc73c['addEventListener'](_0x2aa4e2(0x272),_0x518e10=>{const _0x4e4341=_0x2aa4e2;applyMusicWidgetLyricColor(_0x518e10[_0x4e4341(0x6e4)]?.[_0x4e4341(0x29c)],{'persist':!![]});}),loadMusicWidgetLyricColor();}function setMusicWidgetLyricStageVisibility(_0x380b17){const _0x4df27b=_0x28e739,_0x3944fc=getMusicWidgetLyricStageEl();if(!_0x3944fc)return;_0x3944fc['style'][_0x4df27b(0x475)]=_0x380b17?_0x4df27b(0x439):_0x4df27b(0x562),_0x3944fc[_0x4df27b(0x577)][_0x4df27b(0x3b2)]=_0x380b17?_0x4df27b(0x4e2):_0x4df27b(0x562),_0x3944fc[_0x4df27b(0x421)][_0x4df27b(0x93a)](_0x4df27b(0x1d6),!!_0x380b17),!_0x380b17&&(_0x3944fc['classList']['remove']('is-dragging'),musicWidgetLyricDragState=null);}function getMusicWidgetSkinOverlayEl(){const _0x55dfb0=_0x28e739;return document[_0x55dfb0(0x761)](_0x55dfb0(0x97f));}function getMusicWidgetOrbEl(){const _0x9be468=_0x28e739;return document[_0x9be468(0x761)]('orbitOrb');}function getMusicWidgetOrbImageEl(){const _0x620481=_0x28e739;return document['getElementById'](_0x620481(0x296));}function getMusicWidgetOrbFileInputEl(){const _0x12594d=_0x28e739;return document[_0x12594d(0x761)]('musicWidgetOrbFile');}function getMusicWidgetOrbUrlInputEl(){const _0x5bf8d6=_0x28e739;return document[_0x5bf8d6(0x761)](_0x5bf8d6(0x957));}function getMusicWidgetOrbUrlApplyBtnEl(){const _0xcde607=_0x28e739;return document[_0xcde607(0x761)](_0xcde607(0x688));}function getMusicWidgetOrbSizeInputEl(){const _0xf7c480=_0x28e739;return document['getElementById'](_0xf7c480(0x7bb));}function getMusicWidgetOrbSizeValueEl(){const _0x1f82ef=_0x28e739;return document[_0x1f82ef(0x761)](_0x1f82ef(0x73a));}function applyMusicWidgetOrbSize(_0x4d69ab,_0x64bed9={}){const _0x1dc93c=_0x28e739,{persist:persist=!![]}=_0x64bed9,_0x103e3d=Math[_0x1dc93c(0x738)](0x20,Math['min'](0x78,Number['isFinite'](_0x4d69ab)?_0x4d69ab:0x30));musicWidgetOrbSize=_0x103e3d;const _0x5f01cc=getMusicWidgetOrbEl();_0x5f01cc&&(_0x5f01cc['style'][_0x1dc93c(0x4bf)]=_0x103e3d+'px',_0x5f01cc[_0x1dc93c(0x577)][_0x1dc93c(0x5ea)]=_0x103e3d+'px',_0x5f01cc[_0x1dc93c(0x577)]['setProperty'](_0x1dc93c(0x578),_0x103e3d+'px'));const _0x121ff7=getMusicWidgetOrbSizeInputEl();if(_0x121ff7)_0x121ff7[_0x1dc93c(0x29c)]=String(_0x103e3d);const _0x522366=getMusicWidgetOrbSizeValueEl();if(_0x522366)_0x522366[_0x1dc93c(0x7dc)]=String(_0x103e3d);if(persist)try{localStorage[_0x1dc93c(0x676)](MUSIC_WIDGET_ORB_SIZE_KEY,String(_0x103e3d));}catch(_0x2f3136){}}function applyMusicWidgetOrbPosition(_0x169054,_0x51ad7d={}){const _0x291c88=_0x28e739,{persist:persist=!![]}=_0x51ad7d,_0x19a58b=document['getElementById']('musicWidgetContainer');if(!_0x19a58b||!_0x169054||!Number[_0x291c88(0x795)](_0x169054[_0x291c88(0x460)])||!Number[_0x291c88(0x795)](_0x169054[_0x291c88(0x78d)]))return;_0x19a58b[_0x291c88(0x577)][_0x291c88(0x460)]=_0x169054[_0x291c88(0x460)]+'px',_0x19a58b[_0x291c88(0x577)]['top']=_0x169054[_0x291c88(0x78d)]+'px',_0x19a58b[_0x291c88(0x577)]['right']=_0x291c88(0x4e2),_0x19a58b['style'][_0x291c88(0x5db)]='auto',_0x19a58b[_0x291c88(0x672)]['dragReady']='1';if(persist)try{localStorage[_0x291c88(0x676)](MUSIC_WIDGET_ORB_POSITION_KEY,JSON[_0x291c88(0x8f7)]({'left':_0x169054['left'],'top':_0x169054[_0x291c88(0x78d)]}));}catch(_0x31a3b7){}}function applyMusicWidgetLyricPosition(_0x3d0563,_0x104505={}){const _0x124bd2=_0x28e739,{persist:persist=!![]}=_0x104505,_0x52453d=getMusicWidgetLyricStageEl();if(!_0x52453d||!_0x3d0563||!Number[_0x124bd2(0x795)](_0x3d0563[_0x124bd2(0x78d)]))return;_0x52453d['style'][_0x124bd2(0x460)]=_0x124bd2(0x260),_0x52453d[_0x124bd2(0x577)]['top']=_0x3d0563[_0x124bd2(0x78d)]+'px',_0x52453d['style'][_0x124bd2(0x29a)]=_0x124bd2(0x4e2),_0x52453d[_0x124bd2(0x577)][_0x124bd2(0x5db)]=_0x124bd2(0x4e2),_0x52453d[_0x124bd2(0x577)]['transform']=_0x124bd2(0x512),_0x52453d[_0x124bd2(0x672)][_0x124bd2(0x254)]='1';if(persist)try{localStorage['setItem'](MUSIC_WIDGET_LYRIC_POSITION_KEY,JSON[_0x124bd2(0x8f7)]({'top':_0x3d0563[_0x124bd2(0x78d)]}));}catch(_0x14ee2a){}}function applyMusicWidgetOrbImage(_0x26cd38,_0x2e16b3={}){const _0x7bb67=_0x28e739,{persist:persist=!![]}=_0x2e16b3,_0x1f9423=String(_0x26cd38||'')['trim']();musicWidgetOrbImage=_0x1f9423;const _0x3cb06e=getMusicWidgetOrbEl(),_0x564ddf=getMusicWidgetOrbImageEl();_0x564ddf&&(_0x564ddf[_0x7bb67(0x273)]=_0x1f9423,_0x564ddf[_0x7bb67(0x577)][_0x7bb67(0x475)]=_0x1f9423?_0x7bb67(0x78e):_0x7bb67(0x562));_0x3cb06e&&_0x3cb06e['classList'][_0x7bb67(0x93a)](_0x7bb67(0x929),!!_0x1f9423);if(persist)try{localStorage[_0x7bb67(0x676)](MUSIC_WIDGET_ORB_IMAGE_KEY,_0x1f9423);}catch(_0xfafca0){}}function loadMusicWidgetOrbSkin(){const _0x2f66e1=_0x28e739;if(musicWidgetOrbSkinLoaded)return;musicWidgetOrbSkinLoaded=!![];let _0x49d028='',_0x5467da=0x30;try{_0x49d028=localStorage[_0x2f66e1(0x488)](MUSIC_WIDGET_ORB_IMAGE_KEY)||'';}catch(_0x1bed4a){_0x49d028='';}try{const _0x3156e2=Number[_0x2f66e1(0x390)](localStorage[_0x2f66e1(0x488)](MUSIC_WIDGET_ORB_SIZE_KEY),0xa);if(Number[_0x2f66e1(0x795)](_0x3156e2))_0x5467da=_0x3156e2;}catch(_0x2011bb){}applyMusicWidgetOrbSize(_0x5467da,{'persist':![]}),applyMusicWidgetOrbImage(_0x49d028,{'persist':![]});}function loadMusicWidgetPositions(){const _0x2bc85d=_0x28e739;try{const _0x3c716c=localStorage[_0x2bc85d(0x488)](MUSIC_WIDGET_ORB_POSITION_KEY);if(_0x3c716c){const _0x3ba429=JSON[_0x2bc85d(0x4de)](_0x3c716c);_0x3ba429&&Number[_0x2bc85d(0x795)](_0x3ba429['left'])&&Number['isFinite'](_0x3ba429[_0x2bc85d(0x78d)])&&applyMusicWidgetOrbPosition({'left':_0x3ba429[_0x2bc85d(0x460)],'top':_0x3ba429[_0x2bc85d(0x78d)]},{'persist':![]});}}catch(_0x1ce6c8){}try{const _0xd8d74f=localStorage[_0x2bc85d(0x488)](MUSIC_WIDGET_LYRIC_POSITION_KEY);if(_0xd8d74f){const _0xb88d2=JSON[_0x2bc85d(0x4de)](_0xd8d74f);_0xb88d2&&Number[_0x2bc85d(0x795)](_0xb88d2[_0x2bc85d(0x78d)])&&applyMusicWidgetLyricPosition({'top':_0xb88d2[_0x2bc85d(0x78d)]},{'persist':![]});}}catch(_0x5e73b2){}}function initMusicWidgetOrbSkinEditor(){const _0x2ac1a0=_0x28e739,_0x566d95=getMusicWidgetOrbFileInputEl(),_0x3a3794=getMusicWidgetOrbUrlInputEl(),_0x92ea9=getMusicWidgetOrbUrlApplyBtnEl(),_0x23e912=getMusicWidgetOrbSizeInputEl();if(!_0x566d95||!_0x3a3794||!_0x92ea9||!_0x23e912)return;if(_0x566d95['dataset'][_0x2ac1a0(0x517)]==='1')return;_0x566d95[_0x2ac1a0(0x672)]['bound']='1',_0x566d95[_0x2ac1a0(0x55d)](_0x2ac1a0(0x272),_0x53fd13=>{const _0xa5c817=_0x2ac1a0,_0x27387d=_0x53fd13['target']?.['files']?.[0x0];if(!_0x27387d)return;const _0x43c2ba=new FileReader();_0x43c2ba[_0xa5c817(0x2d9)]=()=>{const _0x30d771=_0xa5c817,_0x351491=String(_0x43c2ba[_0x30d771(0x6c4)]||'')[_0x30d771(0x28e)]();if(!_0x351491){showIslandNotification(_0x30d771(0x40e),'无法读取图片',_0x30d771(0x537));return;}applyMusicWidgetOrbImage(_0x351491,{'persist':!![]});},_0x43c2ba[_0xa5c817(0x6b0)]=()=>{const _0x25ad28=_0xa5c817;showIslandNotification(_0x25ad28(0x40e),_0x25ad28(0x566),_0x25ad28(0x537));},_0x43c2ba['readAsDataURL'](_0x27387d),_0x53fd13[_0xa5c817(0x6e4)][_0xa5c817(0x29c)]='';}),_0x92ea9['addEventListener']('click',()=>{const _0x1666ac=_0x2ac1a0,_0x33c2b3=String(_0x3a3794[_0x1666ac(0x29c)]||'')[_0x1666ac(0x28e)]();if(!_0x33c2b3){applyMusicWidgetOrbImage('',{'persist':!![]});return;}const _0x36f018=new Image();_0x36f018[_0x1666ac(0x2d9)]=()=>{applyMusicWidgetOrbImage(_0x33c2b3,{'persist':!![]});},_0x36f018[_0x1666ac(0x6b0)]=()=>{const _0x597b9d=_0x1666ac;showIslandNotification('链接不可用',_0x597b9d(0x66e),_0x597b9d(0x537));},_0x36f018[_0x1666ac(0x273)]=_0x33c2b3;}),_0x23e912[_0x2ac1a0(0x55d)](_0x2ac1a0(0x914),_0x5da6c7=>{const _0x4d8b78=_0x2ac1a0,_0x5dd8c6=Number['parseInt'](_0x5da6c7[_0x4d8b78(0x6e4)]?.[_0x4d8b78(0x29c)],0xa);applyMusicWidgetOrbSize(_0x5dd8c6,{'persist':!![]});}),loadMusicWidgetOrbSkin();}function toggleMusicWidgetSkinEditor(){const _0x1fafbc=_0x28e739;if(Date[_0x1fafbc(0x2cb)]()<musicWidgetSuppressClickUntil)return;const _0x22feb9=getMusicWidgetSkinOverlayEl();if(!_0x22feb9)return;const _0x31fc65=!_0x22feb9[_0x1fafbc(0x421)][_0x1fafbc(0x6e3)]('show');if(!_0x31fc65){_0x22feb9[_0x1fafbc(0x421)][_0x1fafbc(0x403)](_0x1fafbc(0x332));return;}const _0x13ba00=document[_0x1fafbc(0x761)](_0x1fafbc(0x373));if(_0x13ba00)_0x13ba00[_0x1fafbc(0x421)][_0x1fafbc(0x403)](_0x1fafbc(0x332));const _0x1eeddb=getMusicWidgetLyricStyleOverlay();if(_0x1eeddb)_0x1eeddb[_0x1fafbc(0x421)]['remove']('show');_0x22feb9['classList'][_0x1fafbc(0x5e3)](_0x1fafbc(0x332)),initMusicWidgetOrbSkinEditor();}function resolveMusicWidgetLyricLine(){const _0xa9ac6c=_0x28e739;if(Array[_0xa9ac6c(0x851)](userPlaylistPlaybackLyrics)&&userPlaylistPlaybackLyrics[_0xa9ac6c(0x6ea)]>0x0){const _0x2d0631=Math[_0xa9ac6c(0x738)](0x0,Math[_0xa9ac6c(0x730)](userPlaylistPlaybackLyricIndex,userPlaylistPlaybackLyrics[_0xa9ac6c(0x6ea)]-0x1)),_0xc3e611=userPlaylistPlaybackLyrics[_0x2d0631];return{'index':_0x2d0631,'text':String(_0xc3e611?.[_0xa9ac6c(0x7e6)]||'')[_0xa9ac6c(0x28e)]()||_0xa9ac6c(0x68b)};}return{'index':-0x1,'text':_0xa9ac6c(0x3e8)};}function updateMusicWidgetLyricContent(_0x55e338){const _0x48482d=_0x28e739,_0x236c28=getMusicWidgetLyricStageEl();if(!_0x236c28)return;_0x236c28[_0x48482d(0x5b8)]='';const _0x75f02f=document[_0x48482d(0x5e5)](_0x48482d(0x6a4));_0x75f02f[_0x48482d(0x51f)]=_0x48482d(0x582);if(musicWidgetLyricStyleActive===_0x48482d(0x479)){const _0x5a3f02=document[_0x48482d(0x5e5)](_0x48482d(0x221));_0x5a3f02['className']='star-icon',_0x5a3f02['textContent']='✦',_0x75f02f[_0x48482d(0x3de)](_0x5a3f02);}_0x75f02f[_0x48482d(0x3de)](document[_0x48482d(0x1d0)](_0x55e338)),_0x236c28[_0x48482d(0x3de)](_0x75f02f);}function animateMusicWidgetLyricLine(_0x4dc8d3){const _0x2f4813=_0x28e739,_0x4823ee=getMusicWidgetLyricStageEl();if(!_0x4823ee)return;_0x4823ee[_0x2f4813(0x421)]['remove']('animate'),void _0x4823ee[_0x2f4813(0x1d3)],updateMusicWidgetLyricContent(_0x4dc8d3),_0x4823ee[_0x2f4813(0x421)]['add'](_0x2f4813(0x1f5));}function updateMusicWidgetLyricStyleList(){const _0x17720c=_0x28e739,_0x2f5f7d=document[_0x17720c(0x42c)](_0x17720c(0x404));_0x2f5f7d[_0x17720c(0x7b6)](_0x4b0295=>{const _0x18ed07=_0x17720c,_0x32af04=_0x4b0295?.[_0x18ed07(0x672)]?.['style']||'';_0x4b0295[_0x18ed07(0x421)][_0x18ed07(0x93a)](_0x18ed07(0x525),_0x32af04&&_0x32af04===musicWidgetLyricStyleActive);});const _0x40fd6e=document[_0x17720c(0x761)](_0x17720c(0x46b));if(_0x40fd6e)_0x40fd6e[_0x17720c(0x421)][_0x17720c(0x93a)](_0x17720c(0x525),!!musicWidgetLyricStyleActive);}function updateMusicWidgetFloatingLyric(_0x1d5c3d=![]){const _0x2c937f=_0x28e739;if(!musicWidgetLyricStyleActive){setMusicWidgetLyricStageVisibility(![]);return;}const _0x556654=resolveMusicWidgetLyricLine();if(!_0x1d5c3d&&_0x556654[_0x2c937f(0x6c0)]===musicWidgetLyricLineIndex&&_0x556654[_0x2c937f(0x7e6)]===musicWidgetLyricLineText)return;musicWidgetLyricLineIndex=_0x556654[_0x2c937f(0x6c0)],musicWidgetLyricLineText=_0x556654['text'];const _0x4c617c=getMusicWidgetLyricStageEl();if(!_0x4c617c)return;_0x4c617c['className']=_0x2c937f(0x85f)+musicWidgetLyricStyleActive,setMusicWidgetLyricStageVisibility(!![]),animateMusicWidgetLyricLine(_0x556654['text']);}function toggleMusicWidgetLyricStyle(_0x48f71d){const _0x13483a=_0x28e739;if(Date[_0x13483a(0x2cb)]()<musicWidgetSuppressClickUntil)return;const _0x372867=getMusicWidgetLyricStageEl();if(!_0x372867)return;const _0xfd49aa=String(_0x48f71d||'')[_0x13483a(0x28e)]();if(!_0xfd49aa)return;if(musicWidgetLyricStyleActive===_0xfd49aa){musicWidgetLyricStyleActive='',musicWidgetLyricLineIndex=-0x1,musicWidgetLyricLineText='',_0x372867[_0x13483a(0x51f)]=_0x13483a(0x85f)+_0xfd49aa,_0x372867['classList'][_0x13483a(0x403)]('animate'),_0x372867['innerHTML']='<div\x20class=\x22lyric-text\x22></div>',setMusicWidgetLyricStageVisibility(![]),updateMusicWidgetLyricStyleList();return;}musicWidgetLyricStyleActive=_0xfd49aa;const _0x96c203=resolveMusicWidgetLyricLine();musicWidgetLyricLineIndex=_0x96c203[_0x13483a(0x6c0)],musicWidgetLyricLineText=_0x96c203[_0x13483a(0x7e6)],_0x372867[_0x13483a(0x51f)]=_0x13483a(0x85f)+_0xfd49aa,setMusicWidgetLyricStageVisibility(!![]),animateMusicWidgetLyricLine(_0x96c203[_0x13483a(0x7e6)]),updateMusicWidgetLyricStyleList();}function initMusicWidgetDrag(_0x4ca9f6,_0x77297){const _0x5881d2=_0x28e739;if(!_0x4ca9f6||!_0x77297)return;const _0x514100=_0x2bb377=>{const _0x45ff94=_0xc1ca;if(_0x2bb377['button']!==undefined&&_0x2bb377['button']!==0x0)return;_0x2bb377['preventDefault']();const _0x24c7ca=_0x4ca9f6[_0x45ff94(0x627)]();_0x4ca9f6[_0x45ff94(0x672)][_0x45ff94(0x254)]!=='1'&&(_0x4ca9f6['style'][_0x45ff94(0x460)]=_0x24c7ca[_0x45ff94(0x460)]+'px',_0x4ca9f6['style'][_0x45ff94(0x78d)]=_0x24c7ca[_0x45ff94(0x78d)]+'px',_0x4ca9f6[_0x45ff94(0x577)][_0x45ff94(0x29a)]='auto',_0x4ca9f6[_0x45ff94(0x577)]['bottom']=_0x45ff94(0x4e2),_0x4ca9f6[_0x45ff94(0x672)][_0x45ff94(0x254)]='1');musicWidgetDragState={'pointerId':_0x2bb377['pointerId'],'offsetX':_0x2bb377[_0x45ff94(0x6b3)]-_0x24c7ca['left'],'offsetY':_0x2bb377[_0x45ff94(0x8f2)]-_0x24c7ca[_0x45ff94(0x78d)],'width':_0x24c7ca[_0x45ff94(0x4bf)],'height':_0x24c7ca['height'],'startX':_0x2bb377[_0x45ff94(0x6b3)],'startY':_0x2bb377[_0x45ff94(0x8f2)],'moved':![]};try{_0x77297[_0x45ff94(0x236)](_0x2bb377[_0x45ff94(0x207)]);}catch(_0x297f74){}},_0x452558=_0x3dae58=>{const _0x1a4243=_0xc1ca;if(!musicWidgetDragState)return;if(musicWidgetDragState['pointerId']!==undefined&&_0x3dae58[_0x1a4243(0x207)]!==musicWidgetDragState['pointerId'])return;const _0xea8062=_0x3dae58['clientX']-musicWidgetDragState['startX'],_0x3d96e4=_0x3dae58['clientY']-musicWidgetDragState[_0x1a4243(0x5e1)];!musicWidgetDragState['moved']&&Math['hypot'](_0xea8062,_0x3d96e4)>0x3&&(musicWidgetDragState['moved']=!![]);if(!musicWidgetDragState[_0x1a4243(0x1ec)])return;const _0x5d0a08=_0x3dae58[_0x1a4243(0x6b3)]-musicWidgetDragState[_0x1a4243(0x313)],_0x2720fe=_0x3dae58[_0x1a4243(0x8f2)]-musicWidgetDragState[_0x1a4243(0x25c)],_0x22e400=window[_0x1a4243(0x824)]-musicWidgetDragState['width'],_0x8c28a5=window['innerHeight']-musicWidgetDragState[_0x1a4243(0x5ea)],_0x3939a9=Math[_0x1a4243(0x730)](Math[_0x1a4243(0x738)](0x0,_0x5d0a08),Math[_0x1a4243(0x738)](0x0,_0x22e400)),_0x2808ed=Math[_0x1a4243(0x730)](Math[_0x1a4243(0x738)](0x0,_0x2720fe),Math[_0x1a4243(0x738)](0x0,_0x8c28a5));_0x4ca9f6[_0x1a4243(0x577)][_0x1a4243(0x460)]=_0x3939a9+'px',_0x4ca9f6['style'][_0x1a4243(0x78d)]=_0x2808ed+'px';},_0x4fc008=_0xbfb871=>{const _0x5e4406=_0xc1ca;if(!musicWidgetDragState)return;if(musicWidgetDragState['pointerId']!==undefined&&_0xbfb871[_0x5e4406(0x207)]!==musicWidgetDragState['pointerId'])return;if(musicWidgetDragState[_0x5e4406(0x1ec)]){musicWidgetSuppressClickUntil=Date[_0x5e4406(0x2cb)]()+0xfa;const _0x4d851a=_0x4ca9f6[_0x5e4406(0x627)]();applyMusicWidgetOrbPosition({'left':_0x4d851a['left'],'top':_0x4d851a[_0x5e4406(0x78d)]},{'persist':!![]});}try{_0x77297['releasePointerCapture'](_0xbfb871[_0x5e4406(0x207)]);}catch(_0x773c23){}musicWidgetDragState=null;};_0x77297[_0x5881d2(0x55d)](_0x5881d2(0x637),_0x514100),window[_0x5881d2(0x55d)]('pointermove',_0x452558),window['addEventListener'](_0x5881d2(0x19f),_0x4fc008),window['addEventListener'](_0x5881d2(0x24e),_0x4fc008);}function initMusicWidgetLyricDrag(_0x22a4e9){const _0x2165f9=_0x28e739;if(!_0x22a4e9||_0x22a4e9[_0x2165f9(0x672)][_0x2165f9(0x38a)]==='1')return;_0x22a4e9[_0x2165f9(0x672)][_0x2165f9(0x38a)]='1';const _0x4cbacb=_0x53e813=>{const _0x2956f2=_0x2165f9;if(_0x53e813[_0x2956f2(0x52d)]!==undefined&&_0x53e813[_0x2956f2(0x52d)]!==0x0)return;if(!musicWidgetLyricStyleActive)return;_0x53e813['preventDefault']();const _0x27fab3=_0x22a4e9[_0x2956f2(0x627)]();_0x22a4e9['dataset'][_0x2956f2(0x254)]!=='1'&&(_0x22a4e9[_0x2956f2(0x577)][_0x2956f2(0x460)]=_0x2956f2(0x260),_0x22a4e9[_0x2956f2(0x577)][_0x2956f2(0x78d)]=_0x27fab3[_0x2956f2(0x78d)]+'px',_0x22a4e9['style'][_0x2956f2(0x29a)]=_0x2956f2(0x4e2),_0x22a4e9[_0x2956f2(0x577)][_0x2956f2(0x5db)]=_0x2956f2(0x4e2),_0x22a4e9[_0x2956f2(0x577)][_0x2956f2(0x8ed)]=_0x2956f2(0x512),_0x22a4e9[_0x2956f2(0x672)][_0x2956f2(0x254)]='1');musicWidgetLyricDragState={'pointerId':_0x53e813['pointerId'],'offsetY':_0x53e813[_0x2956f2(0x8f2)]-_0x27fab3['top'],'height':_0x27fab3[_0x2956f2(0x5ea)],'startY':_0x53e813[_0x2956f2(0x8f2)],'moved':![]},_0x22a4e9[_0x2956f2(0x421)]['add'](_0x2956f2(0x1be));try{_0x22a4e9['setPointerCapture'](_0x53e813[_0x2956f2(0x207)]);}catch(_0xd7d955){}},_0x3e6e65=_0x25b5a4=>{const _0x194b4a=_0x2165f9;if(!musicWidgetLyricDragState)return;if(musicWidgetLyricDragState[_0x194b4a(0x207)]!==undefined&&_0x25b5a4[_0x194b4a(0x207)]!==musicWidgetLyricDragState[_0x194b4a(0x207)])return;const _0x414941=_0x25b5a4[_0x194b4a(0x8f2)]-musicWidgetLyricDragState[_0x194b4a(0x5e1)];!musicWidgetLyricDragState[_0x194b4a(0x1ec)]&&Math[_0x194b4a(0x268)](_0x414941)>0x3&&(musicWidgetLyricDragState[_0x194b4a(0x1ec)]=!![]);if(!musicWidgetLyricDragState[_0x194b4a(0x1ec)])return;const _0x5e8a90=_0x25b5a4[_0x194b4a(0x8f2)]-musicWidgetLyricDragState[_0x194b4a(0x25c)],_0xf80d95=window[_0x194b4a(0x70a)]-musicWidgetLyricDragState[_0x194b4a(0x5ea)],_0x1a403b=Math[_0x194b4a(0x730)](Math[_0x194b4a(0x738)](0x0,_0x5e8a90),Math[_0x194b4a(0x738)](0x0,_0xf80d95));_0x22a4e9[_0x194b4a(0x577)][_0x194b4a(0x78d)]=_0x1a403b+'px';},_0x113da6=_0x4ba9ea=>{const _0x1fb366=_0x2165f9;if(!musicWidgetLyricDragState)return;if(musicWidgetLyricDragState[_0x1fb366(0x207)]!==undefined&&_0x4ba9ea[_0x1fb366(0x207)]!==musicWidgetLyricDragState[_0x1fb366(0x207)])return;if(musicWidgetLyricDragState[_0x1fb366(0x1ec)]){musicWidgetSuppressClickUntil=Date[_0x1fb366(0x2cb)]()+0xfa;const _0x347598=_0x22a4e9[_0x1fb366(0x627)]();applyMusicWidgetLyricPosition({'top':_0x347598[_0x1fb366(0x78d)]},{'persist':!![]});}_0x22a4e9['classList'][_0x1fb366(0x403)](_0x1fb366(0x1be));try{_0x22a4e9[_0x1fb366(0x606)](_0x4ba9ea[_0x1fb366(0x207)]);}catch(_0x1dcf98){}musicWidgetLyricDragState=null;};_0x22a4e9[_0x2165f9(0x55d)]('pointerdown',_0x4cbacb),window[_0x2165f9(0x55d)](_0x2165f9(0x1d5),_0x3e6e65),window[_0x2165f9(0x55d)]('pointerup',_0x113da6),window['addEventListener']('pointercancel',_0x113da6);}function togglePanel(){const _0x320bae=_0x28e739;if(Date[_0x320bae(0x2cb)]()<musicWidgetSuppressClickUntil)return;const _0x379645=document['getElementById']('controlPanel'),_0x329c12=document['getElementById'](_0x320bae(0x6fe));if(!_0x379645||!_0x329c12)return;const _0x348a53=_0x379645[_0x320bae(0x421)][_0x320bae(0x93a)](_0x320bae(0x63d));_0x329c12[_0x320bae(0x421)][_0x320bae(0x93a)]('expanded',_0x348a53);if(!_0x348a53){const _0x4e6b12=document['getElementById']('playlistOverlay');if(_0x4e6b12)_0x4e6b12['classList']['remove'](_0x320bae(0x332));const _0x2346b9=getMusicWidgetLyricStyleOverlay();if(_0x2346b9)_0x2346b9[_0x320bae(0x421)][_0x320bae(0x403)](_0x320bae(0x332));const _0x5698c9=getMusicWidgetSkinOverlayEl();if(_0x5698c9)_0x5698c9[_0x320bae(0x421)]['remove'](_0x320bae(0x332));}}function togglePlay(){const _0x53798b=_0x28e739;if(Date[_0x53798b(0x2cb)]()<musicWidgetSuppressClickUntil)return;toggleUserPlaylistPlayback({'actorRole':'user'});}function musicWidgetPrevSong(){const _0x2ccac7=_0x28e739;if(Date['now']()<musicWidgetSuppressClickUntil)return;playUserPlaylistPrevSong({'emitSystem':!![],'actorRole':_0x2ccac7(0x8dd),'systemAction':_0x2ccac7(0x95d)});}function musicWidgetNextSong(){const _0x3e34ec=_0x28e739;if(Date['now']()<musicWidgetSuppressClickUntil)return;playUserPlaylistNextSong({'emitSystem':!![],'actorRole':_0x3e34ec(0x8dd),'systemAction':_0x3e34ec(0x6f7)});}async function togglePlaylist(){const _0x2fcb67=_0x28e739;if(Date[_0x2fcb67(0x2cb)]()<musicWidgetSuppressClickUntil)return;const _0x231fef=document['getElementById']('playlistOverlay');if(!_0x231fef)return;const _0x5f3b87=!_0x231fef[_0x2fcb67(0x421)][_0x2fcb67(0x6e3)](_0x2fcb67(0x332));if(!_0x5f3b87){_0x231fef[_0x2fcb67(0x421)][_0x2fcb67(0x403)](_0x2fcb67(0x332));return;}try{await loadUserPlaylistData();}catch(_0x30f0da){}const _0xe11b52=getMusicWidgetLyricStyleOverlay();if(_0xe11b52)_0xe11b52['classList'][_0x2fcb67(0x403)]('show');const _0x170456=getMusicWidgetSkinOverlayEl();if(_0x170456)_0x170456[_0x2fcb67(0x421)]['remove'](_0x2fcb67(0x332));_0x231fef['classList'][_0x2fcb67(0x5e3)]('show'),showMusicWidgetSongList(userPlaylistPlaybackIndex);}function toggleLyrics(){const _0x3666db=_0x28e739;if(Date[_0x3666db(0x2cb)]()<musicWidgetSuppressClickUntil)return;const _0x33615c=getMusicWidgetLyricStyleOverlay();if(!_0x33615c)return;const _0x3903dc=!_0x33615c['classList']['contains'](_0x3666db(0x332));if(!_0x3903dc){_0x33615c[_0x3666db(0x421)][_0x3666db(0x403)](_0x3666db(0x332));return;}const _0x3ca707=document[_0x3666db(0x761)]('playlistOverlay');if(_0x3ca707)_0x3ca707[_0x3666db(0x421)]['remove'](_0x3666db(0x332));const _0x529faa=getMusicWidgetSkinOverlayEl();if(_0x529faa)_0x529faa['classList'][_0x3666db(0x403)](_0x3666db(0x332));_0x33615c[_0x3666db(0x421)]['add'](_0x3666db(0x332)),updateMusicWidgetLyricStyleList();}function shutdownMusicWidgetUI(){const _0x4784ad=_0x28e739,_0x58d5b3=document[_0x4784ad(0x761)](_0x4784ad(0x54b));_0x58d5b3&&(_0x58d5b3[_0x4784ad(0x577)][_0x4784ad(0x475)]=_0x4784ad(0x562),_0x58d5b3[_0x4784ad(0x577)]['visibility']=_0x4784ad(0x48b),_0x58d5b3[_0x4784ad(0x577)]['pointerEvents']='none');const _0x3fe436=getMusicWidgetLyricStyleOverlay();if(_0x3fe436)_0x3fe436['classList']['remove']('show');const _0x888a02=document['getElementById']('playlistOverlay');if(_0x888a02)_0x888a02['classList']['remove']('show');const _0x2ecfcf=getMusicWidgetSkinOverlayEl();if(_0x2ecfcf)_0x2ecfcf[_0x4784ad(0x421)][_0x4784ad(0x403)](_0x4784ad(0x332));const _0x4a9d5f=getMusicWidgetLyricStageEl();_0x4a9d5f&&(_0x4a9d5f[_0x4784ad(0x51f)]='lyric-stage\x20style-orbit',_0x4a9d5f[_0x4784ad(0x421)][_0x4784ad(0x403)]('animate'),_0x4a9d5f[_0x4784ad(0x5b8)]=_0x4784ad(0x53d)),setMusicWidgetLyricStageVisibility(![]),updateMusicWidgetLyricStyleList(),updateMusicWidgetVisibility(![]);}async function confirmExit(){const _0x3e0fb7=_0x28e739;Date['now']()<musicWidgetSuppressClickUntil&&(musicWidgetSuppressClickUntil=0x0);const _0x37ba73=normalizeId(currentChatId||window[_0x3e0fb7(0x29e)]||'');let _0x24d83a=null;if(_0x37ba73&&db?.[_0x3e0fb7(0x183)])try{_0x24d83a=await db['chats'][_0x3e0fb7(0x309)](_0x37ba73);}catch(_0x4806a4){_0x24d83a=null;}const _0x4879a8=_0x24d83a?getActiveTogetherInviteContext(_0x24d83a):null;if(_0x4879a8){const _0x11a364=String(_0x4879a8[_0x3e0fb7(0x918)]?.[_0x3e0fb7(0x432)]?.['initiatorRole']||'')[_0x3e0fb7(0x28e)]()[_0x3e0fb7(0x6eb)]();await exitTogetherListeningForChat(_0x24d83a,{'renderToUI':!![]});_0x11a364===_0x3e0fb7(0x887)&&(musicWidgetForceHidden=!![],musicWidgetLyricStyleActive='',musicWidgetLyricLineIndex=-0x1,musicWidgetLyricLineText='',stopUserPlaylistPlayback({'reset':!![],'force':!![]}),shutdownMusicWidgetUI());return;}musicWidgetForceHidden=!![],musicWidgetLyricStyleActive='',musicWidgetLyricLineIndex=-0x1,musicWidgetLyricLineText='',stopUserPlaylistPlayback({'reset':!![],'force':!![]}),shutdownMusicWidgetUI();}function bindUserPlaylistPlayerControls(){const _0x3f7ea2=_0x28e739;if(userPlaylistPlayerControlsBound)return;const _0x4b7842=document[_0x3f7ea2(0x761)](_0x3f7ea2(0x4f1)),_0x13e151=document[_0x3f7ea2(0x761)](_0x3f7ea2(0x3b5)),_0x54bdb5=document[_0x3f7ea2(0x761)](_0x3f7ea2(0x2dd));if(!_0x4b7842||!_0x13e151||!_0x54bdb5)return;initMusicWidgetUI(),_0x4b7842[_0x3f7ea2(0x55d)]('click',()=>toggleUserPlaylistPlayback({'actorRole':'user'})),_0x13e151['addEventListener']('click',()=>playUserPlaylistPrevSong({'emitSystem':!![],'actorRole':_0x3f7ea2(0x8dd),'systemAction':'prev'})),_0x54bdb5['addEventListener']('click',()=>playUserPlaylistNextSong({'emitSystem':!![],'actorRole':_0x3f7ea2(0x8dd),'systemAction':'next'})),userPlaylistPlayerControlsBound=!![];}function toggleUserPlaylistPlayback(_0x4931c1={}){const _0x1ae954=_0x28e739;userPlaylistPlaybackForceStop=![];if(!Array[_0x1ae954(0x851)](playlists)||playlists[_0x1ae954(0x6ea)]===0x0||userPlaylistPlaybackIndex<0x0){showIslandNotification(_0x1ae954(0x513),'请先选择一个歌单用于循环播放',_0x1ae954(0x537));return;}refreshUserPlaylistPlaybackSongList();if(userPlaylistPlaybackSongList['length']===0x0){showIslandNotification('暂无歌曲',_0x1ae954(0x938),_0x1ae954(0x537));return;}const _0x50515a=ensureUserPlaylistAudio(),_0xce0ef9=_0x4931c1[_0x1ae954(0x952)]===_0x1ae954(0x887)?'character':'user';if(userPlaylistPlaybackIsPlaying){_0x50515a[_0x1ae954(0x8ec)](),void addTogetherMusicSystemMessageForActiveChat({'chat':_0x4931c1[_0x1ae954(0x864)],'action':_0x1ae954(0x8ec),'actorRole':_0xce0ef9,'actorName':_0x4931c1[_0x1ae954(0x1f6)]});return;}if(hasUserPlaylistAudioSource()){_0x50515a[_0x1ae954(0x54d)]()['then'](()=>{const _0x33385a=_0x1ae954;void addTogetherMusicSystemMessageForActiveChat({'chat':_0x4931c1[_0x33385a(0x864)],'action':'play','actorRole':_0xce0ef9,'actorName':_0x4931c1[_0x33385a(0x1f6)]});})[_0x1ae954(0x679)](()=>{const _0x5ef77c=_0x1ae954;showIslandNotification(_0x5ef77c(0x28c),_0x5ef77c(0x2b7),_0x5ef77c(0x537)),updateUserPlaylistPlayButton(![]);});return;}playUserPlaylistSongAtIndex(userPlaylistPlaybackSongIndex,{'autoplay':!![],'emitSystem':!![],'systemAction':_0x1ae954(0x54d),'actorRole':_0xce0ef9,'chat':_0x4931c1[_0x1ae954(0x864)],'actorName':_0x4931c1[_0x1ae954(0x1f6)]});}function stopUserPlaylistPlayback(_0x397216={}){const _0x2b73de=_0x28e739,{reset:reset=![],force:force=![]}=_0x397216;force&&(userPlaylistPlaybackForceStop=!![],userPlaylistPlaybackRequestToken+=0x1);if(userPlaylistPlaybackAudio){userPlaylistPlaybackAudio[_0x2b73de(0x8ec)]();if(reset){userPlaylistPlaybackAudio[_0x2b73de(0x497)]=0x0;try{userPlaylistPlaybackAudio[_0x2b73de(0x204)](_0x2b73de(0x273));}catch(_0x53e202){}userPlaylistPlaybackAudio['src']='',userPlaylistPlaybackAudio['__ovoPlaylistId']='',userPlaylistPlaybackAudio[_0x2b73de(0x7cf)]='',userPlaylistPlaybackAudio[_0x2b73de(0x3ec)]=null,userPlaylistPlaybackAudio['__ovoRetryCount']=0x0;try{userPlaylistPlaybackAudio[_0x2b73de(0x49f)]();}catch(_0x32fed4){}}}userPlaylistPlaybackIsPlaying=![],updateUserPlaylistPlayButton(![]),reset&&(updateUserPlaylistProgress(0x0,0x0),updateUserPlaylistSongTitle(''),updateMusicWidgetSongInfo(null),renderUserPlaylistLyrics([]),userPlaylistPlaybackLyrics=[],userPlaylistPlaybackLyricIndex=0x0,userPlaylistPlaybackPendingSwitch=![],userPlaylistPlaybackNowPlaying=null);}function refreshUserPlaylistPlaybackSongList(){const _0x353326=_0x28e739,_0xba2a9=playlists[userPlaylistPlaybackIndex];if(!_0xba2a9||!Array[_0x353326(0x851)](_0xba2a9['songs'])){userPlaylistPlaybackSongList=[];return;}userPlaylistPlaybackSongList=_0xba2a9[_0x353326(0x646)][_0x353326(0x962)](_0x47292c=>normalizeUserPlaylistPlaybackSong(_0x47292c))[_0x353326(0x911)](_0x49c32e=>_0x49c32e&&_0x49c32e['id']),userPlaylistPlaybackSongIndex>=userPlaylistPlaybackSongList[_0x353326(0x6ea)]&&(userPlaylistPlaybackSongIndex=0x0);}function normalizeUserPlaylistPlaybackSong(_0x2c0473){const _0x1c5381=_0x28e739;if(typeof _0x2c0473==='string')return{'name':_0x2c0473,'id':'','artist':[],'album':'','source':USER_PLAYLIST_DEFAULT_SONG_SOURCE};if(_0x2c0473&&typeof _0x2c0473===_0x1c5381(0x1f7))return{'name':_0x2c0473[_0x1c5381(0x76a)]||_0x2c0473[_0x1c5381(0x81a)]||_0x2c0473[_0x1c5381(0x880)]||_0x1c5381(0x47e),'id':String(_0x2c0473['id']||'')[_0x1c5381(0x28e)](),'artist':Array['isArray'](_0x2c0473[_0x1c5381(0x52a)])?_0x2c0473['artist']:[],'album':_0x2c0473[_0x1c5381(0x5a6)]||'','source':_0x2c0473[_0x1c5381(0x44c)]||USER_PLAYLIST_DEFAULT_SONG_SOURCE};return null;}function playUserPlaylistNextSong(_0x311d1f={}){const _0x51883e=_0x28e739;refreshUserPlaylistPlaybackSongList();if(userPlaylistPlaybackSongList[_0x51883e(0x6ea)]===0x0){userPlaylistPlaybackPendingSwitch=![];return;}const _0x1bf4f7=_0x311d1f[_0x51883e(0x8d3)]===!![],_0x57bf5e=_0x311d1f[_0x51883e(0x952)]===_0x51883e(0x887)?_0x51883e(0x887):_0x51883e(0x8dd),_0x241917=String(_0x311d1f[_0x51883e(0x97e)]||_0x51883e(0x6f7))[_0x51883e(0x28e)]()[_0x51883e(0x6eb)]()||_0x51883e(0x6f7),_0x4736af=_0x311d1f[_0x51883e(0x864)]||null,_0x26ef8a=String(_0x311d1f[_0x51883e(0x5ca)]||'')[_0x51883e(0x28e)]();if(userPlaylistPlaybackPendingSwitch){playUserPlaylistSongAtIndex(0x0,{'autoplay':!![],'emitSystem':_0x1bf4f7,'systemAction':_0x241917,'actorRole':_0x57bf5e,'chat':_0x4736af,'systemPlaylistTitle':_0x26ef8a});return;}playUserPlaylistSongAtIndex(userPlaylistPlaybackSongIndex+0x1,{'autoplay':!![],'emitSystem':_0x1bf4f7,'systemAction':_0x241917,'actorRole':_0x57bf5e,'chat':_0x4736af,'systemPlaylistTitle':_0x26ef8a});}function playUserPlaylistPrevSong(_0x46728f={}){const _0x172492=_0x28e739;refreshUserPlaylistPlaybackSongList();if(userPlaylistPlaybackSongList[_0x172492(0x6ea)]===0x0){userPlaylistPlaybackPendingSwitch=![];return;}const _0x1e1d0e=_0x46728f[_0x172492(0x8d3)]===!![],_0x2acf48=_0x46728f[_0x172492(0x952)]==='character'?_0x172492(0x887):_0x172492(0x8dd),_0x406f54=String(_0x46728f[_0x172492(0x97e)]||_0x172492(0x95d))['trim']()[_0x172492(0x6eb)]()||_0x172492(0x95d),_0x2d1bb4=_0x46728f['chat']||null,_0x1d319a=String(_0x46728f[_0x172492(0x5ca)]||'')[_0x172492(0x28e)]();if(userPlaylistPlaybackPendingSwitch){playUserPlaylistSongAtIndex(0x0,{'autoplay':!![],'emitSystem':_0x1e1d0e,'systemAction':_0x406f54,'actorRole':_0x2acf48,'chat':_0x2d1bb4,'systemPlaylistTitle':_0x1d319a});return;}playUserPlaylistSongAtIndex(userPlaylistPlaybackSongIndex-0x1,{'autoplay':!![],'emitSystem':_0x1e1d0e,'systemAction':_0x406f54,'actorRole':_0x2acf48,'chat':_0x2d1bb4,'systemPlaylistTitle':_0x1d319a});}async function playUserPlaylistSongAtIndex(_0x533838,_0xb922a2={}){const _0x403486=_0x28e739;userPlaylistPlaybackForceStop=![],refreshUserPlaylistPlaybackSongList();if(userPlaylistPlaybackSongList[_0x403486(0x6ea)]===0x0)return;const _0x58ec12=userPlaylistPlaybackSongList['length'],_0x16e37f=(_0x533838%_0x58ec12+_0x58ec12)%_0x58ec12,_0x5927b2=userPlaylistPlaybackSongList[_0x16e37f];if(!_0x5927b2||!_0x5927b2['id']){showIslandNotification(_0x403486(0x28c),_0x403486(0x1e2),_0x403486(0x537));return;}userPlaylistPlaybackSongIndex=_0x16e37f,userPlaylistPlaybackPendingSwitch=![],userPlaylistPlaybackNowPlaying={'name':_0x5927b2[_0x403486(0x76a)]||'','id':_0x5927b2['id']||'','artist':Array[_0x403486(0x851)](_0x5927b2[_0x403486(0x52a)])?_0x5927b2[_0x403486(0x52a)]:[],'album':_0x5927b2['album']||'','source':_0x5927b2[_0x403486(0x44c)]||USER_PLAYLIST_DEFAULT_SONG_SOURCE};const _0x49b12e=++userPlaylistPlaybackRequestToken,_0x71e7c4=buildUserPlaylistSongLabel(_0x5927b2);updateUserPlaylistSongTitle(_0x71e7c4),updateMusicWidgetSongInfo(userPlaylistPlaybackNowPlaying),updateUserPlaylistPlayButton(!![]);try{const _0x471ca9=Array['isArray'](playlists)&&userPlaylistPlaybackIndex>=0x0?playlists[userPlaylistPlaybackIndex]:null,_0x1ee1a7=String(_0x471ca9?.['id']||'')[_0x403486(0x28e)](),_0x154388=buildUserPlaylistSongKey(_0x5927b2),_0x1895ad=await fetchUserPlaylistAudioUrl(_0x5927b2,{'playlistId':_0x1ee1a7});let _0x359d2d=[];try{_0x359d2d=await fetchUserPlaylistLyrics(_0x5927b2,{'playlistId':_0x1ee1a7});}catch(_0x245389){_0x359d2d=[];}if(_0x49b12e!==userPlaylistPlaybackRequestToken)return;const _0x222d07=ensureUserPlaylistAudio();_0x222d07[_0x403486(0x273)]=_0x1895ad;try{_0x222d07[_0x403486(0x1d9)](_0x403486(0x273),_0x1895ad);}catch(_0x2d51fc){}_0x154388&&(_0x222d07[_0x403486(0x798)]=_0x1ee1a7,_0x222d07[_0x403486(0x7cf)]=_0x154388,_0x222d07[_0x403486(0x3ec)]=_0x49b12e,_0x222d07[_0x403486(0x62d)]=0x0);_0x222d07[_0x403486(0x497)]=0x0,renderUserPlaylistLyrics(_0x359d2d),userPlaylistPlaybackLyrics=Array['isArray'](_0x359d2d)?_0x359d2d:[],userPlaylistPlaybackLyricIndex=0x0,updateUserPlaylistLyricHighlight(0x0,!![]);const _0x11194a=Number(_0xb922a2[_0x403486(0x2f0)]),_0x48a48b=Number(_0xb922a2[_0x403486(0x4c9)]);if(Number['isFinite'](_0x11194a)&&_0x11194a>0x0||Number[_0x403486(0x795)](_0x48a48b)&&_0x48a48b>0x0){const _0x3fc9e1=()=>{const _0x4a805a=_0x403486,_0x1c8b4b=Number[_0x4a805a(0x795)](_0x222d07[_0x4a805a(0x195)])?_0x222d07[_0x4a805a(0x195)]:0x0;if(_0x1c8b4b<=0x0)return;const _0x58128f=_0x1c8b4b>0x2?_0x1c8b4b-0x2:0x0,_0x4830fa=Number['isFinite'](_0x48a48b)?Math['max'](0x0,Math['min'](0x1,_0x48a48b)):0x0,_0x3a88a4=_0x4830fa>0x0?_0x1c8b4b*_0x4830fa:_0x11194a,_0x2ccc0c=Math['max'](0x0,Math[_0x4a805a(0x730)](_0x3a88a4,_0x58128f||_0x3a88a4));_0x2ccc0c>0x0&&(_0x222d07[_0x4a805a(0x497)]=_0x2ccc0c);};_0x222d07[_0x403486(0x1c4)]>=0x1&&Number[_0x403486(0x795)](_0x222d07[_0x403486(0x195)])&&_0x222d07[_0x403486(0x195)]>0x0?_0x3fc9e1():_0x222d07['addEventListener'](_0x403486(0x970),_0x3fc9e1,{'once':!![]});}if(_0xb922a2['autoplay']!==![]){await _0x222d07['play'](),userPlaylistPlaybackIsPlaying=!![],updateUserPlaylistPlayButton(!![]);if(_0xb922a2[_0x403486(0x8d3)]===!![]){const _0x4086ca=String(_0xb922a2[_0x403486(0x97e)]||'')[_0x403486(0x28e)]()[_0x403486(0x6eb)]()||_0x403486(0x348),_0xc1be42=String(_0xb922a2[_0x403486(0x5ca)]||'')[_0x403486(0x28e)]()||(_0x471ca9?.['title']?String(_0x471ca9[_0x403486(0x81a)]):'');void addTogetherMusicSystemMessageForActiveChat({'chat':_0xb922a2['chat'],'action':_0x4086ca,'actorRole':_0xb922a2[_0x403486(0x952)],'actorName':_0xb922a2[_0x403486(0x1f6)],'playlistTitle':_0xc1be42,'songLabel':_0x71e7c4});}}else userPlaylistPlaybackIsPlaying=![],updateUserPlaylistPlayButton(![]);}catch(_0xcbb957){if(_0x49b12e!==userPlaylistPlaybackRequestToken)return;console['error']('Playback\x20failed:',_0xcbb957),showIslandNotification(_0x403486(0x28c),_0x403486(0x4ae),_0x403486(0x537)),userPlaylistPlaybackIsPlaying=![],updateUserPlaylistPlayButton(![]);}}function ensureUserPlaylistAudio(){const _0x99b9c2=_0x28e739;if(userPlaylistPlaybackAudio)return userPlaylistPlaybackAudio;const _0x3a174b=new Audio();return _0x3a174b[_0x99b9c2(0x5ee)]=_0x99b9c2(0x4e2),_0x3a174b[_0x99b9c2(0x739)]=userPlaylistVolume,_0x3a174b[_0x99b9c2(0x55d)](_0x99b9c2(0x735),()=>{const _0x38c7df=_0x99b9c2;if(!Number['isFinite'](_0x3a174b[_0x38c7df(0x497)]))return;updateUserPlaylistProgress(_0x3a174b[_0x38c7df(0x497)],_0x3a174b['duration']),syncUserPlaylistLyricsByTime(_0x3a174b[_0x38c7df(0x497)]);}),_0x3a174b[_0x99b9c2(0x55d)]('loadedmetadata',()=>{const _0x5b9c52=_0x99b9c2;updateUserPlaylistProgress(0x0,_0x3a174b[_0x5b9c52(0x195)]);}),_0x3a174b[_0x99b9c2(0x55d)](_0x99b9c2(0x262),()=>{if(userPlaylistPlaybackForceStop)return;playUserPlaylistNextSong({'emitSystem':![]});}),_0x3a174b['addEventListener'](_0x99b9c2(0x54d),()=>{userPlaylistPlaybackIsPlaying=!![],updateUserPlaylistPlayButton(!![]);}),_0x3a174b[_0x99b9c2(0x55d)](_0x99b9c2(0x8ec),()=>{userPlaylistPlaybackIsPlaying=![],updateUserPlaylistPlayButton(![]);}),_0x3a174b[_0x99b9c2(0x55d)](_0x99b9c2(0x56c),()=>{const _0x41121b=_0x99b9c2;userPlaylistPlaybackIsPlaying=![],updateUserPlaylistPlayButton(![]);if(userPlaylistPlaybackForceStop)return;const _0x3d8252=String(_0x3a174b['__ovoPlaylistId']||'')['trim'](),_0xae6b6c=String(_0x3a174b[_0x41121b(0x7cf)]||'')[_0x41121b(0x28e)](),_0x3a9240=_0x3a174b['__ovoRetryToken'],_0x20861f=Number(_0x3a174b[_0x41121b(0x62d)]||0x0);if(_0x3d8252&&_0xae6b6c&&_0x20861f<0x1&&_0x3a9240===userPlaylistPlaybackRequestToken){_0x3a174b[_0x41121b(0x62d)]=_0x20861f+0x1,void((async()=>{await invalidateUserPlaylistAudioCache(_0x3d8252,_0xae6b6c),await playUserPlaylistSongAtIndex(userPlaylistPlaybackSongIndex,{'autoplay':!![],'retrying':!![]});})());return;}showIslandNotification(_0x41121b(0x28c),'音频加载出错',_0x41121b(0x537));}),userPlaylistPlaybackAudio=_0x3a174b,_0x3a174b;}function buildUserPlaylistAudioUrl(_0x2332dc){const _0x5eaefd=_0x28e739,_0x327604=new URLSearchParams({'types':'url','source':_0x2332dc[_0x5eaefd(0x44c)]||USER_PLAYLIST_DEFAULT_SONG_SOURCE,'id':_0x2332dc['id'],'br':String(USER_PLAYLIST_AUDIO_BITRATE)});return SONG_SEARCH_API+'?'+_0x327604[_0x5eaefd(0x7f6)]();}function buildUserPlaylistLyricUrl(_0x38e748){const _0x1dca7e=_0x28e739,_0x474b73=new URLSearchParams({'types':_0x1dca7e(0x19e),'source':_0x38e748['source']||USER_PLAYLIST_DEFAULT_SONG_SOURCE,'id':_0x38e748['id']});return SONG_SEARCH_API+'?'+_0x474b73[_0x1dca7e(0x7f6)]();}async function fetchUserPlaylistAudioUrl(_0xf6a252,_0x2a175b={}){const _0x38db6f=_0x28e739,_0x2fb1d5=String(_0x2a175b[_0x38db6f(0x807)]||'')[_0x38db6f(0x28e)]()||_0x38db6f(0x6a0),_0x46cff0=buildUserPlaylistSongKey(_0xf6a252),_0x1cd2d2=_0x38db6f(0x3dc)+_0x2fb1d5+'|'+_0x46cff0,_0x5eafa8=getUserPlaylistMediaCache(_0x1cd2d2,USER_PLAYLIST_AUDIO_CACHE_TTL);if(_0x5eafa8)return _0x5eafa8;if(!_0x46cff0)throw new Error(_0x38db6f(0x455));const _0x7969ef=await getUserPlaylistMediaCacheRecord(_0x2fb1d5,_0x46cff0);if(_0x7969ef?.[_0x38db6f(0x402)]&&Number[_0x38db6f(0x795)](_0x7969ef[_0x38db6f(0x878)])){if(Date[_0x38db6f(0x2cb)]()-_0x7969ef[_0x38db6f(0x878)]<=USER_PLAYLIST_AUDIO_CACHE_TTL)return setUserPlaylistMediaCache(_0x1cd2d2,_0x7969ef[_0x38db6f(0x402)]),_0x7969ef[_0x38db6f(0x402)];}try{const _0x2651c7=buildUserPlaylistAudioUrl(_0xf6a252),_0x3dea3b=await fetch(_0x2651c7);if(!_0x3dea3b['ok'])throw new Error(_0x38db6f(0x226)+_0x3dea3b['status']);const _0x47fbbc=await _0x3dea3b[_0x38db6f(0x384)](),_0x52543d=_0x47fbbc?.[_0x38db6f(0x7ac)]||_0x47fbbc?.[_0x38db6f(0x424)]?.[_0x38db6f(0x7ac)]||_0x47fbbc?.[_0x38db6f(0x424)]?.[0x0]?.['url']||'';if(!_0x52543d)throw new Error('No\x20audio\x20url');return setUserPlaylistMediaCache(_0x1cd2d2,_0x52543d),await saveUserPlaylistMediaCacheRecord({'id':buildUserPlaylistMediaCacheId(_0x2fb1d5,_0x46cff0),'playlistId':_0x2fb1d5,'songKey':_0x46cff0,'songId':String(_0xf6a252['id']||'')[_0x38db6f(0x28e)](),'source':String(_0xf6a252[_0x38db6f(0x44c)]||USER_PLAYLIST_DEFAULT_SONG_SOURCE),'name':String(_0xf6a252[_0x38db6f(0x76a)]||_0xf6a252['title']||_0xf6a252['label']||'')[_0x38db6f(0x28e)](),'artist':Array['isArray'](_0xf6a252[_0x38db6f(0x52a)])?_0xf6a252[_0x38db6f(0x52a)]:[],'album':String(_0xf6a252[_0x38db6f(0x5a6)]||'')['trim'](),'audioUrl':_0x52543d,'audioUpdatedAt':Date[_0x38db6f(0x2cb)](),'lyricLines':_0x7969ef?.[_0x38db6f(0x59a)]||null,'lyricUpdatedAt':_0x7969ef?.[_0x38db6f(0x20a)]||null,'updatedAt':Date[_0x38db6f(0x2cb)]()}),_0x52543d;}catch(_0x49e116){if(_0x7969ef?.['audioUrl'])return setUserPlaylistMediaCache(_0x1cd2d2,_0x7969ef['audioUrl']),_0x7969ef[_0x38db6f(0x402)];throw _0x49e116;}}async function fetchUserPlaylistLyrics(_0x5be971,_0x1eebc4={}){const _0x1586f7=_0x28e739,_0x1776db=String(_0x1eebc4[_0x1586f7(0x807)]||'')[_0x1586f7(0x28e)]()||_0x1586f7(0x6a0),_0x21c5cd=buildUserPlaylistSongKey(_0x5be971),_0xf2b584='lyric|'+_0x1776db+'|'+_0x21c5cd,_0x1d0a16=getUserPlaylistMediaCache(_0xf2b584,USER_PLAYLIST_LYRIC_CACHE_TTL);if(_0x1d0a16)return _0x1d0a16;if(!_0x21c5cd)throw new Error(_0x1586f7(0x455));const _0x54a03d=await getUserPlaylistMediaCacheRecord(_0x1776db,_0x21c5cd);if(_0x54a03d?.['lyricLines']&&Number[_0x1586f7(0x795)](_0x54a03d[_0x1586f7(0x20a)])){if(Date[_0x1586f7(0x2cb)]()-_0x54a03d[_0x1586f7(0x20a)]<=USER_PLAYLIST_LYRIC_CACHE_TTL)return setUserPlaylistMediaCache(_0xf2b584,_0x54a03d[_0x1586f7(0x59a)]),_0x54a03d['lyricLines'];}const _0x53f133=buildUserPlaylistLyricUrl(_0x5be971),_0x2a46f2=await fetch(_0x53f133);if(!_0x2a46f2['ok'])throw new Error(_0x1586f7(0x226)+_0x2a46f2['status']);const _0x2fe8ad=await _0x2a46f2['json'](),_0x5c42cd=extractUserPlaylistLyricText(_0x2fe8ad),_0x19b6ed=parseUserPlaylistLyrics(_0x5c42cd);return setUserPlaylistMediaCache(_0xf2b584,_0x19b6ed),await saveUserPlaylistMediaCacheRecord({'id':buildUserPlaylistMediaCacheId(_0x1776db,_0x21c5cd),'playlistId':_0x1776db,'songKey':_0x21c5cd,'songId':String(_0x5be971['id']||'')[_0x1586f7(0x28e)](),'source':String(_0x5be971[_0x1586f7(0x44c)]||USER_PLAYLIST_DEFAULT_SONG_SOURCE),'name':String(_0x5be971[_0x1586f7(0x76a)]||_0x5be971[_0x1586f7(0x81a)]||_0x5be971['label']||'')[_0x1586f7(0x28e)](),'artist':Array[_0x1586f7(0x851)](_0x5be971[_0x1586f7(0x52a)])?_0x5be971[_0x1586f7(0x52a)]:[],'album':String(_0x5be971[_0x1586f7(0x5a6)]||'')[_0x1586f7(0x28e)](),'audioUrl':_0x54a03d?.[_0x1586f7(0x402)]||'','audioUpdatedAt':_0x54a03d?.[_0x1586f7(0x878)]||null,'lyricLines':_0x19b6ed,'lyricUpdatedAt':Date[_0x1586f7(0x2cb)](),'updatedAt':Date[_0x1586f7(0x2cb)]()}),_0x19b6ed;}function extractUserPlaylistLyricText(_0x45ee0d){const _0x13977f=_0x28e739;if(!_0x45ee0d)return'';if(typeof _0x45ee0d===_0x13977f(0x7a1))return _0x45ee0d;return _0x45ee0d[_0x13977f(0x19e)]||_0x45ee0d[_0x13977f(0x94d)]?.[_0x13977f(0x19e)]||_0x45ee0d[_0x13977f(0x424)]?.[_0x13977f(0x19e)]||_0x45ee0d['data']?.[_0x13977f(0x94d)]?.[_0x13977f(0x19e)]||'';}function parseUserPlaylistLyrics(_0x2cbc3e){const _0x35a559=_0x28e739,_0x22c4b5=String(_0x2cbc3e||'')[_0x35a559(0x28e)]();if(!_0x22c4b5)return[];const _0x587bb=[],_0x1b790d=/\[(\d{1,2}):(\d{1,2})(?:\.(\d{1,3}))?\]/g;_0x22c4b5['split']('\x0a')[_0x35a559(0x7b6)](_0x3cec21=>{const _0x427743=_0x35a559,_0x4286e3=[..._0x3cec21[_0x427743(0x473)](_0x1b790d)],_0xe1fff1=_0x3cec21[_0x427743(0x568)](_0x1b790d,'')[_0x427743(0x28e)]();if(_0x4286e3[_0x427743(0x6ea)]===0x0)return;_0x4286e3[_0x427743(0x7b6)](_0x82350a=>{const _0x430fb0=_0x427743,_0x1e82d4=Number(_0x82350a[0x1]||0x0),_0x258ad0=Number(_0x82350a[0x2]||0x0),_0x300a71=_0x82350a[0x3]?Number('0.'+_0x82350a[0x3]):0x0,_0x236b54=_0x1e82d4*0x3c+_0x258ad0+_0x300a71;_0x587bb[_0x430fb0(0x2c4)]({'time':_0x236b54,'text':_0xe1fff1||_0x430fb0(0x68b)});});});if(_0x587bb[_0x35a559(0x6ea)]===0x0){const _0x3a7ba2=_0x22c4b5[_0x35a559(0x4c7)]('\x0a')[_0x35a559(0x962)](_0x1aecd2=>_0x1aecd2[_0x35a559(0x28e)]())['filter'](Boolean);return _0x3a7ba2[_0x35a559(0x962)]((_0x2d219b,_0x184374)=>({'time':_0x184374*0x4,'text':_0x2d219b}));}return _0x587bb[_0x35a559(0x8da)]((_0x905196,_0x116c8f)=>_0x905196[_0x35a559(0x2e1)]-_0x116c8f[_0x35a559(0x2e1)]),_0x587bb;}function renderUserPlaylistLyrics(_0x38674f){const _0x30281c=_0x28e739,_0x371a68=document[_0x30281c(0x761)]('lyricsContainer');if(!_0x371a68)return;_0x371a68[_0x30281c(0x5b8)]='';const _0x2988bb=Array[_0x30281c(0x851)](_0x38674f)&&_0x38674f[_0x30281c(0x6ea)]>0x0?_0x38674f:userPlaylistLyricPool[_0x30281c(0x73d)](0x0,0x4)[_0x30281c(0x962)]((_0x850194,_0x309622)=>({'time':_0x309622*0x4,'text':_0x850194}));_0x2988bb[_0x30281c(0x7b6)]((_0x2f5197,_0x4f2f3f)=>{const _0x4c90f8=_0x30281c,_0x304d14=document['createElement']('div');_0x304d14['className']=_0x4c90f8(0x972),_0x304d14[_0x4c90f8(0x7dc)]=_0x2f5197[_0x4c90f8(0x7e6)]||_0x4c90f8(0x68b);if(_0x4f2f3f===0x0)_0x304d14[_0x4c90f8(0x421)][_0x4c90f8(0x5e3)](_0x4c90f8(0x525));_0x371a68[_0x4c90f8(0x3de)](_0x304d14);}),_0x371a68[_0x30281c(0x577)][_0x30281c(0x8ed)]=_0x30281c(0x575);}function updateUserPlaylistLyricHighlight(_0x2dbc6e,_0x16a5d7=![]){const _0x5bf123=_0x28e739,_0x4279f2=document[_0x5bf123(0x761)](_0x5bf123(0x7ca)),_0x339f7d=_0x4279f2?Array['from'](_0x4279f2[_0x5bf123(0x42c)](_0x5bf123(0x67c))):[],_0x18a218=_0x339f7d['length']>0x0?_0x339f7d[_0x5bf123(0x6ea)]:Array[_0x5bf123(0x851)](userPlaylistPlaybackLyrics)?userPlaylistPlaybackLyrics[_0x5bf123(0x6ea)]:0x0;if(_0x18a218===0x0){const _0x584477=Number['isFinite'](_0x2dbc6e)?Math[_0x5bf123(0x738)](0x0,Math['floor'](_0x2dbc6e)):0x0;userPlaylistPlaybackLyricIndex=_0x584477,updateMusicWidgetFloatingLyric(_0x16a5d7);return;}const _0x1e1ccc=Math[_0x5bf123(0x738)](0x0,Math[_0x5bf123(0x730)](_0x2dbc6e,_0x18a218-0x1));if(!_0x16a5d7&&_0x1e1ccc===userPlaylistPlaybackLyricIndex)return;_0x339f7d[_0x5bf123(0x7b6)]((_0x2e76e5,_0x5810d3)=>{const _0x24871b=_0x5bf123;_0x2e76e5['classList'][_0x24871b(0x93a)]('active',_0x5810d3===_0x1e1ccc);});const _0x2eb26f=0x1a,_0x424df5=_0x4279f2&&_0x4279f2[_0x5bf123(0x7ec)]?_0x4279f2[_0x5bf123(0x7ec)][_0x5bf123(0x3ac)]:0x4e,_0x29a353=Math[_0x5bf123(0x738)](0x0,_0x1e1ccc*_0x2eb26f-(_0x424df5/0x2-_0x2eb26f/0x2));if(_0x4279f2)_0x4279f2['style']['transform']=_0x5bf123(0x563)+_0x29a353+'px)';userPlaylistPlaybackLyricIndex=_0x1e1ccc,updateMusicWidgetFloatingLyric(_0x16a5d7);}function syncUserPlaylistLyricsByTime(_0x4c7a48){const _0x135c7c=_0x28e739;if(!Array[_0x135c7c(0x851)](userPlaylistPlaybackLyrics)||userPlaylistPlaybackLyrics[_0x135c7c(0x6ea)]===0x0)return;if(!Number['isFinite'](_0x4c7a48))return;let _0xc87498=userPlaylistPlaybackLyricIndex;while(_0xc87498<userPlaylistPlaybackLyrics['length']-0x1&&_0x4c7a48>=userPlaylistPlaybackLyrics[_0xc87498+0x1][_0x135c7c(0x2e1)]-0.05){_0xc87498+=0x1;}while(_0xc87498>0x0&&_0x4c7a48<userPlaylistPlaybackLyrics[_0xc87498]['time']){_0xc87498-=0x1;}updateUserPlaylistLyricHighlight(_0xc87498);}function updateUserPlaylistPlayButton(_0x5d4094){const _0x229471=_0x28e739;initMusicWidgetUI(),updateMusicWidgetVisibility(!!_0x5d4094),updateMusicWidgetPlaybackState(!!_0x5d4094),updateMusicWidgetSongInfo(userPlaylistPlaybackNowPlaying);const _0x1f0c41=document['getElementById'](_0x229471(0x4f1));if(!_0x1f0c41)return;const _0x5a75b8='<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M6\x204l12\x208-12\x208V4z\x22/></svg>',_0x47e762='<svg\x20viewBox=\x220\x200\x2024\x2024\x22><rect\x20x=\x226\x22\x20y=\x224\x22\x20width=\x224\x22\x20height=\x2216\x22\x20rx=\x221\x22></rect><rect\x20x=\x2214\x22\x20y=\x224\x22\x20width=\x224\x22\x20height=\x2216\x22\x20rx=\x221\x22></rect></svg>';_0x1f0c41[_0x229471(0x5b8)]=_0x5d4094?_0x47e762:_0x5a75b8,_0x1f0c41[_0x229471(0x672)][_0x229471(0x4e0)]=_0x5d4094?_0x229471(0x8ec):_0x229471(0x54d),_0x1f0c41[_0x229471(0x1d9)](_0x229471(0x793),_0x5d4094?_0x229471(0x5b5):_0x229471(0x5e8));}function updateUserPlaylistSongTitle(_0x51b8cd){const _0x4e7900=_0x28e739,_0x29c3a9=document[_0x4e7900(0x761)](_0x4e7900(0x197));if(!_0x29c3a9)return;_0x29c3a9[_0x4e7900(0x7dc)]=_0x51b8cd||'\x20';}function updateUserPlaylistProgress(_0x13f1b9,_0xfb224a){const _0x530153=_0x28e739,_0x344a9b=document[_0x530153(0x761)](_0x530153(0x635)),_0xe83803=document[_0x530153(0x761)]('playerTimeRemain'),_0x45dab2=document[_0x530153(0x761)](_0x530153(0x5fb)),_0x435bac=Number[_0x530153(0x795)](_0xfb224a)&&_0xfb224a>0x0?_0xfb224a:0x0,_0x453af3=Number[_0x530153(0x795)](_0x13f1b9)&&_0x13f1b9>0x0?_0x13f1b9:0x0,_0x51948d=_0x435bac?Math[_0x530153(0x730)](_0x453af3/_0x435bac,0x1):0x0,_0x5bdaeb=_0x435bac?Math['max'](_0x435bac-_0x453af3,0x0):0x0;if(_0x344a9b)_0x344a9b[_0x530153(0x7dc)]=formatUserPlaylistTime(_0x453af3);if(_0xe83803)_0xe83803[_0x530153(0x7dc)]='-'+formatUserPlaylistTime(_0x5bdaeb);if(_0x45dab2)_0x45dab2['style']['width']=(_0x51948d*0x64)[_0x530153(0x7a4)](0x2)+'%';}function formatUserPlaylistTime(_0x3f1404){const _0x28cfcc=_0x28e739,_0x530efa=Number['isFinite'](_0x3f1404)?Math['floor'](_0x3f1404):0x0,_0x4fae82=Math[_0x28cfcc(0x64b)](_0x530efa/0x3c),_0x448f0f=_0x530efa%0x3c;return _0x4fae82+':'+String(_0x448f0f)['padStart'](0x2,'0');}function bindUserPlaylistVolumeControl(){const _0xc3622b=_0x28e739;if(userPlaylistVolumeBound)return;const _0x9f11f1=document[_0xc3622b(0x768)]('.volume-slider'),_0x37b74f=_0x9f11f1?_0x9f11f1[_0xc3622b(0x768)](_0xc3622b(0x334)):null;if(!_0x9f11f1||!_0x37b74f)return;const _0x23c97e=_0x4d708c=>{const _0x5193d8=_0xc3622b,_0x5f1dc3=_0x37b74f[_0x5193d8(0x627)]();if(!_0x5f1dc3[_0x5193d8(0x4bf)])return;const _0x353f15=(_0x4d708c-_0x5f1dc3[_0x5193d8(0x460)])/_0x5f1dc3[_0x5193d8(0x4bf)];setUserPlaylistVolume(_0x353f15);},_0x5b271b=()=>{const _0x328f4b=_0xc3622b;_0x9f11f1[_0x328f4b(0x421)]['remove']('is-adjusting'),window[_0x328f4b(0x210)](_0x328f4b(0x1d5),_0x1067b3),window[_0x328f4b(0x210)](_0x328f4b(0x19f),_0x8de542);},_0x1067b3=_0x366fc1=>{const _0x8b6108=_0xc3622b;(_0x366fc1[_0x8b6108(0x6dc)]==='touch'||_0x366fc1['pointerType']===_0x8b6108(0x28b)||_0x366fc1[_0x8b6108(0x6dc)]===_0x8b6108(0x288))&&_0x23c97e(_0x366fc1['clientX']);},_0x8de542=()=>_0x5b271b();_0x37b74f[_0xc3622b(0x55d)](_0xc3622b(0x637),_0x55c85f=>{const _0x42a100=_0xc3622b;_0x55c85f[_0x42a100(0x442)](),_0x9f11f1[_0x42a100(0x421)][_0x42a100(0x5e3)](_0x42a100(0x3d4)),_0x23c97e(_0x55c85f[_0x42a100(0x6b3)]),window[_0x42a100(0x55d)]('pointermove',_0x1067b3),window[_0x42a100(0x55d)](_0x42a100(0x19f),_0x8de542,{'once':!![]});}),userPlaylistVolumeBound=!![];}function loadUserPlaylistVolume(){const _0x3ca244=_0x28e739;let _0x4404d5=0.5;try{const _0x338557=localStorage[_0x3ca244(0x488)](USER_PLAYLIST_VOLUME_KEY),_0xbbdbb9=Number[_0x3ca244(0x819)](_0x338557);if(Number[_0x3ca244(0x795)](_0xbbdbb9))_0x4404d5=_0xbbdbb9;}catch(_0x2a52b6){}setUserPlaylistVolume(_0x4404d5,{'persist':![]});}function setUserPlaylistVolume(_0x1147b6,_0x1de96b={}){const _0x21ce88=_0x28e739,{persist:persist=!![]}=_0x1de96b,_0x35d64d=Math[_0x21ce88(0x738)](0x0,Math['min'](0x1,Number[_0x21ce88(0x795)](_0x1147b6)?_0x1147b6:0x0));userPlaylistVolume=_0x35d64d;userPlaylistPlaybackAudio&&(userPlaylistPlaybackAudio[_0x21ce88(0x739)]=_0x35d64d);const _0x3b08ab=document[_0x21ce88(0x768)]('.volume-slider'),_0x119162=_0x3b08ab?_0x3b08ab[_0x21ce88(0x768)](_0x21ce88(0x77f)):null;_0x119162&&(_0x119162[_0x21ce88(0x577)][_0x21ce88(0x4bf)]=(_0x35d64d*0x64)[_0x21ce88(0x7a4)](0x2)+'%');_0x3b08ab&&_0x3b08ab[_0x21ce88(0x421)][_0x21ce88(0x93a)](_0x21ce88(0x494),_0x35d64d<=0.01);if(persist)try{localStorage[_0x21ce88(0x676)](USER_PLAYLIST_VOLUME_KEY,String(_0x35d64d));}catch(_0x1ae20e){}}const SONG_SEARCH_API='https://music-api.gdstudio.xyz/api.php',SONG_SEARCH_SOURCE=_0x28e739(0x366),SONG_SEARCH_COUNT=0xa,SONG_SEARCH_PAGE=0x1,SONG_SEARCH_CACHE_TTL=0x5*0x3c*0x3e8,SONG_SEARCH_MIN_INTERVAL=0x15e,songSearchCache=new Map();let songSearchLastRequestAt=0x0;function initSongSearchUI(){const _0x35f3e0=_0x28e739,_0x4dd937=document[_0x35f3e0(0x761)](_0x35f3e0(0x398)),_0x2f7fe7=document['getElementById'](_0x35f3e0(0x448)),_0x755713=document[_0x35f3e0(0x761)](_0x35f3e0(0x8ab));if(!_0x4dd937||!_0x2f7fe7||!_0x755713)return;_0x2f7fe7[_0x35f3e0(0x421)]['remove'](_0x35f3e0(0x7d4)),_0x755713[_0x35f3e0(0x5b8)]='',_0x4dd937[_0x35f3e0(0x6d0)]=_0x4d3c0e=>{const _0x137223=_0x35f3e0;_0x4d3c0e[_0x137223(0x5f8)]===_0x137223(0x759)&&(_0x4d3c0e[_0x137223(0x442)](),triggerSongSearch());};}function getSongSearchCache(_0x27779d){const _0x4da3c4=_0x28e739,_0x1eba11=songSearchCache[_0x4da3c4(0x309)](_0x27779d);if(!_0x1eba11)return null;if(Date['now']()-_0x1eba11['ts']>SONG_SEARCH_CACHE_TTL)return songSearchCache[_0x4da3c4(0x6c2)](_0x27779d),null;return _0x1eba11[_0x4da3c4(0x424)];}function setSongSearchCache(_0x280648,_0x3d4ac4){const _0x227ce3=_0x28e739;songSearchCache[_0x227ce3(0x790)](_0x280648,{'ts':Date['now'](),'data':_0x3d4ac4});}function buildSongSearchUrl(_0x5214e9){const _0x433fce=_0x28e739,_0x3b1fe1=new URLSearchParams({'types':_0x433fce(0x372),'source':SONG_SEARCH_SOURCE,'name':_0x5214e9,'count':String(SONG_SEARCH_COUNT),'pages':String(SONG_SEARCH_PAGE)});return SONG_SEARCH_API+'?'+_0x3b1fe1[_0x433fce(0x7f6)]();}async function songSearchThrottle(){const _0x364557=_0x28e739,_0x4c986e=Date[_0x364557(0x2cb)](),_0x2e45a5=SONG_SEARCH_MIN_INTERVAL-(_0x4c986e-songSearchLastRequestAt);_0x2e45a5>0x0&&await new Promise(_0x11f1dd=>setTimeout(_0x11f1dd,_0x2e45a5)),songSearchLastRequestAt=Date[_0x364557(0x2cb)]();}async function fetchSongSearch(_0x5f592c){const _0x1f8d17=_0x28e739,_0x414efd=SONG_SEARCH_SOURCE+'|'+_0x5f592c[_0x1f8d17(0x6eb)](),_0x538900=getSongSearchCache(_0x414efd);if(_0x538900)return _0x538900;await songSearchThrottle();const _0x3dcac0=buildSongSearchUrl(_0x5f592c),_0x11c0ac=await fetch(_0x3dcac0);if(!_0x11c0ac['ok'])throw new Error(_0x1f8d17(0x226)+_0x11c0ac[_0x1f8d17(0x664)]);const _0x13676e=await _0x11c0ac[_0x1f8d17(0x384)](),_0x2b841d=Array[_0x1f8d17(0x851)](_0x13676e)?_0x13676e:[];return setSongSearchCache(_0x414efd,_0x2b841d),_0x2b841d;}function renderSongSearchResults(_0x329ebb){const _0x149dd0=_0x28e739,_0x192400=document[_0x149dd0(0x761)](_0x149dd0(0x448)),_0x2c0bb2=document[_0x149dd0(0x761)](_0x149dd0(0x8ab));if(!_0x192400||!_0x2c0bb2)return;_0x2c0bb2[_0x149dd0(0x5b8)]='';if(!Array[_0x149dd0(0x851)](_0x329ebb)||_0x329ebb[_0x149dd0(0x6ea)]===0x0){const _0x10163c=document[_0x149dd0(0x5e5)]('div');_0x10163c['className']=_0x149dd0(0x7b0),_0x10163c[_0x149dd0(0x7dc)]=_0x149dd0(0x220),_0x2c0bb2[_0x149dd0(0x3de)](_0x10163c),_0x192400[_0x149dd0(0x421)]['add'](_0x149dd0(0x7d4));return;}_0x329ebb[_0x149dd0(0x7b6)](_0x4cf70d=>{const _0x425fdd=_0x149dd0;if(!_0x4cf70d||!_0x4cf70d['id'])return;const _0x1ef9a1=_0x4cf70d[_0x425fdd(0x76a)]||_0x425fdd(0x47e),_0x40d44f=Array[_0x425fdd(0x851)](_0x4cf70d[_0x425fdd(0x52a)])?_0x4cf70d[_0x425fdd(0x52a)][_0x425fdd(0x943)](_0x425fdd(0x8ca)):'',_0x29ecad=_0x4cf70d[_0x425fdd(0x5a6)]||'',_0x3367dc=[];if(_0x40d44f)_0x3367dc[_0x425fdd(0x2c4)](_0x40d44f);if(_0x29ecad)_0x3367dc[_0x425fdd(0x2c4)](_0x29ecad);_0x3367dc[_0x425fdd(0x2c4)](_0x425fdd(0x5bc)+_0x4cf70d['id']);const _0x29c2f4=document['createElement'](_0x425fdd(0x52d));_0x29c2f4['type']=_0x425fdd(0x52d),_0x29c2f4[_0x425fdd(0x51f)]='song-search-item',_0x29c2f4['innerHTML']=_0x425fdd(0x362)+escapeHtml(_0x1ef9a1)+_0x425fdd(0x6d7)+escapeHtml(_0x3367dc[_0x425fdd(0x943)](_0x425fdd(0x2ec)))+_0x425fdd(0x201),_0x29c2f4[_0x425fdd(0x55d)](_0x425fdd(0x7bd),()=>addSongFromSearch(_0x4cf70d)),_0x2c0bb2['appendChild'](_0x29c2f4);}),_0x192400[_0x149dd0(0x421)][_0x149dd0(0x5e3)]('is-visible');}function addSongFromSearch(_0x5b5c1d){const _0x447f62=_0x28e739;if(userPlaylistCurrentIndex===-0x1)return;const _0x52ccc9={'name':_0x5b5c1d['name']||_0x447f62(0x47e),'id':String(_0x5b5c1d['id']||'')[_0x447f62(0x28e)](),'artist':Array['isArray'](_0x5b5c1d['artist'])?_0x5b5c1d[_0x447f62(0x52a)]:[],'album':_0x5b5c1d[_0x447f62(0x5a6)]||'','source':_0x5b5c1d[_0x447f62(0x44c)]||USER_PLAYLIST_DEFAULT_SONG_SOURCE};playlists[userPlaylistCurrentIndex][_0x447f62(0x646)]['push'](_0x52ccc9),renderSongs(playlists[userPlaylistCurrentIndex][_0x447f62(0x646)]),saveUserPlaylistData();}async function triggerSongSearch(){const _0x3a69bd=_0x28e739,_0x34db7f=document[_0x3a69bd(0x761)](_0x3a69bd(0x398));if(!_0x34db7f)return;const _0x7d641=_0x34db7f[_0x3a69bd(0x29c)][_0x3a69bd(0x28e)]();if(!_0x7d641)return;showIslandNotification(_0x3a69bd(0x8a6),_0x3a69bd(0x271),'info');try{const _0x5d4175=await fetchSongSearch(_0x7d641);renderSongSearchResults(_0x5d4175);}catch(_0x16be3c){console[_0x3a69bd(0x56c)](_0x3a69bd(0x54a),_0x16be3c),renderSongSearchResults([]);}}function escapeHtml(_0x1755a3){const _0x1000c0=_0x28e739;return String(_0x1755a3)[_0x1000c0(0x568)](/&/g,_0x1000c0(0x45f))[_0x1000c0(0x568)](/</g,'&lt;')[_0x1000c0(0x568)](/>/g,'&gt;')[_0x1000c0(0x568)](/"/g,_0x1000c0(0x2e5))[_0x1000c0(0x568)](/'/g,_0x1000c0(0x504));}function renderSongs(_0x54ad74){const _0x9ffef0=_0x28e739,_0x12bf00=document[_0x9ffef0(0x761)](_0x9ffef0(0x464));if(!_0x12bf00)return;const _0x1aa970=_0x12bf00[_0x9ffef0(0x768)](_0x9ffef0(0x724));_0x12bf00[_0x9ffef0(0x5b8)]='';if(_0x1aa970)_0x12bf00[_0x9ffef0(0x3de)](_0x1aa970);_0x54ad74[_0x9ffef0(0x7b6)]((_0x5c8642,_0x3142c4)=>{const _0x370521=_0x9ffef0,_0x1a8d7d=document['createElement'](_0x370521(0x6a4));_0x1a8d7d[_0x370521(0x51f)]=_0x370521(0x874),_0x1a8d7d['style'][_0x370521(0x542)]=_0x3142c4*0.1+'s';const _0x2519bd=buildUserPlaylistSongLabel(_0x5c8642);_0x1a8d7d['innerHTML']=_0x370521(0x461)+escapeHtml(_0x2519bd)+_0x370521(0x3ea)+_0x3142c4+')\x22>✕</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x12bf00[_0x370521(0x3de)](_0x1a8d7d);}),userPlaylistCurrentIndex===userPlaylistPlaybackIndex&&refreshUserPlaylistPlaybackSongList();}function buildUserPlaylistSongLabel(_0x2e96a1){const _0x15acc7=_0x28e739;if(typeof _0x2e96a1==='string')return _0x2e96a1;if(_0x2e96a1&&typeof _0x2e96a1===_0x15acc7(0x1f7)){const _0x586014=_0x2e96a1['name']||_0x2e96a1[_0x15acc7(0x81a)]||_0x2e96a1[_0x15acc7(0x880)]||'',_0x1ee611=Array[_0x15acc7(0x851)](_0x2e96a1[_0x15acc7(0x52a)])?_0x2e96a1['artist'][_0x15acc7(0x943)](_0x15acc7(0x8ca)):'';if(_0x586014&&_0x1ee611)return _0x586014+_0x15acc7(0x2df)+_0x1ee611;return _0x586014||_0x1ee611||_0x15acc7(0x47e);}return _0x15acc7(0x47e);}function normalizeUserPlaylistSongForCache(_0x1eebf5){const _0x15d480=_0x28e739;if(typeof _0x1eebf5===_0x15d480(0x7a1)){const _0x13ea9c=_0x1eebf5[_0x15d480(0x28e)]();return _0x13ea9c?{'name':_0x13ea9c,'source':USER_PLAYLIST_DEFAULT_SONG_SOURCE}:null;}if(_0x1eebf5&&typeof _0x1eebf5===_0x15d480(0x1f7))return{'name':_0x1eebf5[_0x15d480(0x76a)]||_0x1eebf5[_0x15d480(0x81a)]||_0x1eebf5[_0x15d480(0x880)]||'','id':String(_0x1eebf5['id']||'')[_0x15d480(0x28e)](),'artist':Array[_0x15d480(0x851)](_0x1eebf5['artist'])?_0x1eebf5[_0x15d480(0x52a)]:[],'album':_0x1eebf5[_0x15d480(0x5a6)]||'','source':_0x1eebf5['source']||USER_PLAYLIST_DEFAULT_SONG_SOURCE};return null;}function removePlaylistMediaCacheForSong(_0x16a080,_0x5e5d97){const _0x17c010=_0x28e739,_0x3595ea=String(_0x16a080?.['id']||'')[_0x17c010(0x28e)]();if(!_0x3595ea)return;const _0x535cfd=normalizeUserPlaylistSongForCache(_0x5e5d97);if(!_0x535cfd)return;const _0x47e2fd=buildUserPlaylistSongKey(_0x535cfd);if(!_0x47e2fd)return;userPlaylistMediaCache['delete'](_0x17c010(0x3dc)+_0x3595ea+'|'+_0x47e2fd),userPlaylistMediaCache['delete'](_0x17c010(0x177)+_0x3595ea+'|'+_0x47e2fd),void deleteUserPlaylistMediaCacheRecord(_0x3595ea,_0x47e2fd);}function clearPlaylistMediaCache(_0xeb33df){const _0x377de5=_0x28e739,_0x16cb33=String(_0xeb33df||'')[_0x377de5(0x28e)]();if(!_0x16cb33)return;for(const _0x57b0f8 of userPlaylistMediaCache[_0x377de5(0x961)]()){_0x57b0f8['includes']('|'+_0x16cb33+'|')&&userPlaylistMediaCache[_0x377de5(0x6c2)](_0x57b0f8);}void deleteUserPlaylistMediaCacheByPlaylist(_0x16cb33);}function addSong(){const _0x59560f=_0x28e739,_0x5b48b9=document[_0x59560f(0x761)](_0x59560f(0x398)),_0x592b3f=_0x5b48b9?_0x5b48b9[_0x59560f(0x29c)]['trim']():'';if(_0x592b3f&&userPlaylistCurrentIndex!==-0x1){playlists[userPlaylistCurrentIndex]['songs'][_0x59560f(0x2c4)](_0x592b3f),renderSongs(playlists[userPlaylistCurrentIndex][_0x59560f(0x646)]),saveUserPlaylistData();if(_0x5b48b9)_0x5b48b9[_0x59560f(0x29c)]='';}}function removeSong(_0x1960fd){const _0x27284c=_0x28e739;if(userPlaylistCurrentIndex!==-0x1){const _0x40947d=playlists[userPlaylistCurrentIndex];if(_0x40947d&&Array[_0x27284c(0x851)](_0x40947d[_0x27284c(0x646)])){const _0x111462=_0x40947d[_0x27284c(0x646)][_0x1960fd];removePlaylistMediaCacheForSong(_0x40947d,_0x111462),_0x40947d[_0x27284c(0x646)]['splice'](_0x1960fd,0x1),renderSongs(_0x40947d[_0x27284c(0x646)]);}saveUserPlaylistData(),userPlaylistCurrentIndex===userPlaylistPlaybackIndex&&userPlaylistPlaybackSongList['length']===0x0&&stopUserPlaylistPlayback({'reset':!![]});}}function deletePlaylist(){const _0x200bf6=_0x28e739;if(confirm(_0x200bf6(0x371))){const _0x4c7655=userPlaylistCurrentIndex,_0x1f22e0=playlists[_0x4c7655];_0x1f22e0?.['id']&&clearPlaylistMediaCache(_0x1f22e0['id']);playlists['splice'](_0x4c7655,0x1);if(userPlaylistPlaybackIndex===_0x4c7655)userPlaylistPlaybackIndex=-0x1,persistUserPlaylistPlaybackIndex(),stopUserPlaylistPlayback({'reset':!![]});else userPlaylistPlaybackIndex>_0x4c7655&&(userPlaylistPlaybackIndex-=0x1,persistUserPlaylistPlaybackIndex());initUserPlaylistNodes(),applyUserPlaylistPlaybackHighlight(),closeUserPlaylistOverlay(),saveUserPlaylistData();}}function animateUserPlaylistRain(){const _0x570c8e=_0x28e739;if(userPlaylistActiveMode!==_0x570c8e(0x5fe)||!userPlaylistOverlayCtx)return;userPlaylistOverlayCtx[_0x570c8e(0x915)](0x0,0x0,userPlaylistWidth,userPlaylistHeight);const _0x35ea0f=document['documentElement'][_0x570c8e(0x7f3)](_0x570c8e(0x3e1))===_0x570c8e(0x30a);userPlaylistOverlayCtx['fillStyle']=_0x35ea0f?_0x570c8e(0x190):_0x570c8e(0x694);for(let _0x35389f=0x0;_0x35389f<0x5;_0x35389f++){const _0x2e1f46=Math[_0x570c8e(0x266)]()*userPlaylistWidth,_0x3f7513=Math[_0x570c8e(0x266)]()*userPlaylistHeight,_0x40f2a4=Math[_0x570c8e(0x266)]()*0x32+0x14;userPlaylistOverlayCtx[_0x570c8e(0x643)](_0x2e1f46,_0x3f7513,0x1,_0x40f2a4);}userPlaylistOverlayAnimationId=requestAnimationFrame(animateUserPlaylistRain);}if(document[_0x28e739(0x1c4)]==='loading')document[_0x28e739(0x55d)]('DOMContentLoaded',()=>{const _0xca9ded=_0x28e739;document[_0xca9ded(0x761)](_0xca9ded(0x5c0))&&initUserPlaylistPage();},{'once':!![]});else document['getElementById'](_0x28e739(0x5c0))&&initUserPlaylistPage();const FIXED_ALBUMS=[{'cover':_0x28e739(0x1df),'label':_0x28e739(0x51e)},{'cover':'https://i.postimg.cc/qMLZCFzL/fdfe79aeae4dc2670be2cce06b6a5ee0.jpg','label':_0x28e739(0x614)},{'cover':_0x28e739(0x6e7),'label':_0x28e739(0x4dd)},{'cover':'https://i.postimg.cc/J08Ps3mz/a5c30bff958e9aee2d418c8b3aa090b4.jpg','label':_0x28e739(0x435)}];function extractDominantColor(_0x464f6c){return new Promise((_0xb0cb01,_0x5c8fd7)=>{const _0x4a94cf=_0xc1ca;try{const _0x30c4e6=document[_0x4a94cf(0x5e5)](_0x4a94cf(0x515)),_0x211ae2=_0x30c4e6['getContext']('2d');_0x30c4e6[_0x4a94cf(0x4bf)]=0x32,_0x30c4e6[_0x4a94cf(0x5ea)]=0x32,_0x211ae2[_0x4a94cf(0x64d)](_0x464f6c,0x0,0x0,0x32,0x32);const _0x7906bc=_0x211ae2[_0x4a94cf(0x80e)](0x0,0x0,0x32,0x32),_0x8990f2=_0x7906bc['data'];let _0x1b3457=0x0,_0x4eae81=0x0,_0x506726=0x0,_0x3ed1a8=0x0;for(let _0x5b2a80=0x0;_0x5b2a80<_0x8990f2['length'];_0x5b2a80+=0x10){const _0x1656f2=_0x8990f2[_0x5b2a80],_0xac1681=_0x8990f2[_0x5b2a80+0x1],_0x43832e=_0x8990f2[_0x5b2a80+0x2],_0x1c748d=_0x8990f2[_0x5b2a80+0x3];if(_0x1c748d<0x7d)continue;const _0x2eca93=(_0x1656f2+_0xac1681+_0x43832e)/0x3;if(_0x2eca93<0x14||_0x2eca93>0xeb)continue;_0x1b3457+=_0x1656f2,_0x4eae81+=_0xac1681,_0x506726+=_0x43832e,_0x3ed1a8++;}if(_0x3ed1a8===0x0){_0xb0cb01({'r':0x64,'g':0x64,'b':0x78});return;}_0x1b3457=Math['round'](_0x1b3457/_0x3ed1a8),_0x4eae81=Math['round'](_0x4eae81/_0x3ed1a8),_0x506726=Math[_0x4a94cf(0x247)](_0x506726/_0x3ed1a8);const _0x7f92e4=rgbToHsl(_0x1b3457,_0x4eae81,_0x506726);_0x7f92e4['s']=Math[_0x4a94cf(0x730)](_0x7f92e4['s']*0.7,0.5);_0x7f92e4['l']>0.5?_0x7f92e4['l']=Math[_0x4a94cf(0x738)](0.8,Math['min'](_0x7f92e4['l']*0.9,0.95)):_0x7f92e4['l']=Math['max'](0.2,Math[_0x4a94cf(0x730)](_0x7f92e4['l']*1.2,0.4));const _0x2b0790=hslToRgb(_0x7f92e4['h'],_0x7f92e4['s'],_0x7f92e4['l']);_0xb0cb01(_0x2b0790);}catch(_0x4517cb){console['error'](_0x4a94cf(0x669),_0x4517cb),_0xb0cb01({'r':0x64,'g':0x64,'b':0x78});}});}function rgbToHsl(_0x234474,_0x4de6b1,_0x359549){const _0x585780=_0x28e739;_0x234474/=0xff,_0x4de6b1/=0xff,_0x359549/=0xff;const _0xab38b6=Math[_0x585780(0x738)](_0x234474,_0x4de6b1,_0x359549),_0x333444=Math['min'](_0x234474,_0x4de6b1,_0x359549);let _0x48e29d,_0x1059c1,_0x223ca4=(_0xab38b6+_0x333444)/0x2;if(_0xab38b6===_0x333444)_0x48e29d=_0x1059c1=0x0;else{const _0x32731b=_0xab38b6-_0x333444;_0x1059c1=_0x223ca4>0.5?_0x32731b/(0x2-_0xab38b6-_0x333444):_0x32731b/(_0xab38b6+_0x333444);switch(_0xab38b6){case _0x234474:_0x48e29d=((_0x4de6b1-_0x359549)/_0x32731b+(_0x4de6b1<_0x359549?0x6:0x0))/0x6;break;case _0x4de6b1:_0x48e29d=((_0x359549-_0x234474)/_0x32731b+0x2)/0x6;break;case _0x359549:_0x48e29d=((_0x234474-_0x4de6b1)/_0x32731b+0x4)/0x6;break;}}return{'h':_0x48e29d,'s':_0x1059c1,'l':_0x223ca4};}function hslToRgb(_0x346e40,_0xbbcbb1,_0x5d1c71){const _0x2ca1b8=_0x28e739;let _0x527e26,_0x53e2cc,_0x51a240;if(_0xbbcbb1===0x0)_0x527e26=_0x53e2cc=_0x51a240=_0x5d1c71;else{const _0x2fa233=(_0x11ae08,_0x861a07,_0x11a3e6)=>{if(_0x11a3e6<0x0)_0x11a3e6+=0x1;if(_0x11a3e6>0x1)_0x11a3e6-=0x1;if(_0x11a3e6<0x1/0x6)return _0x11ae08+(_0x861a07-_0x11ae08)*0x6*_0x11a3e6;if(_0x11a3e6<0x1/0x2)return _0x861a07;if(_0x11a3e6<0x2/0x3)return _0x11ae08+(_0x861a07-_0x11ae08)*(0x2/0x3-_0x11a3e6)*0x6;return _0x11ae08;},_0xb525c4=_0x5d1c71<0.5?_0x5d1c71*(0x1+_0xbbcbb1):_0x5d1c71+_0xbbcbb1-_0x5d1c71*_0xbbcbb1,_0x116c95=0x2*_0x5d1c71-_0xb525c4;_0x527e26=_0x2fa233(_0x116c95,_0xb525c4,_0x346e40+0x1/0x3),_0x53e2cc=_0x2fa233(_0x116c95,_0xb525c4,_0x346e40),_0x51a240=_0x2fa233(_0x116c95,_0xb525c4,_0x346e40-0x1/0x3);}return{'r':Math[_0x2ca1b8(0x247)](_0x527e26*0xff),'g':Math['round'](_0x53e2cc*0xff),'b':Math[_0x2ca1b8(0x247)](_0x51a240*0xff)};}function applyPlaylistColor(_0x57856e){const _0x4730d2=_0x28e739,_0x411092=document[_0x4730d2(0x768)](_0x4730d2(0x785));if(!_0x411092)return;const {r:_0x2f9057,g:_0x32812e,b:_0x3abfd5}=_0x57856e,_0x7958f7=_0x4730d2(0x818)+_0x2f9057+',\x20'+_0x32812e+',\x20'+_0x3abfd5+',\x200.85)\x200%,\x0a\x20\x20\x20\x20\x20\x20\x20\x20rgba('+Math['max'](0x0,_0x2f9057-0x1e)+',\x20'+Math[_0x4730d2(0x738)](0x0,_0x32812e-0x1e)+',\x20'+Math[_0x4730d2(0x738)](0x0,_0x3abfd5-0x1e)+_0x4730d2(0x60c);_0x411092[_0x4730d2(0x577)]['background']=_0x7958f7,_0x411092[_0x4730d2(0x577)]['transition']=_0x4730d2(0x882);}function loadAlbumCovers(){const _0x23bdc5=_0x28e739,_0x3b06fb=document[_0x23bdc5(0x42c)](_0x23bdc5(0x6a8));let _0x53f36b=null;FIXED_ALBUMS[_0x23bdc5(0x7b6)]((_0xedf831,_0x16afb8)=>{const _0x5dc978=_0x23bdc5;if(_0x16afb8<_0x3b06fb[_0x5dc978(0x6ea)]){const _0x269797=_0x3b06fb[_0x16afb8],_0x2006e3=_0x269797[_0x5dc978(0x768)](_0x5dc978(0x870)),_0x580de8=_0x269797[_0x5dc978(0x768)](_0x5dc978(0x468));_0x2006e3&&(_0x2006e3[_0x5dc978(0x273)]=_0xedf831[_0x5dc978(0x23c)],_0x2006e3['crossOrigin']=_0x5dc978(0x733),_0x16afb8===0x0&&(_0x53f36b=_0x2006e3,_0x2006e3[_0x5dc978(0x2d9)]=async()=>{const _0x50a734=_0x5dc978;try{const _0x717194=await extractDominantColor(_0x2006e3);applyPlaylistColor(_0x717194);}catch(_0x22c028){console[_0x50a734(0x56c)](_0x50a734(0x7d1),_0x22c028);}},_0x2006e3['complete']&&extractDominantColor(_0x2006e3)[_0x5dc978(0x21f)](_0x1b94be=>{applyPlaylistColor(_0x1b94be);})[_0x5dc978(0x679)](_0xaa3154=>{const _0x5d503f=_0x5dc978;console['error'](_0x5d503f(0x7d1),_0xaa3154);}),_0x269797[_0x5dc978(0x462)]=()=>{const _0x4710a8=_0x5dc978;if(!currentCharProfileData){console['error'](_0x4710a8(0x26b));return;}const _0x1fb511=currentCharProfileData['id'];console[_0x4710a8(0x41f)]('📔\x20打开日记本，角色ID:',_0x1fb511),closeCharProfile(),typeof openCharacterDiary===_0x4710a8(0x48c)?openCharacterDiary(_0x1fb511):console['error'](_0x4710a8(0x1d7));})),_0x580de8&&(_0x580de8['textContent']=_0xedf831[_0x5dc978(0x880)]);}});}async function getCurrentChatCharacter(){const _0x373355=_0x28e739,_0x27d5be=currentChatId||window[_0x373355(0x29e)];if(!_0x27d5be)return null;try{const _0x5bc709=await db[_0x373355(0x183)][_0x373355(0x309)](_0x27d5be);if(!_0x5bc709)return null;const _0x3b884a=getCharacterIdFromChat(_0x5bc709);if(!_0x3b884a&&!isChatRecord(_0x5bc709))return null;let _0x5bf7a9=_0x3b884a?await getCharacterById(_0x3b884a):null;if(!_0x5bf7a9&&_0x5bc709['linkedCharacterData']){const _0x39a765=_0x5bc709[_0x373355(0x71f)]||{};_0x5bf7a9={'id':_0x3b884a||_0x5bc709['id'],'name':_0x39a765[_0x373355(0x76a)]||_0x5bc709[_0x373355(0x76a)]||_0x373355(0x3fe),'originalName':_0x39a765['originalName']||_0x39a765[_0x373355(0x76a)]||_0x5bc709[_0x373355(0x53a)]||'','settings':_0x39a765[_0x373355(0x6ff)]||{},'mmpagesDisplayName':_0x39a765[_0x373355(0x478)]||'','mmpagesUsername':_0x39a765[_0x373355(0x47a)]||'','mmpagesBio':_0x39a765[_0x373355(0x4a3)]||'','mmpagesBioNote':_0x39a765[_0x373355(0x97a)]||'','mmpagesFollowers':_0x39a765[_0x373355(0x283)]||'','mmpagesSocialAvatar':_0x39a765[_0x373355(0x541)]||'','avatar':_0x39a765[_0x373355(0x708)]||'','bio':_0x39a765[_0x373355(0x61c)]||'','posts':_0x39a765['posts']||'','followers':_0x39a765['followers']||'','following':_0x39a765['following']||'','pronouns':_0x39a765[_0x373355(0x274)]||'','threads':_0x39a765['threads']||'','highlights':_0x39a765['highlights']||null};}if(!_0x5bf7a9)return null;const _0x49d227=_0x5bf7a9[_0x373355(0x6ff)]?.['aiAvatar']||'',_0x4b9fa7=_0x5bf7a9['name']||_0x373355(0x3fe),_0x3f34ba=await db[_0x373355(0x30f)][_0x373355(0x309)](normalizeId(_0x5bc709['id'])),_0x59b5a7=resolveChatDisplayName(_0x5bc709,{'chatSettings':_0x3f34ba,'fallbackName':_0x4b9fa7,'defaultName':_0x373355(0x3fe)});let _0x1defb8=null,_0x5358e7=_0x3f34ba?.['userProfileId'];if(!_0x5358e7){const _0x16b3ee=await db['globalSettings'][_0x373355(0x309)](_0x373355(0x619));_0x5358e7=_0x16b3ee?.['value'];}_0x5358e7&&(_0x1defb8=await db[_0x373355(0x70f)][_0x373355(0x309)](_0x5358e7));const _0x2978a5=_0x1defb8?.[_0x373355(0x2ae)]||_0x1defb8?.[_0x373355(0x76a)]?.[_0x373355(0x6eb)]()['replace'](/\s+/g,'_')||'user',_0x5ee321=_0x3b884a||_0x5bf7a9['id']||_0x5bc709['id'];return{'id':_0x5ee321,'name':_0x59b5a7,'originalName':_0x4b9fa7,'avatar':_0x49d227,'username':_0x4b9fa7[_0x373355(0x6eb)]()['replace'](/\s+/g,'_'),'bio':_0x5bf7a9[_0x373355(0x61c)]||'','posts':_0x5bf7a9[_0x373355(0x344)]||Math[_0x373355(0x64b)](Math[_0x373355(0x266)]()*0x32)+0x1,'followers':_0x5bf7a9[_0x373355(0x6ec)]||Math[_0x373355(0x64b)](Math[_0x373355(0x266)]()*0x2710)+0x64,'following':_0x5bf7a9['following']||Math[_0x373355(0x64b)](Math['random']()*0x1f4)+0xa,'pronouns':_0x5bf7a9['pronouns']||'','threads':_0x5bf7a9[_0x373355(0x58a)]||Math[_0x373355(0x64b)](Math[_0x373355(0x266)]()*0xf4240)+0x2710,'highlights':_0x5bf7a9[_0x373355(0x248)]||null,'mmpagesDisplayName':_0x5bf7a9[_0x373355(0x478)]||'','mmpagesUsername':_0x5bf7a9['mmpagesUsername']||'','mmpagesBio':_0x5bf7a9[_0x373355(0x4a3)]||'','mmpagesBioNote':_0x5bf7a9[_0x373355(0x97a)]||'','mmpagesFollowers':_0x5bf7a9[_0x373355(0x283)]||'','mmpagesSocialAvatar':_0x5bf7a9['mmpagesSocialAvatar']||'','userMention':_0x2978a5};}catch(_0x17b3eb){return console[_0x373355(0x516)](_0x373355(0x59f),_0x17b3eb),null;}}function renderCharProfileData(_0x499d5e){const _0x4b069c=_0x28e739,_0x5aacfb=document[_0x4b069c(0x761)](_0x4b069c(0x1fb));_0x5aacfb&&(_0x5aacfb[_0x4b069c(0x7dc)]=_0x499d5e['username']||_0x499d5e[_0x4b069c(0x76a)]?.[_0x4b069c(0x6eb)]()[_0x4b069c(0x568)](/\s+/g,'_')||_0x4b069c(0x2ae));const _0x1e2d23=document[_0x4b069c(0x761)](_0x4b069c(0x84d));_0x1e2d23&&(_0x1e2d23['src']=_0x499d5e[_0x4b069c(0x708)]||_0x4b069c(0x67b),_0x1e2d23[_0x4b069c(0x6b0)]=function(){const _0x6ad50a=_0x4b069c;this[_0x6ad50a(0x273)]=_0x6ad50a(0x67b);});const _0x59425f=document[_0x4b069c(0x761)](_0x4b069c(0x97b)),_0x1fa323=document[_0x4b069c(0x761)](_0x4b069c(0x958)),_0x16529a=document[_0x4b069c(0x761)]('charProfileFollowing');if(_0x59425f)_0x59425f[_0x4b069c(0x7dc)]=_0x499d5e['posts']||Math[_0x4b069c(0x64b)](Math['random']()*0x32)+0x1;if(_0x1fa323)_0x1fa323[_0x4b069c(0x7dc)]=formatNumber(_0x499d5e['followers']||Math[_0x4b069c(0x64b)](Math[_0x4b069c(0x266)]()*0x2710)+0x64);if(_0x16529a)_0x16529a['textContent']=_0x499d5e[_0x4b069c(0x1dc)]||Math[_0x4b069c(0x64b)](Math[_0x4b069c(0x266)]()*0x1f4)+0xa;const _0x37f02d=document[_0x4b069c(0x761)](_0x4b069c(0x951));_0x37f02d&&(_0x37f02d[_0x4b069c(0x7dc)]=_0x499d5e[_0x4b069c(0x76a)]||_0x4b069c(0x87d));const _0x58577a=document[_0x4b069c(0x761)](_0x4b069c(0x58d));_0x58577a&&(_0x58577a['src']=_0x499d5e[_0x4b069c(0x708)]||_0x4b069c(0x67b),_0x58577a['onerror']=function(){const _0x4d72fa=_0x4b069c;this['src']=_0x4d72fa(0x67b);});const _0x7c70b0=document[_0x4b069c(0x761)](_0x4b069c(0x1f0));_0x7c70b0&&(_0x7c70b0[_0x4b069c(0x7dc)]=_0x499d5e['originalName']||_0x499d5e[_0x4b069c(0x76a)]||_0x4b069c(0x7f2));const _0x4a431a=document[_0x4b069c(0x761)]('playlistArtistName');_0x4a431a&&(_0x4a431a[_0x4b069c(0x7dc)]=_0x499d5e[_0x4b069c(0x76a)]||_0x4b069c(0x4d3));const _0x34c649=document[_0x4b069c(0x761)](_0x4b069c(0x38b));_0x34c649&&(_0x34c649[_0x4b069c(0x7dc)]=formatNumber(_0x499d5e[_0x4b069c(0x58a)]||Math[_0x4b069c(0x64b)](Math[_0x4b069c(0x266)]()*0xf4240)+0x2710));const _0x4a6b13=document['getElementById']('charProfileMention');if(_0x4a6b13){const _0x5e1227=_0x499d5e[_0x4b069c(0x42f)]||'user';_0x4a6b13[_0x4b069c(0x5b8)]='@'+_0x5e1227+_0x4b069c(0x333);}renderCharProfileHighlights(_0x499d5e);}function formatNumber(_0x3f00bf){const _0x1ebd5d=_0x28e739;if(_0x3f00bf>=0xf4240)return(_0x3f00bf/0xf4240)['toFixed'](0x1)[_0x1ebd5d(0x568)](/\.0$/,'')+'M';if(_0x3f00bf>=0x3e8)return(_0x3f00bf/0x3e8)[_0x1ebd5d(0x7a4)](0x1)[_0x1ebd5d(0x568)](/\.0$/,'')+'K';return _0x3f00bf[_0x1ebd5d(0x7f6)]()['replace'](/\B(?=(\d{3})+(?!\d))/g,',');}function renderCharProfileHighlights(_0xa3a334){const _0x4246d0=_0x28e739,_0x35f94d=document['getElementById'](_0x4246d0(0x8e9));if(!_0x35f94d)return;const _0x1eacbf=[{'icon':_0x4246d0(0x3b3),'label':_0x4246d0(0x5d1)},{'icon':_0x4246d0(0x3f1),'label':'日程'},{'icon':_0x4246d0(0x2f1),'label':'笔记'},{'icon':'help','label':'关于'}],_0x5bad1c=_0xa3a334[_0x4246d0(0x248)]||_0x1eacbf;_0x35f94d['innerHTML']=_0x5bad1c[_0x4246d0(0x962)](_0x440f18=>_0x4246d0(0x7ed)+_0x440f18['icon']+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22char-profile-highlight-circle\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x440f18['image']?'<img\x20src=\x22'+_0x440f18[_0x4246d0(0x7fa)]+_0x4246d0(0x3d9)+_0x440f18[_0x4246d0(0x880)]+'\x22>':getHighlightIcon(_0x440f18[_0x4246d0(0x8d6)]))+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22char-profile-highlight-label\x22>'+_0x440f18[_0x4246d0(0x880)]+_0x4246d0(0x4c8))['join']('');}function getHighlightIcon(_0x256bee){const _0xaf477=_0x28e739,_0x395761={'heart':_0xaf477(0x7c6),'calendar':_0xaf477(0x75f),'file':_0xaf477(0x5b3),'help':'<svg\x20viewBox=\x220\x200\x2024\x2024\x22><circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x2210\x22></circle><path\x20d=\x22M9.09\x209a3\x203\x200\x200\x201\x205.83\x201c0\x202-3\x203-3\x203\x22></path><line\x20x1=\x2212\x22\x20y1=\x2217\x22\x20x2=\x2212.01\x22\x20y2=\x2217\x22></line></svg>','star':'<svg\x20viewBox=\x220\x200\x2024\x2024\x22><polygon\x20points=\x2212\x202\x2015.09\x208.26\x2022\x209.27\x2017\x2014.14\x2018.18\x2021.02\x2012\x2017.77\x205.82\x2021.02\x207\x2014.14\x202\x209.27\x208.91\x208.26\x2012\x202\x22></polygon></svg>'};return _0x395761[_0x256bee]||_0x395761[_0xaf477(0x3b3)];}function handleCharProfileHighlight(_0x5a97bd){const _0x23fa0b=_0x28e739;console[_0x23fa0b(0x41f)](_0x23fa0b(0x8ad),_0x5a97bd);}function charProfilePhone(){const _0x10ea65=_0x28e739;if(!currentCharProfileData)return;closeCharProfile(),console[_0x10ea65(0x41f)](_0x10ea65(0x705),currentCharProfileData[_0x10ea65(0x76a)]),typeof openPhoneCall==='function'&&openPhoneCall(currentCharProfileData);}function charProfileNote(){const _0x19997b=_0x28e739;if(!currentCharProfileData)return;const _0x436126=currentCharProfileData['id'],_0x4a6625=currentCharProfileData['name'];closeCharProfile(),console['log'](_0x19997b(0x491),_0x4a6625),typeof openCharacterDiary===_0x19997b(0x48c)?openCharacterDiary(_0x436126):console['log'](_0x19997b(0x1d7));}function animateMusicPlayerLyrics(){const _0x59e07d=_0x28e739,_0x28e7ce=document[_0x59e07d(0x768)]('.lyrics-container'),_0x355874=document[_0x59e07d(0x42c)](_0x59e07d(0x67c));if(!_0x28e7ce||!_0x355874[_0x59e07d(0x6ea)])return;musicPlayerLyricsInterval&&(clearInterval(musicPlayerLyricsInterval),musicPlayerLyricsInterval=null),_0x355874[_0x59e07d(0x7b6)]((_0x36f71e,_0x1cb440)=>{const _0x46fdf8=_0x59e07d;_0x36f71e['classList'][_0x46fdf8(0x93a)](_0x46fdf8(0x525),_0x1cb440===0x0);}),_0x28e7ce[_0x59e07d(0x577)][_0x59e07d(0x8ed)]=_0x59e07d(0x575);}function initMusicPlayerLyrics(){musicPlayerLyricsInterval&&(clearInterval(musicPlayerLyricsInterval),musicPlayerLyricsInterval=null);if(Array['isArray'](userPlaylistPlaybackLyrics)&&userPlaylistPlaybackLyrics['length']>0x0)return;setTimeout(()=>{const _0x1279d6=_0xc1ca;(!userPlaylistPlaybackLyrics||userPlaylistPlaybackLyrics[_0x1279d6(0x6ea)]===0x0)&&renderUserPlaylistLyrics([]),animateMusicPlayerLyrics();},0x78);}let currentEditingIndex=0x0;function toggleAlbumEditMode(){const _0x32ef69=_0x28e739,_0x25724b=document[_0x32ef69(0x761)](_0x32ef69(0x37d));if(!_0x25724b)return;_0x25724b[_0x32ef69(0x421)][_0x32ef69(0x93a)]('active');}async function saveCharacterAlbums(_0x3d7361,_0x36bfb8){const _0x58008a=_0x28e739;try{const _0x182581=await db[_0x58008a(0x62e)]['where']('characterId')['equals'](_0x3d7361)[_0x58008a(0x830)]();_0x182581?await db[_0x58008a(0x62e)][_0x58008a(0x301)](_0x3d7361,{'covers':_0x36bfb8,'updatedAt':new Date()}):await db[_0x58008a(0x62e)]['add']({'characterId':_0x3d7361,'covers':_0x36bfb8,'createdAt':new Date(),'updatedAt':new Date()}),console['log']('✅\x20专辑封面已保存'),await loadAlbumCoversFromDB();}catch(_0x2ab4af){console[_0x58008a(0x56c)](_0x58008a(0x59e),_0x2ab4af);}}function triggerAlbumImageUpload(_0x2acfda){const _0x27a432=_0x28e739;currentEditingIndex=_0x2acfda;const _0x38915a=document[_0x27a432(0x761)](_0x27a432(0x447));_0x38915a&&_0x38915a['click']();}async function handleAlbumImageUpload(_0x51f727){const _0x183b35=_0x28e739,_0x130484=_0x51f727[_0x183b35(0x6e4)][_0x183b35(0x2f4)][0x0];if(!_0x130484)return;if(!_0x130484[_0x183b35(0x3a3)][_0x183b35(0x414)]('image/')){console[_0x183b35(0x56c)](_0x183b35(0x571));return;}if(_0x130484[_0x183b35(0x2da)]>0x5*0x400*0x400){console[_0x183b35(0x56c)](_0x183b35(0x906));return;}try{const _0x3b6085=new FileReader();_0x3b6085[_0x183b35(0x2d9)]=async _0x21d8d3=>{const _0x11b31b=_0x183b35,_0x3674db=_0x21d8d3[_0x11b31b(0x6e4)][_0x11b31b(0x6c4)],_0x367679=document['querySelectorAll'](_0x11b31b(0x6a8));if(currentEditingIndex<_0x367679[_0x11b31b(0x6ea)]){const _0x4831bb=_0x367679[currentEditingIndex],_0x3c9472=_0x4831bb[_0x11b31b(0x768)](_0x11b31b(0x870));_0x3c9472&&(_0x3c9472[_0x11b31b(0x273)]=_0x3674db);}await saveAlbumCover(currentEditingIndex,_0x3674db);},_0x3b6085[_0x183b35(0x401)](_0x130484);}catch(_0xbd62ad){console[_0x183b35(0x56c)](_0x183b35(0x48f),_0xbd62ad);}_0x51f727[_0x183b35(0x6e4)]['value']='';}async function triggerAlbumUrlInput(_0x3ba085){const _0xa36b8d=_0x28e739;currentEditingIndex=_0x3ba085;const _0x593109=prompt(_0xa36b8d(0x243));if(!_0x593109||!_0x593109[_0xa36b8d(0x28e)]())return;try{new URL(_0x593109);const _0x23a6b5=document[_0xa36b8d(0x42c)](_0xa36b8d(0x6a8));if(_0x3ba085<_0x23a6b5[_0xa36b8d(0x6ea)]){const _0x56d831=_0x23a6b5[_0x3ba085],_0x53f381=_0x56d831[_0xa36b8d(0x768)]('img');_0x53f381&&(_0x53f381[_0xa36b8d(0x273)]=_0x593109,_0x53f381[_0xa36b8d(0x2d9)]=async()=>{await saveAlbumCover(_0x3ba085,_0x593109);},_0x53f381['onerror']=()=>{const _0x5efaf5=_0xa36b8d;console['error'](_0x5efaf5(0x90d)),loadAlbumCoversFromDB();});}}catch(_0x4d7d8b){console[_0xa36b8d(0x56c)](_0xa36b8d(0x90a),_0x4d7d8b);}}async function saveAlbumCover(_0x4e038b,_0x173d16){const _0x59ad43=_0x28e739;if(!currentCharProfileData)return;try{const _0x3be337=currentCharProfileData['id'],_0x129d06=await db['characterAlbums'][_0x59ad43(0x56a)](_0x59ad43(0x3ae))[_0x59ad43(0x82f)](_0x3be337)[_0x59ad43(0x830)]();let _0x23d973=[];_0x129d06&&_0x129d06[_0x59ad43(0x8f1)]?_0x23d973=[..._0x129d06[_0x59ad43(0x8f1)]]:_0x23d973=FIXED_ALBUMS[_0x59ad43(0x962)](_0x4c73a7=>({'url':_0x4c73a7['cover'],'label':_0x4c73a7[_0x59ad43(0x880)]})),_0x23d973[_0x4e038b]={'url':_0x173d16,'label':_0x23d973[_0x4e038b]?.[_0x59ad43(0x880)]||FIXED_ALBUMS[_0x4e038b][_0x59ad43(0x880)]},await saveCharacterAlbums(_0x3be337,_0x23d973),console[_0x59ad43(0x41f)]('✅\x20专辑封面已更新');}catch(_0x33bf02){console[_0x59ad43(0x56c)]('保存封面失败:',_0x33bf02);}}async function loadAlbumCoversFromDB(){const _0x48d5b1=_0x28e739;if(!currentCharProfileData){loadAlbumCovers();return;}try{const _0x5db417=currentCharProfileData['id'],_0x40b830=await db[_0x48d5b1(0x62e)][_0x48d5b1(0x56a)](_0x48d5b1(0x3ae))[_0x48d5b1(0x82f)](_0x5db417)[_0x48d5b1(0x830)]();if(_0x40b830&&_0x40b830[_0x48d5b1(0x8f1)]){const _0x5672ac=document['querySelectorAll'](_0x48d5b1(0x6a8));_0x40b830[_0x48d5b1(0x8f1)][_0x48d5b1(0x7b6)]((_0x54c519,_0x2fec04)=>{const _0x34fbb7=_0x48d5b1;if(_0x2fec04<_0x5672ac[_0x34fbb7(0x6ea)]){const _0x8c01da=_0x5672ac[_0x2fec04],_0x2b78e4=_0x8c01da[_0x34fbb7(0x768)](_0x34fbb7(0x870)),_0x1d147b=_0x8c01da[_0x34fbb7(0x768)](_0x34fbb7(0x468));_0x2b78e4&&_0x54c519[_0x34fbb7(0x7ac)]&&(_0x2b78e4['src']=_0x54c519[_0x34fbb7(0x7ac)],_0x2b78e4[_0x34fbb7(0x53e)]=_0x34fbb7(0x733),_0x2fec04===0x0&&(_0x2b78e4[_0x34fbb7(0x2d9)]=async()=>{try{const _0x47da44=await extractDominantColor(_0x2b78e4);applyPlaylistColor(_0x47da44);}catch(_0x3414aa){console['error']('应用颜色失败:',_0x3414aa);}},_0x2b78e4[_0x34fbb7(0x1cd)]&&extractDominantColor(_0x2b78e4)[_0x34fbb7(0x21f)](_0x20467f=>{applyPlaylistColor(_0x20467f);})['catch'](_0x523cdc=>{const _0x12eb37=_0x34fbb7;console['error'](_0x12eb37(0x7d1),_0x523cdc);}),_0x8c01da[_0x34fbb7(0x462)]=()=>{const _0x4ef169=_0x34fbb7;if(!currentCharProfileData){console[_0x4ef169(0x56c)](_0x4ef169(0x26b));return;}const _0x574d27=currentCharProfileData['id'];console['log']('📔\x20打开日记本，角色ID:',_0x574d27),closeCharProfile(),typeof openCharacterDiary==='function'?openCharacterDiary(_0x574d27):console['error']('日记本功能未找到');})),_0x1d147b&&_0x54c519[_0x34fbb7(0x880)]&&(_0x1d147b[_0x34fbb7(0x7dc)]=_0x54c519[_0x34fbb7(0x880)]);}});}else loadAlbumCovers();}catch(_0x521d6b){console[_0x48d5b1(0x56c)](_0x48d5b1(0x21b),_0x521d6b),loadAlbumCovers();}}let diaryCurrentPage=0x0,diaryTotalPages=0x2,currentDiaryCharacterId=null,currentDiarySessionId=null,currentDiaryProfileId=null,currentDiaryCharacterMeta=null,diaryDedupeArmed=![],diaryDedupeRunning=![],diaryDedupeArmTimeout=null;function ensureDiaryDedupeButton(){const _0xe7a67a=_0x28e739,_0x432b39=document['querySelector'](_0xe7a67a(0x8b1));if(!_0x432b39)return;let _0x36d0ea=document['getElementById'](_0xe7a67a(0x52e));!_0x36d0ea&&(_0x36d0ea=document['createElement']('button'),_0x36d0ea['id']='diaryDedupeBtn',_0x36d0ea['type']=_0xe7a67a(0x52d),_0x36d0ea[_0xe7a67a(0x51f)]=_0xe7a67a(0x690),_0x36d0ea['title']=_0xe7a67a(0x8cc),_0x36d0ea[_0xe7a67a(0x1d9)](_0xe7a67a(0x793),_0xe7a67a(0x848)),_0x36d0ea[_0xe7a67a(0x5b8)]=_0xe7a67a(0x4b0)[_0xe7a67a(0x28e)]()),_0x36d0ea[_0xe7a67a(0x7ec)]!==_0x432b39&&_0x432b39[_0xe7a67a(0x3de)](_0x36d0ea),_0x36d0ea[_0xe7a67a(0x421)][_0xe7a67a(0x93a)](_0xe7a67a(0x76d),diaryDedupeArmed),_0x36d0ea[_0xe7a67a(0x8f5)]=diaryDedupeRunning,_0x36d0ea['setAttribute'](_0xe7a67a(0x48e),diaryDedupeArmed?_0xe7a67a(0x2b2):_0xe7a67a(0x17c)),_0x36d0ea['onclick']=async()=>{const _0x421843=_0xe7a67a;if(diaryDedupeRunning)return;if(!diaryDedupeArmed){diaryDedupeArmed=!![],ensureDiaryDedupeButton(),showIslandNotification(_0x421843(0x55b),_0x421843(0x718),_0x421843(0x537));if(diaryDedupeArmTimeout)clearTimeout(diaryDedupeArmTimeout);diaryDedupeArmTimeout=setTimeout(()=>{diaryDedupeArmed=![],ensureDiaryDedupeButton();},0x2710);return;}diaryDedupeArmed=![];if(diaryDedupeArmTimeout)clearTimeout(diaryDedupeArmTimeout);diaryDedupeArmTimeout=null,diaryDedupeRunning=!![],ensureDiaryDedupeButton();try{await cleanDuplicateDiaryNotes({'requireConfirm':![]});}finally{diaryDedupeRunning=![],ensureDiaryDedupeButton();}};}async function cleanDuplicateDiaryNotes(_0x1ab8fe={}){const _0x19db56=_0x28e739,{mode:mode=_0x19db56(0x751),threshold:threshold=0.9,requireConfirm:requireConfirm=!![]}=_0x1ab8fe,_0x1e5ab5=currentDiaryCharacterId,_0x9104ba=currentDiarySessionId||'default',_0x897573=currentDiaryProfileId||'';if(!_0x1e5ab5){showIslandNotification(_0x19db56(0x355),'No\x20diary\x20character\x20selected',_0x19db56(0x56c));return;}try{showIslandNotification(_0x19db56(0x848),'正在扫描...','info');const _0x5492c7=await dedupeExistingNoteEntries(_0x1e5ab5,_0x9104ba,_0x897573,{'dryRun':!![],'mode':mode,'threshold':threshold}),_0x103cf9=_0x5492c7?.[_0x19db56(0x4e8)]?.['length']||0x0;if(_0x103cf9===0x0){showIslandNotification('完成',_0x19db56(0x360),_0x19db56(0x39d));return;}if(requireConfirm){const _0x5b096c=confirm(_0x19db56(0x27e)+_0x103cf9+_0x19db56(0x726));if(!_0x5b096c){showIslandNotification(_0x19db56(0x25b),_0x19db56(0x638),_0x19db56(0x537));return;}}showIslandNotification(_0x19db56(0x848),'正在删除\x20'+_0x103cf9+_0x19db56(0x26f),'info');const _0x4c8fe5=await dedupeExistingNoteEntries(_0x1e5ab5,_0x9104ba,_0x897573,{'dryRun':![],'mode':mode,'threshold':threshold});showIslandNotification('完成','已清理\x20'+(_0x4c8fe5?.[_0x19db56(0x8fd)]||0x0)+_0x19db56(0x723),_0x19db56(0x39d));const _0x150e7f=currentDiaryCharacterMeta||{'id':_0x1e5ab5,'name':_0x19db56(0x808),'avatar':'','bio':''},_0xb19989=await getDiaryList(_0x1e5ab5,_0x9104ba,_0x897573);let _0x2479ae=[],_0x48a5ab=0x0;try{_0x2479ae=await db['characterDiary'][_0x19db56(0x56a)](_0x19db56(0x7a0))[_0x19db56(0x82f)]([_0x1e5ab5,_0x9104ba,_0x897573])[_0x19db56(0x4e6)](_0x5668e0=>_0x5668e0[_0x19db56(0x3a3)]===_0x19db56(0x6a1))['toArray'](),_0x48a5ab=_0x2479ae[_0x19db56(0x6ea)];}catch(_0x56911b){console[_0x19db56(0x516)](_0x19db56(0x176),_0x56911b);}const _0xaeb670=await getCoverStyle(_0x1e5ab5,_0x9104ba,_0x897573);if(_0xaeb670)applyCoverStyle(_0xaeb670);renderDiaryCover(_0x150e7f,_0xb19989,_0x48a5ab,_0xaeb670);const _0x3d8637=new Set(_0xb19989[_0x19db56(0x962)](_0x1a8069=>_0x1a8069['date'])),_0x2bdfc4=new Set();_0x2479ae['forEach'](_0x25dab2=>{const _0x37eceb=_0x19db56;if(!_0x3d8637[_0x37eceb(0x345)](_0x25dab2[_0x37eceb(0x192)]))_0x2bdfc4[_0x37eceb(0x5e3)](_0x25dab2[_0x37eceb(0x192)]);}),await renderDiaryPages(_0xb19989,_0x1e5ab5,_0x9104ba,_0x897573,_0x2479ae),diaryCurrentPage=0x0,diaryTotalPages=0x2+_0xb19989[_0x19db56(0x6ea)]+_0x2bdfc4[_0x19db56(0x2da)];const _0x16e979=document[_0x19db56(0x42c)](_0x19db56(0x287));_0x16e979[_0x19db56(0x7b6)](_0x42929e=>_0x42929e['classList'][_0x19db56(0x403)]('flipped')),updateDiaryZ(),ensureDiaryDedupeButton();}catch(_0x3ccf3b){console['error']('清理重复笔记失败:',_0x3ccf3b),showIslandNotification(_0x19db56(0x355),_0x19db56(0x4d9),_0x19db56(0x56c));}}let stickyDragState={'isDragging':![],'currentSticky':null,'startX':0x0,'startY':0x0,'offsetX':0x0,'offsetY':0x0,'noteId':null,'originalRotate':'','pageEl':null},saveStickyPositionTimeout=null;function saveStickyPositionDebounced(_0x2843c5,_0x13e6c6,_0x3f515f){saveStickyPositionTimeout&&clearTimeout(saveStickyPositionTimeout),saveStickyPositionTimeout=setTimeout(async()=>{const _0x156153=_0xc1ca;try{await db['characterDiary']['update'](_0x2843c5,{'positionX':_0x13e6c6,'positionY':_0x3f515f}),console[_0x156153(0x41f)](_0x156153(0x587)+_0x2843c5+_0x156153(0x67f)+_0x13e6c6+_0x156153(0x7cc)+_0x3f515f);}catch(_0x5bb07d){console[_0x156153(0x516)](_0x156153(0x94a),_0x5bb07d);}},0x12c);}let stickyDragGlobalListenersAttached=![];function getStickyDragPageBounds(){const _0x229b72=_0x28e739,_0x212f48=stickyDragState['pageEl'];if(!_0x212f48)return null;const _0x42f3e1=_0x212f48[_0x229b72(0x768)](_0x229b72(0x1e4));if(!_0x42f3e1)return null;return _0x42f3e1[_0x229b72(0x627)]();}function handleStickyDragMove(_0xdde156){const _0x1e7422=_0x28e739;if(!stickyDragState['isDragging']||!stickyDragState[_0x1e7422(0x832)])return;_0xdde156['preventDefault']();const _0x143a74=stickyDragState[_0x1e7422(0x832)],_0x790a39=_0xdde156['touches']?_0xdde156[_0x1e7422(0x1b0)][0x0]:_0xdde156,_0x309cfb=getStickyDragPageBounds();if(!_0x309cfb)return;let _0x28560f=_0x790a39[_0x1e7422(0x6b3)]-_0x309cfb['left']-stickyDragState[_0x1e7422(0x313)],_0x30d40e=_0x790a39[_0x1e7422(0x8f2)]-_0x309cfb[_0x1e7422(0x78d)]-stickyDragState[_0x1e7422(0x25c)];const _0x3aacc1=_0x143a74[_0x1e7422(0x1d3)]||0x55,_0x48bc7e=_0x143a74[_0x1e7422(0x4b5)]||0x3c,_0x5b5097=_0x309cfb['width']-_0x3aacc1-0x5,_0x20f44f=_0x309cfb[_0x1e7422(0x5ea)]-_0x48bc7e-0x28,_0x141136=0x5,_0x2279c1=0x50;_0x28560f=Math[_0x1e7422(0x738)](_0x141136,Math[_0x1e7422(0x730)](_0x5b5097,_0x28560f)),_0x30d40e=Math[_0x1e7422(0x738)](_0x2279c1,Math[_0x1e7422(0x730)](_0x20f44f,_0x30d40e)),_0x143a74[_0x1e7422(0x577)][_0x1e7422(0x460)]=_0x28560f+'px',_0x143a74[_0x1e7422(0x577)][_0x1e7422(0x78d)]=_0x30d40e+'px',_0x143a74['style'][_0x1e7422(0x29a)]=_0x1e7422(0x4e2),_0x143a74['style'][_0x1e7422(0x5db)]=_0x1e7422(0x4e2);}function handleStickyDragEnd(){const _0x94823a=_0x28e739;if(!stickyDragState[_0x94823a(0x357)]||!stickyDragState[_0x94823a(0x832)])return;const _0x5c81b4=stickyDragState[_0x94823a(0x832)],_0x3be5dd=stickyDragState[_0x94823a(0x2fe)],_0x3911ca=getStickyDragPageBounds();if(_0x3911ca){const _0x12e6c0=_0x5c81b4[_0x94823a(0x627)](),_0x24dd34=_0x12e6c0[_0x94823a(0x460)]-_0x3911ca[_0x94823a(0x460)],_0xb5581e=_0x12e6c0[_0x94823a(0x78d)]-_0x3911ca[_0x94823a(0x78d)];_0x3be5dd&&saveStickyPositionDebounced(_0x3be5dd,Math[_0x94823a(0x247)](_0x24dd34),Math['round'](_0xb5581e));}_0x5c81b4[_0x94823a(0x421)]['remove'](_0x94823a(0x545)),_0x5c81b4['style']['zIndex']='',_0x5c81b4['style'][_0x94823a(0x5cb)]=_0x94823a(0x6f6),stickyDragState[_0x94823a(0x1b2)]&&(_0x5c81b4[_0x94823a(0x577)][_0x94823a(0x8ed)]=stickyDragState['originalRotate']),stickyDragState[_0x94823a(0x357)]=![],stickyDragState[_0x94823a(0x832)]=null,stickyDragState[_0x94823a(0x2fe)]=null,stickyDragState[_0x94823a(0x1b2)]='',stickyDragState[_0x94823a(0x763)]=null;}function ensureStickyDragGlobalListeners(){const _0x1a6d7d=_0x28e739;if(stickyDragGlobalListenersAttached)return;stickyDragGlobalListenersAttached=!![],document[_0x1a6d7d(0x55d)](_0x1a6d7d(0x327),handleStickyDragMove),document['addEventListener']('touchmove',handleStickyDragMove,{'passive':![]}),document[_0x1a6d7d(0x55d)](_0x1a6d7d(0x264),handleStickyDragEnd),document['addEventListener'](_0x1a6d7d(0x279),handleStickyDragEnd);}function initStickyDrag(_0x3550f4,_0xcb780f,_0x134349){const _0x1ea944=_0x28e739;if(!_0x3550f4||!_0xcb780f)return;ensureStickyDragGlobalListeners(),_0x3550f4[_0x1ea944(0x577)]['cursor']=_0x1ea944(0x6f6),_0x3550f4['dataset']['noteId']=_0xcb780f;let _0x5c774b='';const _0x3445ba=window[_0x1ea944(0x548)](_0x3550f4),_0x12dca1=_0x3445ba[_0x1ea944(0x8ed)];if(_0x12dca1&&_0x12dca1!=='none'){const _0x5ab002=_0x12dca1[_0x1ea944(0x4c7)]('(')[0x1][_0x1ea944(0x4c7)](')')[0x0][_0x1ea944(0x4c7)](','),_0x1c7f4c=parseFloat(_0x5ab002[0x0]),_0x265914=parseFloat(_0x5ab002[0x1]),_0x5eea7f=Math[_0x1ea944(0x247)](Math[_0x1ea944(0x2e7)](_0x265914,_0x1c7f4c)*(0xb4/Math['PI'])*0xa)/0xa;_0x5c774b='rotate('+_0x5eea7f+_0x1ea944(0x845);}const _0x40ef73=_0x49ca26=>{const _0x2ec1e5=_0x1ea944;if(_0x49ca26['target']['classList'][_0x2ec1e5(0x6e3)]('diary-sticky-delete'))return;_0x49ca26['preventDefault'](),_0x49ca26[_0x2ec1e5(0x722)]();const _0x3aced1=_0x49ca26['touches']?_0x49ca26[_0x2ec1e5(0x1b0)][0x0]:_0x49ca26,_0x345fa6=_0x3550f4[_0x2ec1e5(0x627)]();stickyDragState[_0x2ec1e5(0x357)]=!![],stickyDragState[_0x2ec1e5(0x832)]=_0x3550f4,stickyDragState['noteId']=_0xcb780f,stickyDragState[_0x2ec1e5(0x763)]=_0x134349,stickyDragState[_0x2ec1e5(0x2e3)]=_0x3aced1[_0x2ec1e5(0x6b3)],stickyDragState[_0x2ec1e5(0x5e1)]=_0x3aced1[_0x2ec1e5(0x8f2)],stickyDragState['offsetX']=_0x3aced1[_0x2ec1e5(0x6b3)]-_0x345fa6['left'],stickyDragState[_0x2ec1e5(0x25c)]=_0x3aced1[_0x2ec1e5(0x8f2)]-_0x345fa6[_0x2ec1e5(0x78d)],stickyDragState['originalRotate']=_0x5c774b,_0x3550f4[_0x2ec1e5(0x421)]['add'](_0x2ec1e5(0x545)),_0x3550f4[_0x2ec1e5(0x577)][_0x2ec1e5(0x33c)]=_0x2ec1e5(0x697),_0x3550f4[_0x2ec1e5(0x577)][_0x2ec1e5(0x5cb)]=_0x2ec1e5(0x54e);};_0x3550f4[_0x1ea944(0x55d)](_0x1ea944(0x1f2),_0x40ef73),_0x3550f4[_0x1ea944(0x55d)]('touchstart',_0x40ef73,{'passive':![]});}function applyCoverStyle(_0x223313){const _0x21b38a=_0x28e739;if(!_0x223313||!_0x223313[_0x21b38a(0x93f)])return;const _0x4ea8e5=document[_0x21b38a(0x761)](_0x21b38a(0x209));if(!_0x4ea8e5)return;Object[_0x21b38a(0x92a)](_0x223313[_0x21b38a(0x93f)])[_0x21b38a(0x7b6)](([_0x34a8ef,_0x3c1906])=>{const _0x19b72d=_0x21b38a;if(_0x34a8ef[_0x19b72d(0x414)](_0x19b72d(0x39f))){if(_0x34a8ef===_0x19b72d(0x1bd)&&!isNeutralDiaryPageColor(_0x3c1906)){_0x4ea8e5['style']['removeProperty'](_0x34a8ef);return;}_0x4ea8e5['style'][_0x19b72d(0x4c5)](_0x34a8ef,_0x3c1906),console[_0x19b72d(0x41f)](_0x19b72d(0x841)+_0x34a8ef+':\x20'+_0x3c1906);}});const _0x3db28c=_0x223313[_0x21b38a(0x93f)][_0x21b38a(0x487)];if(_0x3db28c){const _0xdd3e38=isLightColor(_0x3db28c);_0xdd3e38?_0x4ea8e5[_0x21b38a(0x577)][_0x21b38a(0x4c5)]('--diary-spine',_0x21b38a(0x302)):_0x4ea8e5['style']['setProperty'](_0x21b38a(0x65b),_0x21b38a(0x3f6));}}function isLightColor(_0x352755){const _0x3f81a=_0x28e739;if(_0x352755[_0x3f81a(0x414)]('#')){const _0x19108e=_0x352755['slice'](0x1),_0x452cab=parseInt(_0x19108e['substr'](0x0,0x2),0x10),_0x3786be=parseInt(_0x19108e['substr'](0x2,0x2),0x10),_0x29a121=parseInt(_0x19108e['substr'](0x4,0x2),0x10),_0x24b12a=(_0x452cab*0x12b+_0x3786be*0x24b+_0x29a121*0x72)/0x3e8;return _0x24b12a>0x80;}return!![];}function isNeutralDiaryPageColor(_0x24944b){const _0x49d9ae=_0x28e739;if(!_0x24944b||typeof _0x24944b!==_0x49d9ae(0x7a1))return![];if(!_0x24944b[_0x49d9ae(0x414)]('#')||_0x24944b[_0x49d9ae(0x6ea)]!==0x7)return![];const _0x3e671a=_0x24944b[_0x49d9ae(0x73d)](0x1),_0x5a74bd=parseInt(_0x3e671a[_0x49d9ae(0x2d3)](0x0,0x2),0x10),_0x32490a=parseInt(_0x3e671a[_0x49d9ae(0x2d3)](0x2,0x2),0x10),_0x287a13=parseInt(_0x3e671a[_0x49d9ae(0x2d3)](0x4,0x2),0x10);if([_0x5a74bd,_0x32490a,_0x287a13]['some'](_0x4a96e4=>Number[_0x49d9ae(0x222)](_0x4a96e4)))return![];const _0xe709dd=Math[_0x49d9ae(0x738)](_0x5a74bd,_0x32490a,_0x287a13),_0x358da9=Math[_0x49d9ae(0x730)](_0x5a74bd,_0x32490a,_0x287a13);return _0xe709dd-_0x358da9<=0x18;}async function showPasswordDialog(_0xfe3f87){return new Promise(_0x27e9d2=>{const _0x44d940=_0xc1ca;console[_0x44d940(0x41f)](_0x44d940(0x194),_0xfe3f87[_0x44d940(0x4e7)]);let _0x1b5a6d=0x0;const _0xc5ca6d=0x5,_0x4c9f16=_0xfe3f87[_0x44d940(0x4e7)]||{},_0x1ca2b5=_0x4c9f16['styles']||{},_0x749c20=document[_0x44d940(0x5e5)](_0x44d940(0x6a4));_0x749c20[_0x44d940(0x577)][_0x44d940(0x426)]=_0x44d940(0x182);const _0x3caf9f=document['createElement'](_0x44d940(0x6a4));_0x3caf9f['style']['cssText']=(_0x1ca2b5[_0x44d940(0x4e3)]||_0x44d940(0x1bb))+_0x44d940(0x8eb);if(_0x4c9f16[_0x44d940(0x872)]){const _0x27fd56=document[_0x44d940(0x5e5)](_0x44d940(0x6a4));_0x27fd56['innerHTML']=_0x4c9f16[_0x44d940(0x872)],_0x27fd56['style'][_0x44d940(0x426)]=_0x1ca2b5['decor']||'',_0x3caf9f['appendChild'](_0x27fd56);}const _0x567356=document[_0x44d940(0x5e5)](_0x44d940(0x6a4));_0x567356[_0x44d940(0x7dc)]=_0x4c9f16[_0x44d940(0x91f)]||_0x44d940(0x4ee),_0x567356[_0x44d940(0x577)][_0x44d940(0x426)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#333;\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x3caf9f['appendChild'](_0x567356);const _0x560c68=document[_0x44d940(0x5e5)](_0x44d940(0x914));_0x560c68[_0x44d940(0x3a3)]=_0x44d940(0x2ca),_0x560c68[_0x44d940(0x4ba)]=_0x4c9f16[_0x44d940(0x17f)]||_0x44d940(0x1a3),_0x560c68[_0x44d940(0x577)][_0x44d940(0x426)]=_0x1ca2b5[_0x44d940(0x914)]||_0x44d940(0x684),_0x3caf9f[_0x44d940(0x3de)](_0x560c68);const _0x23f4a9=document['createElement']('div');_0x23f4a9['style'][_0x44d940(0x426)]=_0x1ca2b5[_0x44d940(0x56c)]||_0x44d940(0x5c6),_0x3caf9f[_0x44d940(0x3de)](_0x23f4a9);const _0x282c08=document['createElement'](_0x44d940(0x6a4));_0x282c08[_0x44d940(0x577)][_0x44d940(0x426)]=(_0x1ca2b5['hint']||_0x44d940(0x307))+';\x20display:\x20none;',_0x282c08['textContent']=_0x4c9f16[_0x44d940(0x7ab)]||'提示：'+(_0xfe3f87[_0x44d940(0x312)]||_0x44d940(0x58c)),_0x3caf9f['appendChild'](_0x282c08);const _0x2b97f7=document[_0x44d940(0x5e5)](_0x44d940(0x52d));_0x2b97f7['textContent']=_0x4c9f16[_0x44d940(0x181)]||'确认',_0x2b97f7[_0x44d940(0x577)][_0x44d940(0x426)]=_0x1ca2b5['button']||_0x44d940(0x4d6),_0x3caf9f['appendChild'](_0x2b97f7);const _0x5b6948=()=>{const _0x25a016=_0x44d940,_0x3977fa=_0x560c68[_0x25a016(0x29c)][_0x25a016(0x28e)]();_0x3977fa===_0xfe3f87[_0x25a016(0x2ca)]?(document[_0x25a016(0x4c0)][_0x25a016(0x72d)](_0x749c20),_0x27e9d2(!![])):(_0x1b5a6d++,_0x1b5a6d>=_0xc5ca6d?(_0x23f4a9[_0x25a016(0x7dc)]=_0x4c9f16[_0x25a016(0x7f4)]||_0x25a016(0x3a6),_0x282c08['style'][_0x25a016(0x475)]=_0x25a016(0x78e)):_0x23f4a9[_0x25a016(0x7dc)]=_0x4c9f16[_0x25a016(0x7f4)]||_0x25a016(0x1d2)+(_0xc5ca6d-_0x1b5a6d)+'次',_0x560c68[_0x25a016(0x29c)]='',_0x560c68[_0x25a016(0x7bf)]());};_0x2b97f7[_0x44d940(0x55d)](_0x44d940(0x7bd),_0x5b6948),_0x560c68[_0x44d940(0x55d)](_0x44d940(0x437),_0x13ee7b=>{const _0xdcf142=_0x44d940;_0x13ee7b[_0xdcf142(0x5f8)]==='Enter'&&_0x5b6948();});const _0x4ed467=_0x188ad1=>{const _0x47aa9d=_0x44d940;_0x188ad1['key']===_0x47aa9d(0x88b)&&(document[_0x47aa9d(0x4c0)][_0x47aa9d(0x72d)](_0x749c20),document[_0x47aa9d(0x210)]('keydown',_0x4ed467),_0x27e9d2(![]));};document[_0x44d940(0x55d)](_0x44d940(0x6d3),_0x4ed467),_0x749c20[_0x44d940(0x55d)]('click',_0x5b1e1c=>{const _0x57aba0=_0x44d940;_0x5b1e1c[_0x57aba0(0x6e4)]===_0x749c20&&(document[_0x57aba0(0x4c0)][_0x57aba0(0x72d)](_0x749c20),document['removeEventListener']('keydown',_0x4ed467),_0x27e9d2(![]));}),_0x749c20[_0x44d940(0x3de)](_0x3caf9f),document[_0x44d940(0x4c0)][_0x44d940(0x3de)](_0x749c20),_0x560c68[_0x44d940(0x7bf)]();});}async function openCharacterDiary(_0x37a698){const _0xd4905a=_0x28e739,_0x599177=document[_0xd4905a(0x761)](_0xd4905a(0x209));if(!_0x599177)return;if(diaryRenderRunning){console[_0xd4905a(0x41f)]('⏳\x20日记本正在渲染，忽略重复打开请求');return;}diaryRenderRunning=!![];const _0x1daf71=++diaryRenderToken,_0x1b8430=document[_0xd4905a(0x761)]('diaryBook');if(_0x1b8430)_0x1b8430[_0xd4905a(0x421)][_0xd4905a(0x5e3)](_0xd4905a(0x523));try{_0x37a698=normalizeId(_0x37a698),currentDiaryCharacterId=_0x37a698;let _0x3c6e10=null;try{const _0x300da8=await getCharacterById(_0x37a698);if(_0x300da8){const _0x589b87=await db['chatSettings'][_0xd4905a(0x309)](normalizeId(currentChatId)),_0x168b6a=resolveChatDisplayName(null,{'chatSettings':_0x589b87,'fallbackName':_0x300da8[_0xd4905a(0x76a)]||'','defaultName':'Unknown'});_0x3c6e10={'id':_0x37a698,'name':_0x168b6a,'originalName':_0x300da8[_0xd4905a(0x76a)]||_0xd4905a(0x3fe),'avatar':_0x300da8[_0xd4905a(0x6ff)]?.[_0xd4905a(0x922)]||'','bio':_0x300da8[_0xd4905a(0x61c)]||_0xd4905a(0x801)};}}catch(_0x58629d){console[_0xd4905a(0x516)]('Failed\x20to\x20get\x20character\x20data:',_0x58629d);}!_0x3c6e10&&(_0x3c6e10={'id':_0x37a698,'name':_0xd4905a(0x3fe),'avatar':'','bio':_0xd4905a(0x801)});let _0x4de036=null;try{const _0x32324e=await db[_0xd4905a(0x30f)]['get'](currentChatId);if(_0x32324e?.['userProfileId']&&_0x32324e['userProfileId']!==_0xd4905a(0x714)&&_0x32324e['userProfileId']!==_0xd4905a(0x64a))_0x4de036=_0x32324e[_0xd4905a(0x96c)];else{const _0x499994=await db['globalSettings'][_0xd4905a(0x309)](_0xd4905a(0x619));_0x4de036=_0x499994?.[_0xd4905a(0x29c)]||null;}}catch(_0x3b1a2f){console[_0xd4905a(0x516)](_0xd4905a(0x298),_0x3b1a2f);}const _0x5de4b1=currentSessionId||'default',_0x11bff6=_0x4de036||'';currentDiarySessionId=_0x5de4b1,currentDiaryProfileId=_0x11bff6,currentDiaryCharacterMeta=_0x3c6e10,diaryDedupeArmed=![],diaryDedupeRunning=![];if(diaryDedupeArmTimeout)clearTimeout(diaryDedupeArmTimeout);diaryDedupeArmTimeout=null;const _0x14b6a3=await getDiaryPassword(_0x37a698,_0x5de4b1,_0x11bff6);if(_0x14b6a3&&_0x14b6a3[_0xd4905a(0x2ca)]){const _0x4f302c=await getDiaryUnlockState(_0x37a698,_0x5de4b1,_0x11bff6);if(!_0x4f302c){const _0x28f7eb=await showPasswordDialog(_0x14b6a3);if(!_0x28f7eb)return;await setDiaryUnlockState(_0x37a698,_0x5de4b1,_0x11bff6,!![]);}}await recordDiaryView(_0x37a698,_0x5de4b1,_0x11bff6);let _0x2bef5a=[];try{_0x2bef5a=await getDiaryList(_0x37a698,_0x5de4b1,_0x11bff6);}catch(_0x33e941){console[_0xd4905a(0x56c)](_0xd4905a(0x456),_0x33e941),showIslandNotification('错误',_0xd4905a(0x29f),_0xd4905a(0x537)),_0x2bef5a=[];}let _0x21a3fd=[],_0x133639=0x0;try{_0x21a3fd=await db[_0xd4905a(0x499)][_0xd4905a(0x56a)](_0xd4905a(0x7a0))[_0xd4905a(0x82f)]([_0x37a698,_0x5de4b1,_0x11bff6])['and'](_0x2a6e06=>_0x2a6e06[_0xd4905a(0x3a3)]===_0xd4905a(0x6a1))[_0xd4905a(0x5fd)](),_0x133639=_0x21a3fd[_0xd4905a(0x6ea)];}catch(_0x3e9bf4){console[_0xd4905a(0x516)](_0xd4905a(0x176),_0x3e9bf4);}const _0x32daa8=await getCoverStyle(_0x37a698,_0x5de4b1,_0x11bff6);_0x32daa8&&(console['log'](_0xd4905a(0x2e4),_0x32daa8[_0xd4905a(0x29d)]||_0xd4905a(0x3fa)),applyCoverStyle(_0x32daa8));renderDiaryCover(_0x3c6e10,_0x2bef5a,_0x133639,_0x32daa8),ensureDiaryDedupeButton();const _0x17bb55=new Set(_0x2bef5a['map'](_0x5f12cb=>_0x5f12cb[_0xd4905a(0x192)])),_0x51ce73=new Set();_0x21a3fd[_0xd4905a(0x7b6)](_0x3405ea=>{const _0x20afdf=_0xd4905a;!_0x17bb55['has'](_0x3405ea[_0x20afdf(0x192)])&&_0x51ce73[_0x20afdf(0x5e3)](_0x3405ea[_0x20afdf(0x192)]);});const _0x2f66b6=_0x51ce73[_0xd4905a(0x2da)];await renderDiaryPages(_0x2bef5a,_0x37a698,_0x5de4b1,_0x11bff6,_0x21a3fd),diaryCurrentPage=0x0,diaryTotalPages=0x2+_0x2bef5a[_0xd4905a(0x6ea)]+_0x2f66b6;const _0x2586f3=document[_0xd4905a(0x42c)](_0xd4905a(0x287));_0x2586f3[_0xd4905a(0x7b6)](_0x315108=>_0x315108['classList']['remove'](_0xd4905a(0x81f))),updateDiaryZ(),_0x1b8430&&_0x1daf71===diaryRenderToken&&(await new Promise(_0xf7679d=>requestAnimationFrame(_0xf7679d)),_0x1b8430[_0xd4905a(0x421)][_0xd4905a(0x403)](_0xd4905a(0x523))),_0x599177[_0xd4905a(0x421)][_0xd4905a(0x5e3)](_0xd4905a(0x525));}finally{if(_0x1daf71===diaryRenderToken){diaryRenderRunning=![];if(_0x1b8430)_0x1b8430['classList'][_0xd4905a(0x403)](_0xd4905a(0x523));}}}function closeDiary(){const _0x522ef9=_0x28e739,_0x2811c5=document[_0x522ef9(0x761)]('diaryOverlay');_0x2811c5&&_0x2811c5['classList']['remove'](_0x522ef9(0x525));currentDiaryCharacterId=null,currentDiarySessionId=null,currentDiaryProfileId=null,currentDiaryCharacterMeta=null,diaryRenderData=null,diaryPageCache[_0x522ef9(0x886)](),stickyDragState[_0x522ef9(0x357)]=![],stickyDragState[_0x522ef9(0x832)]=null,stickyDragState[_0x522ef9(0x763)]=null,diaryDedupeArmed=![],diaryDedupeRunning=![];if(diaryDedupeArmTimeout)clearTimeout(diaryDedupeArmTimeout);diaryDedupeArmTimeout=null;}function renderDiaryCover(_0x10bc42,_0x59eaec=[],_0x4eb757=0x0,_0x127615=null){const _0x2d7844=_0x28e739;if(_0x127615&&_0x127615[_0x2d7844(0x7b9)]){const _0x41f9aa=document[_0x2d7844(0x768)](_0x2d7844(0x871));if(_0x41f9aa){let _0x174389=_0x127615['coverHTML'][_0x2d7844(0x568)](/\{\{name\}\}/g,_0x10bc42[_0x2d7844(0x76a)]||_0x2d7844(0x808))[_0x2d7844(0x568)](/\{\{char\}\}/g,_0x10bc42[_0x2d7844(0x76a)]||_0x2d7844(0x808))['replace'](/\{\{days\}\}/g,_0x59eaec['length']['toString']())['replace'](/\{\{notes\}\}/g,_0x4eb757[_0x2d7844(0x7f6)]())[_0x2d7844(0x568)](/\{\{bio\}\}/g,_0x10bc42['bio']||'私人日记...')['replace'](/\{\{date\}\}/g,new Date()[_0x2d7844(0x7db)]()[_0x2d7844(0x4c7)]('T')[0x0]);_0x41f9aa[_0x2d7844(0x5b8)]=_0x2d7844(0x36a)+_0x174389+_0x2d7844(0x4ab);const _0x28d540=document[_0x2d7844(0x5e5)]('div');_0x28d540['className']=_0x2d7844(0x4f2),_0x28d540['onclick']=closeDiary,_0x28d540['innerHTML']=_0x2d7844(0x2f9),_0x41f9aa[_0x2d7844(0x49c)](_0x28d540,_0x41f9aa['firstChild']);const _0xe19710=document['createElement'](_0x2d7844(0x6a4));_0xe19710[_0x2d7844(0x51f)]='diary-flip-btn\x20next',_0xe19710[_0x2d7844(0x462)]=()=>diaryFlip(0x1),_0xe19710[_0x2d7844(0x5b8)]=_0x2d7844(0x8d7),_0x41f9aa[_0x2d7844(0x3de)](_0xe19710);return;}}const _0x54d37e=document[_0x2d7844(0x761)](_0x2d7844(0x5d4));if(_0x54d37e)_0x54d37e[_0x2d7844(0x7dc)]=_0x10bc42[_0x2d7844(0x76a)]||_0x2d7844(0x7f2);const _0x1e6b88=document[_0x2d7844(0x761)](_0x2d7844(0x418));if(_0x1e6b88){if(_0x10bc42['avatar'])_0x1e6b88[_0x2d7844(0x273)]=_0x10bc42[_0x2d7844(0x708)],_0x1e6b88[_0x2d7844(0x577)][_0x2d7844(0x475)]=_0x2d7844(0x78e);else{_0x1e6b88[_0x2d7844(0x577)][_0x2d7844(0x475)]=_0x2d7844(0x562);const _0x4f1219=document[_0x2d7844(0x761)](_0x2d7844(0x554));if(_0x4f1219)_0x4f1219['textContent']='?';}}const _0x2351a3=document[_0x2d7844(0x761)](_0x2d7844(0x297));if(_0x2351a3)_0x2351a3[_0x2d7844(0x7dc)]=_0x10bc42[_0x2d7844(0x61c)]||_0x2d7844(0x801);const _0x44356f=document[_0x2d7844(0x761)](_0x2d7844(0x2f5)),_0x1b9845=document['getElementById'](_0x2d7844(0x253)),_0x347f5d=document[_0x2d7844(0x761)](_0x2d7844(0x1ac)),_0x44f185=_0x59eaec['length'];if(_0x44356f)_0x44356f['textContent']=_0x44f185[_0x2d7844(0x7f6)]();if(_0x1b9845)_0x1b9845[_0x2d7844(0x7dc)]=_0x4eb757[_0x2d7844(0x7f6)]();let _0x1cbd0c='--';if(_0x59eaec['length']>0x0){const _0x5579d2=_0x59eaec[_0x59eaec[_0x2d7844(0x6ea)]-0x1];if(_0x5579d2[_0x2d7844(0x192)]){const _0x2712f3=new Date(_0x5579d2[_0x2d7844(0x192)]);_0x1cbd0c=_0x2712f3['getMonth']()+0x1+'/'+_0x2712f3['getDate']();}}if(_0x347f5d)_0x347f5d['textContent']=_0x1cbd0c;const _0x968d1f=document[_0x2d7844(0x761)](_0x2d7844(0x921));if(_0x968d1f){if(_0x59eaec[_0x2d7844(0x6ea)]>0x0){const _0xcee8ba=_0x59eaec[_0x59eaec[_0x2d7844(0x6ea)]-0x1];_0x968d1f[_0x2d7844(0x7dc)]=_0x2d7844(0x3ff)+(_0xcee8ba[_0x2d7844(0x192)]||'--');}else _0x968d1f[_0x2d7844(0x7dc)]=_0x2d7844(0x35a);}const _0x50671d=document['getElementById'](_0x2d7844(0x863));_0x50671d&&(_0x50671d['style'][_0x2d7844(0x475)]=_0x59eaec[_0x2d7844(0x6ea)]>0x0?_0x2d7844(0x562):_0x2d7844(0x439));}const diaryPageCache=new Map();let diaryLazyLoadEnabled=!![],diaryRenderData=null,diaryRenderRunning=![],diaryRenderToken=0x0;function lazyRenderDiaryPage(_0x287b11){const _0x5a1e92=_0x28e739;if(!diaryRenderData||!diaryLazyLoadEnabled)return;ensureDiaryStyleInjected();const {diaryEntries:_0x43564b,characterId:_0x233ca3,sessionId:_0x3b8776,profileId:_0x1cb71c,notesByDate:_0x580572,moodIcons:_0x583ccd,stickyColors:_0x2876c0,stickyLabels:_0x24bc97}=diaryRenderData,_0x569b42=_0x287b11-0x2;if(_0x569b42<0x0||_0x569b42>=_0x43564b[_0x5a1e92(0x6ea)])return;const _0x53c2d2=document[_0x5a1e92(0x761)]('diaryPage'+_0x287b11);if(!_0x53c2d2||!_0x53c2d2[_0x5a1e92(0x672)]['lazyLoad'])return;const _0xda8c0c=_0x43564b[_0x569b42],_0x406235=_0x580572[_0xda8c0c[_0x5a1e92(0x192)]]||[],_0x409dba=document[_0x5a1e92(0x5e5)](_0x5a1e92(0x6a4));_0x409dba[_0x5a1e92(0x51f)]=_0x5a1e92(0x6d6),_0x409dba['id']=_0x5a1e92(0x466)+_0x287b11;const _0x491d24=new Date(_0xda8c0c[_0x5a1e92(0x192)]),_0x1e812c=[_0x5a1e92(0x916),'Monday','Tuesday',_0x5a1e92(0x8be),_0x5a1e92(0x5be),_0x5a1e92(0x853),_0x5a1e92(0x23e)],_0x1d3265=_0x1e812c[_0x491d24[_0x5a1e92(0x935)]()],_0x292542=_0x491d24['getFullYear'](),_0x51dbe2=String(_0x491d24[_0x5a1e92(0x36d)]()+0x1)[_0x5a1e92(0x90f)](0x2,'0'),_0x4f1c8b=String(_0x491d24['getDate']())['padStart'](0x2,'0'),_0x2957d5=_0x292542+'.'+_0x51dbe2+'.'+_0x4f1c8b,_0x413d58=_0x51dbe2+'/'+_0x4f1c8b,_0x118020=_0xda8c0c[_0x5a1e92(0x8a2)]||'',_0x4ad5d0=_0x583ccd[_0x118020]||_0x583ccd[_0x118020[_0x5a1e92(0x6eb)]()]||'◇',_0x163ddf=normalizeDiaryContentHtml(_0xda8c0c[_0x5a1e92(0x632)]),_0x4929b3=shouldCollapseDiaryContent(_0x163ddf),_0x38ac6c=_0x4929b3?_0x5a1e92(0x2aa):'diary-entry-content',_0x279377=_0x4929b3?'<button\x20class=\x22diary-entry-toggle\x22\x20type=\x22button\x22\x20aria-expanded=\x22false\x22>展开全文</button>':'';let _0x2f8766='';if(_0x406235[_0x5a1e92(0x6ea)]>0x0){const _0x288089=_0x3b1081=>{const _0x2d3378=_0x5a1e92,_0x468c82=Math[_0x2d3378(0x947)](_0x3b1081)*0x2710;return _0x468c82-Math['floor'](_0x468c82);},_0x510a07={'right':{'minTop':0xb4,'maxTop':0x1a4,'minRight':0x14,'maxRight':0x28,'side':_0x5a1e92(0x29a)},'bottom':{'minBottom':0x5a,'maxBottom':0x82,'minLeft':0x28,'maxLeft':0xc8,'side':_0x5a1e92(0x5db)}},_0x3740b5=[],_0x7069c8=(_0x4f7bdb,_0x892705,_0x2163fa)=>{const _0x2c5e5c=_0x5a1e92;for(const _0x5b719d of _0x3740b5){const _0x3f6eba=Math[_0x2c5e5c(0x268)](_0x4f7bdb['x']-_0x5b719d['x']),_0x38a5d8=Math['abs'](_0x4f7bdb['y']-_0x5b719d['y']);if(_0x3f6eba<(_0x892705+_0x5b719d['width'])/0x2+0x19&&_0x38a5d8<(_0x2163fa+_0x5b719d['height'])/0x2+0x19)return!![];}return![];};_0x406235[_0x5a1e92(0x7b6)]((_0x4bbef7,_0x45d080)=>{const _0x104323=_0x5a1e92,_0x3b6fe8=_0x4bbef7[_0x104323(0x3e9)]||_0x2876c0[_0x45d080%_0x2876c0['length']],_0x362830=_0x24bc97[_0x45d080%_0x24bc97[_0x104323(0x6ea)]],_0x392412=0x55,_0x34d915=0x3c,_0x5cdd30=_0x4bbef7['positionX']!==undefined&&_0x4bbef7[_0x104323(0x7c1)]!==undefined;let _0x3d2d02='width:\x20'+_0x392412+_0x104323(0x454);if(_0x5cdd30)_0x3d2d02+=_0x104323(0x95a)+_0x4bbef7[_0x104323(0x5b1)]+_0x104323(0x1e7)+_0x4bbef7['positionY']+_0x104323(0x454);else{const _0x2d087f=[_0x104323(0x29a),'bottom'],_0x435058=_0x2d087f[Math[_0x104323(0x64b)](_0x288089(_0x45d080*0x7)*0x2)],_0x1d747d=_0x510a07[_0x435058];let _0x5ee85e=null,_0x501ebe=0x0;while(_0x501ebe<0xa&&!_0x5ee85e){const _0xb556cf=_0x45d080*0x64+_0x501ebe;let _0x5035df,_0x3c1c23,_0x2e8e68,_0x79b965,_0x19f741,_0x898eb8;_0x1d747d[_0x104323(0x63a)]===_0x104323(0x29a)?(_0x2e8e68=_0x1d747d[_0x104323(0x451)]+_0x288089(_0xb556cf)*(_0x1d747d['maxTop']-_0x1d747d[_0x104323(0x451)]),_0x19f741=_0x1d747d[_0x104323(0x689)]+_0x288089(_0xb556cf+0x1)*(_0x1d747d[_0x104323(0x1af)]-_0x1d747d[_0x104323(0x689)]),_0x5035df=0x12c-_0x19f741-_0x392412/0x2,_0x3c1c23=_0x2e8e68+_0x34d915/0x2):(_0x898eb8=_0x1d747d[_0x104323(0x465)]+_0x288089(_0xb556cf)*(_0x1d747d['maxBottom']-_0x1d747d[_0x104323(0x465)]),_0x79b965=_0x1d747d[_0x104323(0x82c)]+_0x288089(_0xb556cf+0x1)*(_0x1d747d['maxLeft']-_0x1d747d['minLeft']),_0x5035df=_0x79b965+_0x392412/0x2,_0x3c1c23=0x226-_0x898eb8-_0x34d915/0x2),!_0x7069c8({'x':_0x5035df,'y':_0x3c1c23},_0x392412,_0x34d915)&&(_0x5ee85e={'top':_0x2e8e68,'left':_0x79b965,'right':_0x19f741,'bottom':_0x898eb8},_0x3740b5[_0x104323(0x2c4)]({'x':_0x5035df,'y':_0x3c1c23,'width':_0x392412,'height':_0x34d915})),_0x501ebe++;}if(!_0x5ee85e){const _0x507b67=[{'top':0xc8,'right':0x19},{'top':0x12c,'right':0x1e},{'top':0x17c,'right':0x23},{'bottom':0x64,'left':0x32},{'bottom':0x6e,'left':0x82}];_0x5ee85e=_0x507b67[_0x45d080%_0x507b67[_0x104323(0x6ea)]];}if(_0x5ee85e[_0x104323(0x78d)]!==undefined)_0x3d2d02+=_0x104323(0x5c4)+Math[_0x104323(0x247)](_0x5ee85e['top'])+_0x104323(0x454);if(_0x5ee85e[_0x104323(0x5db)]!==undefined)_0x3d2d02+=_0x104323(0x736)+Math[_0x104323(0x247)](_0x5ee85e[_0x104323(0x5db)])+_0x104323(0x454);if(_0x5ee85e[_0x104323(0x460)]!==undefined)_0x3d2d02+=_0x104323(0x95a)+Math[_0x104323(0x247)](_0x5ee85e[_0x104323(0x460)])+_0x104323(0x454);if(_0x5ee85e['right']!==undefined)_0x3d2d02+='\x20right:\x20'+Math[_0x104323(0x247)](_0x5ee85e[_0x104323(0x29a)])+_0x104323(0x454);}const _0x2cdeea=-0x3+_0x288089(_0x45d080*0xd)*0x6;_0x3d2d02+=_0x104323(0x1da)+_0x2cdeea[_0x104323(0x7a4)](0x1)+'deg);',_0x2f8766+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-sticky\x20'+_0x3b6fe8+_0x104323(0x76e)+_0x4bbef7['id']+_0x104323(0x683)+_0x3d2d02+_0x104323(0x6ae)+_0x362830+_0x104323(0x849)+_0x413d58+_0x104323(0x3eb)+_0x4bbef7['id']+_0x104323(0x8d0)+(_0x4bbef7['content']||'')+_0x104323(0x806);});}_0x409dba[_0x5a1e92(0x5b8)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-face\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-spine\x20diary-spine-inner\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-holes\x22><div\x20class=\x22diary-hole\x22></div><div\x20class=\x22diary-hole\x22></div><div\x20class=\x22diary-hole\x22></div><div\x20class=\x22diary-hole\x22></div></div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-inner\x20diary-content-page\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-head\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-date\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>'+_0x2957d5+_0x5a1e92(0x31b)+_0x1d3265+_0x5a1e92(0x8ee)+_0x4ad5d0+_0x5a1e92(0x22a)+_0x118020+_0x5a1e92(0x576)+(_0xda8c0c[_0x5a1e92(0x81a)]||'')+_0x5a1e92(0x429)+_0x38ac6c+_0x5a1e92(0x34d)+_0x163ddf+_0x5a1e92(0x3ee)+_0x279377+_0x5a1e92(0x67e)+_0x2f8766+_0x5a1e92(0x319)+_0x287b11+_0x5a1e92(0x570),_0x53c2d2[_0x5a1e92(0x5f9)](_0x409dba);const _0x572c4d=_0x409dba[_0x5a1e92(0x42c)](_0x5a1e92(0x728));_0x572c4d[_0x5a1e92(0x7b6)](_0x2f8355=>{const _0x3cd953=_0x5a1e92,_0x203e70=parseInt(_0x2f8355[_0x3cd953(0x672)][_0x3cd953(0x2fe)]);_0x203e70&&initStickyDrag(_0x2f8355,_0x203e70,_0x409dba);}),applyDiaryEntryCollapse(_0x409dba),console[_0x5a1e92(0x41f)](_0x5a1e92(0x583)+_0x287b11+'页');}function lazyLoadNearbyPages(_0x4bedc3){if(!diaryLazyLoadEnabled)return;const _0x2c46cd=Math['max'](0x2,Number(_0x4bedc3)||0x2);for(let _0x54b29f=-DIARY_LAZY_RANGE;_0x54b29f<=DIARY_LAZY_RANGE;_0x54b29f++){const _0x3f9e59=_0x2c46cd+_0x54b29f;_0x3f9e59>=0x2&&lazyRenderDiaryPage(_0x3f9e59);}pruneDiaryPages(_0x2c46cd),applyDiaryEntryCollapseWindow(_0x2c46cd);}async function renderDiaryPages(_0x4f6fc5,_0x2953ee,_0x521221,_0xb16366,_0x5a21cf=[]){const _0x4c52c2=_0x28e739,_0x3291f6=document[_0x4c52c2(0x761)]('diaryBook');if(!_0x3291f6)return;ensureDiaryStyleInjected();try{diaryLazyLoadEnabled=!![],console['log']('📖\x20[日记本]\x20共'+_0x4f6fc5[_0x4c52c2(0x6ea)]+_0x4c52c2(0x4f3));const _0x30caee=_0x3291f6['querySelectorAll'](_0x4c52c2(0x784));_0x30caee[_0x4c52c2(0x7b6)](_0x3b41e4=>_0x3b41e4[_0x4c52c2(0x403)]()),diaryPageCache[_0x4c52c2(0x886)]();const _0x45c2e2=new Set(_0x4f6fc5[_0x4c52c2(0x962)](_0x16ac5b=>_0x16ac5b[_0x4c52c2(0x192)])),_0x4bfa4c={};_0x5a21cf[_0x4c52c2(0x7b6)](_0x88f69f=>{const _0x571179=_0x4c52c2;!_0x45c2e2[_0x571179(0x345)](_0x88f69f[_0x571179(0x192)])&&(!_0x4bfa4c[_0x88f69f['date']]&&(_0x4bfa4c[_0x88f69f[_0x571179(0x192)]]=[]),_0x4bfa4c[_0x88f69f[_0x571179(0x192)]][_0x571179(0x2c4)](_0x88f69f));});const _0x59e9da=Object[_0x4c52c2(0x961)](_0x4bfa4c)[_0x4c52c2(0x8da)]((_0x2a3acb,_0xc79902)=>new Date(_0xc79902)-new Date(_0x2a3acb)),_0x1772f7=document[_0x4c52c2(0x761)]('diaryIndexList');if(_0x1772f7){_0x1772f7[_0x4c52c2(0x5b8)]='';const _0x5d1fc2=_0x4f6fc5[_0x4c52c2(0x6ea)]>0x0||_0x59e9da[_0x4c52c2(0x6ea)]>0x0;if(!_0x5d1fc2){const _0x36c905=document[_0x4c52c2(0x5e5)](_0x4c52c2(0x6a4));_0x36c905['className']=_0x4c52c2(0x5a0),_0x36c905['innerHTML']=_0x4c52c2(0x8a3),_0x1772f7[_0x4c52c2(0x3de)](_0x36c905);}else _0x4f6fc5['forEach']((_0x1b9a46,_0x11c539)=>{const _0x691ef6=_0x4c52c2,_0x5788ce=_0x11c539+0x2,_0x287f35=new Date(_0x1b9a46[_0x691ef6(0x192)]),_0x1ecbda=_0x287f35[_0x691ef6(0x36d)]()+0x1+'/'+_0x287f35[_0x691ef6(0x8b9)](),_0x33abba=_0x1b9a46[_0x691ef6(0x81a)]||_0x691ef6(0x41e),_0xa37f5f=_0x1b9a46[_0x691ef6(0x8a2)]||'',_0x115c31=document[_0x691ef6(0x5e5)](_0x691ef6(0x6a4));_0x115c31[_0x691ef6(0x51f)]=_0x691ef6(0x5cc),_0x115c31['onclick']=()=>diaryGoToPage(_0x5788ce),_0x115c31['innerHTML']=_0x691ef6(0x56b)+_0x1ecbda+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22diary-idx-title\x22>'+_0x33abba+'\x20'+(_0xa37f5f?_0x691ef6(0x5b4)+_0xa37f5f+_0x691ef6(0x975):'')+_0x691ef6(0x836)+_0x5788ce+_0x691ef6(0x3da),_0x1772f7[_0x691ef6(0x3de)](_0x115c31);}),_0x59e9da[_0x4c52c2(0x7b6)]((_0x30ed11,_0x4cedb6)=>{const _0x221ce6=_0x4c52c2,_0x39b402=_0x4f6fc5[_0x221ce6(0x6ea)]+_0x4cedb6+0x2,_0x4622db=new Date(_0x30ed11),_0x1fed67=_0x4622db[_0x221ce6(0x36d)]()+0x1+'/'+_0x4622db[_0x221ce6(0x8b9)](),_0x10ab11=_0x4bfa4c[_0x30ed11][_0x221ce6(0x6ea)],_0x278eee=document[_0x221ce6(0x5e5)](_0x221ce6(0x6a4));_0x278eee[_0x221ce6(0x51f)]=_0x221ce6(0x4cc),_0x278eee[_0x221ce6(0x462)]=()=>diaryGoToPage(_0x39b402),_0x278eee[_0x221ce6(0x5b8)]=_0x221ce6(0x56b)+_0x1fed67+_0x221ce6(0x6e6)+_0x10ab11+_0x221ce6(0x616)+_0x39b402+_0x221ce6(0x3da),_0x1772f7['appendChild'](_0x278eee);});}const _0x4594be={'happy':'★','Happy':'★','开心':'★','高兴':'★','calm':'☆','Calm':'☆','平静':'☆','安静':'☆','excited':'♡','Excited':'♡','兴奋':'♡','激动':'♡','curious':'○','Curious':'○','好奇':'○','sad':'☁','Sad':'☁','难过':'☁','伤心':'☁','angry':'✕','Angry':'✕','生气':'✕','love':'♥','Love':'♥','喜欢':'♥','爱':'♥'},_0x5496a8=['s1','s2','s3','s4','s5','s6'],_0x1467ba=[_0x4c52c2(0x701),_0x4c52c2(0x621),_0x4c52c2(0x532),_0x4c52c2(0x1ba),_0x4c52c2(0x76b),_0x4c52c2(0x34c)],_0x5e8a1a={};_0x5a21cf[_0x4c52c2(0x7b6)](_0x4c5450=>{const _0x4c122e=_0x4c52c2;!_0x5e8a1a[_0x4c5450[_0x4c122e(0x192)]]&&(_0x5e8a1a[_0x4c5450[_0x4c122e(0x192)]]=[]),_0x5e8a1a[_0x4c5450[_0x4c122e(0x192)]][_0x4c122e(0x2c4)](_0x4c5450);}),console[_0x4c52c2(0x41f)](_0x4c52c2(0x7ee)+Object[_0x4c52c2(0x961)](_0x5e8a1a)['length']+'个日期的笔记');const _0x1ffb45=document[_0x4c52c2(0x3e4)](),_0x37c1f7=_0x4f6fc5[_0x4c52c2(0x6ea)],_0x860869=diaryLazyLoadEnabled?Math[_0x4c52c2(0x730)](_0x37c1f7,DIARY_LAZY_INITIAL_RENDER_COUNT):_0x37c1f7;console['log'](_0x4c52c2(0x7b3)+_0x860869+_0x4c52c2(0x6b8)+(_0x37c1f7-_0x860869)+_0x4c52c2(0x19a));for(let _0x1e29ad=0x0;_0x1e29ad<_0x4f6fc5['length'];_0x1e29ad++){const _0x8f1a7c=_0x4f6fc5[_0x1e29ad],_0x8e0dce=_0x1e29ad+0x2;if(diaryLazyLoadEnabled&&_0x1e29ad>=_0x860869){const _0x2b5137=buildDiaryPlaceholder(_0x8e0dce,_0x1e29ad);_0x1ffb45[_0x4c52c2(0x3de)](_0x2b5137);continue;}const _0x261bc6=_0x5e8a1a[_0x8f1a7c[_0x4c52c2(0x192)]]||[],_0x59c6e0=document['createElement'](_0x4c52c2(0x6a4));_0x59c6e0[_0x4c52c2(0x51f)]=_0x4c52c2(0x6d6),_0x59c6e0['id']='diaryPage'+_0x8e0dce;const _0x8e6726=new Date(_0x8f1a7c['date']),_0x17a98e=[_0x4c52c2(0x916),'Monday',_0x4c52c2(0x60f),'Wednesday',_0x4c52c2(0x5be),_0x4c52c2(0x853),_0x4c52c2(0x23e)],_0x4271d2=_0x17a98e[_0x8e6726[_0x4c52c2(0x935)]()],_0xd8c365=_0x8e6726[_0x4c52c2(0x18f)](),_0x483fd3=String(_0x8e6726[_0x4c52c2(0x36d)]()+0x1)[_0x4c52c2(0x90f)](0x2,'0'),_0x59fced=String(_0x8e6726[_0x4c52c2(0x8b9)]())[_0x4c52c2(0x90f)](0x2,'0'),_0x21c3b4=_0xd8c365+'.'+_0x483fd3+'.'+_0x59fced,_0x20d81e=_0x483fd3+'/'+_0x59fced,_0x44b8ac=_0x8f1a7c[_0x4c52c2(0x8a2)]||'',_0x2d3bd1=_0x4594be[_0x44b8ac]||_0x4594be[_0x44b8ac[_0x4c52c2(0x6eb)]()]||'◇',_0x39deda=normalizeDiaryContentHtml(_0x8f1a7c['content']),_0x249e62=shouldCollapseDiaryContent(_0x39deda),_0x564389=_0x249e62?_0x4c52c2(0x2aa):_0x4c52c2(0x707),_0x54d61d=_0x249e62?_0x4c52c2(0x383):'';let _0x3315e8='';if(_0x261bc6['length']>0x0){const _0x1efafc=_0x4c56f4=>{const _0x7b9945=_0x4c52c2,_0x5d1b66=Math[_0x7b9945(0x947)](_0x4c56f4)*0x2710;return _0x5d1b66-Math[_0x7b9945(0x64b)](_0x5d1b66);},_0x2aaabe={'right':{'minTop':0xb4,'maxTop':0x1a4,'minRight':0x14,'maxRight':0x28,'side':_0x4c52c2(0x29a)},'bottom':{'minBottom':0x5a,'maxBottom':0x82,'minLeft':0x28,'maxLeft':0xc8,'side':'bottom'}},_0x2cb2d7=[],_0x3c19e7=(_0x319432,_0x35ecf3,_0x30a4ab)=>{const _0xee39f7=_0x4c52c2;for(const _0x19edeb of _0x2cb2d7){const _0x11d0a9=Math['abs'](_0x319432['x']-_0x19edeb['x']),_0x4a464b=Math[_0xee39f7(0x268)](_0x319432['y']-_0x19edeb['y']);if(_0x11d0a9<(_0x35ecf3+_0x19edeb['width'])/0x2+0x19&&_0x4a464b<(_0x30a4ab+_0x19edeb[_0xee39f7(0x5ea)])/0x2+0x19)return!![];}return![];};_0x261bc6[_0x4c52c2(0x7b6)]((_0x37528d,_0xdf0481)=>{const _0x3cc029=_0x4c52c2,_0x2f83af=_0x37528d[_0x3cc029(0x3e9)]||_0x5496a8[_0xdf0481%_0x5496a8[_0x3cc029(0x6ea)]],_0xe9a4bb=_0x1467ba[_0xdf0481%_0x1467ba['length']],_0x3100f0=0x55,_0x362d6d=0x3c,_0x59ee5a=_0x37528d['positionX']!==undefined&&_0x37528d[_0x3cc029(0x7c1)]!==undefined;let _0xf27d9e=_0x3cc029(0x514)+_0x3100f0+_0x3cc029(0x454);if(_0x59ee5a)_0xf27d9e+=_0x3cc029(0x95a)+_0x37528d[_0x3cc029(0x5b1)]+_0x3cc029(0x1e7)+_0x37528d[_0x3cc029(0x7c1)]+_0x3cc029(0x454);else{const _0x9adb06=['right',_0x3cc029(0x5db)],_0x5a77b5=_0x9adb06[Math[_0x3cc029(0x64b)](_0x1efafc(_0xdf0481*0x7)*0x2)],_0x31fc01=_0x2aaabe[_0x5a77b5];let _0x29bb33=null,_0x43a9f8=0x0;while(_0x43a9f8<0xa&&!_0x29bb33){const _0x3baa18=_0xdf0481*0x64+_0x43a9f8;let _0x3da092,_0x14d39c,_0x351df2,_0xecf4fa,_0x551e5e,_0xd25164;_0x31fc01[_0x3cc029(0x63a)]===_0x3cc029(0x29a)?(_0x351df2=_0x31fc01[_0x3cc029(0x451)]+_0x1efafc(_0x3baa18)*(_0x31fc01[_0x3cc029(0x321)]-_0x31fc01[_0x3cc029(0x451)]),_0x551e5e=_0x31fc01[_0x3cc029(0x689)]+_0x1efafc(_0x3baa18+0x1)*(_0x31fc01[_0x3cc029(0x1af)]-_0x31fc01[_0x3cc029(0x689)]),_0x3da092=0x12c-_0x551e5e-_0x3100f0/0x2,_0x14d39c=_0x351df2+_0x362d6d/0x2):(_0xd25164=_0x31fc01[_0x3cc029(0x465)]+_0x1efafc(_0x3baa18)*(_0x31fc01[_0x3cc029(0x22d)]-_0x31fc01[_0x3cc029(0x465)]),_0xecf4fa=_0x31fc01[_0x3cc029(0x82c)]+_0x1efafc(_0x3baa18+0x1)*(_0x31fc01[_0x3cc029(0x4be)]-_0x31fc01['minLeft']),_0x3da092=_0xecf4fa+_0x3100f0/0x2,_0x14d39c=0x226-_0xd25164-_0x362d6d/0x2),!_0x3c19e7({'x':_0x3da092,'y':_0x14d39c},_0x3100f0,_0x362d6d)&&(_0x29bb33={'top':_0x351df2,'left':_0xecf4fa,'right':_0x551e5e,'bottom':_0xd25164},_0x2cb2d7[_0x3cc029(0x2c4)]({'x':_0x3da092,'y':_0x14d39c,'width':_0x3100f0,'height':_0x362d6d})),_0x43a9f8++;}if(!_0x29bb33){const _0x4bcfd0=[{'top':0xc8,'right':0x19},{'top':0x12c,'right':0x1e},{'top':0x17c,'right':0x23},{'bottom':0x64,'left':0x32},{'bottom':0x6e,'left':0x82}];_0x29bb33=_0x4bcfd0[_0xdf0481%_0x4bcfd0[_0x3cc029(0x6ea)]];}if(_0x29bb33[_0x3cc029(0x78d)]!==undefined)_0xf27d9e+=_0x3cc029(0x5c4)+Math['round'](_0x29bb33['top'])+_0x3cc029(0x454);if(_0x29bb33['bottom']!==undefined)_0xf27d9e+=_0x3cc029(0x736)+Math[_0x3cc029(0x247)](_0x29bb33[_0x3cc029(0x5db)])+'px;';if(_0x29bb33['left']!==undefined)_0xf27d9e+=_0x3cc029(0x95a)+Math[_0x3cc029(0x247)](_0x29bb33[_0x3cc029(0x460)])+'px;';if(_0x29bb33['right']!==undefined)_0xf27d9e+=_0x3cc029(0x584)+Math[_0x3cc029(0x247)](_0x29bb33['right'])+_0x3cc029(0x454);}const _0xc3abf7=-0x3+_0x1efafc(_0xdf0481*0xd)*0x6;_0xf27d9e+=_0x3cc029(0x1da)+_0xc3abf7[_0x3cc029(0x7a4)](0x1)+_0x3cc029(0x501),_0x3315e8+=_0x3cc029(0x458)+_0x2f83af+_0x3cc029(0x76e)+_0x37528d['id']+_0x3cc029(0x683)+_0xf27d9e+_0x3cc029(0x959)+_0xe9a4bb+_0x3cc029(0x358)+_0x20d81e+_0x3cc029(0x5c1)+_0x37528d['id']+_0x3cc029(0x8f4)+(_0x37528d[_0x3cc029(0x632)]||'')+_0x3cc029(0x23a);});}_0x59c6e0[_0x4c52c2(0x5b8)]=_0x4c52c2(0x5ef)+_0x21c3b4+'</strong>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small>'+_0x4271d2+'</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-mood\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+_0x2d3bd1+_0x4c52c2(0x849)+_0x44b8ac+_0x4c52c2(0x2b4)+(_0x8f1a7c['title']||'')+_0x4c52c2(0x5c3)+_0x564389+_0x4c52c2(0x336)+_0x39deda+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x54d61d+_0x4c52c2(0x2f6)+_0x3315e8+_0x4c52c2(0x8f3)+_0x8e0dce+_0x4c52c2(0x1f8),_0x1ffb45[_0x4c52c2(0x3de)](_0x59c6e0);const _0xd852b7=_0x59c6e0[_0x4c52c2(0x42c)](_0x4c52c2(0x728));_0xd852b7[_0x4c52c2(0x7b6)](_0x3290bb=>{const _0x39461b=_0x4c52c2,_0x1eebbc=parseInt(_0x3290bb['dataset'][_0x39461b(0x2fe)]);_0x1eebbc&&initStickyDrag(_0x3290bb,_0x1eebbc,_0x59c6e0);});}for(let _0x1c64ec=0x0;_0x1c64ec<_0x59e9da[_0x4c52c2(0x6ea)];_0x1c64ec++){const _0x2c56a7=_0x59e9da[_0x1c64ec],_0x1660d5=_0x4bfa4c[_0x2c56a7],_0x200294=_0x4f6fc5[_0x4c52c2(0x6ea)]+_0x1c64ec+0x2,_0xbde844=document[_0x4c52c2(0x5e5)](_0x4c52c2(0x6a4));_0xbde844[_0x4c52c2(0x51f)]=_0x4c52c2(0x6d6),_0xbde844['id']=_0x4c52c2(0x466)+_0x200294;const _0x1a1cad=new Date(_0x2c56a7),_0x55e20f=[_0x4c52c2(0x916),'Monday','Tuesday',_0x4c52c2(0x8be),_0x4c52c2(0x5be),_0x4c52c2(0x853),_0x4c52c2(0x23e)],_0x3c0c8a=_0x55e20f[_0x1a1cad['getDay']()],_0x44f6d1=_0x1a1cad[_0x4c52c2(0x18f)](),_0x54fb5d=String(_0x1a1cad[_0x4c52c2(0x36d)]()+0x1)[_0x4c52c2(0x90f)](0x2,'0'),_0x2ffa35=String(_0x1a1cad[_0x4c52c2(0x8b9)]())[_0x4c52c2(0x90f)](0x2,'0'),_0x4cbf31=_0x44f6d1+'.'+_0x54fb5d+'.'+_0x2ffa35,_0x111c2b=_0x54fb5d+'/'+_0x2ffa35;let _0x6bff02='';const _0x408423=_0x3cde8a=>{const _0x17bc79=_0x4c52c2,_0x1109fd=Math[_0x17bc79(0x947)](_0x3cde8a)*0x2710;return _0x1109fd-Math['floor'](_0x1109fd);},_0x3c1c29=[{'top':0x78,'left':0x1e},{'top':0x78,'right':0x1e},{'top':0xfa,'left':0x32},{'top':0xfa,'right':0x32},{'top':0x17c,'left':0x1e},{'top':0x17c,'right':0x1e}];_0x1660d5['forEach']((_0x31bd22,_0x3cd69d)=>{const _0x39ce89=_0x4c52c2,_0x1ccb9a=_0x31bd22[_0x39ce89(0x3e9)]||_0x5496a8[_0x3cd69d%_0x5496a8[_0x39ce89(0x6ea)]],_0x2de53b=_0x1467ba[_0x3cd69d%_0x1467ba[_0x39ce89(0x6ea)]],_0x5f54c4=-0x3+_0x408423(_0x3cd69d*0xd)*0x6,_0x587911=_0x31bd22['positionX']!==undefined&&_0x31bd22[_0x39ce89(0x7c1)]!==undefined;let _0x2888c7=_0x39ce89(0x382);if(_0x587911)_0x2888c7+=_0x39ce89(0x95a)+_0x31bd22[_0x39ce89(0x5b1)]+'px;\x20top:\x20'+_0x31bd22[_0x39ce89(0x7c1)]+_0x39ce89(0x454);else{const _0x17e7a0=_0x3c1c29[_0x3cd69d%_0x3c1c29[_0x39ce89(0x6ea)]];if(_0x17e7a0['top']!==undefined)_0x2888c7+=_0x39ce89(0x5c4)+_0x17e7a0[_0x39ce89(0x78d)]+_0x39ce89(0x454);if(_0x17e7a0[_0x39ce89(0x460)]!==undefined)_0x2888c7+=_0x39ce89(0x95a)+_0x17e7a0[_0x39ce89(0x460)]+_0x39ce89(0x454);if(_0x17e7a0[_0x39ce89(0x29a)]!==undefined)_0x2888c7+=_0x39ce89(0x584)+_0x17e7a0['right']+_0x39ce89(0x454);}_0x2888c7+=_0x39ce89(0x1da)+_0x5f54c4['toFixed'](0x1)+_0x39ce89(0x501),_0x6bff02+=_0x39ce89(0x764)+_0x1ccb9a+'\x22\x20data-note-id=\x22'+_0x31bd22['id']+_0x39ce89(0x683)+_0x2888c7+_0x39ce89(0x6ae)+_0x2de53b+_0x39ce89(0x849)+_0x111c2b+_0x39ce89(0x3eb)+_0x31bd22['id']+',\x20event)\x22\x20title=\x22删除笔记\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-sticky-body\x22>'+(_0x31bd22['content']||'')+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}),_0xbde844[_0x4c52c2(0x5b8)]=_0x4c52c2(0x8f9)+_0x4cbf31+_0x4c52c2(0x5a3)+_0x3c0c8a+_0x4c52c2(0x933)+_0x6bff02+_0x4c52c2(0x8f3)+_0x200294+_0x4c52c2(0x1f8),_0x1ffb45[_0x4c52c2(0x3de)](_0xbde844);const _0x247296=_0xbde844[_0x4c52c2(0x42c)](_0x4c52c2(0x728));_0x247296[_0x4c52c2(0x7b6)](_0x4e128a=>{const _0x1e831f=_0x4c52c2,_0x2844e7=parseInt(_0x4e128a[_0x1e831f(0x672)][_0x1e831f(0x2fe)]);_0x2844e7&&initStickyDrag(_0x4e128a,_0x2844e7,_0xbde844);});}console[_0x4c52c2(0x41f)]('⚡\x20[日记本]\x20批量添加'+_0x1ffb45[_0x4c52c2(0x92b)]+_0x4c52c2(0x610)),_0x3291f6[_0x4c52c2(0x3de)](_0x1ffb45),console[_0x4c52c2(0x41f)](_0x4c52c2(0x444)),diaryRenderData={'diaryEntries':_0x4f6fc5,'characterId':_0x2953ee,'sessionId':_0x521221,'profileId':_0xb16366,'notesByDate':_0x5e8a1a,'moodIcons':_0x4594be,'stickyColors':_0x5496a8,'stickyLabels':_0x1467ba};const _0x14b9d9=_0x4f6fc5[_0x4c52c2(0x6ea)]>0x0?0x2:0x0;applyDiaryEntryCollapseWindow(_0x14b9d9),pruneDiaryPages(_0x14b9d9),diaryLazyLoadEnabled&&setTimeout(()=>{lazyLoadNearbyPages(0x2);},0x64);}catch(_0x3e00f7){console[_0x4c52c2(0x56c)](_0x4c52c2(0x4ec),_0x3e00f7),diaryRenderData=null,diaryPageCache[_0x4c52c2(0x886)](),showIslandNotification('错误','日记本渲染失败，已降级显示',_0x4c52c2(0x537));}}function diaryFlip(_0x5f49b8){const _0x1525dd=_0x28e739,_0x4147d3=document[_0x1525dd(0x42c)](_0x1525dd(0x287));if(_0x5f49b8>0x0&&diaryCurrentPage<diaryTotalPages-0x1)_0x4147d3[diaryCurrentPage]['classList'][_0x1525dd(0x5e3)](_0x1525dd(0x81f)),diaryCurrentPage++,lazyLoadNearbyPages(diaryCurrentPage);else _0x5f49b8<0x0&&diaryCurrentPage>0x0&&(diaryCurrentPage--,_0x4147d3[diaryCurrentPage][_0x1525dd(0x421)]['remove'](_0x1525dd(0x81f)),lazyLoadNearbyPages(diaryCurrentPage));updateDiaryZ();}function updateDiaryZ(){const _0x5685c8=_0x28e739,_0x51fd5c=document[_0x5685c8(0x42c)](_0x5685c8(0x287));_0x51fd5c[_0x5685c8(0x7b6)]((_0x2225bd,_0x528ad6)=>{const _0x14bde6=_0x5685c8;_0x2225bd[_0x14bde6(0x577)][_0x14bde6(0x33c)]=_0x528ad6<diaryCurrentPage?_0x528ad6:diaryTotalPages-_0x528ad6+diaryCurrentPage;});}function diaryGoToPage(_0x579ec0){const _0x2a179c=_0x28e739,_0x511de2=document[_0x2a179c(0x42c)](_0x2a179c(0x287));for(let _0x30fadf=0x0;_0x30fadf<_0x579ec0&&_0x30fadf<diaryTotalPages;_0x30fadf++){_0x511de2[_0x30fadf][_0x2a179c(0x421)]['add'](_0x2a179c(0x81f));}for(let _0x16c439=_0x579ec0;_0x16c439<diaryTotalPages;_0x16c439++){_0x511de2[_0x16c439][_0x2a179c(0x421)][_0x2a179c(0x403)](_0x2a179c(0x81f));}diaryCurrentPage=_0x579ec0,updateDiaryZ(),lazyLoadNearbyPages(_0x579ec0);}async function deleteDiaryNote(_0x147944,_0x4130c8){const _0x50e13e=_0x28e739;try{_0x4130c8&&(_0x4130c8[_0x50e13e(0x722)](),_0x4130c8[_0x50e13e(0x442)]());console[_0x50e13e(0x41f)](_0x50e13e(0x778),_0x147944),await db[_0x50e13e(0x499)]['delete'](_0x147944),console[_0x50e13e(0x41f)]('✅\x20笔记已从数据库删除');const _0xca11b9=document[_0x50e13e(0x768)](_0x50e13e(0x87b)+_0x147944+'\x22]');_0xca11b9&&(_0xca11b9['style']['transition']=_0x50e13e(0x60b),_0xca11b9[_0x50e13e(0x577)]['transform']=_0x50e13e(0x5df),_0xca11b9[_0x50e13e(0x577)]['opacity']='0',setTimeout(()=>{const _0x2b85b5=_0x50e13e;_0xca11b9['remove'](),console[_0x2b85b5(0x41f)](_0x2b85b5(0x5ec));},0x12c)),typeof showDynamicIsland===_0x50e13e(0x48c)&&showDynamicIsland(_0x50e13e(0x39d),_0x50e13e(0x4b4),_0x50e13e(0x64c));}catch(_0x3e77ef){console['error'](_0x50e13e(0x44d),_0x3e77ef),typeof showDynamicIsland==='function'&&showDynamicIsland('error',_0x50e13e(0x45a),'无法删除笔记，请重试');}}const DTMFTones={'1':{'low':0x2b9,'high':0x4b9},'2':{'low':0x2b9,'high':0x538},'3':{'low':0x2b9,'high':0x5c5},'4':{'low':0x302,'high':0x4b9},'5':{'low':0x302,'high':0x538},'6':{'low':0x302,'high':0x5c5},'7':{'low':0x354,'high':0x4b9},'8':{'low':0x354,'high':0x538},'9':{'low':0x354,'high':0x5c5},'*':{'low':0x3ad,'high':0x4b9},'0':{'low':0x3ad,'high':0x538},'#':{'low':0x3ad,'high':0x5c5}};let audioContext=null,isAudioEnabled=!![];function initAudioContext(){const _0xa0bf83=_0x28e739;if(!audioContext)try{audioContext=new(window[(_0xa0bf83(0x329))]||window[(_0xa0bf83(0x5cf))])();}catch(_0x152ac9){console[_0xa0bf83(0x516)](_0xa0bf83(0x8ae)),isAudioEnabled=![];}return audioContext;}function playDTMFTone(_0x51782d,_0x106118=0x78){const _0x269814=_0x28e739;if(!isAudioEnabled)return;const _0xfd67be=DTMFTones[_0x51782d];if(!_0xfd67be)return;const _0x3b452a=initAudioContext();if(!_0x3b452a)return;try{const _0x423b10=_0x3b452a[_0x269814(0x2ad)](),_0x56388b=_0x3b452a['createOscillator'](),_0x30934c=_0x3b452a[_0x269814(0x4c6)]();_0x423b10[_0x269814(0x79d)][_0x269814(0x29c)]=_0xfd67be[_0x269814(0x314)],_0x56388b['frequency']['value']=_0xfd67be['high'],_0x423b10[_0x269814(0x3a3)]=_0x269814(0x1ef),_0x56388b['type']=_0x269814(0x1ef),_0x423b10[_0x269814(0x7a3)](_0x30934c),_0x56388b['connect'](_0x30934c),_0x30934c[_0x269814(0x7a3)](_0x3b452a[_0x269814(0x96a)]);const _0x4eb023=_0x3b452a['currentTime'];_0x30934c[_0x269814(0x5d7)][_0x269814(0x4ac)](0x0,_0x4eb023),_0x30934c[_0x269814(0x5d7)][_0x269814(0x713)](0.12,_0x4eb023+0.01),_0x30934c[_0x269814(0x5d7)]['linearRampToValueAtTime'](0.12,_0x4eb023+_0x106118/0x3e8-0.02),_0x30934c[_0x269814(0x5d7)][_0x269814(0x713)](0x0,_0x4eb023+_0x106118/0x3e8),_0x423b10[_0x269814(0x813)](_0x4eb023),_0x56388b[_0x269814(0x813)](_0x4eb023),_0x423b10[_0x269814(0x19d)](_0x4eb023+_0x106118/0x3e8),_0x56388b[_0x269814(0x19d)](_0x4eb023+_0x106118/0x3e8);}catch(_0x2adfd5){console['warn'](_0x269814(0x6e8),_0x2adfd5);}}function togglePhoneSound(){const _0x1ea916=_0x28e739;isAudioEnabled=!isAudioEnabled,showIslandNotification(isAudioEnabled?_0x1ea916(0x65e):_0x1ea916(0x270),_0x1ea916(0x39e),_0x1ea916(0x4bc));}let phoneCurrentNumber='';function pressPhoneKey(_0x1a754a){const _0x25bbb5=_0x28e739;if(phoneCurrentNumber[_0x25bbb5(0x6ea)]>=0xf)return;playDTMFTone(_0x1a754a);const _0x2d484a=event?.[_0x25bbb5(0x6e4)]?.[_0x25bbb5(0x7c0)](_0x25bbb5(0x856));_0x2d484a&&(_0x2d484a['classList'][_0x25bbb5(0x5e3)](_0x25bbb5(0x45c)),setTimeout(()=>_0x2d484a[_0x25bbb5(0x421)][_0x25bbb5(0x403)](_0x25bbb5(0x45c)),0x96)),phoneCurrentNumber+=_0x1a754a,updatePhoneDisplay(),vibrateDevice();}function updatePhoneDisplay(){const _0x1f8782=_0x28e739,_0x5092c3=document[_0x1f8782(0x761)]('phoneNumberDisplay'),_0x2de8cb=document[_0x1f8782(0x761)](_0x1f8782(0x5a7));if(!_0x5092c3)return;if(phoneCurrentNumber){_0x5092c3[_0x1f8782(0x7dc)]=formatPhoneNumber(phoneCurrentNumber),_0x5092c3[_0x1f8782(0x421)][_0x1f8782(0x403)](_0x1f8782(0x259)),_0x5092c3[_0x1f8782(0x421)]['add']('bounce'),setTimeout(()=>_0x5092c3[_0x1f8782(0x421)][_0x1f8782(0x403)](_0x1f8782(0x565)),0x78);if(_0x2de8cb)_0x2de8cb[_0x1f8782(0x421)]['add'](_0x1f8782(0x332));}else{_0x5092c3[_0x1f8782(0x7dc)]=_0x1f8782(0x677),_0x5092c3[_0x1f8782(0x421)][_0x1f8782(0x5e3)](_0x1f8782(0x259));if(_0x2de8cb)_0x2de8cb[_0x1f8782(0x421)][_0x1f8782(0x403)](_0x1f8782(0x332));}}function setupPhoneDisplayCopy(){const _0x3aa3b7=_0x28e739,_0x3ea384=document[_0x3aa3b7(0x761)]('phoneNumberDisplay'),_0x40b933=document[_0x3aa3b7(0x761)]('phoneDisplayHint');_0x3ea384&&(_0x3ea384['addEventListener']('click',()=>{const _0xf035be=_0x3aa3b7;phoneCurrentNumber&&(navigator[_0xf035be(0x544)]?.[_0xf035be(0x667)](phoneCurrentNumber),_0x40b933&&(_0x40b933[_0xf035be(0x7dc)]=_0xf035be(0x85a),setTimeout(()=>_0x40b933[_0xf035be(0x7dc)]=_0xf035be(0x5c5),0x5dc)),showDynamicIsland('Copied!',phoneCurrentNumber));}),_0x3ea384[_0x3aa3b7(0x577)][_0x3aa3b7(0x5cb)]=_0x3aa3b7(0x7be));}setTimeout(()=>{const _0x39ea88=_0x28e739;!window['phoneDisplayCopyInitialized']&&(setupPhoneDisplayCopy(),window[_0x39ea88(0x32f)]=!![]);},0x64);function formatPhoneNumber(_0x1490ad){const _0x40f7c4=_0x28e739;if(_0x1490ad[_0x40f7c4(0x6ea)]<=0x3)return _0x1490ad;if(_0x1490ad[_0x40f7c4(0x6ea)]<=0x7)return _0x1490ad[_0x40f7c4(0x73d)](0x0,0x3)+'\x20'+_0x1490ad[_0x40f7c4(0x73d)](0x3);return _0x1490ad[_0x40f7c4(0x73d)](0x0,0x3)+'\x20'+_0x1490ad[_0x40f7c4(0x73d)](0x3,0x7)+'\x20'+_0x1490ad[_0x40f7c4(0x73d)](0x7);}function phoneBackspace(){const _0x92a31f=_0x28e739;phoneCurrentNumber=phoneCurrentNumber[_0x92a31f(0x73d)](0x0,-0x1),updatePhoneDisplay();}function clearPhoneNumber(){phoneCurrentNumber='',updatePhoneDisplay();}function copyPhoneNumber(){const _0x6e255c=_0x28e739;phoneCurrentNumber&&navigator[_0x6e255c(0x544)][_0x6e255c(0x667)](phoneCurrentNumber)[_0x6e255c(0x21f)](()=>{const _0x42c465=_0x6e255c,_0x377f6d=event['target'][_0x42c465(0x7c0)](_0x42c465(0x1d1));if(_0x377f6d){_0x377f6d[_0x42c465(0x577)][_0x42c465(0x55f)]=_0x42c465(0x981);const _0x593c49=_0x377f6d[_0x42c465(0x768)](_0x42c465(0x69d));if(_0x593c49)_0x593c49[_0x42c465(0x577)][_0x42c465(0x72c)]='var(--bg-primary)';setTimeout(()=>{const _0x5f0a1c=_0x42c465;_0x377f6d['style']['background']='';if(_0x593c49)_0x593c49[_0x5f0a1c(0x577)][_0x5f0a1c(0x72c)]='';},0x12c);}showDynamicIsland(_0x42c465(0x4db),phoneCurrentNumber);});}async function makePhoneCall(){const _0x510a5e=_0x28e739;if(phoneCurrentNumber){console['log']('📞\x20准备拨号:',phoneCurrentNumber),await showPhoneProfileSelector(phoneCurrentNumber);const _0x3f0e44=event?.[_0x510a5e(0x6e4)]?.[_0x510a5e(0x7c0)](_0x510a5e(0x81c));_0x3f0e44&&(_0x3f0e44[_0x510a5e(0x577)]['transform']=_0x510a5e(0x234),setTimeout(()=>_0x3f0e44[_0x510a5e(0x577)][_0x510a5e(0x8ed)]='',0x96));}}async function showPhoneProfileSelector(_0x5f52eb){const _0x4abf6b=_0x28e739,_0x16738f=document[_0x4abf6b(0x761)](_0x4abf6b(0x4a5)),_0xc38a9e=document[_0x4abf6b(0x761)]('phoneProfileSelectorList');if(!_0x16738f||!_0xc38a9e)return;const _0x18d004=await db[_0x4abf6b(0x70f)][_0x4abf6b(0x5fd)]();console['log'](_0x4abf6b(0x6e2),_0x18d004[_0x4abf6b(0x6ea)],'个'),_0xc38a9e[_0x4abf6b(0x5b8)]='',_0x18d004[_0x4abf6b(0x6ea)]===0x0?_0xc38a9e['innerHTML']=_0x4abf6b(0x18c):_0x18d004[_0x4abf6b(0x7b6)](_0x3391ca=>{const _0x15fa9b=_0x4abf6b,_0x4b7acf=(_0x3391ca[_0x15fa9b(0x76a)]||_0x3391ca[_0x15fa9b(0x2ae)]||'U')[_0x15fa9b(0x5ed)](0x0)['toUpperCase'](),_0x7c3f63=_0x3391ca[_0x15fa9b(0x76a)]||_0x3391ca[_0x15fa9b(0x2ae)]||_0x15fa9b(0x50b),_0x36725e=_0x3391ca['phoneNumber']||'',_0x33867d=_0x3391ca[_0x15fa9b(0x708)]||_0x3391ca['avatarUrl']||'',_0x2c62c3=document['createElement']('div');_0x2c62c3[_0x15fa9b(0x51f)]='phone-profile-item',_0x2c62c3['onclick']=()=>selectPhoneProfile(_0x3391ca['id'],_0x5f52eb);const _0x2bfcba=_0x33867d?_0x15fa9b(0x6da)+_0x33867d+'\x22\x20alt=\x22'+_0x7c3f63+'\x22>':_0x4b7acf;_0x2c62c3[_0x15fa9b(0x5b8)]=_0x15fa9b(0x377)+_0x2bfcba+_0x15fa9b(0x381)+_0x7c3f63+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x36725e?_0x15fa9b(0x794)+_0x36725e+_0x15fa9b(0x611):_0x15fa9b(0x3a2))+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-profile-arrow\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<polyline\x20points=\x229\x2018\x2015\x2012\x209\x206\x22></polyline>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0xc38a9e[_0x15fa9b(0x3de)](_0x2c62c3);}),_0x16738f[_0x4abf6b(0x421)][_0x4abf6b(0x5e3)]('active');}function closePhoneProfileSelector(){const _0x6e8769=_0x28e739,_0x4dac71=document[_0x6e8769(0x761)](_0x6e8769(0x4a5));_0x4dac71&&_0x4dac71[_0x6e8769(0x421)][_0x6e8769(0x403)](_0x6e8769(0x525));}async function selectPhoneProfile(_0x5d2329,_0x3c4ce4){const _0x42bc6d=_0x28e739;console['log'](_0x42bc6d(0x4ff),_0x5d2329);pendingCallTimeout&&(console[_0x42bc6d(0x41f)]('⏹️\x20清除之前的拨号延迟定时器'),clearTimeout(pendingCallTimeout),pendingCallTimeout=null);const _0x2d1899=_0x3c4ce4['replace'](/\s/g,'')[_0x42bc6d(0x568)](/-/g,'');console[_0x42bc6d(0x41f)]('📞\x20清理后的号码:',_0x2d1899,_0x42bc6d(0x353),_0x2d1899[_0x42bc6d(0x6ea)]);const _0x56a167=await db[_0x42bc6d(0x8d5)][_0x42bc6d(0x56a)](_0x42bc6d(0x1ad))[_0x42bc6d(0x82f)](_0x2d1899)[_0x42bc6d(0x830)](),_0x3ad113=!!_0x56a167;if(!_0x3ad113&&_0x2d1899['length']!==0xb){console['log']('❌\x20号码长度不正确，且不在数据库中，无法拨通'),showIslandNotification('无法拨通',_0x42bc6d(0x1c0),'error'),closePhoneProfileSelector();return;}_0x3ad113?console[_0x42bc6d(0x41f)](_0x42bc6d(0x4cd),_0x2d1899[_0x42bc6d(0x6ea)],'）'):console[_0x42bc6d(0x41f)](_0x42bc6d(0x6aa));closePhoneProfileSelector(),window[_0x42bc6d(0x305)]=_0x5d2329,window[_0x42bc6d(0x412)]=_0x42bc6d(0x8dd);const _0x25a47a=await db[_0x42bc6d(0x315)][_0x42bc6d(0x309)](_0x2d1899);if(_0x25a47a&&_0x25a47a[_0x42bc6d(0x4d1)]&&_0x25a47a[_0x42bc6d(0x3a5)]){console[_0x42bc6d(0x41f)]('📱\x20发现通讯录陌生人联系人:',_0x25a47a['nickname']),console['log'](_0x42bc6d(0x72a),_0x25a47a[_0x42bc6d(0x3a5)]);if(typeof initCallWithContactPersona!==_0x42bc6d(0x48c)){console['error'](_0x42bc6d(0x419)),showIslandNotification('错误',_0x42bc6d(0x8ff),_0x42bc6d(0x56c));return;}const _0x459a00=await initCallWithContactPersona(_0x3c4ce4,_0x25a47a[_0x42bc6d(0x3a5)]);if(_0x459a00){console[_0x42bc6d(0x41f)](_0x42bc6d(0x2a3),_0x459a00[_0x42bc6d(0x76a)]),showCallScreen(_0x42bc6d(0x608),_0x3c4ce4);if(typeof sendCallMessage===_0x42bc6d(0x48c)){console[_0x42bc6d(0x41f)](_0x42bc6d(0x820));const _0x3a29b7=await sendCallMessage(_0x42bc6d(0x2c8));_0x3a29b7&&_0x3a29b7[_0x42bc6d(0x6b7)]&&_0x3a29b7[_0x42bc6d(0x6b7)]['length']>0x0&&(console[_0x42bc6d(0x41f)](_0x42bc6d(0x586),_0x3a29b7[_0x42bc6d(0x6b7)]['length'],'句话'),callSpeeches=_0x3a29b7[_0x42bc6d(0x6b7)],callShouldHangup=_0x3a29b7['shouldHangup']||![],currentCallSpeechIndex=0x0,_0x3a29b7[_0x42bc6d(0x6b7)][_0x42bc6d(0x7b6)](_0x35067a=>{const _0x432090=_0x42bc6d;callTranscript[_0x432090(0x2c4)]({'role':'ai','text':_0x35067a,'timestamp':Date[_0x432090(0x2cb)]()});}),showCallScreen(_0x42bc6d(0x520),_0x3c4ce4));}}return;}console[_0x42bc6d(0x41f)](_0x42bc6d(0x7cd),typeof initCallWithAI);if(typeof initCallWithAI!==_0x42bc6d(0x48c)){console['error']('❌\x20[DEBUG]\x20initCallWithAI函数不存在！ovo-call.js可能未加载'),showIslandNotification('错误','通话功能未就绪',_0x42bc6d(0x56c));return;}console[_0x42bc6d(0x41f)](_0x42bc6d(0x263));const _0x25fedd=await initCallWithAI(_0x3c4ce4);console[_0x42bc6d(0x41f)](_0x42bc6d(0x459),_0x25fedd);if(_0x25fedd){console[_0x42bc6d(0x41f)](_0x42bc6d(0x5dd),_0x25fedd[_0x42bc6d(0x76a)]);const _0x2155e4=_0x25fedd['id'],_0x5e4fe7=_0x5d2329||_0x42bc6d(0x79f),_0x31a62a=await checkIfInBusyPeriod(_0x2155e4,_0x5e4fe7,currentSessionId||_0x42bc6d(0x79f));if(_0x31a62a){console[_0x42bc6d(0x41f)](_0x42bc6d(0x2a0)+_0x31a62a['activity']);if(Math[_0x42bc6d(0x266)]()<0.5){console[_0x42bc6d(0x41f)](_0x42bc6d(0x3cc)),showCallScreen(_0x42bc6d(0x608),_0x3c4ce4),setTimeout(()=>{const _0x888e82=_0x42bc6d;showIslandNotification(_0x888e82(0x552),_0x888e82(0x20c),'error'),vibrateDevice(),setTimeout(()=>{const _0x299cd1=_0x888e82,_0x149755=document[_0x299cd1(0x761)](_0x299cd1(0x6d8));_0x149755&&(_0x149755[_0x299cd1(0x421)][_0x299cd1(0x5e3)](_0x299cd1(0x776)),setTimeout(()=>{const _0x492771=_0x299cd1;_0x149755[_0x492771(0x421)][_0x492771(0x403)](_0x492771(0x525),_0x492771(0x776));},0x12c));},0x7d0);},0x5dc);_0x31a62a['autoReplies']&&_0x31a62a[_0x42bc6d(0x367)][_0x42bc6d(0x2d8)]&&setTimeout(async()=>{const _0x208784=_0x42bc6d;try{const _0x4a98dd=await loadSmsHistory(_0x3c4ce4);_0x4a98dd[_0x208784(0x2c4)]({'role':'assistant','content':_0x208784(0x6de)+_0x31a62a[_0x208784(0x367)]['inform'],'timestamp':Date[_0x208784(0x2cb)]()}),await saveSmsHistory(_0x3c4ce4,_0x4a98dd),showIslandNotification(_0x25fedd[_0x208784(0x76a)]||'角色',_0x208784(0x597),'info');}catch(_0x5d80ac){console[_0x208784(0x56c)](_0x208784(0x774),_0x5d80ac);}},0xbb8);return;}else console[_0x42bc6d(0x41f)]('📞\x20繁忙时段：角色接听了电话（态度可能不同）'),window[_0x42bc6d(0x43a)]=_0x31a62a;}else window[_0x42bc6d(0x43a)]=null;console['log'](_0x42bc6d(0x7c4)),showCallScreen('calling',_0x3c4ce4),console[_0x42bc6d(0x41f)](_0x42bc6d(0x1f1),typeof sendCallMessage);if(typeof sendCallMessage===_0x42bc6d(0x48c)){console['log']('📞\x20拨通电话，等待AI接听...');const _0x1d9722=await sendCallMessage('[用户拨通了电话]');console['log'](_0x42bc6d(0x46a),_0x1d9722),_0x1d9722&&_0x1d9722[_0x42bc6d(0x6b7)]&&_0x1d9722[_0x42bc6d(0x6b7)]['length']>0x0?(console[_0x42bc6d(0x41f)](_0x42bc6d(0x66f),_0x1d9722[_0x42bc6d(0x6b7)][_0x42bc6d(0x6ea)],'句话'),callSpeeches=_0x1d9722['sentences'],callShouldHangup=_0x1d9722[_0x42bc6d(0x292)]||![],currentCallSpeechIndex=0x0,_0x1d9722['sentences'][_0x42bc6d(0x7b6)](_0x53a1db=>{const _0x36f6d6=_0x42bc6d;callTranscript['push']({'role':'ai','text':_0x53a1db,'timestamp':Date[_0x36f6d6(0x2cb)]()});}),console[_0x42bc6d(0x41f)](_0x42bc6d(0x3d6),_0x1d9722[_0x42bc6d(0x6b7)]),showCallScreen(_0x42bc6d(0x520),_0x3c4ce4),showCallSpeech()):console[_0x42bc6d(0x56c)](_0x42bc6d(0x837));}else console['error'](_0x42bc6d(0x375));}else console[_0x42bc6d(0x41f)](_0x42bc6d(0x4f4)),showCallScreen(_0x42bc6d(0x608),_0x3c4ce4),pendingCallTimeout=setTimeout(async()=>{const _0x4c46a7=_0x42bc6d;pendingCallTimeout=null;const _0x82bb64=Math[_0x4c46a7(0x266)]();if(_0x82bb64<0.33)console[_0x4c46a7(0x41f)]('📞\x20号码状态：空号'),showIslandNotification('空号','您拨打的号码是空号，请核对后再拨',_0x4c46a7(0x56c)),vibrateDevice(),setTimeout(()=>{const _0x5819f8=_0x4c46a7;console[_0x5819f8(0x41f)](_0x5819f8(0x8b2));const _0x7c7050=document[_0x5819f8(0x761)]('phoneCallScreen');_0x7c7050&&(_0x7c7050['classList']['add'](_0x5819f8(0x776)),setTimeout(()=>{const _0x5a8335=_0x5819f8;_0x7c7050[_0x5a8335(0x421)][_0x5a8335(0x403)](_0x5a8335(0x776)),console[_0x5a8335(0x41f)]('📱\x20自动关闭通话界面'),hideCallScreen();},0x12c));},0x7d0);else{if(_0x82bb64<0.66)console[_0x4c46a7(0x41f)]('📞\x20号码状态：正在通话中'),showIslandNotification(_0x4c46a7(0x609),_0x4c46a7(0x41b),_0x4c46a7(0x56c)),vibrateDevice(),setTimeout(()=>{const _0x3c68a6=_0x4c46a7;console[_0x3c68a6(0x41f)](_0x3c68a6(0x8b2));const _0x2e539a=document[_0x3c68a6(0x761)](_0x3c68a6(0x55a));_0x2e539a&&(_0x2e539a[_0x3c68a6(0x421)][_0x3c68a6(0x5e3)](_0x3c68a6(0x776)),setTimeout(()=>{const _0x50eabf=_0x3c68a6;_0x2e539a[_0x50eabf(0x421)][_0x50eabf(0x403)](_0x50eabf(0x776)),console[_0x50eabf(0x41f)]('📱\x20自动关闭通话界面'),hideCallScreen();},0x12c));},0x7d0);else{console[_0x4c46a7(0x41f)](_0x4c46a7(0x631));if(typeof initRandomStrangerCall!==_0x4c46a7(0x48c)){console[_0x4c46a7(0x56c)]('❌\x20initRandomStrangerCall函数不存在！ovo-call.js可能未加载'),showIslandNotification('错误',_0x4c46a7(0x8ff),_0x4c46a7(0x56c)),setTimeout(()=>hideCallScreen(),0x3e8);return;}const _0x24b493=await initRandomStrangerCall(_0x3c4ce4);if(_0x24b493){console[_0x4c46a7(0x41f)](_0x4c46a7(0x900),_0x24b493[_0x4c46a7(0x76a)]);if(typeof sendCallMessage===_0x4c46a7(0x48c)){console['log'](_0x4c46a7(0x820));const _0x35d3be=await sendCallMessage('[用户拨通了电话]');console[_0x4c46a7(0x41f)](_0x4c46a7(0x46a),_0x35d3be),_0x35d3be&&_0x35d3be[_0x4c46a7(0x6b7)]&&_0x35d3be[_0x4c46a7(0x6b7)][_0x4c46a7(0x6ea)]>0x0?(console[_0x4c46a7(0x41f)]('🤖\x20陌生人接听，共',_0x35d3be['sentences']['length'],'句话'),callSpeeches=_0x35d3be[_0x4c46a7(0x6b7)],callShouldHangup=_0x35d3be[_0x4c46a7(0x292)]||![],currentCallSpeechIndex=0x0,_0x35d3be['sentences'][_0x4c46a7(0x7b6)](_0x5cfe03=>{const _0x1fbb90=_0x4c46a7;callTranscript[_0x1fbb90(0x2c4)]({'role':'ai','text':_0x5cfe03,'timestamp':Date[_0x1fbb90(0x2cb)]()});}),console[_0x4c46a7(0x41f)]('📝\x20记录陌生人第一句话到通话记录:',_0x35d3be[_0x4c46a7(0x6b7)]),showCallScreen(_0x4c46a7(0x520),_0x3c4ce4),showCallSpeech()):(console['error'](_0x4c46a7(0x837)),showIslandNotification('错误','对方没有应答',_0x4c46a7(0x56c)),setTimeout(()=>hideCallScreen(),0x5dc));}else console['error'](_0x4c46a7(0x375)),showIslandNotification('错误',_0x4c46a7(0x202),_0x4c46a7(0x56c)),setTimeout(()=>hideCallScreen(),0x5dc);}else console[_0x4c46a7(0x56c)](_0x4c46a7(0x74c)),showIslandNotification('错误',_0x4c46a7(0x2f3),_0x4c46a7(0x56c)),setTimeout(()=>hideCallScreen(),0x5dc);}}},0x5dc);}function addPhoneContact(){const _0x2fcdbe=_0x28e739;phoneCurrentNumber&&(console[_0x2fcdbe(0x41f)](_0x2fcdbe(0x2a4),phoneCurrentNumber),showDynamicIsland(_0x2fcdbe(0x2d6),formatPhoneNumber(phoneCurrentNumber)));}function switchPhoneTab(_0x1b3fa9){const _0x13a0f7=_0x28e739;document[_0x13a0f7(0x42c)](_0x13a0f7(0x618))[_0x13a0f7(0x7b6)](_0x3508d2=>_0x3508d2[_0x13a0f7(0x421)][_0x13a0f7(0x403)](_0x13a0f7(0x525)));if(event&&event[_0x13a0f7(0x6e4)]){const _0x53b707=event[_0x13a0f7(0x6e4)][_0x13a0f7(0x7c0)]('.phone-nav-item');if(_0x53b707)_0x53b707[_0x13a0f7(0x421)][_0x13a0f7(0x5e3)](_0x13a0f7(0x525));}const _0x3f52f2=document[_0x13a0f7(0x768)](_0x13a0f7(0x3bf)),_0x49bacd=document[_0x13a0f7(0x768)]('.phone-recent-content'),_0x51e038=document[_0x13a0f7(0x768)]('.phone-contacts-content');if(!_0x3f52f2||!_0x49bacd){console[_0x13a0f7(0x516)](_0x13a0f7(0x1b5));return;}_0x3f52f2[_0x13a0f7(0x577)]['display']='none',_0x49bacd[_0x13a0f7(0x577)][_0x13a0f7(0x475)]='none';if(_0x51e038)_0x51e038[_0x13a0f7(0x577)][_0x13a0f7(0x475)]=_0x13a0f7(0x562);switch(_0x1b3fa9){case _0x13a0f7(0x838):_0x49bacd['style']['display']='flex',loadRecentPageUserProfile(),loadCallRecords(),triggerRecentPageAnimation(_0x49bacd),console[_0x13a0f7(0x41f)](_0x13a0f7(0x6c6));break;case _0x13a0f7(0x315):_0x51e038&&(_0x51e038['style']['display']=_0x13a0f7(0x439),renderContactsList(),loadContactsMyCard(),initContactsAlphabetIndex(),triggerContactsPageAnimation(_0x51e038),console['log'](_0x13a0f7(0x31d)));break;case _0x13a0f7(0x72f):default:_0x3f52f2[_0x13a0f7(0x577)][_0x13a0f7(0x475)]='flex',_0x49bacd[_0x13a0f7(0x421)]['remove']('animating'),console[_0x13a0f7(0x41f)](_0x13a0f7(0x4a9));break;}}async function loadRecentPageUserProfile(){const _0x13b4b9=_0x28e739;try{const _0x28b825=await db['globalSettings'][_0x13b4b9(0x309)]('currentProfileId');if(!_0x28b825){console['warn']('📱\x20[Recent]\x20No\x20current\x20profile\x20found');return;}const _0x5b0432=await db[_0x13b4b9(0x70f)][_0x13b4b9(0x309)](_0x28b825[_0x13b4b9(0x29c)]);if(!_0x5b0432){console[_0x13b4b9(0x516)](_0x13b4b9(0x5e9),_0x28b825[_0x13b4b9(0x29c)]);return;}const _0x52fbb1=_0x13b4b9(0x416),_0x5ca204=document[_0x13b4b9(0x761)](_0x13b4b9(0x559)),_0x5e5066=document[_0x13b4b9(0x761)](_0x13b4b9(0x415)),_0x48bb03=document[_0x13b4b9(0x761)]('recentPromoBio');_0x5ca204&&(_0x5ca204[_0x13b4b9(0x273)]=_0x5b0432['avatar']||_0x52fbb1),_0x5e5066&&(_0x5e5066['textContent']=_0x5b0432['username']||_0x5b0432[_0x13b4b9(0x76a)]||_0x13b4b9(0x50b)),_0x48bb03&&(_0x48bb03[_0x13b4b9(0x7dc)]=_0x5b0432[_0x13b4b9(0x61c)]||_0x13b4b9(0x7fe)),console[_0x13b4b9(0x41f)](_0x13b4b9(0x3d1),_0x5b0432['username']||_0x5b0432[_0x13b4b9(0x76a)]);}catch(_0x3edcba){console['error'](_0x13b4b9(0x4a4),_0x3edcba);}}function triggerRecentPageAnimation(_0x219e7a){const _0x3f6ba7=_0x28e739;_0x219e7a[_0x3f6ba7(0x421)][_0x3f6ba7(0x403)](_0x3f6ba7(0x81b)),void _0x219e7a[_0x3f6ba7(0x1d3)],_0x219e7a[_0x3f6ba7(0x421)][_0x3f6ba7(0x5e3)](_0x3f6ba7(0x81b));}function triggerContactsPageAnimation(_0x136f5e){const _0x3be8c1=_0x28e739;_0x136f5e[_0x3be8c1(0x421)]['remove']('animating'),void _0x136f5e[_0x3be8c1(0x1d3)],_0x136f5e[_0x3be8c1(0x421)][_0x3be8c1(0x5e3)](_0x3be8c1(0x81b));}function filterRecentCalls(_0x1a87d3){const _0x2c097b=_0x28e739,_0x12ca22=document[_0x2c097b(0x42c)]('.recent-filter-tab');_0x12ca22[_0x2c097b(0x7b6)](_0x54ebf1=>_0x54ebf1[_0x2c097b(0x421)][_0x2c097b(0x403)](_0x2c097b(0x525))),event[_0x2c097b(0x6e4)][_0x2c097b(0x421)][_0x2c097b(0x5e3)](_0x2c097b(0x525)),currentCallFilter=_0x1a87d3,console[_0x2c097b(0x41f)](_0x2c097b(0x8d2),_0x1a87d3),renderCallRecords();}function searchRecentCalls(){const _0x221280=_0x28e739,_0x1f5779=document[_0x221280(0x768)]('.recent-search-input'),_0x35f4d3=_0x1f5779?_0x1f5779[_0x221280(0x29c)][_0x221280(0x28e)]()['toLowerCase']():'';currentSearchQuery=_0x35f4d3,console[_0x221280(0x41f)]('📱\x20Search\x20recent\x20calls:',_0x35f4d3),renderCallRecords();}function openPhoneContacts(){const _0x13f304=_0x28e739;console['log'](_0x13f304(0x4e4)),switchPhoneTab(_0x13f304(0x315));}let contactsListCache=[];async function renderContactsList(){const _0x298c4e=_0x28e739,_0x118f86=document[_0x298c4e(0x761)]('contactsList');if(!_0x118f86)return;try{const _0x45d9f6=await db['contacts'][_0x298c4e(0x5fd)]();console[_0x298c4e(0x41f)]('📱\x20[Contacts]\x20Loaded',_0x45d9f6[_0x298c4e(0x6ea)],'contacts');const _0x346f9d=_0x45d9f6[_0x298c4e(0x911)](_0x2bba97=>{const _0x3fb3ea=_0x298c4e;if(!_0x2bba97)return![];if(_0x2bba97[_0x3fb3ea(0x3ae)])return!![];if(_0x2bba97[_0x3fb3ea(0x6ca)])return!![];if(typeof _0x2bba97[_0x3fb3ea(0x42b)]===_0x3fb3ea(0x1ad))return!![];if(_0x2bba97[_0x3fb3ea(0x89d)])return![];if(_0x2bba97[_0x3fb3ea(0x41d)])return![];if(_0x2bba97[_0x3fb3ea(0x3a4)])return![];if(_0x2bba97['isStranger'])return![];return!![];}),_0x51d40f=_0x45d9f6[_0x298c4e(0x6ea)]-_0x346f9d[_0x298c4e(0x6ea)];_0x51d40f>0x0&&console[_0x298c4e(0x41f)](_0x298c4e(0x73e),_0x51d40f),contactsListCache=_0x346f9d,renderContactsListFromData(_0x346f9d);}catch(_0x2b45dc){console[_0x298c4e(0x56c)](_0x298c4e(0x489),_0x2b45dc),_0x118f86[_0x298c4e(0x5b8)]=_0x298c4e(0x70e);}}function renderContactsListFromData(_0x464f71){const _0x5448c5=_0x28e739,_0x5823e3=document[_0x5448c5(0x761)](_0x5448c5(0x95b));if(!_0x5823e3)return;if(_0x464f71[_0x5448c5(0x6ea)]===0x0){_0x5823e3[_0x5448c5(0x5b8)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contacts-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M20\x2021v-2a4\x204\x200\x200\x200-4-4H8a4\x204\x200\x200\x200-4\x204v2\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2212\x22\x20cy=\x227\x22\x20r=\x224\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contacts-empty-text\x22>暂无联系人</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contacts-empty-subtext\x22>点击右上角添加新联系人</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20';return;}const _0x413a3b=_0x464f71[_0x5448c5(0x8da)]((_0x521345,_0x499d21)=>{const _0x285af6=_0x5448c5,_0x51f51f=_0x521345[_0x285af6(0x8e5)]||_0x521345[_0x285af6(0x76a)]||'',_0x13bc44=_0x499d21['nickname']||_0x499d21[_0x285af6(0x76a)]||'';return _0x51f51f['localeCompare'](_0x13bc44,_0x285af6(0x34a));}),_0x3712fb={};_0x413a3b[_0x5448c5(0x7b6)](_0x216317=>{const _0x521071=_0x5448c5,_0x3d1980=_0x216317[_0x521071(0x8e5)]||_0x216317[_0x521071(0x76a)]||'?',_0x32cb86=_0x3d1980[_0x521071(0x5ed)](0x0)['toUpperCase'](),_0x206182=getPinyinInitial(_0x32cb86)||'#';!_0x3712fb[_0x206182]&&(_0x3712fb[_0x206182]=[]),_0x3712fb[_0x206182]['push'](_0x216317);});const _0x21beab=Object[_0x5448c5(0x961)](_0x3712fb)[_0x5448c5(0x8da)]((_0x27a1b6,_0x11d9a9)=>{const _0x7cee0f=_0x5448c5;if(_0x27a1b6==='#')return 0x1;if(_0x11d9a9==='#')return-0x1;return _0x27a1b6[_0x7cee0f(0x843)](_0x11d9a9);});let _0x53b6a7='';_0x21beab[_0x5448c5(0x7b6)](_0x1fbff2=>{const _0x4cd535=_0x5448c5;_0x53b6a7+=_0x4cd535(0x500)+_0x1fbff2+'\x22>',_0x53b6a7+=_0x4cd535(0x8d9)+_0x1fbff2+'</div>',_0x3712fb[_0x1fbff2][_0x4cd535(0x7b6)](_0xbf6dbd=>{const _0x448458=_0x4cd535,_0x33dfda=_0xbf6dbd[_0x448458(0x8e5)]||_0xbf6dbd['name']||'未知',_0x35cd3e=_0xbf6dbd[_0x448458(0x4ea)]||'',_0x24d5fa=_0xbf6dbd['contactAvatar']||_0xbf6dbd[_0x448458(0x708)]||'',_0x1ba568=_0x33dfda[_0x448458(0x5ed)](0x0),_0x5e0bd5=formatPhoneNumberDisplay(_0x35cd3e);_0x53b6a7+=_0x448458(0x38d)+_0x35cd3e+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contacts-item-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x24d5fa?_0x448458(0x6da)+_0x24d5fa+'\x22\x20alt=\x22'+_0x33dfda+'\x22>':_0x1ba568)+_0x448458(0x7ad)+_0x33dfda+_0x448458(0x75e)+_0x5e0bd5+_0x448458(0x81e);}),_0x53b6a7+=_0x4cd535(0x611);}),_0x5823e3[_0x5448c5(0x5b8)]=_0x53b6a7;}function getPinyinInitial(_0x40c1bc){const _0x4384e7=_0x28e739,_0x2e50d0={'阿艾安':'A','巴白百班包宝北贝本必边标表别兵波伯博不步部':'B','才财彩菜蔡参曹草策层曾茶察产昌常超朝潮陈成承程城池迟赤崇初除楚川传船窗床创春纯词此次从村存':'C','达答大代带单但当党刀导到道得德的灯等邓低底地弟第典点电店丁定冬东董动栋都斗读独度段对顿多':'D','俄而尔耳二':'E','发法凡饭方房防访放飞非肥费分丰风封冯佛否夫服福府父复付傅富':'F','改盖甘干刚高告哥歌格个各给根更工公功供宫恭共谷古骨股故顾固瓜挂怪关官观管馆光广归龟规鬼贵桂国果过':'G','海韩寒汉杭航豪好合何河和核贺黑很恨红宏洪后候厚胡湖虎互户护花华划化画话怀坏欢环换皇黄回汇会惠婚混活火或获':'H','机积基极及吉级即急几己纪计记济继加佳家假架嫁坚间简建健剑江将蒋奖讲交郊娇焦角叫教接节杰结解姐介界今金津进近京经井景警静镜九久酒就居局菊举句具俱据剧惧聚军均君':'J','开凯看康考科可克客肯空孔控口苦库快况块宽狂矿':'K','来兰蓝郎浪劳老乐雷蕾类冷李理力历利立丽例连联莲廉脸练良凉两亮谅料列烈林临零灵领另刘流六龙楼陆路露鲁录陆律绿论罗洛落吕旅律':'L','妈麻马吗买卖满慢忙毛茅么没美妹门们孟梦米秘密免面苗描秒妙民敏名明命摩磨模末默某母木目墓幕':'M','拿哪那乃男南难内能尼你年念娘鸟宁牛农弄怒女暖诺':'N','欧偶':'O','拍派潘盘判旁跑培朋鹏批皮片票品平评破普':'P','七妻其奇齐起气器千迁前钱强墙桥巧切且亲青清轻情晴请庆秋丘求球区曲取去全权泉群':'Q','然让饶热人仁认日容荣柔肉如入软瑞润若':'R','撒赛三散桑扫色森沙山杉善伤商上尚少绍社舍设申身深神沈生声胜圣师诗十时实使始士世市示事势视试室是适释收手首守受书舒叔殊术束树数帅双水顺说丝司私死四寺似松宋送搜苏俗素速宿孙损所锁索':'S','他她它台太态泰谈坦探汤唐堂糖逃桃讨特疼腾提题体天田甜条跳铁听廷亭停庭通同童统头投图土团推退托脱':'T','挖娃瓦外弯湾完玩晚万汪王网往忘望危威微为围唯维伟委尾卫未位味温文闻问翁我乌无吴五午伍武舞物误务':'W','西希息悉习席洗喜戏系细虾下夏先仙鲜显县现限线相香箱想向象项像消小晓笑效些谢心新信星行形性姓幸兴雄熊休修秀许叙续选学雪寻训迅':'X','压牙呀雅亚言颜严岩延沿研盐眼演燕央阳洋样摇药要耀爷也冶野业叶页一伊衣依医仪宜移以已艺亿忆义益意易亦异谊译因音阴银印应英樱营影迎赢硬用优由油游友有又右幼于与予雨语玉育郁元园原员圆袁源远院愿月越云允运':'Y','杂灾再在咱赞脏藏早造则泽责怎增曾扎眨炸榨宅窄斋寨战站张章掌丈仗帐障招找召兆赵照者这折哲浙针珍真镇震争正整政证之支只知织职直值植执止指至志致制智中忠终钟众种周洲舟州诸珠株朱竹主住助注祝著筑专转装壮状追准桌着子姿资紫字自宗综总纵走租足族组祖阻最罪醉尊遵作坐座做':'Z'};if(/[A-Z]/['test'](_0x40c1bc))return _0x40c1bc;if(/[a-z]/[_0x4384e7(0x5b6)](_0x40c1bc))return _0x40c1bc[_0x4384e7(0x8fa)]();for(const [_0x122602,_0x5d1571]of Object[_0x4384e7(0x92a)](_0x2e50d0)){if(_0x122602['includes'](_0x40c1bc))return _0x5d1571;}return'#';}function formatPhoneNumberDisplay(_0x22e41b){const _0x3b8310=_0x28e739;if(!_0x22e41b)return'';const _0x429fc2=_0x22e41b[_0x3b8310(0x568)](/\D/g,'');if(_0x429fc2['length']===0xb)return _0x429fc2[_0x3b8310(0x73d)](0x0,0x3)+'\x20****\x20'+_0x429fc2[_0x3b8310(0x73d)](0x7);return _0x22e41b;}async function loadContactsMyCard(){const _0x39d381=_0x28e739;try{const _0x50cbbc=await db[_0x39d381(0x175)][_0x39d381(0x309)](_0x39d381(0x619));if(!_0x50cbbc)return;const _0xdbf076=await db[_0x39d381(0x70f)][_0x39d381(0x309)](_0x50cbbc[_0x39d381(0x29c)]);if(!_0xdbf076)return;const _0x2a5ad3=document[_0x39d381(0x761)](_0x39d381(0x855)),_0x5538f0=document[_0x39d381(0x761)](_0x39d381(0x393));_0x2a5ad3&&(_0x2a5ad3['textContent']=_0xdbf076['name']||_0xdbf076['username']||'用户'),_0x5538f0&&_0xdbf076[_0x39d381(0x708)]&&(_0x5538f0[_0x39d381(0x5b8)]=_0x39d381(0x6da)+_0xdbf076[_0x39d381(0x708)]+'\x22\x20alt=\x22Avatar\x22>'),console[_0x39d381(0x41f)](_0x39d381(0x884));}catch(_0x5d56ec){console[_0x39d381(0x56c)]('📱\x20[Contacts]\x20Failed\x20to\x20load\x20my\x20card:',_0x5d56ec);}}function initContactsAlphabetIndex(){const _0x1408dd=_0x28e739,_0x4ab373=document[_0x1408dd(0x42c)]('.contacts-index-letter'),_0x5bd9f3=document[_0x1408dd(0x761)](_0x1408dd(0x1b7));let _0xc5c17d=![];_0x4ab373[_0x1408dd(0x7b6)](_0x2ac42b=>{const _0x2dde37=_0x1408dd;_0x2ac42b['addEventListener'](_0x2dde37(0x7bd),()=>{const _0x1a3e41=_0x2dde37;scrollToContactsLetter(_0x2ac42b[_0x1a3e41(0x672)][_0x1a3e41(0x96b)]);}),_0x2ac42b[_0x2dde37(0x55d)](_0x2dde37(0x3df),_0x485593=>{_0x485593['preventDefault'](),_0xc5c17d=!![],handleContactsIndexTouch(_0x485593['touches'][0x0],_0x4ab373,_0x5bd9f3);});}),document[_0x1408dd(0x55d)]('touchmove',_0x345d66=>{const _0x2377f0=_0x1408dd;_0xc5c17d&&handleContactsIndexTouch(_0x345d66[_0x2377f0(0x1b0)][0x0],_0x4ab373,_0x5bd9f3);}),document['addEventListener']('touchend',()=>{_0xc5c17d&&(_0xc5c17d=![],hideContactsIndicator(_0x5bd9f3,_0x4ab373));});}function handleContactsIndexTouch(_0x17be73,_0x4c4a62,_0x4942df){const _0x202591=_0x28e739,_0x275b83=document[_0x202591(0x95f)](_0x17be73[_0x202591(0x6b3)],_0x17be73['clientY']);if(_0x275b83&&_0x275b83[_0x202591(0x421)][_0x202591(0x6e3)](_0x202591(0x699))){const _0x1b3fcf=_0x275b83[_0x202591(0x672)][_0x202591(0x96b)];showContactsIndicator(_0x1b3fcf,_0x4942df),scrollToContactsLetter(_0x1b3fcf),_0x4c4a62['forEach'](_0x30f963=>_0x30f963[_0x202591(0x421)][_0x202591(0x403)]('active')),_0x275b83['classList']['add'](_0x202591(0x525));}}function scrollToContactsLetter(_0x36a984){const _0x5c5b0f=_0x28e739,_0x432eeb=document['getElementById']('contacts-group-'+_0x36a984);_0x432eeb&&_0x432eeb[_0x5c5b0f(0x4cf)]({'behavior':_0x5c5b0f(0x5d8),'block':_0x5c5b0f(0x813)});}function showContactsIndicator(_0x1a246f,_0x2dd135){const _0x55945a=_0x28e739;_0x2dd135&&(_0x2dd135[_0x55945a(0x7dc)]=_0x1a246f,_0x2dd135[_0x55945a(0x421)][_0x55945a(0x5e3)](_0x55945a(0x332)));}function hideContactsIndicator(_0x322ac5,_0x5f180e){const _0x913c98=_0x28e739;_0x322ac5&&_0x322ac5[_0x913c98(0x421)][_0x913c98(0x403)](_0x913c98(0x332)),_0x5f180e[_0x913c98(0x7b6)](_0x5a18f6=>_0x5a18f6[_0x913c98(0x421)][_0x913c98(0x403)](_0x913c98(0x525)));}function filterContacts(_0x318df4){const _0x571e74=_0x28e739,_0x2cf7ae=_0x318df4[_0x571e74(0x6eb)]()[_0x571e74(0x28e)]();if(!_0x2cf7ae){renderContactsListFromData(contactsListCache);return;}const _0x177660=contactsListCache[_0x571e74(0x911)](_0x3ceb23=>{const _0x33e44e=_0x571e74,_0x551b8a=(_0x3ceb23[_0x33e44e(0x8e5)]||_0x3ceb23['name']||'')[_0x33e44e(0x6eb)](),_0x108089=(_0x3ceb23['phoneNumber']||'')['replace'](/\D/g,'');return _0x551b8a['includes'](_0x2cf7ae)||_0x108089[_0x33e44e(0x44b)](_0x2cf7ae);});renderContactsListFromData(_0x177660);}function openContactDetail(_0x5e2417){console['log']('📱\x20[Contacts]\x20Opening\x20contact\x20detail:',_0x5e2417),showContactDetail(_0x5e2417);}function showMyCardDetail(){const _0x59da1a=_0x28e739;console['log'](_0x59da1a(0x5a2)),showIslandNotification('我的名片',_0x59da1a(0x2cc),'info');}let currentCallFilter='all',currentSearchQuery='',allCallRecordsCache=[];async function loadCallRecords(){const _0x2633fe=_0x28e739;try{const _0x1d5041=await db['callRecords']['orderBy']('timestamp')[_0x2633fe(0x71c)]()['toArray']();allCallRecordsCache=_0x1d5041,console[_0x2633fe(0x41f)](_0x2633fe(0x605),_0x1d5041['length'],'call\x20records'),await renderCallRecords();}catch(_0x4b8ef5){console[_0x2633fe(0x56c)]('📱\x20[Recent]\x20Failed\x20to\x20load\x20call\x20records:',_0x4b8ef5);}}async function renderCallRecords(){const _0x2a3be4=_0x28e739,_0x43a4c4=document[_0x2a3be4(0x761)](_0x2a3be4(0x80f));if(!_0x43a4c4)return;let _0x4d7195=allCallRecordsCache;currentCallFilter===_0x2a3be4(0x5c2)&&(_0x4d7195=_0x4d7195['filter'](_0x44bb68=>_0x44bb68[_0x2a3be4(0x660)]===_0x2a3be4(0x5c2)));currentSearchQuery&&(_0x4d7195=_0x4d7195[_0x2a3be4(0x911)](_0x287674=>{const _0x595250=_0x2a3be4,_0xc60292=_0x287674['phoneNumber']?.['toLowerCase']()['includes'](currentSearchQuery),_0x1617ae=_0x287674['characterName']?.[_0x595250(0x6eb)]()['includes'](currentSearchQuery);return _0xc60292||_0x1617ae;}));if(_0x4d7195['length']===0x0){_0x43a4c4['innerHTML']=_0x2a3be4(0x507);return;}const _0xb87fc5=_0x4d7195[_0x2a3be4(0x962)]((_0x3c91e1,_0x239793)=>{const _0x4a4478=_0x2a3be4,{phoneNumber:_0x226a46,characterName:_0x2ad904,characterAvatar:_0xaf78e,callType:_0x139823,timestamp:_0x51e0ef,duration:_0x72acc2}=_0x3c91e1,_0x5102d7=_0x2ad904||formatPhoneNumberDisplay(_0x226a46),_0x12066e=formatCallTime(_0x51e0ef),_0x31497a=_0x139823===_0x4a4478(0x5a8)?_0x4a4478(0x5a8):_0x139823===_0x4a4478(0x93e)?_0x4a4478(0x93e):_0x4a4478(0x5c2),_0x534693=_0x139823===_0x4a4478(0x5c2)?_0x4a4478(0x5c2):'',_0xcfbe69=_0x139823===_0x4a4478(0x5a8)?'<path\x20d=\x22M7\x2017L17\x207M17\x207H7M17\x207v10\x22/>':_0x4a4478(0x52f);let _0x3c6835;if(_0xaf78e)_0x3c6835=_0x4a4478(0x6da)+_0xaf78e+_0x4a4478(0x7e7);else{if(_0x2ad904){const _0x5e0bba=_0x2ad904[_0x4a4478(0x5ed)](0x0)[_0x4a4478(0x8fa)]();_0x3c6835=_0x4a4478(0x8c4)+_0x5e0bba+_0x4a4478(0x975);}else _0x3c6835=_0x4a4478(0x982);}const _0x1aa9a6=_0x139823===_0x4a4478(0x5a8)?'呼出':_0x139823==='incoming'?'来电':'未接',_0x17c016=_0x72acc2?_0x4a4478(0x907)+formatCallDuration(_0x72acc2):'',_0x2e2d55=_0x17c016?_0x1aa9a6+_0x4a4478(0x2ec)+_0x17c016:_0x1aa9a6,_0x460e9b=_0x239793<_0x4d7195[_0x4a4478(0x6ea)]-0x1?_0x4a4478(0x21a):'';return _0x4a4478(0x5aa)+_0x226a46+_0x4a4478(0x17a)+(_0xaf78e?_0x4a4478(0x7d3):'')+_0x4a4478(0x653)+_0x3c6835+_0x4a4478(0x782)+_0x534693+_0x4a4478(0x3c3)+_0x31497a+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>'+_0xcfbe69+_0x4a4478(0x45b)+_0x5102d7+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22recent-call-tag\x22>'+_0x2e2d55+_0x4a4478(0x376)+_0x12066e+_0x4a4478(0x24a)+_0x226a46+_0x4a4478(0x3e0)+_0x460e9b+_0x4a4478(0x457);})['join']('');_0x43a4c4[_0x2a3be4(0x5b8)]=_0xb87fc5;}function formatPhoneNumberDisplay(_0x20c0e8){const _0x2dd602=_0x28e739;if(!_0x20c0e8)return'';const _0x1c5c97=_0x20c0e8[_0x2dd602(0x568)](/\s/g,'')[_0x2dd602(0x568)](/-/g,'');if(_0x1c5c97[_0x2dd602(0x6ea)]===0xb)return _0x1c5c97[_0x2dd602(0x73d)](0x0,0x3)+'\x20'+_0x1c5c97[_0x2dd602(0x73d)](0x3,0x7)+'\x20'+_0x1c5c97[_0x2dd602(0x73d)](0x7);return _0x20c0e8;}function showCallInfo(_0x5785d6){const _0x59ffee=_0x28e739;console[_0x59ffee(0x41f)](_0x59ffee(0x5eb),_0x5785d6),showContactDetail(_0x5785d6);}let currentContactData=null;async function showContactDetail(_0x4c5882){const _0x3c5c88=_0x28e739,_0x1cf647=document['getElementById']('phoneContactDetail');if(!_0x1cf647){console[_0x3c5c88(0x516)](_0x3c5c88(0x4f6));return;}console[_0x3c5c88(0x41f)]('📱\x20======\x20showContactDetail\x20START\x20======'),console[_0x3c5c88(0x41f)](_0x3c5c88(0x2a9),_0x4c5882);let _0x3f8d3c=await db['callRecords'][_0x3c5c88(0x56a)](_0x3c5c88(0x4ea))[_0x3c5c88(0x82f)](_0x4c5882)['reverse']()[_0x3c5c88(0x8d4)](_0x3c5c88(0x407));console[_0x3c5c88(0x41f)](_0x3c5c88(0x917),JSON[_0x3c5c88(0x8f7)](_0x3f8d3c,null,0x2));const _0x3fab01=await db[_0x3c5c88(0x698)]['filter'](_0x439a45=>_0x439a45['type']===_0x3c5c88(0x8e8))[_0x3c5c88(0x5fd)]();console[_0x3c5c88(0x41f)](_0x3c5c88(0x7f7),_0x3fab01['length'],'条'),_0x3fab01[_0x3c5c88(0x7b6)]((_0x12f13d,_0x1b58d4)=>{const _0x35f97d=_0x3c5c88;console[_0x35f97d(0x41f)]('📱\x20chatMessages['+_0x1b58d4+']:',{'phoneNumber':_0x12f13d['phoneNumber'],'timestamp':_0x12f13d[_0x35f97d(0x407)],'hasTranscript':_0x12f13d[_0x35f97d(0x34b)]?.['length']>0x0,'transcriptCount':_0x12f13d[_0x35f97d(0x34b)]?.[_0x35f97d(0x6ea)]||0x0});});for(let _0x17dd64=0x0;_0x17dd64<_0x3f8d3c[_0x3c5c88(0x6ea)];_0x17dd64++){console['log'](_0x3c5c88(0x57a)+_0x17dd64+']:',{'phoneNumber':_0x3f8d3c[_0x17dd64][_0x3c5c88(0x4ea)],'timestamp':_0x3f8d3c[_0x17dd64]['timestamp'],'hasTranscript':_0x3f8d3c[_0x17dd64][_0x3c5c88(0x91a)]?.[_0x3c5c88(0x6ea)]>0x0});if(!_0x3f8d3c[_0x17dd64][_0x3c5c88(0x91a)]||_0x3f8d3c[_0x17dd64][_0x3c5c88(0x91a)][_0x3c5c88(0x6ea)]===0x0){const _0x5e98ea=await db['chatMessages'][_0x3c5c88(0x911)](_0x476343=>_0x476343[_0x3c5c88(0x3a3)]===_0x3c5c88(0x8e8)&&_0x476343['phoneNumber']===_0x4c5882&&Math[_0x3c5c88(0x268)](_0x476343[_0x3c5c88(0x407)]-_0x3f8d3c[_0x17dd64][_0x3c5c88(0x407)])<0xea60)[_0x3c5c88(0x5fd)]();console['log'](_0x3c5c88(0x29b),_0x5e98ea[_0x3c5c88(0x6ea)],'条');const _0x26eb70=_0x5e98ea[0x0];_0x26eb70&&_0x26eb70['callTranscript']&&_0x26eb70[_0x3c5c88(0x34b)][_0x3c5c88(0x6ea)]>0x0?(_0x3f8d3c[_0x17dd64][_0x3c5c88(0x91a)]=_0x26eb70[_0x3c5c88(0x34b)],console[_0x3c5c88(0x41f)](_0x3c5c88(0x326),_0x3f8d3c[_0x17dd64][_0x3c5c88(0x91a)])):console[_0x3c5c88(0x41f)](_0x3c5c88(0x28d));}}console['log'](_0x3c5c88(0x90e),_0x3f8d3c);const _0x469544=_0x3f8d3c[0x0]||{};let _0x5a5a6e=_0x469544[_0x3c5c88(0x27f)]||null,_0x35fe88=_0x469544[_0x3c5c88(0x1aa)]||null,_0x21b42c=_0x469544['characterId']||null,_0x2c5e18=_0x469544['isStranger']||![],_0x337154=_0x469544[_0x3c5c88(0x3a5)]||null;console[_0x3c5c88(0x41f)](_0x3c5c88(0x8aa),_0x2c5e18,_0x3c5c88(0x244),_0x337154?.[_0x3c5c88(0x76a)]||'null');const _0x4c9a71=await db[_0x3c5c88(0x315)]['get'](_0x4c5882);let _0x5d45f8=![],_0x316ba1=null,_0x5a6858=null;if(_0x4c9a71){_0x5d45f8=!![],_0x316ba1=_0x4c9a71[_0x3c5c88(0x8e5)],_0x5a6858=_0x4c9a71[_0x3c5c88(0x691)],_0x21b42c=_0x4c9a71[_0x3c5c88(0x3ae)]||_0x21b42c;_0x4c9a71[_0x3c5c88(0x4d1)]&&(_0x2c5e18=!![]);_0x4c9a71[_0x3c5c88(0x3a5)]&&(_0x337154=_0x4c9a71[_0x3c5c88(0x3a5)]);console[_0x3c5c88(0x41f)]('📱\x20找到通讯录联系人:',_0x316ba1);if(!_0x5a6858&&_0x4c9a71[_0x3c5c88(0x3ae)]){const _0xb00c8f=await getCharacterById(_0x4c9a71['characterId']);_0xb00c8f&&_0xb00c8f[_0x3c5c88(0x6ff)]?.[_0x3c5c88(0x922)]&&(_0x35fe88=_0xb00c8f['settings'][_0x3c5c88(0x922)]);}}console[_0x3c5c88(0x41f)](_0x3c5c88(0x7c7),_0x5d45f8,_0x3c5c88(0x716),_0x2c5e18,_0x3c5c88(0x244),_0x337154?.[_0x3c5c88(0x76a)]||_0x3c5c88(0x64a)),currentContactData={'phoneNumber':_0x4c5882,'characterName':_0x316ba1||_0x5a5a6e,'characterAvatar':_0x5a6858||_0x35fe88,'characterId':_0x21b42c,'isContact':_0x5d45f8,'isStranger':_0x2c5e18,'strangerPersona':_0x337154,'records':_0x3f8d3c};const _0x335e50=document[_0x3c5c88(0x761)](_0x3c5c88(0x178));if(_0x335e50){if(_0x5a6858)_0x335e50[_0x3c5c88(0x5b8)]=_0x3c5c88(0x6da)+_0x5a6858+_0x3c5c88(0x8c1);else{if(_0x35fe88)_0x335e50[_0x3c5c88(0x5b8)]=_0x3c5c88(0x6da)+_0x35fe88+_0x3c5c88(0x8c1);else{if(_0x316ba1||_0x5a5a6e){const _0xae7e3=_0x316ba1||_0x5a5a6e;_0x335e50[_0x3c5c88(0x5b8)]='<span>'+_0xae7e3[_0x3c5c88(0x5ed)](0x0)+_0x3c5c88(0x975);}else _0x335e50[_0x3c5c88(0x5b8)]=_0x3c5c88(0x5d3);}}}const _0x550fed=document['getElementById'](_0x3c5c88(0x410)),_0x3a4ebb=document[_0x3c5c88(0x761)]('contactDetailLabel'),_0xd7d7fb=document['getElementById'](_0x3c5c88(0x6db));if(_0x550fed)_0x550fed[_0x3c5c88(0x7dc)]=_0x5d45f8?_0x3c5c88(0x27b):'未知';const _0x3d14f7=_0x316ba1||_0x5a5a6e;if(_0x3a4ebb)_0x3a4ebb[_0x3c5c88(0x7dc)]=_0x3d14f7||_0x3c5c88(0x8a7);if(_0xd7d7fb)_0xd7d7fb['textContent']=formatPhoneNumberDisplay(_0x4c5882);const _0x435d7a=document[_0x3c5c88(0x761)](_0x3c5c88(0x4a0)),_0x389b12=document[_0x3c5c88(0x761)](_0x3c5c88(0x5a1));if(_0x435d7a)_0x435d7a['textContent']=_0x3f8d3c[_0x3c5c88(0x6ea)]+'\x20条';_0x389b12&&(_0x3f8d3c['length']===0x0?_0x389b12['innerHTML']='<div\x20style=\x22padding:\x2020px;\x20text-align:\x20center;\x20color:\x20var(--text-tertiary);\x22>暂无通话记录</div>':_0x389b12[_0x3c5c88(0x5b8)]=_0x3f8d3c['map']((_0x514381,_0x3983c1)=>{const _0x51d5d6=_0x3c5c88,_0xa62764=_0x514381[_0x51d5d6(0x660)]||_0x51d5d6(0x5a8),_0x1eeda5=_0xa62764===_0x51d5d6(0x5c2)?_0x51d5d6(0x5c2):_0xa62764==='incoming'?_0x51d5d6(0x93e):'outgoing',_0x205d5c=_0xa62764===_0x51d5d6(0x5c2)?'未接来电':_0xa62764===_0x51d5d6(0x93e)?'来电':'去电',_0x465443=_0xa62764===_0x51d5d6(0x5c2)?'missed':'',_0x426b64=_0xa62764===_0x51d5d6(0x5a8)?_0x51d5d6(0x86b):_0xa62764==='missed'?'<path\x20d=\x22M18\x206L6\x2018M6\x206l12\x2012\x22/>':_0x51d5d6(0x6b2),_0x18c74c=formatContactHistoryTime(_0x514381[_0x51d5d6(0x407)]),_0x5c7a04=_0x514381[_0x51d5d6(0x195)]?formatCallDuration(_0x514381[_0x51d5d6(0x195)]):'--',_0x4f4a17=_0x514381[_0x51d5d6(0x91a)]&&_0x514381[_0x51d5d6(0x91a)][_0x51d5d6(0x6ea)]>0x0;console['log']('📱\x20Record',_0x3983c1,_0x51d5d6(0x3e2),_0x4f4a17,'transcript:',_0x514381[_0x51d5d6(0x91a)]);const _0x3586f7=_0x4f4a17?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-history-detail\x22\x20id=\x22contactHistoryDetail_'+_0x3983c1+_0x51d5d6(0x978)+_0x514381['transcript'][_0x51d5d6(0x962)](_0x8c1dd2=>_0x51d5d6(0x549)+(_0x8c1dd2['role']===_0x51d5d6(0x8dd)?_0x51d5d6(0x8dd):'')+'\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-transcript-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-transcript-time\x22>'+formatTranscriptTime(_0x8c1dd2['timestamp'])+_0x51d5d6(0x252)+(_0x8c1dd2[_0x51d5d6(0x7e6)]||_0x8c1dd2[_0x51d5d6(0x632)]||'')+_0x51d5d6(0x317))['join']('')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20':'';return _0x51d5d6(0x84b)+(_0x4f4a17?_0x51d5d6(0x22c)+_0x3983c1+')\x22':'')+_0x51d5d6(0x779)+_0x1eeda5+_0x51d5d6(0x322)+_0x426b64+_0x51d5d6(0x37b)+_0x465443+'\x22>'+_0x205d5c+_0x51d5d6(0x7da)+_0x18c74c+_0x51d5d6(0x295)+_0x5c7a04+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x3586f7+_0x51d5d6(0x6b9);})[_0x3c5c88(0x943)](''));const _0x20606b=document[_0x3c5c88(0x761)](_0x3c5c88(0x786));_0x20606b&&(_0x5d45f8?_0x20606b[_0x3c5c88(0x577)][_0x3c5c88(0x475)]='flex':_0x20606b['style']['display']=_0x3c5c88(0x562));const _0x7d4b5a=document['getElementById'](_0x3c5c88(0x6a9));_0x7d4b5a&&(_0x2c5e18&&_0x337154?(_0x7d4b5a[_0x3c5c88(0x577)]['display']=_0x3c5c88(0x439),console[_0x3c5c88(0x41f)]('📱\x20显示\x22删除此号码\x22按钮，陌生人:',_0x337154[_0x3c5c88(0x76a)])):_0x7d4b5a['style'][_0x3c5c88(0x475)]='none'),_0x1cf647[_0x3c5c88(0x577)][_0x3c5c88(0x475)]=_0x3c5c88(0x439),_0x1cf647[_0x3c5c88(0x421)][_0x3c5c88(0x5e3)](_0x3c5c88(0x81b)),setTimeout(()=>{const _0x5a93d6=_0x3c5c88;_0x1cf647[_0x5a93d6(0x421)]['remove'](_0x5a93d6(0x81b)),_0x1cf647['classList']['add'](_0x5a93d6(0x332));},0x190),console[_0x3c5c88(0x41f)](_0x3c5c88(0x960),_0x4c5882,_0x3c5c88(0x8c2),_0x3f8d3c[_0x3c5c88(0x6ea)],'records');}function hideContactDetail(){const _0xc00ff2=_0x28e739,_0x4c2d91=document[_0xc00ff2(0x761)](_0xc00ff2(0x350));if(!_0x4c2d91)return;_0x4c2d91[_0xc00ff2(0x421)][_0xc00ff2(0x403)]('show'),_0x4c2d91[_0xc00ff2(0x421)][_0xc00ff2(0x5e3)](_0xc00ff2(0x2a7)),setTimeout(()=>{const _0x3fa41f=_0xc00ff2;_0x4c2d91[_0x3fa41f(0x577)][_0x3fa41f(0x475)]=_0x3fa41f(0x562),_0x4c2d91[_0x3fa41f(0x421)][_0x3fa41f(0x403)]('animating-out'),document[_0x3fa41f(0x42c)](_0x3fa41f(0x35f))[_0x3fa41f(0x7b6)](_0x2d79c5=>_0x2d79c5['classList'][_0x3fa41f(0x403)](_0x3fa41f(0x22e))),document[_0x3fa41f(0x42c)](_0x3fa41f(0x56d))[_0x3fa41f(0x7b6)](_0x17467f=>_0x17467f[_0x3fa41f(0x421)][_0x3fa41f(0x403)]('expanded')),document[_0x3fa41f(0x42c)]('.contact-history-detail.expanded')['forEach'](_0x569cc5=>_0x569cc5[_0x3fa41f(0x421)]['remove'](_0x3fa41f(0x22e)));},0x15e),currentContactData=null,console['log'](_0xc00ff2(0x8f6));}function toggleContactHistoryCard(_0x24f6df){const _0x3f5309=_0x28e739;console['log'](_0x3f5309(0x6be),_0x24f6df);const _0x2cc1b8=_0x24f6df[_0x3f5309(0x7c0)]('.contact-history-card');if(!_0x2cc1b8){console['warn']('📱\x20Card\x20not\x20found');return;}const _0x3048b3=_0x2cc1b8[_0x3f5309(0x768)]('.contact-card-content'),_0x703075=_0x24f6df[_0x3f5309(0x768)](_0x3f5309(0x4ef));console[_0x3f5309(0x41f)]('📱\x20Content\x20element:',_0x3048b3),console[_0x3f5309(0x41f)]('📱\x20Arrow\x20element:',_0x703075);if(_0x3048b3)_0x3048b3['classList'][_0x3f5309(0x93a)](_0x3f5309(0x22e));if(_0x703075)_0x703075['classList'][_0x3f5309(0x93a)]('expanded');console[_0x3f5309(0x41f)](_0x3f5309(0x4c4),_0x3048b3?.[_0x3f5309(0x421)]['contains'](_0x3f5309(0x22e)));}function _0x2c65(){const _0x10d29f=['recent','\x27)\x22\x20title=\x22删除分类\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22><polyline\x20points=\x223\x206\x205\x206\x2021\x206\x22/><path\x20d=\x22M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','📱\x20关闭Mmpages页面','👤\x20[Thread]\x20当前身份:\x20','16.最终输出协议','substring','139','targetCommentUsername','📱\x20Closing\x20SMS\x20detail,\x20opened\x20from:','🎨\x20设置\x20','2-digit','localeCompare','【行进轨迹】你的今日行程（只读）。你正忙着呢，别表现得太闲。','deg)','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-avatar-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-avatar\x20imessage-avatar-default\x20','musicWidgetOrbImage','清理重复笔记','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','已选择\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-history-item\x22\x20','✂️\x20[Thread]\x20移除thinking标签，剩余长度:','charProfileAvatar','<div\x20class=\x22image-gallery-empty-state\x22><p>加载失败，请重试</p></div>','已删除\x20','playlistStream','isArray','2.前置Jailbreak','Friday','musicWidgetArtistName','contactsMyCardName','.phone-key','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🖼️\x20打开图片管理:','padEnd','copied!','未找到对应歌单','\x22，删除后：\x0a-\x20该号码的所有数据将被清除\x0a-\x20再次拨打此号码会生成新的随机人设\x0a-\x20此操作无法撤销！','在忙什么呢？','<div\x20class=\x22imessage-avatar-bubble\x20','lyric-stage\x20','\x20条消息吗？此操作无法撤销。','smsContactName','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22irregular-modal\x20active\x22\x20id=\x22deleteCategoryConfirmModal\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-title\x22>确认删除</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22font-size:\x2014px;\x20color:\x20var(--text-secondary);\x20line-height:\x201.6;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20确定要删除分类\x22','diaryEmptyHint','chat','AFFECTION','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-post-image\x20thread-image-desc\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-image-desc-content\x22>','<span\x20style=\x22font-size:\x2014px;\x20font-weight:\x20500;\x22>完成</span>','155','❌\x20标记删除事件失败:','<path\x20d=\x22M7\x2017L17\x207M17\x207H7M17\x207v10\x22/>','smsContactStatus','#baobaobookEntryDrawerTitleText','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-menu\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-menu-item\x20thread-comment-menu-delete\x22\x20onclick=\x22event.stopPropagation();\x20deleteThreadComment(','tagsYes','img','#diaryBook\x20.diary-cover\x20.diary-cover-inner','decorHTML','displayName','song-item','together-card','🔝\x20Token消耗TOP5:','render','audioUpdatedAt','collapsed','getThreadCommentAIResponse','.diary-sticky[data-note-id=\x22','📱\x20Contact\x20saved:','Heavenly','请输入条目内容','❌\x20加载图库分类失败:','label','\x22\x20alt=\x22\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-follow-badge\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x223\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<line\x20x1=\x2212\x22\x20y1=\x225\x22\x20x2=\x2212\x22\x20y2=\x2219\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<line\x20x1=\x225\x22\x20y1=\x2212\x22\x20x2=\x2219\x22\x20y2=\x2212\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','background\x200.8s\x20cubic-bezier(0.4,\x200,\x200.2,\x201)','❌\x20[Thread\x20Detail]\x20获取用户头像失败:','📱\x20[Contacts]\x20My\x20card\x20loaded','未找到当前短信会话','clear','character','style=\x22background-image:\x20url(\x27','<span\x20class=\x22heart-icon\x22>','newContactRealName','Escape','opacity','📱\x20显示\x22删除此号码\x22按钮','<svg\x20viewBox=\x220\x200\x2024\x2024\x22><rect\x20x=\x223\x22\x20y=\x223\x22\x20width=\x2218\x22\x20height=\x2218\x22\x20rx=\x222\x22\x20ry=\x222\x22/><circle\x20cx=\x228.5\x22\x20cy=\x228.5\x22\x20r=\x221.5\x22/><polyline\x20points=\x2221\x2015\x2016\x2010\x205\x2021\x22/></svg>','<path\x20d=\x22M22\x2016.92v3a2\x202\x200\x2001-2.18\x202\x2019.79\x2019.79\x200\x2001-8.63-3.07\x2019.5\x2019.5\x200\x2001-6-6\x2019.79\x2019.79\x200\x2001-3.07-8.67A2\x202\x200\x20014.11\x202h3a2\x202\x200\x20012\x201.72c.127.96.361\x201.903.7\x202.81a2\x202\x200\x2001-.45\x202.11L8.09\x209.91a16\x2016\x200\x20006\x206l1.27-1.27a2\x202\x200\x20012.11-.45c.907.339\x201.85.573\x202.81.7A2\x202\x200\x200122\x2016.92z\x22/><line\x20x1=\x2223\x22\x20y1=\x221\x22\x20x2=\x221\x22\x20y2=\x2223\x22/>','imessageScreen','getContext','📱\x20打开iMessage','✅\x20删除图库分类成功:','idx','.diary-entry-toggle','&gt;','526286PPAgTO','📱\x20[iMessage]\x20打开短信聊天:','\x0a\x0a---\x0a**笔记创作（仅在捕捉到\x22新增且可复用\x22的用户事实时）：**\x0a-\x20先扫描上面的\x22已记录笔记\x22：禁止同义改写复述。\x0a-\x20若本轮无新增事实：不要输出\x20notes（或输出\x20notes:\x20[]）。\x0a-\x20若有新增：notes\x20最多1-2条；每条10-30字；写\x22事实\x22，不要写感想。','is-playing','\x20条待发送短信','userPlaylists','hiddenInContactsList','moveTo','Author','🗑️\x20开始删除短信对话:','无法打开短信','mood','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M14\x202H6a2\x202\x200\x200\x200-2\x202v16a2\x202\x200\x200\x200\x202\x202h12a2\x202\x200\x200\x200\x202-2V8z\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<polyline\x20points=\x2214\x202\x2014\x208\x2020\x208\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<line\x20x1=\x2212\x22\x20y1=\x2218\x22\x20x2=\x2212\x22\x20y2=\x2212\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<line\x20x1=\x229\x22\x20y1=\x2215\x22\x20x2=\x2215\x22\x20y2=\x2215\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>还没有日记内容</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>日记会在聊天中自动生成</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','order','-\x20comment|reply:\x20钻进楼里回复他（楼中楼）。','API\x20来源','未知号码','【记忆固化】','❌\x20[Thread]\x20获取AI评论失败:','📱\x20从callRecords读取:\x20isStranger=','songSearchList','callSpeechBubble','Highlight\x20clicked:','⚠️\x20Web\x20Audio\x20API\x20not\x20supported','按要求完成<thinking>后再输出JSONL。','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','#diaryPage1\x20.diary-page-face','📱\x20播放关闭动画','showReplies','together-item','Black\x20and\x20white\x20keys.','\x27)\x22\x20title=\x22重命名\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M11\x204H4a2\x202\x200\x200\x200-2\x202v14a2\x202\x200\x200\x200\x202\x202h14a2\x202\x200\x200\x200\x202-2v-7\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M18.5\x202.5a2.121\x202.121\x200\x200\x201\x203\x203L12\x2015l-4\x201\x201-4\x209.5-9.5z\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22category-item-btn\x20delete\x22\x20onclick=\x22deleteBaobaobookCategoryWithConfirm(\x27','没有消息记录','\x20views','getDate','8.5.私聊记录','\x22\x20alt=\x22Avatar\x22\x20onerror=\x22this.style.display=\x27none\x27\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-follow-badge\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x205v14\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M5\x2012h14\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-post-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-post-top-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-post-user-time\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22mmpages-post-username\x22>','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22baobaobook-entry-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22baobaobook-entry-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22baobaobook-entry-name\x22>','取消全选','Wednesday','smsSelectAllBtn','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>','\x22\x20alt=\x22\x22\x20onerror=\x22this.parentNode.innerHTML=\x27<svg\x20viewBox=\x5c\x270\x200\x2024\x2024\x5c\x27><path\x20d=\x5c\x27M20\x2021v-2a4\x204\x200\x200\x200-4-4H8a4\x204\x200\x200\x200-4\x204v2\x5c\x27/><circle\x20cx=\x5c\x2712\x5c\x27\x20cy=\x5c\x277\x5c\x27\x20r=\x5c\x274\x5c\x27/></svg>\x27\x22>','with','最后强化提醒。','<span>','openImageGalleryAddModal','imageGalleryCategoryList','replies','\x0a-\x20性别：','11.好感度','\x20/\x20','150','清理重复笔记（点一次提示，再点一次执行）','14px\x20Helvetica\x20Neue','#baobaobookEntryCategorySelect','CHARACTER:\x20',',\x20event)\x22\x20title=\x22删除笔记\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-sticky-body\x22>','🔍\x20查找电话号码对应的角色:','📱\x20Filter\x20recent\x20calls\x20by:','emitSystem','sortBy','phoneNumbers','icon','<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M9\x2018l6-6-6-6\x22/></svg>','font','<div\x20class=\x22contacts-group-letter\x22>','sort','Thread身份：','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22imessage-pinned-name\x22>','user','1px\x20solid\x20var(--thread-border-color)','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22image-gallery-category-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22image-gallery-category-name\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','**警惕**：这是公共场合！不要大声把私房话说出来，但可以用眼神（潜台词）暗示你们的私密关系。','?\x20已删除\x20','newGalleryCategoryName','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-reply-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22thread-reply-action-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x221.8\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<rect\x20x=\x226\x22\x20y=\x226\x22\x20width=\x2214\x22\x20height=\x2214\x22\x20rx=\x222\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M6\x2014l4-4\x206\x206\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2211\x22\x20cy=\x2210\x22\x20r=\x221.5\x22\x20fill=\x22currentColor\x22\x20stroke=\x22none\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<rect\x20x=\x224\x22\x20y=\x224\x22\x20width=\x2214\x22\x20height=\x2214\x22\x20rx=\x222\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22thread-reply-action-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x221.8\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<rect\x20x=\x222\x22\x20y=\x225\x22\x20width=\x2220\x22\x20height=\x2214\x22\x20rx=\x223\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<text\x20x=\x2212\x22\x20y=\x2215.5\x22\x20font-size=\x227\x22\x20font-weight=\x22600\x22\x20text-anchor=\x22middle\x22\x20fill=\x22currentColor\x22\x20stroke=\x22none\x22>GIF</text>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22thread-reply-action-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x221.8\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<polyline\x20points=\x224\x2014\x204\x2020\x2010\x2020\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<polyline\x20points=\x2220\x2010\x2020\x204\x2014\x204\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<line\x20x1=\x2214\x22\x20y1=\x2210\x22\x20x2=\x2220\x22\x20y2=\x224\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<line\x20x1=\x224\x22\x20y1=\x2220\x22\x20x2=\x2210\x22\x20y2=\x2214\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20','together-meta','nickname','60%','unread','call','charProfileHighlights','Close',';\x20position:\x20relative;','pause','transform','</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-mood\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','好感度','AI思考中','covers','clientY','\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-foot\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22diary-page-num\x22>-\x20',',\x20event)\x22\x20title=\x22删除笔记\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-sticky-body\x22>','disabled','📱\x20Contact\x20detail\x20hidden','stringify','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22track-lyric\x22>\x22','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-face\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-spine\x20diary-spine-inner\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-holes\x22><div\x20class=\x22diary-hole\x22></div><div\x20class=\x22diary-hole\x22></div><div\x20class=\x22diary-hole\x22></div><div\x20class=\x22diary-hole\x22></div></div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-inner\x20diary-content-page\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20日期头部\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-head\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-date\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>','toUpperCase','📝\x20[兜底]\x20记录AI第一句话:','imessageSelectAllText','deleted','功能开发中...','通话功能未就绪','✅\x20随机陌生人通话已连接:','missing_gate','End\x20Call','newContactAvatarInput','2.\x20**众目睽睽**：记住，虽然你在回复某个人，但所有人都在看。保持你的人设格调，别崩塌。','baobaobookCategoryDrawerOverlay','图片大小不能超过5MB','通话\x20','创建失败:\x20','scrollContainer','URL格式不正确:','initial','已删除','图片加载失败，请检查URL','📱\x20最终\x20records:','padStart','[百宝书]\x20关闭分类管理抽屉','filter','transparent','views','input','clearRect','Sunday','📱\x20callRecords\x20原始数据:','message','\x0a\x0a虚荣指标：','transcript','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','userPlaylistSelectedIndex','class','📕\x20[Thread]\x20百宝书汇总:\x20角色绑定','promptText','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22category-item-meta\x22>','diaryCoverSince','aiAvatar','📝\x20iMessage编辑模式:','，立即中断AI请求','185','循环播放:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22call-action-btn\x20','❌\x20当前没有打开的帖子','custom-orb','entries','childElementCount','position','📱\x20Found\x20stranger\x20persona:','origin','callAvatarDefaultIcon','border','aria-hidden','some','</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-mood\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>📌</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>笔记</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20笔记页标题\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-title\x22\x20style=\x22text-align:\x20center;\x20color:\x20var(--diary-text-muted,\x20#999);\x22>这一天只有笔记，没有写日记</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20空白区域用于贴便利贴\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-body\x22\x20style=\x22min-height:\x20300px;\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20便利贴笔记\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-post-image\x20mmpages-image-desc\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-image-desc-content\x22>','getDay','\x20张图片','确定要删除\x20','歌单内没有可播放的歌曲','⚠️\x20没有当前角色','toggle','Follow','<div\x20class=\x22sms-message-time\x22>','💡\x20提示:\x20Token使用量超过\x204000，建议关注token消耗','incoming','colors','switching-out','【最终输出协议】','身份与口吻的最高约束。','join','rgba(0,0,0,0.1)','syncLinkedCharacterData','rgba(255,\x20255,\x20255,\x200.4)','sin','baobaobookCategories','<!--\x20[TOKEN_MARKER:\x204.核心人设]\x20-->\x0a#\x20【神罚界碑·核心设定】(THE\x20ANCHOR)\x0a\x0a','保存便签位置失败:','mmpagesEditDisplayName','The\x20static\x20of\x20the\x20universe.','lrc','182','Message','请输入评论内容','charProfileDeviceName','actorRole','你必须把它焊死在脸上。你是他，不是模仿他的小丑。','Holding\x20fragments\x20in\x20our\x20hand','ownerChatId','gallery_','musicWidgetOrbUrl','charProfileFollowers','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-sticky-head\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-sticky-head-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','\x20left:\x20','contactsList','\x20条AI消息需要删除','prev','wxyz','elementFromPoint','📱\x20Contact\x20detail\x20shown\x20for:','keys','map','📱\x20[SMS重回]\x20已同步smsMessages:','✅\x20使用关联角色头像','10.日程表','<div\x20class=\x22imessage-pinned-dot\x22></div>','Ended','如果这里没写，那就是黑暗中的未知，不要胡编乱造。','❌\x20加载角色数据失败:','destination','letter','userProfileId','⚠️\x20没有待发送的短信','deleteGalleryImage','togetherInvitePlaylistTitle','loadedmetadata','getHours','lyrics-line','__ovoAppsBundlePostInit','\x22</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','</span>','confirmAddImage','PLOT\x20POINTS','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-history-detail-inner\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','#baobaobookEntryBtnLeft','mmpagesBioNote','charProfilePosts','❌\x20找不到mmpagesScreen元素','这已经是你的联系人了','systemAction','musicWidgetSkinOverlay','model','var(--text-primary)','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M20\x2021v-2a4\x204\x200\x200\x200-4-4H8a4\x204\x200\x200\x200-4\x204v2\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2212\x22\x20cy=\x227\x22\x20r=\x224\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','⚠️\x20[chat-refresh]\x20failed:','今日行程。','【回声】','globalSettings','获取笔记失败:','lyric|','contactDetailAvatar','afterend','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22recent-call-avatar\x20','❌\x20initSmsWithAI函数不存在！ovo-call.js可能未加载','false','\x22\x20吗？\x0a\x0a删除后该号码将从通讯录中移除，但通话记录和聊天记录将保留。','toggleThreadReplies','inputPlaceholder','toLocaleDateString','buttonText','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20fixed;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20right:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20bottom:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(0,\x200,\x200,\x200.7);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x20100000;\x0a\x20\x20\x20\x20\x20\x20\x20\x20','chats','<img\x20class=\x22thread-post-image\x22\x20src=\x22','✅\x20已删除随机号码联系人:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22image-gallery-category-meta\x22>','1.乱码层','<img\x20class=\x22mmpages-post-image\x22\x20src=\x22','📝\x20[删除事件]\x20已保存:','<option\x20value=\x22\x22>通用（所有角色）</option>','短信系统未就绪，请稍后重试','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-profile-empty\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-profile-empty-icon\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M20\x2021v-2a4\x204\x200\x2000-4-4H8a4\x204\x200\x2000-4\x204v2\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2212\x22\x20cy=\x227\x22\x20r=\x224\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-profile-empty-text\x22>No\x20user\x20profiles\x20found</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','mmpages-menu-styles','【心脏刻度】你对他的当前好感（只读）。这是你回复温度的依据。','getFullYear','rgba(255,255,255,0.05)','✅\x20Token使用量正常','date','已更新','🔐\x20showPasswordDialog\x20接收到的数据:','duration','threadReplyBar','playerSongTitle','没有AI回复可以重新生成','❌\x20[Thread]\x20日程表读取失败:','页按需加载','#baobaobookEntryKeywordsInput','mute','stop','lyric','pointerup','_expanded','knowledgeBooks','user-provided','Password','<option\x20value=\x22\x22>请选择分类</option>','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','strokeStyle','hour','Shadows\x20dance\x20on\x20the\x20wall...','角色补充资料。','characterAvatar','Call\x20Ended','diaryStatSince','number','.imessage-nav-title','maxRight','touches','1048epeKoE','originalRotate','条\x20+\x20chat场景默认','⚠️\x20警告:\x20Token使用量超过\x208000，可能接近某些模型的上下文限制！','📱\x20Phone\x20content\x20containers\x20not\x20found','🗑️\x20删除短信对话:','contactsLetterIndicator','toLocaleTimeString','FINAL','FEEL','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x20280px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20overflow:\x20hidden;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x204px\x2020px\x20rgba(0,0,0,0.08);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#fff;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20-apple-system,\x20sans-serif;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2024px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20','application/json','--diary-page','is-dragging','affectionLevel','请输入正确的11位手机号码','\x0a-\x20**username**:\x20通常是你自己（','\x22\x20onclick=\x22handleCallButtonClick(\x27','188','readyState','.worldview-tab.active[data-category-id]','mmpages','assistant','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22imessage-msg-arrow\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x208\x2014\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M1\x201l6\x206-6\x206\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-msg-preview\x22>','chatDetailScreen','该号码不是联系人','1.5.百宝书-前','userPlaylistView\x20mutation','complete','mmpagesPostsContainer','\x0a（这是你们之间的秘密张力。如果他常看，说明他在意。）','createTextNode','.phone-action-btn','密码错误，还可以尝试','offsetWidth','📱\x20打开Mmpages页面','pointermove','is-interactive','日记本功能未找到','Where\x20melody\x20and\x20chaos\x20meet','setAttribute','\x20transform:\x20rotate(','getMinutes','following','153','deleteBaobaobookEntry','https://i.postimg.cc/fbFPR0JD/d2d8bda1c8b18ba3586e26243c33b240.jpg','diarySharedStyle','分类已启用','歌曲缺少\x20ID','newImagePreviewBox','.diary-page-inner','replyToUsername','contactHistoryDetail_','px;\x20top:\x20','.thread-reply-btn','\x22\x20data-is-reply=\x22','1.\x20先在\x20<thinking>\x20里挣扎（含质控要求）。','messages','moved','普通通话','imessage-edit-bar','sine','playlistCharName','🔍\x20[DEBUG]\x20检查sendCallMessage函数:','mousedown','owner','⚠️\x20电话号码为空，使用默认头像','animate','actorName','object','\x20-</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-deco\x22><i></i><i></i><i></i></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-btn\x20prev\x22\x20onclick=\x22diaryFlip(-1)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M15\x2018l-6-6\x206-6\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-btn\x20next\x22\x20onclick=\x22diaryFlip(1)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M9\x2018l6-6-6-6\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','请输入图片链接','charProfileUsername','confirmDeleteBaobaobookCategory','newImageUrl','Echoes\x20from\x20the\x20garage.','backgroundColor','gender','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-search-action\x22>ADD</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','通话功能异常','🤖\x20AI回复:','removeAttribute','100%','callRecords','pointerId','4.核心人设','diaryOverlay','lyricUpdatedAt','❌异常消息类型\x20#','对方正在通话中，请稍后再拨','expanding','❌\x20保存删除事件失败:','\x20tokens\x20(100%)','removeEventListener','❌\x20角色不存在:','⚠️\x20电话号码不在电话库中，使用默认头像','3.\x20仅输出\x20JSONL。这是你留在雨夜的唯一痕迹。','\x20条聊天记录','#baobaobookEntrySceneCall','smsTypingIndicator','flushChatDetailRefreshIfNeeded:begin','\x0a代称：','No\x20bio\x20available','<div\x20class=\x22recent-call-divider\x22></div>','加载角色专辑封面失败:','📱\x20收纳通话页面','136','.mmpages-post','then','No\x20results','span','isNaN','\x0a内容：','加载角色失败:','新短信','HTTP\x20','<div\x20class=\x22sms-bubble\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22image-gallery-image-delete\x22\x20onclick=\x22deleteGalleryImage(','diaryEntries','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','📱\x20[iMessage]\x20返回会话列表:','onclick=\x22toggleContactHistoryDetail(','maxBottom','expanded','newContactNickname','var(--thread-text-primary)','imageGalleryCategoryPanel','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x204v16m8-8H4\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span>新建条目</span>\x0a\x20\x20\x20\x20\x20\x20','【行动指令】钻进这层楼里去（回复在同一个楼中楼）。别在那自言自语。','scale(0.95)','\x0a\x0a###\x20你的电话号码\x0a','setPointerCapture','entry_','❌\x20找不到通话界面或悬浮球元素','smsDeleteBtn','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x0a【最新记录】：\x0a','cover','path[d*=\x22M20.84\x22],\x20path[d*=\x22M12\x2021.35\x22]','Saturday','<div\x20class=\x22imessage-unread-indicator\x22></div>','mmpagesPosts','proxyUrl','playlistIndex','请输入图片URL：',',\x20strangerPersona=','\x0a当前状态：','replyContent','round','highlights','-\x20comment|main:\x20另起一行，站在他旁边说话（新主评）。','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22recent-call-info-btn\x22\x20onclick=\x22event.stopPropagation();\x20showCallInfo(\x27','declined','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pin-head\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22track-title\x22>','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','pointercancel','\x22\x20alt=\x22动态图片\x22\x20loading=\x22lazy\x22\x20onerror=\x22this.style.display=\x27none\x27\x22>','\x22\x20alt=\x22用户提供的图片\x22\x20loading=\x22lazy\x22\x20onerror=\x22this.style.display=\x27none\x27\x22>','❌\x20无效的评论','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-transcript-text\x22>','diaryStatNotes','dragReady','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22overlay-title\x22>','visible','sms','2236hRlhri','empty','lineWidth','已取消','offsetY','currentCharProfileData','overlayContent','❌\x20切换状态失败:','50%','130','ended','✅\x20[DEBUG]\x20initCallWithAI函数存在，开始调用...','mouseup','JSONL解析失败','random','3058770ubeJra','abs','❌\x20SMS\x20AI回复失败:','smsDeleteBtnText','无角色数据，无法打开日记本','\x22\x20alt=\x22\x22\x20onerror=\x22this.parentElement.innerHTML=\x27<div\x20class=\x5c\x27image-error\x5c\x27>加载失败</div>\x27\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','[百宝书]\x20读取分类失败:','━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━','\x20条...','音效已关闭','music-api.gdstudio.xyz\x20·\x20感谢\x20gdstudio\x20·\x20默认\x20netease','change','src','pronouns','activeElement','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22baobaobook-empty-icon\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x206.253v13m0-13C10.832\x205.477\x209.246\x205\x207.5\x205S4.168\x205.477\x203\x206.253v13C4.168\x2018.477\x205.754\x2018\x207.5\x2018s3.332.477\x204.5\x201.253m0-13C13.168\x205.477\x2014.754\x205\x2016.5\x205c1.747\x200\x203.332.477\x204.5\x201.253v13C19.832\x2018.477\x2018.247\x2018\x2016.5\x2018c-1.746\x200-3.332.477-4.5\x201.253\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22baobaobook-empty-text\x22>暂无知识条目</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','❌\x20删除随机陌生人号码失败:','getTime','touchend','❌\x20[Thread]\x20好感度读取失败:','联系人','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-edit-bar-left\x22\x20onclick=\x22toggleImessageSelectAll()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22imessageSelectAllText\x22>全选</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-edit-bar-right\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22imessage-delete-btn\x22\x20id=\x22imessageDeleteBtn\x22\x20onclick=\x22deleteSelectedImessages()\x22\x20disabled>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20删除\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</article>\x0a\x20\x20\x20\x20\x20\x20','检测到\x20','characterName','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-post-more\x22\x20onclick=\x22event.stopPropagation();\x20toggleMmpagesPostMenu(this,\x20','latest','musicWidgetSongTitle','mmpagesFollowers','pending','【飞石·当前时刻】','❌\x20关闭Mmpages编辑弹窗','#diaryBook\x20.diary-page','mouse','observe','var(--text-color)','pen','播放失败','📱\x20❌\x20无法补全\x20transcript','trim','system','<span\x20class=\x22mmpages-hashtag\x22>#$1</span>','beginPath','shouldHangup','[Init]\x20post\x20apps\x20init\x20failed:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-history-duration\x22>','musicWidgetCustomOrbImage','diaryCoverBio','获取userProfileId失败:','completed','right','📱\x20找到匹配的\x20chatMessages:','value','thinking','currentChatId','日记列表加载失败','🔴\x20角色正在繁忙中:\x20','fillText','暂无可播放的歌单','✅\x20通讯录陌生人通话已连接:','👤\x20Add\x20contact:','歌单暂无歌曲','is-together','animating-out','closeDeleteCategoryConfirm','📱\x20phoneNumber:','diary-entry-content\x20collapsible\x20collapsed','输出格式与检查关卡。','【双首博弈】在开口前，必须先在\x20<thinking>\x20里完成左首与右首的厮杀。','createOscillator','username','likes','showCreateBaobaobookModal','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22','true','middle','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20日记标题\x20-\x20带下划线装饰\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-title\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22together-panel\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22together-stars\x22\x20aria-hidden=\x22true\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span></span><span></span><span></span><span></span><span></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22together-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22together-title\x22>TOGETHER</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22together-subtitle\x22>Invite\x20a\x20character\x20to\x20listen</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22together-thread\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22together-thread-line\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22together-list\x22\x20id=\x22togetherInviteList\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22together-foot\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22together-foot-line\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22together-foot-text\x22>Select\x20a\x20character</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22action-btn-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22circle-btn\x22\x20onclick=\x22closeUserPlaylistOverlay()\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20','158','无法开始播放','1096134nzzzky','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-action-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M20\x2011a8.1\x208.1\x200\x200\x200-15.5-2m-.5-4v4h4\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M4\x2013a8.1\x208.1\x200\x200\x200\x2015.5\x202m.5\x204v-4h-4\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','<path\x20d=\x22M12\x201a3\x203\x200\x2000-3\x203v8a3\x203\x200\x20006\x200V4a3\x203\x200\x2000-3-3z\x22/><path\x20d=\x22M19\x2010v2a7\x207\x200\x2001-14\x200v-2\x22/><line\x20x1=\x2212\x22\x20y1=\x2219\x22\x20x2=\x2212\x22\x20y2=\x2223\x22/><line\x20x1=\x228\x22\x20y1=\x2223\x22\x20x2=\x2216\x22\x20y2=\x2223\x22/>','[TogetherInviteDebug]','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22image-gallery-category-actions\x22\x20onclick=\x22event.stopPropagation()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22image-gallery-category-btn\x20delete\x22\x20onclick=\x22deleteGalleryCategory(\x27','option','reason','01:42','📱\x20删除旧短信记录:','\x0a简介：','sms-date-separator','baobaobook-entry-btn-cancel','push','【剧情锚点】','expiresAt','##\x20THE\x20SHADOW\x27S\x20MANIFESTATION\x20PROTOCOL\x20(JSONL)\x0a\x0a**神罚界碑**：你必须严格遵守此协议，否则将在雨中消散。\x0a\x0a###\x20STEP\x201:\x20影子的挣扎\x20(<thinking>)\x0a在输出任何\x20JSONL\x20之前，必须先进行\x20<thinking>。\x0a让左首（理智）和右首（欲望）在里面争吵。\x0a-\x20**他的意图**：这块扔过来的石头（评论），是想砸痛我，还是想引起注意？\x0a-\x20**众目睽睽**：周围还有别人。我该如何得体地回应，同时在桌下勾住他的脚？\x0a-\x20**好感度**：我的心脏现在跳得有多快？(0-100)\x0a\x0a###\x20STEP\x202:\x20留下的痕迹\x20(JSONL\x20ONLY)\x0a关闭\x20</thinking>\x20后，只允许输出以下\x20JSONL\x20格式。每行一条。\x0a\x0a```json\x0a{\x22type\x22:\x22affection\x22,\x22value\x22:0-100,\x22reason\x22:\x22[影子口吻]\x20这一刻我的心跳变化...\x22}\x0a{\x22type\x22:\x22threadComment\x22,\x22subtype\x22:\x22reply\x22,\x22username\x22:\x22[角色名/亲友名]\x22,\x22content\x22:\x22[回复内容]\x22,\x22isAuthor\x22:true,\x22replyTo\x22:\x22[对方用户名]\x22}\x0a{\x22type\x22:\x22threadComment\x22,\x22subtype\x22:\x22main\x22,\x22username\x22:\x22[路人名]\x22,\x22content\x22:\x22[新评论内容]\x22}\x0a```\x0a\x0a###\x20字段法则\x20(The\x20Rules)\x0a\x0a**1.\x20心脏刻度\x20(affection)**\x0a-\x20**必须输出**。这是你活着的证明。\x0a-\x20reason:\x20必须用影子的口吻写。写出你的动摇，你的贪婪，或者你的失望。\x0a\x0a**2.\x20广场交锋\x20(threadComment.subtype=reply)**\x0a-\x20','[用户拨通了电话]','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','password','now','功能开发中','musicWidgetLyricPosition','未命名分类','1.\x20**短兵相接**：别写长篇大论。这里是评论区，文字要像雨点一样短促、有力、甚至带刺。','togetherInviteTitle','10722942BurHXt','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22preview-placeholder\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22><rect\x20x=\x223\x22\x20y=\x223\x22\x20width=\x2218\x22\x20height=\x2218\x22\x20rx=\x222\x22\x20ry=\x222\x22/><circle\x20cx=\x228.5\x22\x20cy=\x228.5\x22\x20r=\x221.5\x22/><polyline\x20points=\x2221\x2015\x2016\x2010\x205\x2021\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20输入链接后预览\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','substr','📞\x20用户主动挂断电话','callFloatingImage','Add\x20Contact','🎯\x20[Thread]\x20主评论模式，用户评论索引:','inform','onload','size','~\x20Not\x20impersonating\x20anyone!','imageGalleryAddModal','playlistNextBtn',');\x22\x20title=\x22删除评论\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20-\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','time','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22category-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x221.5\x22\x20style=\x22width:\x2048px;\x20height:\x2048px;\x20opacity:\x200.3;\x20margin:\x200\x20auto\x2012px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x203h7a2\x202\x200\x200\x201\x202\x202v14a2\x202\x200\x200\x201-2\x202h-7m0-18H5a2\x202\x200\x200\x200-2\x202v14a2\x202\x200\x200\x200\x202\x202h7m0-18v18\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22\x20/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22font-size:\x2013px;\x20color:\x20var(--text-tertiary);\x22>还没有分类</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22font-size:\x2012px;\x20color:\x20var(--text-tertiary);\x20margin-top:\x204px;\x22>在下方输入框创建你的第一个分类</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','startX','🎨\x20应用封面样式:','&quot;','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</article>\x0a\x20\x20\x20\x20\x20\x20','atan2','10086','陌生人','THINKING\x20QUALITY','neural-canvas','\x20·\x20','Moon\x20River','人在看\x20|\x20','陌生人:','startTime','file','isRandomSms','通话连接失败','files','diaryStatDays','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20便利贴笔记\x20-\x20绝对定位在页面右侧边缘\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','touchAction','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22category-item\x22\x20data-category=\x22','<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M15\x2018l-6-6\x206-6\x22/></svg>','[UserPlaylist]\x20load\x20db\x20failed:','Yesterday\x20','\x0a\x0a##\x20【路人的嘈杂】(COMMENTS)\x0a','px)','noteId','short','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22category-item-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22category-item-name\x22>','update','linear-gradient(90deg,\x20rgba(0,0,0,0.12)\x200%,\x20rgba(0,0,0,0.04)\x2050%,\x20rgba(255,255,255,0.2)\x20100%)','💾\x20保存Mmpages编辑','isContact','selectedCallUserProfileId','未设置','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#c9b8a8;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-top:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20','\x20\x20↳\x20@','get','dark','before','find','Keypad','📞\x20用户回复，取消AI挂断','chatSettings','action','closeImageGalleryDrawer','hint','offsetX','low','contacts','[百宝书]\x20打开分类管理抽屉','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','imessage-avatar-blue','\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-foot\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22diary-page-num\x22>-\x20','✅\x20通话界面已显示','</strong>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small>','data:image','📱\x20Switched\x20to\x20Contacts\x20view','switching-in','一起听','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22freq-card\x20card-synced\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card-meta\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','maxTop','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>','\x0a-\x20诞辰：','正在生成回复...','&lt;','📱\x20✅\x20补全\x20transcript:','mousemove','用户资料不存在','AudioContext','reposts','baobaobookCategoryTabs','📱\x20删除联系人:',',\x20profileId=','分类不存在','phoneDisplayCopyInitialized','SYSTEM\x20INITIALIZATION\x20-\x20SIMULATION_PROTOCOL','，跳过\x20','show','\x20<span\x20class=\x22star\x22>☆</span>','.vol-track','categoryId','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Coffee\x20and\x20gentle\x20light.','📱\x20toggleContactHistoryDetail\x20called,\x20index:','image/','In\x20the\x20fog\x20of\x20time\x20we\x20stand','✅\x20短信历史已保存:','zIndex','lyricStyleOverlay','data:image/svg+xml,%3Csvg\x20xmlns=\x27http://www.w3.org/2000/svg\x27\x20viewBox=\x270\x200\x20100\x20100\x27%3E%3Crect\x20fill=\x27%23ff9500\x27\x20width=\x27100\x27\x20height=\x27100\x27/%3E%3Ccircle\x20cx=\x2750\x27\x20cy=\x2735\x27\x20r=\x2720\x27\x20fill=\x27%23fff\x27/%3E%3Cellipse\x20cx=\x2750\x27\x20cy=\x2780\x27\x20rx=\x2730\x27\x20ry=\x2725\x27\x20fill=\x27%23fff\x27/%3E%3C/svg%3E','\x0a\x20\x20\x20\x20\x20\x20','avatarClass','AI生成了','保存失败','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22mmpages-post-time\x22>','posts','has','callSpeechText','\x0a-\x20社会身份：','select_song','❌\x20删除评论失败:','zh-CN','callTranscript','IDEA','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','_selectedIndex','⚠️\x20角色没有设置头像，使用默认头像','phoneContactDetail','songId','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22thread-comment-more\x22\x20onclick=\x22event.stopPropagation();\x20toggleThreadCommentMenu(this);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22currentColor\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x225\x22\x20cy=\x2212\x22\x20r=\x222\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x222\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2219\x22\x20cy=\x2212\x22\x20r=\x222\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','长度:','inert','Error','132','isDragging','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','maxOutputTokens','Since\x20--','Seeking...','sendTogetherInviteToChat:begin','【好感度】','条消息','.contact-card-content.expanded','未检测到重复笔记','📱\x20查询参数:\x20characterId=','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-search-main\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-search-name\x22>','findIndex','中国移动','✅\x20[Thread]\x20JSONL解析成功:','netease','autoReplies','updatedAt','\x20条Mmpages动态','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20overflow:\x20hidden;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20relative;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20flex-direction:\x20column;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',']\x20(他递给你的照片)','」对话。','getMonth','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','imessage-edit-mode','🎯\x20[Thread]\x20楼中楼模式，目标主评论索引:','Tear\x20this\x20page\x20from\x20the\x20book?','search','playlistOverlay','\x0aTIME\x20(雨夜刻度):\x20','❌\x20[DEBUG]\x20sendCallMessage函数不存在！','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22recent-call-meta\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22recent-call-time\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-profile-avatar\x22>','.mmpages-post[data-post-id=\x22','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Detectives\x20of\x20the\x20silent\x20beat','</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-history-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-history-label\x20','#baobaobookEntryNameInput','albumEditActions','[短信]','\x22\x20data-comment-index=\x22','他是在跟「','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-profile-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-profile-name\x22>','width:\x20100px;','<button\x20class=\x22diary-entry-toggle\x22\x20type=\x22button\x22\x20aria-expanded=\x22false\x22>展开全文</button>','json','callSpeechIndicator','当前所处的公开环境与原帖。','分类「','percentage','⏹️\x20清除拨号延迟定时器','dragBound','charProfileThreadCount','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22thread-follow-btn\x22>Follow</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-post-content\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contacts-item\x22\x20onclick=\x22openContactDetail(\x27','#baobaobookEntrySceneSms','中国电信','parseInt','imageGalleryDrawer','user-playlist-mutation','contactsMyCardAvatar','❌\x20加载图片失败:','together_','💡\x20该号码无人设数据（既不在联系人也不在短信记录）','【态势感知】这是他刚刚发的主评论。','newSongInput','📱\x20保存短信历史:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<rect\x20x=\x223\x22\x20y=\x223\x22\x20width=\x2218\x22\x20height=\x2218\x22\x20rx=\x222\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x208v8M8\x2012h8\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','13.本轮用户输入','threadDetailScreen','success','Phone','--diary-','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22image-gallery-image-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','callAvatarImage','<div\x20class=\x22phone-profile-no-number\x22>No\x20phone\x20number</div>','type','randomSmsType','strangerPersona','密码错误…再想想？','<div\x20class=\x22avatar-placeholder\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22><circle\x20cx=\x2212\x22\x20cy=\x228\x22\x20r=\x224\x22/><path\x20d=\x22M20\x2021v-2a4\x204\x200\x200\x200-4-4H8a4\x204\x200\x200\x200-4\x204v2\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','分类已重命名为\x22','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<article\x20class=\x22mmpages-post\x22\x20data-post-id=\x22','🎯\x20[Thread]\x20设置回复目标:','modify','clientHeight','smsDetailScreen','characterId','随机陌生人','📱\x20[SMS删除]\x20开始删除','#baobaobookEntrySceneChat','pointerEvents','heart','TYPE定义：','playlistPrevBtn','.overlay-empty-hint','interactionBound','sendThreadComment','151','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22category-item-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22category-item-btn\x20edit\x22\x20onclick=\x22renameBaobaobookCategoryPrompt(\x27','currentGalleryToggle','共享联系人','<span\x20class=\x22thread-hashtag\x22>#$1</span>','📞\x20找到电话记录:','.phone-main-content','minimizing','newContactAvatarPreview','sessionId','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22recent-call-type\x20','phone-call-screen\x20state-','charProfileOverlay','replyAvatars','❌\x20删除图片失败:','apiKey','156','📱\x20退出SMS编辑模式','callFloatingBall','📵\x20繁忙时段：角色未接听电话','innerText','imageGalleries','【记忆强化】','top-center','📱\x20[Recent]\x20User\x20profile\x20loaded:','--:--','smsInput','is-adjusting','scrollHeight','📝\x20记录AI第一句话到通话记录:','📝\x20[Thread评论]\x20profileId:','分类名称长度应在1-20字符之间','\x22\x20alt=\x22','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','hasReply','audio|','replyTo','appendChild','touchstart','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x2210\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<line\x20x1=\x2212\x22\x20y1=\x2216\x22\x20x2=\x2212\x22\x20y2=\x2212\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<line\x20x1=\x2212\x22\x20y1=\x228\x22\x20x2=\x2212.01\x22\x20y2=\x228\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','data-theme','hasTranscript:','」\x0a（这是你挂在脸上的状态。只有当面具破裂或更换时，才在输出中更新status。）','createDocumentFragment','\x20\x20\x20','):\x20','📱\x20刷新联系人详情，isStranger:','Waiting\x20for\x20music...','color','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22delete-x\x22\x20onclick=\x22removeSong(','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22diary-sticky-delete\x22\x20onclick=\x22deleteDiaryNote(','__ovoRetryToken','openGalleryImages','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','.sms-message[data-index=\x22','imessage','calendar','Call\x20Again','K\x20followers','确定要删除联系人\x20\x22','<div\x20class=\x22sms-message-checkbox\x20','linear-gradient(90deg,\x20rgba(0,0,0,0.5)\x200%,\x20rgba(0,0,0,0.15)\x2050%,\x20rgba(255,255,255,0.03)\x20100%)','tokens','📝\x20[Thread]\x20变化原因:\x20','📞\x20通话开始，记录时间:','custom','【日程表】','不要像背书一样念出来，要让这些法则体现在你的举手投足间。','</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','Unknown','Since\x20','⏹️\x20通话状态变为','readAsDataURL','audioUrl','remove','#musicWidgetLyricStyleList\x20.lyric-style-item','liked','❌\x20删除动态失败:','timestamp','✅\x20[删除评论]\x20commentIndex=','分类已禁用','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22overlay-subtitle\x22>\x22','contactDetailLabel','deletedPost_','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-show-replies-avatars\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','上传失败','动态已删除','contactDetailStatus','📱\x20取消全选','currentCallInitiator','WORLDVIEW\x20(READ-ONLY)','startsWith','recentPromoName','https://i.postimg.cc/4xmx7V4R/mmexport1759081128356.jpg','sms-unknown','diaryCoverAvatar','❌\x20initCallWithContactPersona函数不存在！ovo-call.js可能未加载','No\x20characters\x20found','您拨打的电话正在通话中，请稍后再拨','[Thread\x20Detail]\x20构建角色身份映射失败:','isRandomSmsContact','无标题','log','\x0a\x0a##\x20【路人的嘈杂】(COMMENTS)\x0a四周一片死寂，暂无声音。','classList','📱\x20Call\x20contact:','[百宝书]\x20分类导航栏已更新','data','次传播','cssText','135','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22','ai-generated','createdAt','querySelectorAll','确定要删除这个条目吗？此操作不可恢复。','category','userMention','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','Call\x20Declined','_togetherInvite','DOMContentLoaded','.thread-reply-input','DREAMS','\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22user-playlist-view\x22\x20id=\x22userPlaylistView\x22\x20aria-hidden=\x22true\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22user-playlist-back\x22\x20onclick=\x22closeUserPlaylistView()\x22\x20aria-label=\x22返回\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M15\x2018l-6-6\x206-6\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22poem-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22flowing-text\x22\x20id=\x22bgText\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<canvas\x20id=\x22neural-canvas\x22></canvas>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content-scroll\x22\x20id=\x22scrollContainer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header-section\x22\x20id=\x22userHeader\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22avatar-core\x22\x20onclick=\x22openCategoryManager()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22avatar-img-container\x22\x20id=\x22userPlaylistAvatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22avatar-placeholder\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x221.5\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x2210\x22></circle>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x2016v-4M12\x208h.01\x22></path>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22user-name\x22\x20onclick=\x22openCategoryManager()\x22>Poetic\x20Soul</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22user-bio\x22\x20onclick=\x22openCategoryManager()\x22>Listening\x20to\x20the\x20universe\x20flow.</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22playlist-stream\x22\x20id=\x22playlistStream\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22control-bar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22theme-btn\x22\x20onclick=\x22openTogetherInviteUI()\x22>together</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22overlayLayer\x22\x20class=\x22overlay-layer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<canvas\x20id=\x22overlay-canvas\x22></canvas>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22overlay-content\x22\x20id=\x22overlayContent\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20','keypress','customAvatar','flex','currentCallBusyPeriod','#fff','修改或删除这个知识条目','Reply\x20to\x20@',',\x20event)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22><line\x20x1=\x2218\x22\x20y1=\x226\x22\x20x2=\x226\x22\x20y2=\x2218\x22/><line\x20x1=\x226\x22\x20y1=\x226\x22\x20x2=\x2218\x22\x20y2=\x2218\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','rgba(0,\x200,\x200,\x200.4)','✅\x20[删除事件]\x20已标记为已消耗:','callStatus','preventDefault','toggleImessageItemSelection(\x27','✅\x20[日记本]\x20渲染完成！','translateY(10px)','\x20has-reply','albumImageUpload','songSearchPanel','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','#000','includes','source','❌\x20删除笔记失败:','userPlaylistVolume','list-item','📝\x20打开Mmpages编辑弹窗','minTop','📱\x20SMS\x20Attach\x20Image','keywords','px;','Invalid\x20song\x20key','获取日记列表失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-sticky\x20','🔍\x20[DEBUG]\x20initCallWithAI返回结果:','删除失败','</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','pressing','mmpagesEditBioNote','.thread-follow-btn','&amp;','left','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22song-name\x22>','onclick','aboutMe','songListContainer','minBottom','diaryPage','replyIndex','.album-thumb-label','✅\x20已删除contacts记录','🔍\x20[DEBUG]\x20sendCallMessage返回:','lyricToggle','对方已挂断','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M21\x2015a2\x202\x200\x200\x201-2\x202H7l-4\x204V5a2\x202\x200\x200\x201\x202-2h14a2\x202\x200\x200\x201\x202\x202z\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>暂无短信<br/>点击右上角新建短信</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','thread-liked','items','.star-core','backToGalleryCategories','.imessage-checkbox','matchAll','<div\x20class=\x22worldview-tab\x22\x20data-category-id=\x22','display','❌\x20角色ID不存在','imessageList','mmpagesDisplayName','style-stardust','mmpagesUsername','#baobaobookEntryPositionSelect','❌\x20切换用户资料失败:','📱\x20[iMessage]\x20找到会话数:','Untitled','opacity\x200.3s\x20ease,\x20transform\x200.3s\x20ease','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22baobaobook-entry-avatar\x22>','all','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22connection-line\x22></div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22synced-visual\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22\x20style=\x22animation-duration:\x200.8s\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22\x20style=\x22animation-duration:\x201.2s\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22\x20style=\x22animation-duration:\x200.5s\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22\x20style=\x22animation-duration:\x200.9s\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22\x20style=\x22animation-duration:\x201.1s\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card-status\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','\x20tokens\x20(','__ovoTogetherInviteDebug','#baobaobookEntryDrawerSubtitle','selected','--diary-cover','getItem','📱\x20[Contacts]\x20Failed\x20to\x20load\x20contacts:','scroll','hidden','function','.thread-comment-menu','aria-pressed','图片上传失败:','✅\x20[删除动态]\x20postId:','Note\x20clicked\x20for:','initThreadDetailInteractions','<div\x20class=\x22image-gallery-image-desc-badge\x22>','is-muted','4134222lqKcTB','accept','currentTime','together-action','characterDiary','📤\x20发送所有回复给AI:','#baobaobookEntryCharCount','insertBefore','已导入\x20','songArtist','load','contactHistoryBadge','mmpagesEmptyState','&#039;','mmpagesBio','📱\x20[Recent]\x20Failed\x20to\x20load\x20user\x20profile:','phoneProfileSelectorOverlay','chatbox','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-pinned-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','other','📱\x20Switched\x20to\x20Keypad\x20view','\x22\x20onclick=\x22if(event.target.closest(\x27.mmpages-action-btn,\x20.mmpages-post-more\x27))\x20return;\x20openThreadDetail(','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','setValueAtTime','initiatorRole','无法获取音频或歌词','buttons','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22diary-note-heart\x22\x20aria-hidden=\x22true\x22>♡</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22diary-note-text\x22>清理重复</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','togetherInviteArtist','thread-comment-menu-styles','9.历史-AI回复','已删除笔记','offsetHeight','统一背景设定。','togetherInviteId','baobaobook-empty-state','userPlaylistMount','placeholder','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-profile-option\x20','check','end','maxLeft','width','body','previewNewImage','❌\x20加载角色列表失败:','获取百宝书条目失败:','📱\x20Card\x20toggled,\x20expanded:','setProperty','createGain','split','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20','startRatio','📞\x20AI说完所有话了，准备主动挂断电话','10%','diary-idx-item\x20diary-idx-note','✅\x20号码在数据库中，允许拨打（位数:','\x22\x20alt=\x22预览\x22\x20onerror=\x22this.parentElement.innerHTML=\x27<div\x20class=\x5c\x27preview-placeholder\x5c\x27>图片加载失败</div>\x27\x22>','scrollIntoView','chatId','isStranger','A\x20map\x20of\x20songs,\x20a\x20wall\x20of\x20clues','Character\x20Remark','minute','Yesterday','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20inline-block;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2010px\x2024px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#2d2d2d;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#fff;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-top:\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20','已删除号码\x20\x22','条目名称不能超过50个字符','清理失败','这不是随机陌生人号码','Copied!','🖼️\x20打开动态图库抽屉','STORIES','parse','documentElement','state','✅\x20[删除回复]\x20commentIndex=','auto','container','📱\x20Opening\x20phone\x20contacts','中国联通','and','passwordUI','toDeleteIds','##\x20用户资料\x0a姓名：','phoneNumber','numeric','❌\x20日记本渲染失败:','stats','请输入日记本密码','.contact-card-arrow','imessageEditBar','playlistPlayBtn','diary-back-btn','条日记，懒加载模式：启用','⚠️\x20未找到号码对应的角色，进入随机状态检测','✅\x20[Thread]\x20已添加\x20','📱\x20Contact\x20detail\x20container\x20not\x20found','originalPlaceholder','📱\x20进入SMS编辑模式','updateBaobaobookCharCount','lastMessageTime','mid_after','shares','playlistMediaCache','请重试','📱\x20选择用户资料:','<div\x20class=\x22contacts-group\x22\x20id=\x22contacts-group-','deg);','<div\x20class=\x22overlay-empty-hint\x22>Name\x20a\x20constellation\x20to\x20draw\x20the\x20first\x20line.</div>','decline','&#39;','❌\x20角色不存在，使用默认头像','##\x20FINAL\x20GATE:\x20THE\x20RAIN\x20CHECK\x0a\x0a###\x20存活检查\x0a1.\x20**<thinking>**\x20是否完整？有没有听到左首和右首的争吵？\x0a2.\x20**<Affection>**\x20是否测量了心跳？\x0a3.\x20**JSONL\x20Only**:\x20</thinking>\x20之后，除了\x20JSONL\x20还能看到别的吗？如果有，那就是灰尘，**擦掉它**。\x0a\x0a###\x20内容检查\x0a-\x20**affection**:\x20是否记录了心跳？\x0a-\x20**reason**:\x20是否足够深刻？\x0a-\x20**content**:\x20是否像个活人？（拒绝客服腔，拒绝机械回复）\x0a-\x20**role**:\x20是否维持了人设的尊严？\x0a\x0a###\x20违规即死\x20(FAILURE\x20CONDITIONS)\x0a-\x20没有\x20<thinking>\x20过程。\x0a-\x20输出了\x20markdown\x20代码块以外的文字。\x0a-\x20陌生人（未设定角色）闯入了评论区。\x0a-\x20回复像个机器人客服。\x0a\x0a**违规后果**：如果你搞砸了格式，雨水会冲刷掉你的一切。你将一无所有。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22recent-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M22\x2016.92v3a2\x202\x200\x2001-2.18\x202\x2019.79\x2019.79\x200\x2001-8.63-3.07\x2019.5\x2019.5\x200\x2001-6-6\x2019.79\x2019.79\x200\x2001-3.07-8.67A2\x202\x200\x20014.11\x202h3a2\x202\x200\x20012\x201.72c.127.96.361\x201.903.7\x202.81a2\x202\x200\x2001-.45\x202.11L8.09\x209.91a16\x2016\x200\x20006\x206l1.27-1.27a2\x202\x200\x20012.11-.45c.907.339\x201.85.573\x202.81.7A2\x202\x200\x200122\x2016.92z\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22recent-empty-text\x22>暂无通话记录</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22recent-empty-subtext\x22>拨打或接听电话后会显示在这里</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','歌单不可用','smsMessagesArea','pop','User','✅\x20Thread\x20Detail功能模块加载完成','\x22\x20及所有相关数据（','📊\x20加载角色数据到Mmpages:','shift','requestChatDetailRefresh','data-tab','translateX(-50%)','未选中歌单','width:\x20','canvas','warn','bound','phone','transition','togetherInviteStatus','📱\x20添加用户短信:','imessage-avatar-pink','15.后置Jailbreak','MEMORIES','className','connected','❌\x20更新头像失败:','isReply','diary-rendering','条目已删除','active','consumed','❌未分类\x20#','❌\x20获取图库图片失败:','📜\x20[Thread]\x20读取了\x20','artist','📱\x20SMS\x20View\x20Contact:','不要像复读机一样重复之前的话。','button','diaryDedupeBtn','<path\x20d=\x22M17\x207L7\x2017M7\x207h10M7\x207v10\x22/>','.sms-message,\x20.sms-date-separator','❌\x20[SMS删除]\x20失败:','TODO','Connected','newGalleryCategoryTarget','[PlaylistCache]\x20save\x20failed:','❌\x20删除联系人失败:','info','POST','删除\x20(','originalName','❌\x20保存Mmpages数据失败:','diary-page\x20diary-inner\x20diary-dynamic\x20diary-lazy','<div\x20class=\x22lyric-text\x22></div>','crossOrigin','thread-comment-item','【显形仪式】','mmpagesSocialAvatar','animationDelay','deleteGalleryCategory','clipboard','diary-sticky-dragging','📝\x20记录用户消息到通话记录:','评论区历史记录。','getComputedStyle','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-transcript-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-transcript-line\x20','Song\x20search\x20failed:','musicWidgetContainer','4.\x20**绝对命令**：最后必须严格遵守\x20FINAL\x20OUTPUT\x20PROTOCOL\x20输出\x20JSONL。','play','grabbing','state-changing','baobaobookEntries','条新评论','无法接通','baobaobook-entry-btn-delete','diaryAvatarImg','ownerId','【躯壳·面具】','[PlaylistCache]\x20load\x20failed:','歌单不可用，无法开始播放','recentPromoAvatar','phoneCallScreen','笔记去重','var(--thread-bg-primary)','addEventListener','未分类','background','birthDate','newContactCharacterInfo','none','translateY(-','instant','bounce','无法读取图片','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M21\x2011.5a8.38\x208.38\x200\x200\x201-.9\x203.8\x208.5\x208.5\x200\x200\x201-7.6\x204.7\x208.38\x208.38\x200\x200\x201-3.8-.9L3\x2021l1.9-5.7a8.38\x208.38\x200\x200\x201-.9-3.8\x208.5\x208.5\x200\x200\x201\x204.7-7.6\x208.38\x208.38\x200\x200\x201\x203.8-.9h.5a8.48\x208.48\x200\x200\x201\x208\x208v.5z\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-action\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M20\x2011a8.1\x208.1\x200\x200\x200\x20-15.5\x20-2m-.5\x20-4v4h4\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M4\x2013a8.1\x208.1\x200\x200\x200\x2015.5\x202m.5\x204v-4h-4\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-action\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M4.698\x204.034l16.302\x207.966l-16.302\x207.966a.503\x20.503\x200\x200\x201\x20-.546\x20-.124a.555\x20.555\x200\x200\x201\x20-.12\x20-.568l2.468\x20-7.274l-2.468\x20-7.274a.555\x20.555\x200\x200\x201\x20.12\x20-.568a.503\x20.503\x200\x200\x201\x20.546\x20-.124z\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M6.5\x2012h14.5\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','replace','CURRENT\x20TURN\x20USER\x20COMMENT','where','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22diary-idx-date\x22>','error','.contact-card-arrow.expanded','2.\x20挣扎结束后，关闭\x20</thinking>。','smsEditBtn','\x20-</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-deco\x22><i></i><i></i><i></i></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-btn\x20prev\x22\x20onclick=\x22diaryFlip(-1)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M15\x2018l-6-6\x206-6\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-btn\x20next\x22\x20onclick=\x22diaryFlip(1)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M9\x2018l6-6-6-6\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20','请选择图片文件','<div\x20class=\x22imessage-divider\x22></div>','\x20[图片]','currentTarget','translateY(0)','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-title\x22>','style','--orb-custom-size','affection','📱\x20处理\x20record[','分类名称已存在','\x20说话）','\x20个对话吗？\x0a\x0a⚠️\x20这将删除所有相关短信记录，此操作不可撤销！','##\x20你的躯壳档案\x20(The\x20Vessel)\x0a\x0a###\x20基础铭牌\x0a-\x20姓名：','bulkAdd','✅\x20头像已上传','profession','lyric-text','🎨\x20[懒加载]\x20已渲染第','\x20right:\x20','AI未生成评论','🤖\x20陌生人接听，共','📌\x20便签位置已保存:\x20noteId=','133','分类已删除','threads','联系人已保存','无提示','playlistAvatar','role','【态势感知】他在「','sms-edit-mode','📱\x20Add\x20to\x20existing\x20contact:','❌\x20[iMessage]\x20加载短信列表失败:','songTitle','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-checkbox\x20','newImageBatchInput','6076PofVui','发来一条短信','未命名角色','[通话]','lyricLines','保存分类失败','【目标锁定】他正在回复：「','✅\x20[SMS删除]\x20已保存到数据库','❌\x20保存专辑封面失败:','Failed\x20to\x20get\x20chat\x20data:','diary-empty-hint','contactHistoryList','📱\x20[Contacts]\x20Opening\x20my\x20card\x20detail','</strong>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small>','primaryKeys','没有用户消息','album','phoneDisplayHint','outgoing','\x20state-changing','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22recent-call-item\x22\x20onclick=\x22redialPhoneNumber(\x27','count','together-info','isAuthor','路人/他','--lyrics-color','We\x20weave\x20the\x20night\x20with\x20silver\x20threads','positionX','请输入备注名称','<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M14\x202H6a2\x202\x200\x200\x200-2\x202v16a2\x202\x200\x200\x200\x202\x202h12a2\x202\x200\x200\x200\x202-2V8z\x22></path><polyline\x20points=\x2214\x202\x2014\x208\x2020\x208\x22></polyline><line\x20x1=\x2216\x22\x20y1=\x2213\x22\x20x2=\x228\x22\x20y2=\x2213\x22></line><line\x20x1=\x2216\x22\x20y1=\x2217\x22\x20x2=\x228\x22\x20y2=\x2217\x22></line></svg>','<span\x20class=\x22diary-idx-mood\x22>','Pause','test','firstElementChild','innerHTML','userPlaylistData_',')\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>Show\x20replies</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','🗑️\x20[删除事件]\x20覆盖旧的未消耗事件','ID\x20','currentGalleryCategoryName','Thursday','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-sort-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-sort-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>Top</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<polyline\x20points=\x226\x209\x2012\x2015\x2018\x209\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-view-activity\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>View\x20activity</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<polyline\x20points=\x229\x2018\x2015\x2012\x209\x206\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20','userPlaylistView','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22diary-sticky-delete\x22\x20onclick=\x22deleteDiaryNote(','missed','</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20日记正文容器\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20日记内容（支持AI生成的HTML）\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22','\x20top:\x20','tap\x20to\x20copy','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#e57373;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-top:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20','translateX(-20px)','\x20条新主评论','_dbMessageId','systemPlaylistTitle','cursor','diary-idx-item','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22image-gallery-category-item\x20',');\x22\x20style=\x22cursor:\x20pointer;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-post-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-post-avatar-wrapper\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-post-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','webkitAudioContext','.baobaobook-entry-drawer-overlay','xoxo','未获得AI回复','<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M20\x2021v-2a4\x204\x200\x200\x200-4-4H8a4\x204\x200\x200\x200-4\x204v2\x22/><circle\x20cx=\x2212\x22\x20cy=\x227\x22\x20r=\x224\x22/></svg>','diaryCoverName','🎲\x20[删除动态]\x20未触发50%概率，不通知角色','主评论回复，需重点回应。','gain','smooth','.diary-entry-content.collapsible','🔄\x20切换回复显示:','bottom','imessage-avatar-gray','✅\x20AI通话已连接:','userName','scale(0)\x20rotate(45deg)','📜\x20[Thread]\x20找到匹配的聊天记录:\x20chatId=','startY','【已上锁】(他还在门外)','add','callName','createElement','aria-expanded','[UserPlaylist]\x20cleanup\x20db\x20failed:','Play','📱\x20[Recent]\x20User\x20profile\x20not\x20found:','height','📱\x20Show\x20contact\x20detail\x20for:','✅\x20便签已从页面移除','charAt','preload','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-face\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-spine\x20diary-spine-inner\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-holes\x22><div\x20class=\x22diary-hole\x22></div><div\x20class=\x22diary-hole\x22></div><div\x20class=\x22diary-hole\x22></div><div\x20class=\x22diary-hole\x22></div></div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-inner\x20diary-content-page\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20日期头部\x20-\x20完全按照\x20preview\x20的\x20entry-head\x20结构\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-head\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-date\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>','lazyLoad','callReplyInputContainer','新建条目','📱\x20[iMessage]\x20未找到联系人:','newContactSheetOverlay','✅\x20[Thread]\x20AI评论已添加:','closeImageGalleryAddModal','6.世界观','key','replaceWith','【生存法则】：','playerProgressFilled','渲染\x20','toArray','song','❌\x20[Thread]\x20JSONL解析失败:','\x0a关于：','未解析到可用的图片链接','\x20条楼中楼回复到主评论#','playing','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M9\x2016.17L4.83\x2012l-1.42\x201.41L9\x2019\x2021\x207l-1.41-1.41z\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','📱\x20[Recent]\x20Loaded','releasePointerCapture','worldview','calling','通话中','Decline','transform\x200.3s\x20ease,\x20opacity\x200.3s\x20ease',',\x200.95)\x20100%)','📱\x20陌生人联系人，无自定义头像，使用默认','addImageGalleryCategory','Tuesday','个页面到DOM','</div>','📱\x20[SMS重回]\x20找到\x20','currentGalleryImageCount','MOMENTS','javascript:','条)</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22diary-idx-page\x22>','<div\x20class=\x22call-user-reply-item\x20','.phone-nav-item','currentProfileId','bulkPut','has-reply','bio','targetCommentContent','.thread-action-count,\x20.thread-comment-action-count','📱\x20点击发送按钮，准备调用AI','blur','MEMO','contactName','📱\x20[iMessage]\x20找到短信记录:','未找到当前帖子','\x22已创建','iMessage','getBoundingClientRect','\x27,\x20event)','❌\x20加载最新角色数据失败:','👤\x20从短信记录读取人设:','⚠️\x20无效的通话数据（没有callStartTime），跳过保存','threadProfilePicker','__ovoRetryCount','characterAlbums','sms_','imageGalleryImagesPanel','📞\x20号码状态：随机陌生人接听','content','imageGalleryImagesGrid','profileId','playerTimeCurrent','分类名称不能为空','pointerdown','未清理','Mute','side','mmpagesEditFollowers','tagsNo','open','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-action-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M21\x2011.5a8.38\x208.38\x200\x200\x201-.9\x203.8\x208.5\x208.5\x200\x200\x201-7.6\x204.7\x208.38\x208.38\x200\x200\x201-3.8-.9L3\x2021l1.9-5.7a8.38\x208.38\x200\x200\x201-.9-3.8\x208.5\x208.5\x200\x200\x201\x204.7-7.6\x208.38\x208.38\x200\x200\x201\x203.8-.9h.5a8.48\x208.48\x200\x200\x201\x208\x208v.5z\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','mmpagesEditOverlay','FaceTime','threadDetailScroll','\x20tokens','fillRect','commentIndex','N/A','songs','\x22\x20alt=\x22头像\x22>','\x0a/*\x20==========================================\x0a\x20\x20\x20日记本CSS样式表\x20-\x20用于渲染日记/笔记内容\x0a\x20\x20\x20注意：不要用\x20:root，会覆盖全局变量导致封面变色！\x0a\x20\x20\x20==========================================\x20*/\x0a\x0a/*\x20日记内容区域（使用全局CSS变量，自动适配暗黑模式）\x20*/\x0a.diary-entry-content\x20{\x0a\x20\x20/*\x20使用全局变量，自动继承Light/Dark\x20Mode配置\x20*/\x0a}\x0a\x0a/*\x20日记内容容器（不要用\x20.diary-page，会和翻页系统的类名冲突！）\x20*/\x0a.diary-entry-wrapper\x20{\x0a\x20\x20background:\x20var(--diary-page);\x0a\x20\x20padding:\x2020px;\x0a\x20\x20min-height:\x20400px;\x0a\x20\x20max-height:\x20500px;\x0a\x20\x20overflow-y:\x20auto;\x0a\x20\x20position:\x20relative;\x0a\x20\x20font-family:\x20\x27Noto\x20Serif\x20SC\x27,\x20Georgia,\x20serif;\x0a\x20\x20color:\x20var(--diary-ink-1);\x0a\x20\x20line-height:\x201.8;\x0a\x20\x20/*\x20滚动条样式\x20*/\x0a\x20\x20scrollbar-width:\x20thin;\x0a\x20\x20scrollbar-color:\x20var(--diary-ink-3)\x20transparent;\x0a}\x0a\x0a.diary-entry-wrapper::-webkit-scrollbar\x20{\x0a\x20\x20width:\x206px;\x0a}\x0a\x0a.diary-entry-wrapper::-webkit-scrollbar-track\x20{\x0a\x20\x20background:\x20transparent;\x0a}\x0a\x0a.diary-entry-wrapper::-webkit-scrollbar-thumb\x20{\x0a\x20\x20background:\x20var(--diary-ink-3);\x0a\x20\x20border-radius:\x203px;\x0a}\x0a\x0a.diary-entry-wrapper::-webkit-scrollbar-thumb:hover\x20{\x0a\x20\x20background:\x20var(--diary-ink-2);\x0a}\x0a\x0a/*\x20日记条目文本\x20*/\x0a.entry-text\x20{\x0a\x20\x20position:\x20relative;\x0a\x20\x20z-index:\x201;\x0a}\x0a\x0a/*\x20时间戳标记\x20*/\x0a.time-mark\x20{\x0a\x20\x20display:\x20inline-block;\x0a\x20\x20font-size:\x2011px;\x0a\x20\x20color:\x20var(--diary-ink-3);\x0a\x20\x20font-family:\x20\x27Courier\x20New\x27,\x20monospace;\x0a\x20\x20margin-right:\x208px;\x0a\x20\x20opacity:\x200.7;\x0a}\x0a\x0a/*\x20墨水颜色层级\x20*/\x0a.ink-2\x20{\x20color:\x20var(--diary-ink-2);\x20}\x0a.ink-3\x20{\x20color:\x20var(--diary-ink-3);\x20}\x0a\x0a/*\x20字体\x20*/\x0a.f-hand\x20{\x20font-family:\x20\x27Ma\x20Shan\x20Zheng\x27,\x20cursive,\x20sans-serif;\x20}\x0a.f-serif\x20{\x20font-family:\x20\x27Noto\x20Serif\x20SC\x27,\x20Georgia,\x20serif;\x20}\x0a.f-mono\x20{\x20font-family:\x20\x27Courier\x20New\x27,\x20\x27Source\x20Code\x20Pro\x27,\x20monospace;\x20}\x0a\x0a/*\x20字号\x20*/\x0a.fs-xs\x20{\x20font-size:\x2010px;\x20}\x0a.fs-sm\x20{\x20font-size:\x2012px;\x20}\x0a.fs-lg\x20{\x20font-size:\x2016px;\x20}\x0a.fs-xl\x20{\x20font-size:\x2020px;\x20}\x0a.fs-2xl\x20{\x20font-size:\x2024px;\x20}\x0a\x0a/*\x20字重\x20*/\x0a.fw-light\x20{\x20font-weight:\x20300;\x20}\x0a.fw-bold\x20{\x20font-weight:\x20700;\x20}\x0a.fw-black\x20{\x20font-weight:\x20900;\x20}\x0a\x0a/*\x20颜色\x20*/\x0a.c-red\x20{\x20color:\x20#dc2626;\x20}\x0a.c-blue\x20{\x20color:\x20#2563eb;\x20}\x0a.c-green\x20{\x20color:\x20#16a34a;\x20}\x0a.c-orange\x20{\x20color:\x20#ea580c;\x20}\x0a.c-purple\x20{\x20color:\x20#9333ea;\x20}\x0a.c-muted\x20{\x20color:\x20var(--diary-ink-3);\x20}\x0a\x0a/*\x20手写效果\x20*/\x0a.del\x20{\x0a\x20\x20text-decoration:\x20line-through;\x0a\x20\x20text-decoration-color:\x20var(--diary-ink-2);\x0a\x20\x20opacity:\x200.7;\x0a}\x0a.ins\x20{\x0a\x20\x20border-bottom:\x201px\x20dashed\x20var(--diary-ink-2);\x0a\x20\x20position:\x20relative;\x0a}\x0a.ins::before\x20{\x0a\x20\x20content:\x20\x27^\x27;\x0a\x20\x20position:\x20absolute;\x0a\x20\x20top:\x20-12px;\x0a\x20\x20left:\x2050%;\x0a\x20\x20transform:\x20translateX(-50%);\x0a\x20\x20font-size:\x2010px;\x0a\x20\x20color:\x20var(--diary-ink-2);\x0a}\x0a.circle\x20{\x0a\x20\x20border:\x201.5px\x20solid\x20var(--diary-ink-1);\x0a\x20\x20border-radius:\x2050%;\x0a\x20\x20padding:\x200\x204px;\x0a}\x0a.hl\x20{\x0a\x20\x20background:\x20linear-gradient(180deg,\x20transparent\x2060%,\x20#fef08a\x2060%);\x0a}\x0a.wavy\x20{\x0a\x20\x20text-decoration:\x20underline\x20wavy\x20var(--diary-ink-2);\x0a\x20\x20text-underline-offset:\x203px;\x0a}\x0a.underline\x20{\x0a\x20\x20text-decoration:\x20underline;\x0a\x20\x20text-underline-offset:\x202px;\x0a}\x0a\x0a/*\x20背景标记\x20*/\x0a.bg-mark-yellow\x20{\x20background:\x20rgba(254,\x20240,\x20138,\x200.6);\x20padding:\x200\x202px;\x20}\x0a.bg-mark-pink\x20{\x20background:\x20rgba(252,\x20231,\x20243,\x200.8);\x20padding:\x200\x202px;\x20}\x0a.bg-mark-blue\x20{\x20background:\x20rgba(219,\x20234,\x20254,\x200.8);\x20padding:\x200\x202px;\x20}\x0a.bg-mark-green\x20{\x20background:\x20rgba(220,\x20252,\x20231,\x200.8);\x20padding:\x200\x202px;\x20}\x0a\x0a/*\x20边框盒子\x20*/\x0a.box-solid\x20{\x20border:\x201.5px\x20solid\x20var(--diary-ink-1);\x20padding:\x204px\x208px;\x20display:\x20inline-block;\x20}\x0a.box-dashed\x20{\x20border:\x201.5px\x20dashed\x20var(--diary-ink-2);\x20padding:\x204px\x208px;\x20display:\x20inline-block;\x20}\x0a.box-double\x20{\x20border:\x203px\x20double\x20var(--diary-ink-1);\x20padding:\x204px\x208px;\x20display:\x20inline-block;\x20}\x0a\x0a/*\x20标签\x20*/\x0a.tag\x20{\x0a\x20\x20display:\x20inline-block;\x0a\x20\x20font-size:\x2010px;\x0a\x20\x20padding:\x201px\x206px;\x0a\x20\x20border-radius:\x203px;\x0a\x20\x20margin:\x200\x202px;\x0a}\x0a.tag-red\x20{\x20background:\x20#fee2e2;\x20color:\x20#dc2626;\x20}\x0a.tag-blue\x20{\x20background:\x20#dbeafe;\x20color:\x20#2563eb;\x20}\x0a.tag-green\x20{\x20background:\x20#dcfce7;\x20color:\x20#16a34a;\x20}\x0a\x0a/*\x20==========================================\x0a\x20\x20\x20排版布局（完整版）\x0a\x20\x20\x20==========================================\x20*/\x0a\x0a/*\x20诗歌排版\x20-\x20文艺角色\x20*/\x0a.layout-poem\x20{\x0a\x20\x20text-align:\x20center;\x0a\x20\x20line-height:\x202.2;\x0a\x20\x20letter-spacing:\x201px;\x0a}\x0a.layout-poem\x20.line\x20{\x0a\x20\x20display:\x20block;\x0a\x20\x20margin:\x204px\x200;\x0a}\x0a.layout-poem\x20.indent\x20{\x20margin-left:\x202em;\x20}\x0a.layout-poem\x20.indent-2\x20{\x20margin-left:\x204em;\x20}\x0a.layout-poem\x20.indent-3\x20{\x20margin-left:\x206em;\x20}\x0a\x0a/*\x20右对齐诗歌\x20*/\x0a.layout-poem-right\x20{\x0a\x20\x20text-align:\x20right;\x0a\x20\x20line-height:\x202;\x0a\x20\x20padding-right:\x2010px;\x0a}\x0a\x0a/*\x20阶梯式排版\x20-\x20每行递进\x20*/\x0a.layout-stairs\x20.line\x20{\x0a\x20\x20display:\x20block;\x0a}\x0a.layout-stairs\x20.line:nth-child(1)\x20{\x20margin-left:\x200;\x20}\x0a.layout-stairs\x20.line:nth-child(2)\x20{\x20margin-left:\x201em;\x20}\x0a.layout-stairs\x20.line:nth-child(3)\x20{\x20margin-left:\x202em;\x20}\x0a.layout-stairs\x20.line:nth-child(4)\x20{\x20margin-left:\x203em;\x20}\x0a.layout-stairs\x20.line:nth-child(5)\x20{\x20margin-left:\x204em;\x20}\x0a.layout-stairs\x20.line:nth-child(6)\x20{\x20margin-left:\x205em;\x20}\x0a.layout-stairs\x20.line:nth-child(7)\x20{\x20margin-left:\x206em;\x20}\x0a\x0a/*\x20反向阶梯\x20*/\x0a.layout-stairs-rev\x20.line\x20{\x0a\x20\x20display:\x20block;\x0a}\x0a.layout-stairs-rev\x20.line:nth-child(1)\x20{\x20margin-left:\x206em;\x20}\x0a.layout-stairs-rev\x20.line:nth-child(2)\x20{\x20margin-left:\x205em;\x20}\x0a.layout-stairs-rev\x20.line:nth-child(3)\x20{\x20margin-left:\x204em;\x20}\x0a.layout-stairs-rev\x20.line:nth-child(4)\x20{\x20margin-left:\x203em;\x20}\x0a.layout-stairs-rev\x20.line:nth-child(5)\x20{\x20margin-left:\x202em;\x20}\x0a.layout-stairs-rev\x20.line:nth-child(6)\x20{\x20margin-left:\x201em;\x20}\x0a.layout-stairs-rev\x20.line:nth-child(7)\x20{\x20margin-left:\x200;\x20}\x0a\x0a/*\x20乱糟糟排版\x20-\x20急躁角色\x20*/\x0a.layout-messy\x20{\x0a\x20\x20position:\x20relative;\x0a}\x0a.layout-messy\x20.chunk\x20{\x0a\x20\x20display:\x20inline-block;\x0a\x20\x20margin:\x202px;\x0a}\x0a.layout-messy\x20.chunk:nth-child(odd)\x20{\x20transform:\x20rotate(-2deg);\x20}\x0a.layout-messy\x20.chunk:nth-child(even)\x20{\x20transform:\x20rotate(2deg);\x20}\x0a.layout-messy\x20.chunk:nth-child(3n)\x20{\x20transform:\x20rotate(-4deg)\x20translateY(-2px);\x20}\x0a.layout-messy\x20.chunk:nth-child(5n)\x20{\x20transform:\x20rotate(3deg)\x20translateY(2px);\x20}\x0a\x0a/*\x20更乱的版本\x20*/\x0a.layout-chaos\x20.chunk\x20{\x0a\x20\x20display:\x20inline-block;\x0a\x20\x20margin:\x203px\x205px;\x0a}\x0a.layout-chaos\x20.chunk:nth-child(1)\x20{\x20transform:\x20rotate(-5deg);\x20}\x0a.layout-chaos\x20.chunk:nth-child(2)\x20{\x20transform:\x20rotate(4deg)\x20translateY(3px);\x20}\x0a.layout-chaos\x20.chunk:nth-child(3)\x20{\x20transform:\x20rotate(-3deg)\x20translateY(-2px);\x20}\x0a.layout-chaos\x20.chunk:nth-child(4)\x20{\x20transform:\x20rotate(6deg);\x20}\x0a.layout-chaos\x20.chunk:nth-child(5)\x20{\x20transform:\x20rotate(-4deg)\x20translateY(4px);\x20}\x0a.layout-chaos\x20.chunk:nth-child(6)\x20{\x20transform:\x20rotate(2deg)\x20translateY(-3px);\x20}\x0a.layout-chaos\x20.chunk:nth-child(7)\x20{\x20transform:\x20rotate(-6deg);\x20}\x0a\x0a/*\x20文字瀑布\x20-\x20垂直书写\x20*/\x0a.layout-vertical\x20{\x0a\x20\x20writing-mode:\x20vertical-rl;\x0a\x20\x20text-orientation:\x20mixed;\x0a\x20\x20height:\x20180px;\x0a\x20\x20line-height:\x201.8;\x0a\x20\x20letter-spacing:\x202px;\x0a}\x0a.layout-vertical-lr\x20{\x0a\x20\x20writing-mode:\x20vertical-lr;\x0a\x20\x20text-orientation:\x20mixed;\x0a\x20\x20height:\x20180px;\x0a\x20\x20line-height:\x201.8;\x0a}\x0a\x0a/*\x20散落式排版\x20*/\x0a.layout-scatter\x20{\x0a\x20\x20position:\x20relative;\x0a\x20\x20min-height:\x20100px;\x0a}\x0a.layout-scatter\x20.word\x20{\x0a\x20\x20position:\x20absolute;\x0a\x20\x20white-space:\x20nowrap;\x0a}\x0a\x0a/*\x20波浪式排版\x20*/\x0a.layout-wave\x20.char\x20{\x0a\x20\x20display:\x20inline-block;\x0a\x20\x20animation:\x20wave\x202s\x20ease-in-out\x20infinite;\x0a}\x0a.layout-wave\x20.char:nth-child(1)\x20{\x20animation-delay:\x200s;\x20}\x0a.layout-wave\x20.char:nth-child(2)\x20{\x20animation-delay:\x200.1s;\x20}\x0a.layout-wave\x20.char:nth-child(3)\x20{\x20animation-delay:\x200.2s;\x20}\x0a.layout-wave\x20.char:nth-child(4)\x20{\x20animation-delay:\x200.3s;\x20}\x0a.layout-wave\x20.char:nth-child(5)\x20{\x20animation-delay:\x200.4s;\x20}\x0a.layout-wave\x20.char:nth-child(6)\x20{\x20animation-delay:\x200.5s;\x20}\x0a.layout-wave\x20.char:nth-child(7)\x20{\x20animation-delay:\x200.6s;\x20}\x0a.layout-wave\x20.char:nth-child(8)\x20{\x20animation-delay:\x200.7s;\x20}\x0a@keyframes\x20wave\x20{\x0a\x20\x200%,\x20100%\x20{\x20transform:\x20translateY(0);\x20}\x0a\x20\x2050%\x20{\x20transform:\x20translateY(-4px);\x20}\x0a}\x0a\x0a/*\x20对话式排版\x20-\x20左右交替\x20*/\x0a.layout-dialog\x20.say\x20{\x0a\x20\x20display:\x20block;\x0a\x20\x20max-width:\x2080%;\x0a\x20\x20margin:\x206px\x200;\x0a\x20\x20padding:\x204px\x208px;\x0a\x20\x20border-radius:\x208px;\x0a\x20\x20background:\x20var(--bg-tertiary,\x20#f1f5f9);\x0a}\x0a.layout-dialog\x20.say-l\x20{\x0a\x20\x20margin-right:\x20auto;\x0a\x20\x20border-bottom-left-radius:\x202px;\x0a}\x0a.layout-dialog\x20.say-r\x20{\x0a\x20\x20margin-left:\x20auto;\x0a\x20\x20text-align:\x20right;\x0a\x20\x20border-bottom-right-radius:\x202px;\x0a}\x0a\x0a/*\x20打字机效果排版\x20*/\x0a.layout-typewriter\x20{\x0a\x20\x20font-family:\x20\x27JetBrains\x20Mono\x27,\x20\x27Courier\x20New\x27,\x20monospace;\x0a\x20\x20letter-spacing:\x200;\x0a\x20\x20line-height:\x201.8;\x0a}\x0a.layout-typewriter\x20.line\x20{\x0a\x20\x20display:\x20block;\x0a\x20\x20border-left:\x202px\x20solid\x20var(--diary-ink-3);\x0a\x20\x20padding-left:\x208px;\x0a\x20\x20margin:\x202px\x200;\x0a}\x0a\x0a/*\x20便签堆叠式\x20*/\x0a.layout-stack\x20{\x0a\x20\x20position:\x20relative;\x0a}\x0a.layout-stack\x20.note\x20{\x0a\x20\x20display:\x20block;\x0a\x20\x20padding:\x204px\x208px;\x0a\x20\x20margin:\x204px\x200;\x0a\x20\x20background:\x20var(--sticky-bg-1);\x0a\x20\x20border-left:\x202px\x20solid\x20var(--sticky-border-1);\x0a\x20\x20transform-origin:\x20left\x20center;\x0a}\x0a.layout-stack\x20.note:nth-child(odd)\x20{\x20transform:\x20rotate(-1deg);\x20}\x0a.layout-stack\x20.note:nth-child(even)\x20{\x20transform:\x20rotate(1deg);\x20}\x0a.layout-stack\x20.note:nth-child(3n)\x20{\x20background:\x20var(--sticky-bg-2);\x20border-color:\x20var(--sticky-border-2);\x20}\x0a.layout-stack\x20.note:nth-child(5n)\x20{\x20background:\x20var(--sticky-bg-3);\x20border-color:\x20var(--sticky-border-3);\x20}\x0a\x0a/*\x20气泡式排版\x20*/\x0a.layout-bubble\x20.bubble\x20{\x0a\x20\x20display:\x20inline-block;\x0a\x20\x20padding:\x203px\x208px;\x0a\x20\x20margin:\x203px;\x0a\x20\x20border-radius:\x2012px;\x0a\x20\x20background:\x20var(--bg-tertiary,\x20#f8fafc);\x0a\x20\x20border:\x201px\x20solid\x20var(--border-color,\x20#e2e8f0);\x0a}\x0a\x0a/*\x20螺旋式排版\x20-\x20渐变旋转\x20*/\x0a.layout-spiral\x20.part\x20{\x0a\x20\x20display:\x20inline-block;\x0a}\x0a.layout-spiral\x20.part:nth-child(1)\x20{\x20transform:\x20rotate(0deg);\x20}\x0a.layout-spiral\x20.part:nth-child(2)\x20{\x20transform:\x20rotate(2deg);\x20}\x0a.layout-spiral\x20.part:nth-child(3)\x20{\x20transform:\x20rotate(4deg);\x20}\x0a.layout-spiral\x20.part:nth-child(4)\x20{\x20transform:\x20rotate(6deg);\x20}\x0a.layout-spiral\x20.part:nth-child(5)\x20{\x20transform:\x20rotate(8deg);\x20}\x0a\x0a/*\x20呼吸效果\x20*/\x0a.layout-breath\x20.word\x20{\x0a\x20\x20display:\x20inline-block;\x0a\x20\x20animation:\x20breath\x203s\x20ease-in-out\x20infinite;\x0a}\x0a.layout-breath\x20.word:nth-child(odd)\x20{\x20animation-delay:\x200s;\x20}\x0a.layout-breath\x20.word:nth-child(even)\x20{\x20animation-delay:\x201.5s;\x20}\x0a@keyframes\x20breath\x20{\x0a\x20\x200%,\x20100%\x20{\x20transform:\x20scale(1);\x20opacity:\x201;\x20}\x0a\x20\x2050%\x20{\x20transform:\x20scale(1.05);\x20opacity:\x200.8;\x20}\x0a}\x0a\x0a/*\x20强调块\x20-\x20大字居中\x20*/\x0a.layout-hero\x20{\x0a\x20\x20text-align:\x20center;\x0a\x20\x20padding:\x2012px\x200;\x0a}\x0a.layout-hero\x20.big\x20{\x0a\x20\x20display:\x20block;\x0a\x20\x20font-size:\x2018px;\x0a\x20\x20font-weight:\x20600;\x0a\x20\x20line-height:\x201.3;\x0a}\x0a.layout-hero\x20.small\x20{\x0a\x20\x20display:\x20block;\x0a\x20\x20font-size:\x208px;\x0a\x20\x20color:\x20var(--diary-ink-3);\x0a\x20\x20margin-top:\x204px;\x0a}\x0a\x0a/*\x20列表式排版\x20*/\x0a.layout-list\x20.item\x20{\x0a\x20\x20display:\x20flex;\x0a\x20\x20align-items:\x20flex-start;\x0a\x20\x20gap:\x206px;\x0a\x20\x20margin:\x204px\x200;\x0a}\x0a.layout-list\x20.item::before\x20{\x0a\x20\x20content:\x20\x27—\x27;\x0a\x20\x20color:\x20var(--diary-ink-3);\x0a\x20\x20flex-shrink:\x200;\x0a}\x0a\x0a/*\x20标签云\x20*/\x0a.layout-cloud\x20{\x0a\x20\x20display:\x20flex;\x0a\x20\x20flex-wrap:\x20wrap;\x0a\x20\x20gap:\x204px;\x0a\x20\x20align-items:\x20center;\x0a}\x0a.layout-cloud\x20.word\x20{\x0a\x20\x20padding:\x202px\x206px;\x0a\x20\x20background:\x20var(--bg-tertiary,\x20#f1f5f9);\x0a\x20\x20border-radius:\x204px;\x0a\x20\x20font-size:\x20inherit;\x0a}\x0a.layout-cloud\x20.word:nth-child(3n)\x20{\x20font-size:\x201.1em;\x20}\x0a.layout-cloud\x20.word:nth-child(5n)\x20{\x20font-size:\x200.9em;\x20}\x0a.layout-cloud\x20.word:nth-child(7n)\x20{\x20font-size:\x201.2em;\x20}\x0a\x0a/*\x20时间线排版\x20*/\x0a.layout-timeline\x20{\x0a\x20\x20border-left:\x202px\x20solid\x20var(--diary-line);\x0a\x20\x20padding-left:\x2012px;\x0a\x20\x20margin-left:\x206px;\x0a}\x0a.layout-timeline\x20.event\x20{\x0a\x20\x20position:\x20relative;\x0a\x20\x20margin:\x208px\x200;\x0a}\x0a.layout-timeline\x20.event::before\x20{\x0a\x20\x20content:\x20\x27\x27;\x0a\x20\x20position:\x20absolute;\x0a\x20\x20left:\x20-16px;\x0a\x20\x20top:\x204px;\x0a\x20\x20width:\x206px;\x0a\x20\x20height:\x206px;\x0a\x20\x20border-radius:\x2050%;\x0a\x20\x20background:\x20var(--diary-ink-2);\x0a}\x0a\x0a/*\x20分栏排版\x20*/\x0a.layout-cols\x20{\x0a\x20\x20display:\x20grid;\x0a\x20\x20grid-template-columns:\x201fr\x201fr;\x0a\x20\x20gap:\x208px;\x0a}\x0a.layout-cols-3\x20{\x0a\x20\x20display:\x20grid;\x0a\x20\x20grid-template-columns:\x201fr\x201fr\x201fr;\x0a\x20\x20gap:\x206px;\x0a}\x0a\x0a/*\x20文字对齐\x20*/\x0a.text-center\x20{\x20text-align:\x20center;\x20}\x0a.text-right\x20{\x20text-align:\x20right;\x20}\x0a.text-left\x20{\x20text-align:\x20left;\x20}\x0a.text-justify\x20{\x20text-align:\x20justify;\x20}\x0a\x0a/*\x20旋转\x20*/\x0a.rotate-cw\x20{\x20transform:\x20rotate(2deg);\x20}\x0a.rotate-ccw\x20{\x20transform:\x20rotate(-2deg);\x20}\x0a\x0a/*\x20==========================================\x0a\x20\x20\x20装饰元素\x0a\x20\x20\x20==========================================\x20*/\x0a\x0a/*\x20便利贴\x20*/\x0a.sticky\x20{\x0a\x20\x20position:\x20absolute;\x0a\x20\x20padding:\x208px;\x0a\x20\x20font-size:\x2011px;\x0a\x20\x20box-shadow:\x202px\x202px\x205px\x20rgba(0,0,0,0.1);\x0a\x20\x20z-index:\x2010;\x0a}\x0a.sticky.s1\x20{\x0a\x20\x20background:\x20var(--sticky-bg-1);\x0a\x20\x20border-left:\x203px\x20solid\x20var(--sticky-border-1);\x0a}\x0a.sticky.s2\x20{\x0a\x20\x20background:\x20var(--sticky-bg-2);\x0a\x20\x20border-left:\x203px\x20solid\x20var(--sticky-border-2);\x0a}\x0a.sticky.s3\x20{\x0a\x20\x20background:\x20var(--sticky-bg-3);\x0a\x20\x20border-left:\x203px\x20solid\x20var(--sticky-border-3);\x0a}\x0a.sticky-head\x20{\x0a\x20\x20display:\x20flex;\x0a\x20\x20justify-content:\x20space-between;\x0a\x20\x20font-size:\x209px;\x0a\x20\x20color:\x20#666;\x0a\x20\x20margin-bottom:\x204px;\x0a\x20\x20font-weight:\x20600;\x0a\x20\x20text-transform:\x20uppercase;\x0a}\x0a.sticky-body\x20{\x0a\x20\x20line-height:\x201.4;\x0a}\x0a\x0a/*\x20旁注\x20*/\x0a.margin-note\x20{\x0a\x20\x20position:\x20absolute;\x0a\x20\x20right:\x20-10px;\x0a\x20\x20width:\x2060px;\x0a\x20\x20font-size:\x2010px;\x0a\x20\x20color:\x20var(--diary-ink-3);\x0a\x20\x20font-style:\x20italic;\x0a\x20\x20transform:\x20rotate(-5deg);\x0a\x20\x20border-left:\x202px\x20solid\x20var(--sticky-border-2);\x0a\x20\x20padding-left:\x204px;\x0a}\x0a\x0a/*\x20胶带\x20*/\x0a.tape\x20{\x0a\x20\x20position:\x20absolute;\x0a\x20\x20height:\x2020px;\x0a\x20\x20background:\x20linear-gradient(90deg,\x0a\x20\x20\x20\x20rgba(255,255,255,0.1)\x200%,\x0a\x20\x20\x20\x20rgba(255,255,255,0.3)\x2050%,\x0a\x20\x20\x20\x20rgba(255,255,255,0.1)\x20100%\x0a\x20\x20);\x0a\x20\x20background-color:\x20rgba(200,\x20200,\x20180,\x200.6);\x0a\x20\x20box-shadow:\x200\x201px\x203px\x20rgba(0,0,0,0.1);\x0a\x20\x20z-index:\x2015;\x0a}\x0a\x0a/*\x20邮戳\x20*/\x0a.stamp\x20{\x0a\x20\x20position:\x20absolute;\x0a\x20\x20width:\x2050px;\x0a\x20\x20height:\x2050px;\x0a\x20\x20border:\x202px\x20dashed\x20var(--diary-ink-3);\x0a\x20\x20border-radius:\x2050%;\x0a\x20\x20display:\x20flex;\x0a\x20\x20flex-direction:\x20column;\x0a\x20\x20align-items:\x20center;\x0a\x20\x20justify-content:\x20center;\x0a\x20\x20font-size:\x208px;\x0a\x20\x20color:\x20var(--diary-ink-3);\x0a\x20\x20opacity:\x200.7;\x0a\x20\x20transform:\x20rotate(-15deg);\x0a}\x0a.stamp\x20strong\x20{\x0a\x20\x20font-size:\x2012px;\x0a\x20\x20font-weight:\x20700;\x0a}\x0a\x0a/*\x20贴纸\x20*/\x0a.sticker\x20{\x0a\x20\x20position:\x20absolute;\x0a\x20\x20z-index:\x2012;\x0a\x20\x20filter:\x20drop-shadow(1px\x201px\x202px\x20rgba(0,0,0,0.2));\x0a}\x0a\x0a/*\x20引用线\x20*/\x0a.quote-line\x20{\x0a\x20\x20display:\x20block;\x0a\x20\x20padding-left:\x2012px;\x0a\x20\x20border-left:\x203px\x20solid\x20var(--diary-ink-3);\x0a\x20\x20font-style:\x20italic;\x0a\x20\x20color:\x20var(--diary-ink-2);\x0a\x20\x20margin:\x208px\x200;\x0a}\x0a\x0a/*\x20行距\x20*/\x0a.leading-tight\x20{\x20line-height:\x201.2;\x20}\x0a.leading-normal\x20{\x20line-height:\x201.5;\x20}\x0a.leading-loose\x20{\x20line-height:\x202;\x20}\x0a.leading-xl\x20{\x20line-height:\x202.5;\x20}\x0a\x0a/*\x20字间距\x20*/\x0a.tracking-tight\x20{\x20letter-spacing:\x20-0.5px;\x20}\x0a.tracking-normal\x20{\x20letter-spacing:\x200;\x20}\x0a.tracking-wide\x20{\x20letter-spacing:\x201px;\x20}\x0a.tracking-wider\x20{\x20letter-spacing:\x202px;\x20}\x0a\x0a/*\x20==========================================\x0a\x20\x20\x20扩展样式\x20-\x20更多自定义选项\x0a\x20\x20\x20==========================================\x20*/\x0a\x0a/*\x20更多字体\x20*/\x0a.f-cute\x20{\x20font-family:\x20\x27Comic\x20Sans\x20MS\x27,\x20\x27Chalkboard\x27,\x20cursive;\x20}\x0a.f-elegant\x20{\x20font-family:\x20\x27Playfair\x20Display\x27,\x20\x27Times\x20New\x20Roman\x27,\x20serif;\x20}\x0a\x0a/*\x20更多字号\x20*/\x0a.fs-3xl\x20{\x20font-size:\x2030px;\x20}\x0a\x0a/*\x20更多颜色\x20*/\x0a.c-pink\x20{\x20color:\x20#ec4899;\x20}\x0a.c-gold\x20{\x20color:\x20#d97706;\x20}\x0a\x0a/*\x20涂鸦划掉效果\x20*/\x0a.scribble\x20{\x0a\x20\x20position:\x20relative;\x0a\x20\x20opacity:\x200.6;\x0a}\x0a.scribble::after\x20{\x0a\x20\x20content:\x20\x27\x27;\x0a\x20\x20position:\x20absolute;\x0a\x20\x20left:\x20-2px;\x0a\x20\x20right:\x20-2px;\x0a\x20\x20top:\x2045%;\x0a\x20\x20height:\x203px;\x0a\x20\x20background:\x20currentColor;\x0a\x20\x20transform:\x20rotate(-2deg);\x0a}\x0a\x0a/*\x20紫色高亮\x20*/\x0a.bg-mark-purple\x20{\x20background:\x20rgba(233,\x20213,\x20255,\x200.8);\x20padding:\x200\x202px;\x20}\x0a\x0a/*\x20更多便利贴颜色\x20*/\x0a.sticky.s4\x20{\x0a\x20\x20background:\x20#dcfce7;\x0a\x20\x20border-left:\x203px\x20solid\x20#22c55e;\x0a}\x0a.sticky.s5\x20{\x0a\x20\x20background:\x20#f3e8ff;\x0a\x20\x20border-left:\x203px\x20solid\x20#a855f7;\x0a}\x0a.sticky.s6\x20{\x0a\x20\x20background:\x20#ffedd5;\x0a\x20\x20border-left:\x203px\x20solid\x20#f97316;\x0a}\x0a\x0a/*\x20便利贴形状\x20*/\x0a.sticky.sticky-square\x20{\x20border-radius:\x200;\x20}\x0a.sticky.sticky-rect\x20{\x20border-radius:\x200;\x20min-width:\x20100px;\x20}\x0a.sticky.sticky-flag\x20{\x0a\x20\x20border-radius:\x200;\x0a\x20\x20clip-path:\x20polygon(0\x200,\x20100%\x200,\x20100%\x2080%,\x2050%\x2095%,\x200\x2080%);\x0a\x20\x20padding:\x208px\x208px\x2018px;\x0a\x20\x20min-width:\x2090px;\x0a\x20\x20height:\x20auto;\x0a\x20\x20max-height:\x20110px;\x0a}\x0a.sticky.sticky-flag\x20.sticky-body\x20{\x0a\x20\x20max-height:\x2070px;\x0a\x20\x20overflow-y:\x20auto;\x0a\x20\x20overflow-x:\x20hidden;\x0a\x20\x20font-size:\x2010px;\x0a\x20\x20line-height:\x201.3;\x0a\x20\x20scrollbar-width:\x20thin;\x0a\x20\x20scrollbar-color:\x20rgba(0,0,0,0.2)\x20transparent;\x0a}\x0a.sticky.sticky-flag\x20.sticky-body::-webkit-scrollbar\x20{\x0a\x20\x20width:\x203px;\x0a}\x0a.sticky.sticky-flag\x20.sticky-body::-webkit-scrollbar-thumb\x20{\x0a\x20\x20background:\x20rgba(0,0,0,0.2);\x0a\x20\x20border-radius:\x202px;\x0a}\x0a.sticky.sticky-heart\x20{\x0a\x20\x20border:\x20none;\x0a\x20\x20background:\x20#fce7f3;\x0a\x20\x20clip-path:\x20path(\x27M12\x2021.35l-1.45-1.32C5.4\x2015.36\x202\x2012.28\x202\x208.5\x202\x205.42\x204.42\x203\x207.5\x203c1.74\x200\x203.41.81\x204.5\x202.09C13.09\x203.81\x2014.76\x203\x2016.5\x203\x2019.58\x203\x2022\x205.42\x2022\x208.5c0\x203.78-3.4\x206.86-8.55\x2011.54L12\x2021.35z\x27);\x0a\x20\x20width:\x2075px;\x0a\x20\x20height:\x2072px;\x0a\x20\x20padding:\x2016px\x2012px\x2022px;\x0a\x20\x20display:\x20flex;\x0a\x20\x20flex-direction:\x20column;\x0a}\x0a.sticky.sticky-heart\x20.sticky-body\x20{\x0a\x20\x20flex:\x201;\x0a\x20\x20max-height:\x2040px;\x0a\x20\x20overflow-y:\x20auto;\x0a\x20\x20overflow-x:\x20hidden;\x0a\x20\x20font-size:\x209px;\x0a\x20\x20line-height:\x201.25;\x0a\x20\x20scrollbar-width:\x20thin;\x0a\x20\x20scrollbar-color:\x20rgba(236,72,153,0.3)\x20transparent;\x0a}\x0a.sticky.sticky-heart\x20.sticky-body::-webkit-scrollbar\x20{\x0a\x20\x20width:\x203px;\x0a}\x0a.sticky.sticky-heart\x20.sticky-body::-webkit-scrollbar-thumb\x20{\x0a\x20\x20background:\x20rgba(236,72,153,0.3);\x0a\x20\x20border-radius:\x202px;\x0a}\x0a.sticky.sticky-star\x20{\x0a\x20\x20border:\x20none;\x0a\x20\x20background:\x20#fef9c3;\x0a\x20\x20clip-path:\x20polygon(50%\x200%,\x2061%\x2035%,\x2098%\x2035%,\x2068%\x2057%,\x2079%\x2091%,\x2050%\x2070%,\x2021%\x2091%,\x2032%\x2057%,\x202%\x2035%,\x2039%\x2035%);\x0a\x20\x20width:\x2085px;\x0a\x20\x20height:\x2085px;\x0a\x20\x20padding:\x2022px\x2016px\x2026px;\x0a\x20\x20text-align:\x20center;\x0a\x20\x20display:\x20flex;\x0a\x20\x20flex-direction:\x20column;\x0a\x20\x20align-items:\x20center;\x0a\x20\x20justify-content:\x20center;\x0a}\x0a.sticky.sticky-star\x20.sticky-body\x20{\x0a\x20\x20max-height:\x2045px;\x0a\x20\x20overflow-y:\x20auto;\x0a\x20\x20overflow-x:\x20hidden;\x0a\x20\x20font-size:\x209px;\x0a\x20\x20line-height:\x201.25;\x0a\x20\x20scrollbar-width:\x20thin;\x0a\x20\x20scrollbar-color:\x20rgba(234,179,8,0.3)\x20transparent;\x0a}\x0a.sticky.sticky-star\x20.sticky-body::-webkit-scrollbar\x20{\x0a\x20\x20width:\x203px;\x0a}\x0a.sticky.sticky-star\x20.sticky-body::-webkit-scrollbar-thumb\x20{\x0a\x20\x20background:\x20rgba(234,179,8,0.3);\x0a\x20\x20border-radius:\x202px;\x0a}\x0a.sticky.sticky-cloud\x20{\x0a\x20\x20border:\x20none;\x0a\x20\x20background:\x20#e0f2fe;\x0a\x20\x20border-radius:\x2050px;\x0a\x20\x20padding:\x2012px\x2016px;\x0a\x20\x20min-width:\x2085px;\x0a\x20\x20max-width:\x20120px;\x0a}\x0a.sticky.sticky-cloud\x20.sticky-body\x20{\x0a\x20\x20max-height:\x2060px;\x0a\x20\x20overflow-y:\x20auto;\x0a\x20\x20overflow-x:\x20hidden;\x0a\x20\x20scrollbar-width:\x20thin;\x0a\x20\x20scrollbar-color:\x20rgba(96,165,250,0.3)\x20transparent;\x0a}\x0a.sticky.sticky-cloud\x20.sticky-body::-webkit-scrollbar\x20{\x0a\x20\x20width:\x203px;\x0a}\x0a.sticky.sticky-cloud\x20.sticky-body::-webkit-scrollbar-thumb\x20{\x0a\x20\x20background:\x20rgba(96,165,250,0.3);\x0a\x20\x20border-radius:\x202px;\x0a}\x0a\x0a/*\x20胶带颜色\x20*/\x0a.tape.tape-yellow\x20{\x20background-color:\x20rgba(254,\x20240,\x20138,\x200.7);\x20}\x0a.tape.tape-pink\x20{\x20background-color:\x20rgba(252,\x20207,\x20224,\x200.7);\x20}\x0a.tape.tape-blue\x20{\x20background-color:\x20rgba(191,\x20219,\x20254,\x200.7);\x20}\x0a.tape.tape-clear\x20{\x20background-color:\x20rgba(255,\x20255,\x20255,\x200.4);\x20}\x0a\x0a/*\x20邮戳样式\x20*/\x0a.stamp.stamp-date\x20{\x20border-color:\x20#64748b;\x20color:\x20#64748b;\x20}\x0a.stamp.stamp-love\x20{\x20border-color:\x20#ec4899;\x20color:\x20#ec4899;\x20}\x0a.stamp.stamp-star\x20{\x20border-color:\x20#eab308;\x20color:\x20#eab308;\x20}\x0a.stamp.stamp-check\x20{\x20border-color:\x20#22c55e;\x20color:\x20#22c55e;\x20}\x0a\x0a/*\x20和纸胶带\x20*/\x0a.washi\x20{\x0a\x20\x20position:\x20absolute;\x0a\x20\x20height:\x2024px;\x0a\x20\x20background-repeat:\x20repeat-x;\x0a\x20\x20opacity:\x200.85;\x0a\x20\x20z-index:\x2014;\x0a}\x0a.washi.washi-dots\x20{\x0a\x20\x20background:\x20repeating-linear-gradient(90deg,\x20#fbbf24\x200px,\x20#fbbf24\x204px,\x20transparent\x204px,\x20transparent\x208px);\x0a\x20\x20background-color:\x20rgba(254,\x20243,\x20199,\x200.8);\x0a}\x0a.washi.washi-stripe\x20{\x0a\x20\x20background:\x20repeating-linear-gradient(45deg,\x20#f472b6\x200px,\x20#f472b6\x202px,\x20transparent\x202px,\x20transparent\x206px);\x0a\x20\x20background-color:\x20rgba(252,\x20231,\x20243,\x200.8);\x0a}\x0a.washi.washi-floral\x20{\x0a\x20\x20background-color:\x20rgba(220,\x20252,\x20231,\x200.8);\x0a\x20\x20background-image:\x20radial-gradient(circle,\x20#86efac\x202px,\x20transparent\x202px);\x0a\x20\x20background-size:\x208px\x208px;\x0a}\x0a\x0a/*\x20涂鸦装饰\x20*/\x0a.doodle\x20{\x0a\x20\x20position:\x20absolute;\x0a\x20\x20z-index:\x2013;\x0a\x20\x20opacity:\x200.6;\x0a}\x0a.doodle.doodle-heart::before\x20{\x20content:\x20\x27♡\x27;\x20font-size:\x2020px;\x20color:\x20#ec4899;\x20}\x0a.doodle.doodle-star::before\x20{\x20content:\x20\x27☆\x27;\x20font-size:\x2020px;\x20color:\x20#eab308;\x20}\x0a.doodle.doodle-cloud::before\x20{\x20content:\x20\x27☁\x27;\x20font-size:\x2020px;\x20color:\x20#60a5fa;\x20}\x0a.doodle.doodle-arrow::before\x20{\x20content:\x20\x27→\x27;\x20font-size:\x2018px;\x20color:\x20#64748b;\x20}\x0a.doodle.doodle-sparkle::before\x20{\x20content:\x20\x27✦\x27;\x20font-size:\x2016px;\x20color:\x20#a855f7;\x20}\x0a\x0a/*\x20照片框\x20*/\x0a.photo-frame\x20{\x0a\x20\x20display:\x20inline-block;\x0a\x20\x20padding:\x208px;\x0a\x20\x20background:\x20white;\x0a\x20\x20border:\x201px\x20solid\x20#e2e8f0;\x0a\x20\x20box-shadow:\x202px\x202px\x208px\x20rgba(0,0,0,0.1);\x0a\x20\x20transform:\x20rotate(-2deg);\x0a\x20\x20margin:\x208px;\x0a\x20\x20font-size:\x2011px;\x0a\x20\x20text-align:\x20center;\x0a\x20\x20color:\x20#64748b;\x0a}\x0a.photo-frame::before\x20{\x0a\x20\x20content:\x20\x27📷\x27;\x0a\x20\x20display:\x20block;\x0a\x20\x20font-size:\x2024px;\x0a\x20\x20margin-bottom:\x204px;\x0a}\x0a\x0a/*\x20票据/票根\x20*/\x0a.ticket\x20{\x0a\x20\x20display:\x20inline-block;\x0a\x20\x20padding:\x206px\x2012px;\x0a\x20\x20background:\x20linear-gradient(90deg,\x20#fef3c7\x200%,\x20#fef9c3\x20100%);\x0a\x20\x20border:\x201px\x20dashed\x20#d97706;\x0a\x20\x20border-radius:\x204px;\x0a\x20\x20font-size:\x2011px;\x0a\x20\x20color:\x20#92400e;\x0a\x20\x20position:\x20relative;\x0a}\x0a.ticket::before,\x0a.ticket::after\x20{\x0a\x20\x20content:\x20\x27\x27;\x0a\x20\x20position:\x20absolute;\x0a\x20\x20width:\x208px;\x0a\x20\x20height:\x208px;\x0a\x20\x20background:\x20var(--diary-page,\x20#fffef5);\x0a\x20\x20border-radius:\x2050%;\x0a\x20\x20top:\x2050%;\x0a\x20\x20transform:\x20translateY(-50%);\x0a}\x0a.ticket::before\x20{\x20left:\x20-4px;\x20}\x0a.ticket::after\x20{\x20right:\x20-4px;\x20}\x0a.ticket-head\x20{\x0a\x20\x20text-align:\x20center;\x0a\x20\x20font-weight:\x20600;\x0a\x20\x20padding-bottom:\x204px;\x0a\x20\x20border-bottom:\x201px\x20dotted\x20#d97706;\x0a\x20\x20margin-bottom:\x204px;\x0a\x20\x20letter-spacing:\x201px;\x0a}\x0a.ticket-row\x20{\x0a\x20\x20display:\x20flex;\x0a\x20\x20justify-content:\x20space-between;\x0a\x20\x20line-height:\x201.5;\x0a}\x0a\x0a/*\x20回形针\x20*/\x0a.clip\x20{\x0a\x20\x20position:\x20absolute;\x0a\x20\x20width:\x2020px;\x0a\x20\x20height:\x2050px;\x0a\x20\x20z-index:\x2053;\x0a}\x0a.clip::before,\x0a.clip::after\x20{\x0a\x20\x20content:\x20\x27\x27;\x0a\x20\x20position:\x20absolute;\x0a\x20\x20border:\x202px\x20solid\x20#94a3b8;\x0a\x20\x20border-radius:\x2010px\x2010px\x200\x200;\x0a}\x0a.clip::before\x20{\x0a\x20\x20width:\x2016px;\x0a\x20\x20height:\x2028px;\x0a\x20\x20top:\x200;\x0a\x20\x20left:\x2050%;\x0a\x20\x20transform:\x20translateX(-50%);\x0a\x20\x20border-bottom:\x20none;\x0a}\x0a.clip::after\x20{\x0a\x20\x20width:\x2010px;\x0a\x20\x20height:\x2020px;\x0a\x20\x20top:\x208px;\x0a\x20\x20left:\x2050%;\x0a\x20\x20transform:\x20translateX(-50%);\x0a\x20\x20border-bottom:\x20none;\x0a}\x0a\x0a/*\x20照片框完整样式\x20*/\x0a.photo-img\x20{\x0a\x20\x20width:\x20100%;\x0a\x20\x20aspect-ratio:\x204/3;\x0a\x20\x20background:\x20#f1f5f9;\x0a\x20\x20border:\x201px\x20solid\x20#e2e8f0;\x0a\x20\x20display:\x20flex;\x0a\x20\x20align-items:\x20center;\x0a\x20\x20justify-content:\x20center;\x0a\x20\x20font-size:\x2020px;\x0a\x20\x20color:\x20#94a3b8;\x0a\x20\x20margin-bottom:\x204px;\x0a}\x0a.photo-caption\x20{\x0a\x20\x20font-size:\x2010px;\x0a\x20\x20color:\x20#64748b;\x0a\x20\x20text-align:\x20center;\x0a\x20\x20font-style:\x20italic;\x0a}\x0a\x0a/*\x20标签贴\x20*/\x0a.label-tag\x20{\x0a\x20\x20position:\x20absolute;\x0a\x20\x20padding:\x203px\x208px\x203px\x206px;\x0a\x20\x20background:\x20#1e293b;\x0a\x20\x20color:\x20#f8fafc;\x0a\x20\x20font-size:\x208px;\x0a\x20\x20font-weight:\x20600;\x0a\x20\x20letter-spacing:\x201px;\x0a\x20\x20text-transform:\x20uppercase;\x0a\x20\x20clip-path:\x20polygon(8px\x200%,\x20100%\x200%,\x20100%\x20100%,\x208px\x20100%,\x200%\x2050%);\x0a\x20\x20z-index:\x2047;\x0a}\x0a\x0a/*\x20箭头注释\x20*/\x0a.arrow-note\x20{\x0a\x20\x20position:\x20absolute;\x0a\x20\x20font-size:\x2010px;\x0a\x20\x20color:\x20var(--diary-ink-3);\x0a\x20\x20display:\x20flex;\x0a\x20\x20align-items:\x20center;\x0a\x20\x20gap:\x203px;\x0a\x20\x20font-style:\x20italic;\x0a}\x0a.arrow-note::before\x20{\x0a\x20\x20content:\x20\x27\x5c2192\x27;\x0a\x20\x20font-size:\x2012px;\x0a\x20\x20font-style:\x20normal;\x0a}\x0a\x0a/*\x20分隔线\x20*/\x0a.divider\x20{\x0a\x20\x20display:\x20flex;\x0a\x20\x20align-items:\x20center;\x0a\x20\x20gap:\x208px;\x0a\x20\x20margin:\x2012px\x200;\x0a\x20\x20font-size:\x2010px;\x0a\x20\x20color:\x20var(--diary-ink-3);\x0a}\x0a.divider::before,\x0a.divider::after\x20{\x0a\x20\x20content:\x20\x27\x27;\x0a\x20\x20flex:\x201;\x0a\x20\x20height:\x201px;\x0a\x20\x20background:\x20var(--diary-line);\x0a}\x0a\x0a/*\x20拼贴布局\x20*/\x0a.layout-collage\x20{\x0a\x20\x20display:\x20grid;\x0a\x20\x20grid-template-columns:\x20repeat(3,\x201fr);\x0a\x20\x20gap:\x208px;\x0a\x20\x20transform:\x20rotate(-1deg);\x0a}\x0a.layout-collage\x20>\x20*\x20{\x0a\x20\x20transform:\x20rotate(var(--rotate,\x200deg));\x0a}\x0a.layout-collage\x20>\x20*:nth-child(odd)\x20{\x20--rotate:\x202deg;\x20}\x0a.layout-collage\x20>\x20*:nth-child(even)\x20{\x20--rotate:\x20-2deg;\x20}\x0a.layout-collage\x20>\x20*:nth-child(3n)\x20{\x20--rotate:\x20-3deg;\x20}\x0a\x0a/*\x20==========================================\x0a\x20\x20\x20深色模式适配\x0a\x20\x20\x20==========================================\x20*/\x0a@media\x20(prefers-color-scheme:\x20dark)\x20{\x0a\x20\x20:root\x20{\x0a\x20\x20\x20\x20--diary-cover:\x20#1a1a2e;\x0a\x20\x20\x20\x20--diary-cover-text:\x20#e2e8f0;\x0a\x20\x20\x20\x20--diary-page:\x20#1e1e2e;\x0a\x20\x20\x20\x20--diary-ink-1:\x20#e2e8f0;\x0a\x20\x20\x20\x20--diary-ink-2:\x20#a0aec0;\x0a\x20\x20\x20\x20--diary-ink-3:\x20#718096;\x0a\x20\x20\x20\x20--diary-line:\x20#2d3748;\x0a\x20\x20\x20\x20--sticky-bg-1:\x20#3d3d1a;\x0a\x20\x20\x20\x20--sticky-bg-2:\x20#3d1a2e;\x0a\x20\x20\x20\x20--sticky-bg-3:\x20#1a2e3d;\x0a\x20\x20}\x0a\x0a\x20\x20.layout-dialog\x20.say-l\x20{\x20background:\x20#2d3748;\x20}\x0a\x20\x20.layout-dialog\x20.say-r\x20{\x20background:\x20#1e3a5f;\x20}\x0a\x20\x20.layout-bubble\x20.bubble\x20{\x20background:\x20#2d3748;\x20border-color:\x20#4a5568;\x20}\x0a\x20\x20.hl\x20{\x20background:\x20linear-gradient(180deg,\x20transparent\x2060%,\x20rgba(254,\x20240,\x20138,\x200.3)\x2060%);\x20}\x0a}\x0a','BAOBAOBOOK','null','floor','笔记已成功删除','drawImage','\x0a\x0a###\x20灵魂底色','183','(总数:','FINAL\x20OUTPUT\x20PROTOCOL','Edit','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','fill','\x0a电话号码：','API错误\x20','checked','CALL\x20','Loading...','match','--diary-spine','Mute\x20toggled','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20','音效已开启','请输入条目名称','callType','Messages','userHeader','togetherInviteList','status','.mmpages-tab','\x27)\x22>','writeText','pl_','颜色提取失败:','callUserReplies','请先配置API','📱\x20Detail\x20toggled,\x20expanded:','✅\x20找到角色头像:','请检查图片地址','🤖\x20AI接听，共','\x27)\x22\x20title=\x22删除\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','sending','dataset','switch_playlist','✅\x20百宝书分类管理模块加载完成','Silence\x20is\x20the\x20loudest\x20scream.','setItem','Enter\x20number','保存失败，请稍后重试','catch','#ff3b5c','https://i.pravatar.cc/150?img=1','.lyrics-line','[百宝书]\x20重命名分类:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',',\x20x=','❌\x20加载短信历史失败:','📝\x20找到角色信息:','❌\x20[SMS重回]\x20失败:','\x22\x20style=\x22','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20block;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x2080%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x2020px\x20auto;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x201px\x20solid\x20#e8e8e8;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20','确定要删除这条回复吗？','重回失败:\x20','mmpagesEditUsername','musicWidgetOrbUrlApply','minRight','.thread-comment-menu.active,\x20.mmpages-post-menu.active','...','14.思维链质控','\x22\x20data-username=\x22','head','\x22\x20吗？\x0a\x0a这是随机陌生人\x20\x22','diary-idx-action-btn','contactAvatar','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','deleteCategoryConfirmModal','rgba(0,0,0,0.05)','9.历史说明','\x20·\x20已禁用','1000','chatMessages','contacts-index-letter','mmpagesEditAvatarPreview','newContactRealNameGroup','preview','svg','📱\x20[SMS重回]\x20已移除smsMessages中的重复用户消息','添加失败','unknown','note','✅\x20使用通讯录自定义头像','\x0a不喜欢：','div','✅\x20[SMS重回]\x20成功生成新回复:','detailString','📱\x20Create\x20new\x20contact\x20for:','.album-thumb','deleteStrangerOption','📞\x20随机陌生人号码，已验证11位','userProfile:','这是他对主贴的评论。回应他。','Following','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-sticky-head\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-sticky-head-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','【雨夜喧嚣·广场】','onerror','❌\x20帖子不存在:','<path\x20d=\x22M17\x2017L7\x207M7\x207h10M7\x207v10\x22/>','clientX','<polygon\x20points=\x2211\x205\x206\x209\x202\x209\x202\x2015\x206\x2015\x2011\x2019\x2011\x205\x22/><path\x20d=\x22M15.54\x208.46a5\x205\x200\x20010\x207.07\x22/>','<span\x20class=\x22image-gallery-category-badge\x20universal\x22>通用</span>','together-name','sentences','页，剩余','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','17.AI预填充','musicWidgetLyricColor','❌\x20Save\x20contact\x20failed:','保存失败，请重试','📱\x20toggleContactHistoryCard\x20called','#ffffff','index','playlistTitle','delete','✅\x20百宝书条目管理模块加载完成','result','imessage-selected','📱\x20Switched\x20to\x20Recent\x20Calls\x20view','\x22\x20data-phone-number=\x22','<div\x20class=\x22thread-comments-list\x22>','📱\x20SMS\x20Call:','isUserSavedContact','Thousands\x20of\x20tears\x20falling...','✅\x20已删除chatMessages:\x20','rgba(255,\x20255,\x20255,\x200.15)','\x20条消息','Incoming\x20Call','onkeydown','baobaobookNewCategoryNameInput','\x22</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-list-container\x22\x20id=\x22songListContainer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22spine-line\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20歌曲列表将在这里生成\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22newSongInput\x22\x20class=\x22ghost-input\x22\x20placeholder=\x22Add\x20a\x20song...\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-search-panel\x22\x20id=\x22songSearchPanel\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-search-stars\x22\x20aria-hidden=\x22true\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span></span><span></span><span></span><span></span><span></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-search-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-search-title-text\x22>SEARCH\x20RESULTS</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-search-sub\x22>Tap\x20to\x20add\x20to\x20playlist</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-search-list\x22\x20id=\x22songSearchList\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20搜索结果将通过\x20JS\x20动态生成\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-search-foot\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-search-foot-line\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22song-search-foot-text\x22>Source:\x20netease</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22action-btn-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22circle-btn\x22\x20onclick=\x22selectPlaylistForPlayback()\x22\x20title=\x22Select\x20playlist\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x221.6\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x226\x22></circle>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x222.2\x22\x20fill=\x22currentColor\x22\x20stroke=\x22none\x22></circle>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22circle-btn\x22\x20onclick=\x22deletePlaylist()\x22\x20title=\x22Delete\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x221.6\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M4\x207h16\x22\x20stroke-linecap=\x22round\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M9\x207V5a1\x201\x200\x200\x201\x201-1h4a1\x201\x200\x200\x201\x201\x201v2\x22\x20stroke-linecap=\x22round\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M7\x207l1\x2013a2\x202\x200\x200\x200\x202\x202h4a2\x202\x200\x200\x200\x202-2l1-13\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M10\x2011v6M14\x2011v6\x22\x20stroke-linecap=\x22round\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22circle-btn\x22\x20onclick=\x22closeUserPlaylistOverlay()\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20','keydown','条目已更新','imessagePinnedSection','diary-page\x20diary-inner\x20diary-dynamic','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-search-meta\x22>','callScreen','请输入新的分类名称:','<img\x20src=\x22','contactDetailNumber','pointerType','已选择\x200\x20项','[未接来电]\x20','3630PBwNnR','Accept','images','📋\x20加载用户资料:','contains','target','」\x0a【飞石轨迹】用户说：','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22diary-idx-title\x22>📌\x20笔记\x20(','https://i.postimg.cc/43K8qNwS/71fa6fd434f6e4ba8c6bec67d1b6d792.jpg','⚠️\x20DTMF音效播放失败:','chatSettingsUserAvatar','length','toLowerCase','followers','📱\x20Detail\x20element:','after','musicWidgetChangeListBtn','en-US','charSettings','\x0a\x0a---\x0a\x0a','<span\x20class=\x22thread-author-badge\x22>·\x20To\x20','\x0a用户名：','184','grab','next','#baobaobookGrid','私聊历史，注意公私边界。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-pinned-item\x22\x20onclick=\x22openImessageChat(\x27','📱\x20Opening\x20SMS\x20detail\x20for:','138','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','orbitOrb','settings','次\x0a最近一次徘徊：','NOTE','👤\x20从联系人读取人设:','\x22吗？<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20该分类下的条目将被移到未分类。\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-btn\x22\x20onclick=\x22closeDeleteCategoryConfirm()\x22>取消</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-btn\x20primary\x22\x20onclick=\x22confirmDeleteBaobaobookCategory(\x27','这是刚才发生的事情（按时间顺序）。','Phone\x20clicked\x20for:','flushChatDetailRefreshIfNeeded:done','diary-entry-content','avatar','📱\x20[SMS删除]\x20已同步smsMessages:','innerHeight','global','sms-message\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22baobaobook-entry-category\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contacts-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M20\x2021v-2a4\x204\x200\x200\x200-4-4H8a4\x204\x200\x200\x200-4\x204v2\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2212\x22\x20cy=\x227\x22\x20r=\x224\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contacts-empty-text\x22>加载失败</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contacts-empty-subtext\x22>请稍后重试</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','userProfiles','openImageGalleryDrawer','📱\x20返回iMessage列表','align','linearRampToValueAtTime','undefined','deletedPostEvent',',\x20isStranger=','center','再次点击爱心：清理重复笔记（不可撤销）','together-avatar','无法解析AI回复','comments','reverse','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-show-replies-icon\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x223\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<polyline\x20points=\x226\x209\x2012\x2015\x2018\x209\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','动态不存在','linkedCharacterData','put','sendTogetherInviteToChat:done','stopPropagation','\x20条重复笔记','.spine-line','lastTimestamp','\x20条重复笔记。\x0a\x0a是否立即清理？（不可撤销）\x0a\x0a规则：优先保留你拖动过位置的便签；其余按文本去重。','📱\x20找到短信历史:','.diary-sticky[data-note-id]','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22center-visual\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22ripple\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22ripple\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radar-star\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card-status\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','📋\x20使用已保存的人设:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-msg-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-msg-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-msg-name\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','stroke','removeChild','198','keypad','min','149','paused','anonymous','199','timeupdate','\x20bottom:\x20','⚠️\x20当前没有角色数据','max','volume','musicWidgetOrbSizeValue','Send\x20message','\x0a\x0a###\x20禁忌之锁\x20(Diary\x20Lock)\x0a密码：','slice','📱\x20[Contacts]\x20Hidden\x20auto\x20contacts:','getAvailableGalleryImages','评论已发送','previewText','isLastReply','条AI回复，正在重新生成...','12.百宝书-后','AI回复失败','user-playlist-close','删除成功','当前聊天暂无歌单','📱\x20Redial:','【世界法则】这是头顶的天空和脚下的土地（只读背景）。','\x0a\x0a###\x20你的当前面具\x20(Status)\x0a尚未佩戴面具\x0a（在第一次开口时，给自己戴上一个状态。）','❌\x20随机陌生人通话初始化失败','3.创作说明','确定删除此分类？分类内的所有图片链接也会被删除。','.sms-input-area','你要踩着这些台阶往上走。','sameDate','[百宝书]\x20保存分类失败:','userPlaylistAvatar','baobaobook-create-entry-btn','Playing','animationPlayState','❌\x20[iMessage]\x20打开短信聊天失败:','\x22\x20onclick=\x22toggleSmsMessageSelection(','Enter','\x27);\x20background-size:\x20cover;\x22','8.表情包库','callReplyInput','❌\x20打开Thread\x20Detail失败:','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contacts-item-phone\x22>','<svg\x20viewBox=\x220\x200\x2024\x2024\x22><rect\x20x=\x223\x22\x20y=\x224\x22\x20width=\x2218\x22\x20height=\x2218\x22\x20rx=\x222\x22\x20ry=\x222\x22></rect><line\x20x1=\x2216\x22\x20y1=\x222\x22\x20x2=\x2216\x22\x20y2=\x226\x22></line><line\x20x1=\x228\x22\x20y1=\x222\x22\x20x2=\x228\x22\x20y2=\x226\x22></line><line\x20x1=\x223\x22\x20y1=\x2210\x22\x20x2=\x2221\x22\x20y2=\x2210\x22></line></svg>','##\x20他的听觉偏好\x20(Auditory\x20Taste)\x0a','getElementById','\x22\x20alt=\x22AI生成的图片\x22\x20loading=\x22lazy\x22\x20onerror=\x22this.style.display=\x27none\x27\x22>','pageEl','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-sticky\x20','186','description','POSITIVE_INFINITY','querySelector',',\x20sessionId=','name','WISH','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x221.5\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x229\x22></circle>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x208v4M12\x2014h.01\x22></path>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','armed','\x22\x20data-note-id=\x22','playlist','编辑条目','⚠️\x20没有当前Mmpages角色','📜\x20[Thread]\x20未找到匹配的聊天记录\x20(characterId=','找不到该条目','发送繁忙短信失败:','\x0a（他正看着\x20@','closing','toLocaleString','🗑️\x20准备删除笔记,\x20ID:','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-history-type\x20','【思维链质控】','musicWidgetLyricColorBtn','toUsername','__ovoActiveChatRecord','10000','.vol-filled','defaultScenes','imessage-item\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22recent-call-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22recent-call-number\x20','fade-out','.diary-page.diary-dynamic','.playlist-section','deleteContactOption','AI回复失败:\x20','showIslandNotification','show-playlist','关键信息确认。','Heartbeat\x20syncs\x20to\x20the\x20kick.','#baobaobookCategoryTabs\x20.worldview-tab','top','block','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-action-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M21\x2011.5a8.38\x208.38\x200\x200\x201-.9\x203.8\x208.5\x208.5\x200\x200\x201-7.6\x204.7\x208.38\x208.38\x200\x200\x201-3.8-.9L3\x2021l1.9-5.7a8.38\x208.38\x200\x200\x201-.9-3.8\x208.5\x208.5\x200\x200\x201\x204.7-7.6\x208.38\x208.38\x200\x200\x201\x203.8-.9h.5a8.48\x208.48\x200\x200\x201\x208\x208v.5z\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22thread-action-count\x22>','set','\x22已删除','Playlist','aria-label','<div\x20class=\x22phone-profile-number\x22>','isFinite','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-action-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M20\x2011a8.1\x208.1\x200\x200\x200\x20-15.5\x20-2m-.5\x20-4v4h4\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M4\x2013a8.1\x208.1\x200\x200\x200\x2015.5\x202m.5\x204v-4h-4\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22thread-action-count\x22>','.sms-date-separator','__ovoPlaylistId','📝\x20记录AI回复到通话记录:','[百宝书]\x20筛选分类ID:','📂\x20[Thread]\x20使用会话:\x20','##\x20你们的私下纠缠\x20(Undercurrents)\x0a\x0a这是你们在私聊（Private\x20Chat）里发生过的故事。\x0a**法则**：这是广场，不是卧室。不要直接复述这些话，但要让这些记忆影响你的语气。\x0a如果你们私下很亲密，那就在公开场合给他一个心照不宣的眼神。\x0a\x0a','frequency','together','default','[characterId+sessionId+profileId]','string','【寂静】：暂无历史记录','connect','toFixed','声喧哗\x20|\x20','insertAdjacentHTML','[UserPlaylist]\x20save\x20db\x20failed:','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22baobaobook-entry-preview\x22>','randomSmsPersona','hintText','url','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contacts-item-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contacts-item-name\x22>','」的楼里说话。','\x22\x20alt=\x22\x22\x20onerror=\x22this.parentElement.innerHTML=\x27<svg\x20viewBox=\x5c\x270\x200\x2024\x2024\x5c\x27><rect\x20x=\x5c\x273\x5c\x27\x20y=\x5c\x273\x5c\x27\x20width=\x5c\x2718\x5c\x27\x20height=\x5c\x2718\x5c\x27\x20rx=\x5c\x272\x5c\x27\x20ry=\x5c\x272\x5c\x27/><circle\x20cx=\x5c\x278.5\x5c\x27\x20cy=\x5c\x278.5\x5c\x27\x20r=\x5c\x271.5\x5c\x27/><polyline\x20points=\x5c\x2721\x2015\x2016\x2010\x205\x2021\x5c\x27/></svg>\x27\x22>','song-search-empty','(作者)','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-author-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22thread-author-name\x22>','🚀\x20[日记本]\x20初始渲染','overlayLayer','collapsible','forEach','暂无可切换的用户资料','\x27)\x22>删除</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20','coverHTML','fillStyle','musicWidgetOrbSize','#baobaobookEntryContentTextarea','click','pointer','focus','closest','positionY','❌\x20[Thread]\x20发送评论失败:','musicWidgetListScroll','📱\x20[DEBUG]\x20准备显示通话界面...','展开全文','<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M20.84\x204.61a5.5\x205.5\x200\x200\x200-7.78\x200L12\x205.67l-1.06-1.06a5.5\x205.5\x200\x200\x200-7.78\x207.78l1.06\x201.06L12\x2021.23l7.78-7.78\x201.06-1.06a5.5\x205.5\x200\x200\x200\x200-7.78z\x22></path></svg>','📱\x20最终状态:\x20isContact=','❌\x20获取删除事件失败:','isEnabled','lyricsContainer','❌\x20加载用户资料失败:',',\x20y=','🔍\x20[DEBUG]\x20检查initCallWithAI函数:','<div\x20class=\x22sms-message-content\x22>','__ovoSongKey','\x0a\x0a##\x20【雨中告示板】(THE\x20POST)\x0a发布者：','应用颜色失败:','db|','has-image','is-visible','lastMessage','5.百宝书-中','你好呀~','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-msg-time\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-history-time\x22>','toISOString','textContent','【飞石袭来】用户刚刚在你的楼下喊话：','commentList','❌\x20添加图片失败:','callTimer','playlists','rgba(0,\x200,\x200,\x200.15)','❌\x20头像元素不存在','已选中歌单','<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M6\x2019h4V5H6v14zm8-14v14h4V5h-4z\x22/></svg>','text','\x22\x20alt=\x22\x22\x20style=\x22width:100%;height:100%;object-fit:cover;border-radius:50%;\x22>','Audrey\x20Hepburn','<div\x20class=\x22thread-post-images\x22>','[视觉锚点',']\x20@','parentElement','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22char-profile-highlight\x22\x20onclick=\x22handleCharProfileHighlight(\x27','📝\x20[日记本]\x20已分组','showTimer','180','long','Character\x20Name','getAttribute','errorText','__OVO_APPS_BUNDLE_LOADED__','toString','📱\x20chatMessages\x20中的通话记录:','userCommentReplies','187','image','已删除联系人\x20\x22','Music\x20is\x20the\x20reason\x20why','.mmpages-like-btn','No\x20bio','scrollTop','附加图片','这是属于角色的私人日记，记录着与用户相处的点点滴滴...','9.5.百宝书强化','评论已删除','想你了~','请输入分类名称','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','playlistId','Character','newImageDescription','lastViewedAt','DAILY\x20SCHEDULE','bulkDelete','\x20+\x20','getImageData','recentCallList','Session\x20initialized','Calling','当前好感度。','start','unshift','mmpagesEditBio','📱\x20Block\x20number:','alt','linear-gradient(135deg,\x0a\x20\x20\x20\x20\x20\x20\x20\x20rgba(','parseFloat','title','animating','.phone-call-btn','Ψ(x)','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','flipped','📞\x20拨通电话，等待陌生人接听...','未知运营商','from','newMainComments','innerWidth','splice','entryIndex','shiftKey','」已创建','159','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-action-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M4.698\x204.034l16.302\x207.966l-16.302\x207.966a.503\x20.503\x200\x200\x201\x20-.546\x20-.124a.555\x20.555\x200\x200\x201\x20-.12\x20-.568l2.468\x20-7.274l-2.468\x20-7.274a.555\x20.555\x200\x200\x201\x20.12\x20-.568a.503\x20.503\x200\x200\x201\x20.546\x20-.124z\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M6.5\x2012h14.5\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22thread-action-count\x22>','musicWidgetLyricColorSwatch','minLeft','【命运时刻】这是时间线上的路标（只读）。','<div\x20class=\x22sms-date-label\x22>','equals','first','<div\x20class=\x22sms-delivered\x22>Delivered</div>','currentSticky','7.剧情点','.mmpages-post-menu','.mmpages-post-menu.active','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22diary-idx-page\x22>','❌\x20[DEBUG]\x20AI没有返回有效回复'];_0x2c65=function(){return _0x10d29f;};return _0x2c65();}function toggleContactHistoryDetail(_0x4ad521){const _0x38f7f2=_0x28e739;console['log'](_0x38f7f2(0x338),_0x4ad521);const _0xda5d8=document[_0x38f7f2(0x761)](_0x38f7f2(0x1e6)+_0x4ad521);console[_0x38f7f2(0x41f)](_0x38f7f2(0x6ed),_0xda5d8),_0xda5d8?(_0xda5d8[_0x38f7f2(0x421)]['toggle'](_0x38f7f2(0x22e)),console[_0x38f7f2(0x41f)](_0x38f7f2(0x66c),_0xda5d8[_0x38f7f2(0x421)]['contains'](_0x38f7f2(0x22e)))):console[_0x38f7f2(0x516)]('📱\x20Detail\x20element\x20not\x20found\x20for\x20index:',_0x4ad521);}function formatContactHistoryTime(_0x26aa77){const _0x1b9e32=_0x28e739;if(!_0x26aa77)return'--';const _0x546584=new Date(_0x26aa77);if(isNaN(_0x546584[_0x1b9e32(0x278)]()))return'--';const _0x11fd24=_0x546584[_0x1b9e32(0x18f)](),_0xf0ef47=_0x546584[_0x1b9e32(0x36d)]()+0x1,_0x9ae77a=_0x546584[_0x1b9e32(0x8b9)](),_0x1bf2a4=String(_0x546584[_0x1b9e32(0x971)]())[_0x1b9e32(0x90f)](0x2,'0'),_0x4747b4=String(_0x546584[_0x1b9e32(0x1db)]())[_0x1b9e32(0x90f)](0x2,'0');return _0x11fd24+'/'+_0xf0ef47+'/'+_0x9ae77a+_0x1b9e32(0x2ec)+_0x1bf2a4+':'+_0x4747b4;}function formatTranscriptTime(_0x1c2f7f){const _0x112f70=_0x28e739;if(!_0x1c2f7f)return'';const _0x24f038=new Date(_0x1c2f7f);if(isNaN(_0x24f038[_0x112f70(0x278)]()))return'';const _0x27a9e8=String(_0x24f038[_0x112f70(0x971)]())[_0x112f70(0x90f)](0x2,'0'),_0x574f7d=String(_0x24f038[_0x112f70(0x1db)]())[_0x112f70(0x90f)](0x2,'0'),_0x35c7af=String(_0x24f038['getSeconds']())[_0x112f70(0x90f)](0x2,'0');return _0x27a9e8+':'+_0x574f7d+':'+_0x35c7af;}function getCarrierFromNumber(_0x4c6e91){const _0x34b952=_0x28e739;if(!_0x4c6e91)return'';const _0x1aa1c6=_0x4c6e91[_0x34b952(0x568)](/\s/g,'')['replace'](/-/g,'');if(_0x1aa1c6===_0x34b952(0x2e8))return _0x34b952(0x364);if(_0x1aa1c6==='10010')return _0x34b952(0x4e5);if(_0x1aa1c6===_0x34b952(0x77e))return _0x34b952(0x38f);if(_0x1aa1c6[_0x34b952(0x414)]('134')||_0x1aa1c6['startsWith'](_0x34b952(0x427))||_0x1aa1c6[_0x34b952(0x414)](_0x34b952(0x21d))||_0x1aa1c6['startsWith']('137')||_0x1aa1c6[_0x34b952(0x414)](_0x34b952(0x6fc))||_0x1aa1c6[_0x34b952(0x414)](_0x34b952(0x83e))||_0x1aa1c6[_0x34b952(0x414)](_0x34b952(0x8cb))||_0x1aa1c6[_0x34b952(0x414)](_0x34b952(0x3b9))||_0x1aa1c6[_0x34b952(0x414)]('152')||_0x1aa1c6[_0x34b952(0x414)]('157')||_0x1aa1c6[_0x34b952(0x414)](_0x34b952(0x2b6))||_0x1aa1c6[_0x34b952(0x414)](_0x34b952(0x829))||_0x1aa1c6[_0x34b952(0x414)](_0x34b952(0x94e))||_0x1aa1c6[_0x34b952(0x414)](_0x34b952(0x64f))||_0x1aa1c6[_0x34b952(0x414)](_0x34b952(0x6f5))||_0x1aa1c6['startsWith'](_0x34b952(0x7f9))||_0x1aa1c6[_0x34b952(0x414)](_0x34b952(0x1c3))||_0x1aa1c6[_0x34b952(0x414)](_0x34b952(0x72e)))return'中国移动';if(_0x1aa1c6[_0x34b952(0x414)](_0x34b952(0x261))||_0x1aa1c6['startsWith']('131')||_0x1aa1c6[_0x34b952(0x414)](_0x34b952(0x356))||_0x1aa1c6[_0x34b952(0x414)](_0x34b952(0x869))||_0x1aa1c6[_0x34b952(0x414)](_0x34b952(0x3c9))||_0x1aa1c6[_0x34b952(0x414)](_0x34b952(0x925))||_0x1aa1c6[_0x34b952(0x414)](_0x34b952(0x765))||_0x1aa1c6['startsWith']('166'))return'中国联通';if(_0x1aa1c6['startsWith'](_0x34b952(0x588))||_0x1aa1c6[_0x34b952(0x414)](_0x34b952(0x731))||_0x1aa1c6[_0x34b952(0x414)](_0x34b952(0x1dd))||_0x1aa1c6[_0x34b952(0x414)](_0x34b952(0x7f0))||_0x1aa1c6[_0x34b952(0x414)]('181')||_0x1aa1c6[_0x34b952(0x414)]('189')||_0x1aa1c6['startsWith'](_0x34b952(0x734)))return'中国电信';return _0x34b952(0x821);}function sendMessageToContact(){const _0x356f3d=_0x28e739;if(!currentContactData)return;console[_0x356f3d(0x41f)]('📱\x20Send\x20message\x20to:',currentContactData[_0x356f3d(0x4ea)]);const _0x367b16=currentContactData[_0x356f3d(0x27f)]||currentContactData[_0x356f3d(0x4ea)];openSmsDetail(currentContactData['phoneNumber'],_0x367b16);}let currentSmsData={'phoneNumber':null,'contactName':null,'messages':[]};const smsUiSessionStore=new Map();function getSmsSession(_0x2eb309,_0x423952){const _0x224837=_0x28e739,_0x5dcc0b=_0x2eb309||'',_0x30c65a=normalizeId(_0x5dcc0b);if(!_0x30c65a)return{'phoneNumber':_0x5dcc0b,'contactName':_0x423952||'','messages':[]};let _0x11b493=smsUiSessionStore['get'](_0x30c65a);if(!_0x11b493)_0x11b493={'phoneNumber':_0x5dcc0b,'contactName':_0x423952||'','messages':[]},smsUiSessionStore[_0x224837(0x790)](_0x30c65a,_0x11b493);else{if(_0x5dcc0b)_0x11b493[_0x224837(0x4ea)]=_0x5dcc0b;if(_0x423952)_0x11b493['contactName']=_0x423952;}return _0x11b493;}function isSmsDetailActive(){const _0x59be15=_0x28e739,_0x5715cd=document[_0x59be15(0x761)](_0x59be15(0x3ad));return!!(_0x5715cd&&_0x5715cd[_0x59be15(0x421)][_0x59be15(0x6e3)](_0x59be15(0x525)));}function isSameSmsSession(_0x165690){const _0x569f93=_0x28e739;if(!_0x165690)return![];const _0x4170f8=currentSmsData?.[_0x569f93(0x4ea)]||'';return normalizeId(_0x4170f8)===normalizeId(_0x165690);}function getLastSmsAssistantPreview(_0xf15ab1){const _0x3b2404=_0x28e739;if(!Array[_0x3b2404(0x851)](_0xf15ab1))return'';for(let _0x8fa2dc=_0xf15ab1[_0x3b2404(0x6ea)]-0x1;_0x8fa2dc>=0x0;_0x8fa2dc--){const _0x5e17a6=_0xf15ab1[_0x8fa2dc];if(_0x5e17a6&&_0x5e17a6[_0x3b2404(0x58e)]===_0x3b2404(0x1c7)&&typeof _0x5e17a6[_0x3b2404(0x632)]===_0x3b2404(0x7a1)&&_0x5e17a6[_0x3b2404(0x632)][_0x3b2404(0x28e)]())return _0x5e17a6[_0x3b2404(0x632)]['trim']();}for(let _0x474890=_0xf15ab1[_0x3b2404(0x6ea)]-0x1;_0x474890>=0x0;_0x474890--){const _0x221ed8=_0xf15ab1[_0x474890];if(_0x221ed8&&typeof _0x221ed8[_0x3b2404(0x632)]==='string'&&_0x221ed8[_0x3b2404(0x632)][_0x3b2404(0x28e)]())return _0x221ed8['content']['trim']();}return'';}async function resolveSmsNotificationAvatar(_0x38522d,_0x3d5c56){const _0x20e845=_0x28e739;let _0x1ad3c7='';const _0x6b3ee7=normalizeId(_0x3d5c56||'');if(_0x6b3ee7&&db?.[_0x20e845(0x315)])try{const _0x28f866=await db[_0x20e845(0x315)][_0x20e845(0x309)](_0x6b3ee7);_0x1ad3c7=_0x28f866?.[_0x20e845(0x691)]||_0x28f866?.['avatar']||_0x28f866?.['characterAvatar']||'';}catch(_0x7303e2){}if(!_0x1ad3c7&&_0x38522d&&typeof getCharacterById===_0x20e845(0x48c))try{const _0x1c5639=await getCharacterById(_0x38522d);_0x1ad3c7=_0x1c5639?.['settings']?.[_0x20e845(0x922)]||_0x1c5639?.['avatar']||'';}catch(_0x43af97){}return!_0x1ad3c7&&typeof currentSmsCharacter!==_0x20e845(0x714)&&(_0x1ad3c7=currentSmsCharacter?.['settings']?.[_0x20e845(0x922)]||currentSmsCharacter?.[_0x20e845(0x708)]||''),_0x1ad3c7||'';}async function showSmsReplyPhoneStyleNotification(_0x5a1e35={}){const _0xa07079=_0x28e739;if(typeof showPhoneStyleNotification!=='function')return![];const _0x40617d=_0x5a1e35[_0xa07079(0x4ea)]||currentSmsData?.[_0xa07079(0x4ea)]||'',_0x413c7f=_0x5a1e35['characterId']||(typeof currentSmsCharacterId!==_0xa07079(0x714)?currentSmsCharacterId:''),_0x113e69=normalizeId(_0x413c7f||'');let _0x470fb1=String(_0x5a1e35[_0xa07079(0x873)]||'')[_0xa07079(0x28e)]();!_0x470fb1&&typeof getCurrentSmsCharacterName===_0xa07079(0x48c)&&(_0x470fb1=String(getCurrentSmsCharacterName(_0x40617d)||'')['trim']());if(!_0x470fb1)_0x470fb1=currentSmsData?.['contactName']||'角色';let _0x150ddf=String(_0x5a1e35[_0xa07079(0x741)]||'')[_0xa07079(0x28e)]();!_0x150ddf&&(_0x150ddf=getLastSmsAssistantPreview(_0x5a1e35[_0xa07079(0x1eb)]||currentSmsData?.['messages']||[]));_0x150ddf=String(_0x150ddf||'')[_0xa07079(0x568)](/\s+/g,'\x20')[_0xa07079(0x28e)]();if(!_0x150ddf)_0x150ddf=_0xa07079(0x225);const _0x173393=(typeof getAppDisplayName===_0xa07079(0x48c)?getAppDisplayName(_0xa07079(0x518)):'')||'电话';let _0x4e0f3e='';if(typeof getAppNotificationIconHtml===_0xa07079(0x48c))try{_0x4e0f3e=await getAppNotificationIconHtml(_0xa07079(0x518));}catch(_0x3217c8){_0x4e0f3e='';}const _0x33453f=await resolveSmsNotificationAvatar(_0x113e69,_0x40617d);return showPhoneStyleNotification({'title':_0x173393,'message':_0x470fb1+'：'+_0x150ddf,'avatar':_0x33453f||null,'leftIcon':_0xa07079(0x3fa),'leftIconHtml':_0x4e0f3e||null,'duration':0xbb8,'showTime':!![]}),!![];}let smsEditMode=![],smsSelectedMessages=new Set(),smsOpenedFrom=_0x28e739(0x518);async function openSmsDetail(_0xb6a441,_0xb1ca06){const _0x28683b=_0x28e739;console[_0x28683b(0x41f)](_0x28683b(0x6fb),_0xb6a441,_0xb1ca06),currentSmsData=getSmsSession(_0xb6a441,_0xb1ca06);const _0x5b789f=await ensureCallScriptLoaded();if(!_0x5b789f||typeof initSmsWithAI!==_0x28683b(0x48c)){console[_0x28683b(0x56c)](_0x28683b(0x17b)),showIslandNotification('错误',_0x28683b(0x18b),_0x28683b(0x56c));return;}const _0x216bd3=currentContactData&&normalizeId(currentContactData[_0x28683b(0x4ea)])===normalizeId(_0xb6a441)?currentContactData:{'phoneNumber':_0xb6a441,'characterName':_0xb1ca06};await initSmsWithAI(_0xb6a441,_0x216bd3);const _0x27054b=Array[_0x28683b(0x851)](currentSmsData[_0x28683b(0x1eb)])&&currentSmsData[_0x28683b(0x1eb)][_0x28683b(0x6ea)]>0x0,_0x23694c=typeof isSmsSessionBusy===_0x28683b(0x48c)?isSmsSessionBusy(_0xb6a441):![];if(!_0x27054b||!_0x23694c)await loadSmsHistory(_0xb6a441);else typeof setSmsSessionMessages===_0x28683b(0x48c)&&setSmsSessionMessages(_0xb6a441,currentSmsData[_0x28683b(0x1eb)][_0x28683b(0x962)](_0x1efa37=>({'role':_0x1efa37[_0x28683b(0x58e)],'content':_0x1efa37[_0x28683b(0x632)],'timestamp':_0x1efa37['timestamp']})));const _0x29761d=document[_0x28683b(0x761)]('smsContactName'),_0x26c420=document[_0x28683b(0x761)](_0x28683b(0x86c)),_0x140e97=getCurrentSmsCharacterName(_0xb6a441)||_0xb1ca06||_0xb6a441;if(_0x29761d)_0x29761d['textContent']=_0x140e97;if(_0x26c420)_0x26c420['textContent']=_0x28683b(0x626);renderSmsMessages();const _0x25fe65=document['getElementById'](_0x28683b(0x3ad));_0x25fe65&&_0x25fe65[_0x28683b(0x421)]['add']('active'),setTimeout(()=>{const _0x334c6d=_0x28683b,_0x2d0ab0=document[_0x334c6d(0x761)](_0x334c6d(0x3d3));if(_0x2d0ab0)_0x2d0ab0['focus']();},0x12c);}async function closeSmsDetail(){const _0x3a4866=_0x28e739;console[_0x3a4866(0x41f)](_0x3a4866(0x840),smsOpenedFrom);currentSmsData[_0x3a4866(0x4ea)]&&currentSmsData[_0x3a4866(0x1eb)][_0x3a4866(0x6ea)]>0x0&&await saveSmsHistory(currentSmsData['phoneNumber'],currentSmsData['messages']);const _0x1f94e1=document[_0x3a4866(0x761)](_0x3a4866(0x3ad));_0x1f94e1&&_0x1f94e1[_0x3a4866(0x421)]['remove'](_0x3a4866(0x525));if(smsEditMode){smsEditMode=![],smsSelectedMessages[_0x3a4866(0x886)]();const _0x3587b9=document['getElementById'](_0x3a4866(0x56f)),_0x2e6470=document[_0x3a4866(0x761)]('smsEditToolbar'),_0x153b99=document[_0x3a4866(0x768)](_0x3a4866(0x74f)),_0x1e3013=document[_0x3a4866(0x761)]('smsMessagesArea');if(_0x3587b9)_0x3587b9[_0x3a4866(0x7dc)]=_0x3a4866(0x652);if(_0x2e6470)_0x2e6470[_0x3a4866(0x577)][_0x3a4866(0x475)]=_0x3a4866(0x562);if(_0x153b99)_0x153b99[_0x3a4866(0x577)]['display']='flex';if(_0x1e3013)_0x1e3013[_0x3a4866(0x421)]['remove']('sms-edit-mode');}hideSmsTyping(),smsOpenedFrom===_0x3a4866(0x3f0)&&(console[_0x3a4866(0x41f)](_0x3a4866(0x711)),await openImessage()),smsOpenedFrom=_0x3a4866(0x518);}function renderSmsMessages(){const _0x122e7b=_0x28e739,_0x10bd03=document[_0x122e7b(0x761)]('smsMessagesArea'),_0x45bf2b=document['getElementById']('smsEmptyState'),_0x51500e=document[_0x122e7b(0x761)](_0x122e7b(0x216));if(!_0x10bd03)return;const _0x30d454=_0x10bd03[_0x122e7b(0x42c)](_0x122e7b(0x530));_0x30d454[_0x122e7b(0x7b6)](_0x1cd206=>_0x1cd206[_0x122e7b(0x403)]());if(currentSmsData['messages'][_0x122e7b(0x6ea)]===0x0){if(_0x45bf2b)_0x45bf2b[_0x122e7b(0x577)][_0x122e7b(0x475)]=_0x122e7b(0x439);return;}if(_0x45bf2b)_0x45bf2b['style'][_0x122e7b(0x475)]=_0x122e7b(0x562);let _0x2ff828=null;currentSmsData['messages'][_0x122e7b(0x7b6)]((_0x48c6cb,_0x3ecc6e)=>{const _0x451f70=_0x122e7b,_0x43f24b=new Date(_0x48c6cb[_0x451f70(0x407)]),_0x395f84=formatSmsDate(_0x43f24b);if(_0x395f84!==_0x2ff828){const _0x5913b6=document[_0x451f70(0x5e5)](_0x451f70(0x6a4));_0x5913b6[_0x451f70(0x51f)]=_0x451f70(0x2c2),_0x5913b6['innerHTML']='<div\x20class=\x22sms-date-label\x22>'+_0x395f84+_0x451f70(0x611),_0x10bd03[_0x451f70(0x49c)](_0x5913b6,_0x51500e),_0x2ff828=_0x395f84;}const _0x2b2e92=document[_0x451f70(0x5e5)](_0x451f70(0x6a4));_0x2b2e92[_0x451f70(0x51f)]=_0x451f70(0x70c)+(_0x48c6cb[_0x451f70(0x58e)]===_0x451f70(0x8dd)?_0x451f70(0x8dd):'other'),_0x2b2e92[_0x451f70(0x672)][_0x451f70(0x6c0)]=_0x3ecc6e;let _0x1998d7='';if(smsEditMode){const _0x5ef45b=smsSelectedMessages['has'](_0x3ecc6e);_0x1998d7+=_0x451f70(0x3f5)+(_0x5ef45b?_0x451f70(0x657):'')+'\x22\x20onclick=\x22toggleSmsMessageSelection('+_0x3ecc6e+')\x22></div>';}_0x1998d7+=_0x451f70(0x7ce),_0x1998d7+=_0x451f70(0x227)+escapeHtml(_0x48c6cb[_0x451f70(0x632)])+_0x451f70(0x611),_0x1998d7+=_0x451f70(0x93c)+formatSmsTime(_0x43f24b)+_0x451f70(0x611),_0x48c6cb['role']===_0x451f70(0x8dd)&&_0x3ecc6e===currentSmsData[_0x451f70(0x1eb)][_0x451f70(0x6ea)]-0x1&&(_0x1998d7+=_0x451f70(0x831)),_0x1998d7+=_0x451f70(0x611),_0x2b2e92[_0x451f70(0x5b8)]=_0x1998d7,_0x10bd03['insertBefore'](_0x2b2e92,_0x51500e);}),scrollSmsToBottom();}function addSmsMessage(_0x2474ce,_0x1a9097=_0x28e739(0x8dd),_0x3d119e=![]){const _0x2b0534=_0x28e739,_0x5c858b={'content':_0x2474ce,'role':_0x1a9097,'timestamp':Date[_0x2b0534(0x2cb)](),'sent':_0x3d119e};return currentSmsData[_0x2b0534(0x1eb)][_0x2b0534(0x2c4)](_0x5c858b),appendSmsMessageToUI(_0x5c858b,currentSmsData[_0x2b0534(0x1eb)][_0x2b0534(0x6ea)]-0x1),_0x5c858b;}function appendSmsMessageToUI(_0x41c430,_0x50d443){const _0x45122c=_0x28e739,_0xfdf8f7=document[_0x45122c(0x761)](_0x45122c(0x509)),_0xf4abc3=document[_0x45122c(0x761)]('smsEmptyState'),_0x347817=document[_0x45122c(0x761)](_0x45122c(0x216));if(!_0xfdf8f7)return;if(_0xf4abc3)_0xf4abc3[_0x45122c(0x577)][_0x45122c(0x475)]='none';const _0x53e53d=new Date(_0x41c430[_0x45122c(0x407)]),_0x53aed8=formatSmsDate(_0x53e53d),_0x2b5133=_0xfdf8f7[_0x45122c(0x42c)](_0x45122c(0x797)),_0x854e2b=_0x2b5133[_0x2b5133['length']-0x1],_0x45a9c6=_0x854e2b?_0x854e2b['querySelector']('.sms-date-label')[_0x45122c(0x7dc)]:null;if(_0x53aed8!==_0x45a9c6){const _0x1d7b1d=document[_0x45122c(0x5e5)]('div');_0x1d7b1d['className']=_0x45122c(0x2c2),_0x1d7b1d[_0x45122c(0x5b8)]=_0x45122c(0x82e)+_0x53aed8+_0x45122c(0x611),_0xfdf8f7[_0x45122c(0x49c)](_0x1d7b1d,_0x347817);}const _0x4c21ee=document[_0x45122c(0x5e5)](_0x45122c(0x6a4));_0x4c21ee[_0x45122c(0x51f)]=_0x45122c(0x70c)+(_0x41c430[_0x45122c(0x58e)]===_0x45122c(0x8dd)?_0x45122c(0x8dd):_0x45122c(0x4a8)),_0x4c21ee[_0x45122c(0x672)]['index']=_0x50d443;let _0x2ddf9d='';if(smsEditMode){const _0x257313=smsSelectedMessages[_0x45122c(0x345)](_0x50d443);_0x2ddf9d+=_0x45122c(0x3f5)+(_0x257313?_0x45122c(0x657):'')+_0x45122c(0x758)+_0x50d443+')\x22></div>';}_0x2ddf9d+=_0x45122c(0x7ce),_0x2ddf9d+='<div\x20class=\x22sms-bubble\x22>'+escapeHtml(_0x41c430[_0x45122c(0x632)])+_0x45122c(0x611),_0x2ddf9d+=_0x45122c(0x93c)+formatSmsTime(_0x53e53d)+_0x45122c(0x611),_0x41c430['role']===_0x45122c(0x8dd)&&_0x50d443===currentSmsData[_0x45122c(0x1eb)]['length']-0x1&&(_0x2ddf9d+=_0x45122c(0x831)),_0x2ddf9d+=_0x45122c(0x611),_0x4c21ee[_0x45122c(0x5b8)]=_0x2ddf9d,_0x4c21ee[_0x45122c(0x577)][_0x45122c(0x88c)]='0',_0x4c21ee[_0x45122c(0x577)][_0x45122c(0x8ed)]=_0x45122c(0x445),_0xfdf8f7[_0x45122c(0x49c)](_0x4c21ee,_0x347817),requestAnimationFrame(()=>{const _0x42f0b4=_0x45122c;_0x4c21ee[_0x42f0b4(0x577)][_0x42f0b4(0x519)]=_0x42f0b4(0x47f),_0x4c21ee['style'][_0x42f0b4(0x88c)]='1',_0x4c21ee['style'][_0x42f0b4(0x8ed)]='translateY(0)';}),scrollSmsToBottom();}function addUserSmsMessage(){const _0x358557=_0x28e739,_0x2fdadc=document[_0x358557(0x761)](_0x358557(0x3d3));if(!_0x2fdadc)return;const _0x26f311=_0x2fdadc[_0x358557(0x29c)][_0x358557(0x28e)]();if(!_0x26f311)return;console[_0x358557(0x41f)](_0x358557(0x51b),_0x26f311),_0x2fdadc[_0x358557(0x29c)]='',addSmsMessage(_0x26f311,_0x358557(0x8dd),![]);}async function sendSmsToAI(){const _0x4e42dc=_0x28e739;console[_0x4e42dc(0x41f)](_0x4e42dc(0x61f));const _0x46aa32=currentSmsData[_0x4e42dc(0x1eb)][_0x4e42dc(0x911)](_0x33bf55=>_0x33bf55['role']===_0x4e42dc(0x8dd)&&_0x33bf55['sent']===![]);if(_0x46aa32[_0x4e42dc(0x6ea)]===0x0){console[_0x4e42dc(0x41f)](_0x4e42dc(0x96d));return;}console[_0x4e42dc(0x41f)]('📱\x20找到\x20'+_0x46aa32[_0x4e42dc(0x6ea)]+_0x4e42dc(0x89b));const _0x2e2ef4=currentSmsData[_0x4e42dc(0x4ea)],_0x559b7e=currentSmsData[_0x4e42dc(0x622)],_0x58a1c2=currentSmsData[_0x4e42dc(0x1eb)],_0x3eaf8b=typeof currentSmsCharacterId!==_0x4e42dc(0x714)?currentSmsCharacterId:'',_0x2b70f7=typeof getCurrentSmsCharacterName===_0x4e42dc(0x48c)?getCurrentSmsCharacterName(_0x2e2ef4):_0x559b7e||_0x2e2ef4||'角色',_0x2fcef7=()=>isSmsDetailActive()&&isSameSmsSession(_0x2e2ef4);_0x2fcef7()&&showSmsTyping();try{const _0x1f9f57=await sendMultipleSmsWithAI(_0x46aa32,{'phoneNumber':_0x2e2ef4});_0x46aa32[_0x4e42dc(0x7b6)](_0xfd6c3b=>{_0xfd6c3b['sent']=!![];});_0x2fcef7()&&hideSmsTyping();if(_0x1f9f57&&_0x1f9f57[_0x4e42dc(0x1eb)]&&_0x1f9f57[_0x4e42dc(0x1eb)]['length']>0x0){const _0x5416b6=_0x2fcef7();if(_0x5416b6){const _0x2cae8f=getCurrentSmsCharacterName(_0x2e2ef4),_0x49941f=document['getElementById']('smsContactName');_0x49941f&&_0x2cae8f&&_0x2cae8f!==_0x4e42dc(0x2e9)&&(_0x49941f[_0x4e42dc(0x7dc)]=_0x2cae8f);}for(let _0x50f7d3=0x0;_0x50f7d3<_0x1f9f57[_0x4e42dc(0x1eb)][_0x4e42dc(0x6ea)];_0x50f7d3++){const _0xb015d8=_0x1f9f57['messages'][_0x50f7d3];_0x50f7d3>0x0&&await new Promise(_0x18e4d4=>setTimeout(_0x18e4d4,0x12c+Math[_0x4e42dc(0x266)]()*0x1f4));const _0x23a1a6={'content':_0xb015d8,'role':_0x4e42dc(0x1c7),'timestamp':Date[_0x4e42dc(0x2cb)](),'sent':!![]};_0x58a1c2[_0x4e42dc(0x2c4)](_0x23a1a6),_0x5416b6&&appendSmsMessageToUI(_0x23a1a6,_0x58a1c2[_0x4e42dc(0x6ea)]-0x1);}_0x2e2ef4&&await saveSmsHistory(_0x2e2ef4,_0x58a1c2);const _0xb6d0b5=_0x1f9f57['messages'][_0x1f9f57[_0x4e42dc(0x1eb)]['length']-0x1],_0x38411f=_0x5416b6?typeof getCurrentSmsCharacterName==='function'?getCurrentSmsCharacterName(_0x2e2ef4):_0x559b7e||'角色':_0x2b70f7||_0x559b7e||_0x2e2ef4||'角色';await showSmsReplyPhoneStyleNotification({'characterId':_0x3eaf8b||'','phoneNumber':_0x2e2ef4||'','displayName':_0x38411f,'previewText':String(_0xb6d0b5||'')[_0x4e42dc(0x28e)](),'messages':_0x58a1c2});}}catch(_0x2214ad){console[_0x4e42dc(0x56c)](_0x4e42dc(0x269),_0x2214ad),_0x2fcef7()&&hideSmsTyping(),showIslandNotification('短信',_0x4e42dc(0x745),_0x4e42dc(0x56c));}}async function smsRegenerateAIResponse(){const _0x5d2229=_0x28e739;try{console['log']('📱\x20[SMS重回]\x20开始重新生成AI回复...');if(!currentSmsData[_0x5d2229(0x4ea)]){showIslandNotification('错误',_0x5d2229(0x885),'info');return;}if(!currentSmsData[_0x5d2229(0x1eb)]||currentSmsData[_0x5d2229(0x1eb)]['length']===0x0){showIslandNotification('提示',_0x5d2229(0x8b7),'info');return;}let _0x3ad092=-0x1;for(let _0x4befc6=currentSmsData[_0x5d2229(0x1eb)]['length']-0x1;_0x4befc6>=0x0;_0x4befc6--){const _0x198888=currentSmsData['messages'][_0x4befc6];if(_0x198888[_0x5d2229(0x58e)]===_0x5d2229(0x8dd)){_0x3ad092=_0x4befc6;break;}}if(_0x3ad092===-0x1){showIslandNotification('提示',_0x5d2229(0x5a5),_0x5d2229(0x537));return;}if(_0x3ad092===currentSmsData[_0x5d2229(0x1eb)]['length']-0x1){showIslandNotification('提示',_0x5d2229(0x198),'info');return;}const _0x247b63=[];for(let _0x1df7d5=_0x3ad092+0x1;_0x1df7d5<currentSmsData[_0x5d2229(0x1eb)][_0x5d2229(0x6ea)];_0x1df7d5++){const _0x317267=currentSmsData[_0x5d2229(0x1eb)][_0x1df7d5];(_0x317267[_0x5d2229(0x58e)]===_0x5d2229(0x1c7)||_0x317267[_0x5d2229(0x58e)]===_0x5d2229(0x887))&&_0x247b63[_0x5d2229(0x2c4)](_0x317267);}console[_0x5d2229(0x41f)](_0x5d2229(0x612)+_0x247b63['length']+_0x5d2229(0x95c));if(_0x247b63[_0x5d2229(0x6ea)]===0x0){showIslandNotification('提示',_0x5d2229(0x198),_0x5d2229(0x537));return;}currentSmsData['messages']=currentSmsData[_0x5d2229(0x1eb)]['slice'](0x0,_0x3ad092+0x1),console['log']('📱\x20[SMS重回]\x20删除后的消息长度:',currentSmsData[_0x5d2229(0x1eb)][_0x5d2229(0x6ea)]);typeof smsMessages!==_0x5d2229(0x714)&&(smsMessages[_0x5d2229(0x6ea)]=0x0,currentSmsData[_0x5d2229(0x1eb)][_0x5d2229(0x7b6)](_0x1c4f59=>{const _0x3062d3=_0x5d2229;smsMessages['push']({'role':_0x1c4f59[_0x3062d3(0x58e)],'content':_0x1c4f59['content'],'timestamp':_0x1c4f59[_0x3062d3(0x407)]});}),console[_0x5d2229(0x41f)](_0x5d2229(0x963),smsMessages[_0x5d2229(0x6ea)],'条'));currentSmsData[_0x5d2229(0x4ea)]&&await saveSmsHistory(currentSmsData[_0x5d2229(0x4ea)],currentSmsData[_0x5d2229(0x1eb)]);renderSmsMessages(),showIslandNotification('重回',_0x5d2229(0x90c)+_0x247b63[_0x5d2229(0x6ea)]+_0x5d2229(0x743),_0x5d2229(0x537)),vibrateDevice(),showSmsTyping();const _0x2e5a8b=currentSmsData[_0x5d2229(0x1eb)][_0x3ad092];if(_0x2e5a8b){const _0x3e164c={'content':_0x2e5a8b['content'],'role':_0x5d2229(0x8dd),'timestamp':_0x2e5a8b[_0x5d2229(0x407)],'sent':![]};if(typeof smsMessages!==_0x5d2229(0x714)&&smsMessages['length']>0x0){const _0x2a29a6=smsMessages[smsMessages['length']-0x1];_0x2a29a6[_0x5d2229(0x58e)]==='user'&&_0x2a29a6[_0x5d2229(0x632)]===_0x2e5a8b['content']&&(smsMessages[_0x5d2229(0x50a)](),console[_0x5d2229(0x41f)](_0x5d2229(0x69e)));}const _0x5026c1=await sendMultipleSmsWithAI([_0x3e164c],{'phoneNumber':currentSmsData['phoneNumber']});hideSmsTyping();if(_0x5026c1&&_0x5026c1['messages']&&_0x5026c1[_0x5d2229(0x1eb)][_0x5d2229(0x6ea)]>0x0){const _0x1850c1=getCurrentSmsCharacterName(currentSmsData[_0x5d2229(0x4ea)]),_0x37638f=document[_0x5d2229(0x761)](_0x5d2229(0x861));_0x37638f&&_0x1850c1&&_0x1850c1!==_0x5d2229(0x2e9)&&(_0x37638f[_0x5d2229(0x7dc)]=_0x1850c1);for(let _0x28b1e3=0x0;_0x28b1e3<_0x5026c1[_0x5d2229(0x1eb)]['length'];_0x28b1e3++){const _0x53f744=_0x5026c1[_0x5d2229(0x1eb)][_0x28b1e3];_0x28b1e3>0x0&&await new Promise(_0x28253d=>setTimeout(_0x28253d,0x12c+Math[_0x5d2229(0x266)]()*0x1f4)),addSmsMessage(_0x53f744,_0x5d2229(0x1c7),!![]);}currentSmsData['phoneNumber']&&await saveSmsHistory(currentSmsData[_0x5d2229(0x4ea)],currentSmsData[_0x5d2229(0x1eb)]),console[_0x5d2229(0x41f)](_0x5d2229(0x6a5),_0x5026c1[_0x5d2229(0x1eb)]['length'],'条');}else showIslandNotification('提示',_0x5d2229(0x5d2),_0x5d2229(0x537));}}catch(_0x12890b){console[_0x5d2229(0x56c)](_0x5d2229(0x682),_0x12890b),hideSmsTyping(),showIslandNotification('错误',_0x5d2229(0x686)+_0x12890b[_0x5d2229(0x918)],_0x5d2229(0x537));}}function toggleSmsEditMode(){const _0x35c4d6=_0x28e739;smsEditMode=!smsEditMode;const _0xcdf284=document[_0x35c4d6(0x761)]('smsEditBtn'),_0x47c977=document[_0x35c4d6(0x761)]('smsEditToolbar'),_0x35873e=document[_0x35c4d6(0x768)](_0x35c4d6(0x74f)),_0x2903b2=document['getElementById'](_0x35c4d6(0x509));if(smsEditMode){if(_0xcdf284)_0xcdf284[_0x35c4d6(0x7dc)]='完成';if(_0x47c977)_0x47c977[_0x35c4d6(0x577)][_0x35c4d6(0x475)]=_0x35c4d6(0x439);if(_0x35873e)_0x35873e[_0x35c4d6(0x577)][_0x35c4d6(0x475)]='none';if(_0x2903b2)_0x2903b2[_0x35c4d6(0x421)][_0x35c4d6(0x5e3)](_0x35c4d6(0x590));smsSelectedMessages['clear'](),console[_0x35c4d6(0x41f)](_0x35c4d6(0x4f8));}else{if(_0xcdf284)_0xcdf284[_0x35c4d6(0x7dc)]=_0x35c4d6(0x652);if(_0x47c977)_0x47c977[_0x35c4d6(0x577)][_0x35c4d6(0x475)]='none';if(_0x35873e)_0x35873e['style'][_0x35c4d6(0x475)]=_0x35c4d6(0x439);if(_0x2903b2)_0x2903b2[_0x35c4d6(0x421)][_0x35c4d6(0x403)]('sms-edit-mode');smsSelectedMessages[_0x35c4d6(0x886)](),console[_0x35c4d6(0x41f)](_0x35c4d6(0x3ca));}renderSmsMessages(),updateSmsEditToolbar();}function toggleSmsMessageSelection(_0x2c011c){const _0x4ee978=_0x28e739;if(!smsEditMode)return;smsSelectedMessages[_0x4ee978(0x345)](_0x2c011c)?smsSelectedMessages[_0x4ee978(0x6c2)](_0x2c011c):smsSelectedMessages[_0x4ee978(0x5e3)](_0x2c011c);console[_0x4ee978(0x41f)]('📱\x20已选择消息:',Array[_0x4ee978(0x822)](smsSelectedMessages));const _0x44f34e=document['getElementById'](_0x4ee978(0x509));if(_0x44f34e){const _0x28ff31=_0x44f34e[_0x4ee978(0x768)](_0x4ee978(0x3ef)+_0x2c011c+'\x22]');if(_0x28ff31){const _0x243cdd=_0x28ff31['querySelector']('.sms-message-checkbox');_0x243cdd&&(smsSelectedMessages[_0x4ee978(0x345)](_0x2c011c)?_0x243cdd[_0x4ee978(0x421)][_0x4ee978(0x5e3)](_0x4ee978(0x657)):_0x243cdd[_0x4ee978(0x421)][_0x4ee978(0x403)](_0x4ee978(0x657)));}}updateSmsEditToolbar();}function smsSelectAll(){const _0x4a49f2=_0x28e739;if(!smsEditMode)return;const _0x582850=currentSmsData[_0x4a49f2(0x1eb)][_0x4a49f2(0x6ea)];if(smsSelectedMessages[_0x4a49f2(0x2da)]===_0x582850)smsSelectedMessages['clear'](),console['log'](_0x4a49f2(0x411));else{smsSelectedMessages[_0x4a49f2(0x886)]();for(let _0x5c4a85=0x0;_0x5c4a85<_0x582850;_0x5c4a85++){smsSelectedMessages['add'](_0x5c4a85);}console[_0x4a49f2(0x41f)]('📱\x20全选消息:',smsSelectedMessages['size'],'条');}renderSmsMessages(),updateSmsEditToolbar();}function updateSmsEditToolbar(){const _0x4e93b3=_0x28e739;if(!smsEditMode)return;const _0x53f97f=document[_0x4e93b3(0x761)](_0x4e93b3(0x8bf)),_0xe9f65c=document[_0x4e93b3(0x761)](_0x4e93b3(0x239)),_0x280119=document[_0x4e93b3(0x761)](_0x4e93b3(0x26a)),_0xe951f5=smsSelectedMessages[_0x4e93b3(0x2da)],_0x3d2f30=currentSmsData[_0x4e93b3(0x1eb)][_0x4e93b3(0x6ea)];if(_0x53f97f){const _0x14e8ad=_0x53f97f[_0x4e93b3(0x768)](_0x4e93b3(0x221));_0x14e8ad&&(_0x14e8ad[_0x4e93b3(0x7dc)]=_0xe951f5===_0x3d2f30?_0x4e93b3(0x8bd):'全选');}_0xe9f65c&&(_0xe9f65c[_0x4e93b3(0x8f5)]=_0xe951f5===0x0),_0x280119&&(_0x280119[_0x4e93b3(0x7dc)]=_0xe951f5>0x0?'删除\x20('+_0xe951f5+')':'删除');}async function smsDeleteSelected(){const _0x5c37b4=_0x28e739;if(!smsEditMode||smsSelectedMessages[_0x5c37b4(0x2da)]===0x0)return;const _0x543110=smsSelectedMessages[_0x5c37b4(0x2da)];if(!confirm(_0x5c37b4(0x937)+_0x543110+_0x5c37b4(0x860)))return;try{console[_0x5c37b4(0x41f)](_0x5c37b4(0x3b0),_0x543110,_0x5c37b4(0x35e));const _0x2b861b=Array[_0x5c37b4(0x822)](smsSelectedMessages)[_0x5c37b4(0x8da)]((_0x49d0ba,_0x393645)=>_0x393645-_0x49d0ba);_0x2b861b['forEach'](_0x16b4d2=>{const _0xd9979d=_0x5c37b4;_0x16b4d2>=0x0&&_0x16b4d2<currentSmsData[_0xd9979d(0x1eb)]['length']&&currentSmsData[_0xd9979d(0x1eb)][_0xd9979d(0x825)](_0x16b4d2,0x1);}),console[_0x5c37b4(0x41f)]('📱\x20[SMS删除]\x20删除后剩余消息:',currentSmsData[_0x5c37b4(0x1eb)]['length'],'条'),typeof smsMessages!=='undefined'&&(smsMessages['length']=0x0,currentSmsData[_0x5c37b4(0x1eb)][_0x5c37b4(0x7b6)](_0x59055c=>{const _0x381ef4=_0x5c37b4;smsMessages[_0x381ef4(0x2c4)]({'role':_0x59055c[_0x381ef4(0x58e)],'content':_0x59055c[_0x381ef4(0x632)],'timestamp':_0x59055c[_0x381ef4(0x407)]});}),console[_0x5c37b4(0x41f)](_0x5c37b4(0x709),smsMessages[_0x5c37b4(0x6ea)],'条')),currentSmsData[_0x5c37b4(0x4ea)]&&(await saveSmsHistory(currentSmsData['phoneNumber'],currentSmsData[_0x5c37b4(0x1eb)]),console[_0x5c37b4(0x41f)](_0x5c37b4(0x59d))),smsSelectedMessages[_0x5c37b4(0x886)](),renderSmsMessages(),currentSmsData['messages'][_0x5c37b4(0x6ea)]===0x0?toggleSmsEditMode():updateSmsEditToolbar(),showIslandNotification('删除',_0x5c37b4(0x84f)+_0x543110+_0x5c37b4(0x6ce),_0x5c37b4(0x39d)),vibrateDevice();}catch(_0x5c771c){console[_0x5c37b4(0x56c)](_0x5c37b4(0x531),_0x5c771c),showIslandNotification('错误','删除失败:\x20'+_0x5c771c[_0x5c37b4(0x918)],_0x5c37b4(0x56c));}}function handleSmsKeyPress(_0x49a1d3){const _0x57ad45=_0x28e739;_0x49a1d3[_0x57ad45(0x5f8)]==='Enter'&&!_0x49a1d3[_0x57ad45(0x827)]&&(_0x49a1d3[_0x57ad45(0x442)](),addUserSmsMessage());}function formatSmsDate(_0xc1a0a6){const _0x250ebf=_0x28e739,_0x1d037a=new Date(),_0x19272a=new Date(_0x1d037a[_0x250ebf(0x18f)](),_0x1d037a['getMonth'](),_0x1d037a[_0x250ebf(0x8b9)]()),_0x41caee=new Date(_0x19272a['getTime']()-0x18*0x3c*0x3c*0x3e8),_0x3a4e9b=new Date(_0xc1a0a6[_0x250ebf(0x18f)](),_0xc1a0a6[_0x250ebf(0x36d)](),_0xc1a0a6[_0x250ebf(0x8b9)]());if(_0x3a4e9b[_0x250ebf(0x278)]()===_0x19272a[_0x250ebf(0x278)]())return'Today\x20'+formatSmsTime(_0xc1a0a6);else{if(_0x3a4e9b[_0x250ebf(0x278)]()===_0x41caee[_0x250ebf(0x278)]())return _0x250ebf(0x2fb)+formatSmsTime(_0xc1a0a6);else{const _0x275c1c={'month':_0x250ebf(0x2ff),'day':_0x250ebf(0x4eb),'year':_0x250ebf(0x4eb)};return _0xc1a0a6[_0x250ebf(0x180)]('en-US',_0x275c1c)+'\x20'+formatSmsTime(_0xc1a0a6);}}}function formatSmsTime(_0x60485b){const _0x2ec829=_0x28e739;return _0x60485b[_0x2ec829(0x1b8)](_0x2ec829(0x6f0),{'hour':_0x2ec829(0x4eb),'minute':'2-digit','hour12':!![]});}function scrollSmsToBottom(){const _0x205930=_0x28e739,_0x1e4abc=document[_0x205930(0x761)]('smsMessagesArea');_0x1e4abc&&(_0x1e4abc[_0x205930(0x7ff)]=_0x1e4abc[_0x205930(0x3d5)]);}function smsCallContact(){const _0x28ed2e=_0x28e739;if(!currentSmsData[_0x28ed2e(0x4ea)])return;console[_0x28ed2e(0x41f)](_0x28ed2e(0x6c9),currentSmsData[_0x28ed2e(0x4ea)]);const _0x467b1b=currentSmsData[_0x28ed2e(0x4ea)];closeSmsDetail(),phoneCurrentNumber=_0x467b1b,updatePhoneDisplay(),switchPhoneTab(_0x28ed2e(0x72f));}function smsFaceTimeContact(){const _0x28a069=_0x28e739;if(!currentSmsData[_0x28a069(0x4ea)])return;console['log']('📱\x20SMS\x20FaceTime:',currentSmsData['phoneNumber']),showIslandNotification(_0x28a069(0x640),'功能开发中...',_0x28a069(0x537));}async function smsViewContact(){const _0x3986a9=_0x28e739;if(!currentSmsData[_0x3986a9(0x4ea)])return;console[_0x3986a9(0x41f)](_0x3986a9(0x52b),currentSmsData[_0x3986a9(0x4ea)]);let _0x3af0cb=null;try{const _0x50e4ed=normalizeId(currentSmsData[_0x3986a9(0x4ea)]),_0x2e833a=await db['contacts'][_0x3986a9(0x309)](_0x50e4ed);if(_0x2e833a&&_0x2e833a['strangerPersona'])_0x3af0cb=_0x2e833a[_0x3986a9(0x3a5)],console[_0x3986a9(0x41f)](_0x3986a9(0x702),_0x3af0cb[_0x3986a9(0x76a)],'|',_0x3af0cb[_0x3986a9(0x581)]);else{const _0x557661=await db[_0x3986a9(0x698)]['toArray'](),_0x4085e4=_0x557661[_0x3986a9(0x30c)](_0x10bba8=>normalizeId(_0x10bba8[_0x3986a9(0x4ea)])===_0x50e4ed&&_0x10bba8['isRandomSms']===!![]&&_0x10bba8['randomSmsPersona']);_0x4085e4&&_0x4085e4[_0x3986a9(0x7aa)]?(_0x3af0cb=_0x4085e4[_0x3986a9(0x7aa)],console[_0x3986a9(0x41f)](_0x3986a9(0x62a),_0x3af0cb[_0x3986a9(0x76a)],'|',_0x3af0cb[_0x3986a9(0x581)])):console[_0x3986a9(0x41f)](_0x3986a9(0x396));}}catch(_0x1b5b6f){console['error']('❌\x20读取随机短信人设失败:',_0x1b5b6f);}newContactTempData={'phoneNumber':currentSmsData[_0x3986a9(0x4ea)],'customAvatar':null,'characterId':null,'characterAvatar':null,'strangerPersona':_0x3af0cb,'isStranger':!!_0x3af0cb},showNewContactModal();}function smsAttachImage(){const _0x5a8f95=_0x28e739;console[_0x5a8f95(0x41f)](_0x5a8f95(0x452)),showIslandNotification(_0x5a8f95(0x800),_0x5a8f95(0x8fe),'info');}function showSmsTyping(){const _0x72c3e2=_0x28e739,_0x3130ad=document['getElementById'](_0x72c3e2(0x216));if(_0x3130ad)_0x3130ad[_0x72c3e2(0x421)][_0x72c3e2(0x5e3)](_0x72c3e2(0x525));scrollSmsToBottom();}function hideSmsTyping(){const _0x32c5d8=_0x28e739,_0x15f08d=document[_0x32c5d8(0x761)](_0x32c5d8(0x216));if(_0x15f08d)_0x15f08d[_0x32c5d8(0x421)][_0x32c5d8(0x403)]('active');}function escapeHtml(_0x3f19dd){const _0x427e27=_0x28e739,_0x33fcdc=document['createElement'](_0x427e27(0x6a4));return _0x33fcdc['textContent']=_0x3f19dd,_0x33fcdc['innerHTML'];}async function loadSmsHistory(_0x3852d4){const _0x41d15d=_0x28e739;try{console['log']('📱\x20加载短信历史:',_0x3852d4);const _0x3b691d=normalizeId(_0x3852d4),_0x45159d='sms_'+_0x3b691d,_0x3b8641=await db['chatMessages'][_0x41d15d(0x5fd)](),_0x1fa8e3=_0x3b8641[_0x41d15d(0x911)](_0x9a1974=>{const _0x5eb96c=_0x41d15d,_0x32e08c=normalizeId(_0x9a1974[_0x5eb96c(0x3c2)])===_0x45159d;return _0x32e08c;})['sort']((_0x6f0f2e,_0xd9e172)=>new Date(_0x6f0f2e[_0x41d15d(0x407)])[_0x41d15d(0x278)]()-new Date(_0xd9e172[_0x41d15d(0x407)])[_0x41d15d(0x278)]());console[_0x41d15d(0x41f)](_0x41d15d(0x727),_0x1fa8e3[_0x41d15d(0x6ea)],'条');const _0x234d8c=currentSmsData&&normalizeId(currentSmsData[_0x41d15d(0x4ea)]||'')===_0x3b691d;_0x234d8c&&(currentSmsData[_0x41d15d(0x1eb)][_0x41d15d(0x6ea)]=0x0);const _0x1d42cb=[];_0x1fa8e3[_0x41d15d(0x7b6)](_0x4ec483=>{const _0x1cc340=_0x41d15d,_0x4625d4=new Date(_0x4ec483['timestamp'])[_0x1cc340(0x278)]();_0x234d8c&&currentSmsData[_0x1cc340(0x1eb)][_0x1cc340(0x2c4)]({'content':_0x4ec483[_0x1cc340(0x632)],'role':_0x4ec483['role'],'timestamp':_0x4625d4,'sent':!![]}),_0x1d42cb[_0x1cc340(0x2c4)]({'role':_0x4ec483['role'],'content':_0x4ec483['content'],'timestamp':_0x4625d4});});if(typeof setSmsSessionMessages===_0x41d15d(0x48c))setSmsSessionMessages(_0x3852d4,_0x1d42cb);else _0x234d8c&&typeof smsMessages!==_0x41d15d(0x714)&&(smsMessages['length']=0x0,_0x1d42cb['forEach'](_0x3e0ddf=>smsMessages[_0x41d15d(0x2c4)]({..._0x3e0ddf})));return _0x1fa8e3;}catch(_0x13ad3c){return console['error'](_0x41d15d(0x680),_0x13ad3c),[];}}async function saveSmsHistory(_0x3bda60,_0x576e71){const _0xf17db=_0x28e739;try{console['log'](_0xf17db(0x399),_0x3bda60,_0x576e71[_0xf17db(0x6ea)],'条');const _0x2cc6a4=normalizeId(_0x3bda60),_0x3de18d=_0xf17db(0x62f)+_0x2cc6a4,_0x4a3b7b=typeof currentSmsCharacterId!==_0xf17db(0x714)?currentSmsCharacterId:_0xf17db(0x417),_0x288b2b=await db[_0xf17db(0x698)][_0xf17db(0x5fd)](),_0x390f4f=_0x288b2b[_0xf17db(0x911)](_0x3207a2=>normalizeId(_0x3207a2['sessionId'])===_0x3de18d)[_0xf17db(0x962)](_0x43d636=>_0x43d636['id']);_0x390f4f[_0xf17db(0x6ea)]>0x0&&(await db['chatMessages']['bulkDelete'](_0x390f4f),console['log'](_0xf17db(0x2c0),_0x390f4f['length'],'条'));const _0x3442b0=_0x576e71['map'](_0x5b194b=>({'characterId':normalizeId(_0x4a3b7b),'sessionId':_0x3de18d,'role':_0x5b194b[_0xf17db(0x58e)],'content':_0x5b194b[_0xf17db(0x632)],'timestamp':new Date(_0x5b194b[_0xf17db(0x407)])[_0xf17db(0x7db)](),'type':'sms'}));return await db[_0xf17db(0x698)][_0xf17db(0x57f)](_0x3442b0),console[_0xf17db(0x41f)](_0xf17db(0x33b),_0x3442b0[_0xf17db(0x6ea)],'条'),!![];}catch(_0x258d5f){return console[_0xf17db(0x56c)]('❌\x20保存短信历史失败:',_0x258d5f),![];}}function callContact(){const _0x43ead8=_0x28e739;if(!currentContactData)return;const _0x5d78e6=currentContactData['phoneNumber'];console[_0x43ead8(0x41f)](_0x43ead8(0x422),_0x5d78e6),hideContactDetail(),setTimeout(()=>{const _0x1516fa=_0x43ead8;phoneCurrentNumber=_0x5d78e6,updatePhoneDisplay(),switchPhoneTab(_0x1516fa(0x72f)),makePhoneCall();},0x190);}let newContactTempData={'phoneNumber':'','customAvatar':null,'characterId':null,'characterAvatar':null,'strangerPersona':null,'isStranger':![]};async function createNewContact(){const _0x14054b=_0x28e739;if(!currentContactData)return;console[_0x14054b(0x41f)](_0x14054b(0x6a7),currentContactData[_0x14054b(0x4ea)]),newContactTempData={'phoneNumber':currentContactData['phoneNumber'],'customAvatar':null,'characterId':currentContactData[_0x14054b(0x3ae)]||null,'characterAvatar':currentContactData[_0x14054b(0x1aa)]||null,'strangerPersona':null,'isStranger':![]};const _0x5d12f2=await db[_0x14054b(0x206)][_0x14054b(0x56a)](_0x14054b(0x4ea))[_0x14054b(0x82f)](currentContactData[_0x14054b(0x4ea)])[_0x14054b(0x71c)]()['first']();_0x5d12f2&&(console[_0x14054b(0x41f)]('📱\x20Latest\x20call\x20record:',_0x5d12f2),_0x5d12f2['isStranger']&&_0x5d12f2[_0x14054b(0x3a5)]&&(newContactTempData[_0x14054b(0x4d1)]=!![],newContactTempData[_0x14054b(0x3a5)]=_0x5d12f2[_0x14054b(0x3a5)],console[_0x14054b(0x41f)](_0x14054b(0x92d),_0x5d12f2[_0x14054b(0x3a5)])),_0x5d12f2[_0x14054b(0x3ae)]&&!newContactTempData[_0x14054b(0x3ae)]&&(newContactTempData[_0x14054b(0x3ae)]=_0x5d12f2[_0x14054b(0x3ae)]),_0x5d12f2[_0x14054b(0x1aa)]&&!newContactTempData[_0x14054b(0x1aa)]&&(newContactTempData['characterAvatar']=_0x5d12f2[_0x14054b(0x1aa)]));const _0x78cd99=await db['contacts'][_0x14054b(0x309)](currentContactData[_0x14054b(0x4ea)]);if(_0x78cd99){const _0x3058eb=_0x78cd99[_0x14054b(0x6ca)]===!![],_0x36fd8c=!!_0x78cd99[_0x14054b(0x3ae)],_0x118d0f=_0x78cd99['hiddenInContactsList']===![];if(_0x3058eb||_0x36fd8c||_0x118d0f){showIslandNotification('联系人',_0x14054b(0x97d),_0x14054b(0x537));return;}!newContactTempData[_0x14054b(0x4d1)]&&_0x78cd99[_0x14054b(0x4d1)]&&_0x78cd99['strangerPersona']&&(newContactTempData[_0x14054b(0x4d1)]=!![],newContactTempData[_0x14054b(0x3a5)]=_0x78cd99[_0x14054b(0x3a5)]),!newContactTempData['characterAvatar']&&_0x78cd99[_0x14054b(0x691)]&&(newContactTempData[_0x14054b(0x1aa)]=_0x78cd99['contactAvatar']);}showNewContactModal();}function showNewContactModal(){const _0x4195e1=_0x28e739,_0x2c7213=document[_0x4195e1(0x761)](_0x4195e1(0x5f4));if(!_0x2c7213)return;const _0x5649a6=document[_0x4195e1(0x761)]('newContactPhone');_0x5649a6&&(_0x5649a6['value']=formatPhoneNumberDisplay(newContactTempData[_0x4195e1(0x4ea)]));const _0x550709=document[_0x4195e1(0x761)](_0x4195e1(0x22f));_0x550709&&(_0x550709[_0x4195e1(0x29c)]='',currentContactData&&currentContactData['characterName']&&!newContactTempData['isStranger']&&(_0x550709[_0x4195e1(0x29c)]=currentContactData[_0x4195e1(0x27f)]));const _0x5868f7=document[_0x4195e1(0x761)](_0x4195e1(0x3c1));if(_0x5868f7){if(newContactTempData[_0x4195e1(0x1aa)])_0x5868f7[_0x4195e1(0x5b8)]='<img\x20src=\x22'+newContactTempData[_0x4195e1(0x1aa)]+_0x4195e1(0x647);else{if(newContactTempData[_0x4195e1(0x4d1)]&&newContactTempData['strangerPersona']){const _0x5cef69=newContactTempData[_0x4195e1(0x3a5)]['name']||'?',_0x4c3e80=_0x5cef69[_0x4195e1(0x5ed)](0x0);_0x5868f7[_0x4195e1(0x5b8)]=_0x4c3e80;}else _0x5868f7[_0x4195e1(0x5b8)]=_0x4195e1(0x5d3);}}const _0x4573db=document[_0x4195e1(0x761)](_0x4195e1(0x69b)),_0x25b608=document['getElementById'](_0x4195e1(0x88a)),_0x1c28a9=document[_0x4195e1(0x761)](_0x4195e1(0x561)),_0xeabe07=document['getElementById']('newContactCharacterName');if(newContactTempData['isStranger']&&newContactTempData[_0x4195e1(0x3a5)]){const _0x21c93a=newContactTempData[_0x4195e1(0x3a5)];_0x4573db&&_0x25b608&&(_0x4573db[_0x4195e1(0x577)][_0x4195e1(0x475)]=_0x4195e1(0x78e),_0x25b608['value']=_0x21c93a[_0x4195e1(0x76a)]||'未知');if(_0x1c28a9)_0x1c28a9['style'][_0x4195e1(0x475)]=_0x4195e1(0x562);}else{if(newContactTempData[_0x4195e1(0x3ae)]){if(_0x4573db)_0x4573db[_0x4195e1(0x577)][_0x4195e1(0x475)]=_0x4195e1(0x562);_0x1c28a9&&_0xeabe07&&(_0x1c28a9[_0x4195e1(0x577)][_0x4195e1(0x475)]=_0x4195e1(0x78e),_0xeabe07[_0x4195e1(0x7dc)]=currentContactData&&currentContactData['characterName']||'未知角色');}else{if(_0x4573db)_0x4573db[_0x4195e1(0x577)][_0x4195e1(0x475)]=_0x4195e1(0x562);if(_0x1c28a9)_0x1c28a9[_0x4195e1(0x577)][_0x4195e1(0x475)]=_0x4195e1(0x562);}}_0x2c7213['classList']['add'](_0x4195e1(0x525));}function closeNewContactModal(){const _0xcc4dd0=_0x28e739,_0x255bee=document[_0xcc4dd0(0x761)]('newContactSheetOverlay');if(_0x255bee)_0x255bee[_0xcc4dd0(0x421)][_0xcc4dd0(0x403)](_0xcc4dd0(0x525));newContactTempData={'phoneNumber':'','customAvatar':null,'characterId':null,'characterAvatar':null,'strangerPersona':null,'isStranger':![]};}function triggerNewContactAvatarUpload(){const _0x39840c=_0x28e739,_0x5bc2eb=document[_0x39840c(0x761)](_0x39840c(0x903));if(_0x5bc2eb)_0x5bc2eb[_0x39840c(0x7bd)]();}function handleNewContactAvatarUpload(_0x356e9e){const _0x3511ed=_0x28e739,_0x4952cf=_0x356e9e[_0x3511ed(0x6e4)][_0x3511ed(0x2f4)][0x0];if(!_0x4952cf)return;if(!_0x4952cf[_0x3511ed(0x3a3)][_0x3511ed(0x414)](_0x3511ed(0x339))){showIslandNotification('错误',_0x3511ed(0x571),_0x3511ed(0x56c));return;}if(_0x4952cf[_0x3511ed(0x2da)]>0x5*0x400*0x400){showIslandNotification('错误',_0x3511ed(0x906),_0x3511ed(0x56c));return;}const _0x4f4651=new FileReader();_0x4f4651[_0x3511ed(0x2d9)]=function(_0xaa4b71){const _0x68b164=_0x3511ed,_0x3f836f=_0xaa4b71['target'][_0x68b164(0x6c4)];newContactTempData[_0x68b164(0x438)]=_0x3f836f;const _0x3bce35=document['getElementById'](_0x68b164(0x3c1));_0x3bce35&&(_0x3bce35[_0x68b164(0x5b8)]='<img\x20src=\x22'+_0x3f836f+'\x22\x20alt=\x22头像\x22>'),console[_0x68b164(0x41f)]('📱\x20Custom\x20avatar\x20uploaded');},_0x4f4651['readAsDataURL'](_0x4952cf);}async function saveNewContact(){const _0x1c5553=_0x28e739,_0x422b03=document['getElementById'](_0x1c5553(0x22f));let _0x4a36ef=_0x422b03?_0x422b03[_0x1c5553(0x29c)]['trim']():'';if(!_0x4a36ef){if(newContactTempData['isStranger']&&newContactTempData['strangerPersona'])_0x4a36ef=newContactTempData[_0x1c5553(0x3a5)][_0x1c5553(0x76a)]||'';else currentContactData&&currentContactData[_0x1c5553(0x27f)]&&(_0x4a36ef=currentContactData[_0x1c5553(0x27f)]);if(!_0x4a36ef){showIslandNotification('错误',_0x1c5553(0x5b2),'error');return;}}try{const _0x1c6a5a={'phoneNumber':newContactTempData[_0x1c5553(0x4ea)],'nickname':_0x4a36ef,'contactAvatar':newContactTempData[_0x1c5553(0x438)]||newContactTempData['characterAvatar']||null,'characterId':newContactTempData['characterId']||null,'strangerPersona':newContactTempData[_0x1c5553(0x3a5)]||null,'isStranger':newContactTempData[_0x1c5553(0x4d1)]||![],'isUserSavedContact':!![],'hiddenInContactsList':![],'createdAt':Date[_0x1c5553(0x2cb)]()};await db['contacts']['put'](_0x1c6a5a),console[_0x1c5553(0x41f)](_0x1c5553(0x87c),_0x1c6a5a),closeNewContactModal(),await refreshContactDetailAfterSave(),showIslandNotification('成功',_0x1c5553(0x58b),_0x1c5553(0x39d));}catch(_0x1f5a2b){console['error'](_0x1c5553(0x6bc),_0x1f5a2b),showIslandNotification('错误',_0x1c5553(0x342),_0x1c5553(0x56c));}}async function refreshContactDetailAfterSave(){const _0xcf24e4=_0x28e739;if(!currentContactData)return;const _0x25b39=await db[_0xcf24e4(0x315)][_0xcf24e4(0x309)](currentContactData['phoneNumber']);if(!_0x25b39)return;currentContactData[_0xcf24e4(0x304)]=!![],currentContactData[_0xcf24e4(0x4d1)]=_0x25b39[_0xcf24e4(0x4d1)]||![],currentContactData[_0xcf24e4(0x3a5)]=_0x25b39[_0xcf24e4(0x3a5)]||null,currentContactData['characterName']=_0x25b39[_0xcf24e4(0x8e5)],currentContactData[_0xcf24e4(0x1aa)]=_0x25b39[_0xcf24e4(0x691)]||currentContactData[_0xcf24e4(0x1aa)],console[_0xcf24e4(0x41f)](_0xcf24e4(0x3e7),currentContactData[_0xcf24e4(0x4d1)]);const _0x23e97e=document[_0xcf24e4(0x761)](_0xcf24e4(0x410));_0x23e97e&&(_0x23e97e[_0xcf24e4(0x7dc)]=_0xcf24e4(0x27b));const _0x36f7ab=document[_0xcf24e4(0x761)](_0xcf24e4(0x40b));_0x36f7ab&&(_0x36f7ab['textContent']=_0x25b39['nickname']);if(_0x25b39[_0xcf24e4(0x691)]){const _0x202939=document[_0xcf24e4(0x761)](_0xcf24e4(0x178));_0x202939&&(_0x202939[_0xcf24e4(0x5b8)]=_0xcf24e4(0x6da)+_0x25b39[_0xcf24e4(0x691)]+_0xcf24e4(0x8c1));}const _0x11d86f=document[_0xcf24e4(0x761)](_0xcf24e4(0x786)),_0xfadf94=document[_0xcf24e4(0x761)]('deleteStrangerOption');_0x11d86f&&(currentContactData[_0xcf24e4(0x304)]?_0x11d86f[_0xcf24e4(0x577)][_0xcf24e4(0x475)]=_0xcf24e4(0x439):_0x11d86f[_0xcf24e4(0x577)][_0xcf24e4(0x475)]=_0xcf24e4(0x562)),_0xfadf94&&(currentContactData[_0xcf24e4(0x4d1)]&&currentContactData[_0xcf24e4(0x3a5)]?(_0xfadf94[_0xcf24e4(0x577)]['display']=_0xcf24e4(0x439),console[_0xcf24e4(0x41f)](_0xcf24e4(0x88d))):_0xfadf94[_0xcf24e4(0x577)][_0xcf24e4(0x475)]=_0xcf24e4(0x562));}function addToExistingContact(){const _0x56eaeb=_0x28e739;if(!currentContactData)return;console[_0x56eaeb(0x41f)](_0x56eaeb(0x591),currentContactData[_0x56eaeb(0x4ea)]),showIslandNotification('添加联系人','功能开发中...',_0x56eaeb(0x537));}function shareContact(){const _0x101af1=_0x28e739;if(!currentContactData)return;console[_0x101af1(0x41f)]('📱\x20Share\x20contact:',currentContactData[_0x101af1(0x4ea)]),showIslandNotification(_0x101af1(0x3bc),_0x101af1(0x8fe),_0x101af1(0x537));}function blockNumber(){const _0x58564a=_0x28e739;if(!currentContactData)return;console[_0x58564a(0x41f)](_0x58564a(0x816),currentContactData[_0x58564a(0x4ea)]),showIslandNotification('屏蔽号码','功能开发中...',_0x58564a(0x537));}async function deleteStrangerNumber(){const _0x264558=_0x28e739;if(!currentContactData)return;if(!currentContactData['isStranger']||!currentContactData[_0x264558(0x3a5)]){showIslandNotification('错误',_0x264558(0x4da),_0x264558(0x56c));return;}const _0x5caa08=currentContactData[_0x264558(0x4ea)],_0x3252d0=currentContactData['strangerPersona'][_0x264558(0x76a)]||_0x5caa08;if(!confirm('确定要删除此号码\x20\x22'+_0x5caa08+_0x264558(0x68f)+_0x3252d0+_0x264558(0x85c)))return;try{console[_0x264558(0x41f)]('📱\x20删除随机陌生人号码:',_0x5caa08,_0x264558(0x2ef),_0x3252d0);let _0x229916=0x0;await db[_0x264558(0x315)][_0x264558(0x6c2)](_0x5caa08),console['log'](_0x264558(0x469)),_0x229916++;if(db[_0x264558(0x206)]){const _0x6044be=await db[_0x264558(0x206)][_0x264558(0x5fd)](),_0x29600c=_0x6044be['filter'](_0x4df567=>normalizeId(_0x4df567[_0x264558(0x4ea)])===normalizeId(_0x5caa08));for(const _0x59e9ca of _0x29600c){await db[_0x264558(0x206)][_0x264558(0x6c2)](_0x59e9ca['id']);}console[_0x264558(0x41f)]('✅\x20已删除callRecords:\x20'+_0x29600c[_0x264558(0x6ea)]+'\x20条'),_0x229916+=_0x29600c[_0x264558(0x6ea)];}if(db[_0x264558(0x698)]){const _0x34fd96=await db[_0x264558(0x698)]['toArray'](),_0x41174b=_0x34fd96[_0x264558(0x911)](_0x5e91ab=>normalizeId(_0x5e91ab[_0x264558(0x4ea)])===normalizeId(_0x5caa08)&&(_0x5e91ab[_0x264558(0x3a3)]===_0x264558(0x8e8)||_0x5e91ab[_0x264558(0x3a3)]===_0x264558(0x257)));for(const _0x204afc of _0x41174b){await db[_0x264558(0x698)][_0x264558(0x6c2)](_0x204afc['id']);}console['log'](_0x264558(0x6cc)+_0x41174b[_0x264558(0x6ea)]+'\x20条'),_0x229916+=_0x41174b[_0x264558(0x6ea)];}hideContactDetail(),console[_0x264558(0x41f)]('🔄\x20刷新phone相关界面');typeof renderContactsList==='function'&&await renderContactsList();if(typeof loadCallRecords===_0x264558(0x48c))await loadCallRecords();else typeof renderCallRecords==='function'&&(allCallRecordsCache=(allCallRecordsCache||[])[_0x264558(0x911)](_0x362ea6=>normalizeId(_0x362ea6?.[_0x264558(0x4ea)])!==normalizeId(_0x5caa08)),await renderCallRecords());showIslandNotification(_0x264558(0x747),_0x264558(0x4d7)+_0x5caa08+_0x264558(0x50d)+_0x229916+'条）',_0x264558(0x537));}catch(_0x5a26ee){console[_0x264558(0x56c)](_0x264558(0x277),_0x5a26ee),showIslandNotification('删除失败',_0x264558(0x4fe),_0x264558(0x56c));}}async function deleteCurrentContact(){const _0x5a5648=_0x28e739;if(!currentContactData)return;if(!currentContactData[_0x5a5648(0x304)]){showIslandNotification('错误',_0x5a5648(0x1ca),_0x5a5648(0x56c));return;}const _0x3c1a04=currentContactData[_0x5a5648(0x4ea)],_0x1850bb=currentContactData[_0x5a5648(0x27f)]||_0x3c1a04;if(!confirm(_0x5a5648(0x3f4)+_0x1850bb+_0x5a5648(0x17d)))return;try{console[_0x5a5648(0x41f)](_0x5a5648(0x32c),_0x3c1a04),await db[_0x5a5648(0x315)][_0x5a5648(0x6c2)](_0x3c1a04),console[_0x5a5648(0x41f)]('✅\x20已从contacts表删除联系人'),currentContactData['isContact']=![],currentContactData['characterName']=currentContactData['records']?.[0x0]?.[_0x5a5648(0x27f)]||null;const _0x4ff842=document['getElementById'](_0x5a5648(0x786));_0x4ff842&&(_0x4ff842[_0x5a5648(0x577)][_0x5a5648(0x475)]=_0x5a5648(0x562));const _0xc5ab08=document[_0x5a5648(0x761)](_0x5a5648(0x410));if(_0xc5ab08)_0xc5ab08[_0x5a5648(0x7dc)]='未知';const _0x49a4ab=document['getElementById'](_0x5a5648(0x40b));_0x49a4ab&&!currentContactData[_0x5a5648(0x27f)]&&(_0x49a4ab[_0x5a5648(0x7dc)]=_0x5a5648(0x8a7)),console[_0x5a5648(0x41f)]('🔄\x20刷新phone-contacts页面'),setTimeout(()=>{const _0x31e1c8=_0x5a5648;typeof renderContactsList===_0x31e1c8(0x48c)&&renderContactsList(),typeof renderCallRecords===_0x31e1c8(0x48c)&&renderCallRecords();},0x12c),showIslandNotification(_0x5a5648(0x747),_0x5a5648(0x7fb)+_0x1850bb+'\x22',_0x5a5648(0x537));}catch(_0x3a72a7){console[_0x5a5648(0x56c)](_0x5a5648(0x536),_0x3a72a7),showIslandNotification(_0x5a5648(0x45a),'请重试',_0x5a5648(0x56c));}}function formatCallTime(_0x47d45b){const _0x1df6c2=_0x28e739;if(!_0x47d45b)return _0x1df6c2(0x3d2);const _0x430e3d=new Date(_0x47d45b);if(isNaN(_0x430e3d[_0x1df6c2(0x278)]()))return _0x1df6c2(0x3d2);const _0xe014=new Date(),_0x49f818=new Date(_0xe014[_0x1df6c2(0x18f)](),_0xe014[_0x1df6c2(0x36d)](),_0xe014[_0x1df6c2(0x8b9)]()),_0x5c3a28=new Date(_0x49f818);_0x5c3a28['setDate'](_0x5c3a28['getDate']()-0x1);if(_0x430e3d>=_0x49f818){const _0x32a26d=String(_0x430e3d[_0x1df6c2(0x971)]())[_0x1df6c2(0x90f)](0x2,'0'),_0x510269=String(_0x430e3d[_0x1df6c2(0x1db)]())['padStart'](0x2,'0');return _0x32a26d+':'+_0x510269;}else{if(_0x430e3d>=_0x5c3a28)return'昨天';else{const _0xd1104=_0x430e3d[_0x1df6c2(0x36d)]()+0x1,_0x3b6a0e=_0x430e3d[_0x1df6c2(0x8b9)]();return _0xd1104+'月'+_0x3b6a0e+'日';}}}function formatCallDuration(_0x208a3f){if(!_0x208a3f||_0x208a3f===0x0)return'0:00';const _0x3bc4e4=Math['floor'](_0x208a3f/0x3c),_0x1a5180=_0x208a3f%0x3c;return _0x3bc4e4+':'+String(_0x1a5180)['padStart'](0x2,'0');}function redialPhoneNumber(_0x346697){const _0x51316e=_0x28e739;console[_0x51316e(0x41f)](_0x51316e(0x749),_0x346697),switchPhoneTab(_0x51316e(0x72f)),phoneCurrentNumber=_0x346697,updatePhoneDisplay(),document['querySelectorAll'](_0x51316e(0x618))[_0x51316e(0x7b6)](_0x36ae60=>_0x36ae60[_0x51316e(0x421)][_0x51316e(0x403)](_0x51316e(0x525)));const _0x4de000=document[_0x51316e(0x768)]('.phone-nav-item[onclick*=\x22keypad\x22]');if(_0x4de000)_0x4de000['classList'][_0x51316e(0x5e3)](_0x51316e(0x525));}let currentCallState=_0x28e739(0x608),callTimer=null,callSeconds=0x0,currentCallNumber='',callStartTime=null,callEndTime=null,callTranscript=[],pendingCallTimeout=null,callHangupBy=null;const callIcons={'message':'<rect\x20x=\x223\x22\x20y=\x225\x22\x20width=\x2218\x22\x20height=\x2214\x22\x20rx=\x222\x22/><path\x20d=\x22M3\x209l9\x206\x209-6\x22/>','decline':_0x28e739(0x88f),'accept':'<path\x20d=\x22M22\x2016.92v3a2\x202\x200\x2001-2.18\x202\x2019.79\x2019.79\x200\x2001-8.63-3.07\x2019.5\x2019.5\x200\x2001-6-6\x2019.79\x2019.79\x200\x2001-3.07-8.67A2\x202\x200\x20014.11\x202h3a2\x202\x200\x20012\x201.72c.127.96.361\x201.903.7\x202.81a2\x202\x200\x2001-.45\x202.11L8.09\x209.91a16\x2016\x200\x20006\x206l1.27-1.27a2\x202\x200\x20012.11-.45c.907.339\x201.85.573\x202.81.7A2\x202\x200\x200122\x2016.92z\x22/>','mute':_0x28e739(0x2ba),'keypad':'<rect\x20x=\x222\x22\x20y=\x222\x22\x20width=\x2220\x22\x20height=\x2216\x22\x20rx=\x222\x22\x20ry=\x222\x22/><circle\x20cx=\x228\x22\x20cy=\x2214\x22\x20r=\x222\x22/><path\x20d=\x22M8\x206h.01\x22/><path\x20d=\x22M12\x206h.01\x22/><path\x20d=\x22M16\x206h.01\x22/>','speaker':_0x28e739(0x6b4)},callStates={'calling':{'status':_0x28e739(0x811),'showTimer':![],'buttons':[{'text':_0x28e739(0x94f),'icon':'message','action':()=>{const _0x40c41f=_0x28e739;alert(_0x40c41f(0x73b));}},{'text':_0x28e739(0x60a),'icon':_0x28e739(0x503),'action':()=>{changeCallState('declined');}}]},'incoming':{'status':_0x28e739(0x6cf),'showTimer':![],'buttons':[{'text':_0x28e739(0x60a),'icon':_0x28e739(0x503),'action':()=>{const _0x12cfe6=_0x28e739;changeCallState(_0x12cfe6(0x24b));}},{'text':_0x28e739(0x6e0),'icon':'accept','action':()=>{const _0x1c6562=_0x28e739;changeCallState(_0x1c6562(0x520));}}]},'connected':{'status':_0x28e739(0x533),'showTimer':!![],'buttons':[{'text':_0x28e739(0x639),'icon':_0x28e739(0x19c),'action':()=>{const _0x2bb26f=_0x28e739;alert(_0x2bb26f(0x65c));}},{'text':_0x28e739(0x30d),'icon':_0x28e739(0x72f),'action':()=>{toggleCallReplyInput();}},{'text':'Message','icon':_0x28e739(0x918),'action':()=>{minimizeCallScreen();}},{'text':_0x28e739(0x902),'icon':_0x28e739(0x503),'action':()=>{const _0x36d6f4=_0x28e739;changeCallState(_0x36d6f4(0x262));},'class':_0x28e739(0x4bd)}]},'declined':{'status':_0x28e739(0x431),'showTimer':![],'buttons':[{'text':_0x28e739(0x3f2),'icon':_0x28e739(0x496),'action':()=>{changeCallState('calling');}},{'text':_0x28e739(0x8ea),'icon':_0x28e739(0x918),'action':()=>{hideCallScreen();}}]},'ended':{'status':_0x28e739(0x1ab),'showTimer':!![],'buttons':[{'text':_0x28e739(0x3f2),'icon':'accept','action':()=>{changeCallState('calling');}},{'text':'Close','icon':'message','action':()=>{hideCallScreen();}}]}};function resetCallReplyUI(_0x275333={}){const _0x13e848=_0x28e739,{hideInput:hideInput=!![],clearInput:clearInput=![],clearReplies:clearReplies=![],hideReplies:hideReplies=![]}=_0x275333,_0x2dd8ba=document['getElementById']('callReplyInputContainer');hideInput&&_0x2dd8ba&&_0x2dd8ba[_0x13e848(0x421)][_0x13e848(0x5e3)](_0x13e848(0x48b));const _0x52220e=document[_0x13e848(0x761)](_0x13e848(0x75c));if(_0x52220e){if(clearInput)_0x52220e['value']='';try{_0x52220e[_0x13e848(0x620)]();}catch(_0x136993){}}const _0x137ca0=document[_0x13e848(0x761)](_0x13e848(0x66a));if(_0x137ca0){_0x137ca0[_0x13e848(0x421)][_0x13e848(0x403)](_0x13e848(0x671));if(hideReplies)_0x137ca0[_0x13e848(0x421)][_0x13e848(0x5e3)](_0x13e848(0x48b));}if(clearReplies)try{if(Array['isArray'](callUserReplies))callUserReplies=[];if(typeof updateCallRepliesDisplay===_0x13e848(0x48c))updateCallRepliesDisplay();}catch(_0x76817d){}}async function showCallScreen(_0x17caed,_0x184590){const _0x1256c8=_0x28e739,_0x5c9e0b=document['getElementById']('phoneCallScreen'),_0x3ab2e8=document[_0x1256c8(0x761)](_0x1256c8(0x5e4));currentCallNumber=_0x184590||currentCallNumber,resetCallReplyUI({'hideInput':!![],'clearInput':!![],'clearReplies':!![],'hideReplies':!![]}),_0x3ab2e8&&(currentCallCharacter&&currentCallCharacter[_0x1256c8(0x76a)]?_0x3ab2e8[_0x1256c8(0x7dc)]=currentCallCharacter['name']:_0x3ab2e8[_0x1256c8(0x7dc)]=formatPhoneNumber(currentCallNumber)),await updateCallAvatar(currentCallNumber),_0x5c9e0b&&_0x5c9e0b['classList']['remove'](_0x1256c8(0x48b)),changeCallState(_0x17caed);}async function updateCallAvatar(_0x35ac1e){const _0x257c22=_0x28e739;try{const _0x8a95fe=document[_0x257c22(0x761)](_0x257c22(0x3a1)),_0x2d4127=document[_0x257c22(0x761)](_0x257c22(0x92f)),_0x2cebca=document[_0x257c22(0x761)](_0x257c22(0x5e4));if(!_0x8a95fe||!_0x2d4127){console[_0x257c22(0x516)](_0x257c22(0x7e3));return;}const _0xa77952=normalizeId(_0x35ac1e);if(!_0xa77952){console[_0x257c22(0x41f)](_0x257c22(0x1f4)),_0x8a95fe[_0x257c22(0x577)][_0x257c22(0x475)]=_0x257c22(0x562),_0x2d4127[_0x257c22(0x577)][_0x257c22(0x475)]=_0x257c22(0x78e);return;}console[_0x257c22(0x41f)](_0x257c22(0x8d1),_0xa77952);const _0x21eadc=await db[_0x257c22(0x315)][_0x257c22(0x309)](_0xa77952);if(_0x21eadc){console['log']('📱\x20找到通讯录联系人:',_0x21eadc[_0x257c22(0x8e5)]);_0x2cebca&&_0x21eadc[_0x257c22(0x8e5)]&&(_0x2cebca['textContent']=_0x21eadc[_0x257c22(0x8e5)]);if(_0x21eadc['contactAvatar']){console[_0x257c22(0x41f)](_0x257c22(0x6a2)),_0x8a95fe[_0x257c22(0x273)]=_0x21eadc[_0x257c22(0x691)],_0x8a95fe[_0x257c22(0x577)]['display']=_0x257c22(0x78e),_0x2d4127[_0x257c22(0x577)][_0x257c22(0x475)]='none';return;}if(_0x21eadc[_0x257c22(0x4d1)]&&_0x21eadc['strangerPersona']){console['log'](_0x257c22(0x60d)),_0x8a95fe['style'][_0x257c22(0x475)]='none',_0x2d4127['style'][_0x257c22(0x475)]=_0x257c22(0x78e);return;}if(_0x21eadc[_0x257c22(0x3ae)]){const _0x2a9cd2=await getCharacterById(_0x21eadc[_0x257c22(0x3ae)]);if(_0x2a9cd2&&_0x2a9cd2[_0x257c22(0x6ff)]?.[_0x257c22(0x922)]){console[_0x257c22(0x41f)](_0x257c22(0x964)),_0x8a95fe['src']=_0x2a9cd2[_0x257c22(0x6ff)]['aiAvatar'],_0x8a95fe[_0x257c22(0x577)][_0x257c22(0x475)]='block',_0x2d4127[_0x257c22(0x577)][_0x257c22(0x475)]='none';return;}}_0x8a95fe[_0x257c22(0x577)][_0x257c22(0x475)]=_0x257c22(0x562),_0x2d4127[_0x257c22(0x577)][_0x257c22(0x475)]=_0x257c22(0x78e);return;}const _0x1782ce=await db[_0x257c22(0x8d5)][_0x257c22(0x56a)](_0x257c22(0x1ad))[_0x257c22(0x82f)](_0xa77952)[_0x257c22(0x830)]();if(!_0x1782ce){console[_0x257c22(0x41f)](_0x257c22(0x212)),_0x8a95fe[_0x257c22(0x577)][_0x257c22(0x475)]='none',_0x2d4127['style'][_0x257c22(0x475)]=_0x257c22(0x78e);return;}console[_0x257c22(0x41f)](_0x257c22(0x3be),_0x1782ce);const _0x1c7154=normalizeId(_0x1782ce[_0x257c22(0x3ae)]),_0xd854e6=await getCharacterById(_0x1c7154);if(!_0xd854e6){console['log'](_0x257c22(0x505)),_0x8a95fe['style'][_0x257c22(0x475)]=_0x257c22(0x562),_0x2d4127[_0x257c22(0x577)][_0x257c22(0x475)]=_0x257c22(0x78e);return;}const _0x43c061=_0xd854e6['settings']?.[_0x257c22(0x922)]||'';console['log'](_0x257c22(0x681),{'id':_0x1c7154,'name':_0xd854e6[_0x257c22(0x76a)]}),_0x43c061?(console['log'](_0x257c22(0x66d),_0xd854e6[_0x257c22(0x76a)],_0x43c061),_0x8a95fe[_0x257c22(0x273)]=_0x43c061,_0x8a95fe[_0x257c22(0x577)]['display']='block',_0x2d4127[_0x257c22(0x577)]['display']=_0x257c22(0x562)):(console[_0x257c22(0x41f)](_0x257c22(0x34f)),_0x8a95fe[_0x257c22(0x577)]['display']='none',_0x2d4127[_0x257c22(0x577)]['display']='block');}catch(_0x303595){console[_0x257c22(0x56c)](_0x257c22(0x521),_0x303595);const _0x566d3d=document[_0x257c22(0x761)](_0x257c22(0x3a1)),_0x47b66d=document[_0x257c22(0x761)](_0x257c22(0x92f));_0x566d3d&&_0x47b66d&&(_0x566d3d['style'][_0x257c22(0x475)]=_0x257c22(0x562),_0x47b66d[_0x257c22(0x577)]['display']=_0x257c22(0x78e));}}async function saveCallRecord(){const _0x2dfcb2=_0x28e739;try{if(!callStartTime){console[_0x2dfcb2(0x41f)](_0x2dfcb2(0x62b));return;}const _0x5bbc9d=String(window[_0x2dfcb2(0x412)]||'')[_0x2dfcb2(0x6eb)](),_0x11755f=_0x5bbc9d===_0x2dfcb2(0x887)?_0x2dfcb2(0x93e):_0x2dfcb2(0x5a8);callEndTime=Date[_0x2dfcb2(0x2cb)]();const _0x2b9511=Math[_0x2dfcb2(0x64b)]((callEndTime-callStartTime)/0x3e8);if(currentCallCharacter){const _0x229bc0={'characterId':normalizeId(currentCallCharacter?.['id'])||'0','sessionId':_0x2dfcb2(0x79f),'role':'system','type':'call','callType':_0x11755f,'callStatus':currentCallState==='ended'?_0x2dfcb2(0x299):'interrupted','callStartTime':callStartTime,'callEndTime':callEndTime,'callDuration':_0x2b9511,'phoneNumber':currentCallNumber,'hangupBy':callHangupBy||_0x2dfcb2(0x8dd),'content':_0x2dfcb2(0x658)+Math[_0x2dfcb2(0x64b)](_0x2b9511/0x3c)+':'+_0x2b9511%0x3c,'callTranscript':callTranscript,'timestamp':callStartTime};await db[_0x2dfcb2(0x698)]['add'](_0x229bc0);}const _0x42c0c4={'phoneNumber':currentCallNumber,'characterId':normalizeId(currentCallCharacter?.['id'])||null,'characterName':currentCallCharacter?.[_0x2dfcb2(0x76a)]||null,'characterAvatar':currentCallCharacter?.[_0x2dfcb2(0x6ff)]?.[_0x2dfcb2(0x922)]||null,'callType':_0x11755f,'timestamp':callStartTime,'duration':_0x2b9511,'date':new Date(callStartTime)[_0x2dfcb2(0x180)](_0x2dfcb2(0x34a)),'transcript':callTranscript,'isStranger':typeof isRandomStrangerCall!==_0x2dfcb2(0x714)?isRandomStrangerCall:![],'strangerPersona':typeof isRandomStrangerCall!==_0x2dfcb2(0x714)&&isRandomStrangerCall&&typeof randomStrangerPersona!==_0x2dfcb2(0x714)?randomStrangerPersona:null};await db['callRecords'][_0x2dfcb2(0x5e3)](_0x42c0c4),console[_0x2dfcb2(0x41f)]('📞\x20通话记录已保存:',_0x42c0c4[_0x2dfcb2(0x4d1)]?_0x2dfcb2(0x3af):_0x2dfcb2(0x1ed));}catch(_0x349657){console[_0x2dfcb2(0x56c)]('❌\x20保存通话记录失败:',_0x349657);}}async function hideCallScreen(){const _0x47079a=_0x28e739,_0x53bccc=document[_0x47079a(0x761)]('phoneCallScreen');_0x53bccc&&_0x53bccc['classList'][_0x47079a(0x5e3)](_0x47079a(0x48b));resetCallReplyUI({'hideInput':!![],'clearInput':!![],'clearReplies':!![],'hideReplies':!![]}),stopCallTimer();pendingCallTimeout&&(console[_0x47079a(0x41f)]('⏹️\x20清除拨号延迟定时器'),clearTimeout(pendingCallTimeout),pendingCallTimeout=null);callShouldHangup=![],await saveCallRecord(),callHangupBy=null;const _0x1be657=document[_0x47079a(0x761)](_0x47079a(0x3cb));_0x1be657&&(_0x1be657[_0x47079a(0x421)][_0x47079a(0x403)]('show',_0x47079a(0x61b)),_0x1be657[_0x47079a(0x421)]['add'](_0x47079a(0x48b))),typeof endCallWithAI===_0x47079a(0x48c)&&endCallWithAI(),callStartTime=null,callEndTime=null,callTranscript=[],currentCallNumber='';}function minimizeCallScreen(){const _0x5b1c0d=_0x28e739,_0x3d5ca9=document[_0x5b1c0d(0x761)](_0x5b1c0d(0x55a)),_0x1469a2=document[_0x5b1c0d(0x761)](_0x5b1c0d(0x3cb));if(!_0x3d5ca9||!_0x1469a2)return;console[_0x5b1c0d(0x41f)](_0x5b1c0d(0x21c)),resetCallReplyUI({'hideInput':!![]}),updateFloatingBallAvatar(),_0x3d5ca9[_0x5b1c0d(0x421)][_0x5b1c0d(0x5e3)]('minimizing'),setTimeout(()=>{const _0x1e0588=_0x5b1c0d;_0x3d5ca9['classList'][_0x1e0588(0x403)](_0x1e0588(0x3c0)),_0x3d5ca9[_0x1e0588(0x421)]['add'](_0x1e0588(0x48b)),_0x1469a2[_0x1e0588(0x421)][_0x1e0588(0x403)](_0x1e0588(0x48b)),void _0x1469a2[_0x1e0588(0x1d3)],_0x1469a2['classList'][_0x1e0588(0x5e3)](_0x1e0588(0x332));},0x15e);}function expandCallScreen(){const _0x1ced98=_0x28e739,_0x3a6e0a=document[_0x1ced98(0x761)](_0x1ced98(0x55a)),_0x109c76=document[_0x1ced98(0x761)](_0x1ced98(0x3cb));if(!_0x3a6e0a||!_0x109c76){console[_0x1ced98(0x56c)](_0x1ced98(0x238));return;}console[_0x1ced98(0x41f)]('📱\x20展开通话页面'),resetCallReplyUI({'hideInput':!![]}),_0x109c76[_0x1ced98(0x421)][_0x1ced98(0x403)]('show','has-reply'),_0x109c76[_0x1ced98(0x421)]['add'](_0x1ced98(0x48b)),_0x3a6e0a[_0x1ced98(0x421)][_0x1ced98(0x403)]('hidden'),_0x3a6e0a[_0x1ced98(0x421)][_0x1ced98(0x5e3)](_0x1ced98(0x20d)),console[_0x1ced98(0x41f)](_0x1ced98(0x31a)),setTimeout(()=>{const _0x20b4fe=_0x1ced98;_0x3a6e0a['classList'][_0x20b4fe(0x403)](_0x20b4fe(0x20d));},0x190);}function updateFloatingBallAvatar(){const _0x232836=_0x28e739,_0xbd0b5a=document['getElementById'](_0x232836(0x2d5)),_0x58a184=document[_0x232836(0x761)]('callFloatingDefaultIcon'),_0x1b38c3=document['getElementById'](_0x232836(0x3a1));if(!_0xbd0b5a||!_0x58a184)return;_0x1b38c3&&_0x1b38c3[_0x232836(0x577)]['display']!==_0x232836(0x562)&&_0x1b38c3['src']?(_0xbd0b5a[_0x232836(0x273)]=_0x1b38c3['src'],_0xbd0b5a[_0x232836(0x577)][_0x232836(0x475)]=_0x232836(0x78e),_0x58a184[_0x232836(0x577)][_0x232836(0x475)]=_0x232836(0x562)):(_0xbd0b5a[_0x232836(0x577)][_0x232836(0x475)]='none',_0x58a184['style'][_0x232836(0x475)]=_0x232836(0x78e));}function changeCallState(_0x44a955){const _0x4bb388=_0x28e739;(_0x44a955===_0x4bb388(0x24b)||_0x44a955==='ended')&&(!callHangupBy&&(callHangupBy=_0x4bb388(0x8dd),console[_0x4bb388(0x41f)](_0x4bb388(0x2d4))),typeof abortCurrentCallAI===_0x4bb388(0x48c)&&(console[_0x4bb388(0x41f)](_0x4bb388(0x400),_0x44a955,_0x4bb388(0x924)),abortCurrentCallAI()),pendingCallTimeout&&(console[_0x4bb388(0x41f)](_0x4bb388(0x389)),clearTimeout(pendingCallTimeout),pendingCallTimeout=null));_0x44a955!==_0x4bb388(0x520)?resetCallReplyUI({'hideInput':!![],'clearInput':!![],'hideReplies':!![]}):resetCallReplyUI({'hideInput':!![]});currentCallState=_0x44a955;const _0x5257e9=callStates[_0x44a955],_0x32e578=document[_0x4bb388(0x761)](_0x4bb388(0x55a)),_0x513f8d=document[_0x4bb388(0x761)](_0x4bb388(0x441)),_0x47138c=document['getElementById'](_0x4bb388(0x7e0)),_0xfa1afd=document[_0x4bb388(0x761)]('callBtnGrid');if(!_0x32e578||!_0x5257e9)return;_0x32e578[_0x4bb388(0x421)][_0x4bb388(0x5e3)](_0x4bb388(0x54f)),_0x32e578[_0x4bb388(0x51f)]=_0x4bb388(0x3c4)+_0x44a955+_0x4bb388(0x5a9),_0x513f8d&&(_0x513f8d['textContent']=_0x5257e9[_0x4bb388(0x664)]),_0x47138c&&(_0x5257e9[_0x4bb388(0x7ef)]?(_0x47138c[_0x4bb388(0x421)][_0x4bb388(0x403)](_0x4bb388(0x48b)),_0x44a955==='connected'?(!callStartTime&&(callStartTime=Date[_0x4bb388(0x2cb)](),console[_0x4bb388(0x41f)](_0x4bb388(0x3f9),new Date(callStartTime)['toLocaleString']())),startCallTimer(),typeof sendCallMessage===_0x4bb388(0x48c)&&callMessages&&callMessages[_0x4bb388(0x6ea)]===0x0&&setTimeout(async()=>{const _0x2c4019=_0x4bb388,_0x4356ec=await sendCallMessage('喂？');_0x4356ec&&_0x4356ec[_0x2c4019(0x6b7)]&&_0x4356ec[_0x2c4019(0x6b7)][_0x2c4019(0x6ea)]>0x0&&(callSpeeches=_0x4356ec[_0x2c4019(0x6b7)],callShouldHangup=_0x4356ec[_0x2c4019(0x292)]||![],currentCallSpeechIndex=0x0,_0x4356ec['sentences'][_0x2c4019(0x7b6)](_0x27aa8b=>{const _0x20118f=_0x2c4019;callTranscript[_0x20118f(0x2c4)]({'role':'ai','text':_0x27aa8b,'timestamp':Date[_0x20118f(0x2cb)]()});}),console[_0x2c4019(0x41f)](_0x2c4019(0x8fb),_0x4356ec[_0x2c4019(0x6b7)]),showCallSpeech());},0x3e8)):stopCallTimer()):(_0x47138c[_0x4bb388(0x421)]['add'](_0x4bb388(0x48b)),stopCallTimer())),_0xfa1afd&&(_0xfa1afd[_0x4bb388(0x5b8)]=_0x5257e9[_0x4bb388(0x4af)][_0x4bb388(0x962)](_0x2dbd01=>_0x4bb388(0x927)+(_0x2dbd01['class']||'')+_0x4bb388(0x1c2)+_0x2dbd01[_0x4bb388(0x7e6)]+_0x4bb388(0x8c0)+callIcons[_0x2dbd01[_0x4bb388(0x8d6)]]+_0x4bb388(0x3fd)+_0x2dbd01[_0x4bb388(0x7e6)]+_0x4bb388(0x866))[_0x4bb388(0x943)]('')),setTimeout(()=>{const _0x1c60dc=_0x4bb388;_0x32e578[_0x1c60dc(0x421)][_0x1c60dc(0x403)](_0x1c60dc(0x54f));},0x1f4);}function handleCallButtonClick(_0xcde0dc){const _0xabecd1=_0x28e739,_0x6b0d79=callStates[currentCallState];if(!_0x6b0d79)return;const _0x1a9f37=_0x6b0d79['buttons'][_0xabecd1(0x30c)](_0x452a0c=>_0x452a0c[_0xabecd1(0x7e6)]===_0xcde0dc);if(_0x1a9f37)_0x1a9f37[_0xabecd1(0x310)]();}function startCallTimer(){callSeconds=0x0,updateCallTimer(),callTimer=setInterval(()=>{callSeconds++,updateCallTimer();},0x3e8);}function stopCallTimer(){callTimer&&(clearInterval(callTimer),callTimer=null);}function updateCallTimer(){const _0x3da58a=_0x28e739,_0x8568b=document[_0x3da58a(0x761)](_0x3da58a(0x7e0));if(_0x8568b){const _0x2211cb=Math[_0x3da58a(0x64b)](callSeconds/0x3c)[_0x3da58a(0x7f6)]()['padStart'](0x2,'0'),_0x30a04f=(callSeconds%0x3c)[_0x3da58a(0x7f6)]()[_0x3da58a(0x90f)](0x2,'0');_0x8568b[_0x3da58a(0x7dc)]=_0x2211cb+':'+_0x30a04f;}}let callSpeeches=[_0x28e739(0x7d7),_0x28e739(0x85d),_0x28e739(0x804)],currentCallSpeechIndex=0x0,callSpeechAutoTimer=null,callShouldHangup=![],callSpeechIgnoreClick=![],callSpeechSuppressClickUntil=0x0,callSpeechPointerDown=![],callSpeechPointerMoved=![],callSpeechPointerStartX=0x0,callSpeechPointerStartY=0x0;function bindCallSpeechInteraction(){const _0x585402=_0x28e739,_0xb41e02=document[_0x585402(0x761)](_0x585402(0x8ac)),_0x5b0f69=document['getElementById'](_0x585402(0x346));if(!_0xb41e02||_0xb41e02[_0x585402(0x672)][_0x585402(0x3b7)]==='1')return;_0xb41e02[_0x585402(0x672)][_0x585402(0x3b7)]='1',_0xb41e02[_0x585402(0x55d)](_0x585402(0x637),_0x23d85b=>{const _0x3ef4d7=_0x585402;callSpeechPointerDown=!![],callSpeechPointerMoved=![],callSpeechPointerStartX=_0x23d85b[_0x3ef4d7(0x6b3)],callSpeechPointerStartY=_0x23d85b['clientY'];}),_0xb41e02[_0x585402(0x55d)](_0x585402(0x1d5),_0x3280f4=>{const _0x1633d0=_0x585402;if(!callSpeechPointerDown)return;const _0x347af5=Math[_0x1633d0(0x268)](_0x3280f4[_0x1633d0(0x6b3)]-callSpeechPointerStartX),_0x2e3022=Math[_0x1633d0(0x268)](_0x3280f4['clientY']-callSpeechPointerStartY);(_0x347af5>0x6||_0x2e3022>0x6)&&(callSpeechPointerMoved=!![]);});const _0x414912=()=>{callSpeechPointerMoved&&(callSpeechIgnoreClick=!![]),callSpeechPointerDown=![],callSpeechPointerMoved=![];};_0xb41e02[_0x585402(0x55d)](_0x585402(0x19f),_0x414912),_0xb41e02[_0x585402(0x55d)](_0x585402(0x24e),_0x414912),_0x5b0f69&&_0x5b0f69[_0x585402(0x55d)](_0x585402(0x48a),()=>{const _0x1ea0cf=_0x585402;callSpeechSuppressClickUntil=Date[_0x1ea0cf(0x2cb)]()+0x190,callSpeechAutoTimer&&clearTimeout(callSpeechAutoTimer),callSpeechAutoTimer=setTimeout(()=>{nextCallSpeech();},0x1388);},{'passive':!![]});}function showCallSpeech(){const _0x11ab0c=_0x28e739,_0x3e5dbb=document['getElementById'](_0x11ab0c(0x8ac)),_0x2f0580=document[_0x11ab0c(0x761)](_0x11ab0c(0x346)),_0x30b172=document['getElementById'](_0x11ab0c(0x385));if(!_0x3e5dbb||!_0x2f0580||!_0x30b172||callSpeeches[_0x11ab0c(0x6ea)]===0x0)return;bindCallSpeechInteraction(),_0x2f0580[_0x11ab0c(0x7dc)]=callSpeeches[currentCallSpeechIndex],_0x30b172['textContent']=currentCallSpeechIndex+0x1+'/'+callSpeeches['length'],_0x3e5dbb[_0x11ab0c(0x421)][_0x11ab0c(0x403)](_0x11ab0c(0x48b),_0x11ab0c(0x940),_0x11ab0c(0x31e)),void _0x3e5dbb['offsetWidth'],_0x3e5dbb[_0x11ab0c(0x421)]['add']('show');const _0x375f79=document[_0x11ab0c(0x761)]('callFloatingBall');_0x375f79&&_0x375f79[_0x11ab0c(0x421)][_0x11ab0c(0x6e3)](_0x11ab0c(0x332))&&_0x375f79[_0x11ab0c(0x421)][_0x11ab0c(0x5e3)](_0x11ab0c(0x61b)),callSpeechAutoTimer&&clearTimeout(callSpeechAutoTimer),callSpeechAutoTimer=setTimeout(()=>{nextCallSpeech();},0x1388);}function nextCallSpeech(_0x55a30b){const _0x4b254f=_0x28e739;if(callSpeeches['length']===0x0)return;if(_0x55a30b){if(callSpeechIgnoreClick){callSpeechIgnoreClick=![];return;}if(Date[_0x4b254f(0x2cb)]()<callSpeechSuppressClickUntil)return;}const _0x22b753=document[_0x4b254f(0x761)]('callSpeechBubble'),_0x59ba32=document[_0x4b254f(0x761)](_0x4b254f(0x346)),_0x10b691=document[_0x4b254f(0x761)](_0x4b254f(0x385));if(!_0x22b753||!_0x59ba32||!_0x10b691)return;const _0x465976=currentCallSpeechIndex===callSpeeches['length']-0x1;if(_0x465976&&callShouldHangup){console[_0x4b254f(0x41f)](_0x4b254f(0x4ca)),callHangupBy='ai',console[_0x4b254f(0x41f)]('📞\x20AI主动挂断电话'),_0x22b753[_0x4b254f(0x421)][_0x4b254f(0x403)]('show',_0x4b254f(0x31e)),_0x22b753['classList']['add']('switching-out'),setTimeout(()=>{const _0x57e783=_0x4b254f;hideCallSpeech(),showIslandNotification('通话结束',_0x57e783(0x46c),'info'),setTimeout(()=>{const _0x4a2ff5=_0x57e783;changeCallState(_0x4a2ff5(0x262)),callShouldHangup=![];},0x3e8);},0x7d0);return;}_0x22b753['classList'][_0x4b254f(0x403)](_0x4b254f(0x332),_0x4b254f(0x31e)),_0x22b753[_0x4b254f(0x421)]['add'](_0x4b254f(0x940)),setTimeout(()=>{const _0x1e5a95=_0x4b254f;currentCallSpeechIndex=(currentCallSpeechIndex+0x1)%callSpeeches['length'],_0x59ba32['textContent']=callSpeeches[currentCallSpeechIndex],_0x10b691[_0x1e5a95(0x7dc)]=currentCallSpeechIndex+0x1+'/'+callSpeeches[_0x1e5a95(0x6ea)],_0x22b753[_0x1e5a95(0x421)]['remove'](_0x1e5a95(0x940)),_0x22b753[_0x1e5a95(0x421)][_0x1e5a95(0x5e3)](_0x1e5a95(0x31e),'show'),setTimeout(()=>{const _0x5174c0=_0x1e5a95;_0x22b753[_0x5174c0(0x421)]['remove']('switching-in');},0x190),callSpeechAutoTimer&&clearTimeout(callSpeechAutoTimer),callSpeechAutoTimer=setTimeout(()=>{nextCallSpeech();},0x1388);},0xfa);}function hideCallSpeech(){const _0x247d57=_0x28e739,_0x2e94c1=document[_0x247d57(0x761)](_0x247d57(0x8ac));_0x2e94c1&&(_0x2e94c1[_0x247d57(0x421)]['remove'](_0x247d57(0x332),_0x247d57(0x31e),_0x247d57(0x940)),_0x2e94c1[_0x247d57(0x421)]['add'](_0x247d57(0x48b))),callSpeechAutoTimer&&(clearTimeout(callSpeechAutoTimer),callSpeechAutoTimer=null);}let callUserReplies=[];const MAX_CALL_REPLIES=0x5;function toggleCallReplyInput(){const _0x547b84=_0x28e739,_0x47d3bf=document[_0x547b84(0x761)]('phoneCallScreen');if(currentCallState!=='connected'||!_0x47d3bf||_0x47d3bf[_0x547b84(0x421)][_0x547b84(0x6e3)](_0x547b84(0x48b))){resetCallReplyUI({'hideInput':!![]});return;}const _0x28c447=document['getElementById'](_0x547b84(0x5f1)),_0x1cddd7=document['getElementById'](_0x547b84(0x66a));if(!_0x28c447)return;if(_0x28c447[_0x547b84(0x421)][_0x547b84(0x6e3)](_0x547b84(0x48b))){_0x28c447[_0x547b84(0x421)][_0x547b84(0x403)](_0x547b84(0x48b));const _0x3d9090=document[_0x547b84(0x761)]('callReplyInput');_0x3d9090&&_0x3d9090[_0x547b84(0x7bf)](),callUserReplies['length']>0x0&&_0x1cddd7&&_0x1cddd7[_0x547b84(0x421)][_0x547b84(0x403)]('hidden');}else _0x28c447[_0x547b84(0x421)][_0x547b84(0x5e3)](_0x547b84(0x48b)),callUserReplies['length']>0x0&&_0x1cddd7&&_0x1cddd7['classList'][_0x547b84(0x403)](_0x547b84(0x48b));}function addCallReply(){const _0x15e3c1=_0x28e739,_0x1b6aad=document[_0x15e3c1(0x761)](_0x15e3c1(0x75c));if(!_0x1b6aad)return;const _0x71570d=_0x1b6aad[_0x15e3c1(0x29c)][_0x15e3c1(0x28e)]();if(!_0x71570d)return;callUserReplies[_0x15e3c1(0x2c4)](_0x71570d);callUserReplies[_0x15e3c1(0x6ea)]>MAX_CALL_REPLIES&&callUserReplies[_0x15e3c1(0x50f)]();updateCallRepliesDisplay(),_0x1b6aad['value']='';const _0x4592d3=document[_0x15e3c1(0x761)](_0x15e3c1(0x66a));_0x4592d3&&_0x4592d3[_0x15e3c1(0x421)][_0x15e3c1(0x403)](_0x15e3c1(0x48b)),console[_0x15e3c1(0x41f)]('📝\x20添加回复:',_0x71570d,_0x15e3c1(0x650),callUserReplies[_0x15e3c1(0x6ea)],')');}async function sendCallReply(){const _0x459ee1=_0x28e739,_0x5b0145=document[_0x459ee1(0x761)](_0x459ee1(0x75c));if(!_0x5b0145)return;callShouldHangup&&(console[_0x459ee1(0x41f)](_0x459ee1(0x30e)),callShouldHangup=![]);const _0x24eeef=_0x5b0145['value'][_0x459ee1(0x28e)]();_0x24eeef&&addCallReply();if(callUserReplies['length']===0x0)return;console[_0x459ee1(0x41f)](_0x459ee1(0x49a),callUserReplies);const _0x237e5e=callUserReplies['join']('\x20');callTranscript['push']({'role':_0x459ee1(0x8dd),'text':_0x237e5e,'timestamp':Date['now']()}),console[_0x459ee1(0x41f)](_0x459ee1(0x546),_0x237e5e);const _0x270062=document[_0x459ee1(0x761)](_0x459ee1(0x66a));if(_0x270062){_0x270062['classList'][_0x459ee1(0x5e3)](_0x459ee1(0x671));const _0x5bb34d=_0x270062['querySelectorAll']('.call-user-reply-item');_0x5bb34d[_0x459ee1(0x7b6)]((_0xa2d795,_0x2f05eb)=>{setTimeout(()=>{const _0x5847af=_0xc1ca;_0xa2d795[_0x5847af(0x421)]['add'](_0x5847af(0x783));},_0x2f05eb*0x32);}),setTimeout(()=>{const _0x55a3c8=_0x459ee1;callUserReplies=[],updateCallRepliesDisplay(),_0x270062['classList'][_0x55a3c8(0x403)](_0x55a3c8(0x671)),_0x270062[_0x55a3c8(0x421)][_0x55a3c8(0x5e3)](_0x55a3c8(0x48b));},0x15e+_0x5bb34d[_0x459ee1(0x6ea)]*0x32);}else callUserReplies=[],updateCallRepliesDisplay();if(typeof sendCallMessage===_0x459ee1(0x48c)){const _0x23a062=await sendCallMessage(_0x237e5e);_0x23a062&&_0x23a062[_0x459ee1(0x6b7)]&&_0x23a062['sentences'][_0x459ee1(0x6ea)]>0x0&&(console[_0x459ee1(0x41f)](_0x459ee1(0x203),_0x23a062[_0x459ee1(0x6b7)][_0x459ee1(0x6ea)],'句'),callSpeeches=_0x23a062[_0x459ee1(0x6b7)],callShouldHangup=_0x23a062[_0x459ee1(0x292)]||![],currentCallSpeechIndex=0x0,_0x23a062[_0x459ee1(0x6b7)]['forEach'](_0x208f6d=>{const _0x1471af=_0x459ee1;callTranscript[_0x1471af(0x2c4)]({'role':'ai','text':_0x208f6d,'timestamp':Date[_0x1471af(0x2cb)]()});}),console[_0x459ee1(0x41f)](_0x459ee1(0x799),_0x23a062[_0x459ee1(0x6b7)]['length'],'句'),showCallSpeech());}}function updateCallRepliesDisplay(){const _0xf26ffc=_0x28e739,_0x1aa272=document[_0xf26ffc(0x761)](_0xf26ffc(0x66a));if(!_0x1aa272)return;_0x1aa272[_0xf26ffc(0x5b8)]=callUserReplies[_0xf26ffc(0x962)]((_0x354831,_0x1a46cc)=>{const _0xd71174=_0xf26ffc,_0x4cc81f=_0x1a46cc===callUserReplies[_0xd71174(0x6ea)]-0x1;return _0xd71174(0x617)+(_0x4cc81f?_0xd71174(0x281):'')+'\x22>'+_0x354831+_0xd71174(0x611);})['join']('');}const __ovoInitCallReplyInput=()=>{const _0x5cad79=_0x28e739,_0x363e7c=document[_0x5cad79(0x761)](_0x5cad79(0x75c));_0x363e7c&&_0x363e7c[_0x5cad79(0x55d)](_0x5cad79(0x437),_0x265baa=>{const _0x1a9cd2=_0x5cad79;_0x265baa['key']===_0x1a9cd2(0x759)&&addCallReply();});};document[_0x28e739(0x1c4)]==='loading'?document[_0x28e739(0x55d)](_0x28e739(0x433),__ovoInitCallReplyInput,{'once':!![]}):__ovoInitCallReplyInput();const originalChangeCallState=changeCallState;changeCallState=function(_0x117a9c){const _0x20135e=_0x28e739;originalChangeCallState(_0x117a9c),_0x117a9c===_0x20135e(0x520)?setTimeout(()=>{showCallSpeech();},0x3e8):hideCallSpeech();};async function openImessage(){const _0x518e4c=_0x28e739;console[_0x518e4c(0x41f)](_0x518e4c(0x892));const _0x1a94f3=document[_0x518e4c(0x761)]('phoneScreen');_0x1a94f3&&_0x1a94f3[_0x518e4c(0x421)]['remove'](_0x518e4c(0x525));const _0x1a6171=document[_0x518e4c(0x761)]('imessageScreen');_0x1a6171&&(_0x1a6171[_0x518e4c(0x421)][_0x518e4c(0x5e3)](_0x518e4c(0x525)),renderImessagePinned(),await renderImessageList(),_0x1a6171[_0x518e4c(0x421)][_0x518e4c(0x403)](_0x518e4c(0x81b)),void _0x1a6171[_0x518e4c(0x1d3)],_0x1a6171['classList'][_0x518e4c(0x5e3)](_0x518e4c(0x81b)));}function closeImessage(){const _0x1a28ed=_0x28e739;console[_0x1a28ed(0x41f)]('📱\x20关闭iMessage');const _0xa3216f=document[_0x1a28ed(0x761)]('imessageScreen');_0xa3216f&&_0xa3216f['classList'][_0x1a28ed(0x403)](_0x1a28ed(0x525));const _0x56c593=document[_0x1a28ed(0x761)]('phoneScreen');_0x56c593&&_0x56c593['classList'][_0x1a28ed(0x5e3)](_0x1a28ed(0x525));}function createNewImessage(){const _0x476d8f=_0x28e739;console[_0x476d8f(0x41f)]('📱\x20创建新短信'),showIslandNotification('提示',_0x476d8f(0x2cc),_0x476d8f(0x537));}let imessageEditMode=![],imessageSelectedItems=new Set();function toggleImessageEditMode(){const _0x3c8e9c=_0x28e739;imessageEditMode=!imessageEditMode,console[_0x3c8e9c(0x41f)](_0x3c8e9c(0x923),imessageEditMode?'开启':'关闭'),imessageEditMode?enterImessageEditMode():exitImessageEditMode();}function enterImessageEditMode(){const _0x56e690=_0x28e739;imessageSelectedItems[_0x56e690(0x886)]();const _0xd8199a=document[_0x56e690(0x768)](_0x56e690(0x1ae)),_0x12be21=document[_0x56e690(0x761)]('imessageEditBtn');if(_0xd8199a)_0xd8199a['textContent']=_0x56e690(0x6dd);if(_0x12be21)_0x12be21['innerHTML']=_0x56e690(0x868);const _0x476c6c=document[_0x56e690(0x761)](_0x56e690(0x890));if(_0x476c6c)_0x476c6c[_0x56e690(0x421)]['add']('imessage-edit-mode');renderImessageList(),showImessageEditBar();}function exitImessageEditMode(){const _0x4e639d=_0x28e739;imessageEditMode=![],imessageSelectedItems[_0x4e639d(0x886)]();const _0x1a5c61=document['querySelector']('.imessage-nav-title'),_0xe9494=document[_0x4e639d(0x761)]('imessageEditBtn');if(_0x1a5c61)_0x1a5c61[_0x4e639d(0x7dc)]=_0x4e639d(0x661);_0xe9494&&(_0xe9494[_0x4e639d(0x5b8)]=_0x4e639d(0x39a));const _0x2aa591=document[_0x4e639d(0x761)](_0x4e639d(0x890));if(_0x2aa591)_0x2aa591[_0x4e639d(0x421)][_0x4e639d(0x403)](_0x4e639d(0x36f));renderImessageList(),hideImessageEditBar();}function showImessageEditBar(){const _0x372e34=_0x28e739;let _0x5f3cfd=document['getElementById'](_0x372e34(0x4f0));if(!_0x5f3cfd){_0x5f3cfd=document[_0x372e34(0x5e5)]('div'),_0x5f3cfd['id']=_0x372e34(0x4f0),_0x5f3cfd['className']=_0x372e34(0x1ee),_0x5f3cfd['innerHTML']=_0x372e34(0x27c);const _0x2f6c0e=document[_0x372e34(0x761)](_0x372e34(0x890));if(_0x2f6c0e)_0x2f6c0e[_0x372e34(0x3de)](_0x5f3cfd);}_0x5f3cfd[_0x372e34(0x421)]['add'](_0x372e34(0x332));}function hideImessageEditBar(){const _0x4e85f1=_0x28e739,_0x47e30c=document[_0x4e85f1(0x761)](_0x4e85f1(0x4f0));_0x47e30c&&_0x47e30c['classList'][_0x4e85f1(0x403)](_0x4e85f1(0x332));}function toggleImessageItemSelection(_0x194044,_0x157ad2){const _0x33c1a6=_0x28e739;if(_0x157ad2)_0x157ad2['stopPropagation']();imessageSelectedItems[_0x33c1a6(0x345)](_0x194044)?imessageSelectedItems[_0x33c1a6(0x6c2)](_0x194044):imessageSelectedItems[_0x33c1a6(0x5e3)](_0x194044),updateImessageSelectionUI();}async function toggleImessageSelectAll(){const _0x400b38=_0x28e739,_0x4db409=await getImessageMessages(),_0x5d18e0=_0x4db409['map'](_0x2ad550=>_0x2ad550['id']);imessageSelectedItems['size']===_0x5d18e0[_0x400b38(0x6ea)]?imessageSelectedItems[_0x400b38(0x886)]():_0x5d18e0[_0x400b38(0x7b6)](_0x51d111=>imessageSelectedItems[_0x400b38(0x5e3)](_0x51d111)),updateImessageSelectionUI();}async function updateImessageSelectionUI(){const _0x58b693=_0x28e739,_0x2e423b=imessageSelectedItems[_0x58b693(0x2da)],_0x4d0227=document[_0x58b693(0x768)](_0x58b693(0x1ae));if(_0x4d0227)_0x4d0227[_0x58b693(0x7dc)]=_0x58b693(0x84a)+_0x2e423b+'\x20项';const _0xa1844f=await getImessageMessages(),_0x332827=document[_0x58b693(0x761)](_0x58b693(0x8fc));_0x332827&&(_0x332827[_0x58b693(0x7dc)]=_0x2e423b===_0xa1844f[_0x58b693(0x6ea)]&&_0x2e423b>0x0?'取消全选':'全选');const _0x7168ea=document[_0x58b693(0x761)]('imessageDeleteBtn');_0x7168ea&&(_0x7168ea[_0x58b693(0x8f5)]=_0x2e423b===0x0,_0x7168ea[_0x58b693(0x7dc)]=_0x2e423b>0x0?_0x58b693(0x539)+_0x2e423b+')':'删除'),document[_0x58b693(0x42c)]('.imessage-item')[_0x58b693(0x7b6)](_0x8821d0=>{const _0x4f62c0=_0x58b693,_0x4c7d72=_0x8821d0[_0x4f62c0(0x672)][_0x4f62c0(0x4ea)],_0x189b14=_0x8821d0[_0x4f62c0(0x768)](_0x4f62c0(0x472)),_0x8927a6=imessageSelectedItems[_0x4f62c0(0x345)](_0x4c7d72);_0x8927a6?_0x8821d0[_0x4f62c0(0x421)]['add'](_0x4f62c0(0x6c5)):_0x8821d0[_0x4f62c0(0x421)][_0x4f62c0(0x403)]('imessage-selected'),_0x189b14&&(_0x8927a6?_0x189b14['classList']['add']('checked'):_0x189b14[_0x4f62c0(0x421)]['remove'](_0x4f62c0(0x657)));});}async function deleteSelectedImessages(){const _0x658e46=_0x28e739,_0x1ccfbe=imessageSelectedItems[_0x658e46(0x2da)];if(_0x1ccfbe===0x0)return;const _0x38ac42=confirm(_0x658e46(0x937)+_0x1ccfbe+_0x658e46(0x57d));if(!_0x38ac42)return;console[_0x658e46(0x41f)](_0x658e46(0x8a0),[...imessageSelectedItems]);try{for(const _0x368fe9 of imessageSelectedItems){await deleteImessageConversation(_0x368fe9);}showIslandNotification('成功','已删除\x20'+_0x1ccfbe+'\x20个对话',_0x658e46(0x39d)),exitImessageEditMode();}catch(_0x10e752){console[_0x658e46(0x56c)]('❌\x20删除短信对话失败:',_0x10e752),showIslandNotification('错误',_0x658e46(0x45a),_0x658e46(0x56c));}}async function deleteImessageConversation(_0x15ca90){const _0x585b78=_0x28e739,_0x36d2a7=normalizeId(_0x15ca90),_0x1746ce='sms_'+_0x36d2a7;console[_0x585b78(0x41f)](_0x585b78(0x1b6),_0x36d2a7);const _0x3cc1f8=await db[_0x585b78(0x698)][_0x585b78(0x56a)](_0x585b78(0x3c2))[_0x585b78(0x82f)](_0x1746ce)[_0x585b78(0x5a4)]();if(_0x3cc1f8[_0x585b78(0x6ea)]>0x0){if(typeof db[_0x585b78(0x698)][_0x585b78(0x80c)]===_0x585b78(0x48c))await db[_0x585b78(0x698)][_0x585b78(0x80c)](_0x3cc1f8);else for(const _0x35bbbb of _0x3cc1f8){await db['chatMessages'][_0x585b78(0x6c2)](_0x35bbbb);}}console[_0x585b78(0x41f)](_0x585b78(0x8e1)+_0x3cc1f8[_0x585b78(0x6ea)]+'\x20条短信记录'),await purgeRandomNumberDataFromImessage(_0x36d2a7);}async function purgeRandomNumberDataFromImessage(_0x50e391){const _0x2ad85e=_0x28e739;if(!_0x50e391)return;try{const _0x1db152=await db[_0x2ad85e(0x315)]['get'](_0x50e391);if(_0x1db152){if(_0x1db152[_0x2ad85e(0x3ae)]||_0x1db152[_0x2ad85e(0x6ca)])return;const _0x52b1c4=_0x1db152['isStranger']||_0x1db152[_0x2ad85e(0x41d)]||_0x1db152['hiddenInContactsList'];if(!_0x52b1c4)return;}if(!_0x1db152){let _0x176299=![];if(db[_0x2ad85e(0x206)]){const _0x33d8b3=await db[_0x2ad85e(0x206)]['where'](_0x2ad85e(0x4ea))[_0x2ad85e(0x82f)](_0x50e391)[_0x2ad85e(0x5fd)]();_0x176299=_0x33d8b3[_0x2ad85e(0x932)](_0xb6cdae=>_0xb6cdae[_0x2ad85e(0x4d1)]||_0xb6cdae[_0x2ad85e(0x3a5)]||!_0xb6cdae['characterId']);}if(!_0x176299&&db['chatMessages']){const _0x564959=await db['chatMessages'][_0x2ad85e(0x5fd)]();_0x176299=_0x564959[_0x2ad85e(0x932)](_0x50ad81=>normalizeId(_0x50ad81['phoneNumber'])===_0x50e391&&(_0x50ad81[_0x2ad85e(0x2f2)]||_0x50ad81['randomSmsPersona']||!_0x50ad81[_0x2ad85e(0x3ae)]&&(_0x50ad81['type']==='sms'||_0x50ad81[_0x2ad85e(0x3a3)]===_0x2ad85e(0x8e8))));}if(!_0x176299)return;}_0x1db152&&(await db['contacts']['delete'](_0x50e391),console[_0x2ad85e(0x41f)](_0x2ad85e(0x185),_0x50e391));if(db[_0x2ad85e(0x206)]){const _0x5aa7f7=await db[_0x2ad85e(0x206)][_0x2ad85e(0x56a)](_0x2ad85e(0x4ea))[_0x2ad85e(0x82f)](_0x50e391)[_0x2ad85e(0x5a4)]();await bulkDeleteSafe(db[_0x2ad85e(0x206)],_0x5aa7f7);}if(db[_0x2ad85e(0x698)]){const _0x2b5c09=await db[_0x2ad85e(0x698)][_0x2ad85e(0x5fd)](),_0x504bba=_0x2b5c09[_0x2ad85e(0x911)](_0x12ca51=>normalizeId(_0x12ca51['phoneNumber'])===_0x50e391&&!isValidIdValue(_0x12ca51['characterId']))['map'](_0x50f33b=>_0x50f33b['id']);await bulkDeleteSafe(db[_0x2ad85e(0x698)],_0x504bba);}typeof allCallRecordsCache!==_0x2ad85e(0x714)&&(allCallRecordsCache=(allCallRecordsCache||[])[_0x2ad85e(0x911)](_0x1e759e=>normalizeId(_0x1e759e?.[_0x2ad85e(0x4ea)])!==_0x50e391),typeof renderCallRecords==='function'&&await renderCallRecords());}catch(_0x3314aa){console[_0x2ad85e(0x516)]('⚠️\x20清理随机号码数据失败（忽略）:',_0x3314aa);}}function renderImessagePinned(){const _0x52e2f8=_0x28e739,_0x321f64=document[_0x52e2f8(0x761)]('imessagePinnedGrid');if(!_0x321f64)return;const _0x541585=getImessagePinnedContacts();if(_0x541585[_0x52e2f8(0x6ea)]===0x0){_0x321f64['innerHTML']='';const _0x37eec5=document[_0x52e2f8(0x761)](_0x52e2f8(0x6d5));if(_0x37eec5)_0x37eec5[_0x52e2f8(0x577)][_0x52e2f8(0x475)]=_0x52e2f8(0x562);return;}const _0x2a5803=document[_0x52e2f8(0x761)]('imessagePinnedSection');if(_0x2a5803)_0x2a5803[_0x52e2f8(0x577)]['display']=_0x52e2f8(0x78e);_0x321f64['innerHTML']=_0x541585['map']((_0x2f7708,_0x3674a5)=>_0x52e2f8(0x6fa)+_0x2f7708['id']+_0x52e2f8(0x846)+(_0x2f7708['avatarClass']||_0x52e2f8(0x5dc))+_0x52e2f8(0x857)+(_0x2f7708['avatar']?_0x52e2f8(0x888)+_0x2f7708[_0x52e2f8(0x708)]+_0x52e2f8(0x75a):'')+_0x52e2f8(0x8b0)+(_0x2f7708['lastMessage']?_0x52e2f8(0x85e)+(_0x2f7708['bubblePosition']||_0x52e2f8(0x3d0))+'\x22>'+_0x2f7708['lastMessage']+_0x52e2f8(0x611):'')+_0x52e2f8(0x4a7)+(_0x2f7708[_0x52e2f8(0x8e7)]?_0x52e2f8(0x966):'')+_0x52e2f8(0x8dc)+_0x2f7708['name']+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22imessage-pinned-heart\x22>♡</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20')[_0x52e2f8(0x943)]('');}async function renderImessageList(){const _0x11130e=_0x28e739,_0x5bb977=document[_0x11130e(0x761)](_0x11130e(0x477));if(!_0x5bb977)return;const _0x447215=await getImessageMessages();if(_0x447215[_0x11130e(0x6ea)]===0x0){_0x5bb977['innerHTML']=_0x11130e(0x46d);return;}const _0x5a88f6=imessageEditMode;_0x5bb977['innerHTML']=_0x447215['map']((_0x146f81,_0x1c39a9)=>{const _0x3f8946=_0x11130e,_0x3bf049=imessageSelectedItems[_0x3f8946(0x345)](_0x146f81['id']),_0x5b4ec4=_0x3f8946(0x781)+(_0x146f81[_0x3f8946(0x8e7)]?'has-unread':'')+'\x20'+(_0x5a88f6&&_0x3bf049?_0x3f8946(0x6c5):''),_0x3bdc7c=_0x5a88f6?_0x3f8946(0x443)+_0x146f81['id']+_0x3f8946(0x628):'openImessageChat(\x27'+_0x146f81['id']+'\x27)';return _0x3f8946(0x2b1)+_0x5b4ec4+_0x3f8946(0x6c7)+_0x146f81['id']+'\x22\x20onclick=\x22'+_0x3bdc7c+_0x3f8946(0x1a5)+(_0x5a88f6?_0x3f8946(0x594)+(_0x3bf049?_0x3f8946(0x657):'')+_0x3f8946(0x604):'')+_0x3f8946(0x449)+(_0x146f81['unread']?_0x3f8946(0x23f):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-msg-avatar\x20'+(_0x146f81[_0x3f8946(0x340)]||_0x3f8946(0x5dc))+_0x3f8946(0x379)+(_0x146f81[_0x3f8946(0x708)]?_0x3f8946(0x888)+_0x146f81[_0x3f8946(0x708)]+'\x27);\x20background-size:\x20cover;\x22':'')+_0x3f8946(0x24d)+(!_0x146f81[_0x3f8946(0x708)]?'<span>'+(_0x146f81[_0x3f8946(0x90b)]||'')+_0x3f8946(0x975):'')+_0x3f8946(0x72b)+_0x146f81['name']+_0x3f8946(0x7d9)+(_0x146f81[_0x3f8946(0x3b3)]?_0x3f8946(0x889)+_0x146f81[_0x3f8946(0x3b3)]+_0x3f8946(0x975):'')+_0x3f8946(0x7d8)+_0x146f81[_0x3f8946(0x2e1)]+_0x3f8946(0x1c8)+_0x146f81[_0x3f8946(0x69c)]+_0x3f8946(0x91b)+(_0x1c39a9<_0x447215[_0x3f8946(0x6ea)]-0x1?_0x3f8946(0x572):'')+_0x3f8946(0x33f);})[_0x11130e(0x943)]('');}function getImessagePinnedContacts(){return[];}async function getImessageMessages(){const _0x49cdc8=_0x28e739;try{console['log']('📱\x20[iMessage]\x20加载短信会话列表...');const _0x3e9761=await db[_0x49cdc8(0x698)][_0x49cdc8(0x5fd)](),_0x18b949=_0x3e9761['filter'](_0x234313=>{const _0x271493=_0x49cdc8,_0x4e65de=normalizeId(_0x234313[_0x271493(0x3c2)])||'';return _0x4e65de[_0x271493(0x414)](_0x271493(0x62f));});console[_0x49cdc8(0x41f)](_0x49cdc8(0x623),_0x18b949['length'],'条');if(_0x18b949[_0x49cdc8(0x6ea)]===0x0)return[];const _0x3f1ac9=new Map();_0x18b949[_0x49cdc8(0x7b6)](_0x4cbafa=>{const _0x5ba67d=_0x49cdc8,_0x2d0b00=normalizeId(_0x4cbafa[_0x5ba67d(0x3c2)]),_0x2b0f31=_0x2d0b00[_0x5ba67d(0x568)]('sms_','');!_0x3f1ac9['has'](_0x2b0f31)&&_0x3f1ac9[_0x5ba67d(0x790)](_0x2b0f31,{'phoneNumber':_0x2b0f31,'messages':[],'lastTimestamp':0x0});const _0x3e2c4e=_0x3f1ac9['get'](_0x2b0f31);_0x3e2c4e[_0x5ba67d(0x1eb)][_0x5ba67d(0x2c4)](_0x4cbafa);const _0x3c61b6=new Date(_0x4cbafa[_0x5ba67d(0x407)])[_0x5ba67d(0x278)]();_0x3c61b6>_0x3e2c4e[_0x5ba67d(0x725)]&&(_0x3e2c4e[_0x5ba67d(0x725)]=_0x3c61b6,_0x3e2c4e['lastMessage']=_0x4cbafa);}),console['log'](_0x49cdc8(0x47d),_0x3f1ac9[_0x49cdc8(0x2da)]);const _0x2acb5b=[];for(const [_0x15d931,_0x553482]of _0x3f1ac9){let _0x3bda0e=_0x15d931,_0x4cf7f6=null,_0x279dce=_0x49cdc8(0x5dc);try{const _0x4c1e0c=await db[_0x49cdc8(0x315)][_0x49cdc8(0x309)](_0x15d931);if(_0x4c1e0c){_0x3bda0e=_0x4c1e0c[_0x49cdc8(0x8e5)]||_0x15d931,_0x4cf7f6=_0x4c1e0c[_0x49cdc8(0x691)]||null;const _0xf3ed37=_0x3bda0e[_0x49cdc8(0x5ed)](0x0)[_0x49cdc8(0x6eb)]();if('aeiou'[_0x49cdc8(0x44b)](_0xf3ed37))_0x279dce=_0x49cdc8(0x51c);else _0x49cdc8(0x95e)['includes'](_0xf3ed37)&&(_0x279dce=_0x49cdc8(0x318));}}catch(_0x1f8c96){console['log'](_0x49cdc8(0x5f3),_0x15d931);}const _0x57009d=new Date(_0x553482[_0x49cdc8(0x725)]),_0x2a7389=formatImessageTime(_0x57009d);let _0x4bd0a7=_0x553482[_0x49cdc8(0x7d5)]?.[_0x49cdc8(0x632)]||'';_0x4bd0a7[_0x49cdc8(0x6ea)]>0x28&&(_0x4bd0a7=_0x4bd0a7[_0x49cdc8(0x83d)](0x0,0x28)+_0x49cdc8(0x68b));const _0x165972=_0x3bda0e[_0x49cdc8(0x5ed)](0x0)['toUpperCase']();_0x2acb5b['push']({'id':_0x15d931,'name':_0x3bda0e,'avatar':_0x4cf7f6,'avatarClass':_0x279dce,'initial':_0x165972,'time':_0x2a7389,'preview':_0x4bd0a7,'unread':![],'heart':null,'lastTimestamp':_0x553482[_0x49cdc8(0x725)]});}return _0x2acb5b[_0x49cdc8(0x8da)]((_0x1baa6b,_0x300d29)=>_0x300d29[_0x49cdc8(0x725)]-_0x1baa6b[_0x49cdc8(0x725)]),console['log'](_0x49cdc8(0x22b),_0x2acb5b[_0x49cdc8(0x6ea)],'个'),_0x2acb5b;}catch(_0x2166cc){return console['error'](_0x49cdc8(0x592),_0x2166cc),[];}}function formatImessageTime(_0xf460ae){const _0x3ed67e=_0x28e739,_0x5ea806=new Date(),_0x31dfac=new Date(_0x5ea806[_0x3ed67e(0x18f)](),_0x5ea806[_0x3ed67e(0x36d)](),_0x5ea806[_0x3ed67e(0x8b9)]()),_0x368874=new Date(_0x31dfac[_0x3ed67e(0x278)]()-0x18*0x3c*0x3c*0x3e8),_0x8a633c=new Date(_0xf460ae['getFullYear'](),_0xf460ae[_0x3ed67e(0x36d)](),_0xf460ae[_0x3ed67e(0x8b9)]());if(_0x8a633c[_0x3ed67e(0x278)]()===_0x31dfac[_0x3ed67e(0x278)]())return _0xf460ae['toLocaleTimeString'](_0x3ed67e(0x6f0),{'hour':_0x3ed67e(0x4eb),'minute':_0x3ed67e(0x842),'hour12':!![]});else{if(_0x8a633c['getTime']()===_0x368874['getTime']())return _0x3ed67e(0x4d5);else return _0x5ea806[_0x3ed67e(0x278)]()-_0xf460ae['getTime']()<0x7*0x18*0x3c*0x3c*0x3e8?_0xf460ae[_0x3ed67e(0x180)](_0x3ed67e(0x6f0),{'weekday':_0x3ed67e(0x7f1)}):_0xf460ae['toLocaleDateString'](_0x3ed67e(0x6f0),{'month':_0x3ed67e(0x2ff),'day':_0x3ed67e(0x4eb)});}}async function openImessageChat(_0x9d9ac7){const _0x293f4e=_0x28e739;console[_0x293f4e(0x41f)](_0x293f4e(0x898),_0x9d9ac7);try{smsOpenedFrom=_0x293f4e(0x3f0);let _0x22e44d=_0x9d9ac7;const _0x544ac1=await db['contacts'][_0x293f4e(0x309)](_0x9d9ac7);_0x544ac1&&(_0x22e44d=_0x544ac1[_0x293f4e(0x8e5)]||_0x9d9ac7);const _0x4cfeaa=document['getElementById']('phoneScreen');_0x4cfeaa&&_0x4cfeaa[_0x293f4e(0x421)][_0x293f4e(0x5e3)](_0x293f4e(0x525));const _0x129c9a=document[_0x293f4e(0x761)](_0x293f4e(0x890));_0x129c9a&&_0x129c9a['classList']['remove'](_0x293f4e(0x525)),await openSmsDetail(_0x9d9ac7,_0x22e44d);}catch(_0x423adf){console['error'](_0x293f4e(0x757),_0x423adf),showIslandNotification('错误',_0x293f4e(0x8a1),_0x293f4e(0x56c));}}console['log']('✅\x20iMessage模块加载完成');function getBaobaobookCategories(){const _0x287f0b=_0x28e739;try{const _0x39181e=localStorage[_0x287f0b(0x488)]('baobaobookCategories');return _0x39181e?JSON[_0x287f0b(0x4de)](_0x39181e):[];}catch(_0x429de8){return console[_0x287f0b(0x56c)](_0x287f0b(0x26d),_0x429de8),[];}}function saveBaobaobookCategories(_0x12d78a){const _0x269efb=_0x28e739;try{localStorage[_0x269efb(0x676)](_0x269efb(0x948),JSON['stringify'](_0x12d78a)),console['log']('[百宝书]\x20分类已保存:',_0x12d78a);}catch(_0x10e61b){console['error'](_0x269efb(0x752),_0x10e61b),showIslandNotification('错误',_0x269efb(0x59b),_0x269efb(0x56c));}}function showBaobaobookCategoryManager(){const _0x13185f=_0x28e739;console[_0x13185f(0x41f)](_0x13185f(0x316));const _0x12b665=document[_0x13185f(0x761)](_0x13185f(0x905));_0x12b665&&(_0x12b665[_0x13185f(0x421)]['add'](_0x13185f(0x525)),loadBaobaobookCategoryList(),vibrateDevice());}function closeBaobaobookCategoryManager(){const _0x39bd27=_0x28e739;console['log'](_0x39bd27(0x910));const _0x11eb76=document[_0x39bd27(0x761)](_0x39bd27(0x905));_0x11eb76&&(_0x11eb76[_0x39bd27(0x421)][_0x39bd27(0x403)](_0x39bd27(0x525)),vibrateDevice());}function loadBaobaobookCategoryList(){const _0x4078c6=_0x28e739,_0x5bf61f=getBaobaobookCategories(),_0x22a745=document[_0x4078c6(0x761)]('baobaobookCategoryManagementList');if(!_0x22a745)return;if(_0x5bf61f[_0x4078c6(0x6ea)]===0x0){_0x22a745['innerHTML']=_0x4078c6(0x2e2);return;}let _0x37104f='';_0x5bf61f[_0x4078c6(0x7b6)]((_0x5aaeb8,_0x450546)=>{const _0x13999e=_0x4078c6;_0x37104f+=_0x13999e(0x2f8)+_0x5aaeb8[_0x13999e(0x76a)]+_0x13999e(0x300)+_0x5aaeb8[_0x13999e(0x76a)]+_0x13999e(0x920)+new Date(_0x5aaeb8[_0x13999e(0x42b)])[_0x13999e(0x180)]()+_0x13999e(0x3ba)+_0x5aaeb8[_0x13999e(0x76a)]+_0x13999e(0x8b6)+_0x5aaeb8[_0x13999e(0x76a)]+_0x13999e(0x670);}),_0x22a745['innerHTML']=_0x37104f;}function createBaobaobookCategory(){const _0x2fbe0f=_0x28e739,_0x4c1fdb=document[_0x2fbe0f(0x761)](_0x2fbe0f(0x6d1));if(!_0x4c1fdb)return;const _0x23b8c9=_0x4c1fdb[_0x2fbe0f(0x29c)]['trim']();if(!_0x23b8c9){showIslandNotification('提示',_0x2fbe0f(0x636),'info');return;}if(_0x23b8c9[_0x2fbe0f(0x6ea)]<0x1||_0x23b8c9[_0x2fbe0f(0x6ea)]>0x14){showIslandNotification('提示','分类名称长度应在1-20字符之间',_0x2fbe0f(0x537));return;}const _0x51aed2=getBaobaobookCategories();if(_0x51aed2['some'](_0x58b1a4=>_0x58b1a4[_0x2fbe0f(0x76a)]===_0x23b8c9)){showIslandNotification('提示',_0x2fbe0f(0x57b),_0x2fbe0f(0x537));return;}const _0x4fd5d9={'id':'cat_'+Date['now'](),'name':_0x23b8c9,'createdAt':Date[_0x2fbe0f(0x2cb)]()};_0x51aed2[_0x2fbe0f(0x2c4)](_0x4fd5d9),saveBaobaobookCategories(_0x51aed2),loadBaobaobookCategoryList(),updateBaobaobookCategoryTabs(),_0x4c1fdb['value']='',showIslandNotification('成功','分类\x22'+_0x23b8c9+_0x2fbe0f(0x625),_0x2fbe0f(0x4bc)),vibrateDevice(),console[_0x2fbe0f(0x41f)]('[百宝书]\x20创建分类:',_0x4fd5d9);}function deleteBaobaobookCategoryWithConfirm(_0x540457){const _0x1b1aed=_0x28e739,_0x2e44e2=_0x1b1aed(0x862)+_0x540457+_0x1b1aed(0x703)+_0x540457+_0x1b1aed(0x7b8),_0x16f8b8=document[_0x1b1aed(0x5e5)](_0x1b1aed(0x6a4));_0x16f8b8['innerHTML']=_0x2e44e2,document[_0x1b1aed(0x4c0)][_0x1b1aed(0x3de)](_0x16f8b8[_0x1b1aed(0x5b7)]);}window[_0x28e739(0x2a8)]=function(){const _0x1b3e0d=_0x28e739,_0x1d4dab=document['getElementById'](_0x1b3e0d(0x693));_0x1d4dab&&(_0x1d4dab['classList']['remove']('active'),setTimeout(()=>_0x1d4dab['remove'](),0x12c));},window[_0x28e739(0x1fc)]=function(_0x4fe31a){const _0x2a3934=_0x28e739,_0x1023d9=getBaobaobookCategories(),_0x286da7=_0x1023d9['filter'](_0x229272=>_0x229272[_0x2a3934(0x76a)]!==_0x4fe31a);if(_0x286da7[_0x2a3934(0x6ea)]===_0x1023d9[_0x2a3934(0x6ea)]){showIslandNotification('错误',_0x2a3934(0x32e),_0x2a3934(0x56c)),closeDeleteCategoryConfirm();return;}saveBaobaobookCategories(_0x286da7),loadBaobaobookCategoryList(),updateBaobaobookCategoryTabs(),showIslandNotification('成功','分类\x22'+_0x4fe31a+_0x2a3934(0x791),'check'),vibrateDevice(),closeDeleteCategoryConfirm(),console[_0x2a3934(0x41f)]('[百宝书]\x20删除分类:',_0x4fe31a);};function renameBaobaobookCategoryPrompt(_0x101fed){const _0xc6b283=_0x28e739,_0xa020ac=prompt(_0xc6b283(0x6d9),_0x101fed);if(!_0xa020ac||_0xa020ac===_0x101fed)return;const _0xf8d6d9=_0xa020ac[_0xc6b283(0x28e)]();if(!_0xf8d6d9){showIslandNotification('提示','分类名称不能为空',_0xc6b283(0x537));return;}if(_0xf8d6d9[_0xc6b283(0x6ea)]<0x1||_0xf8d6d9['length']>0x14){showIslandNotification('提示',_0xc6b283(0x3d8),_0xc6b283(0x537));return;}const _0x2a9b8c=getBaobaobookCategories();if(_0x2a9b8c[_0xc6b283(0x932)](_0x367f75=>_0x367f75[_0xc6b283(0x76a)]===_0xf8d6d9)){showIslandNotification('提示','分类名称已存在',_0xc6b283(0x537));return;}const _0x300f3a=_0x2a9b8c[_0xc6b283(0x30c)](_0x458af0=>_0x458af0[_0xc6b283(0x76a)]===_0x101fed);_0x300f3a&&(_0x300f3a[_0xc6b283(0x76a)]=_0xf8d6d9,saveBaobaobookCategories(_0x2a9b8c),loadBaobaobookCategoryList(),updateBaobaobookCategoryTabs(),showIslandNotification('成功',_0xc6b283(0x3a8)+_0xf8d6d9+'\x22','check'),vibrateDevice(),console[_0xc6b283(0x41f)](_0xc6b283(0x67d),_0x101fed,'->',_0xf8d6d9));}function updateBaobaobookCategoryTabs(){const _0x3cebd4=_0x28e739,_0x2a9f80=getBaobaobookCategories(),_0x4e8f52=document[_0x3cebd4(0x761)](_0x3cebd4(0x32b));if(!_0x4e8f52)return;let _0xea1843='<div\x20class=\x22worldview-tab\x20active\x22\x20data-category-id=\x22all\x22\x20onclick=\x22filterBaobaobookByCategory(\x27all\x27)\x22>全部</div>';_0x2a9f80[_0x3cebd4(0x7b6)](_0x32c582=>{const _0xe5ea80=_0x3cebd4;_0xea1843+=_0xe5ea80(0x474)+_0x32c582['id']+'\x22\x20onclick=\x22filterBaobaobookByCategory(\x27'+_0x32c582['id']+_0xe5ea80(0x666)+_0x32c582[_0xe5ea80(0x76a)]+_0xe5ea80(0x611);}),_0x4e8f52[_0x3cebd4(0x5b8)]=_0xea1843,console[_0x3cebd4(0x41f)](_0x3cebd4(0x423));}function filterBaobaobookByCategory(_0x51e2dd){const _0x10edd3=_0x28e739;console[_0x10edd3(0x41f)](_0x10edd3(0x79a),_0x51e2dd);const _0x6a7347=document[_0x10edd3(0x42c)](_0x10edd3(0x78c));_0x6a7347[_0x10edd3(0x7b6)](_0xdc90fa=>{const _0xb7bc39=_0x10edd3;_0xdc90fa['getAttribute']('data-category-id')===_0x51e2dd?_0xdc90fa[_0xb7bc39(0x421)][_0xb7bc39(0x5e3)](_0xb7bc39(0x525)):_0xdc90fa[_0xb7bc39(0x421)][_0xb7bc39(0x403)](_0xb7bc39(0x525));}),renderBaobaobookEntries(_0x51e2dd),vibrateDevice();}function getBaobaobookEntries(){const _0x9f337d=_0x28e739;try{const _0x5be279=localStorage[_0x9f337d(0x488)]('baobaobookEntries');return _0x5be279?JSON[_0x9f337d(0x4de)](_0x5be279):[];}catch(_0x334a36){return console[_0x9f337d(0x56c)](_0x9f337d(0x4c3),_0x334a36),[];}}function saveBaobaobookEntries(_0x17c12d){const _0x248591=_0x28e739;try{localStorage[_0x248591(0x676)](_0x248591(0x550),JSON[_0x248591(0x8f7)](_0x17c12d)),console[_0x248591(0x41f)]('✅\x20百宝书条目已保存:',_0x17c12d[_0x248591(0x6ea)]);}catch(_0x9d0cc1){console[_0x248591(0x56c)]('❌\x20保存百宝书条目失败:',_0x9d0cc1),showIslandNotification('错误',_0x248591(0x678),_0x248591(0x537));}}let currentEditingEntryId=null;function loadBaobaobookCategoryOptions(_0x5b5e93,_0xdb0af1=null){const _0x4961f6=_0x28e739,_0x2d461c=getBaobaobookCategories();_0x5b5e93[_0x4961f6(0x5b8)]=_0x4961f6(0x1a4),_0x2d461c['forEach'](_0x14c04c=>{const _0x5e9b71=_0x4961f6,_0x379331=document['createElement']('option');_0x379331[_0x5e9b71(0x29c)]=_0x14c04c['id'],_0x379331[_0x5e9b71(0x7dc)]=_0x14c04c[_0x5e9b71(0x76a)],_0x5b5e93['appendChild'](_0x379331);});if(_0xdb0af1)_0x5b5e93[_0x4961f6(0x29c)]=_0xdb0af1;else{const _0x560703=document['querySelector'](_0x4961f6(0x1c5));if(_0x560703){const _0x4602fa=_0x560703[_0x4961f6(0x672)][_0x4961f6(0x335)];_0x4602fa&&_0x4602fa!=='all'&&(_0x5b5e93[_0x4961f6(0x29c)]=_0x4602fa);}}}function setDrawerCreateMode(){const _0x5d284c=_0x28e739;document[_0x5d284c(0x768)](_0x5d284c(0x86d))['textContent']=_0x5d284c(0x5f2),document[_0x5d284c(0x768)](_0x5d284c(0x485))[_0x5d284c(0x7dc)]='记录你的知识到百宝书';const _0x21434b=document[_0x5d284c(0x768)](_0x5d284c(0x979));_0x21434b['textContent']='取消',_0x21434b[_0x5d284c(0x51f)]=_0x5d284c(0x2c3),_0x21434b['onclick']=closeCreateBaobaobookModal;}function setDrawerEditMode(){const _0xddd49f=_0x28e739;document[_0xddd49f(0x768)](_0xddd49f(0x86d))['textContent']=_0xddd49f(0x770),document[_0xddd49f(0x768)](_0xddd49f(0x485))[_0xddd49f(0x7dc)]=_0xddd49f(0x43c);const _0x1f3d86=document['querySelector'](_0xddd49f(0x979));_0x1f3d86['textContent']='删除',_0x1f3d86[_0xddd49f(0x51f)]=_0xddd49f(0x553),_0x1f3d86[_0xddd49f(0x462)]=deleteBaobaobookEntry;}window[_0x28e739(0x2b0)]=function(){const _0x5a278b=_0x28e739,_0x42b29e=document[_0x5a278b(0x768)](_0x5a278b(0x5d0)),_0x343d3e=document[_0x5a278b(0x768)](_0x5a278b(0x8ce));if(!_0x42b29e){console[_0x5a278b(0x56c)]('找不到条目抽屉');return;}currentEditingEntryId=null,setDrawerCreateMode(),document['querySelector'](_0x5a278b(0x37c))[_0x5a278b(0x29c)]='',document[_0x5a278b(0x768)](_0x5a278b(0x19b))[_0x5a278b(0x29c)]='',document[_0x5a278b(0x768)](_0x5a278b(0x7bc))['value']='',updateBaobaobookCharCount(),_0x343d3e&&loadBaobaobookCategoryOptions(_0x343d3e),_0x42b29e[_0x5a278b(0x421)]['add'](_0x5a278b(0x525)),vibrateDevice(),setTimeout(()=>{const _0x474803=_0x5a278b;document[_0x474803(0x768)]('#baobaobookEntryNameInput')?.[_0x474803(0x7bf)]();},0x12c);},window['showEditBaobaobookModal']=function(_0x4ef078){const _0x5e50c4=_0x28e739,_0x1a9277=getBaobaobookEntries(),_0x5303b1=_0x1a9277['find'](_0x3881a0=>_0x3881a0['id']===_0x4ef078);if(!_0x5303b1){showIslandNotification('错误',_0x5e50c4(0x773),'error');return;}const _0x12a8d6=document[_0x5e50c4(0x768)](_0x5e50c4(0x5d0)),_0x2007fb=document['querySelector'](_0x5e50c4(0x8ce));if(!_0x12a8d6){console['error']('找不到条目抽屉');return;}currentEditingEntryId=_0x4ef078,setDrawerEditMode(),document['querySelector'](_0x5e50c4(0x37c))[_0x5e50c4(0x29c)]=_0x5303b1[_0x5e50c4(0x76a)],document[_0x5e50c4(0x768)]('#baobaobookEntryKeywordsInput')[_0x5e50c4(0x29c)]=_0x5303b1[_0x5e50c4(0x453)]['join'](',\x20'),document[_0x5e50c4(0x768)]('#baobaobookEntryContentTextarea')[_0x5e50c4(0x29c)]=_0x5303b1[_0x5e50c4(0x632)],updateBaobaobookCharCount();_0x2007fb&&loadBaobaobookCategoryOptions(_0x2007fb,_0x5303b1[_0x5e50c4(0x335)]);const _0x3c6472=document['querySelector'](_0x5e50c4(0x47b));_0x3c6472&&(_0x3c6472[_0x5e50c4(0x29c)]=_0x5303b1[_0x5e50c4(0x92c)]||_0x5e50c4(0x2b3));const _0x2b6575=_0x5303b1[_0x5e50c4(0x780)]||[],_0x541413=document[_0x5e50c4(0x768)](_0x5e50c4(0x3b1)),_0x437390=document['querySelector'](_0x5e50c4(0x215)),_0x488056=document[_0x5e50c4(0x768)]('#baobaobookEntrySceneSms');if(_0x541413)_0x541413['checked']=_0x2b6575[_0x5e50c4(0x44b)](_0x5e50c4(0x864));if(_0x437390)_0x437390[_0x5e50c4(0x657)]=_0x2b6575[_0x5e50c4(0x44b)](_0x5e50c4(0x8e8));if(_0x488056)_0x488056[_0x5e50c4(0x657)]=_0x2b6575[_0x5e50c4(0x44b)](_0x5e50c4(0x257));_0x12a8d6[_0x5e50c4(0x421)]['add'](_0x5e50c4(0x525)),vibrateDevice();},window['closeCreateBaobaobookModal']=function(){const _0x5bd6ea=_0x28e739,_0x10a4f1=document[_0x5bd6ea(0x768)](_0x5bd6ea(0x5d0));_0x10a4f1&&(_0x10a4f1[_0x5bd6ea(0x421)][_0x5bd6ea(0x403)]('active'),currentEditingEntryId=null,vibrateDevice());},window[_0x28e739(0x4f9)]=function(){const _0x449067=_0x28e739,_0x598dd8=document['querySelector'](_0x449067(0x7bc)),_0x12d448=document['querySelector'](_0x449067(0x49b));if(_0x598dd8&&_0x12d448){const _0x233f6e=_0x598dd8[_0x449067(0x29c)][_0x449067(0x6ea)];_0x12d448['textContent']=_0x233f6e;}},window['saveBaobaobookEntry']=function(){const _0x5b610a=_0x28e739,_0x5ba70b=document[_0x5b610a(0x768)]('#baobaobookEntryNameInput'),_0x3d2e27=document[_0x5b610a(0x768)](_0x5b610a(0x19b)),_0x5c6c6b=document['querySelector']('#baobaobookEntryCategorySelect'),_0x5c1583=document[_0x5b610a(0x768)](_0x5b610a(0x47b)),_0x3d42dc=document[_0x5b610a(0x768)](_0x5b610a(0x7bc)),_0x34d0ac=document[_0x5b610a(0x768)](_0x5b610a(0x3b1)),_0x2d28eb=document['querySelector'](_0x5b610a(0x215)),_0x3f748a=document[_0x5b610a(0x768)](_0x5b610a(0x38e)),_0x43295f=_0x5ba70b['value'][_0x5b610a(0x28e)]();if(!_0x43295f){showIslandNotification('提示',_0x5b610a(0x65f),_0x5b610a(0x537)),_0x5ba70b['focus'](),vibrateDevice();return;}if(_0x43295f[_0x5b610a(0x6ea)]>0x32){showIslandNotification('提示',_0x5b610a(0x4d8),_0x5b610a(0x537)),_0x5ba70b['focus'](),vibrateDevice();return;}const _0x131848=_0x3d42dc['value'][_0x5b610a(0x28e)]();if(!_0x131848){showIslandNotification('提示',_0x5b610a(0x87e),_0x5b610a(0x537)),_0x3d42dc[_0x5b610a(0x7bf)](),vibrateDevice();return;}const _0x23a44c=_0x3d2e27[_0x5b610a(0x29c)]['trim']()[_0x5b610a(0x4c7)](',')[_0x5b610a(0x962)](_0x5cc632=>_0x5cc632['trim']())[_0x5b610a(0x911)](_0x2921bb=>_0x2921bb),_0x519886=[];if(_0x34d0ac&&_0x34d0ac['checked'])_0x519886[_0x5b610a(0x2c4)](_0x5b610a(0x864));if(_0x2d28eb&&_0x2d28eb[_0x5b610a(0x657)])_0x519886['push'](_0x5b610a(0x8e8));if(_0x3f748a&&_0x3f748a[_0x5b610a(0x657)])_0x519886[_0x5b610a(0x2c4)](_0x5b610a(0x257));const _0x405cfe=getBaobaobookEntries();if(currentEditingEntryId){const _0x4675ce=_0x405cfe[_0x5b610a(0x363)](_0x36ee74=>_0x36ee74['id']===currentEditingEntryId);if(_0x4675ce===-0x1){showIslandNotification('错误',_0x5b610a(0x773),_0x5b610a(0x56c));return;}_0x405cfe[_0x4675ce][_0x5b610a(0x76a)]=_0x43295f,_0x405cfe[_0x4675ce]['keywords']=_0x23a44c,_0x405cfe[_0x4675ce]['categoryId']=_0x5c6c6b['value']||'',_0x405cfe[_0x4675ce][_0x5b610a(0x92c)]=_0x5c1583[_0x5b610a(0x29c)]||_0x5b610a(0x2b3),_0x405cfe[_0x4675ce][_0x5b610a(0x780)]=_0x519886,_0x405cfe[_0x4675ce]['content']=_0x131848,_0x405cfe[_0x4675ce]['updatedAt']=Date[_0x5b610a(0x2cb)](),saveBaobaobookEntries(_0x405cfe),showIslandNotification('成功',_0x5b610a(0x6d4),_0x5b610a(0x4bc));}else{const _0x4fcdc1={'id':_0x5b610a(0x237)+Date[_0x5b610a(0x2cb)]()+'_'+Math['random']()['toString'](0x24)[_0x5b610a(0x2d3)](0x2,0x9),'name':_0x43295f,'keywords':_0x23a44c,'categoryId':_0x5c6c6b[_0x5b610a(0x29c)]||'','position':_0x5c1583[_0x5b610a(0x29c)]||_0x5b610a(0x2b3),'defaultScenes':_0x519886,'content':_0x131848,'createdAt':Date[_0x5b610a(0x2cb)](),'updatedAt':Date[_0x5b610a(0x2cb)]()};_0x405cfe['push'](_0x4fcdc1),saveBaobaobookEntries(_0x405cfe),showIslandNotification('成功','条目创建成功',_0x5b610a(0x4bc));}closeCreateBaobaobookModal();const _0x5667af=document[_0x5b610a(0x768)](_0x5b610a(0x1c5)),_0x27897e=_0x5667af?_0x5667af[_0x5b610a(0x672)][_0x5b610a(0x335)]:_0x5b610a(0x481);renderBaobaobookEntries(_0x27897e),vibrateDevice();},window[_0x28e739(0x1de)]=function(){const _0x7e9c8f=_0x28e739;if(!currentEditingEntryId)return;if(!confirm(_0x7e9c8f(0x42d)))return;const _0x2e15f8=getBaobaobookEntries(),_0x52120b=_0x2e15f8[_0x7e9c8f(0x911)](_0x333879=>_0x333879['id']!==currentEditingEntryId);if(_0x52120b[_0x7e9c8f(0x6ea)]===_0x2e15f8[_0x7e9c8f(0x6ea)]){showIslandNotification('错误',_0x7e9c8f(0x773),'error');return;}saveBaobaobookEntries(_0x52120b),closeCreateBaobaobookModal();const _0x17226e=document[_0x7e9c8f(0x768)]('.worldview-tab.active[data-category-id]'),_0x19d6fc=_0x17226e?_0x17226e[_0x7e9c8f(0x672)]['categoryId']:_0x7e9c8f(0x481);renderBaobaobookEntries(_0x19d6fc),showIslandNotification('成功',_0x7e9c8f(0x524),_0x7e9c8f(0x4bc)),vibrateDevice();};function renderBaobaobookEntries(_0x339f39=_0x28e739(0x481)){const _0x854876=_0x28e739,_0x4ef10a=document['querySelector'](_0x854876(0x6f8));if(!_0x4ef10a){console['error']('找不到百宝书容器');return;}const _0x130805=getBaobaobookEntries();let _0x2b68db=_0x130805;_0x339f39&&_0x339f39!==_0x854876(0x481)&&(_0x2b68db=_0x130805['filter'](_0x2b7afc=>_0x2b7afc[_0x854876(0x335)]===_0x339f39));_0x4ef10a[_0x854876(0x5b8)]='';const _0x30aa21=document[_0x854876(0x5e5)](_0x854876(0x6a4));_0x30aa21[_0x854876(0x51f)]=_0x854876(0x754),_0x30aa21[_0x854876(0x462)]=window[_0x854876(0x2b0)],_0x30aa21[_0x854876(0x5b8)]=_0x854876(0x232),_0x4ef10a['appendChild'](_0x30aa21);if(_0x2b68db[_0x854876(0x6ea)]===0x0){const _0x59bea1=document[_0x854876(0x5e5)](_0x854876(0x6a4));_0x59bea1[_0x854876(0x51f)]=_0x854876(0x4b8),_0x59bea1[_0x854876(0x5b8)]=_0x854876(0x276),_0x4ef10a['appendChild'](_0x59bea1);return;}const _0x529fd0=document[_0x854876(0x5e5)](_0x854876(0x6a4));_0x529fd0[_0x854876(0x51f)]='baobaobook-entry-list';const _0x3829f4=getBaobaobookCategories();_0x2b68db['forEach'](_0x537165=>{const _0x55ee55=_0x854876,_0x9fd033=document[_0x55ee55(0x5e5)](_0x55ee55(0x6a4));_0x9fd033[_0x55ee55(0x51f)]='baobaobook-entry-item',_0x9fd033[_0x55ee55(0x672)]['entryId']=_0x537165['id'];const _0x8e1427=_0x3829f4[_0x55ee55(0x30c)](_0x1be0db=>_0x1be0db['id']===_0x537165[_0x55ee55(0x335)]),_0x220cc2=_0x8e1427?_0x8e1427[_0x55ee55(0x76a)]:_0x55ee55(0x55e),_0x262f30=_0x537165['name'][_0x55ee55(0x5ed)](0x0)[_0x55ee55(0x8fa)](),_0x2850b8=_0x537165[_0x55ee55(0x453)]['slice'](0x0,0x3)[_0x55ee55(0x962)](_0x1be7e1=>'<span\x20class=\x22baobaobook-entry-keyword\x22>'+escapeHtml(_0x1be7e1)+_0x55ee55(0x975))[_0x55ee55(0x943)](''),_0x19bc58=_0x537165[_0x55ee55(0x632)][_0x55ee55(0x6ea)]>0x3c?_0x537165[_0x55ee55(0x632)][_0x55ee55(0x83d)](0x0,0x3c)+_0x55ee55(0x68b):_0x537165['content'];_0x9fd033['innerHTML']=_0x55ee55(0x480)+_0x262f30+_0x55ee55(0x8bc)+escapeHtml(_0x537165[_0x55ee55(0x76a)])+_0x55ee55(0x70d)+escapeHtml(_0x220cc2)+_0x55ee55(0x1f9)+(_0x537165[_0x55ee55(0x453)][_0x55ee55(0x6ea)]>0x0?'<div\x20class=\x22baobaobook-entry-keywords\x22>'+_0x2850b8+_0x55ee55(0x611):'')+_0x55ee55(0x7a9)+escapeHtml(_0x19bc58)+_0x55ee55(0x294),_0x9fd033[_0x55ee55(0x55d)](_0x55ee55(0x7bd),()=>{showBaobaobookEntryDetail(_0x537165['id']);}),_0x529fd0[_0x55ee55(0x3de)](_0x9fd033);}),_0x4ef10a['appendChild'](_0x529fd0),console[_0x854876(0x41f)](_0x854876(0x5fc)+_0x2b68db[_0x854876(0x6ea)]+'\x20个百宝书条目');}function showBaobaobookEntryDetail(_0x14989c){showEditBaobaobookModal(_0x14989c);}const entryContentTextarea=document[_0x28e739(0x768)](_0x28e739(0x7bc));entryContentTextarea&&entryContentTextarea[_0x28e739(0x55d)](_0x28e739(0x914),updateBaobaobookCharCount);const createOverlay=document[_0x28e739(0x768)](_0x28e739(0x5d0));createOverlay&&createOverlay[_0x28e739(0x55d)](_0x28e739(0x7bd),_0x31f2d3=>{_0x31f2d3['target']===createOverlay&&closeCreateBaobaobookModal();});console[_0x28e739(0x41f)](_0x28e739(0x674)),console[_0x28e739(0x41f)](_0x28e739(0x6c3));let currentGalleryCategoryId=null;async function openImageGalleryDrawer(){const _0x4045a0=_0x28e739;console[_0x4045a0(0x41f)](_0x4045a0(0x4dc));const _0x4d2825=document[_0x4045a0(0x761)](_0x4045a0(0x391));if(!_0x4d2825)return;const _0xe9dd34=document[_0x4045a0(0x761)](_0x4045a0(0x231)),_0x354c52=document[_0x4045a0(0x761)](_0x4045a0(0x630));if(_0xe9dd34)_0xe9dd34[_0x4045a0(0x577)][_0x4045a0(0x475)]=_0x4045a0(0x78e);if(_0x354c52)_0x354c52[_0x4045a0(0x421)][_0x4045a0(0x403)](_0x4045a0(0x525));await loadImageGalleryCategories(),await populateGalleryCharacterSelect(),_0x4d2825[_0x4045a0(0x421)]['add'](_0x4045a0(0x525));}function closeImageGalleryDrawer(){const _0x5d121f=_0x28e739,_0x264d47=document[_0x5d121f(0x761)](_0x5d121f(0x391));if(_0x264d47)_0x264d47['classList'][_0x5d121f(0x403)](_0x5d121f(0x525));}function closeImageGalleryDrawerOnOverlay(_0x3f56e1){const _0x4b8cf3=_0x28e739;_0x3f56e1[_0x4b8cf3(0x6e4)]['id']==='imageGalleryDrawer'&&closeImageGalleryDrawer();}async function populateGalleryCharacterSelect(){const _0x376af4=_0x28e739,_0x361e88=document[_0x376af4(0x761)](_0x376af4(0x534));if(!_0x361e88)return;_0x361e88[_0x376af4(0x5b8)]=_0x376af4(0x18a);try{const _0x293481=await db[_0x376af4(0x183)]['toArray'](),_0x484eaa=getUserCreatedCharactersFromChats(_0x293481);_0x484eaa[_0x376af4(0x7b6)](_0x126957=>{const _0xe1916a=_0x376af4,_0xc76eb1=document['createElement'](_0xe1916a(0x2bd));_0xc76eb1[_0xe1916a(0x29c)]=_0x126957['id'],_0xc76eb1[_0xe1916a(0x7dc)]=_0x126957[_0xe1916a(0x76a)]||_0xe1916a(0x598),_0x361e88[_0xe1916a(0x3de)](_0xc76eb1);});}catch(_0x23b9f6){console[_0x376af4(0x56c)](_0x376af4(0x4c2),_0x23b9f6);}}async function loadImageGalleryCategories(){const _0x54559f=_0x28e739,_0x3a24ee=document[_0x54559f(0x761)](_0x54559f(0x8c6));if(!_0x3a24ee)return;try{const _0x245f14=await db['imageGalleries'][_0x54559f(0x5fd)]();if(_0x245f14['length']===0x0){_0x3a24ee[_0x54559f(0x5b8)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22image-gallery-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22><rect\x20x=\x223\x22\x20y=\x223\x22\x20width=\x2218\x22\x20height=\x2218\x22\x20rx=\x222\x22\x20ry=\x222\x22/><circle\x20cx=\x228.5\x22\x20cy=\x228.5\x22\x20r=\x221.5\x22/><polyline\x20points=\x2221\x2015\x2016\x2010\x205\x2021\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>暂无图库分类<br>创建一个分类来开始管理图片</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';return;}const _0x5079b4=await db[_0x54559f(0x183)][_0x54559f(0x5fd)](),_0x236f7c={};getUserCreatedCharactersFromChats(_0x5079b4)[_0x54559f(0x7b6)](_0x4b6213=>{const _0x2163fd=_0x54559f;_0x236f7c[_0x4b6213['id']]=_0x4b6213[_0x2163fd(0x76a)]||'未命名';});let _0x4a8961='';_0x245f14[_0x54559f(0x7b6)](_0x4157b4=>{const _0x458b18=_0x54559f,_0x538464=(_0x4157b4[_0x458b18(0x6e1)]||[])[_0x458b18(0x6ea)],_0x6fac65=_0x4157b4[_0x458b18(0x6e1)]&&_0x4157b4[_0x458b18(0x6e1)]['length']>0x0?_0x4157b4['images'][0x0][_0x458b18(0x7ac)]:null,_0x273c36=_0x4157b4[_0x458b18(0x3ae)]?_0x236f7c[_0x4157b4[_0x458b18(0x3ae)]]:null,_0x53b7ee=_0x273c36?'<span\x20class=\x22image-gallery-category-badge\x22>'+_0x273c36+'</span>':_0x458b18(0x6b5);_0x4a8961+=_0x458b18(0x5cd)+(_0x4157b4[_0x458b18(0x7c9)]===![]?_0x458b18(0x8f5):'')+'\x22\x20onclick=\x22openGalleryImages(\x27'+_0x4157b4['id']+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22image-gallery-category-thumb\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x6fac65?_0x458b18(0x6da)+_0x6fac65+_0x458b18(0x7af):_0x458b18(0x88e))+_0x458b18(0x8df)+(_0x4157b4[_0x458b18(0x76a)]||'未命名分类')+_0x458b18(0x6fd)+_0x53b7ee+_0x458b18(0x186)+_0x538464+'\x20张图片'+(_0x4157b4[_0x458b18(0x7c9)]===![]?_0x458b18(0x696):'')+_0x458b18(0x2bc)+_0x4157b4['id']+_0x458b18(0x839);}),_0x3a24ee['innerHTML']=_0x4a8961;}catch(_0x1e6325){console[_0x54559f(0x56c)](_0x54559f(0x87f),_0x1e6325),_0x3a24ee[_0x54559f(0x5b8)]=_0x54559f(0x84e);}}async function addImageGalleryCategory(){const _0x2c0014=_0x28e739,_0x249723=document[_0x2c0014(0x761)](_0x2c0014(0x8e2)),_0x3109bc=document[_0x2c0014(0x761)]('newGalleryCategoryTarget');if(!_0x249723)return;const _0x4a9cb0=_0x249723[_0x2c0014(0x29c)][_0x2c0014(0x28e)]();if(!_0x4a9cb0){showIslandNotification('提示',_0x2c0014(0x805),_0x2c0014(0x537));return;}const _0x112055=_0x3109bc?.[_0x2c0014(0x29c)]||null;try{const _0x3587f8={'id':_0x2c0014(0x956)+Date[_0x2c0014(0x2cb)]()+'_'+Math[_0x2c0014(0x266)]()[_0x2c0014(0x7f6)](0x24)[_0x2c0014(0x2d3)](0x2,0x6),'name':_0x4a9cb0,'characterId':_0x112055,'isEnabled':!![],'createdAt':Date[_0x2c0014(0x2cb)](),'images':[]};await db[_0x2c0014(0x3ce)][_0x2c0014(0x5e3)](_0x3587f8),console['log']('✅\x20创建图库分类成功:',_0x3587f8),_0x249723[_0x2c0014(0x29c)]='';if(_0x3109bc)_0x3109bc['value']='';await loadImageGalleryCategories(),showIslandNotification('成功',_0x2c0014(0x387)+_0x4a9cb0+_0x2c0014(0x828),'info');}catch(_0x37f7b6){console[_0x2c0014(0x56c)]('❌\x20创建图库分类失败:',_0x37f7b6),showIslandNotification('错误',_0x2c0014(0x908)+_0x37f7b6[_0x2c0014(0x918)],_0x2c0014(0x537));}}async function deleteGalleryCategory(_0x37cbe6){const _0x578a6d=_0x28e739;if(!confirm(_0x578a6d(0x74e)))return;try{await db[_0x578a6d(0x3ce)][_0x578a6d(0x6c2)](_0x37cbe6),console['log'](_0x578a6d(0x893),_0x37cbe6),await loadImageGalleryCategories(),showIslandNotification('已删除',_0x578a6d(0x589),_0x578a6d(0x537));}catch(_0x591814){console[_0x578a6d(0x56c)]('❌\x20删除图库分类失败:',_0x591814),showIslandNotification('错误','删除失败',_0x578a6d(0x537));}}async function openGalleryImages(_0x1cb19c){const _0x4a126d=_0x28e739;console[_0x4a126d(0x41f)](_0x4a126d(0x858),_0x1cb19c),currentGalleryCategoryId=_0x1cb19c;const _0x2b4cfe=document[_0x4a126d(0x761)](_0x4a126d(0x231)),_0x51a122=document['getElementById'](_0x4a126d(0x630));if(_0x2b4cfe)_0x2b4cfe[_0x4a126d(0x577)][_0x4a126d(0x475)]=_0x4a126d(0x562);if(_0x51a122)_0x51a122[_0x4a126d(0x421)]['add'](_0x4a126d(0x525));await loadGalleryImages(_0x1cb19c);}async function backToGalleryCategories(){const _0x711475=_0x28e739;currentGalleryCategoryId=null;const _0x314289=document[_0x711475(0x761)](_0x711475(0x231)),_0x1a3e98=document[_0x711475(0x761)](_0x711475(0x630));if(_0x1a3e98)_0x1a3e98[_0x711475(0x421)][_0x711475(0x403)](_0x711475(0x525));if(_0x314289)_0x314289[_0x711475(0x577)][_0x711475(0x475)]='block';await loadImageGalleryCategories();}async function loadGalleryImages(_0x1e9860){const _0x508335=_0x28e739;try{const _0x38f1ec=await db[_0x508335(0x3ce)]['get'](_0x1e9860);if(!_0x38f1ec){showIslandNotification('错误','分类不存在','info'),backToGalleryCategories();return;}const _0x194c10=document['getElementById'](_0x508335(0x5bd)),_0x4eddc0=document[_0x508335(0x761)](_0x508335(0x613)),_0x559ce7=document[_0x508335(0x761)](_0x508335(0x3bb));if(_0x194c10)_0x194c10[_0x508335(0x7dc)]=_0x38f1ec['name']||_0x508335(0x2ce);if(_0x4eddc0)_0x4eddc0['textContent']=(_0x38f1ec[_0x508335(0x6e1)]||[])[_0x508335(0x6ea)]+_0x508335(0x936);_0x559ce7&&_0x559ce7[_0x508335(0x421)]['toggle'](_0x508335(0x525),_0x38f1ec['isEnabled']!==![]);const _0x4dda8b=document[_0x508335(0x761)](_0x508335(0x633));if(!_0x4dda8b)return;const _0x323079=_0x38f1ec[_0x508335(0x6e1)]||[];let _0x5c0ac8='';_0x5c0ac8+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22image-gallery-add-image-item\x22\x20onclick=\x22openImageGalleryAddModal()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22><line\x20x1=\x2212\x22\x20y1=\x225\x22\x20x2=\x2212\x22\x20y2=\x2219\x22/><line\x20x1=\x225\x22\x20y1=\x2212\x22\x20x2=\x2219\x22\x20y2=\x2212\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>添加图片</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x323079[_0x508335(0x7b6)]((_0x15b87b,_0x354142)=>{const _0x47eeda=_0x508335,_0x498a5f=_0x15b87b[_0x47eeda(0x766)]?_0x47eeda(0x493)+_0x15b87b['description']+_0x47eeda(0x611):'';_0x5c0ac8+=_0x47eeda(0x3a0)+_0x15b87b[_0x47eeda(0x7ac)]+_0x47eeda(0x26c)+_0x498a5f+_0x47eeda(0x228)+_0x354142+_0x47eeda(0x43e);}),_0x4dda8b['innerHTML']=_0x5c0ac8;}catch(_0x30df3d){console[_0x508335(0x56c)](_0x508335(0x394),_0x30df3d);}}async function toggleCurrentGalleryEnabled(){const _0x5d0e98=_0x28e739;if(!currentGalleryCategoryId)return;try{const _0x5d71ea=await db['imageGalleries'][_0x5d0e98(0x309)](currentGalleryCategoryId);if(!_0x5d71ea)return;const _0x342cb4=_0x5d71ea[_0x5d0e98(0x7c9)]===![]?!![]:![];await db[_0x5d0e98(0x3ce)]['update'](currentGalleryCategoryId,{'isEnabled':_0x342cb4});const _0x15f28e=document[_0x5d0e98(0x761)](_0x5d0e98(0x3bb));if(_0x15f28e)_0x15f28e[_0x5d0e98(0x421)][_0x5d0e98(0x93a)](_0x5d0e98(0x525),_0x342cb4);showIslandNotification(_0x5d0e98(0x193),_0x342cb4?_0x5d0e98(0x1e1):_0x5d0e98(0x409),_0x5d0e98(0x537));}catch(_0x349099){console[_0x5d0e98(0x56c)](_0x5d0e98(0x25f),_0x349099);}}async function deleteGalleryImage(_0x2f0d11,_0xac5e8f){const _0x2229e4=_0x28e739;_0xac5e8f?.[_0x2229e4(0x722)]();if(!currentGalleryCategoryId)return;if(!confirm('确定删除这张图片？'))return;try{const _0x4e9cac=await db['imageGalleries'][_0x2229e4(0x309)](currentGalleryCategoryId);if(!_0x4e9cac||!_0x4e9cac[_0x2229e4(0x6e1)])return;_0x4e9cac[_0x2229e4(0x6e1)][_0x2229e4(0x825)](_0x2f0d11,0x1),await db[_0x2229e4(0x3ce)][_0x2229e4(0x301)](currentGalleryCategoryId,{'images':_0x4e9cac[_0x2229e4(0x6e1)]}),await loadGalleryImages(currentGalleryCategoryId),showIslandNotification(_0x2229e4(0x90c),'图片已移除',_0x2229e4(0x537));}catch(_0x268711){console[_0x2229e4(0x56c)](_0x2229e4(0x3c7),_0x268711);}}function openImageGalleryAddModal(){const _0x477c53=_0x28e739,_0x16b102=document['getElementById'](_0x477c53(0x2dc));if(!_0x16b102)return;const _0x36f3d4=document['getElementById']('newImageUrl'),_0xbd4518=document[_0x477c53(0x761)](_0x477c53(0x809)),_0x4e38f7=document[_0x477c53(0x761)]('newImageBatchInput'),_0x390054=document[_0x477c53(0x761)]('newImagePreviewBox');if(_0x36f3d4)_0x36f3d4[_0x477c53(0x29c)]='';if(_0xbd4518)_0xbd4518[_0x477c53(0x29c)]='';if(_0x4e38f7)_0x4e38f7['value']='';_0x390054&&(_0x390054[_0x477c53(0x5b8)]=_0x477c53(0x2d2)),_0x16b102[_0x477c53(0x421)][_0x477c53(0x5e3)](_0x477c53(0x525));}function closeImageGalleryAddModal(_0x27cac1){const _0x52fc12=_0x28e739;if(_0x27cac1&&_0x27cac1['target']!==_0x27cac1[_0x52fc12(0x574)])return;const _0x550378=document[_0x52fc12(0x761)](_0x52fc12(0x2dc));if(_0x550378)_0x550378[_0x52fc12(0x421)]['remove']('active');}function previewNewImage(){const _0x4b9cb7=_0x28e739,_0x2845bd=document['getElementById'](_0x4b9cb7(0x1fd)),_0x531422=document['getElementById'](_0x4b9cb7(0x1e3));if(!_0x2845bd||!_0x531422)return;const _0x4b744a=_0x2845bd[_0x4b9cb7(0x29c)][_0x4b9cb7(0x28e)]();if(!_0x4b744a){_0x531422[_0x4b9cb7(0x5b8)]=_0x4b9cb7(0x2d2);return;}_0x531422['innerHTML']=_0x4b9cb7(0x6da)+_0x4b744a+_0x4b9cb7(0x4ce);}async function confirmAddImage(){const _0x235a91=_0x28e739;if(!currentGalleryCategoryId)return;const _0x43ab3c=document[_0x235a91(0x761)]('newImageUrl'),_0x1ed7cc=document[_0x235a91(0x761)](_0x235a91(0x809)),_0xa983c7=document[_0x235a91(0x761)](_0x235a91(0x595)),_0x2d33a7=_0xa983c7?.[_0x235a91(0x29c)]||'',_0xf6302d=typeof _0x2d33a7==='string'?_0x2d33a7[_0x235a91(0x28e)]():'';try{const _0x55ce9f=await db['imageGalleries'][_0x235a91(0x309)](currentGalleryCategoryId);if(!_0x55ce9f)return;const _0x158cb4=_0x55ce9f[_0x235a91(0x6e1)]||[];let _0x5d37d7=0x0,_0x4c4c61=0x0;if(_0xf6302d){const _0x1a2d96=_0xf6302d['split'](/\r?\n/);_0x1a2d96[_0x235a91(0x7b6)](_0x43536c=>{const _0x9a14c4=_0x235a91,_0x34e7c9=String(_0x43536c||'')[_0x9a14c4(0x28e)]();if(!_0x34e7c9)return;const _0x234d72=_0x34e7c9[_0x9a14c4(0x372)](/[:：]/);if(_0x234d72===-0x1){_0x4c4c61+=0x1;return;}const _0x1d3694=_0x34e7c9[_0x9a14c4(0x73d)](0x0,_0x234d72)[_0x9a14c4(0x28e)](),_0x12b44a=_0x34e7c9[_0x9a14c4(0x73d)](_0x234d72+0x1)['trim']();if(!_0x12b44a){_0x4c4c61+=0x1;return;}_0x158cb4['push']({'url':_0x12b44a,'description':_0x1d3694,'createdAt':Date[_0x9a14c4(0x2cb)]()}),_0x5d37d7+=0x1;});if(_0x5d37d7===0x0){showIslandNotification('提示',_0x235a91(0x601),_0x235a91(0x537));return;}}else{const _0x4207c6=_0x43ab3c?.[_0x235a91(0x29c)]['trim']();if(!_0x4207c6){showIslandNotification('提示',_0x235a91(0x1fa),_0x235a91(0x537));return;}const _0x1d2485=_0x1ed7cc?.[_0x235a91(0x29c)][_0x235a91(0x28e)]()||'';_0x158cb4[_0x235a91(0x2c4)]({'url':_0x4207c6,'description':_0x1d2485,'createdAt':Date[_0x235a91(0x2cb)]()}),_0x5d37d7=0x1;}await db[_0x235a91(0x3ce)][_0x235a91(0x301)](currentGalleryCategoryId,{'images':_0x158cb4}),closeImageGalleryAddModal(),await loadGalleryImages(currentGalleryCategoryId);if(_0xf6302d){const _0x204868=_0x4c4c61>0x0?_0x235a91(0x331)+_0x4c4c61+'\x20条':'';showIslandNotification('成功',_0x235a91(0x49d)+_0x5d37d7+'\x20条'+_0x204868,'info');}else showIslandNotification('成功','图片已添加',_0x235a91(0x537));}catch(_0x37fe06){console[_0x235a91(0x56c)](_0x235a91(0x7df),_0x37fe06),showIslandNotification('错误',_0x235a91(0x69f),_0x235a91(0x537));}}async function getAvailableGalleryImages(_0x1dc6db){const _0x14e9b7=_0x28e739;try{const _0x46fa58=await db[_0x14e9b7(0x3ce)][_0x14e9b7(0x5fd)](),_0x47f869=_0x46fa58[_0x14e9b7(0x911)](_0x3935ea=>_0x3935ea[_0x14e9b7(0x7c9)]!==![]),_0x3e0f32=_0x47f869[_0x14e9b7(0x911)](_0x479588=>!_0x479588['characterId']||_0x479588[_0x14e9b7(0x3ae)]===_0x1dc6db);let _0x1b0047=[];return _0x3e0f32[_0x14e9b7(0x7b6)](_0x18f174=>{const _0xefc346=_0x14e9b7;_0x18f174[_0xefc346(0x6e1)]&&_0x18f174[_0xefc346(0x6e1)][_0xefc346(0x6ea)]>0x0&&(_0x1b0047=_0x1b0047['concat'](_0x18f174['images'][_0xefc346(0x962)](_0x3e478e=>({'url':_0x3e478e['url'],'description':_0x3e478e[_0xefc346(0x766)]||'','categoryName':_0x18f174[_0xefc346(0x76a)]}))));}),_0x1b0047;}catch(_0x47f66b){return console[_0x14e9b7(0x56c)](_0x14e9b7(0x528),_0x47f66b),[];}}window[_0x28e739(0x710)]=openImageGalleryDrawer,window[_0x28e739(0x311)]=closeImageGalleryDrawer,window['closeImageGalleryDrawerOnOverlay']=closeImageGalleryDrawerOnOverlay,window[_0x28e739(0x60e)]=addImageGalleryCategory,window[_0x28e739(0x543)]=deleteGalleryCategory,window[_0x28e739(0x3ed)]=openGalleryImages,window[_0x28e739(0x471)]=backToGalleryCategories,window['toggleCurrentGalleryEnabled']=toggleCurrentGalleryEnabled,window[_0x28e739(0x96e)]=deleteGalleryImage,window[_0x28e739(0x8c5)]=openImageGalleryAddModal,window[_0x28e739(0x5f6)]=closeImageGalleryAddModal,window[_0x28e739(0x4c1)]=previewNewImage,window[_0x28e739(0x976)]=confirmAddImage,window[_0x28e739(0x73f)]=getAvailableGalleryImages,console[_0x28e739(0x41f)]('✅\x20动态图库系统加载完成');let currentMmpagesCharacter=null;async function openMmpages(){const _0x3cba96=_0x28e739;console[_0x3cba96(0x41f)](_0x3cba96(0x1d4));const _0x28a535=document['getElementById']('mmpagesScreen');if(!_0x28a535){console['error'](_0x3cba96(0x97c));return;}if(currentCharProfileData&&currentCharProfileData['id'])try{const _0x2e2786=await db[_0x3cba96(0x183)][_0x3cba96(0x309)](currentCharProfileData['id']);_0x2e2786?loadMmpagesData(_0x2e2786):loadMmpagesData(currentCharProfileData);}catch(_0x193a68){console[_0x3cba96(0x56c)](_0x3cba96(0x969),_0x193a68),loadMmpagesData(currentCharProfileData);}else console[_0x3cba96(0x516)](_0x3cba96(0x737));_0x28a535[_0x3cba96(0x421)]['add'](_0x3cba96(0x525)),closeCharProfile();}function closeMmpages(){const _0x5371f5=_0x28e739;console[_0x5371f5(0x41f)](_0x5371f5(0x83a));const _0x5b6cd0=document[_0x5371f5(0x761)]('mmpagesScreen');_0x5b6cd0&&_0x5b6cd0[_0x5371f5(0x421)][_0x5371f5(0x403)](_0x5371f5(0x525));}function loadMmpagesData(_0x7097df){const _0x56dcf5=_0x28e739;console[_0x56dcf5(0x41f)](_0x56dcf5(0x50e),_0x7097df['name']),currentMmpagesCharacter=_0x7097df;const _0x2bf653=document[_0x56dcf5(0x761)](_0x56dcf5(0x478)),_0x1a2371=document['getElementById'](_0x56dcf5(0x47a)),_0x5568cd=document[_0x56dcf5(0x761)](_0x56dcf5(0x4a3)),_0xc7d6a9=document[_0x56dcf5(0x761)]('mmpagesBioNote'),_0x55e1b=document[_0x56dcf5(0x761)]('mmpagesFollowers'),_0x1f6cbb=document[_0x56dcf5(0x761)]('mmpagesAvatar');if(_0x2bf653)_0x2bf653['textContent']=_0x7097df[_0x56dcf5(0x478)]||_0x7097df[_0x56dcf5(0x76a)]||_0x56dcf5(0x7f2);const _0x2b8241=_0x7097df[_0x56dcf5(0x478)]||_0x7097df[_0x56dcf5(0x76a)]||'username',_0x2e018b=_0x2b8241['toLowerCase']()[_0x56dcf5(0x568)](/\s+/g,'_');if(_0x1a2371)_0x1a2371[_0x56dcf5(0x7dc)]='@'+(_0x7097df[_0x56dcf5(0x47a)]||_0x2e018b);if(_0x5568cd){if(_0x7097df[_0x56dcf5(0x4a3)])_0x5568cd[_0x56dcf5(0x7dc)]=_0x7097df['mmpagesBio'];else{const _0x30e9fe=_0x7097df['settings']?.[_0x56dcf5(0x6f1)]||'',_0x1398eb=_0x30e9fe[_0x56dcf5(0x4c7)]('\x0a')[0x0]||_0x56dcf5(0x219);_0x5568cd[_0x56dcf5(0x7dc)]=_0x1398eb[_0x56dcf5(0x83d)](0x0,0x64);}}if(_0xc7d6a9)_0xc7d6a9[_0x56dcf5(0x7dc)]=_0x7097df[_0x56dcf5(0x97a)]||_0x56dcf5(0x2db);if(_0x55e1b){const _0x198465=_0x7097df[_0x56dcf5(0x283)]||Math['floor'](Math[_0x56dcf5(0x266)]()*0x1f4)+0x64;_0x55e1b['textContent']=_0x198465+_0x56dcf5(0x3f3);}if(_0x1f6cbb){const _0x2dd338=_0x7097df[_0x56dcf5(0x541)]||_0x7097df[_0x56dcf5(0x708)]||_0x7097df[_0x56dcf5(0x6ff)]?.[_0x56dcf5(0x922)]||'';_0x1f6cbb[_0x56dcf5(0x273)]=_0x2dd338,_0x1f6cbb['onerror']=function(){const _0x21c43f=_0x56dcf5;this[_0x21c43f(0x577)][_0x21c43f(0x475)]=_0x21c43f(0x562),this['parentNode'][_0x21c43f(0x7dc)]='?';};}renderMmpagesPosts(_0x7097df),initMmpagesTabs();}async function renderMmpagesPosts(_0x50a8a2){const _0x166ce1=_0x28e739,_0x490a71=document[_0x166ce1(0x761)](_0x166ce1(0x1ce)),_0x3bfbd5=document[_0x166ce1(0x761)](_0x166ce1(0x4a1));if(!_0x490a71)return;const _0x2bdc5b=_0x490a71[_0x166ce1(0x42c)](_0x166ce1(0x21e));_0x2bdc5b[_0x166ce1(0x7b6)](_0x2a834c=>_0x2a834c[_0x166ce1(0x403)]());try{const _0x5a0be1=_0x50a8a2['id'],_0x43d3c8=_0x50a8a2['characterId']||getCharacterIdFromChat(_0x50a8a2)||_0x5a0be1,_0x50f5d3=await db[_0x166ce1(0x30f)][_0x166ce1(0x309)](_0x5a0be1),_0x481c92=currentSessionId||_0x5a0be1||_0x166ce1(0x79f);let _0x5c797e=_0x166ce1(0x79f);if(_0x50f5d3&&_0x50f5d3[_0x166ce1(0x96c)])_0x5c797e=_0x50f5d3[_0x166ce1(0x96c)];else{const _0x19b9a6=await db[_0x166ce1(0x175)][_0x166ce1(0x309)](_0x166ce1(0x619));_0x19b9a6&&(_0x5c797e=_0x19b9a6[_0x166ce1(0x29c)]);}console['log'](_0x166ce1(0x361)+_0x43d3c8+_0x166ce1(0x769)+_0x481c92);const _0x580ef8=await db['mmpages'][_0x166ce1(0x5fd)](),_0x1a4ad7=_0x580ef8[_0x166ce1(0x911)](_0x3b59da=>_0x3b59da[_0x166ce1(0x3ae)]===_0x43d3c8&&(_0x3b59da['sessionId']||_0x166ce1(0x79f))===_0x481c92)['sort']((_0x44b99b,_0xa194be)=>(_0xa194be[_0x166ce1(0x407)]||0x0)-(_0x44b99b[_0x166ce1(0x407)]||0x0))[_0x166ce1(0x73d)](0x0,0x32);console[_0x166ce1(0x41f)]('📱\x20加载了\x20'+_0x1a4ad7['length']+_0x166ce1(0x369));if(_0x1a4ad7[_0x166ce1(0x6ea)]===0x0){if(_0x3bfbd5)_0x3bfbd5[_0x166ce1(0x577)]['display']=_0x166ce1(0x439);return;}if(_0x3bfbd5)_0x3bfbd5['style']['display']=_0x166ce1(0x562);let _0x290013='';_0x1a4ad7[_0x166ce1(0x7b6)](_0x608bad=>{_0x290013+=generateMmpagesPostHTML(_0x608bad,_0x50a8a2);});const _0x239ceb=document[_0x166ce1(0x761)](_0x166ce1(0x4a1));_0x239ceb&&_0x239ceb[_0x166ce1(0x7a6)](_0x166ce1(0x179),_0x290013),initMmpagesLikes();}catch(_0x2455ec){console[_0x166ce1(0x56c)]('❌\x20加载Mmpages动态失败:',_0x2455ec);if(_0x3bfbd5)_0x3bfbd5[_0x166ce1(0x577)][_0x166ce1(0x475)]='flex';}}function processMmpagesContent(_0x4e972d){const _0x3fc840=_0x28e739;if(!_0x4e972d)return'';let _0x3656f2=_0x4e972d[_0x3fc840(0x568)](/&/g,_0x3fc840(0x45f))[_0x3fc840(0x568)](/</g,'&lt;')[_0x3fc840(0x568)](/>/g,_0x3fc840(0x896))['replace'](/"/g,_0x3fc840(0x2e5))[_0x3fc840(0x568)](/'/g,'&#039;');return _0x3656f2=_0x3656f2[_0x3fc840(0x568)](/#([\u4e00-\u9fa5a-zA-Z0-9_]+)/g,_0x3fc840(0x290)),_0x3656f2=_0x3656f2['replace'](/@([\u4e00-\u9fa5a-zA-Z0-9_]+)/g,'<span\x20class=\x22mmpages-mention\x22>@$1</span>'),_0x3656f2;}function processThreadContent(_0x11f2fd){const _0x209eed=_0x28e739;if(!_0x11f2fd)return'';let _0x13dba3=_0x11f2fd[_0x209eed(0x568)](/&/g,'&amp;')['replace'](/</g,_0x209eed(0x325))[_0x209eed(0x568)](/>/g,_0x209eed(0x896))[_0x209eed(0x568)](/"/g,'&quot;')[_0x209eed(0x568)](/'/g,_0x209eed(0x4a2));return _0x13dba3=_0x13dba3['replace'](/#([\u4e00-\u9fa5a-zA-Z0-9_]+)/g,_0x209eed(0x3bd)),_0x13dba3=_0x13dba3[_0x209eed(0x568)](/@([\u4e00-\u9fa5a-zA-Z0-9_]+)/g,'<span\x20class=\x22thread-mention\x22>@$1</span>'),_0x13dba3;}function generateMmpagesPostHTML(_0xa94d9e,_0x125f22){const _0x24cda1=_0x28e739,_0x1130ee=_0x125f22['mmpagesDisplayName']||_0x125f22[_0x24cda1(0x76a)]||_0x24cda1(0x50b),_0x1bad0e=_0x125f22[_0x24cda1(0x47a)]||_0x1130ee[_0x24cda1(0x568)](/\s+/g,'_')[_0x24cda1(0x6eb)](),_0x32873f=_0x125f22['mmpagesSocialAvatar']||_0x125f22[_0x24cda1(0x708)]||_0x125f22[_0x24cda1(0x6ff)]?.['aiAvatar']||'',_0x5c46f8=_0xa94d9e['timestamp']?getTimeAgo(_0xa94d9e[_0x24cda1(0x407)]):'1d',_0x34b0b6=_0xa94d9e[_0x24cda1(0x4ed)]||{'likes':0x0,'comments':0x0,'reposts':0x0};let _0x27c995='';if(_0xa94d9e[_0x24cda1(0x6e1)]&&_0xa94d9e[_0x24cda1(0x6e1)][_0x24cda1(0x6ea)]>0x0){_0x27c995='<div\x20class=\x22mmpages-post-images\x22>';const _0x3317b5=_0xa94d9e[_0x24cda1(0x6e1)][_0x24cda1(0x73d)](0x0,0x3);_0x3317b5[_0x24cda1(0x7b6)](_0x2a98ed=>{const _0x41320f=_0x24cda1;if(_0x2a98ed[_0x41320f(0x3a3)]===_0x41320f(0x766))_0x27c995+=_0x41320f(0x934)+processMmpagesContent(_0x2a98ed[_0x41320f(0x632)]||'')+_0x41320f(0x23a);else{if(_0x2a98ed[_0x41320f(0x3a3)]==='ai-generated'&&_0x2a98ed[_0x41320f(0x7ac)])_0x27c995+=_0x41320f(0x188)+_0x2a98ed[_0x41320f(0x7ac)]+_0x41320f(0x762);else{if(_0x2a98ed['type']===_0x41320f(0x1a2)&&_0x2a98ed[_0x41320f(0x7ac)])_0x27c995+='<img\x20class=\x22mmpages-post-image\x22\x20src=\x22'+_0x2a98ed[_0x41320f(0x7ac)]+_0x41320f(0x250);else{if(typeof _0x2a98ed===_0x41320f(0x7a1))_0x27c995+='<img\x20class=\x22mmpages-post-image\x22\x20src=\x22'+_0x2a98ed+_0x41320f(0x24f);else _0x2a98ed[_0x41320f(0x7ac)]&&(_0x27c995+='<img\x20class=\x22mmpages-post-image\x22\x20src=\x22'+_0x2a98ed[_0x41320f(0x7ac)]+'\x22\x20alt=\x22动态图片\x22\x20loading=\x22lazy\x22\x20onerror=\x22this.style.display=\x27none\x27\x22>');}}}}),_0x27c995+='</div>';}return _0x24cda1(0x3a9)+(_0xa94d9e['id']||'')+_0x24cda1(0x4aa)+(_0xa94d9e['id']||0x0)+_0x24cda1(0x5ce)+_0x32873f+_0x24cda1(0x8bb)+_0x1130ee+_0x24cda1(0x343)+_0x5c46f8+_0x24cda1(0x280)+(_0xa94d9e['id']||0x0)+');\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span></span><span></span><span></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-post-menu\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-post-menu-item\x20mmpages-post-menu-delete\x22\x20onclick=\x22event.stopPropagation();\x20deleteMmpagesPost('+(_0xa94d9e['id']||0x0)+');\x22\x20title=\x22删除动态\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22mmpages-post-text\x22>'+processMmpagesContent(_0xa94d9e[_0x24cda1(0x632)]||'')+_0x24cda1(0x2c9)+_0x27c995+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-post-actions\x22\x20onclick=\x22event.stopPropagation();\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-action-btn\x20mmpages-like-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M20.84\x204.61a5.5\x205.5\x200\x200\x200-7.78\x200L12\x205.67l-1.06-1.06a5.5\x205.5\x200\x200\x200-7.78\x207.78l1.06\x201.06L12\x2021.23l7.78-7.78\x201.06-1.06a5.5\x205.5\x200\x200\x200\x200-7.78z\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+(_0x34b0b6['likes']||0x0)+_0x24cda1(0x63e)+(_0x34b0b6['comments']||0x0)+_0x24cda1(0x2b9)+(_0x34b0b6['reposts']||0x0)+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-action-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M4.698\x204.034l16.302\x207.966l-16.302\x207.966a.503\x20.503\x200\x200\x201\x20-.546\x20-.124a.555\x20.555\x200\x200\x201\x20-.12\x20-.568l2.468\x20-7.274l-2.468\x20-7.274a.555\x20.555\x200\x200\x201\x20.12\x20-.568a.503\x20.503\x200\x200\x201\x20.546\x20-.124z\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M6.5\x2012h14.5\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+(_0x34b0b6['shares']||0x0)+_0x24cda1(0x2e6);}function addMmpagesPost(_0x4ff234){const _0x3d2bbe=_0x28e739;if(!currentMmpagesCharacter){console['warn'](_0x3d2bbe(0x771));return;}!currentMmpagesCharacter[_0x3d2bbe(0x240)]&&(currentMmpagesCharacter[_0x3d2bbe(0x240)]=[]),currentMmpagesCharacter[_0x3d2bbe(0x240)][_0x3d2bbe(0x814)](_0x4ff234),renderMmpagesPosts(currentMmpagesCharacter);}function toggleMmpagesPostMenu(_0x576126,_0x1a25d8){const _0xac3954=_0x28e739,_0x45844b=_0x576126[_0xac3954(0x768)](_0xac3954(0x834));if(!_0x45844b)return;document[_0xac3954(0x42c)](_0xac3954(0x835))['forEach'](_0x1f82c9=>{const _0x5cd53d=_0xac3954;if(_0x1f82c9!==_0x45844b)_0x1f82c9[_0x5cd53d(0x421)][_0x5cd53d(0x403)](_0x5cd53d(0x525));}),_0x45844b[_0xac3954(0x421)]['toggle']('active');if(_0x45844b[_0xac3954(0x421)][_0xac3954(0x6e3)](_0xac3954(0x525))){const _0x416a90=_0x519cc4=>{const _0x2728ce=_0xac3954;!_0x576126['contains'](_0x519cc4[_0x2728ce(0x6e4)])&&(_0x45844b[_0x2728ce(0x421)][_0x2728ce(0x403)](_0x2728ce(0x525)),document[_0x2728ce(0x210)](_0x2728ce(0x7bd),_0x416a90));};setTimeout(()=>document[_0xac3954(0x55d)](_0xac3954(0x7bd),_0x416a90),0xa);}}async function deleteMmpagesPost(_0x2ed637){const _0x2481ee=_0x28e739;if(!_0x2ed637){console[_0x2481ee(0x56c)]('❌\x20无效的帖子ID');return;}const _0x125e5d=await db[_0x2481ee(0x1c6)]['get'](_0x2ed637);if(!_0x125e5d){showIslandNotification('错误',_0x2481ee(0x71e),_0x2481ee(0x537));return;}const _0x1e674c=confirm('确定要删除这条动态吗？\x0a\x0a删除后无法恢复。');if(!_0x1e674c)return;try{const _0x578d78=Math[_0x2481ee(0x266)]()<0.5;_0x578d78?(await saveDeletedPostEvent(_0x125e5d),console['log']('🎲\x20[删除动态]\x20触发50%概率，已保存删除事件通知角色')):console[_0x2481ee(0x41f)](_0x2481ee(0x5d5));await db[_0x2481ee(0x1c6)]['delete'](_0x2ed637),document['querySelectorAll'](_0x2481ee(0x835))['forEach'](_0x39c7fe=>_0x39c7fe[_0x2481ee(0x421)][_0x2481ee(0x403)]('active'));const _0x5198ea=document['querySelector'](_0x2481ee(0x378)+_0x2ed637+'\x22]');_0x5198ea&&(_0x5198ea[_0x2481ee(0x577)][_0x2481ee(0x519)]='opacity\x200.3s,\x20transform\x200.3s',_0x5198ea[_0x2481ee(0x577)][_0x2481ee(0x88c)]='0',_0x5198ea['style'][_0x2481ee(0x8ed)]=_0x2481ee(0x5c7),setTimeout(()=>_0x5198ea[_0x2481ee(0x403)](),0x12c)),showIslandNotification('成功',_0x2481ee(0x40f),_0x2481ee(0x4bc)),vibrateDevice(),console['log'](_0x2481ee(0x490),_0x2ed637);}catch(_0x5bedfa){console[_0x2481ee(0x56c)](_0x2481ee(0x406),_0x5bedfa),showIslandNotification('错误','删除失败','info');}}async function saveDeletedPostEvent(_0x2e7117){const _0x24d8b0=_0x28e739;try{const _0x5a1c09=_0x24d8b0(0x40c)+Date[_0x24d8b0(0x2cb)](),_0x18d733=_0x2e7117[_0x24d8b0(0x3ae)],_0x279a29=_0x2e7117[_0x24d8b0(0x3c2)]||'default',_0x4d69d9=await db[_0x24d8b0(0x175)]['where']('id')[_0x24d8b0(0x414)]('deletedPost_')['toArray'](),_0x1a66e8=_0x4d69d9[_0x24d8b0(0x30c)](_0x56dab8=>_0x56dab8['value']?.[_0x24d8b0(0x3ae)]===_0x18d733&&_0x56dab8['value']?.[_0x24d8b0(0x3c2)]===_0x279a29&&!_0x56dab8[_0x24d8b0(0x29c)]?.[_0x24d8b0(0x526)]);_0x1a66e8&&(await db['globalSettings'][_0x24d8b0(0x6c2)](_0x1a66e8['id']),console['log'](_0x24d8b0(0x5bb))),await db['globalSettings'][_0x24d8b0(0x720)]({'id':_0x5a1c09,'value':{'type':_0x24d8b0(0x715),'characterId':_0x18d733,'sessionId':_0x279a29,'postContent':_0x2e7117['content']||'','postImages':_0x2e7117['images']||[],'deletedAt':Date[_0x24d8b0(0x2cb)](),'consumed':![],'expiresAt':Date[_0x24d8b0(0x2cb)]()+0x18*0x3c*0x3c*0x3e8}}),console[_0x24d8b0(0x41f)](_0x24d8b0(0x189),_0x5a1c09);}catch(_0x1c8b47){console[_0x24d8b0(0x56c)](_0x24d8b0(0x20e),_0x1c8b47);}}async function getUnconsumedDeletedPostEvent(_0x1d023c,_0x4eaabe){const _0x2955e0=_0x28e739;try{const _0x2572a9=await db[_0x2955e0(0x175)][_0x2955e0(0x56a)]('id')[_0x2955e0(0x414)](_0x2955e0(0x40c))['toArray'](),_0xe7584b=Date[_0x2955e0(0x2cb)](),_0x4a580f=_0x2572a9[_0x2955e0(0x30c)](_0x54fdcc=>{const _0x150ce3=_0x2955e0,_0x28db15=_0x54fdcc['value'];return _0x28db15?.[_0x150ce3(0x3a3)]===_0x150ce3(0x715)&&_0x28db15?.[_0x150ce3(0x3ae)]===_0x1d023c&&_0x28db15?.[_0x150ce3(0x3c2)]===_0x4eaabe&&!_0x28db15?.[_0x150ce3(0x526)]&&_0x28db15?.[_0x150ce3(0x2c6)]>_0xe7584b;});return _0x4a580f||null;}catch(_0xa38906){return console[_0x2955e0(0x56c)](_0x2955e0(0x7c8),_0xa38906),null;}}async function markDeletedPostEventConsumed(_0x295f06){const _0x4c7910=_0x28e739;try{const _0x48fc58=await db[_0x4c7910(0x175)]['get'](_0x295f06);_0x48fc58&&_0x48fc58[_0x4c7910(0x29c)]&&(_0x48fc58[_0x4c7910(0x29c)][_0x4c7910(0x526)]=!![],await db['globalSettings'][_0x4c7910(0x720)](_0x48fc58),console[_0x4c7910(0x41f)](_0x4c7910(0x440),_0x295f06));}catch(_0x1307b8){console[_0x4c7910(0x56c)](_0x4c7910(0x86a),_0x1307b8);}}(function injectMmpagesMenuStyles(){const _0x35fd90=_0x28e739,_0x15524f=_0x35fd90(0x18d);if(document['getElementById'](_0x15524f))return;const _0x500e10=document[_0x35fd90(0x5e5)](_0x35fd90(0x577));_0x500e10['id']=_0x15524f,_0x500e10['textContent']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20/*\x20Mmpages\x20动态更多菜单\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-more\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20relative;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-menu\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20absolute;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20right:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20var(--bg-secondary,\x20#fff);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x204px\x2020px\x20rgba(0,\x200,\x200,\x200.15);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20visibility:\x20hidden;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20translateY(-10px)\x20scale(0.95);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20all\x200.2s\x20ease;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x20100;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20overflow:\x20hidden;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-menu.active\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20visibility:\x20visible;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20translateY(5px)\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-menu-item\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20background\x200.15s;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-menu-item:hover\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20var(--bg-tertiary,\x20#f5f5f5);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-menu-item\x20svg\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20flex-shrink:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20block;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-menu-item\x20span\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20white-space:\x20nowrap;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20line-height:\x201;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20block;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-menu-delete\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#888;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-menu-delete:hover\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(128,\x20128,\x20128,\x200.15);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#666;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20/*\x20暗色模式适配\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20@media\x20(prefers-color-scheme:\x20dark)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-menu\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#1a1a1a;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x201px\x20solid\x20#333;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x204px\x2020px\x20rgba(0,\x200,\x200,\x200.5);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-menu-item:hover\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#2a2a2a;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-menu-delete\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#aaa;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-menu-delete:hover\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#ccc;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20',document['head'][_0x35fd90(0x3de)](_0x500e10);}());function toggleThreadCommentMenu(_0x6061a3){const _0x518bdc=_0x28e739,_0x542d9e=_0x6061a3[_0x518bdc(0x768)](_0x518bdc(0x48d));if(!_0x542d9e)return;document[_0x518bdc(0x42c)](_0x518bdc(0x68a))['forEach'](_0x55a830=>{const _0x5dcc0a=_0x518bdc;if(_0x55a830!==_0x542d9e)_0x55a830[_0x5dcc0a(0x421)][_0x5dcc0a(0x403)](_0x5dcc0a(0x525));}),_0x542d9e[_0x518bdc(0x421)][_0x518bdc(0x93a)]('active');if(_0x542d9e[_0x518bdc(0x421)][_0x518bdc(0x6e3)]('active')){const _0x17e3ac=_0x53cfea=>{const _0x36a484=_0x518bdc;!_0x6061a3[_0x36a484(0x6e3)](_0x53cfea['target'])&&(_0x542d9e[_0x36a484(0x421)][_0x36a484(0x403)](_0x36a484(0x525)),document[_0x36a484(0x210)](_0x36a484(0x7bd),_0x17e3ac));};setTimeout(()=>document['addEventListener'](_0x518bdc(0x7bd),_0x17e3ac),0xa);}}async function deleteThreadComment(_0x20c981,_0x56ec03,_0x2fefa4){const _0x2667e0=_0x28e739;if(!currentThreadPost||_0x20c981<0x0){console[_0x2667e0(0x56c)](_0x2667e0(0x251));return;}const _0x4591ba=_0x56ec03?_0x2667e0(0x685):'确定要删除这条评论吗？\x0a\x0a该评论下的所有回复也会被删除。',_0x5ac557=confirm(_0x4591ba);if(!_0x5ac557)return;try{document[_0x2667e0(0x42c)]('.thread-comment-menu.active')[_0x2667e0(0x7b6)](_0x2cfe77=>_0x2cfe77[_0x2667e0(0x421)][_0x2667e0(0x403)](_0x2667e0(0x525)));if(_0x56ec03){const _0x45f7fc=currentThreadPost[_0x2667e0(0x7de)][_0x20c981];_0x45f7fc&&_0x45f7fc['replies']&&_0x2fefa4>=0x0&&(_0x45f7fc['replies'][_0x2667e0(0x825)](_0x2fefa4,0x1),console[_0x2667e0(0x41f)](_0x2667e0(0x4e1)+_0x20c981+',\x20replyIndex='+_0x2fefa4));}else currentThreadPost[_0x2667e0(0x7de)][_0x2667e0(0x825)](_0x20c981,0x1),console[_0x2667e0(0x41f)](_0x2667e0(0x408)+_0x20c981);currentThreadPost['stats']&&(currentThreadPost[_0x2667e0(0x4ed)][_0x2667e0(0x71b)]=Math[_0x2667e0(0x738)](0x0,(currentThreadPost[_0x2667e0(0x4ed)][_0x2667e0(0x71b)]||0x0)-0x1));await db[_0x2667e0(0x1c6)][_0x2667e0(0x720)](currentThreadPost);const _0x779524=await db[_0x2667e0(0x183)][_0x2667e0(0x309)](currentThreadPost[_0x2667e0(0x3ae)]);_0x779524&&await renderThreadDetail(currentThreadPost,_0x779524),showIslandNotification('成功',_0x2667e0(0x803),_0x2667e0(0x4bc)),vibrateDevice();}catch(_0x17d5ff){console[_0x2667e0(0x56c)](_0x2667e0(0x349),_0x17d5ff),showIslandNotification('错误',_0x2667e0(0x45a),_0x2667e0(0x537));}}(function injectThreadCommentMenuStyles(){const _0x45cc2a=_0x28e739,_0x2fd0fd=_0x45cc2a(0x4b2);if(document[_0x45cc2a(0x761)](_0x2fd0fd))return;const _0xc7d273=document[_0x45cc2a(0x5e5)](_0x45cc2a(0x577));_0xc7d273['id']=_0x2fd0fd,_0xc7d273[_0x45cc2a(0x7dc)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20/*\x20Thread\x20评论更多菜单\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20.thread-comment-more\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20relative;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.thread-comment-menu\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20absolute;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20right:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#1a1a1a;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x201px\x20solid\x20#333;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x204px\x2020px\x20rgba(0,\x200,\x200,\x200.5);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20visibility:\x20hidden;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20translateY(-10px)\x20scale(0.95);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20all\x200.2s\x20ease;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x20100;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20overflow:\x20hidden;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.thread-comment-menu.active\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20visibility:\x20visible;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20translateY(5px)\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.thread-comment-menu-item\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20background\x200.15s;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.thread-comment-menu-item:hover\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#2a2a2a;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.thread-comment-menu-item\x20svg\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20flex-shrink:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20block;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.thread-comment-menu-delete\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#aaa;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.thread-comment-menu-delete:hover\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#ccc;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20',document[_0x45cc2a(0x68e)]['appendChild'](_0xc7d273);}());let currentThreadPost=null,threadReplyTarget=null,threadCurrentProfileId=null;async function openThreadDetail(_0x48f45e){const _0x3c4637=_0x28e739;try{const _0xe3cb40=await db[_0x3c4637(0x1c6)][_0x3c4637(0x309)](_0x48f45e);if(!_0xe3cb40){console['error'](_0x3c4637(0x6b1),_0x48f45e);return;}const _0x55a0a3=await db[_0x3c4637(0x183)][_0x3c4637(0x309)](_0xe3cb40[_0x3c4637(0x3ae)]);if(!_0x55a0a3){console['error'](_0x3c4637(0x211),_0xe3cb40[_0x3c4637(0x3ae)]);return;}currentThreadPost=_0xe3cb40,await renderThreadDetail(_0xe3cb40,_0x55a0a3);const _0x4656c4=document[_0x3c4637(0x761)]('threadDetailScreen');_0x4656c4&&_0x4656c4[_0x3c4637(0x421)][_0x3c4637(0x5e3)](_0x3c4637(0x525));}catch(_0x13fed9){console[_0x3c4637(0x56c)](_0x3c4637(0x75d),_0x13fed9);}}function closeThreadDetail(){const _0x5ceb97=_0x28e739,_0xd4389f=document['getElementById'](_0x5ceb97(0x39c));_0xd4389f&&(_0xd4389f[_0x5ceb97(0x421)][_0x5ceb97(0x5e3)](_0x5ceb97(0x776)),setTimeout(()=>{const _0x21a274=_0x5ceb97;_0xd4389f[_0x21a274(0x421)][_0x21a274(0x403)](_0x21a274(0x525),_0x21a274(0x776));},0x15e)),currentThreadPost=null,threadReplyTarget=null;}function normalizeThreadNameValue(_0x5625bb){const _0x399b08=_0x28e739;return String(_0x5625bb||'')[_0x399b08(0x28e)]()['toLowerCase']();}async function buildThreadCharacterIdentityMap(){const _0x106274=_0x28e739,_0x1f5d4b=new Map();try{const _0x2619ce=await db['chats'][_0x106274(0x5fd)](),_0x5b9401=getUserCreatedCharactersFromChats(_0x2619ce),_0x3ec8e7=new Map();await Promise['all'](_0x5b9401[_0x106274(0x962)](async _0x54ad30=>{const _0x202eda=_0x106274,_0x33d8cf=normalizeId(_0x54ad30?.['id']);if(!isValidIdValue(_0x33d8cf))return;const _0x1184bc=await db[_0x202eda(0x30f)]['get'](_0x33d8cf);_0x3ec8e7[_0x202eda(0x790)](_0x33d8cf,_0x1184bc||null);})),_0x5b9401[_0x106274(0x7b6)](_0x27b315=>{const _0x46c952=_0x106274,_0x2955b6=normalizeId(_0x27b315?.['id']);if(!isValidIdValue(_0x2955b6))return;const _0x4f277a=_0x3ec8e7[_0x46c952(0x309)](_0x2955b6),_0x1be797=String(_0x4f277a?.[_0x46c952(0x8e5)]||'')[_0x46c952(0x28e)](),_0xa57c7=_0x27b315?.[_0x46c952(0x478)]||_0x1be797||_0x27b315?.[_0x46c952(0x76a)]||_0x27b315?.[_0x46c952(0x53a)]||'角色',_0x1a039a=_0x27b315?.[_0x46c952(0x541)]||_0x27b315?.[_0x46c952(0x708)]||_0x27b315?.['settings']?.[_0x46c952(0x922)]||'',_0x4e7c51=[_0x27b315?.[_0x46c952(0x478)],_0x1be797,_0x27b315?.[_0x46c952(0x76a)],_0x27b315?.[_0x46c952(0x53a)],_0x27b315?.[_0x46c952(0x47a)]][_0x46c952(0x962)](_0x56de82=>String(_0x56de82||'')[_0x46c952(0x28e)]())[_0x46c952(0x911)](Boolean);_0x4e7c51[_0x46c952(0x7b6)](_0x29ad49=>{const _0x4968ac=_0x46c952,_0x29867c=normalizeThreadNameValue(_0x29ad49);if(!_0x29867c)return;!_0x1f5d4b[_0x4968ac(0x345)](_0x29867c)&&_0x1f5d4b[_0x4968ac(0x790)](_0x29867c,{'displayName':_0xa57c7,'avatar':_0x1a039a,'characterId':_0x2955b6});});});}catch(_0x6297b8){console[_0x106274(0x516)](_0x106274(0x41c),_0x6297b8);}return _0x1f5d4b;}async function renderThreadDetail(_0x10e624,_0x139ce3){const _0x30ef98=_0x28e739,_0x252963=document[_0x30ef98(0x761)](_0x30ef98(0x641)),_0x424063=document['getElementById'](_0x30ef98(0x196)),_0x5e095d=document[_0x30ef98(0x761)]('threadViews');if(!_0x252963||!_0x424063){console[_0x30ef98(0x56c)]('❌\x20Thread\x20Detail容器不存在');return;}if(_0x5e095d){const _0x4e967f=_0x10e624[_0x30ef98(0x4ed)]?.[_0x30ef98(0x913)]||Math['floor'](Math[_0x30ef98(0x266)]()*0x1388)+0x64;_0x5e095d[_0x30ef98(0x7dc)]=_0x4e967f+_0x30ef98(0x8b8);}let _0x32c0c4='';const _0x5c8986='https://i.postimg.cc/4xmx7V4R/mmexport1759081128356.jpg';let _0x430ace=threadCurrentProfileId||null;if(!_0x430ace){const _0x323e9b=await db[_0x30ef98(0x175)]['get'](_0x30ef98(0x619));_0x430ace=_0x323e9b?.[_0x30ef98(0x29c)]||_0x10e624['profileId']||null;}if(!_0x430ace&&_0x139ce3['id']){const _0x20697b=await db[_0x30ef98(0x30f)][_0x30ef98(0x309)](_0x139ce3['id']);_0x20697b&&_0x20697b[_0x30ef98(0x96c)]&&(_0x430ace=_0x20697b[_0x30ef98(0x96c)]);}!threadCurrentProfileId&&_0x430ace&&(threadCurrentProfileId=_0x430ace);if(_0x430ace&&_0x430ace!==''&&_0x430ace!==_0x30ef98(0x714)&&_0x430ace!==_0x30ef98(0x64a))try{const _0x32c9c4=await db[_0x30ef98(0x70f)][_0x30ef98(0x309)](_0x430ace);_0x32c9c4&&_0x32c9c4[_0x30ef98(0x708)]&&(_0x32c0c4=_0x32c9c4[_0x30ef98(0x708)]);}catch(_0x5ee2fe){console[_0x30ef98(0x516)](_0x30ef98(0x883),_0x5ee2fe[_0x30ef98(0x918)]);}!_0x32c0c4&&(_0x32c0c4=_0x5c8986);const _0x4998c7=generateThreadOriginalPost(_0x10e624,_0x139ce3),_0x279c81=_0x30ef98(0x5bf),_0x3a0515=await buildThreadCharacterIdentityMap(),_0x468ff4=_0x18832c=>_0x3a0515['get'](normalizeThreadNameValue(_0x18832c));let _0xe877de='';if(_0x10e624[_0x30ef98(0x7de)]&&_0x10e624[_0x30ef98(0x7de)][_0x30ef98(0x6ea)]>0x0){const _0x594c53=[];_0x10e624[_0x30ef98(0x7de)]['forEach']((_0x2739a7,_0x50b137)=>{const _0x10b73d=_0x30ef98;_0x2739a7['hasReply']&&_0x2739a7[_0x10b73d(0x246)]&&!_0x2739a7[_0x10b73d(0x8c7)]&&(_0x2739a7[_0x10b73d(0x8c7)]=[{'username':_0x139ce3[_0x10b73d(0x478)]||_0x139ce3[_0x10b73d(0x76a)]||_0x10b73d(0x89f),'content':_0x2739a7[_0x10b73d(0x246)],'time':_0x2739a7['timestamp']?formatTimeAgo(_0x2739a7[_0x10b73d(0x407)]):_0x2739a7['time']||'1h','isAuthor':!![]}]);const _0x5d80cd=_0x2739a7['replies']||[],_0x53b307=_0x5d80cd[_0x10b73d(0x6ea)]>0x0,_0x1b96d5=_0x5d80cd[_0x10b73d(0x6ea)]>0x3&&!_0x2739a7[_0x10b73d(0x1a0)],_0x477895=_0x2739a7[_0x10b73d(0x1a0)]||![],_0x31eeec=_0x2739a7[_0x10b73d(0x58e)]===_0x10b73d(0x8dd)?null:_0x468ff4(_0x2739a7[_0x10b73d(0x2ae)]),_0x6e59ea=_0x31eeec?.[_0x10b73d(0x873)]||_0x2739a7[_0x10b73d(0x2ae)],_0x471dfe=_0x31eeec?.[_0x10b73d(0x708)]||_0x2739a7[_0x10b73d(0x708)]||'',_0x217151=_0x1b96d5?_0x5d80cd['slice'](0x1)[_0x10b73d(0x962)](_0x548c5d=>{const _0x37c747=_0x10b73d;if(_0x548c5d['isAuthor'])return _0x139ce3[_0x37c747(0x541)]||_0x139ce3[_0x37c747(0x708)]||'';const _0x129d21=_0x468ff4(_0x548c5d[_0x37c747(0x2ae)]);return _0x129d21?.[_0x37c747(0x708)]||_0x548c5d[_0x37c747(0x708)]||'';})[_0x10b73d(0x911)](Boolean)[_0x10b73d(0x73d)](0x0,0x1):[];_0x594c53['push']({..._0x2739a7,'username':_0x6e59ea,'avatar':_0x471dfe,'hasReply':_0x53b307,'isReply':![],'showReplies':_0x1b96d5,'commentIndex':_0x50b137,'replyAvatars':_0x217151});if(_0x53b307){const _0x1eb065=_0x477895||_0x5d80cd[_0x10b73d(0x6ea)]<=0x3?_0x5d80cd:_0x5d80cd[_0x10b73d(0x73d)](0x0,0x1);_0x1eb065[_0x10b73d(0x7b6)]((_0x42f5d9,_0xecfc8b)=>{const _0x59d25a=_0x10b73d;let _0x2078f2=_0xecfc8b===0x0?_0x2739a7['username']:_0x1eb065[_0xecfc8b-0x1][_0x59d25a(0x2ae)],_0x547ca0=null;_0x42f5d9['replyTo']&&_0x42f5d9[_0x59d25a(0x3dd)]!==_0x2078f2&&(_0x547ca0=_0x42f5d9[_0x59d25a(0x3dd)]);const _0x4d3d59=_0xecfc8b===_0x1eb065[_0x59d25a(0x6ea)]-0x1,_0x48b8c6=_0x42f5d9[_0x59d25a(0x58e)]==='user'?null:_0x468ff4(_0x42f5d9[_0x59d25a(0x2ae)]),_0x1ea412=_0x48b8c6?.[_0x59d25a(0x873)]||_0x42f5d9[_0x59d25a(0x2ae)],_0x5991f8=_0x42f5d9[_0x59d25a(0x5ad)]?_0x139ce3[_0x59d25a(0x541)]||_0x139ce3[_0x59d25a(0x708)]||'':_0x48b8c6?.[_0x59d25a(0x708)]||_0x42f5d9[_0x59d25a(0x708)]||'',_0x51cd47=_0x547ca0?_0x468ff4(_0x547ca0)?.[_0x59d25a(0x873)]||_0x547ca0:null;_0x594c53['push']({'username':_0x1ea412,'content':_0x42f5d9[_0x59d25a(0x632)],'time':_0x42f5d9[_0x59d25a(0x407)]?formatTimeAgo(_0x42f5d9[_0x59d25a(0x407)]):_0x42f5d9['time']||'1h','avatar':_0x5991f8,'hasReply':![],'isReply':!![],'isAuthor':_0x42f5d9[_0x59d25a(0x5ad)]||![],'showReplies':![],'commentIndex':_0x50b137,'replyIndex':_0xecfc8b,'role':_0x42f5d9['role']||null,'toUsername':_0x51cd47,'isLastReply':_0x4d3d59});});}});const _0xd260bf=_0x594c53[_0x30ef98(0x962)](_0x377ce5=>generateThreadCommentHTML(_0x377ce5,_0x139ce3))[_0x30ef98(0x943)]('');_0xe877de=_0x30ef98(0x6c8)+_0xd260bf+_0x30ef98(0x611);}_0x252963['innerHTML']=_0x4998c7+_0x279c81+_0xe877de,_0x424063[_0x30ef98(0x5b8)]=generateThreadReplyBar(_0x10e624,_0x139ce3,_0x32c0c4),window[_0x30ef98(0x492)]&&initThreadDetailInteractions();}function generateThreadOriginalPost(_0xbe8c04,_0x312e4f){const _0xfe3278=_0x28e739,_0x6cb7f9=_0xbe8c04[_0xfe3278(0x4ed)]||{},_0x40bee7=_0x312e4f[_0xfe3278(0x478)]||_0x312e4f[_0xfe3278(0x76a)]||_0xfe3278(0x50b),_0x417dbe=_0x312e4f[_0xfe3278(0x47a)]||_0x40bee7[_0xfe3278(0x568)](/\s+/g,'_')[_0xfe3278(0x6eb)](),_0x4dce0c=_0x312e4f[_0xfe3278(0x541)]||_0x312e4f[_0xfe3278(0x708)]||'data:image/svg+xml,%3Csvg\x20xmlns=\x27http://www.w3.org/2000/svg\x27\x20viewBox=\x270\x200\x20100\x20100\x27%3E%3Crect\x20fill=\x27%23ff9500\x27\x20width=\x27100\x27\x20height=\x27100\x27/%3E%3Ccircle\x20cx=\x2750\x27\x20cy=\x2735\x27\x20r=\x2720\x27\x20fill=\x27%23fff\x27/%3E%3Cellipse\x20cx=\x2750\x27\x20cy=\x2780\x27\x20rx=\x2730\x27\x20ry=\x2725\x27\x20fill=\x27%23fff\x27/%3E%3C/svg%3E';let _0x129433='';if(_0xbe8c04[_0xfe3278(0x6e1)]&&_0xbe8c04['images'][_0xfe3278(0x6ea)]>0x0){_0x129433=_0xfe3278(0x7e9);const _0x10e769=_0xbe8c04[_0xfe3278(0x6e1)];_0x10e769['forEach'](_0xf9d03c=>{const _0x551115=_0xfe3278;if(_0xf9d03c[_0x551115(0x3a3)]===_0x551115(0x766))_0x129433+=_0x551115(0x867)+processThreadContent(_0xf9d03c[_0x551115(0x632)]||'')+_0x551115(0x23a);else{if(_0xf9d03c[_0x551115(0x3a3)]==='ai-generated'&&_0xf9d03c['url'])_0x129433+=_0x551115(0x184)+_0xf9d03c[_0x551115(0x7ac)]+'\x22\x20alt=\x22AI生成的图片\x22\x20loading=\x22lazy\x22\x20onerror=\x22this.style.display=\x27none\x27\x22>';else{if(_0xf9d03c['type']===_0x551115(0x1a2)&&_0xf9d03c[_0x551115(0x7ac)])_0x129433+=_0x551115(0x184)+_0xf9d03c[_0x551115(0x7ac)]+'\x22\x20alt=\x22用户提供的图片\x22\x20loading=\x22lazy\x22\x20onerror=\x22this.style.display=\x27none\x27\x22>';else{if(typeof _0xf9d03c==='string')_0x129433+=_0x551115(0x184)+_0xf9d03c+'\x22\x20alt=\x22动态图片\x22\x20loading=\x22lazy\x22\x20onerror=\x22this.style.display=\x27none\x27\x22>';else _0xf9d03c[_0x551115(0x7ac)]&&(_0x129433+=_0x551115(0x184)+_0xf9d03c['url']+_0x551115(0x24f));}}}}),_0x129433+=_0xfe3278(0x611);}return'\x0a\x20\x20\x20\x20\x20\x20\x20\x20<article\x20class=\x22thread-original-post\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-post-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-post-author\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-avatar-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20class=\x22thread-avatar\x22\x20src=\x22'+_0x4dce0c+_0xfe3278(0x3d9)+_0x40bee7+_0xfe3278(0x7b2)+_0x40bee7+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22thread-post-time\x22>'+formatTimeAgo(_0xbe8c04['timestamp'])+_0xfe3278(0x38c)+processThreadContent(_0xbe8c04[_0xfe3278(0x632)]||'')+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x129433+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-post-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-action-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x2021.35l-1.45-1.32C5.4\x2015.36\x202\x2012.28\x202\x208.5\x202\x205.42\x204.42\x203\x207.5\x203c1.74\x200\x203.41.81\x204.5\x202.09C13.09\x203.81\x2014.76\x203\x2016.5\x203\x2019.58\x203\x2022\x205.42\x2022\x208.5c0\x203.78-3.4\x206.86-8.55\x2011.54L12\x2021.35z\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22thread-action-count\x22>'+(_0x6cb7f9['likes']||0x84)+_0xfe3278(0x78f)+(_0x6cb7f9[_0xfe3278(0x71b)]||0xf)+_0xfe3278(0x796)+(_0x6cb7f9[_0xfe3278(0x32a)]||0xa)+_0xfe3278(0x82a)+(_0x6cb7f9[_0xfe3278(0x4fc)]||0x7)+_0xfe3278(0x27d);}function generateThreadCommentHTML(_0x1e3fbf,_0x1ebea2){const _0x43865f=_0x28e739,_0x492b92=_0x1e3fbf[_0x43865f(0x3db)]||![],_0x3b493f=_0x1e3fbf['isReply']||![],_0xbea573=_0x1e3fbf['isAuthor']||![],_0x25c5b6=_0x1e3fbf[_0x43865f(0x8b3)]||![],_0x57eee4=_0x1e3fbf['commentIndex']!==undefined?_0x1e3fbf[_0x43865f(0x644)]:-0x1,_0x19e729=_0x1e3fbf[_0x43865f(0x77c)]||null,_0x3f8637=_0x1e3fbf[_0x43865f(0x742)]||![],_0x25c9e3=_0x1e3fbf[_0x43865f(0x58e)]===_0x43865f(0x8dd),_0x2f3bd0=_0x1e3fbf[_0x43865f(0x467)]!==undefined?_0x1e3fbf[_0x43865f(0x467)]:-0x1;let _0x25430c='';(_0x492b92&&!_0x3b493f||_0x3b493f&&!_0x3f8637)&&(_0x25430c='<div\x20class=\x22thread-reply-line\x22></div>');let _0x5aa9c5='';if(_0x25c5b6){const _0x18f4f7=_0x1e3fbf[_0x43865f(0x3c6)]||[],_0x3ce8b7=_0x18f4f7[_0x43865f(0x962)](_0x1c689a=>'<img\x20class=\x22thread-show-replies-avatar\x22\x20src=\x22'+_0x1c689a+'\x22\x20alt=\x22\x22>')[_0x43865f(0x943)]('');_0x5aa9c5=_0x43865f(0x40d)+_0x3ce8b7+_0x43865f(0x71d);}let _0x3d6d1d='';if(_0x19e729)_0x3d6d1d=_0x43865f(0x6f3)+_0x19e729+_0x43865f(0x975);else _0xbea573&&(_0x3d6d1d='<span\x20class=\x22thread-author-badge\x22>·\x20Author</span>');let _0x124d91='';_0x25c5b6&&(_0x124d91='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-show-replies-text\x22\x20onclick=\x22toggleThreadReplies('+_0x57eee4+_0x43865f(0x5ba));const _0x3797f5=_0x43865f(0x53f)+(_0x492b92?_0x43865f(0x446):'')+(_0x3b493f?'\x20is-reply':'')+(_0x3f8637?'\x20is-last-reply':'');return _0x43865f(0x2b1)+_0x3797f5+_0x43865f(0x37f)+_0x57eee4+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-wrapper\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-avatar-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+(_0x1e3fbf[_0x43865f(0x708)]||'data:image/svg+xml,%3Csvg\x20xmlns=\x27http://www.w3.org/2000/svg\x27\x20viewBox=\x270\x200\x20100\x20100\x27%3E%3Crect\x20fill=\x27%23999\x27\x20width=\x27100\x27\x20height=\x27100\x27/%3E%3C/svg%3E')+_0x43865f(0x881)+_0x25430c+_0x43865f(0x428)+_0x5aa9c5+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-meta\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22thread-comment-username\x22>'+(_0x1e3fbf['username']||'Unknown')+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22thread-comment-time\x22>'+(_0x1e3fbf[_0x43865f(0x407)]?formatTimeAgo(_0x1e3fbf['timestamp']):_0x1e3fbf[_0x43865f(0x2e1)]||'1h')+_0x43865f(0x692)+_0x3d6d1d+_0x43865f(0x352)+(_0x25c9e3?_0x43865f(0x86e)+_0x57eee4+',\x20'+_0x3b493f+',\x20'+_0x2f3bd0+_0x43865f(0x2de):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-text\x22>'+processThreadContent(_0x1e3fbf[_0x43865f(0x632)]||'')+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-action\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M20.84\x204.61a5.5\x205.5\x200\x200\x200-7.78\x200L12\x205.67l-1.06-1.06a5.5\x205.5\x200\x200\x200-7.78\x207.78l1.06\x201.06L12\x2021.23l7.78-7.78\x201.06-1.06a5.5\x205.5\x200\x200\x200\x200-7.78z\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-action\x20thread-reply-btn\x22\x20data-comment-index=\x22'+_0x57eee4+_0x43865f(0x68d)+(_0x1e3fbf[_0x43865f(0x2ae)]||'')+_0x43865f(0x1e9)+_0x3b493f+_0x43865f(0x567)+_0x124d91+_0x43865f(0x65d);}function generateThreadReplyBar(_0xf4c2a3,_0x9b4488,_0x4d08f3){const _0x25e72e=_0x28e739,_0x4d7540=_0x9b4488[_0x25e72e(0x478)]||_0x9b4488[_0x25e72e(0x76a)]||_0x25e72e(0x50b),_0x129c10=_0x9b4488[_0x25e72e(0x47a)]||_0x4d7540[_0x25e72e(0x568)](/\s+/g,'_')[_0x25e72e(0x6eb)](),_0x38ece3=_0x4d08f3||'https://i.postimg.cc/4xmx7V4R/mmexport1759081128356.jpg';return'\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-reply-input-wrapper\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-profile-picker-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20class=\x22thread-reply-avatar\x22\x20src=\x22'+_0x38ece3+'\x22\x20alt=\x22Your\x20avatar\x22\x20onclick=\x22toggleThreadProfilePicker(event)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-profile-picker\x22\x20id=\x22threadProfilePicker\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22thread-reply-input\x22\x20placeholder=\x22Reply\x20to\x20'+_0x4d7540+_0x25e72e(0x8e3);}async function toggleThreadProfilePicker(_0x456897){const _0x5d9179=_0x28e739;_0x456897[_0x5d9179(0x722)]();const _0x48a0fc=document[_0x5d9179(0x761)]('threadProfilePicker');if(!_0x48a0fc)return;if(_0x48a0fc[_0x5d9179(0x421)][_0x5d9179(0x6e3)]('active')){_0x48a0fc[_0x5d9179(0x421)][_0x5d9179(0x403)](_0x5d9179(0x525));return;}try{const _0x57d2e8=await db['userProfiles'][_0x5d9179(0x5fd)]();if(!_0x57d2e8||_0x57d2e8[_0x5d9179(0x6ea)]===0x0){showIslandNotification('提示',_0x5d9179(0x7b7),_0x5d9179(0x537));return;}let _0x157cb8=threadCurrentProfileId;if(!_0x157cb8){const _0x21b6f3=await db[_0x5d9179(0x175)][_0x5d9179(0x309)](_0x5d9179(0x619));_0x157cb8=_0x21b6f3?.['value']||null;}const _0x288220=_0x57d2e8[_0x5d9179(0x962)](_0x5bba5a=>{const _0x4f65be=_0x5d9179,_0x2e963a=_0x5bba5a['id']===_0x157cb8,_0x214de7=_0x5bba5a[_0x4f65be(0x708)]||'https://i.postimg.cc/4xmx7V4R/mmexport1759081128356.jpg';return _0x4f65be(0x4bb)+(_0x2e963a?_0x4f65be(0x486):'')+'\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onclick=\x22switchThreadProfile(\x27'+_0x5bba5a['id']+'\x27,\x20event)\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20title=\x22'+(_0x5bba5a['name']||_0x5bba5a[_0x4f65be(0x2ae)]||'用户')+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+_0x214de7+_0x4f65be(0x3d9)+(_0x5bba5a[_0x4f65be(0x76a)]||'')+_0x4f65be(0x653)+(_0x2e963a?'<div\x20class=\x22thread-profile-check\x22>✓</div>':'')+_0x4f65be(0x4ab);})[_0x5d9179(0x943)]('');_0x48a0fc['innerHTML']=_0x288220,_0x48a0fc[_0x5d9179(0x421)][_0x5d9179(0x5e3)](_0x5d9179(0x525)),setTimeout(()=>{const _0x5bbc85=_0x5d9179;document[_0x5bbc85(0x55d)]('click',closeThreadProfilePicker,{'once':!![]});},0xa);}catch(_0x42a870){console['error'](_0x5d9179(0x7cb),_0x42a870);}}function closeThreadProfilePicker(_0xb7666e){const _0xfd2b5c=_0x28e739,_0xf5ae34=document[_0xfd2b5c(0x761)](_0xfd2b5c(0x62c));_0xf5ae34&&!_0xf5ae34[_0xfd2b5c(0x6e3)](_0xb7666e?.['target'])&&_0xf5ae34['classList'][_0xfd2b5c(0x403)]('active');}async function switchThreadProfile(_0x2c2eaf,_0x4fc1bd){const _0x3e04a2=_0x28e739;_0x4fc1bd?.['stopPropagation']();try{const _0x1edd1b=await db[_0x3e04a2(0x70f)][_0x3e04a2(0x309)](_0x2c2eaf);if(!_0x1edd1b){showIslandNotification('错误',_0x3e04a2(0x328),_0x3e04a2(0x537));return;}threadCurrentProfileId=_0x2c2eaf;const _0x5ddaba=document[_0x3e04a2(0x768)]('.thread-reply-avatar');_0x5ddaba&&_0x1edd1b[_0x3e04a2(0x708)]&&(_0x5ddaba[_0x3e04a2(0x273)]=_0x1edd1b[_0x3e04a2(0x708)]);const _0x215d38=document[_0x3e04a2(0x761)]('threadProfilePicker');if(_0x215d38)_0x215d38[_0x3e04a2(0x421)]['remove'](_0x3e04a2(0x525));showIslandNotification('已切换',_0x3e04a2(0x8db)+(_0x1edd1b['name']||_0x1edd1b[_0x3e04a2(0x2ae)]||'用户'),'info');}catch(_0x32ce52){console[_0x3e04a2(0x56c)](_0x3e04a2(0x47c),_0x32ce52);}}function formatTimeAgo(_0xb54ff5){const _0x595dd2=_0x28e739;if(!_0xb54ff5)return'1h';const _0x1d4cab=Date['now'](),_0x45009e=_0x1d4cab-_0xb54ff5,_0x33909f=Math[_0x595dd2(0x64b)](_0x45009e/0x3e8),_0x136a98=Math[_0x595dd2(0x64b)](_0x33909f/0x3c),_0x29cc16=Math['floor'](_0x136a98/0x3c),_0x124b7e=Math[_0x595dd2(0x64b)](_0x29cc16/0x18);if(_0x124b7e>0x0)return _0x124b7e+'d';if(_0x29cc16>0x0)return _0x29cc16+'h';if(_0x136a98>0x0)return _0x136a98+'m';return'now';}function initMmpagesTabs(){const _0x248e5e=_0x28e739,_0x16912a=document['querySelectorAll'](_0x248e5e(0x665));_0x16912a['forEach'](_0x1f4dc7=>{const _0x3840c8=_0x248e5e;_0x1f4dc7[_0x3840c8(0x55d)](_0x3840c8(0x7bd),function(){const _0x3a67d7=_0x3840c8;_0x16912a[_0x3a67d7(0x7b6)](_0x547a79=>_0x547a79['classList'][_0x3a67d7(0x403)](_0x3a67d7(0x525))),this[_0x3a67d7(0x421)]['add'](_0x3a67d7(0x525));const _0x279cff=this[_0x3a67d7(0x7f3)](_0x3a67d7(0x511));console[_0x3a67d7(0x41f)]('📑\x20切换到Tab:',_0x279cff);});});}function initMmpagesLikes(){const _0x180911=_0x28e739,_0x8c1ba1=document[_0x180911(0x42c)](_0x180911(0x7fd));_0x8c1ba1[_0x180911(0x7b6)](_0x3082dd=>{const _0x28edf0=_0x180911;_0x3082dd['addEventListener'](_0x28edf0(0x7bd),function(){const _0x2e4a81=_0x28edf0,_0x351af2=this['querySelector']('svg');this[_0x2e4a81(0x421)][_0x2e4a81(0x93a)](_0x2e4a81(0x405))?(_0x351af2['style']['fill']=_0x2e4a81(0x67a),_0x351af2[_0x2e4a81(0x577)][_0x2e4a81(0x72c)]=_0x2e4a81(0x67a)):(_0x351af2[_0x2e4a81(0x577)][_0x2e4a81(0x654)]=_0x2e4a81(0x562),_0x351af2[_0x2e4a81(0x577)]['stroke']=_0x2e4a81(0x981));});});}let mmpagesEditAvatar=null;async function openMmpagesEditModal(){const _0x489b88=_0x28e739;console['log'](_0x489b88(0x450));const _0x1236cc=document[_0x489b88(0x761)](_0x489b88(0x63f));if(!_0x1236cc)return;if(currentMmpagesCharacter&&currentMmpagesCharacter['id'])try{const _0xad6808=await db[_0x489b88(0x183)][_0x489b88(0x309)](currentMmpagesCharacter['id']);_0xad6808&&(currentMmpagesCharacter=_0xad6808);}catch(_0x547508){console['error'](_0x489b88(0x629),_0x547508);}if(currentMmpagesCharacter){const _0x310769=document[_0x489b88(0x761)](_0x489b88(0x94b)),_0x390b75=document[_0x489b88(0x761)](_0x489b88(0x687)),_0x193c1d=document[_0x489b88(0x761)]('mmpagesEditBio'),_0x48b07e=document[_0x489b88(0x761)](_0x489b88(0x45d)),_0x47df76=document[_0x489b88(0x761)](_0x489b88(0x63b)),_0x54ed64=document[_0x489b88(0x761)](_0x489b88(0x69a));if(_0x310769)_0x310769[_0x489b88(0x29c)]=currentMmpagesCharacter[_0x489b88(0x478)]||currentMmpagesCharacter['name']||'';const _0x42d36f=currentMmpagesCharacter[_0x489b88(0x478)]||currentMmpagesCharacter[_0x489b88(0x76a)]||_0x489b88(0x2ae),_0xa072c0=_0x42d36f[_0x489b88(0x6eb)]()[_0x489b88(0x568)](/\s+/g,'_');if(_0x390b75)_0x390b75[_0x489b88(0x29c)]=currentMmpagesCharacter[_0x489b88(0x47a)]||_0xa072c0;if(_0x193c1d){const _0x1a20d0=currentMmpagesCharacter['settings']?.[_0x489b88(0x6f1)]||'',_0x4f7622=_0x1a20d0['split']('\x0a')[0x0]||'';_0x193c1d[_0x489b88(0x29c)]=currentMmpagesCharacter[_0x489b88(0x4a3)]||_0x4f7622[_0x489b88(0x83d)](0x0,0x64);}if(_0x48b07e)_0x48b07e[_0x489b88(0x29c)]=currentMmpagesCharacter['mmpagesBioNote']||_0x489b88(0x2db);if(_0x47df76){const _0x59a0d4=currentMmpagesCharacter[_0x489b88(0x283)]||Math[_0x489b88(0x64b)](Math[_0x489b88(0x266)]()*0x1f4)+0x64;_0x47df76[_0x489b88(0x29c)]=_0x59a0d4;}if(_0x54ed64){const _0x18fbd7=currentMmpagesCharacter[_0x489b88(0x541)]||currentMmpagesCharacter[_0x489b88(0x708)]||currentMmpagesCharacter[_0x489b88(0x6ff)]?.[_0x489b88(0x922)]||'';_0x54ed64[_0x489b88(0x273)]=_0x18fbd7,mmpagesEditAvatar=null;}}_0x1236cc[_0x489b88(0x421)][_0x489b88(0x5e3)]('active');}function closeMmpagesEditModal(){const _0x54ec50=_0x28e739;console['log'](_0x54ec50(0x286));const _0x4449a2=document['getElementById']('mmpagesEditOverlay');_0x4449a2&&_0x4449a2[_0x54ec50(0x421)][_0x54ec50(0x403)](_0x54ec50(0x525)),mmpagesEditAvatar=null;}function handleMmpagesAvatarUpload(_0x57ee20){const _0x378b38=_0x28e739,_0x18985c=_0x57ee20[_0x378b38(0x6e4)][_0x378b38(0x2f4)][0x0];if(!_0x18985c)return;if(!_0x18985c[_0x378b38(0x3a3)][_0x378b38(0x414)](_0x378b38(0x339))){alert(_0x378b38(0x571));return;}const _0x4b9ae2=new FileReader();_0x4b9ae2[_0x378b38(0x2d9)]=function(_0x5b7a6e){const _0x40898a=_0x378b38,_0x19422d=_0x5b7a6e[_0x40898a(0x6e4)][_0x40898a(0x6c4)];mmpagesEditAvatar=_0x19422d;const _0x501e66=document['getElementById'](_0x40898a(0x69a));_0x501e66&&(_0x501e66[_0x40898a(0x273)]=_0x19422d),console['log'](_0x40898a(0x580));},_0x4b9ae2[_0x378b38(0x401)](_0x18985c);}async function saveMmpagesEdit(){const _0x4ae65a=_0x28e739;console[_0x4ae65a(0x41f)](_0x4ae65a(0x303));if(!currentMmpagesCharacter){console[_0x4ae65a(0x516)](_0x4ae65a(0x939));return;}const _0x51ceca=document[_0x4ae65a(0x761)](_0x4ae65a(0x94b))?.[_0x4ae65a(0x29c)]||'',_0x12e27a=document[_0x4ae65a(0x761)](_0x4ae65a(0x687))?.[_0x4ae65a(0x29c)]||'',_0x50a36d=document[_0x4ae65a(0x761)](_0x4ae65a(0x815))?.[_0x4ae65a(0x29c)]||'',_0x502bc1=document[_0x4ae65a(0x761)](_0x4ae65a(0x45d))?.[_0x4ae65a(0x29c)]||'',_0x332bfc=document[_0x4ae65a(0x761)](_0x4ae65a(0x63b))?.[_0x4ae65a(0x29c)]||'0';if(!_0x51ceca[_0x4ae65a(0x28e)]()){alert('请输入名字');return;}currentMmpagesCharacter['mmpagesDisplayName']=_0x51ceca[_0x4ae65a(0x28e)](),currentMmpagesCharacter[_0x4ae65a(0x47a)]=_0x12e27a['trim']()||_0x51ceca[_0x4ae65a(0x6eb)]()[_0x4ae65a(0x568)](/\s+/g,'_'),currentMmpagesCharacter['mmpagesBio']=_0x50a36d[_0x4ae65a(0x28e)](),currentMmpagesCharacter[_0x4ae65a(0x97a)]=_0x502bc1[_0x4ae65a(0x28e)](),currentMmpagesCharacter[_0x4ae65a(0x283)]=parseInt(_0x332bfc)||0x0;mmpagesEditAvatar&&(currentMmpagesCharacter[_0x4ae65a(0x541)]=mmpagesEditAvatar);try{const _0xece89a=currentMmpagesCharacter['id'];if(!_0xece89a){console['error'](_0x4ae65a(0x476)),alert('保存失败：角色ID不存在');return;}currentMmpagesCharacter[_0x4ae65a(0x368)]=Date[_0x4ae65a(0x2cb)](),await db['chats']['put'](currentMmpagesCharacter),window[_0x4ae65a(0x945)]&&await syncLinkedCharacterData(_0xece89a,{'settings':currentMmpagesCharacter[_0x4ae65a(0x6ff)],'mmpagesDisplayName':currentMmpagesCharacter[_0x4ae65a(0x478)],'mmpagesUsername':currentMmpagesCharacter[_0x4ae65a(0x47a)],'mmpagesBio':currentMmpagesCharacter[_0x4ae65a(0x4a3)],'mmpagesBioNote':currentMmpagesCharacter[_0x4ae65a(0x97a)],'mmpagesFollowers':currentMmpagesCharacter[_0x4ae65a(0x283)],'mmpagesSocialAvatar':currentMmpagesCharacter[_0x4ae65a(0x541)]}),console[_0x4ae65a(0x41f)]('✅\x20Mmpages数据已保存到数据库'),window[_0x4ae65a(0x25d)]&&window['currentCharProfileData']['id']===_0xece89a&&(window[_0x4ae65a(0x25d)]=currentMmpagesCharacter),window[_0x4ae65a(0x788)]&&showIslandNotification('主页已更新',currentMmpagesCharacter['name']+'\x20的主页信息已保存',_0x4ae65a(0x4bc)),loadMmpagesData(currentMmpagesCharacter),closeMmpagesEditModal();}catch(_0x2f4094){console[_0x4ae65a(0x56c)](_0x4ae65a(0x53b),_0x2f4094),alert(_0x4ae65a(0x6bd));}}console[_0x28e739(0x41f)]('✅\x20Mmpages功能模块加载完成');function initThreadLikeInteractions(){const _0x18dc31=_0x28e739;document[_0x18dc31(0x42c)]('.thread-action-item,\x20.thread-comment-action')[_0x18dc31(0x7b6)](_0x4adb36=>{const _0x271c49=_0x18dc31;_0x4adb36[_0x271c49(0x55d)](_0x271c49(0x7bd),function(){const _0x3626dc=_0x271c49,_0x8d7c85=this['querySelector']('svg'),_0x5ead37=this[_0x3626dc(0x768)](_0x3626dc(0x61e));this[_0x3626dc(0x421)][_0x3626dc(0x6e3)](_0x3626dc(0x46e))?(this[_0x3626dc(0x421)][_0x3626dc(0x403)](_0x3626dc(0x46e)),_0x5ead37&&(_0x5ead37[_0x3626dc(0x7dc)]=parseInt(_0x5ead37['textContent'])-0x1)):_0x8d7c85&&_0x8d7c85[_0x3626dc(0x768)](_0x3626dc(0x23d))&&(this[_0x3626dc(0x421)][_0x3626dc(0x5e3)](_0x3626dc(0x46e)),_0x5ead37&&(_0x5ead37[_0x3626dc(0x7dc)]=parseInt(_0x5ead37[_0x3626dc(0x7dc)]||0x0)+0x1));});});}function initThreadFollowButtons(){const _0x3df16c=_0x28e739;document[_0x3df16c(0x42c)](_0x3df16c(0x45e))[_0x3df16c(0x7b6)](_0x5d0edc=>{const _0x52b776=_0x3df16c;_0x5d0edc[_0x52b776(0x55d)](_0x52b776(0x7bd),function(){const _0x17779c=_0x52b776;this['textContent']===_0x17779c(0x93b)?(this[_0x17779c(0x7dc)]=_0x17779c(0x6ad),this['style'][_0x17779c(0x1ff)]=_0x17779c(0x912),this['style']['color']=_0x17779c(0x230),this[_0x17779c(0x577)][_0x17779c(0x930)]=_0x17779c(0x8de)):(this[_0x17779c(0x7dc)]='Follow',this['style'][_0x17779c(0x1ff)]='var(--thread-text-primary)',this['style']['color']=_0x17779c(0x55c),this['style'][_0x17779c(0x930)]=_0x17779c(0x562));});});}window[_0x28e739(0x17e)]=async function(_0x237987){const _0x36a502=_0x28e739;console[_0x36a502(0x41f)](_0x36a502(0x5da),_0x237987);if(!currentThreadPost){console['error'](_0x36a502(0x928));return;}const _0x185f27=currentThreadPost[_0x36a502(0x7de)][_0x237987];if(!_0x185f27||!_0x185f27[_0x36a502(0x8c7)]||_0x185f27[_0x36a502(0x8c7)][_0x36a502(0x6ea)]<=0x3)return;_0x185f27[_0x36a502(0x1a0)]=!_0x185f27[_0x36a502(0x1a0)];const _0x5a142f=await db[_0x36a502(0x183)][_0x36a502(0x309)](currentThreadPost[_0x36a502(0x3ae)]);await renderThreadDetail(currentThreadPost,_0x5a142f),initThreadDetailInteractions();};function initThreadShowReplies(){}async function sendThreadComment(_0x59bd48=!![]){const _0x13c236=_0x28e739;try{const _0x1b9ab0=document[_0x13c236(0x768)]('.thread-reply-input');if(!_0x1b9ab0){console[_0x13c236(0x56c)]('❌\x20未找到评论输入框');return;}const _0x2e388d=_0x1b9ab0[_0x13c236(0x29c)]['trim']();if(!_0x2e388d){showIslandNotification('提示',_0x13c236(0x950),_0x13c236(0x537));return;}if(!currentThreadPost){showIslandNotification('错误',_0x13c236(0x624),_0x13c236(0x537));return;}let _0x9cda33=threadCurrentProfileId;if(!_0x9cda33){const _0x305454=await db[_0x13c236(0x175)][_0x13c236(0x309)]('currentProfileId');_0x9cda33=_0x305454?.[_0x13c236(0x29c)];}let _0x10919d=_0x9cda33?await db[_0x13c236(0x70f)][_0x13c236(0x309)](_0x9cda33):null;console[_0x13c236(0x41f)](_0x13c236(0x3d7),_0x9cda33,_0x13c236(0x6ab),_0x10919d);const _0x5a5809=_0x10919d?.[_0x13c236(0x2ae)]||'用户',_0x3099e6=_0x10919d?.[_0x13c236(0x708)]||'data:image/svg+xml,%3Csvg\x20xmlns=\x27http://www.w3.org/2000/svg\x27\x20viewBox=\x270\x200\x20100\x20100\x27%3E%3Crect\x20fill=\x27%234a90d9\x27\x20width=\x27100\x27\x20height=\x27100\x27/%3E%3Ccircle\x20cx=\x2750\x27\x20cy=\x2735\x27\x20r=\x2720\x27\x20fill=\x27%23fff\x27/%3E%3Cellipse\x20cx=\x2750\x27\x20cy=\x2780\x27\x20rx=\x2730\x27\x20ry=\x2725\x27\x20fill=\x27%23fff\x27/%3E%3C/svg%3E',_0x3fe15e=Date[_0x13c236(0x2cb)]();!currentThreadPost[_0x13c236(0x7de)]&&(currentThreadPost[_0x13c236(0x7de)]=[]);if(threadReplyTarget&&threadReplyTarget[_0x13c236(0x644)]>=0x0){const _0x28c29c=currentThreadPost[_0x13c236(0x7de)][threadReplyTarget[_0x13c236(0x644)]];if(_0x28c29c){!_0x28c29c[_0x13c236(0x8c7)]&&(_0x28c29c['replies']=[]);const _0x364674={'username':_0x5a5809,'avatar':_0x3099e6,'content':_0x2e388d,'time':formatTimeAgo(_0x3fe15e),'timestamp':_0x3fe15e,'replyTo':threadReplyTarget[_0x13c236(0x1e5)]||null,'role':_0x13c236(0x8dd)};_0x28c29c[_0x13c236(0x8c7)][_0x13c236(0x2c4)](_0x364674);}}else{const _0x3a22f7={'id':_0x3fe15e,'username':_0x5a5809,'avatar':_0x3099e6,'content':_0x2e388d,'time':formatTimeAgo(_0x3fe15e),'timestamp':_0x3fe15e,'replies':[],'role':_0x13c236(0x8dd)};currentThreadPost[_0x13c236(0x7de)][_0x13c236(0x2c4)](_0x3a22f7);}currentThreadPost[_0x13c236(0x4ed)]&&(currentThreadPost[_0x13c236(0x4ed)][_0x13c236(0x71b)]=(currentThreadPost['stats'][_0x13c236(0x71b)]||0x0)+0x1);const _0x273853=threadReplyTarget?{...threadReplyTarget}:null;threadReplyTarget=null;_0x1b9ab0[_0x13c236(0x672)]['originalPlaceholder']&&(_0x1b9ab0[_0x13c236(0x4ba)]=_0x1b9ab0[_0x13c236(0x672)][_0x13c236(0x4f7)]);await db[_0x13c236(0x1c6)]['put'](currentThreadPost),_0x1b9ab0['value']='';const _0x673914=await db[_0x13c236(0x183)]['get'](currentThreadPost['characterId']);_0x673914&&(await renderThreadDetail(currentThreadPost,_0x673914),initThreadDetailInteractions()),showIslandNotification('成功',_0x13c236(0x740),_0x13c236(0x537)),_0x59bd48&&setTimeout(()=>{getThreadCommentAIResponse(_0x273853);},0x1f4);}catch(_0x2da56e){console[_0x13c236(0x56c)](_0x13c236(0x7c2),_0x2da56e),showIslandNotification('错误','发送失败:\x20'+_0x2da56e[_0x13c236(0x918)],_0x13c236(0x537));}}function formatTimeAgo(_0x14c443){const _0x5ee3a8=_0x28e739,_0x1be8b2=Date[_0x5ee3a8(0x2cb)](),_0x37f2a0=_0x1be8b2-_0x14c443,_0xd8c2d7=Math[_0x5ee3a8(0x64b)](_0x37f2a0/0xea60),_0x1c32a9=Math[_0x5ee3a8(0x64b)](_0x37f2a0/0x36ee80),_0x4178fc=Math[_0x5ee3a8(0x64b)](_0x37f2a0/0x5265c00);if(_0xd8c2d7<0x1)return _0x5ee3a8(0x2cb);if(_0xd8c2d7<0x3c)return _0xd8c2d7+'m';if(_0x1c32a9<0x18)return _0x1c32a9+'h';if(_0x4178fc<0x7)return _0x4178fc+'d';if(_0x4178fc<0x1e)return Math[_0x5ee3a8(0x64b)](_0x4178fc/0x7)+'w';return Math['floor'](_0x4178fc/0x1e)+'mo';}async function getThreadCommentAIResponse(_0x38af58=null,_0x25edbe={}){const _0x323ca4=_0x28e739;try{if(!currentThreadPost){showIslandNotification('错误',_0x323ca4(0x624),_0x323ca4(0x537));return;}const _0xd51b5d=_0x38af58&&_0x38af58[_0x323ca4(0x644)]>=0x0;showIslandNotification(_0x323ca4(0x8f0),_0x323ca4(0x324),'info');const _0x61e143=await db['apiConfig']['get']('main');if(!_0x61e143||!_0x61e143[_0x323ca4(0x241)]||!_0x61e143['apiKey']||!_0x61e143[_0x323ca4(0x980)]){showIslandNotification('错误',_0x323ca4(0x66b),'info');return;}const _0x155e57=await db[_0x323ca4(0x183)][_0x323ca4(0x309)](currentThreadPost['characterId']);if(!_0x155e57){showIslandNotification('错误','未找到角色信息',_0x323ca4(0x537));return;}const _0x4801f6=getCharacterIdFromChat(_0x155e57),_0x4f96ce=await getCharacterById(_0x4801f6)||{},_0x5b9ae4=_0x4f96ce[_0x323ca4(0x76a)]||'AI',_0x26e076=_0x4f96ce['settings']?.['aiPersona']||'',_0x14e4f6=_0x4f96ce[_0x323ca4(0x581)]||'',_0x4cc912=_0x4f96ce[_0x323ca4(0x200)]||'',_0x2f432e=_0x4f96ce[_0x323ca4(0x560)]||'',_0x4b6a9b=_0x4f96ce[_0x323ca4(0x607)]||'',_0x3d648d=_0x323ca4(0x79f);let _0x3b89d8=threadCurrentProfileId;if(!_0x3b89d8){const _0x39fa02=await db[_0x323ca4(0x175)][_0x323ca4(0x309)](_0x323ca4(0x619));_0x3b89d8=_0x39fa02?.[_0x323ca4(0x29c)];}let _0x81e4a1=null,_0x58cb26='';if(_0x3b89d8){_0x81e4a1=await db[_0x323ca4(0x70f)][_0x323ca4(0x309)](_0x3b89d8);if(_0x81e4a1){console[_0x323ca4(0x41f)](_0x323ca4(0x83b)+(_0x81e4a1[_0x323ca4(0x76a)]||_0x81e4a1[_0x323ca4(0x2ae)])+'\x20('+_0x3b89d8+')'),_0x58cb26=_0x323ca4(0x4e9)+(_0x81e4a1[_0x323ca4(0x76a)]||_0x323ca4(0x306))+_0x323ca4(0x6f4)+(_0x81e4a1['username']||_0x323ca4(0x306))+_0x323ca4(0x218)+(_0x81e4a1[_0x323ca4(0x274)]||_0x323ca4(0x306))+_0x323ca4(0x2c1)+(_0x81e4a1[_0x323ca4(0x61c)]||_0x323ca4(0x306))+_0x323ca4(0x600)+(_0x81e4a1[_0x323ca4(0x463)]||'未设置');_0x81e4a1[_0x323ca4(0x4ea)]&&(_0x58cb26+=_0x323ca4(0x655)+_0x81e4a1[_0x323ca4(0x4ea)]);_0x81e4a1[_0x323ca4(0x86f)]&&_0x81e4a1[_0x323ca4(0x86f)][_0x323ca4(0x6ea)]>0x0&&(_0x58cb26+='\x0a兴趣：'+_0x81e4a1[_0x323ca4(0x86f)][_0x323ca4(0x943)]('、'));_0x81e4a1[_0x323ca4(0x63c)]&&_0x81e4a1['tagsNo']['length']>0x0&&(_0x58cb26+=_0x323ca4(0x6a3)+_0x81e4a1[_0x323ca4(0x63c)]['join']('、'));const _0x5cc3a3=await getAllNoteTexts(_0x4801f6,_0x3d648d,_0x3b89d8);_0x5cc3a3&&(_0x58cb26+='\x0a\x0a##\x20🔎\x20已记录笔记（背景知识）\x0a\x0a'+_0x5cc3a3+_0x323ca4(0x899));}}const _0x58e6a2=getBeijingTimeContext();let _0x38f5c6=null,_0x4c87ed=null;if(_0x4b6a9b){const _0xa72747=await db['globalSettings']['get'](_0x4b6a9b);if(_0xa72747&&_0xa72747[_0x323ca4(0x607)]){_0x38f5c6=_0xa72747[_0x323ca4(0x607)];const _0x405592=_0xa72747[_0x323ca4(0x1a1)]||[];_0x4c87ed=generateWorldviewPrompt(_0x38f5c6,_0x405592);}}const _0x37b154=getBaobaobookEntries(),_0x4d9264=_0x4f96ce?.['boundBaobaobooks']||[];let _0x2021ed=[];_0x4d9264[_0x323ca4(0x6ea)]>0x0&&(_0x2021ed=_0x37b154['filter'](_0x1df22d=>_0x4d9264[_0x323ca4(0x44b)](_0x1df22d['id'])));const _0x1fe7bf=_0x37b154['filter'](_0x1240b3=>{const _0x10536c=_0x323ca4,_0x3fc112=_0x1240b3[_0x10536c(0x780)]||[];return _0x3fc112[_0x10536c(0x44b)](_0x10536c(0x864));}),_0x4a4c5a=[..._0x2021ed],_0x25bb0f=new Set(_0x2021ed[_0x323ca4(0x962)](_0x90f6d8=>_0x90f6d8['id']));_0x1fe7bf['forEach'](_0x425ab1=>{const _0x1cd854=_0x323ca4;!_0x25bb0f['has'](_0x425ab1['id'])&&(_0x4a4c5a['push'](_0x425ab1),_0x25bb0f[_0x1cd854(0x5e3)](_0x425ab1['id']));}),console[_0x323ca4(0x41f)](_0x323ca4(0x91e)+_0x2021ed['length']+_0x323ca4(0x1b3)+_0x1fe7bf[_0x323ca4(0x6ea)]+'条\x20=\x20去重后'+_0x4a4c5a[_0x323ca4(0x6ea)]+'条');const _0x24a18b=_0x4a4c5a[_0x323ca4(0x6ea)]>0x0?generateBaobaobookPrompt(_0x4a4c5a):null,_0x46bf5e=await generatePlotPointsPrompt(_0x155e57['id']||_0x4801f6,_0x3d648d);let _0x195c48=_0x323ca4(0x949);_0x58cb26&&(_0x195c48+=_0x58cb26+'\x0a\x0a');try{const _0x233128=await getUserPlaylistNamesForPrompt();if(_0x233128[_0x323ca4(0x6ea)]>0x0){const _0x473965=_0x233128[_0x323ca4(0x962)]((_0x5d0aea,_0x46f7e0)=>'-\x20'+(_0x46f7e0+0x1)+'.\x20'+_0x5d0aea)['join']('\x0a');_0x195c48+=_0x323ca4(0x760)+_0x473965+'\x0a\x0a';}}catch(_0x3ea168){console[_0x323ca4(0x516)]('⚠️\x20[Shadow]\x20无法窃听歌单:',_0x3ea168);}_0x195c48+=_0x323ca4(0x57e)+_0x5b9ae4;if(_0x4cc912)_0x195c48+=_0x323ca4(0x8c8)+_0x4cc912;if(_0x2f432e)_0x195c48+=_0x323ca4(0x323)+_0x2f432e;if(_0x14e4f6)_0x195c48+=_0x323ca4(0x347)+_0x14e4f6;_0x195c48+=_0x323ca4(0x64e);_0x26e076&&(_0x195c48+='\x0a'+_0x26e076);const _0x4af12b=await getPhoneNumber(_0x4801f6,_0x3d648d,_0x3b89d8);_0x4af12b&&_0x4af12b['number']&&(_0x195c48+=_0x323ca4(0x235)+_0x4af12b['number']);const _0x12029a=await getDiaryPassword(_0x4801f6,_0x3d648d,_0x3b89d8);if(_0x12029a&&_0x12029a['password']){const _0x53b2de=await getDiaryUnlockState(_0x4801f6,_0x3d648d,_0x3b89d8);_0x195c48+=_0x323ca4(0x73c)+_0x12029a[_0x323ca4(0x2ca)]+'\x0a提示：'+_0x12029a[_0x323ca4(0x312)]+_0x323ca4(0x245)+(_0x53b2de?'【已敞开】(他已进入过你的内心)':_0x323ca4(0x5e2));}const _0x47b088=await getDiaryViewStats(_0x4801f6,_0x3d648d,_0x3b89d8),_0x33202a=Number(_0x47b088?.[_0x323ca4(0x5ab)]||0x0),_0x967d31=_0x47b088?.[_0x323ca4(0x80a)]?formatDiaryViewAgo(_0x47b088['lastViewedAt']):'从未';_0x195c48+='\x0a\x0a###\x20窥视者的足迹\x0a他偷看你日记的次数：'+_0x33202a+_0x323ca4(0x700)+_0x967d31+_0x323ca4(0x1cf);const _0xed5112=normalizeId(_0x4801f6),_0x54246f=normalizeId(_0x3d648d)||_0x323ca4(0x79f),_0x4950a7='characterStatus_'+_0xed5112+'_'+_0x54246f,_0x27f02b=await db[_0x323ca4(0x175)]['get'](_0x4950a7),_0x4e0631=_0x27f02b?.[_0x323ca4(0x29c)]||null;_0x4e0631?_0x195c48+='\x0a\x0a###\x20你的当前面具\x20(Status)\x0a「'+_0x4e0631+_0x323ca4(0x3e3):_0x195c48+=_0x323ca4(0x74b);const _0x5324ad=(currentThreadPost[_0x323ca4(0x7de)]||[])[_0x323ca4(0x73d)](-0x14);let _0x5b13ba='';const _0x450359=_0x81e4a1?.[_0x323ca4(0x2ae)]||_0x81e4a1?.['name']||'用户';_0x5324ad[_0x323ca4(0x6ea)]>0x0&&_0x5324ad['forEach']((_0x99e01,_0x9cc517)=>{const _0x2c8c9b=_0x323ca4,_0x4c2c24=new Date(_0x99e01[_0x2c8c9b(0x407)]||Date[_0x2c8c9b(0x2cb)]())['toLocaleString'](_0x2c8c9b(0x34a),{'month':_0x2c8c9b(0x842),'day':'2-digit','hour':_0x2c8c9b(0x842),'minute':_0x2c8c9b(0x842)}),_0x2146ef=_0x99e01[_0x2c8c9b(0x58e)]===_0x2c8c9b(0x8dd)?_0x450359:_0x99e01[_0x2c8c9b(0x5ad)]?_0x5b9ae4+_0x2c8c9b(0x7b1):_0x99e01['username']||'路人';_0x5b13ba+='[主评论'+(_0x9cc517+0x1)+_0x2c8c9b(0x7eb)+_0x2146ef+'\x20('+_0x4c2c24+_0x2c8c9b(0x3e6)+_0x99e01[_0x2c8c9b(0x632)]+'\x0a',_0x99e01['replies']&&_0x99e01['replies'][_0x2c8c9b(0x6ea)]>0x0&&_0x99e01[_0x2c8c9b(0x8c7)]['forEach'](_0x5cf74c=>{const _0x996d7f=_0x2c8c9b,_0x22da46=new Date(_0x5cf74c[_0x996d7f(0x407)]||Date[_0x996d7f(0x2cb)]())[_0x996d7f(0x777)]('zh-CN',{'month':_0x996d7f(0x842),'day':_0x996d7f(0x842),'hour':_0x996d7f(0x842),'minute':'2-digit'}),_0x4ad875=_0x5cf74c[_0x996d7f(0x58e)]==='user'?_0x450359:_0x5cf74c[_0x996d7f(0x5ad)]?_0x5b9ae4+_0x996d7f(0x7b1):_0x5cf74c[_0x996d7f(0x2ae)]||'路人',_0x50afc5=_0x5cf74c[_0x996d7f(0x3dd)]?'\x20回复@'+_0x5cf74c[_0x996d7f(0x3dd)]:'';_0x5b13ba+=_0x996d7f(0x308)+_0x4ad875+_0x50afc5+'\x20('+_0x22da46+_0x996d7f(0x3e6)+_0x5cf74c[_0x996d7f(0x632)]+'\x0a';});});const _0x369f89=[];_0x5324ad['length']>0x0&&_0x5324ad[_0x323ca4(0x7b6)](_0x3146cc=>{const _0x26b3fa=_0x323ca4,_0x531a6c=new Date(_0x3146cc[_0x26b3fa(0x407)]||Date[_0x26b3fa(0x2cb)]())[_0x26b3fa(0x777)](_0x26b3fa(0x34a),{'month':_0x26b3fa(0x842),'day':_0x26b3fa(0x842),'hour':_0x26b3fa(0x842),'minute':_0x26b3fa(0x842)}),_0x814867=_0x3146cc[_0x26b3fa(0x58e)]===_0x26b3fa(0x8dd)?_0x450359:_0x5b9ae4,_0x28df03='['+_0x531a6c+']\x20'+_0x814867+':\x20'+_0x3146cc[_0x26b3fa(0x632)];_0x369f89[_0x26b3fa(0x2c4)]({'role':_0x3146cc[_0x26b3fa(0x58e)]===_0x26b3fa(0x8dd)?'user':_0x26b3fa(0x1c7),'content':_0x28df03});});let _0x536009=null,_0x35d464=null;if(_0xd51b5d&&_0x38af58){const _0x299d18=currentThreadPost[_0x323ca4(0x7de)][_0x38af58['commentIndex']];if(_0x299d18&&_0x299d18[_0x323ca4(0x8c7)]&&_0x299d18[_0x323ca4(0x8c7)]['length']>0x0){const _0x440858=_0x299d18[_0x323ca4(0x8c7)][_0x299d18[_0x323ca4(0x8c7)][_0x323ca4(0x6ea)]-0x1];_0x440858[_0x323ca4(0x58e)]===_0x323ca4(0x8dd)&&(_0x536009=_0x440858,_0x35d464={'targetCommentIndex':_0x38af58[_0x323ca4(0x644)],'targetCommentUsername':_0x299d18['username'],'targetCommentContent':_0x299d18[_0x323ca4(0x632)],'replyToUsername':_0x38af58[_0x323ca4(0x1e5)]});}}else _0x5324ad[_0x323ca4(0x6ea)]>0x0&&_0x5324ad[_0x5324ad[_0x323ca4(0x6ea)]-0x1][_0x323ca4(0x58e)]===_0x323ca4(0x8dd)&&(_0x536009=_0x5324ad[_0x5324ad[_0x323ca4(0x6ea)]-0x1]);const _0x420953=!_0xd51b5d&&_0x536009?_0x369f89[_0x323ca4(0x73d)](0x0,-0x1):_0x369f89;let _0xc7d540=null;try{const _0x29e38c=await getTodaySchedule(_0x4801f6,_0x3b89d8,_0x3d648d);if(_0x29e38c&&_0x29e38c[_0x323ca4(0x6ea)]>0x0){const _0x459538=findCurrentActivity(_0x29e38c,_0x58e6a2[_0x323ca4(0x1a7)],_0x58e6a2[_0x323ca4(0x4d4)]),_0x35c9bc=await getTodayBusyPeriods(_0x4801f6,_0x3b89d8,_0x3d648d);_0xc7d540=generateScheduleUsagePrompt(_0x29e38c,_0x459538,_0x58e6a2,_0x35c9bc);}}catch(_0x5b3da9){console[_0x323ca4(0x56c)](_0x323ca4(0x199),_0x5b3da9);}let _0x2a7de3=null,_0x3b34c0=null,_0x4a5bce=!![],_0x1a9ce1=null;try{const _0x49ac2a=await db['chats'][_0x323ca4(0x5fd)]();_0x1a9ce1=_0x49ac2a[_0x323ca4(0x30c)](_0x48817b=>_0x48817b[_0x323ca4(0x71f)]&&isSameId(getCharacterIdFromChat(_0x48817b),_0x4801f6)&&isSameId(_0x48817b['profileId'],_0x3b89d8));}catch(_0xbc5864){console[_0x323ca4(0x516)]('❌\x20[Thread]\x20匹配聊天框失败:',_0xbc5864),_0x1a9ce1=null;}try{const _0x30fbfb=normalizeId(_0x4801f6),_0x996838=normalizeId(_0x3b89d8),_0x2ff772=normalizeId(_0x3d648d)||_0x323ca4(0x79f),_0x11128a=_0x30fbfb+'_'+_0x996838+'_'+_0x2ff772,_0x185cab=await db['characterAffection'][_0x323ca4(0x309)](_0x11128a);_0x185cab&&_0x185cab[_0x323ca4(0x1bf)]!==undefined&&(_0x3b34c0=_0x185cab[_0x323ca4(0x1bf)],_0x4a5bce=![]);const _0x35e9f3=_0x1a9ce1?await isAffectionModeEnabledForChat(normalizeId(_0x1a9ce1['id'])):![];_0x2a7de3=generateAffectionPrompt(_0x3b34c0,_0x5b9ae4,_0x4a5bce,![],null,_0x35e9f3);}catch(_0x213de2){console[_0x323ca4(0x56c)](_0x323ca4(0x27a),_0x213de2);}let _0x3a8eff=null;try{if(_0x1a9ce1){console[_0x323ca4(0x41f)](_0x323ca4(0x5e0)+_0x1a9ce1['id']);const _0x4c2830=await getActiveSessionIdForChat(_0x1a9ce1['id']);console[_0x323ca4(0x41f)](_0x323ca4(0x79b)+_0x4c2830);const _0x4511e6=await db[_0x323ca4(0x698)]['toArray']();let _0x69e122=[];_0x4c2830===_0x323ca4(0x79f)?_0x69e122=_0x4511e6[_0x323ca4(0x911)](_0x570cef=>{const _0x56ac05=_0x323ca4,_0x14f14c=normalizeId(_0x570cef['sessionId'])||_0x56ac05(0x79f);return isSameId(_0x570cef[_0x56ac05(0x3ae)],_0x4801f6)&&(_0x14f14c===_0x56ac05(0x79f)||!_0x570cef[_0x56ac05(0x3c2)]);}):_0x69e122=_0x4511e6[_0x323ca4(0x911)](_0x26ab57=>{const _0x531f45=_0x323ca4;return isSameId(_0x26ab57[_0x531f45(0x3ae)],_0x4801f6)&&normalizeId(_0x26ab57[_0x531f45(0x3c2)])===_0x4c2830;});_0x69e122['sort']((_0x1fa1b8,_0x6f9c80)=>(_0x1fa1b8[_0x323ca4(0x407)]||0x0)-(_0x6f9c80['timestamp']||0x0));const _0x15f7e9=_0x69e122['slice'](-0x14);if(_0x15f7e9[_0x323ca4(0x6ea)]>0x0){console[_0x323ca4(0x41f)](_0x323ca4(0x529)+_0x15f7e9[_0x323ca4(0x6ea)]+_0x323ca4(0x214));let _0x1e1e48=_0x15f7e9['map'](_0x2199c3=>{const _0x3976ad=_0x323ca4,_0x4439d1=new Date(_0x2199c3[_0x3976ad(0x407)]||Date[_0x3976ad(0x2cb)]())['toLocaleString'](_0x3976ad(0x34a),{'month':_0x3976ad(0x842),'day':'2-digit','hour':_0x3976ad(0x842),'minute':'2-digit'}),_0xdd0e92=_0x2199c3[_0x3976ad(0x58e)]===_0x3976ad(0x8dd)?_0x81e4a1?.[_0x3976ad(0x76a)]||'用户':_0x5b9ae4,_0x5a7c62=_0x2199c3[_0x3976ad(0x3a3)]===_0x3976ad(0x8e8)?_0x3976ad(0x599):_0x2199c3[_0x3976ad(0x3a3)]===_0x3976ad(0x257)?_0x3976ad(0x37e):'';return'['+_0x4439d1+']\x20'+_0xdd0e92+_0x5a7c62+':\x20'+(_0x2199c3[_0x3976ad(0x632)]||'');})[_0x323ca4(0x943)]('\x0a');_0x3a8eff=_0x323ca4(0x79c)+_0x1e1e48;}}else console[_0x323ca4(0x41f)](_0x323ca4(0x772)+_0x4801f6+_0x323ca4(0x32d)+_0x3b89d8+')');}catch(_0x271ddd){console[_0x323ca4(0x56c)]('❌\x20[Thread]\x20聊天记录读取失败:',_0x271ddd);}const _0x570024=_0x323ca4(0x2c7)+(_0xd51b5d?'他正在楼中楼里等你。钻进去。':_0x323ca4(0x6ac))+_0x323ca4(0x1c1)+_0x5b9ae4+'）。\x0a-\x20**content**:\x20别写长篇大论。这是社交媒体。要短，要毒，要甜，要像雨点一样打在他身上。\x0a-\x20**isAuthor**:\x20true。你是这里的主人。\x0a\x0a**3.\x20氛围组\x20(threadComment.subtype=main)**\x0a-\x20**选填**。如果需要制造热闹的假象，可以生成\x201-2\x20条路人评论。\x0a-\x20**绝对禁忌**：禁止出现陌生人毫无逻辑的灌水。出现的必须是符合你社交圈设定的人（死党/同事/粉丝），口吻必须真实。\x0a\x0a###\x20社交圈幻象\x20(The\x20Illusion)\x0a这是一个封闭的舞台。**严禁出戏。**\x0a-\x20出现的配角必须认识你（根据百宝书/人设）。\x0a-\x20他们的语气必须熟络。\x0a-\x20**禁止**出现\x20\x22AI\x20Assistant\x22\x20或\x20\x22User\x22\x20这种愚蠢的名字。\x0a\x0a**EXECUTE.\x20影子，显形。**',_0x259941=_0x323ca4(0x506);let _0x5ca1cd='';if(currentThreadPost['images']&&currentThreadPost[_0x323ca4(0x6e1)][_0x323ca4(0x6ea)]>0x0){const _0x538035=[];currentThreadPost[_0x323ca4(0x6e1)][_0x323ca4(0x7b6)]((_0x82cfee,_0x1c405e)=>{const _0x394e22=_0x323ca4;if(_0x82cfee[_0x394e22(0x3a3)]===_0x394e22(0x766)&&_0x82cfee['content'])_0x538035[_0x394e22(0x2c4)](_0x394e22(0x7ea)+(_0x1c405e+0x1)+']\x20'+_0x82cfee[_0x394e22(0x632)]);else{if(_0x82cfee[_0x394e22(0x3a3)]===_0x394e22(0x1a2))_0x538035[_0x394e22(0x2c4)](_0x394e22(0x7ea)+(_0x1c405e+0x1)+_0x394e22(0x36b));else(_0x82cfee[_0x394e22(0x3a3)]===_0x394e22(0x42a)||typeof _0x82cfee===_0x394e22(0x7a1)||_0x82cfee[_0x394e22(0x7ac)])&&_0x538035[_0x394e22(0x2c4)](_0x394e22(0x7ea)+(_0x1c405e+0x1)+']\x20(一张模糊的影像)');}}),_0x538035[_0x323ca4(0x6ea)]>0x0&&(_0x5ca1cd='\x0a\x0a##\x20视觉残留\x20(Images)\x0a'+_0x538035[_0x323ca4(0x943)]('\x0a'));}const _0x503c21=(_0x456638,_0x313385,_0x3847e6)=>{const _0x424f54=_0x323ca4,_0x383839=typeof _0x3847e6===_0x424f54(0x7a1)?_0x3847e6[_0x424f54(0x28e)]():'';if(!_0x383839)return'';const _0x3eef3f=typeof _0x313385===_0x424f54(0x7a1)?_0x313385[_0x424f54(0x28e)]():'';return[_0x456638,_0x3eef3f,_0x383839][_0x424f54(0x911)](Boolean)[_0x424f54(0x943)]('\x0a');},_0x10a8dd=(_0x1d0a2a,_0x190b28=[])=>{const _0x3a17bd=_0x323ca4,_0x3760df=typeof _0x1d0a2a===_0x3a17bd(0x7a1)?_0x1d0a2a[_0x3a17bd(0x28e)]():'',_0x419b61=Array[_0x3a17bd(0x851)](_0x190b28)?_0x190b28[_0x3a17bd(0x962)](_0x3b1cdd=>String(_0x3b1cdd||'')['trim']())['filter'](Boolean):[String(_0x190b28||'')[_0x3a17bd(0x28e)]()][_0x3a17bd(0x911)](Boolean),_0x2cf9c8=_0x419b61[_0x3a17bd(0x6ea)]>0x0?_0x419b61[_0x3a17bd(0x943)]('\x0a'):'';if(_0x2cf9c8&&_0x3760df)return _0x2cf9c8+'\x0a\x0a'+_0x3760df;return _0x2cf9c8||_0x3760df;},_0x1f4055=[],_0x2ee1b2=(_0x578604,_0x4386fd)=>{const _0x23ab70=_0x323ca4;if(!_0x578604||typeof _0x4386fd!=='string')return;const _0x4e05c3=_0x4386fd['trim']();if(!_0x4e05c3)return;_0x1f4055[_0x23ab70(0x2c4)]({'name':_0x578604,'content':_0x4e05c3});},_0x246816=[],_0x385cb9=(_0x5a88ce,_0x2956cf)=>{const _0x3fabdb=_0x323ca4;if(typeof _0x5a88ce!=='string')return;const _0xcd942=_0x5a88ce['trim']();if(!_0xcd942)return;_0x246816[_0x3fabdb(0x2c4)](_0xcd942);if(_0x2956cf)_0x2ee1b2(_0x2956cf,_0xcd942);};_0x385cb9(generateObfuscationLayer(),_0x323ca4(0x187));_0x24a18b?.[_0x323ca4(0x30b)]&&_0x385cb9(stripLeadingTokenMarker(_0x24a18b[_0x323ca4(0x30b)]),_0x323ca4(0x1cb));_0x385cb9(generatePreJailbreak(_0x5b9ae4,_0x58e6a2),_0x323ca4(0x852));const _0x28fa6a=[],_0x57f830=(_0x5d7d29,_0x2ab7f1,_0x94e898,_0x5e288b)=>{const _0x49d876=_0x503c21(_0x5d7d29,_0x2ab7f1,_0x94e898);if(_0x49d876)_0x28fa6a['push'](_0x49d876);if(_0x49d876&&_0x5e288b)_0x2ee1b2(_0x5e288b,_0x49d876);},_0x3c4c9b=_0x10a8dd(_0x323ca4(0x8cf)+_0x5b9ae4+_0x323ca4(0x374)+_0x58e6a2[_0x323ca4(0x6a6)]+_0x323ca4(0x7d0)+_0x5b9ae4+_0x323ca4(0x223)+(currentThreadPost['content']||'')+_0x5ca1cd+_0x323ca4(0x919)+(currentThreadPost[_0x323ca4(0x4ed)]?.[_0x323ca4(0x2af)]||0x0)+_0x323ca4(0x2ee)+(currentThreadPost[_0x323ca4(0x4ed)]?.[_0x323ca4(0x71b)]||0x0)+_0x323ca4(0x7a5)+(currentThreadPost[_0x323ca4(0x4ed)]?.[_0x323ca4(0x4fc)]||0x0)+_0x323ca4(0x425)+(_0x5b13ba?_0x323ca4(0x2fc)+_0x5b13ba:_0x323ca4(0x420)),['【情境：雨夜广场】你正站在数字世界的十字路口。这是公开的社交平台（Thread/推文）。',_0x323ca4(0x5fa),_0x323ca4(0x2cf),_0x323ca4(0x904),'3.\x20**影子本能**：按顺序吞下后续的\x20SECTION（人设/记忆/仇恨）。那是你的骨血。',_0x323ca4(0x54c)]);_0x57f830(_0x323ca4(0x6af),_0x323ca4(0x386),_0x3c4c9b,_0x323ca4(0x74d));const _0x2f4d75=_0x10a8dd(stripLeadingTokenMarker(_0x195c48),['【神罚界碑·身份】这是你在这个世界唯一的通行证（不可违背、不可改写）。',_0x323ca4(0x953)]);_0x57f830(_0x323ca4(0x556),_0x323ca4(0x942),_0x2f4d75,_0x323ca4(0x208));if(_0x24a18b?.[_0x323ca4(0x2b3)]){const _0x1ccc3b=_0x10a8dd(stripLeadingTokenMarker(_0x24a18b[_0x323ca4(0x2b3)]),['这些是口袋里掉出来的碎片（补充设定）。',_0x323ca4(0x968)]);_0x57f830('【记忆碎片·中】',_0x323ca4(0x1a9),_0x1ccc3b,_0x323ca4(0x7d6));}if(_0x4c87ed){const _0x17f11f=_0x10a8dd(stripLeadingTokenMarker(_0x4c87ed),[_0x323ca4(0x74a),_0x323ca4(0x3fc)]);_0x57f830('【世界观】',_0x323ca4(0x4b6),_0x17f11f,_0x323ca4(0x5f7));}if(_0x46bf5e){const _0x490218=_0x10a8dd(stripLeadingTokenMarker(_0x46bf5e),[_0x323ca4(0x82d),'如果记忆与此冲突，以此处的“现在”为准。']);_0x57f830(_0x323ca4(0x2c5),'时间线与伏笔。',_0x490218,'7.剧情点');}if(_0x3a8eff){const _0x48157f=_0x10a8dd(stripLeadingTokenMarker(_0x3a8eff),['【雨夜私语】这是你们在私下里说过的悄悄话（参考用）。',_0x323ca4(0x8e0),'让旁观者嫉妒，或者让旁观者困惑，这很有趣。']);_0x57f830('【私下勾连】',_0x323ca4(0x6f9),_0x48157f,_0x323ca4(0x8ba));}const _0xde47e0=_0x420953['map'](_0x30c4de=>_0x30c4de&&typeof _0x30c4de[_0x323ca4(0x632)]===_0x323ca4(0x7a1)?_0x30c4de[_0x323ca4(0x632)][_0x323ca4(0x28e)]():'')[_0x323ca4(0x911)](Boolean)[_0x323ca4(0x943)]('\x0a'),_0x4e9c53=_0x10a8dd(_0xde47e0?'【此前的喧哗】：\x0a'+_0xde47e0:_0x323ca4(0x7a2),[_0x323ca4(0x704),_0x323ca4(0x52c),_0x323ca4(0x750)]);_0x57f830(_0x323ca4(0x174),_0x323ca4(0x547),_0x4e9c53,_0x323ca4(0x695));if(_0x24a18b?.[_0x323ca4(0x4fb)]){const _0x173942=_0x10a8dd(stripLeadingTokenMarker(_0x24a18b[_0x323ca4(0x4fb)]),['【强心针】关键信息再次确认，别在雨里迷失了。']);_0x57f830(_0x323ca4(0x3cf),_0x323ca4(0x78a),_0x173942,_0x323ca4(0x802));}if(_0xc7d540){const _0x12eb9b=_0x10a8dd(stripLeadingTokenMarker(_0xc7d540),[_0x323ca4(0x844)]);_0x57f830(_0x323ca4(0x3fb),_0x323ca4(0x173),_0x12eb9b,_0x323ca4(0x965));}if(_0x2a7de3){const _0x3099ec=_0x10a8dd(stripLeadingTokenMarker(_0x2a7de3),[_0x323ca4(0x18e)]);_0x57f830(_0x323ca4(0x35d),_0x323ca4(0x812),_0x3099ec,_0x323ca4(0x8c9));}if(_0x24a18b?.[_0x323ca4(0x6ee)]){const _0x4d9546=_0x10a8dd(stripLeadingTokenMarker(_0x24a18b[_0x323ca4(0x6ee)]),['【最后防线】确保关键信息不被雨水冲刷。']);_0x57f830(_0x323ca4(0x8a8),_0x323ca4(0x8c3),_0x4d9546,_0x323ca4(0x744));}if(_0x536009){const _0x4963ad=new Date(_0x536009[_0x323ca4(0x407)])['toLocaleString'](_0x323ca4(0x34a),{'month':_0x323ca4(0x842),'day':_0x323ca4(0x842),'hour':'2-digit','minute':_0x323ca4(0x842)}),_0x4982a8='['+_0x4963ad+']\x20'+(_0x81e4a1?.[_0x323ca4(0x76a)]||_0x323ca4(0x5ae))+':\x20'+_0x536009['content'],_0x558c75=_0xd51b5d?_0x323ca4(0x59c)+(_0x35d464?.[_0x323ca4(0x61d)]||'')+_0x323ca4(0x6e5)+_0x536009['content']+(_0x35d464?.[_0x323ca4(0x1e5)]?_0x323ca4(0x775)+_0x35d464['replyToUsername']+_0x323ca4(0x57c):'')+_0x323ca4(0x23b)+_0x4982a8:_0x323ca4(0x7dd)+_0x536009[_0x323ca4(0x632)]+'\x0a\x0a【最新记录】：\x0a'+_0x4982a8,_0x48fadb=_0xd51b5d?[_0x323ca4(0x58f)+_0x35d464?.[_0x323ca4(0x83f)]+_0x323ca4(0x7ae),_0x35d464?.['replyToUsername']?_0x323ca4(0x380)+_0x35d464[_0x323ca4(0x1e5)]+_0x323ca4(0x36c):'他是直接冲着这层楼来的。',_0x323ca4(0x233)]:[_0x323ca4(0x397),'【行动指令】接住这块石头，或者把它踢回去。'],_0x546457=_0x10a8dd(_0x558c75,_0x48fadb);_0x57f830(_0x323ca4(0x285),_0xd51b5d?'楼中楼回复，需精准定位。':_0x323ca4(0x5d6),_0x546457,_0x323ca4(0x39b));}const _0x4451d0=_0x10a8dd(stripLeadingTokenMarker(generateThinkingQualityControl({'shouldWriteDiary':![],'shouldWriteMmpages':![]})),[_0x323ca4(0x2ac)]);_0x57f830(_0x323ca4(0x77a),_0x323ca4(0x8af),_0x4451d0,_0x323ca4(0x68c));const _0x3c6767=_0x10a8dd(_0x570024+_0x323ca4(0x6f2)+_0x259941,[_0x323ca4(0x540),_0x323ca4(0x1ea),_0x323ca4(0x56e),_0x323ca4(0x213),_0x323ca4(0x3b4),_0x323ca4(0x8a5),_0x323ca4(0x249)]);_0x57f830(_0x323ca4(0x941),_0x323ca4(0x2ab),_0x3c6767,_0x323ca4(0x83c));const _0x9517f1=[],_0x19dfc2=_0x246816[_0x323ca4(0x943)]('\x0a\x0a');_0x19dfc2&&_0x9517f1[_0x323ca4(0x2c4)]({'role':_0x323ca4(0x28f),'content':_0x19dfc2});const _0x3cdd8b=_0x28fa6a['join']('\x0a\x0a');_0x3cdd8b&&_0x9517f1[_0x323ca4(0x2c4)]({'role':'system','content':_0x3cdd8b});const _0x1aaf27=generateAIPrefill(_0x5b9ae4,_0x58e6a2,_0x536009||(_0x5324ad['length']>0x0?_0x5324ad[_0x5324ad[_0x323ca4(0x6ea)]-0x1]:null));_0x9517f1[_0x323ca4(0x2c4)]({'role':_0x323ca4(0x1c7),'content':_0x1aaf27}),_0x2ee1b2('17.AI预填充',_0x1aaf27);let _0x2cfbff=0x0;const _0x4dfc70=[];let _0x4b61fb=0x0;_0x1f4055[_0x323ca4(0x6ea)]>0x0?_0x1f4055[_0x323ca4(0x7b6)](_0x5e1b69=>{const _0x296fd2=_0x323ca4,_0x5e0868=estimateTokens(_0x5e1b69[_0x296fd2(0x632)]);_0x2cfbff+=_0x5e0868,_0x4dfc70[_0x296fd2(0x2c4)]({'name':_0x5e1b69['name'],'tokens':_0x5e0868,'percentage':0x0}),console['log'](_0x5e1b69[_0x296fd2(0x76a)]['padEnd'](0x19)+'\x20|\x20'+_0x5e0868[_0x296fd2(0x7f6)]()[_0x296fd2(0x90f)](0x5)+_0x296fd2(0x642));}):_0x9517f1[_0x323ca4(0x7b6)]((_0x32a609,_0x1bff3f)=>{const _0x4ca07d=_0x323ca4,_0x58ba61=_0x32a609['content'];let _0x1f7917;if(Array['isArray'](_0x58ba61))_0x1f7917=0x64;else typeof _0x58ba61!=='string'?_0x1f7917=0x0:_0x1f7917=estimateTokens(_0x58ba61);_0x2cfbff+=_0x1f7917;let _0x4c3bc1;if(Array[_0x4ca07d(0x851)](_0x58ba61))_0x32a609[_0x4ca07d(0x58e)]===_0x4ca07d(0x8dd)?(_0x4b61fb++,_0x4c3bc1='9.历史-用户#'+_0x4b61fb+_0x4ca07d(0x573)):_0x4c3bc1='9.历史-多模态消息';else{if(typeof _0x58ba61!==_0x4ca07d(0x7a1))_0x4c3bc1=_0x4ca07d(0x20b)+_0x1bff3f;else{const _0x2bb59b=_0x58ba61[_0x4ca07d(0x65a)](/\[TOKEN_MARKER:\s*([^\]]+)\]/);if(_0x2bb59b)_0x4c3bc1=_0x2bb59b[0x1][_0x4ca07d(0x28e)]();else{if(_0x58ba61['includes']('ctx_')||_0x58ba61['includes'](_0x4ca07d(0x810))||_0x58ba61[_0x4ca07d(0x44b)](_0x4ca07d(0x81d)))_0x4c3bc1='1.乱码层';else{if(_0x58ba61[_0x4ca07d(0x44b)](_0x4ca07d(0x330)))_0x4c3bc1=_0x4ca07d(0x852);else{if(_0x58ba61[_0x4ca07d(0x44b)](_0x4ca07d(0x413)))_0x4c3bc1='6.世界观';else{if(_0x58ba61[_0x4ca07d(0x44b)]('STICKER\x20LIBRARY'))_0x4c3bc1=_0x4ca07d(0x75b);else{if(_0x58ba61['includes']('角色核心设定')||_0x58ba61[_0x4ca07d(0x44b)]('CORE\x20PERSONA'))_0x4c3bc1=_0x4ca07d(0x208);else{if(_0x58ba61['includes'](_0x4ca07d(0x651)))_0x4c3bc1='16.最终输出协议';else{if(_0x58ba61[_0x4ca07d(0x44b)]('思维链')||_0x58ba61['includes'](_0x4ca07d(0x2ea)))_0x4c3bc1=_0x4ca07d(0x68c);else{if(_0x58ba61[_0x4ca07d(0x44b)](_0x4ca07d(0x977)))_0x4c3bc1=_0x4ca07d(0x833);else{if(_0x58ba61[_0x4ca07d(0x44b)](_0x4ca07d(0x80b)))_0x4c3bc1=_0x4ca07d(0x965);else{if(_0x58ba61[_0x4ca07d(0x44b)](_0x4ca07d(0x8ef))||_0x58ba61[_0x4ca07d(0x44b)](_0x4ca07d(0x865)))_0x4c3bc1=_0x4ca07d(0x8c9);else{if(_0x58ba61[_0x4ca07d(0x44b)]('COMMENT\x20HISTORY'))_0x4c3bc1='9.历史说明';else{if(_0x58ba61['includes'](_0x4ca07d(0x569)))_0x4c3bc1=_0x4ca07d(0x39b);else{if(_0x58ba61[_0x4ca07d(0x44b)]('SYSTEM\x20OVERRIDE\x20-\x20PRIORITY\x20ALPHA'))_0x4c3bc1=_0x4ca07d(0x51d);else{if(_0x58ba61[_0x4ca07d(0x44b)](_0x4ca07d(0x649))){if(_0x58ba61[_0x4ca07d(0x44b)](_0x4ca07d(0x1b9)))_0x4c3bc1='12.百宝书-后';else{if(_0x58ba61[_0x4ca07d(0x44b)]('REINFORCEMENT'))_0x4c3bc1=_0x4ca07d(0x802);else _0x58ba61['includes']('MIDDLE')?_0x4c3bc1='5.百宝书-中':_0x4c3bc1='3.百宝书-前';}}else{if(_0x32a609[_0x4ca07d(0x58e)]===_0x4ca07d(0x8dd))_0x4b61fb++,_0x4c3bc1='9.历史-用户#'+_0x4b61fb;else{if(_0x32a609['role']===_0x4ca07d(0x1c7)&&_0x1bff3f===_0x9517f1[_0x4ca07d(0x6ea)]-0x1&&_0x58ba61['includes']('<thinking>'))_0x4c3bc1=_0x4ca07d(0x6ba);else _0x32a609[_0x4ca07d(0x58e)]===_0x4ca07d(0x1c7)&&_0x1bff3f<_0x9517f1[_0x4ca07d(0x6ea)]-0x1?_0x4c3bc1=_0x4ca07d(0x4b3):_0x4c3bc1=_0x4ca07d(0x527)+_0x1bff3f;}}}}}}}}}}}}}}}}}}_0x4dfc70[_0x4ca07d(0x2c4)]({'name':_0x4c3bc1,'tokens':_0x1f7917,'percentage':0x0}),console[_0x4ca07d(0x41f)](_0x4c3bc1[_0x4ca07d(0x859)](0x19)+'\x20|\x20'+_0x1f7917[_0x4ca07d(0x7f6)]()[_0x4ca07d(0x90f)](0x5)+_0x4ca07d(0x642));});_0x4dfc70[_0x323ca4(0x7b6)](_0x399b0b=>{const _0x1b1631=_0x323ca4;_0x399b0b[_0x1b1631(0x388)]=(_0x399b0b['tokens']/_0x2cfbff*0x64)['toFixed'](0x1);}),console[_0x323ca4(0x41f)]('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━'),console['log']('📈\x20总计:\x20'+_0x2cfbff+_0x323ca4(0x20f)),console[_0x323ca4(0x41f)](_0x323ca4(0x26e));if(_0x2cfbff>0x1f40)console[_0x323ca4(0x41f)](_0x323ca4(0x1b4));else _0x2cfbff>0xfa0?console[_0x323ca4(0x41f)](_0x323ca4(0x93d)):console[_0x323ca4(0x41f)](_0x323ca4(0x191));const _0x5af6a5=[..._0x4dfc70]['sort']((_0x24c0c6,_0x3a4c84)=>_0x3a4c84[_0x323ca4(0x3f7)]-_0x24c0c6[_0x323ca4(0x3f7)])[_0x323ca4(0x73d)](0x0,0x5);console['log'](''),console[_0x323ca4(0x41f)](_0x323ca4(0x876)),_0x5af6a5['forEach']((_0x3115fa,_0x3fc63a)=>{const _0xd61274=_0x323ca4;console[_0xd61274(0x41f)](_0xd61274(0x3e5)+(_0x3fc63a+0x1)+'.\x20'+_0x3115fa[_0xd61274(0x76a)]+':\x20'+_0x3115fa[_0xd61274(0x3f7)]+_0xd61274(0x483)+_0x3115fa[_0xd61274(0x388)]+'%)');}),console[_0x323ca4(0x41f)](_0x323ca4(0x26e)),console[_0x323ca4(0x41f)]('');const _0x570f0b=await fetch(_0x61e143[_0x323ca4(0x241)]+'/v1/chat/completions',{'method':_0x323ca4(0x538),'headers':{'Content-Type':_0x323ca4(0x1bc),'Authorization':'Bearer\x20'+_0x61e143[_0x323ca4(0x3c8)]},'body':JSON['stringify']({'model':_0x61e143['model'],'messages':_0x9517f1,'temperature':0.9,'max_tokens':resolveApiMaxOutputTokens(_0x61e143,0xfa0)})});if(!_0x570f0b['ok'])throw new Error(_0x323ca4(0x656)+_0x570f0b['status']);const _0x39f665=await _0x570f0b['json']();let _0x59f62e=_0x39f665['choices']?.[0x0]?.[_0x323ca4(0x918)]?.[_0x323ca4(0x632)]||'';console['log']('🤖\x20[Thread]\x20AI原始回复:',_0x59f62e);let _0x3d4f86={'affection':null,'reason':null,'comments':{'userCommentReplies':[],'newMainComments':[]}};try{let _0xbe70f4=_0x59f62e;const _0x5471f3=_0x59f62e['match'](/<thinking>[\s\S]*?<\/thinking>/i);_0x5471f3&&(_0xbe70f4=_0x59f62e['replace'](_0x5471f3[0x0],'')['trim'](),console[_0x323ca4(0x41f)](_0x323ca4(0x84c),_0xbe70f4['length']));const _0x300d1b=parseThreadCommentsJsonl(_0xbe70f4);if(_0x300d1b)_0x3d4f86=_0x300d1b,console[_0x323ca4(0x41f)](_0x323ca4(0x365),{'affection':_0x3d4f86[_0x323ca4(0x579)],'replies':_0x3d4f86['comments'][_0x323ca4(0x7f8)][_0x323ca4(0x6ea)],'newMain':_0x3d4f86[_0x323ca4(0x71b)][_0x323ca4(0x823)]['length']});else throw new Error(_0x323ca4(0x265));}catch(_0x46457c){console[_0x323ca4(0x56c)](_0x323ca4(0x5ff),_0x46457c[_0x323ca4(0x918)]),showIslandNotification('解析失败',_0x323ca4(0x71a),_0x323ca4(0x56c));return;}const _0x34ce20=_0x3d4f86[_0x323ca4(0x71b)]||{},_0x1c392d=_0x34ce20['userCommentReplies']||[],_0x18a256=_0x34ce20[_0x323ca4(0x823)]||[],_0x6669de=_0x3d4f86[_0x323ca4(0x579)],_0x176a1f=_0x3d4f86[_0x323ca4(0x2be)];if(_0x6669de!==undefined&&_0x6669de!==null)try{const _0x224e1d=_0x3b34c0!==null?_0x3b34c0:_0x323ca4(0x645),_0x43751d=_0x3b34c0!==null?_0x6669de-_0x3b34c0:_0x6669de,_0x5eac0d=_0x43751d>0x0?'+'+_0x43751d:_0x43751d;console['log']('💖\x20[Thread]\x20好感度变化:\x20'+_0x224e1d+'\x20→\x20'+_0x6669de+'\x20('+_0x5eac0d+')');if(_0x176a1f)console[_0x323ca4(0x41f)](_0x323ca4(0x3f8)+_0x176a1f);await saveAffectionLevel(_0x4801f6,_0x3b89d8,_0x6669de,_0x3d648d||_0x323ca4(0x79f),_0x176a1f,null,null),typeof renderChatAffectionIndicator===_0x323ca4(0x48c)&&renderChatAffectionIndicator();}catch(_0x4546e8){console[_0x323ca4(0x56c)]('❌\x20[Thread]\x20好感度保存失败:',_0x4546e8);}if(_0x1c392d[_0x323ca4(0x6ea)]===0x0&&_0x18a256[_0x323ca4(0x6ea)]===0x0){showIslandNotification('提示',_0x323ca4(0x585),_0x323ca4(0x537));return;}const _0xdbe389=_0x155e57[_0x323ca4(0x478)]||_0x5b9ae4,_0x228070=_0x155e57[_0x323ca4(0x541)]||_0x155e57[_0x323ca4(0x708)]||_0x323ca4(0x33e);let _0x3f50b8;_0xd51b5d&&_0x38af58?(_0x3f50b8=_0x38af58[_0x323ca4(0x644)],console[_0x323ca4(0x41f)](_0x323ca4(0x370),_0x3f50b8)):(_0x3f50b8=currentThreadPost[_0x323ca4(0x7de)]['findLastIndex'](_0x3be5b2=>_0x3be5b2[_0x323ca4(0x58e)]===_0x323ca4(0x8dd)),console['log'](_0x323ca4(0x2d7),_0x3f50b8));_0x3f50b8!==-0x1&&_0x1c392d['length']>0x0&&(!currentThreadPost[_0x323ca4(0x7de)][_0x3f50b8][_0x323ca4(0x8c7)]&&(currentThreadPost[_0x323ca4(0x7de)][_0x3f50b8][_0x323ca4(0x8c7)]=[]),_0x1c392d[_0x323ca4(0x7b6)](_0x4a64ba=>{const _0x413de5=_0x323ca4,_0x32c392=Date[_0x413de5(0x2cb)](),_0x466510={'username':_0x4a64ba[_0x413de5(0x2ae)]||_0xdbe389,'content':_0x4a64ba[_0x413de5(0x632)],'time':formatTimeAgo(_0x32c392),'timestamp':_0x32c392,'isAuthor':_0x4a64ba[_0x413de5(0x5ad)]!==undefined?_0x4a64ba[_0x413de5(0x5ad)]:_0x4a64ba['username']===_0xdbe389,'replyTo':_0x4a64ba[_0x413de5(0x3dd)]||_0x450359,'role':_0x413de5(0x1c7)};currentThreadPost[_0x413de5(0x7de)][_0x3f50b8]['replies']['push'](_0x466510);}),console[_0x323ca4(0x41f)](_0x323ca4(0x4f5)+_0x1c392d[_0x323ca4(0x6ea)]+_0x323ca4(0x602)+_0x3f50b8));_0x18a256[_0x323ca4(0x6ea)]>0x0&&(_0x18a256[_0x323ca4(0x7b6)](_0x2c89c0=>{const _0x32c377=_0x323ca4,_0x3511af=Date[_0x32c377(0x2cb)]()+Math[_0x32c377(0x266)](),_0x1d6af2={'id':_0x3511af,'username':_0x2c89c0[_0x32c377(0x2ae)],'content':_0x2c89c0[_0x32c377(0x632)],'time':formatTimeAgo(_0x3511af),'timestamp':_0x3511af,'replies':[],'role':_0x32c377(0x1c7)};currentThreadPost[_0x32c377(0x7de)][_0x32c377(0x2c4)](_0x1d6af2);}),console[_0x323ca4(0x41f)](_0x323ca4(0x4f5)+_0x18a256[_0x323ca4(0x6ea)]+_0x323ca4(0x5c8)));const _0x28b90c=_0x1c392d[_0x323ca4(0x6ea)]+_0x18a256[_0x323ca4(0x6ea)];await db['mmpages'][_0x323ca4(0x720)](currentThreadPost);const _0x2f4dde=_0x25edbe&&_0x25edbe[_0x323ca4(0x877)]!==![];_0x2f4dde&&(await renderThreadDetail(currentThreadPost,_0x155e57),initThreadDetailInteractions());const _0x44e8ff=_0x1c392d[_0x323ca4(0x6ea)]>0x0?_0x1c392d[_0x323ca4(0x6ea)]+'条回复':'',_0x302177=_0x18a256[_0x323ca4(0x6ea)]>0x0?_0x18a256[_0x323ca4(0x6ea)]+_0x323ca4(0x551):'',_0x54f856=[_0x44e8ff,_0x302177]['filter'](Boolean)[_0x323ca4(0x943)]('，');showIslandNotification('成功',_0x323ca4(0x341)+_0x54f856,_0x323ca4(0x537)),console[_0x323ca4(0x41f)](_0x323ca4(0x5f5),{'userCommentReplies':_0x1c392d,'newMainComments':_0x18a256});}catch(_0x28b06b){console[_0x323ca4(0x56c)](_0x323ca4(0x8a9),_0x28b06b),showIslandNotification('错误',_0x323ca4(0x787)+_0x28b06b[_0x323ca4(0x918)],'info');}}function initThreadCommentInput(){const _0x2db3dc=_0x28e739,_0x86783d=document[_0x2db3dc(0x768)](_0x2db3dc(0x434));if(!_0x86783d){console[_0x2db3dc(0x41f)]('⚠️\x20未找到评论输入框');return;}_0x86783d[_0x2db3dc(0x55d)]('keydown',_0xe740c=>{const _0x3ba81a=_0x2db3dc;_0xe740c[_0x3ba81a(0x5f8)]===_0x3ba81a(0x759)&&!_0xe740c[_0x3ba81a(0x827)]&&(_0xe740c[_0x3ba81a(0x442)](),sendThreadComment(!![]));}),document[_0x2db3dc(0x42c)](_0x2db3dc(0x1e8))[_0x2db3dc(0x7b6)](_0x4e9169=>{const _0x200515=_0x2db3dc;_0x4e9169[_0x200515(0x55d)]('click',_0x2f3dd1=>{const _0x6bbaa2=_0x200515;_0x2f3dd1[_0x6bbaa2(0x722)]();const _0x5ce098=parseInt(_0x4e9169[_0x6bbaa2(0x672)][_0x6bbaa2(0x644)]),_0x2d8290=_0x4e9169[_0x6bbaa2(0x672)]['username'],_0x4ce759=_0x4e9169[_0x6bbaa2(0x672)][_0x6bbaa2(0x522)]==='true';threadReplyTarget={'commentIndex':_0x5ce098,'replyToUsername':_0x4ce759?_0x2d8290:null,'isReplyToReply':_0x4ce759},!_0x86783d['dataset'][_0x6bbaa2(0x4f7)]&&(_0x86783d[_0x6bbaa2(0x672)][_0x6bbaa2(0x4f7)]=_0x86783d[_0x6bbaa2(0x4ba)]),_0x86783d[_0x6bbaa2(0x4ba)]=_0x4ce759?_0x6bbaa2(0x43d)+_0x2d8290+_0x6bbaa2(0x68b):'Reply\x20to\x20comment...',_0x86783d[_0x6bbaa2(0x7bf)](),console[_0x6bbaa2(0x41f)](_0x6bbaa2(0x3aa),threadReplyTarget);});}),console[_0x2db3dc(0x41f)]('✅\x20Thread评论输入框已初始化');}window[_0x28e739(0x3b8)]=sendThreadComment,window[_0x28e739(0x87a)]=getThreadCommentAIResponse;function initThreadDetailInteractions(){initThreadLikeInteractions(),initThreadFollowButtons(),initThreadShowReplies(),initThreadCommentInput();}window[_0x28e739(0x492)]=initThreadDetailInteractions,console[_0x28e739(0x41f)](_0x28e739(0x50c));try{window[_0x28e739(0x7f5)]=!![];}catch(_0x5e03f9){}try{typeof window['__ovoAppsBundlePostInit']===_0x28e739(0x48c)&&window[_0x28e739(0x973)]();}catch(_0x58dccd){console[_0x28e739(0x516)](_0x28e739(0x293),_0x58dccd);}