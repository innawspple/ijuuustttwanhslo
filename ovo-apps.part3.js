const _0x2a6210=_0x18ea;(function(_0x19ec08,_0x5206b2){const _0x3fcf89=_0x18ea,_0x27138f=_0x19ec08();while(!![]){try{const _0x29bfda=parseInt(_0x3fcf89(0x16f))/0x1*(-parseInt(_0x3fcf89(0xa8))/0x2)+-parseInt(_0x3fcf89(0x834))/0x3*(-parseInt(_0x3fcf89(0x142))/0x4)+parseInt(_0x3fcf89(0x268))/0x5*(parseInt(_0x3fcf89(0x5b0))/0x6)+-parseInt(_0x3fcf89(0x36c))/0x7*(parseInt(_0x3fcf89(0x7c2))/0x8)+-parseInt(_0x3fcf89(0x3a2))/0x9+parseInt(_0x3fcf89(0x3ab))/0xa*(parseInt(_0x3fcf89(0x548))/0xb)+parseInt(_0x3fcf89(0x6f9))/0xc;if(_0x29bfda===_0x5206b2)break;else _0x27138f['push'](_0x27138f['shift']());}catch(_0x4795dc){_0x27138f['push'](_0x27138f['shift']());}}}(_0x4466,0xf1eae));try{if(typeof __ovoOnlineGate===_0x2a6210(0x88))__ovoOnlineGate(!![]);else throw new Error(_0x2a6210(0x757));}catch(_0x44f69a){throw _0x44f69a;}const DIARY_CSS_TEMPLATE=_0x2a6210(0x267);function getDiaryCssTemplate(){return DIARY_CSS_TEMPLATE;}let diaryStyleInjected=![];function ensureDiaryStyleInjected(){const _0x497b78=_0x2a6210;if(diaryStyleInjected)return;const _0x555173=document[_0x497b78(0x550)](_0x497b78(0x425));if(_0x555173){diaryStyleInjected=!![];return;}const _0x182f59=document[_0x497b78(0x24b)](_0x497b78(0x37e));_0x182f59['id']='diarySharedStyle',_0x182f59[_0x497b78(0x2a1)]=getDiaryCssTemplate(),document[_0x497b78(0x68c)]['appendChild'](_0x182f59),diaryStyleInjected=!![];}const DIARY_COLLAPSE_CHAR_THRESHOLD=0x4b0;function normalizeDiaryContentHtml(_0x18d170){const _0x3bb42c=_0x2a6210,_0x30da61=String(_0x18d170||'')[_0x3bb42c(0x14c)]();return _0x30da61||_0x3bb42c(0x280);}function shouldCollapseDiaryContent(_0x55eddc){const _0x3df169=_0x2a6210;if(!_0x55eddc)return![];const _0x25c3d0=String(_0x55eddc||'')[_0x3df169(0x7a9)](/<[^>]*>/g,'\x20')['replace'](/\s+/g,'\x20')['trim']();return _0x25c3d0[_0x3df169(0x73a)]>=DIARY_COLLAPSE_CHAR_THRESHOLD;}function bindDiaryEntryToggle(_0x26b172){const _0x4b8238=_0x2a6210;if(!_0x26b172)return;const _0x527e90=_0x26b172[_0x4b8238(0x2ba)](_0x4b8238(0x6b3)),_0x5c09d7=_0x26b172['querySelector'](_0x4b8238(0x5ce));if(!_0x527e90||!_0x5c09d7)return;_0x5c09d7[_0x4b8238(0x2f7)](_0x4b8238(0x810),()=>{const _0x43cb80=_0x4b8238,_0x118cac=_0x527e90[_0x43cb80(0x2af)]['toggle'](_0x43cb80(0x732));_0x5c09d7[_0x43cb80(0x2a1)]=_0x118cac?'展开全文':'收起',_0x5c09d7[_0x43cb80(0xf8)](_0x43cb80(0x467),_0x118cac?_0x43cb80(0x79e):'true');});}let currentCharProfileData=null,musicPlayerLyricsInterval=null;async function openCharProfile(){const _0x590cfe=_0x2a6210,_0x189216=document[_0x590cfe(0x550)]('charProfileOverlay'),_0x44cced=document[_0x590cfe(0x550)]('charProfileBackdrop');if(!_0x189216)return;const _0x55e982=await getCurrentChatCharacter();if(!_0x55e982)return;currentCharProfileData=_0x55e982,renderCharProfileData(_0x55e982);const _0xef3d37=_0x55e982['id'],_0x1bed7d=await loadCharacterStatus(_0xef3d37,currentSessionId);updateCharProfileStatusDisplay(_0x1bed7d),_0x189216['classList'][_0x590cfe(0x5e8)](_0x590cfe(0x7fb));if(_0x44cced)_0x44cced[_0x590cfe(0x2af)][_0x590cfe(0x2a8)]('active');_0x189216['classList'][_0x590cfe(0x2a8)](_0x590cfe(0x763)),initMusicPlayerLyrics(),loadAlbumCoversFromDB();}function closeCharProfile(){const _0x3f9707=_0x2a6210,_0x22c359=document['getElementById']('charProfileOverlay'),_0x12c8bc=document[_0x3f9707(0x550)](_0x3f9707(0x689)),_0x452b95=document[_0x3f9707(0x550)](_0x3f9707(0x2f2));_0x22c359&&(_0x22c359[_0x3f9707(0x2af)][_0x3f9707(0x5e8)](_0x3f9707(0x763)),_0x22c359[_0x3f9707(0x2af)]['remove']('show-playlist')),_0x12c8bc&&_0x12c8bc['classList'][_0x3f9707(0x5e8)]('active'),_0x452b95&&_0x452b95['classList'][_0x3f9707(0x5e8)](_0x3f9707(0x763)),musicPlayerLyricsInterval&&(clearInterval(musicPlayerLyricsInterval),musicPlayerLyricsInterval=null),currentCharProfileData=null;}function togglePlaylistView(){const _0x365fd9=_0x2a6210,_0x53ebdc=document[_0x365fd9(0x550)]('charProfileOverlay');_0x53ebdc&&_0x53ebdc[_0x365fd9(0x2af)][_0x365fd9(0x18f)](_0x365fd9(0x7fb));}let userPlaylistPageReady=![],userPlaylistViewEl=null,userPlaylistStreamEl=null,userPlaylistScrollEl=null,userPlaylistHeaderEl=null,userPlaylistCanvas=null,userPlaylistCtx=null,userPlaylistOverlayLayer=null,userPlaylistOverlayContent=null,userPlaylistOverlayCanvas=null,userPlaylistOverlayCtx=null,userPlaylistOverlayCloseTimer=null,userPlaylistViewMounted=![];const USER_PLAYLIST_VIEW_TEMPLATE=_0x2a6210(0x6d7)[_0x2a6210(0x14c)]();function ensureUserPlaylistViewMounted(){const _0x56197b=_0x2a6210;if(userPlaylistViewMounted||document[_0x56197b(0x550)](_0x56197b(0x720)))return userPlaylistViewMounted=!![],!![];const _0x1b16c3=document[_0x56197b(0x550)]('userPlaylistMount');if(!_0x1b16c3)return![];return _0x1b16c3[_0x56197b(0x63f)]=USER_PLAYLIST_VIEW_TEMPLATE,userPlaylistViewMounted=!![],!![];}let playlists=[];const poemLines=['We\x20weave\x20the\x20night\x20with\x20silver\x20threads',_0x2a6210(0x108),_0x2a6210(0xa1),_0x2a6210(0x68e),_0x2a6210(0x611),_0x2a6210(0x250),_0x2a6210(0x363),_0x2a6210(0x75f),_0x2a6210(0x44a),_0x2a6210(0x5de),'...'],poemContent=Array(0x32)[_0x2a6210(0x195)](poemLines[_0x2a6210(0x469)]('\x0a\x0a'))[_0x2a6210(0x469)]('\x0a\x0a'),userPlaylistLyricPool=[_0x2a6210(0x78d),_0x2a6210(0x74d),_0x2a6210(0x5db),_0x2a6210(0x3c3),_0x2a6210(0x28c),_0x2a6210(0x14b),_0x2a6210(0x5b4),'Heartbeat\x20syncs\x20to\x20the\x20kick.',_0x2a6210(0x7e4),'Floating\x20in\x20pink\x20clouds.'];let userPlaylistLyricIndex=0x0,userPlaylistNodeElements=[],userPlaylistWidth=0x0,userPlaylistHeight=0x0,userPlaylistTime=0x0,userPlaylistOverlayAnimationId,userPlaylistActiveMode=null,userPlaylistCurrentIndex=-0x1,userPlaylistAvatarObserver=null,userPlaylistStorageKey='';const USER_PLAYLIST_STORAGE_KEY=_0x2a6210(0x5d3),USER_PLAYLIST_STORAGE_VERSION=0x1,USER_PLAYLIST_DEFAULT_SCOPE='user',USER_PLAYLIST_DEFAULT_SONG_SOURCE=_0x2a6210(0x6f),USER_PLAYLIST_SELECTED_KEY_SUFFIX=_0x2a6210(0x80c),USER_PLAYLIST_DB_PROFILE_FALLBACK=_0x2a6210(0x2a7),USER_PLAYLIST_SELECTED_INDEX_KEY_PREFIX=_0x2a6210(0x3a7);let userPlaylistPlaybackIndex=-0x1,userPlaylistPlaybackSongIndex=0x0,userPlaylistPlaybackAudio=null,userPlaylistPlaybackLyrics=[],userPlaylistPlaybackLyricIndex=0x0,userPlaylistPlaybackSongList=[],userPlaylistPlaybackIsPlaying=![],userPlaylistPlaybackPendingSwitch=![],userPlaylistPlaybackNowPlaying=null,userPlaylistPlaybackForceStop=![],userPlaylistPlayerControlsBound=![],userPlaylistPlaybackRequestToken=0x0,userPlaylistVolume=0.5,userPlaylistVolumeBound=![],musicWidgetReady=![],musicWidgetDragState=null,musicWidgetSuppressClickUntil=0x0,musicWidgetLyricDragState=null,musicWidgetForceHidden=![],musicWidgetLyricStyleActive='',musicWidgetLyricLineIndex=-0x1,musicWidgetLyricLineText='',musicWidgetListMode=_0x2a6210(0x1c8),musicWidgetListPlaylistIndex=-0x1,musicWidgetOrbImage='',musicWidgetOrbSize=0x30,musicWidgetOrbSkinLoaded=![],musicWidgetLyricColor='',musicWidgetLyricColorLoaded=![];const USER_PLAYLIST_AUDIO_CACHE_TTL=0x6*0x3c*0x3c*0x3e8,USER_PLAYLIST_LYRIC_CACHE_TTL=0x1e*0x18*0x3c*0x3c*0x3e8,userPlaylistMediaCache=new Map(),USER_PLAYLIST_AUDIO_BITRATE=0x140,USER_PLAYLIST_VOLUME_KEY=_0x2a6210(0x5cc),MUSIC_WIDGET_LYRIC_COLOR_KEY='musicWidgetLyricColor',MUSIC_WIDGET_ORB_IMAGE_KEY=_0x2a6210(0x203),MUSIC_WIDGET_ORB_SIZE_KEY=_0x2a6210(0x1ab),MUSIC_WIDGET_ORB_POSITION_KEY=_0x2a6210(0x310),MUSIC_WIDGET_LYRIC_POSITION_KEY=_0x2a6210(0x92);function getUserPlaylistMediaCache(_0x3d4818,_0x795578){const _0x34b925=_0x2a6210,_0x301efc=userPlaylistMediaCache[_0x34b925(0x60f)](_0x3d4818);if(!_0x301efc)return null;if(Number[_0x34b925(0x530)](_0x795578)&&_0x795578>0x0&&Date[_0x34b925(0x344)]()-_0x301efc['ts']>_0x795578)return userPlaylistMediaCache[_0x34b925(0xfc)](_0x3d4818),null;return _0x301efc[_0x34b925(0x71b)];}function setUserPlaylistMediaCache(_0xc3e962,_0x4f3e10){const _0x3744d4=_0x2a6210;userPlaylistMediaCache[_0x3744d4(0x806)](_0xc3e962,{'ts':Date[_0x3744d4(0x344)](),'data':_0x4f3e10});}function clearUserPlaylistMediaCache(_0x166d55){const _0x55fdde=_0x2a6210;userPlaylistMediaCache[_0x55fdde(0xfc)](_0x166d55);}async function invalidateUserPlaylistAudioCache(_0x43b533,_0x2baacc){const _0x159517=_0x2a6210,_0x36b0e0=String(_0x43b533||'')[_0x159517(0x14c)](),_0x25fcf2=String(_0x2baacc||'')['trim']();if(!_0x36b0e0||!_0x25fcf2)return![];const _0x110d48=_0x159517(0x3dc)+_0x36b0e0+'|'+_0x25fcf2;clearUserPlaylistMediaCache(_0x110d48);if(!db?.[_0x159517(0x199)])return!![];try{const _0x3b7e76=buildUserPlaylistMediaCacheId(_0x36b0e0,_0x25fcf2);await db['playlistMediaCache'][_0x159517(0x253)](_0x3b7e76,{'audioUrl':'','audioUpdatedAt':null,'updatedAt':Date[_0x159517(0x344)]()});}catch(_0x2f4f96){}return!![];}async function getUserPlaylistMediaCacheRecord(_0x49dc57,_0x564433){const _0x1d845f=_0x2a6210;if(!db?.[_0x1d845f(0x199)])return null;const _0x4d5fdf=buildUserPlaylistMediaCacheId(_0x49dc57,_0x564433);try{return await db[_0x1d845f(0x199)][_0x1d845f(0x60f)](_0x4d5fdf);}catch(_0x20350d){return console[_0x1d845f(0x5d9)](_0x1d845f(0x3c4),_0x20350d),null;}}async function saveUserPlaylistMediaCacheRecord(_0x596fb7){const _0x5992eb=_0x2a6210;if(!db?.[_0x5992eb(0x199)]||!_0x596fb7)return;try{await db[_0x5992eb(0x199)][_0x5992eb(0x748)](_0x596fb7);}catch(_0x44201e){console[_0x5992eb(0x5d9)](_0x5992eb(0x582),_0x44201e);}}async function deleteUserPlaylistMediaCacheRecord(_0x477d1c,_0x324e3c){const _0x295c16=_0x2a6210;if(!db?.[_0x295c16(0x199)])return;const _0x222fde=buildUserPlaylistMediaCacheId(_0x477d1c,_0x324e3c);try{await db[_0x295c16(0x199)][_0x295c16(0xfc)](_0x222fde);}catch(_0x367158){}}async function deleteUserPlaylistMediaCacheByPlaylist(_0x33f7ad){const _0x2dfaa3=_0x2a6210;if(!db?.[_0x2dfaa3(0x199)])return;const _0x137519=String(_0x33f7ad||'')[_0x2dfaa3(0x14c)]();if(!_0x137519)return;try{await db[_0x2dfaa3(0x199)][_0x2dfaa3(0x115)](_0x2dfaa3(0x384))[_0x2dfaa3(0x630)](_0x137519)[_0x2dfaa3(0xfc)]();}catch(_0x5e9a1d){}}async function resolveUserPlaylistProfileContext(){const _0xab70f2=_0x2a6210;let _0x189258=normalizeId(currentChatId||window[_0xab70f2(0x2dd)]||''),_0x207058=currentSessionId||_0xab70f2(0x2a7),_0x231fab='';if(isValidIdValue(_0x189258)){try{const _0x2db2ac=await getActiveSessionIdForChat(_0x189258);if(isValidIdValue(_0x2db2ac))_0x207058=_0x2db2ac;}catch(_0x183652){}try{const _0x4c7927=await db['chatSettings'][_0xab70f2(0x60f)](_0x189258);_0x231fab=resolveUserProfileIdFromChatSettings(_0x4c7927,_0x207058)||'';}catch(_0x20cdb9){_0x231fab='';}if(!isValidIdValue(_0x231fab))try{const _0x22e95a=await db[_0xab70f2(0x37c)][_0xab70f2(0x60f)](_0x189258);isValidIdValue(_0x22e95a?.[_0xab70f2(0x624)])&&(_0x231fab=normalizeId(_0x22e95a['profileId']));}catch(_0x4b440e){}}if(!isValidIdValue(_0x231fab))try{const _0x178d96=await db[_0xab70f2(0xdc)][_0xab70f2(0x60f)]('currentProfileId');isValidIdValue(_0x178d96?.['value'])&&(_0x231fab=normalizeId(_0x178d96[_0xab70f2(0x4cf)]));}catch(_0x46460f){}return{'chatId':_0x189258,'sessionId':_0x207058,'profileId':_0x231fab};}async function resolveUserPlaylistStorageKey(){const _0x394df3=_0x2a6210,{profileId:_0x5a715f,chatId:_0x3855a8}=await resolveUserPlaylistProfileContext(),_0x3029da=isValidIdValue(_0x5a715f)?normalizeId(_0x5a715f):USER_PLAYLIST_DB_PROFILE_FALLBACK,_0x5465f5=normalizeId(_0x3855a8||'');return'db|'+_0x3029da+'|'+(_0x5465f5||_0x394df3(0x28e));}function generateUserPlaylistId(){const _0x322138=_0x2a6210,_0x3dcf28=Math['random']()[_0x322138(0x1ac)](0x24)[_0x322138(0x4c1)](0x2,0x8);return _0x322138(0x2fa)+Date[_0x322138(0x344)]()['toString'](0x24)+'_'+_0x3dcf28;}function buildUserPlaylistPlaybackIndexKey(_0x4df1e8,_0x53ac86){const _0x24ccae=_0x2a6210,_0x5e1604=isValidIdValue(_0x4df1e8)?normalizeId(_0x4df1e8):USER_PLAYLIST_DB_PROFILE_FALLBACK,_0x28f6e3=normalizeId(_0x53ac86||'');return USER_PLAYLIST_SELECTED_INDEX_KEY_PREFIX+'|'+_0x5e1604+'|'+(_0x28f6e3||_0x24ccae(0x28e));}function buildUserPlaylistSongKey(_0x37114b){const _0x216c85=_0x2a6210;if(!_0x37114b)return'';const _0x446f0=String(_0x37114b[_0x216c85(0x15b)]||USER_PLAYLIST_DEFAULT_SONG_SOURCE)[_0x216c85(0x14c)](),_0x6b324b=String(_0x37114b['id']||'')[_0x216c85(0x14c)]();if(_0x6b324b)return _0x446f0+'|'+_0x6b324b;const _0x37738c=String(_0x37114b[_0x216c85(0x189)]||_0x37114b['title']||_0x37114b[_0x216c85(0x352)]||'')['trim'](),_0x302c1e=Array[_0x216c85(0x14f)](_0x37114b[_0x216c85(0x665)])?_0x37114b[_0x216c85(0x665)][_0x216c85(0x469)]('/'):String(_0x37114b[_0x216c85(0x665)]||'')[_0x216c85(0x14c)](),_0x2e9a2f=String(_0x37114b[_0x216c85(0x5b3)]||'')[_0x216c85(0x14c)](),_0x2c2e58=[_0x37738c,_0x302c1e,_0x2e9a2f][_0x216c85(0x34c)](Boolean)[_0x216c85(0x469)]('|');return _0x2c2e58?_0x446f0+'|'+_0x2c2e58:'';}function buildUserPlaylistMediaCacheId(_0x5977a0,_0x2ed8f6){const _0x449b01=_0x2a6210,_0x34b6db=String(_0x5977a0||'')[_0x449b01(0x14c)]()||'unknown',_0x13a561=String(_0x2ed8f6||'')[_0x449b01(0x14c)]()||'unknown';return _0x34b6db+'||'+_0x13a561;}function getUserPlaylistAlign(_0xfde87c){const _0x4f1e54=_0x2a6210,_0x51afcf=_0xfde87c%0x3;if(_0x51afcf===0x0)return _0x4f1e54(0x396);if(_0x51afcf===0x1)return _0x4f1e54(0x131);return'center';}function getNextUserPlaylistLyric(){const _0x24840d=_0x2a6210,_0xfec7ab=userPlaylistLyricPool[userPlaylistLyricIndex%userPlaylistLyricPool[_0x24840d(0x73a)]];return userPlaylistLyricIndex+=0x1,_0xfec7ab;}function normalizeUserPlaylistSong(_0x460d6e){const _0x591e4b=_0x2a6210;if(typeof _0x460d6e==='string'){const _0x4930b5=_0x460d6e[_0x591e4b(0x14c)]();return _0x4930b5?_0x4930b5:null;}if(_0x460d6e&&typeof _0x460d6e===_0x591e4b(0x18e)){const _0x59a81f=String(_0x460d6e[_0x591e4b(0x189)]||_0x460d6e[_0x591e4b(0x1fa)]||_0x460d6e['label']||'')['trim'](),_0x72869=String(_0x460d6e['id']||_0x460d6e['songId']||'')['trim'](),_0xd3b7b3=Array[_0x591e4b(0x14f)](_0x460d6e[_0x591e4b(0x665)])?_0x460d6e[_0x591e4b(0x665)][_0x591e4b(0x444)](_0x49e671=>String(_0x49e671))[_0x591e4b(0x34c)](Boolean):_0x460d6e[_0x591e4b(0x665)]?[String(_0x460d6e[_0x591e4b(0x665)])]:[],_0x158f15=_0x460d6e[_0x591e4b(0x5b3)]?String(_0x460d6e[_0x591e4b(0x5b3)]):'',_0x374372=_0x460d6e[_0x591e4b(0x15b)]?String(_0x460d6e[_0x591e4b(0x15b)]):USER_PLAYLIST_DEFAULT_SONG_SOURCE;if(!_0x59a81f&&!_0x72869)return null;return{'name':_0x59a81f,'id':_0x72869,'artist':_0xd3b7b3,'album':_0x158f15,'source':_0x374372};}return null;}function normalizeUserPlaylistEntry(_0x1e7d64,_0x11f108){const _0x560399=_0x2a6210,_0x1de399=String(_0x1e7d64?.['title']||'')[_0x560399(0x14c)]();if(!_0x1de399)return null;const _0x763372=String(_0x1e7d64?.[_0x560399(0x648)]||'')['trim']()||getNextUserPlaylistLyric(),_0x27be93=_0x1e7d64?.[_0x560399(0x841)]===_0x560399(0x396)||_0x1e7d64?.[_0x560399(0x841)]==='right'||_0x1e7d64?.['align']===_0x560399(0x77a)?_0x1e7d64['align']:getUserPlaylistAlign(_0x11f108),_0x49e84f=Array['isArray'](_0x1e7d64?.[_0x560399(0x1c8)])?_0x1e7d64['songs'][_0x560399(0x444)](_0xfed49a=>normalizeUserPlaylistSong(_0xfed49a))[_0x560399(0x34c)](Boolean):[],_0x101f6a=_0x1e7d64?.[_0x560399(0x5a9)]==='character'||_0x1e7d64?.[_0x560399(0x5a9)]===_0x560399(0x2c6)?_0x1e7d64['origin']:USER_PLAYLIST_DEFAULT_SCOPE,_0x5fd8b7=normalizeId(_0x1e7d64?.['ownerChatId']||_0x1e7d64?.[_0x560399(0x29b)]||_0x1e7d64?.[_0x560399(0xa5)]||''),_0x348019={'id':String(_0x1e7d64?.['id']||'')[_0x560399(0x14c)]()||generateUserPlaylistId(),'title':_0x1de399,'lyric':_0x763372,'align':_0x27be93,'songs':_0x49e84f,'origin':_0x101f6a,'order':Number[_0x560399(0x530)](_0x1e7d64?.[_0x560399(0x559)])?_0x1e7d64['order']:_0x11f108,'createdAt':_0x1e7d64?.['createdAt']||_0x1e7d64?.['updatedAt']||Date['now']()};if(_0x5fd8b7)_0x348019[_0x560399(0x25b)]=_0x5fd8b7;return _0x348019;}function createUserPlaylistEntry(_0x2a5b03){const _0x58db93=_0x2a6210,_0x4c2aed=getNextUserPlaylistLyric();return{'id':generateUserPlaylistId(),'title':_0x2a5b03,'lyric':_0x4c2aed,'align':getUserPlaylistAlign(playlists[_0x58db93(0x73a)]),'songs':[],'origin':USER_PLAYLIST_DEFAULT_SCOPE,'createdAt':Date['now']()};}function createCharacterPlaylistEntry(_0x2f2805,_0x3cd611=''){const _0x515022=_0x2a6210,_0x2e98ed=String(_0x3cd611||'')['trim'](),_0x3c6e69=_0x2e98ed||getNextUserPlaylistLyric(),_0x16c174=normalizeId(currentChatId||window[_0x515022(0x2dd)]||''),_0x178ecf={'id':generateUserPlaylistId(),'title':_0x2f2805,'lyric':_0x3c6e69,'align':getUserPlaylistAlign(playlists['length']),'songs':[],'origin':'character','createdAt':Date[_0x515022(0x344)]()};if(_0x16c174)_0x178ecf[_0x515022(0x25b)]=_0x16c174;return _0x178ecf;}function initUserPlaylistPage(){const _0x5c88d7=_0x2a6210;if(userPlaylistPageReady)return;if(!ensureUserPlaylistViewMounted())return;userPlaylistViewEl=document[_0x5c88d7(0x550)](_0x5c88d7(0x720));if(!userPlaylistViewEl)return;const _0x242dbb=document[_0x5c88d7(0x550)](_0x5c88d7(0x15a));if(_0x242dbb)_0x242dbb['innerText']=poemContent;userPlaylistStreamEl=document[_0x5c88d7(0x550)](_0x5c88d7(0x520)),userPlaylistScrollEl=document[_0x5c88d7(0x550)](_0x5c88d7(0x75e)),userPlaylistHeaderEl=document[_0x5c88d7(0x550)](_0x5c88d7(0x5c6)),userPlaylistCanvas=document[_0x5c88d7(0x550)](_0x5c88d7(0x5e7)),userPlaylistCtx=userPlaylistCanvas?userPlaylistCanvas[_0x5c88d7(0x846)]('2d'):null,userPlaylistOverlayLayer=document[_0x5c88d7(0x550)](_0x5c88d7(0x693)),userPlaylistOverlayContent=document[_0x5c88d7(0x550)](_0x5c88d7(0x3ea)),userPlaylistOverlayCanvas=document[_0x5c88d7(0x550)](_0x5c88d7(0x711)),userPlaylistOverlayCtx=userPlaylistOverlayCanvas?userPlaylistOverlayCanvas['getContext']('2d'):null,syncUserPlaylistAvatar(),observeUserPlaylistAvatar(),observeUserPlaylistViewLifecycle(),bindUserPlaylistPlayerControls(),loadUserPlaylistVolume(),bindUserPlaylistVolumeControl(),void loadUserPlaylistData(),userPlaylistResize(),drawUserPlaylistLines(),window[_0x5c88d7(0x2f7)]('resize',userPlaylistResize),userPlaylistPageReady=!![];}const pendingChatDetailRefreshSet=new Set();let lastChatIdBeforePlaylistView=null,userPlaylistViewObserver=null;function togetherInviteDebugEnabled(){const _0x47223e=_0x2a6210;return!!window[_0x47223e(0x811)];}function togetherInviteDebugLog(..._0x503860){const _0x2c3d06=_0x2a6210;if(!togetherInviteDebugEnabled())return;try{console[_0x2c3d06(0x40b)](_0x2c3d06(0x349),..._0x503860);}catch(_0x4d926e){}}function requestChatDetailRefresh(_0x2ba3af){const _0x4575ba=_0x2a6210,_0x32d273=normalizeId(_0x2ba3af);if(!isValidIdValue(_0x32d273))return;pendingChatDetailRefreshSet['add'](_0x32d273),togetherInviteDebugLog(_0x4575ba(0x7ec),{'chatId':_0x32d273,'pending':Array[_0x4575ba(0x576)](pendingChatDetailRefreshSet)});}function resolveChatIdForChatRefresh(_0x1167b7=''){const _0x24738d=normalizeId(_0x1167b7);if(isValidIdValue(_0x24738d))return _0x24738d;const _0x2d82e6=normalizeId(currentChatId||window['currentChatId']||'');if(isValidIdValue(_0x2d82e6))return _0x2d82e6;const _0x135d8d=normalizeId(lastChatIdBeforePlaylistView||'');if(isValidIdValue(_0x135d8d))return _0x135d8d;return'';}async function flushChatDetailRefreshIfNeeded(_0x4df698='',_0xef7997=''){const _0x4dd15a=_0x2a6210,_0x47d893=resolveChatIdForChatRefresh(_0xef7997);togetherInviteDebugLog('flushChatDetailRefreshIfNeeded:begin',{'reason':_0x4df698,'preferredChatId':_0xef7997,'resolvedChatId':_0x47d893,'currentChatId':currentChatId,'windowChatId':window[_0x4dd15a(0x2dd)],'lastChatIdBeforePlaylistView':lastChatIdBeforePlaylistView,'pending':Array[_0x4dd15a(0x576)](pendingChatDetailRefreshSet)});if(!isValidIdValue(_0x47d893))return![];if(!pendingChatDetailRefreshSet[_0x4dd15a(0x17f)](_0x47d893))return![];pendingChatDetailRefreshSet[_0x4dd15a(0xfc)](_0x47d893);try{if(!isValidIdValue(currentChatId)||!isSameId(normalizeId(currentChatId),_0x47d893)){const _0x42967e=document[_0x4dd15a(0x550)](_0x4dd15a(0xde));_0x42967e&&_0x42967e[_0x4dd15a(0x2af)]['contains'](_0x4dd15a(0x763))&&(currentChatId=_0x47d893,window[_0x4dd15a(0x2dd)]=_0x47d893);}if(typeof reloadCurrentChatMessages===_0x4dd15a(0x88))await reloadCurrentChatMessages();else{if(typeof renderChatMessages===_0x4dd15a(0x88)){const _0x56f765=await db[_0x4dd15a(0x37c)]['get'](_0x47d893);if(_0x56f765)await renderChatMessages(_0x56f765,_0x4dd15a(0x527));}}return togetherInviteDebugLog(_0x4dd15a(0x511),{'chatId':_0x47d893}),!![];}catch(_0x41c71c){return console[_0x4dd15a(0x3bc)](_0x4dd15a(0x85c),_0x4df698||_0x4dd15a(0x5a0),_0x41c71c),togetherInviteDebugLog(_0x4dd15a(0x7a8),{'chatId':_0x47d893,'error':_0x41c71c}),![];}}async function openUserPlaylistView(){const _0x2267a2=_0x2a6210,_0x23c275=normalizeId(currentChatId||window[_0x2267a2(0x2dd)]||'');isValidIdValue(_0x23c275)&&(lastChatIdBeforePlaylistView=_0x23c275);ensureUserPlaylistViewMounted(),initUserPlaylistPage(),await loadUserPlaylistData();const _0x20aea7=userPlaylistViewEl||document[_0x2267a2(0x550)](_0x2267a2(0x720));if(!_0x20aea7)return;if(typeof closeCharProfile===_0x2267a2(0x88))closeCharProfile();syncUserPlaylistAvatar(),_0x20aea7[_0x2267a2(0x2af)][_0x2267a2(0x2a8)]('active'),_0x20aea7[_0x2267a2(0xf8)](_0x2267a2(0x168),_0x2267a2(0x79e)),_0x20aea7[_0x2267a2(0x31d)](_0x2267a2(0x3c1)),userPlaylistResize();}function closeUserPlaylistView(){const _0x15c58c=_0x2a6210,_0x25f3ed=userPlaylistViewEl||document[_0x15c58c(0x550)](_0x15c58c(0x720));if(!_0x25f3ed)return;if(_0x25f3ed[_0x15c58c(0x353)](document[_0x15c58c(0x839)]))try{document['activeElement'][_0x15c58c(0x24c)]();}catch(_0x298f69){}_0x25f3ed['classList']['remove']('active'),_0x25f3ed[_0x15c58c(0xf8)](_0x15c58c(0x168),_0x15c58c(0x4a7)),_0x25f3ed['setAttribute']('inert',''),closeUserPlaylistOverlay(),void flushChatDetailRefreshIfNeeded(_0x15c58c(0x823),lastChatIdBeforePlaylistView||'');}function getUserPlaylistAvatarPlaceholder(){const _0x60f63d=_0x2a6210;return _0x60f63d(0x779);}async function loadUserPlaylistAvatarFromActiveProfile(){const _0x1a23f5=_0x2a6210,_0x1c6396=document['getElementById'](_0x1a23f5(0x82d));if(!_0x1c6396)return;let _0x1e0d08='',_0x140f0b='我';const {profileId:_0x26a2e0}=await resolveUserPlaylistProfileContext();if(isValidIdValue(_0x26a2e0))try{const _0x328278=await db['userProfiles'][_0x1a23f5(0x60f)](_0x26a2e0);_0x1e0d08=_0x328278?.[_0x1a23f5(0x830)]||'',_0x140f0b=_0x328278?.[_0x1a23f5(0x189)]||_0x328278?.[_0x1a23f5(0x77d)]||'我';}catch(_0x37c25a){}_0x1c6396[_0x1a23f5(0x63f)]=_0x1e0d08?_0x1a23f5(0x23a)+_0x1e0d08+_0x1a23f5(0x4ac)+_0x140f0b+'\x22>':getUserPlaylistAvatarPlaceholder();}function syncUserPlaylistAvatar(){void loadUserPlaylistAvatarFromActiveProfile();}function observeUserPlaylistAvatar(){const _0x2c7375=_0x2a6210;if(userPlaylistAvatarObserver)return;const _0x23c8fe=document[_0x2c7375(0x550)](_0x2c7375(0xc8));if(!_0x23c8fe||typeof MutationObserver===_0x2c7375(0x653))return;userPlaylistAvatarObserver=new MutationObserver(()=>{syncUserPlaylistAvatar();}),userPlaylistAvatarObserver[_0x2c7375(0x533)](_0x23c8fe,{'childList':!![],'subtree':!![],'attributes':!![]});}function observeUserPlaylistViewLifecycle(){const _0x369b88=_0x2a6210;if(userPlaylistViewObserver||typeof MutationObserver===_0x369b88(0x653))return;const _0x4a06dc=userPlaylistViewEl||document[_0x369b88(0x550)](_0x369b88(0x720));if(!_0x4a06dc)return;userPlaylistViewObserver=new MutationObserver(()=>{const _0x5c4785=_0x369b88,_0x163a7b=_0x4a06dc[_0x5c4785(0x2af)][_0x5c4785(0x353)](_0x5c4785(0x763));togetherInviteDebugLog(_0x5c4785(0x65c),{'isActive':_0x163a7b,'className':_0x4a06dc[_0x5c4785(0x337)],'ariaHidden':_0x4a06dc['getAttribute'](_0x5c4785(0x168))});if(_0x163a7b){const _0xdb14f3=normalizeId(currentChatId||window[_0x5c4785(0x2dd)]||'');isValidIdValue(_0xdb14f3)&&(lastChatIdBeforePlaylistView=_0xdb14f3,togetherInviteDebugLog(_0x5c4785(0x5f0),{'capturedChatId':_0xdb14f3}));return;}pendingChatDetailRefreshSet[_0x5c4785(0x719)]>0x0&&void flushChatDetailRefreshIfNeeded('user-playlist-mutation',lastChatIdBeforePlaylistView||'');}),userPlaylistViewObserver['observe'](_0x4a06dc,{'attributes':!![],'attributeFilter':[_0x369b88(0x8c),_0x369b88(0x168)]});}function buildUserPlaylistPayload(){const _0x4ae8b3=_0x2a6210,_0x3273cd=Array[_0x4ae8b3(0x14f)](playlists)?playlists[_0x4ae8b3(0x444)](_0x41528c=>({..._0x41528c,'origin':_0x41528c?.[_0x4ae8b3(0x5a9)]===_0x4ae8b3(0x450)||_0x41528c?.[_0x4ae8b3(0x5a9)]==='user'?_0x41528c[_0x4ae8b3(0x5a9)]:USER_PLAYLIST_DEFAULT_SCOPE})):[];return{'version':USER_PLAYLIST_STORAGE_VERSION,'scope':USER_PLAYLIST_DEFAULT_SCOPE,'updatedAt':Date[_0x4ae8b3(0x344)](),'items':_0x3273cd};}async function fetchUserPlaylistItemsFromDb(){const _0x229287=_0x2a6210;if(!db?.[_0x229287(0x667)])return[];const {profileId:_0x4197c3,chatId:_0x43dddf}=await resolveUserPlaylistProfileContext(),_0x2b716c=isValidIdValue(_0x4197c3)?normalizeId(_0x4197c3):USER_PLAYLIST_DB_PROFILE_FALLBACK,_0x44db86=normalizeId(_0x43dddf||'');let _0x374e12=[];try{_0x374e12=await db['userPlaylists']['where'](_0x229287(0x624))[_0x229287(0x630)](_0x2b716c)[_0x229287(0x651)]();}catch(_0x36ebc5){return console[_0x229287(0x5d9)](_0x229287(0x645),_0x36ebc5),[];}const _0x1bfcdd=_0x374e12[_0x229287(0x34c)](_0x2aa7ea=>{const _0x153828=_0x229287,_0x11c3cf=_0x2aa7ea?.[_0x153828(0x535)]===_0x153828(0x450)?'character':'user';if(_0x11c3cf===_0x153828(0x2c6))return!![];if(!_0x44db86)return![];return normalizeId(_0x2aa7ea?.['ownerChatId']||'')===_0x44db86;});_0x1bfcdd['sort']((_0x39afd9,_0x15fc9a)=>{const _0x5d8756=_0x229287,_0x584d64=Number[_0x5d8756(0x530)](_0x39afd9?.['order'])?_0x39afd9[_0x5d8756(0x559)]:Number[_0x5d8756(0x1a4)],_0x30bc8a=Number[_0x5d8756(0x530)](_0x15fc9a?.[_0x5d8756(0x559)])?_0x15fc9a[_0x5d8756(0x559)]:Number[_0x5d8756(0x1a4)];if(_0x584d64!==_0x30bc8a)return _0x584d64-_0x30bc8a;const _0x28d169=new Date(_0x39afd9?.[_0x5d8756(0x208)]||_0x39afd9?.[_0x5d8756(0x334)]||0x0)[_0x5d8756(0x4e0)](),_0x5b05f7=new Date(_0x15fc9a?.[_0x5d8756(0x208)]||_0x15fc9a?.[_0x5d8756(0x334)]||0x0)['getTime']();return _0x28d169-_0x5b05f7;});const _0x40fef8=[];return _0x1bfcdd[_0x229287(0x84c)]((_0x389993,_0x5ae9f4)=>{const _0x5b779a=normalizeUserPlaylistEntry(_0x389993,_0x5ae9f4);if(_0x5b779a)_0x40fef8['push'](_0x5b779a);}),_0x40fef8;}async function getUserPlaylistItemsForPrompt(){const _0x2cef24=_0x2a6210;if(Array[_0x2cef24(0x14f)](playlists)&&playlists[_0x2cef24(0x73a)]>0x0)return playlists[_0x2cef24(0x444)](_0x5a58a2=>({..._0x5a58a2}));return await fetchUserPlaylistItemsFromDb();}async function getUserPlaylistNamesForPrompt(){const _0x71f264=_0x2a6210,_0x5d2b5a=await getUserPlaylistItemsForPrompt(),_0x95fb8a=[];_0x5d2b5a['forEach'](_0xbf433b=>{const _0xc4bcbe=_0x18ea,_0xa06fe5=String(_0xbf433b?.['title']||'')[_0xc4bcbe(0x14c)](),_0x18f59a=_0xbf433b?.[_0xc4bcbe(0x5a9)]==='character'||_0xbf433b?.['origin']===_0xc4bcbe(0x2c6)?_0xbf433b['origin']:USER_PLAYLIST_DEFAULT_SCOPE;if(_0xa06fe5&&_0x18f59a===_0xc4bcbe(0x2c6))_0x95fb8a[_0xc4bcbe(0x2b9)](_0xa06fe5);});const _0x4ebe3f=Array[_0x71f264(0x576)](new Set(_0x95fb8a));return _0x4ebe3f['slice'](0x0,0x3c);}async function getCharacterPlaylistSummariesForPrompt(){const _0x44c68f=_0x2a6210,_0x57b46c=await getUserPlaylistItemsForPrompt(),_0x521aab=[],_0x4b1903=getActiveChatIdForPlaylists();return _0x57b46c[_0x44c68f(0x84c)](_0x162e45=>{const _0x9003be=_0x44c68f,_0x1ec527=String(_0x162e45?.[_0x9003be(0x1fa)]||'')[_0x9003be(0x14c)](),_0x56791b=String(_0x162e45?.['lyric']||'')[_0x9003be(0x14c)](),_0xd8d99a=_0x162e45?.[_0x9003be(0x5a9)]===_0x9003be(0x450)||_0x162e45?.['origin']===_0x9003be(0x2c6)?_0x162e45[_0x9003be(0x5a9)]:USER_PLAYLIST_DEFAULT_SCOPE;if(_0x1ec527&&_0xd8d99a===_0x9003be(0x450)){const _0x3bce46=getPlaylistOwnerChatId(_0x162e45);if(_0x4b1903&&_0x3bce46!==_0x4b1903)return;_0x521aab[_0x9003be(0x2b9)]({'title':_0x1ec527,'note':_0x56791b});}}),_0x521aab[_0x44c68f(0x4c1)](0x0,0x3c);}function getLegacyUserPlaylistKeys(){const _0x362de1=_0x2a6210,_0x33460b=[];try{for(let _0x3b10d8=0x0;_0x3b10d8<localStorage[_0x362de1(0x73a)];_0x3b10d8+=0x1){const _0x171650=localStorage[_0x362de1(0x571)](_0x3b10d8);if(!_0x171650)continue;if(_0x171650===USER_PLAYLIST_STORAGE_KEY)continue;if(_0x171650[_0x362de1(0x78a)](_0x362de1(0x321)))_0x33460b['push'](_0x171650);}}catch(_0x2314ce){}return _0x33460b;}function collectLegacyUserPlaylistItems(){const _0x3d0c9d=getLegacyUserPlaylistKeys();if(_0x3d0c9d['length']===0x0)return[];const _0x31a961=[];return _0x3d0c9d['forEach'](_0x4b469e=>{const _0x211077=_0x18ea;try{const _0xc0ae78=localStorage[_0x211077(0x401)](_0x4b469e);if(!_0xc0ae78)return;const _0xc10525=JSON[_0x211077(0x701)](_0xc0ae78);if(Array[_0x211077(0x14f)](_0xc10525))_0xc10525['forEach'](_0xf6af46=>_0x31a961[_0x211077(0x2b9)](_0xf6af46));else _0xc10525&&typeof _0xc10525===_0x211077(0x18e)&&Array[_0x211077(0x14f)](_0xc10525['items'])&&_0xc10525[_0x211077(0x494)][_0x211077(0x84c)](_0x3d8bac=>_0x31a961[_0x211077(0x2b9)](_0x3d8bac));}catch(_0x271cff){}}),_0x31a961;}async function loadUserPlaylistData(_0x5523e0=![]){const _0xd12518=_0x2a6210;let _0x48b6b2='';try{_0x48b6b2=await resolveUserPlaylistStorageKey();}catch(_0x2055a0){_0x48b6b2='';}if(!_0x48b6b2){playlists=[],initUserPlaylistNodes();return;}if(!_0x5523e0&&_0x48b6b2===userPlaylistStorageKey&&Array[_0xd12518(0x14f)](playlists))return;userPlaylistStorageKey=_0x48b6b2,userPlaylistLyricIndex=0x0;const _0xf5af38=await fetchUserPlaylistItemsFromDb();playlists=Array[_0xd12518(0x14f)](_0xf5af38)?_0xf5af38:[];const _0x11213b=getActiveChatIdForPlaylists();let _0x397aab=![];_0x11213b&&playlists[_0xd12518(0x84c)](_0x8850de=>{const _0x283dcc=_0xd12518;_0x8850de?.[_0x283dcc(0x5a9)]===_0x283dcc(0x450)&&!_0x8850de[_0x283dcc(0x25b)]&&(_0x8850de[_0x283dcc(0x25b)]=_0x11213b,_0x397aab=!![]);});await loadUserPlaylistPlaybackIndex(),initUserPlaylistNodes();if(_0x397aab)saveUserPlaylistData();}function saveUserPlaylistData(){void persistUserPlaylistDataToDb();}async function persistUserPlaylistDataToDb(){const _0x3e7057=_0x2a6210;if(!db?.[_0x3e7057(0x667)])return;const {profileId:_0x5b3183,chatId:_0x3aee16}=await resolveUserPlaylistProfileContext(),_0x434c9c=isValidIdValue(_0x5b3183)?normalizeId(_0x5b3183):USER_PLAYLIST_DB_PROFILE_FALLBACK,_0x2b3f14=normalizeId(_0x3aee16||''),_0x33c7eb=Date[_0x3e7057(0x344)](),_0x309bf6=[];Array[_0x3e7057(0x14f)](playlists)&&playlists[_0x3e7057(0x84c)]((_0x20f70e,_0x185927)=>{const _0x2a284d=_0x3e7057;if(!_0x20f70e)return;const _0x4540c5=_0x20f70e?.[_0x2a284d(0x5a9)]===_0x2a284d(0x450)||_0x20f70e?.['origin']===_0x2a284d(0x2c6)?_0x20f70e[_0x2a284d(0x5a9)]:USER_PLAYLIST_DEFAULT_SCOPE,_0x454cf0=String(_0x20f70e['id']||'')[_0x2a284d(0x14c)]()||generateUserPlaylistId();_0x20f70e['id']=_0x454cf0;const _0x197304=_0x4540c5===_0x2a284d(0x450)?normalizeId(_0x20f70e[_0x2a284d(0x25b)]||_0x2b3f14||''):'';_0x309bf6[_0x2a284d(0x2b9)]({'id':_0x454cf0,'profileId':_0x434c9c,'owner':_0x4540c5,'ownerChatId':_0x197304||null,'title':String(_0x20f70e[_0x2a284d(0x1fa)]||'')[_0x2a284d(0x14c)](),'lyric':String(_0x20f70e[_0x2a284d(0x648)]||'')[_0x2a284d(0x14c)](),'align':_0x20f70e[_0x2a284d(0x841)]||getUserPlaylistAlign(_0x185927),'songs':Array[_0x2a284d(0x14f)](_0x20f70e[_0x2a284d(0x1c8)])?_0x20f70e[_0x2a284d(0x1c8)]:[],'order':_0x185927,'createdAt':_0x20f70e[_0x2a284d(0x208)]||_0x33c7eb,'updatedAt':_0x33c7eb});});try{_0x309bf6[_0x3e7057(0x73a)]>0x0&&await db[_0x3e7057(0x667)]['bulkPut'](_0x309bf6);}catch(_0x35410c){console['error'](_0x3e7057(0x118),_0x35410c);return;}try{const _0x37fd86=await db[_0x3e7057(0x667)]['where'](_0x3e7057(0x624))['equals'](_0x434c9c)[_0x3e7057(0x651)](),_0x3c4094=new Set(_0x309bf6['map'](_0x1935fa=>_0x1935fa['id'])),_0x5881e0=_0x37fd86[_0x3e7057(0x34c)](_0x859ce1=>{const _0x15ba55=_0x3e7057,_0x278653=_0x859ce1?.['owner']===_0x15ba55(0x450)?_0x15ba55(0x450):_0x15ba55(0x2c6);if(_0x278653==='user')return!_0x3c4094[_0x15ba55(0x17f)](_0x859ce1['id']);if(!_0x2b3f14)return![];if(normalizeId(_0x859ce1?.['ownerChatId']||'')!==_0x2b3f14)return![];return!_0x3c4094['has'](_0x859ce1['id']);});_0x5881e0[_0x3e7057(0x73a)]>0x0&&await db['userPlaylists'][_0x3e7057(0x133)](_0x5881e0[_0x3e7057(0x444)](_0x1129e7=>_0x1129e7['id']));}catch(_0x35b63d){console['error']('[UserPlaylist]\x20cleanup\x20db\x20failed:',_0x35b63d);}}async function loadUserPlaylistPlaybackIndex(){const _0x1a55dd=_0x2a6210,{profileId:_0x4d9700,chatId:_0x4fd665}=await resolveUserPlaylistProfileContext(),_0x413676=buildUserPlaylistPlaybackIndexKey(_0x4d9700,_0x4fd665);if(!_0x413676){userPlaylistPlaybackIndex=-0x1;return;}try{const _0x20198e=await db['globalSettings']['get'](_0x413676),_0x17f60d=Number[_0x1a55dd(0x359)](_0x20198e?.[_0x1a55dd(0x4cf)],0xa);if(Number[_0x1a55dd(0x530)](_0x17f60d)&&_0x17f60d>=0x0&&_0x17f60d<playlists[_0x1a55dd(0x73a)]){userPlaylistPlaybackIndex=_0x17f60d;return;}}catch(_0x1bddb7){}userPlaylistPlaybackIndex=-0x1;}function persistUserPlaylistPlaybackIndex(){const _0x5d999d=_0x2a6210;(async()=>{const _0x38f588=_0x18ea,{profileId:_0x223111,chatId:_0x32cb42}=await resolveUserPlaylistProfileContext(),_0x1c3fb3=buildUserPlaylistPlaybackIndexKey(_0x223111,_0x32cb42);if(!_0x1c3fb3)return;userPlaylistPlaybackIndex>=0x0?await db[_0x38f588(0xdc)][_0x38f588(0x748)]({'id':_0x1c3fb3,'value':String(userPlaylistPlaybackIndex)}):await db[_0x38f588(0xdc)][_0x38f588(0xfc)](_0x1c3fb3);})()[_0x5d999d(0x147)](()=>{});}function renderUserPlaylistEmptyHint(){const _0x5d1032=_0x2a6210;if(!userPlaylistStreamEl)return;userPlaylistStreamEl[_0x5d1032(0x2af)]['add']('empty'),userPlaylistStreamEl[_0x5d1032(0x63f)]=_0x5d1032(0x43b),userPlaylistNodeElements=[],userPlaylistStreamEl['style']['height']='100%';}function initUserPlaylistNodes(){const _0x1165a1=_0x2a6210;if(!userPlaylistStreamEl)return;userPlaylistStreamEl[_0x1165a1(0x63f)]='',userPlaylistNodeElements=[];if(!Array[_0x1165a1(0x14f)](playlists)||playlists[_0x1165a1(0x73a)]===0x0){renderUserPlaylistEmptyHint();return;}userPlaylistStreamEl['classList'][_0x1165a1(0x5e8)]('empty');let _0x4c60d3=0x0;const _0x2e85fa=0x8c;playlists[_0x1165a1(0x84c)]((_0x3df553,_0x1123c2)=>{const _0x3d1b41=_0x1165a1,_0x17b6ab=document[_0x3d1b41(0x24b)](_0x3d1b41(0x5ab));_0x17b6ab[_0x3d1b41(0x337)]=_0x3d1b41(0x404);let _0x5b7343;if(_0x3df553[_0x3d1b41(0x841)]===_0x3d1b41(0x396))_0x5b7343=_0x3d1b41(0x166);else{if(_0x3df553[_0x3d1b41(0x841)]==='right')_0x5b7343=_0x3d1b41(0x341);else _0x5b7343='35%';}const _0x16efdd=Math[_0x3d1b41(0x658)]()*0xa-0x5;_0x17b6ab[_0x3d1b41(0x37e)][_0x3d1b41(0x396)]=_0x3d1b41(0xf4)+_0x5b7343+_0x3d1b41(0x64f)+_0x16efdd+'px)',_0x17b6ab['style'][_0x3d1b41(0x154)]=_0x4c60d3+'px',_0x17b6ab['onclick']=()=>openSongManager(_0x1123c2),_0x17b6ab[_0x3d1b41(0x63f)]=_0x3d1b41(0x257)+_0x3df553[_0x3d1b41(0x1fa)]+_0x3d1b41(0x565)+_0x3df553[_0x3d1b41(0x648)]+_0x3d1b41(0x1d4),_0x1123c2===userPlaylistPlaybackIndex&&_0x17b6ab[_0x3d1b41(0x2af)][_0x3d1b41(0x2a8)](_0x3d1b41(0x7ff)),userPlaylistStreamEl['appendChild'](_0x17b6ab),userPlaylistNodeElements[_0x3d1b41(0x2b9)](_0x17b6ab),_0x4c60d3+=_0x2e85fa;}),userPlaylistStreamEl[_0x1165a1(0x37e)][_0x1165a1(0x4e9)]=_0x4c60d3+0xc8+'px';}function userPlaylistResize(){const _0x3ec2e5=_0x2a6210;if(!userPlaylistViewEl||!userPlaylistCanvas||!userPlaylistOverlayCanvas)return;const _0x5ebcea=userPlaylistViewEl[_0x3ec2e5(0x17a)](),_0x2a4c2a=Math['max'](0x1,Math[_0x3ec2e5(0x5b7)](_0x5ebcea[_0x3ec2e5(0x2fc)])),_0xb33890=Math[_0x3ec2e5(0x5b1)](0x1,Math['floor'](_0x5ebcea[_0x3ec2e5(0x4e9)]));userPlaylistWidth=_0x2a4c2a,userPlaylistHeight=_0xb33890,userPlaylistCanvas[_0x3ec2e5(0x2fc)]=_0x2a4c2a,userPlaylistCanvas[_0x3ec2e5(0x4e9)]=_0xb33890,userPlaylistOverlayCanvas['width']=_0x2a4c2a,userPlaylistOverlayCanvas[_0x3ec2e5(0x4e9)]=_0xb33890;}function drawUserPlaylistLines(){const _0x2a5e07=_0x2a6210;if(!userPlaylistCtx||!userPlaylistViewEl||!userPlaylistHeaderEl){requestAnimationFrame(drawUserPlaylistLines);return;}userPlaylistCtx[_0x2a5e07(0x3df)](0x0,0x0,userPlaylistWidth,userPlaylistHeight);const _0x1fa449=document[_0x2a5e07(0x3e4)][_0x2a5e07(0x455)]('data-theme')===_0x2a5e07(0x5f6),_0x515bfc=_0x1fa449?_0x2a5e07(0x324):_0x2a5e07(0x802),_0x45bde2=_0x1fa449?_0x2a5e07(0xfe):'rgba(0,\x200,\x200,\x200.4)',_0x51a7a5=userPlaylistViewEl['getBoundingClientRect'](),_0x52895f=userPlaylistHeaderEl[_0x2a5e07(0x17a)](),_0x379938=_0x52895f['left']-_0x51a7a5[_0x2a5e07(0x396)]+_0x52895f[_0x2a5e07(0x2fc)]/0x2,_0x4fb91a=_0x52895f['top']-_0x51a7a5[_0x2a5e07(0x154)]+_0x52895f[_0x2a5e07(0x4e9)]/0x2,_0x41faa5=_0x51a7a5[_0x2a5e07(0x154)],_0x40f519=_0x51a7a5['top']+userPlaylistHeight,_0x304108=userPlaylistNodeElements[_0x2a5e07(0x444)](_0x11e5a4=>{const _0x3831e7=_0x2a5e07,_0x40c443=_0x11e5a4[_0x3831e7(0x17a)]();return{'x':_0x40c443[_0x3831e7(0x396)]-_0x51a7a5[_0x3831e7(0x396)]+0x5,'y':_0x40c443['top']-_0x51a7a5[_0x3831e7(0x154)]+0x5,'visible':_0x40c443[_0x3831e7(0x154)]<_0x40f519&&_0x40c443[_0x3831e7(0x3e5)]>_0x41faa5};});userPlaylistCtx['lineWidth']=0x1,userPlaylistCtx[_0x2a5e07(0x60a)]=_0x2a5e07(0x272);if(_0x304108[_0x2a5e07(0x73a)]>0x0){const _0x5721f9=_0x304108[0x0];(_0x5721f9[_0x2a5e07(0x323)]||_0x4fb91a>-0x64)&&drawUserPlaylistFluidLine(userPlaylistCtx,_0x379938,_0x4fb91a,_0x5721f9['x'],_0x5721f9['y'],_0x45bde2,userPlaylistTime);}for(let _0x4835c2=0x0;_0x4835c2<_0x304108['length']-0x1;_0x4835c2++){const _0x51d1b6=_0x304108[_0x4835c2],_0x216632=_0x304108[_0x4835c2+0x1];(_0x51d1b6[_0x2a5e07(0x323)]||_0x216632[_0x2a5e07(0x323)])&&drawUserPlaylistFluidLine(userPlaylistCtx,_0x51d1b6['x'],_0x51d1b6['y'],_0x216632['x'],_0x216632['y'],_0x515bfc,userPlaylistTime+_0x4835c2);}for(let _0x2a397f=0x0;_0x2a397f<_0x304108[_0x2a5e07(0x73a)]-0x2;_0x2a397f++){if(_0x2a397f%0x2===0x0){const _0x5e60fc=_0x304108[_0x2a397f],_0x54b4be=_0x304108[_0x2a397f+0x2];(_0x5e60fc[_0x2a5e07(0x323)]||_0x54b4be['visible'])&&(userPlaylistCtx[_0x2a5e07(0x47a)]=_0x515bfc,userPlaylistCtx[_0x2a5e07(0x602)](),userPlaylistCtx['moveTo'](_0x5e60fc['x'],_0x5e60fc['y']),userPlaylistCtx[_0x2a5e07(0x204)](_0x54b4be['x'],_0x54b4be['y']),userPlaylistCtx[_0x2a5e07(0x8e)]());}}userPlaylistTime+=0.05,requestAnimationFrame(drawUserPlaylistLines);}function drawUserPlaylistFluidLine(_0xff3bb2,_0x4e2f46,_0x31a83c,_0x5b1e41,_0x1100ff,_0x269fe3,_0x64122f){const _0x505700=_0x2a6210;_0xff3bb2['strokeStyle']=_0x269fe3,_0xff3bb2[_0x505700(0x602)](),_0xff3bb2[_0x505700(0x14e)](_0x4e2f46,_0x31a83c);const _0x23e89e=(_0x4e2f46+_0x5b1e41)/0x2,_0xefcb18=(_0x4e2f46+_0x5b1e41)/0x2,_0x21da68=0xa,_0xf6db6f=Math[_0x505700(0x2d6)](_0x64122f*0.5)*_0x21da68,_0x5bdced=_0x23e89e+_0xf6db6f,_0x4c042d=(_0x31a83c+_0x1100ff)/0x2;_0xff3bb2[_0x505700(0x69a)](_0x5bdced,_0x4c042d,_0x5b1e41,_0x1100ff),_0xff3bb2[_0x505700(0x8e)]();}function closeUserPlaylistOverlay(){const _0x2e660d=_0x2a6210;if(!userPlaylistOverlayLayer)return;userPlaylistOverlayLayer[_0x2e660d(0x2af)][_0x2e660d(0x5e8)](_0x2e660d(0x763)),userPlaylistActiveMode=null,userPlaylistOverlayCloseTimer&&(clearTimeout(userPlaylistOverlayCloseTimer),userPlaylistOverlayCloseTimer=null),userPlaylistOverlayCloseTimer=setTimeout(()=>{const _0x230390=_0x2e660d;userPlaylistOverlayContent&&userPlaylistOverlayContent[_0x230390(0x2af)][_0x230390(0x5e8)](_0x230390(0x7b4));if(userPlaylistOverlayAnimationId)cancelAnimationFrame(userPlaylistOverlayAnimationId);if(userPlaylistOverlayCtx)userPlaylistOverlayCtx['clearRect'](0x0,0x0,userPlaylistWidth,userPlaylistHeight);userPlaylistOverlayCloseTimer=null;},0x104);}function setUserPlaylistOverlayModeClass(_0x253508){const _0x3bae95=_0x2a6210;if(!userPlaylistOverlayContent)return;userPlaylistOverlayContent[_0x3bae95(0x2af)]['remove'](_0x3bae95(0x7b4)),_0x253508==='together'&&userPlaylistOverlayContent[_0x3bae95(0x2af)]['add']('is-together');}let userPlaylistCategoryNodes=[];function openCategoryManager(){const _0x5f0aaf=_0x2a6210;initUserPlaylistPage();if(!userPlaylistOverlayContent||!userPlaylistOverlayLayer)return;userPlaylistActiveMode=_0x5f0aaf(0x7f4),setUserPlaylistOverlayModeClass(null),userPlaylistOverlayContent[_0x5f0aaf(0x63f)]=_0x5f0aaf(0x466)+(playlists['length']===0x0?_0x5f0aaf(0x795):'')+_0x5f0aaf(0x9f);const _0x20a856=playlists[_0x5f0aaf(0x444)](_0x1af0d8=>_0x1af0d8['title']);userPlaylistCategoryNodes=_0x20a856['map'](_0x1b2215=>({'text':_0x1b2215,'x':Math[_0x5f0aaf(0x658)]()*userPlaylistWidth,'y':Math[_0x5f0aaf(0x658)]()*userPlaylistHeight*0.6+0x64,'vx':(Math[_0x5f0aaf(0x658)]()-0.5)*0.5,'vy':(Math[_0x5f0aaf(0x658)]()-0.5)*0.5})),userPlaylistOverlayLayer[_0x5f0aaf(0x2af)][_0x5f0aaf(0x2a8)](_0x5f0aaf(0x763)),animateUserPlaylistCategoryWeb();}function addCategory(){const _0x19009f=_0x2a6210,_0x24103b=document[_0x19009f(0x550)](_0x19009f(0x7f9)),_0x36d8a3=_0x24103b?_0x24103b[_0x19009f(0x4cf)][_0x19009f(0x14c)]():'';if(_0x36d8a3){playlists[_0x19009f(0x2b9)](createUserPlaylistEntry(_0x36d8a3)),userPlaylistCategoryNodes['push']({'text':_0x36d8a3,'x':userPlaylistWidth/0x2,'y':userPlaylistHeight/0x2,'vx':(Math[_0x19009f(0x658)]()-0.5)*0x2,'vy':(Math[_0x19009f(0x658)]()-0.5)*0x2}),initUserPlaylistNodes();if(userPlaylistOverlayContent){const _0x12b770=userPlaylistOverlayContent[_0x19009f(0x2ba)](_0x19009f(0x471));if(_0x12b770)_0x12b770[_0x19009f(0x5e8)]();}saveUserPlaylistData();if(_0x24103b)_0x24103b['value']='';}}function animateUserPlaylistCategoryWeb(){const _0x401495=_0x2a6210;if(userPlaylistActiveMode!==_0x401495(0x7f4)||!userPlaylistOverlayCtx)return;userPlaylistOverlayCtx[_0x401495(0x3df)](0x0,0x0,userPlaylistWidth,userPlaylistHeight);const _0x5b56c2=document[_0x401495(0x3e4)][_0x401495(0x455)](_0x401495(0x3e6))==='dark',_0x5ade09=_0x5b56c2?'#fff':_0x401495(0x82b),_0x196f64=_0x5b56c2?_0x401495(0x5c8):_0x401495(0x6d1);userPlaylistCategoryNodes['forEach']((_0xd18ee3,_0x298368)=>{const _0x4376f9=_0x401495;_0xd18ee3['x']+=_0xd18ee3['vx'],_0xd18ee3['y']+=_0xd18ee3['vy'];if(_0xd18ee3['x']<0x0||_0xd18ee3['x']>userPlaylistWidth)_0xd18ee3['vx']*=-0x1;if(_0xd18ee3['y']<0x0||_0xd18ee3['y']>userPlaylistHeight)_0xd18ee3['vy']*=-0x1;userPlaylistOverlayCtx[_0x4376f9(0x735)]=_0x5ade09,userPlaylistOverlayCtx[_0x4376f9(0x3bb)]=_0x4376f9(0x332),userPlaylistOverlayCtx[_0x4376f9(0x85)](_0xd18ee3['text'],_0xd18ee3['x'],_0xd18ee3['y']);for(let _0x3455a2=_0x298368+0x1;_0x3455a2<userPlaylistCategoryNodes[_0x4376f9(0x73a)];_0x3455a2++){const _0x2063e6=userPlaylistCategoryNodes[_0x3455a2],_0xaeeed4=Math[_0x4376f9(0x493)](_0xd18ee3['x']-_0x2063e6['x'],_0xd18ee3['y']-_0x2063e6['y']);_0xaeeed4<0xc8&&(userPlaylistOverlayCtx['beginPath'](),userPlaylistOverlayCtx[_0x4376f9(0x47a)]=_0x196f64,userPlaylistOverlayCtx['lineWidth']=0x1-_0xaeeed4/0xc8,userPlaylistOverlayCtx['moveTo'](_0xd18ee3['x'],_0xd18ee3['y']-0x5),userPlaylistOverlayCtx[_0x4376f9(0x204)](_0x2063e6['x'],_0x2063e6['y']-0x5),userPlaylistOverlayCtx[_0x4376f9(0x8e)]());}}),userPlaylistOverlayAnimationId=requestAnimationFrame(animateUserPlaylistCategoryWeb);}function openSongManager(_0x258be5){const _0x18fe1a=_0x2a6210;initUserPlaylistPage();if(!userPlaylistOverlayContent||!userPlaylistOverlayLayer)return;userPlaylistActiveMode=_0x18fe1a(0x7bc),setUserPlaylistOverlayModeClass(null),userPlaylistCurrentIndex=_0x258be5;const _0x5bbe78=playlists[_0x258be5];userPlaylistOverlayContent[_0x18fe1a(0x63f)]=_0x18fe1a(0x184)+_0x5bbe78['title']+_0x18fe1a(0x2ff)+_0x5bbe78[_0x18fe1a(0x648)]+'\x22</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-list-container\x22\x20id=\x22songListContainer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22spine-line\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20歌曲列表将在这里生成\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22newSongInput\x22\x20class=\x22ghost-input\x22\x20placeholder=\x22Add\x20a\x20song...\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-search-panel\x22\x20id=\x22songSearchPanel\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-search-stars\x22\x20aria-hidden=\x22true\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span></span><span></span><span></span><span></span><span></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-search-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-search-title-text\x22>SEARCH\x20RESULTS</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-search-sub\x22>Tap\x20to\x20add\x20to\x20playlist</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-search-list\x22\x20id=\x22songSearchList\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20搜索结果将通过\x20JS\x20动态生成\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-search-foot\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-search-foot-line\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22song-search-foot-text\x22>Source:\x20netease</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22action-btn-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22circle-btn\x22\x20onclick=\x22selectPlaylistForPlayback()\x22\x20title=\x22Select\x20playlist\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x221.6\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x226\x22></circle>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x222.2\x22\x20fill=\x22currentColor\x22\x20stroke=\x22none\x22></circle>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22circle-btn\x22\x20onclick=\x22deletePlaylist()\x22\x20title=\x22Delete\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x221.6\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M4\x207h16\x22\x20stroke-linecap=\x22round\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M9\x207V5a1\x201\x200\x200\x201\x201-1h4a1\x201\x200\x200\x201\x201\x201v2\x22\x20stroke-linecap=\x22round\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M7\x207l1\x2013a2\x202\x200\x200\x200\x202\x202h4a2\x202\x200\x200\x200\x202-2l1-13\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M10\x2011v6M14\x2011v6\x22\x20stroke-linecap=\x22round\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22circle-btn\x22\x20onclick=\x22closeUserPlaylistOverlay()\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20',renderSongs(_0x5bbe78[_0x18fe1a(0x1c8)]),initSongSearchUI(),userPlaylistOverlayLayer[_0x18fe1a(0x2af)][_0x18fe1a(0x2a8)](_0x18fe1a(0x763)),animateUserPlaylistRain();}async function openTogetherInviteUI(){const _0x277b74=_0x2a6210;initUserPlaylistPage();if(!userPlaylistOverlayContent||!userPlaylistOverlayLayer)return;userPlaylistActiveMode='together',setUserPlaylistOverlayModeClass('together'),userPlaylistOverlayContent[_0x277b74(0x63f)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22together-panel\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22together-stars\x22\x20aria-hidden=\x22true\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span></span><span></span><span></span><span></span><span></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22together-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22together-title\x22>TOGETHER</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22together-subtitle\x22>Invite\x20a\x20character\x20to\x20listen</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22together-thread\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22together-thread-line\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22together-list\x22\x20id=\x22togetherInviteList\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22together-foot\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22together-foot-line\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22together-foot-text\x22>Select\x20a\x20character</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22action-btn-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22circle-btn\x22\x20onclick=\x22closeUserPlaylistOverlay()\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20',userPlaylistOverlayLayer[_0x277b74(0x2af)][_0x277b74(0x2a8)](_0x277b74(0x763));userPlaylistOverlayCtx&&userPlaylistOverlayCtx[_0x277b74(0x3df)](0x0,0x0,userPlaylistWidth,userPlaylistHeight);const _0x35aa7a=document['getElementById'](_0x277b74(0x4b3));if(_0x35aa7a){const _0x1951dc=document[_0x277b74(0x24b)](_0x277b74(0x5ab));_0x1951dc[_0x277b74(0x337)]=_0x277b74(0x713),_0x1951dc[_0x277b74(0x2a1)]='Loading...',_0x35aa7a[_0x277b74(0x744)](_0x1951dc);}const _0x392090=async()=>{const _0x3f341f=_0x277b74;if(userPlaylistActiveMode!==_0x3f341f(0x671))return;try{const _0x161698=await db[_0x3f341f(0x37c)]['toArray'](),_0x425ef2=getUserCreatedCharactersFromChats(_0x161698);renderTogetherInviteList(_0x425ef2);}catch(_0x2d2729){console[_0x3f341f(0x5d9)](_0x3f341f(0x775),_0x2d2729),renderTogetherInviteList([]);}};requestAnimationFrame(()=>requestAnimationFrame(_0x392090));}function renderTogetherInviteList(_0x2f2eb2){const _0x5ad265=_0x2a6210,_0x448476=document['getElementById'](_0x5ad265(0x4b3));if(!_0x448476)return;_0x448476['innerHTML']='';if(!Array['isArray'](_0x2f2eb2)||_0x2f2eb2[_0x5ad265(0x73a)]===0x0){const _0x33ea97=document[_0x5ad265(0x24b)](_0x5ad265(0x5ab));_0x33ea97[_0x5ad265(0x337)]='together-empty',_0x33ea97[_0x5ad265(0x2a1)]=_0x5ad265(0x5af),_0x448476['appendChild'](_0x33ea97);return;}const _0x4d1afa=_0x1b9bd9=>{const _0x458f92=_0x5ad265,_0x5817f0=typeof _0x1b9bd9===_0x458f92(0x6b0)?_0x1b9bd9['trim']():'';if(!_0x5817f0)return'';const _0x37f5bb=_0x5817f0[_0x458f92(0x5bd)]();if(_0x37f5bb[_0x458f92(0x78a)](_0x458f92(0x669)))return'';if(_0x37f5bb[_0x458f92(0x78a)]('data:')&&!_0x37f5bb['startsWith'](_0x458f92(0x1c4)))return'';return _0x5817f0;},_0xc8ff3=document['createDocumentFragment']();_0x2f2eb2[_0x5ad265(0x84c)](_0x47cd79=>{const _0x5d663b=_0x5ad265,_0x57e30a=document[_0x5d663b(0x24b)]('button');_0x57e30a[_0x5d663b(0x1e9)]=_0x5d663b(0x6fc),_0x57e30a[_0x5d663b(0x337)]=_0x5d663b(0x3bf);const _0x37ff39=document['createElement'](_0x5d663b(0x5ab));_0x37ff39['className']=_0x5d663b(0x856);const _0x1784d7=_0x4d1afa(_0x47cd79?.['settings']?.[_0x5d663b(0x657)]);if(_0x1784d7){const _0x2ae397=document[_0x5d663b(0x24b)](_0x5d663b(0x210));_0x2ae397[_0x5d663b(0x655)]=_0x1784d7,_0x2ae397['alt']=_0x47cd79?.['name']||'角色',_0x37ff39[_0x5d663b(0x744)](_0x2ae397);}else _0x37ff39[_0x5d663b(0x63f)]=_0x5d663b(0x3ff);const _0x4dd151=document[_0x5d663b(0x24b)]('div');_0x4dd151[_0x5d663b(0x337)]=_0x5d663b(0xac);const _0x55c232=document[_0x5d663b(0x24b)](_0x5d663b(0x5ab));_0x55c232['className']=_0x5d663b(0x74a),_0x55c232['textContent']=_0x47cd79?.[_0x5d663b(0x189)]||'未命名角色';const _0x3b00e1=document[_0x5d663b(0x24b)]('div');_0x3b00e1[_0x5d663b(0x337)]=_0x5d663b(0x266);const _0x7d45b6=typeof _0x47cd79?.[_0x5d663b(0x239)]===_0x5d663b(0x6b0)?_0x47cd79['profession'][_0x5d663b(0x14c)]():'';_0x3b00e1[_0x5d663b(0x2a1)]=_0x7d45b6||_0x5d663b(0x200),_0x4dd151['appendChild'](_0x55c232),_0x4dd151[_0x5d663b(0x744)](_0x3b00e1);const _0x139102=document[_0x5d663b(0x24b)]('div');_0x139102[_0x5d663b(0x337)]=_0x5d663b(0x130),_0x139102[_0x5d663b(0x2a1)]=_0x5d663b(0x2e4),_0x57e30a[_0x5d663b(0x744)](_0x37ff39),_0x57e30a[_0x5d663b(0x744)](_0x4dd151),_0x57e30a[_0x5d663b(0x744)](_0x139102),_0x57e30a[_0x5d663b(0x2f7)](_0x5d663b(0x810),()=>{sendTogetherInviteToChat(_0x47cd79);}),_0xc8ff3[_0x5d663b(0x744)](_0x57e30a);}),_0x448476[_0x5ad265(0x744)](_0xc8ff3);}const TOGETHER_INVITE_DEFAULT_TITLE=_0x2a6210(0x564),TOGETHER_INVITE_DEFAULT_ARTIST=_0x2a6210(0x7b9),TOGETHER_INVITE_EXPIRE_MS=0x1e*0x3c*0x3e8,togetherInviteExpiryTimers=new Map();function resolveTogetherInviteSongMeta(){const _0x26aa49=_0x2a6210;let _0x46f4dc=TOGETHER_INVITE_DEFAULT_TITLE,_0x262fcf=TOGETHER_INVITE_DEFAULT_ARTIST,_0x322c5a='',_0x586afe=null;const _0x3765da=[],_0x13c057=_0x233302=>{const _0x5844da=_0x18ea;if(!Number[_0x5844da(0x530)](_0x233302)||_0x233302<0x0||_0x233302>=playlists[_0x5844da(0x73a)])return;if(!_0x3765da[_0x5844da(0x3a6)](_0x233302))_0x3765da[_0x5844da(0x2b9)](_0x233302);};_0x13c057(userPlaylistPlaybackIndex),_0x13c057(userPlaylistCurrentIndex);for(let _0x4910d3=0x0;_0x4910d3<playlists['length'];_0x4910d3++)_0x13c057(_0x4910d3);for(const _0x1b5764 of _0x3765da){const _0x48f3f2=playlists[_0x1b5764];if(!_0x48f3f2)continue;if(!_0x586afe)_0x586afe=_0x48f3f2;if(Array[_0x26aa49(0x14f)](_0x48f3f2[_0x26aa49(0x1c8)])&&_0x48f3f2['songs'][_0x26aa49(0x73a)]>0x0){_0x586afe=_0x48f3f2;break;}}if(_0x586afe){_0x322c5a=String(_0x586afe[_0x26aa49(0x1fa)]||'')['trim']();const _0x27936e=Array[_0x26aa49(0x14f)](_0x586afe[_0x26aa49(0x1c8)])?_0x586afe[_0x26aa49(0x1c8)][_0x26aa49(0x6bf)](Boolean):null;if(_0x27936e){if(typeof _0x27936e==='string'){const _0x31ae35=_0x27936e[_0x26aa49(0x14c)]();if(_0x31ae35)_0x46f4dc=_0x31ae35;}else{if(typeof _0x27936e===_0x26aa49(0x18e)){const _0x9a40be=String(_0x27936e[_0x26aa49(0x189)]||_0x27936e[_0x26aa49(0x1fa)]||_0x27936e[_0x26aa49(0x352)]||'')[_0x26aa49(0x14c)]();if(_0x9a40be)_0x46f4dc=_0x9a40be;const _0x23447c=Array[_0x26aa49(0x14f)](_0x27936e[_0x26aa49(0x665)])?_0x27936e[_0x26aa49(0x665)]:_0x27936e[_0x26aa49(0x665)]?[_0x27936e['artist']]:[],_0x45e045=_0x23447c[_0x26aa49(0x444)](_0x4a9411=>String(_0x4a9411)[_0x26aa49(0x14c)]())[_0x26aa49(0x34c)](Boolean)[_0x26aa49(0x469)](_0x26aa49(0x6e2));if(_0x45e045)_0x262fcf=_0x45e045;}}}}return{'songTitle':_0x46f4dc,'songArtist':_0x262fcf,'playlistTitle':_0x322c5a};}function resolveTogetherInviteCreatedAt(_0x542b6e,_0x2f9b0f){const _0x2a7f54=_0x2a6210,_0x58eb29=Number(_0x542b6e?.[_0x2a7f54(0x208)]||0x0);if(Number[_0x2a7f54(0x530)](_0x58eb29)&&_0x58eb29>0x0)return _0x58eb29;const _0x52f879=_0x2f9b0f?.[_0x2a7f54(0x5c9)];if(Number['isFinite'](_0x52f879)&&_0x52f879>0x0)return _0x52f879;if(typeof _0x52f879===_0x2a7f54(0x6b0)){const _0x183aed=Date[_0x2a7f54(0x701)](_0x52f879);if(Number[_0x2a7f54(0x530)](_0x183aed))return _0x183aed;}return 0x0;}function isTogetherInviteExpired(_0x51bf7c,_0x1b32ab){const _0xbe81e6=_0x2a6210,_0x2653c2=resolveTogetherInviteCreatedAt(_0x51bf7c,_0x1b32ab);if(!_0x2653c2)return![];return Date[_0xbe81e6(0x344)]()-_0x2653c2>=TOGETHER_INVITE_EXPIRE_MS;}async function updateTogetherInviteMessage(_0x410b55,_0x4a41d7,_0x4ad0f1){const _0x1c4b3b=_0x2a6210;if(!_0x410b55||!_0x4a41d7||!_0x4ad0f1)return![];const _0x428663=String(_0x4ad0f1['id']||_0x4a41d7?.[_0x1c4b3b(0x3ed)]||'')[_0x1c4b3b(0x14c)]();if(!_0x428663)return![];_0x4a41d7[_0x1c4b3b(0x73c)]='',_0x4a41d7[_0x1c4b3b(0x74f)]=_0x4ad0f1['status'],_0x4a41d7['togetherInviteTitle']=_0x4ad0f1[_0x1c4b3b(0x97)]||TOGETHER_INVITE_DEFAULT_TITLE,_0x4a41d7[_0x1c4b3b(0x6f2)]=_0x4ad0f1[_0x1c4b3b(0x12a)]||TOGETHER_INVITE_DEFAULT_ARTIST,_0x4a41d7['togetherInvitePlaylistTitle']=_0x4ad0f1[_0x1c4b3b(0xcb)]||'',_0x4a41d7[_0x1c4b3b(0x1e4)]=_0x4ad0f1;const _0x526ae1=db?.[_0x1c4b3b(0x3d8)]&&typeof db[_0x1c4b3b(0x3d8)][_0x1c4b3b(0x253)]===_0x1c4b3b(0x88);if(_0x526ae1&&_0x4a41d7['_dbMessageId'])try{await db[_0x1c4b3b(0x3d8)][_0x1c4b3b(0x253)](_0x4a41d7[_0x1c4b3b(0x625)],{'content':'','togetherInviteStatus':_0x4a41d7[_0x1c4b3b(0x74f)],'togetherInviteTitle':_0x4a41d7[_0x1c4b3b(0x613)],'togetherInviteArtist':_0x4a41d7['togetherInviteArtist'],'togetherInvitePlaylistTitle':_0x4a41d7[_0x1c4b3b(0x32d)],'_togetherInvite':_0x4ad0f1});}catch(_0x2a5747){}else{if(db?.['chatMessages']?.[_0x1c4b3b(0x115)]&&_0x428663)try{await db[_0x1c4b3b(0x3d8)][_0x1c4b3b(0x115)]('togetherInviteId')['equals'](_0x428663)['modify']({'content':'','togetherInviteStatus':_0x4a41d7[_0x1c4b3b(0x74f)],'togetherInviteTitle':_0x4a41d7[_0x1c4b3b(0x613)],'togetherInviteArtist':_0x4a41d7[_0x1c4b3b(0x6f2)],'togetherInvitePlaylistTitle':_0x4a41d7[_0x1c4b3b(0x32d)],'_togetherInvite':_0x4ad0f1});}catch(_0x2c6192){}}return!![];}async function expireTogetherInviteById(_0x275476,_0x3e8fdf){const _0x263828=_0x2a6210,_0x32f6cd=normalizeId(_0x275476||'');if(!_0x32f6cd||!_0x3e8fdf||!db?.['chats'])return![];let _0x1bfde9=null;try{_0x1bfde9=await db[_0x263828(0x37c)][_0x263828(0x60f)](_0x32f6cd);}catch(_0x30a54f){_0x1bfde9=null;}if(!_0x1bfde9||!Array[_0x263828(0x14f)](_0x1bfde9[_0x263828(0x1a8)]))return![];const _0x972d01=_0x1bfde9[_0x263828(0x1a8)]['find'](_0x3d6616=>{const _0x1baaae=_0x263828;if(!_0x3d6616)return![];const _0x6633b6=_0x3d6616['_togetherInvite']||null,_0x256278=String(_0x6633b6?.['id']||_0x3d6616['togetherInviteId']||'')[_0x1baaae(0x14c)]();if(_0x256278!==_0x3e8fdf)return![];const _0x49823f=String(_0x3d6616[_0x1baaae(0x74f)]||_0x6633b6?.[_0x1baaae(0x464)]||'')[_0x1baaae(0x14c)]()[_0x1baaae(0x5bd)]();return!_0x49823f||_0x49823f===_0x1baaae(0x1ca);});if(!_0x972d01)return![];const _0xb606dd=_0x972d01[_0x263828(0x1e4)]||{},_0x2bfb74={..._0xb606dd,'id':_0x3e8fdf,'status':_0x263828(0x672)};return await updateTogetherInviteMessage(_0x1bfde9,_0x972d01,_0x2bfb74),isChatDetailActiveForChat(_0x1bfde9['id'])&&await renderChatMessages(_0x1bfde9),!![];}function scheduleTogetherInviteExpiry(_0x1ca454,_0x4f483e,_0x3511dd){const _0x23df90=_0x2a6210;if(!_0x4f483e||!_0x3511dd)return;const _0x373b66=TOGETHER_INVITE_EXPIRE_MS-(Date[_0x23df90(0x344)]()-_0x3511dd);if(_0x373b66<=0x0){expireTogetherInviteById(_0x1ca454,_0x4f483e);return;}if(togetherInviteExpiryTimers[_0x23df90(0x17f)](_0x4f483e))return;const _0x1f6f28=setTimeout(()=>{const _0x27497d=_0x23df90;togetherInviteExpiryTimers[_0x27497d(0xfc)](_0x4f483e),expireTogetherInviteById(_0x1ca454,_0x4f483e);},_0x373b66);togetherInviteExpiryTimers[_0x23df90(0x806)](_0x4f483e,_0x1f6f28);}async function syncTogetherInviteExpiryForChat(_0x3589d5){const _0x445ff3=_0x2a6210;if(!_0x3589d5||!Array[_0x445ff3(0x14f)](_0x3589d5[_0x445ff3(0x1a8)]))return![];let _0x54b0d3=![];for(const _0x4623a9 of _0x3589d5[_0x445ff3(0x1a8)]){if(!_0x4623a9||_0x4623a9[_0x445ff3(0x1e9)]!=='together-card')continue;const _0x1fd3cf=_0x4623a9['_togetherInvite']||{},_0xada969=String(_0x4623a9[_0x445ff3(0x74f)]||_0x1fd3cf[_0x445ff3(0x464)]||'')[_0x445ff3(0x14c)]()['toLowerCase']()||_0x445ff3(0x1ca);if(_0xada969!==_0x445ff3(0x1ca))continue;const _0x5463df=String(_0x1fd3cf['id']||_0x4623a9['togetherInviteId']||'')['trim'](),_0x2a0607=resolveTogetherInviteCreatedAt(_0x1fd3cf,_0x4623a9);_0x5463df&&_0x2a0607&&scheduleTogetherInviteExpiry(_0x3589d5['id'],_0x5463df,_0x2a0607);if(!isTogetherInviteExpired(_0x1fd3cf,_0x4623a9))continue;if(!_0x5463df)continue;const _0x284ea1={..._0x1fd3cf,'id':_0x5463df,'status':_0x445ff3(0x672)};await updateTogetherInviteMessage(_0x3589d5,_0x4623a9,_0x284ea1),_0x54b0d3=!![];}return _0x54b0d3;}function buildTogetherInviteCardHtml(_0x113d45,_0xbaa653={}){const _0x23a76e=_0x2a6210,{status:status=_0x23a76e(0x1ca),inviteId:inviteId='',pendingText:pendingText=''}=_0xbaa653,_0x2d6d28=escapeHtml(String(_0x113d45?.['songTitle']||TOGETHER_INVITE_DEFAULT_TITLE)),_0x201b66=escapeHtml(String(_0x113d45?.[_0x23a76e(0x12a)]||TOGETHER_INVITE_DEFAULT_ARTIST)),_0x1d8961=escapeHtml(String(inviteId||'')),_0x3c5676=status===_0x23a76e(0x418)||status===_0x23a76e(0x672)||status===_0x23a76e(0x42b)?status:_0x23a76e(0x1ca),_0x521f1b=_0x3c5676===_0x23a76e(0x418)?_0x23a76e(0x4b2):_0x3c5676===_0x23a76e(0x672)?_0x23a76e(0x805):_0x3c5676===_0x23a76e(0x42b)?_0x23a76e(0x783):pendingText||_0x23a76e(0x397),_0x238191=_0x3c5676===_0x23a76e(0x418)?_0x23a76e(0x7f2):'∞';if(_0x3c5676===_0x23a76e(0x418))return _0x23a76e(0xa6)+_0x2d6d28+_0x23a76e(0x723)+_0x201b66+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22connection-line\x22></div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22synced-visual\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22\x20style=\x22animation-duration:\x200.8s\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22\x20style=\x22animation-duration:\x201.2s\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22\x20style=\x22animation-duration:\x200.5s\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22\x20style=\x22animation-duration:\x200.9s\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22wave-bar\x22\x20style=\x22animation-duration:\x201.1s\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card-status\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+_0x521f1b+_0x23a76e(0x5be)+_0x238191+_0x23a76e(0x149);return _0x23a76e(0x3f4)+_0x2d6d28+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+_0x201b66+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22center-visual\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22ripple\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22ripple\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22radar-star\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card-status\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+_0x521f1b+_0x23a76e(0x311)+_0x238191+_0x23a76e(0x197);}function resolveTogetherRequestTarget(_0x5ade22={}){const _0x2e5f9b=_0x2a6210,_0x290a72=normalizeTogetherPlaylistOwner(_0x5ade22[_0x2e5f9b(0x535)]),_0x5b9d33=resolveTogetherPlaylistTargetIndex({'owner':_0x290a72,'playlist':_0x5ade22[_0x2e5f9b(0x4e1)],'index':_0x5ade22['index']});if(_0x5b9d33<0x0||!Array['isArray'](playlists)||_0x5b9d33>=playlists[_0x2e5f9b(0x73a)])return null;return{'owner':_0x290a72,'index':_0x5b9d33,'playlist':playlists[_0x5b9d33]};}function pickRandomPlayableSongIndex(_0x5b4a71){const _0x25f792=_0x2a6210,_0x38dd1f=Array[_0x25f792(0x14f)](_0x5b4a71?.['songs'])?_0x5b4a71[_0x25f792(0x1c8)]:[],_0x1bd743=[];_0x38dd1f['forEach']((_0x49cfb9,_0xee6ae7)=>{const _0x5526a0=_0x25f792,_0x2ab344=normalizeUserPlaylistPlaybackSong(_0x49cfb9);_0x2ab344&&_0x2ab344['id']&&_0x1bd743[_0x5526a0(0x2b9)]({'idx':_0xee6ae7,'song':_0x2ab344});});if(_0x1bd743[_0x25f792(0x73a)]===0x0)return{'index':-0x1,'song':null};const _0x41639d=_0x1bd743[Math['floor'](Math[_0x25f792(0x658)]()*_0x1bd743[_0x25f792(0x73a)])];return{'index':_0x41639d[_0x25f792(0x7e5)],'song':_0x41639d['song']};}function resolveTogetherSongMetaFromPlaylist(_0x1203ab,_0x3d3b38){const _0x3e2ff3=_0x2a6210,_0x523fa8=String(_0x1203ab?.[_0x3e2ff3(0x1fa)]||'')[_0x3e2ff3(0x14c)]();let _0x350cf6=TOGETHER_INVITE_DEFAULT_TITLE,_0x45f357=TOGETHER_INVITE_DEFAULT_ARTIST;if(_0x3d3b38){const _0x4e7b78=String(_0x3d3b38[_0x3e2ff3(0x189)]||_0x3d3b38[_0x3e2ff3(0x1fa)]||_0x3d3b38[_0x3e2ff3(0x352)]||'')[_0x3e2ff3(0x14c)]();if(_0x4e7b78)_0x350cf6=_0x4e7b78;const _0x17053a=buildSongArtistText(_0x3d3b38);if(_0x17053a)_0x45f357=_0x17053a;}return{'songTitle':_0x350cf6,'songArtist':_0x45f357,'playlistTitle':_0x523fa8};}async function sendTogetherRequestToChat(_0x51d488,_0x32625c={},_0x30816f={}){const _0x59ed37=_0x2a6210;if(!_0x51d488||!db?.[_0x59ed37(0x37c)]||!db?.[_0x59ed37(0x3d8)])return![];try{await loadUserPlaylistData();}catch(_0x2411fa){}const _0x26dcef=resolveTogetherRequestTarget(_0x32625c);if(!_0x26dcef)return showIslandNotification('一起听',_0x59ed37(0x15c),_0x59ed37(0x4fd)),![];const {index:_0x20362b,playlist:_0x2c9874,owner:_0x2f12b6}=_0x26dcef,_0x52870a=pickRandomPlayableSongIndex(_0x2c9874),_0x5ac257=resolveTogetherSongMetaFromPlaylist(_0x2c9874,_0x52870a[_0x59ed37(0x7bc)]),_0x5dd38c=_0x59ed37(0x11b)+Date[_0x59ed37(0x344)]()+'_'+Math['random']()['toString'](0x24)[_0x59ed37(0x4c1)](0x2,0x8),_0x2cd930=Date[_0x59ed37(0x344)](),_0x4f2af3=String(_0x30816f[_0x59ed37(0x1db)]||'')['trim']()||(_0x51d488?.[_0x59ed37(0x189)]||'角色'),_0x2bf21c=String(_0x30816f[_0x59ed37(0x2f6)]||'')[_0x59ed37(0x14c)]()||'用户',_0x3574c8={'id':_0x5dd38c,'status':_0x59ed37(0x1ca),'songTitle':_0x5ac257['songTitle'],'songArtist':_0x5ac257['songArtist'],'playlistTitle':_0x5ac257[_0x59ed37(0xcb)]||'','createdAt':_0x2cd930,'initiatorRole':_0x59ed37(0x450),'initiatorName':_0x4f2af3,'initiatorId':String(_0x51d488['id']||'')[_0x59ed37(0x14c)](),'inviteeRole':_0x59ed37(0x2c6),'inviteeName':_0x2bf21c,'playlistOwner':_0x2f12b6||_0x59ed37(0x450),'playlistIndex':_0x20362b};_0x51d488[_0x59ed37(0x1a8)]=Array['isArray'](_0x51d488[_0x59ed37(0x1a8)])?_0x51d488[_0x59ed37(0x1a8)]:[];const _0x1ca2e0={'role':_0x59ed37(0x1bd),'type':'together-card','content':'','timestamp':_0x2cd930,'read':![],'togetherInviteId':_0x5dd38c,'togetherInviteStatus':_0x59ed37(0x1ca),'togetherInviteTitle':_0x5ac257[_0x59ed37(0x97)],'togetherInviteArtist':_0x5ac257['songArtist'],'togetherInvitePlaylistTitle':_0x5ac257[_0x59ed37(0xcb)]||'','_togetherInvite':_0x3574c8};_0x51d488[_0x59ed37(0x1a8)][_0x59ed37(0x2b9)](_0x1ca2e0);const _0x3c88ce=await db[_0x59ed37(0x3d8)][_0x59ed37(0x2a8)]({'characterId':normalizeId(_0x51d488['id']||''),'sessionId':await getActiveSessionIdForChat(_0x51d488['id'])||_0x59ed37(0x2a7),'role':_0x59ed37(0x1bd),'type':_0x59ed37(0x5f9),'content':'','timestamp':new Date(_0x2cd930)[_0x59ed37(0x442)](),'togetherInviteId':_0x5dd38c,'togetherInviteStatus':_0x59ed37(0x1ca),'togetherInviteTitle':_0x5ac257[_0x59ed37(0x97)],'togetherInviteArtist':_0x5ac257['songArtist'],'togetherInvitePlaylistTitle':_0x5ac257[_0x59ed37(0xcb)]||'','_togetherInvite':_0x3574c8});return _0x1ca2e0[_0x59ed37(0x625)]=_0x3c88ce,_0x51d488[_0x59ed37(0x51f)]=_0x59ed37(0x6ba),_0x51d488[_0x59ed37(0x78)]=_0x2cd930,await db[_0x59ed37(0x37c)]['put'](_0x51d488),updateChatListItemLastMessage(_0x51d488['id'],_0x51d488['lastMessage'],_0x51d488[_0x59ed37(0x78)])&&bumpChatListItemToTop(_0x51d488['id']),scheduleTogetherInviteExpiry(_0x51d488['id'],_0x5dd38c,_0x2cd930),isChatDetailActiveForChat(_0x51d488['id'])&&await renderChatMessages(_0x51d488),!![];}async function joinTogetherInviteFromCharacter(_0x5d1b89){const _0x4336a7=_0x2a6210,_0x22a91f=normalizeId(currentChatId||window['currentChatId']||'');if(!_0x22a91f||!db?.['chats'])return![];let _0x21bef8=null;try{_0x21bef8=await db['chats']['get'](_0x22a91f);}catch(_0x5e9b11){_0x21bef8=null;}if(!_0x21bef8||!Array[_0x4336a7(0x14f)](_0x21bef8[_0x4336a7(0x1a8)]))return![];const _0x2204f2=_0x21bef8[_0x4336a7(0x1a8)][_0x4336a7(0x6bf)](_0x9509c9=>{const _0x46686b=_0x4336a7;if(!_0x9509c9||_0x9509c9[_0x46686b(0x1e9)]!==_0x46686b(0x5f9))return![];const _0x3faf15=_0x9509c9[_0x46686b(0x1e4)]||{},_0x1d1a67=String(_0x3faf15['id']||_0x9509c9[_0x46686b(0x3ed)]||'')[_0x46686b(0x14c)]();if(_0x1d1a67!==_0x5d1b89)return![];const _0x54f888=String(_0x9509c9[_0x46686b(0x74f)]||_0x3faf15[_0x46686b(0x464)]||'')[_0x46686b(0x14c)]()['toLowerCase']();return!_0x54f888||_0x54f888===_0x46686b(0x1ca);});if(!_0x2204f2)return![];const _0x36e2b2=_0x2204f2['_togetherInvite']||{};if(isTogetherInviteExpired(_0x36e2b2,_0x2204f2)){const _0x4f6a48=String(_0x36e2b2['id']||_0x2204f2[_0x4336a7(0x3ed)]||'')[_0x4336a7(0x14c)]();if(_0x4f6a48)await expireTogetherInviteById(_0x22a91f,_0x4f6a48);return![];}if(String(_0x36e2b2['initiatorRole']||'')[_0x4336a7(0x14c)]()[_0x4336a7(0x5bd)]()!==_0x4336a7(0x450))return![];const _0x4780fc={..._0x36e2b2,'id':String(_0x36e2b2['id']||_0x2204f2[_0x4336a7(0x3ed)]||'')[_0x4336a7(0x14c)](),'status':_0x4336a7(0x418)};await updateTogetherInviteMessage(_0x21bef8,_0x2204f2,_0x4780fc);const _0x5adec6=Number[_0x4336a7(0x530)](_0x36e2b2['playlistIndex'])?_0x36e2b2[_0x4336a7(0x48b)]:-0x1;let _0x2ea933=_0x5adec6;_0x2ea933<0x0&&(_0x2ea933=resolveTogetherPlaylistTargetIndex({'owner':_0x36e2b2[_0x4336a7(0x1b2)],'playlist':_0x36e2b2[_0x4336a7(0xcb)],'index':_0x36e2b2['playlistIndex']}));try{await loadUserPlaylistData();}catch(_0x18a515){}if(!Array[_0x4336a7(0x14f)](playlists)||_0x2ea933<0x0||_0x2ea933>=playlists[_0x4336a7(0x73a)])showIslandNotification(_0x4336a7(0x312),'歌单不可用，无法开始播放',_0x4336a7(0x4fd));else{const _0x3062ef=playlists[_0x2ea933],_0x79a20d=pickRandomPlayableSongIndex(_0x3062ef);if(_0x79a20d[_0x4336a7(0x182)]<0x0)return showIslandNotification(_0x4336a7(0x312),_0x4336a7(0x59b),_0x4336a7(0x4fd)),!![];const _0x332a60=_0x79a20d[_0x4336a7(0x182)],_0x1ea32c=0.15+Math[_0x4336a7(0x658)]()*0.55;userPlaylistCurrentIndex=_0x2ea933,userPlaylistPlaybackIndex=_0x2ea933,userPlaylistPlaybackSongIndex=_0x332a60,userPlaylistPlaybackPendingSwitch=![],persistUserPlaylistPlaybackIndex(),applyUserPlaylistPlaybackHighlight(),await playUserPlaylistSongAtIndex(_0x332a60,{'autoplay':!![],'startRatio':_0x1ea32c});}return isChatDetailActiveForChat(_0x22a91f)&&await renderChatMessages(_0x21bef8),!![];}async function sendTogetherInviteToChat(_0x302420){const _0x2099ba=_0x2a6210;if(!_0x302420||!db?.[_0x2099ba(0x37c)]||!db?.[_0x2099ba(0x3d8)])return;const _0x3e96a8=normalizeId(_0x302420[_0x2099ba(0x29b)]||''),_0x4ff724=normalizeId(_0x302420['id']||''),_0x12cbad=normalizeId(_0x302420['characterId']||'')||_0x4ff724;let _0x51b891=null;isValidIdValue(_0x3e96a8)&&(_0x51b891=await db['chats'][_0x2099ba(0x60f)](_0x3e96a8));!_0x51b891&&isValidIdValue(_0x4ff724)&&(_0x51b891=await db['chats'][_0x2099ba(0x60f)](_0x4ff724));if(_0x51b891&&typeof isUserCreatedCharacterRecord===_0x2099ba(0x88)&&isUserCreatedCharacterRecord(_0x51b891)){const _0x2efe24=await findChatRecordForCharacter(_0x51b891['id']);_0x2efe24&&(togetherInviteDebugLog('sendTogetherInviteToChat:mapCharacterToChat',{'from':_0x51b891['id'],'to':_0x2efe24['id']}),_0x51b891=_0x2efe24);}!_0x51b891&&isValidIdValue(_0x12cbad)&&(_0x51b891=await findChatRecordForCharacter(_0x12cbad));if(!_0x51b891)return;const _0x465d12=normalizeId(_0x51b891['id']||''),_0x2ee508=normalizeId(getCharacterIdFromChat(_0x51b891)||'')||_0x12cbad||_0x4ff724;if(!_0x465d12)return;togetherInviteDebugLog(_0x2099ba(0x261),{'chatId':_0x465d12,'characterId':_0x2ee508,'currentChatId':currentChatId,'windowChatId':window['currentChatId']});const _0x16688e=await getActiveSessionIdForChat(_0x465d12),_0x47448d=_0x2099ba(0x11b)+Date[_0x2099ba(0x344)]()+'_'+Math[_0x2099ba(0x658)]()[_0x2099ba(0x1ac)](0x24)[_0x2099ba(0x4c1)](0x2,0x8),_0x3adf43=resolveTogetherInviteSongMeta(),_0x3c4868=Date[_0x2099ba(0x344)](),_0x7b9cba=await resolveChatUserProfileName(_0x465d12,_0x51b891),_0x2049ab=String(_0x302420?.['name']||_0x51b891?.['name']||'')[_0x2099ba(0x14c)]()||'角色',_0x2561de={'id':_0x47448d,'status':_0x2099ba(0x1ca),'songTitle':_0x3adf43[_0x2099ba(0x97)],'songArtist':_0x3adf43['songArtist'],'playlistTitle':_0x3adf43[_0x2099ba(0xcb)]||'','createdAt':_0x3c4868,'initiatorRole':_0x2099ba(0x2c6),'initiatorName':_0x7b9cba,'initiatorId':_0x7b9cba,'inviteeRole':_0x2099ba(0x450),'inviteeName':_0x2049ab,'playlistOwner':_0x2099ba(0x2c6)};_0x51b891['chatbox']=Array[_0x2099ba(0x14f)](_0x51b891[_0x2099ba(0x1a8)])?_0x51b891[_0x2099ba(0x1a8)]:[];const _0x3f1fba={'role':_0x2099ba(0x2c6),'type':_0x2099ba(0x5f9),'content':'','timestamp':_0x3c4868,'read':![],'togetherInviteId':_0x47448d,'togetherInviteStatus':_0x2099ba(0x1ca),'togetherInviteTitle':_0x3adf43[_0x2099ba(0x97)],'togetherInviteArtist':_0x3adf43[_0x2099ba(0x12a)],'togetherInvitePlaylistTitle':_0x3adf43[_0x2099ba(0xcb)]||'','_togetherInvite':_0x2561de};_0x51b891[_0x2099ba(0x1a8)][_0x2099ba(0x2b9)](_0x3f1fba);const _0x51f2a9=await db['chatMessages']['add']({'chatId':_0x465d12,'characterId':_0x2ee508,'sessionId':_0x16688e||_0x2099ba(0x2a7),'role':_0x2099ba(0x2c6),'type':_0x2099ba(0x5f9),'content':'','timestamp':new Date(_0x3c4868)['toISOString'](),'togetherInviteId':_0x47448d,'togetherInviteStatus':'pending','togetherInviteTitle':_0x3adf43[_0x2099ba(0x97)],'togetherInviteArtist':_0x3adf43['songArtist'],'togetherInvitePlaylistTitle':_0x3adf43[_0x2099ba(0xcb)]||'','_togetherInvite':_0x2561de});_0x3f1fba[_0x2099ba(0x625)]=_0x51f2a9,_0x51b891[_0x2099ba(0x51f)]='一起听邀请',_0x51b891[_0x2099ba(0x78)]=_0x3c4868,await db['chats']['put'](_0x51b891),scheduleTogetherInviteExpiry(_0x51b891['id'],_0x47448d,_0x3c4868);updateChatListItemLastMessage(_0x51b891['id'],_0x51b891[_0x2099ba(0x51f)],_0x51b891[_0x2099ba(0x78)])&&bumpChatListItemToTop(_0x51b891['id']);try{const _0x1100c1=userPlaylistViewEl||document[_0x2099ba(0x550)](_0x2099ba(0x720)),_0x5533d8=!!(_0x1100c1&&_0x1100c1['classList'][_0x2099ba(0x353)]('active'));(_0x5533d8||!isChatDetailActiveForChat(_0x51b891['id']))&&requestChatDetailRefresh(_0x465d12);}catch(_0x55f04b){}try{const _0x28f9e1=normalizeId(currentChatId||window[_0x2099ba(0x2dd)]||'');if(_0x28f9e1&&isSameId(_0x28f9e1,_0x51b891['id'])){const _0x452454=window[_0x2099ba(0x53f)];if(_0x452454&&isSameId(normalizeId(_0x452454['id']),normalizeId(_0x51b891['id'])))_0x452454[_0x2099ba(0x1a8)]=Array[_0x2099ba(0x14f)](_0x452454[_0x2099ba(0x1a8)])?_0x452454[_0x2099ba(0x1a8)]:[],_0x452454[_0x2099ba(0x1a8)][_0x2099ba(0x2b9)](_0x3f1fba),await renderChatMessages(_0x452454,_0x2099ba(0x527));else{if(typeof reloadCurrentChatMessages===_0x2099ba(0x88))await reloadCurrentChatMessages();else typeof renderChatMessages===_0x2099ba(0x88)&&await renderChatMessages(_0x51b891,_0x2099ba(0x527));}}else{if(isChatDetailActiveForChat(_0x51b891['id'])){const _0x3d2948=window['__ovoActiveChatRecord'];_0x3d2948&&isSameId(normalizeId(_0x3d2948['id']),normalizeId(_0x51b891['id']))?(_0x3d2948['chatbox']=Array['isArray'](_0x3d2948['chatbox'])?_0x3d2948[_0x2099ba(0x1a8)]:[],_0x3d2948['chatbox']['push'](_0x3f1fba),await renderChatMessages(_0x3d2948,_0x2099ba(0x527))):await renderChatMessages(_0x51b891,_0x2099ba(0x527));}}}catch(_0x1ebe65){}togetherInviteDebugLog(_0x2099ba(0x532),{'chatId':_0x465d12,'inviteId':_0x47448d}),showIslandNotification(_0x2099ba(0x6ba),_0x2099ba(0x224)+(_0x302420[_0x2099ba(0x189)]||'角色'),'check');}function selectPlaylistForPlayback(_0x3cc517={}){const _0x5b0d35=_0x2a6210;if(!Array['isArray'](playlists)||playlists[_0x5b0d35(0x73a)]===0x0)return;if(userPlaylistCurrentIndex===-0x1)return;const _0x5628ab=userPlaylistPlaybackIndex,_0x364b27=isUserPlaylistPlayingNow();userPlaylistPlaybackIndex=userPlaylistCurrentIndex,persistUserPlaylistPlaybackIndex(),applyUserPlaylistPlaybackHighlight();_0x364b27?_0x5628ab!==userPlaylistPlaybackIndex&&(userPlaylistPlaybackPendingSwitch=!![],userPlaylistPlaybackSongIndex=-0x1):(userPlaylistPlaybackPendingSwitch=![],userPlaylistPlaybackSongIndex=0x0,_0x5628ab!==userPlaylistPlaybackIndex&&stopUserPlaylistPlayback({'reset':!![]}));refreshUserPlaylistPlaybackSongList();const _0x1e3e83=playlists[userPlaylistPlaybackIndex]?.[_0x5b0d35(0x1fa)]||_0x5b0d35(0x2de);showIslandNotification(_0x5b0d35(0x4f1),_0x5b0d35(0x151)+_0x1e3e83,_0x5b0d35(0x106)),_0x3cc517['emitSystem']===!![]&&void addTogetherMusicSystemMessageForActiveChat({'chat':_0x3cc517['chat'],'action':_0x5b0d35(0x37f),'actorRole':_0x3cc517[_0x5b0d35(0x179)],'actorName':_0x3cc517[_0x5b0d35(0x663)],'playlistTitle':_0x1e3e83});}function applyUserPlaylistPlaybackHighlight(){if(!Array['isArray'](userPlaylistNodeElements))return;userPlaylistNodeElements['forEach']((_0x1e9807,_0x4a0d3e)=>{const _0x5e95e6=_0x18ea;if(!_0x1e9807)return;_0x4a0d3e===userPlaylistPlaybackIndex?_0x1e9807[_0x5e95e6(0x2af)][_0x5e95e6(0x2a8)]('is-playing'):_0x1e9807[_0x5e95e6(0x2af)][_0x5e95e6(0x5e8)](_0x5e95e6(0x7ff));});}function isUserPlaylistPlayingNow(){const _0x3476a9=_0x2a6210;if(userPlaylistPlaybackIsPlaying)return!![];if(userPlaylistPlaybackAudio&&userPlaylistPlaybackAudio[_0x3476a9(0x5e9)]===![])return!![];return![];}function initMusicWidgetUI(){const _0xd6ed00=_0x2a6210;if(musicWidgetReady)return;const _0x41b863=document[_0xd6ed00(0x550)](_0xd6ed00(0x372)),_0x415086=document['getElementById']('orbitOrb');if(!_0x41b863||!_0x415086)return;musicWidgetReady=!![],_0x41b863[_0xd6ed00(0x37e)][_0xd6ed00(0x712)]=_0xd6ed00(0x22e);try{_0x415086['style'][_0xd6ed00(0x2ac)]=_0xd6ed00(0x22e);}catch(_0x1864a5){}initMusicWidgetDrag(_0x41b863,_0x415086);const _0x1722ff=getMusicWidgetLyricStageEl();if(_0x1722ff){try{_0x1722ff[_0xd6ed00(0x37e)]['touchAction']=_0xd6ed00(0x22e);}catch(_0x1a8885){}initMusicWidgetLyricDrag(_0x1722ff);}setMusicWidgetLyricStageVisibility(!!musicWidgetLyricStyleActive),initMusicWidgetLyricColorPicker(),loadMusicWidgetOrbSkin(),initMusicWidgetOrbSkinEditor(),loadMusicWidgetPositions(),updateMusicWidgetPlaybackState(isUserPlaylistPlayingNow()),updateMusicWidgetSongInfo(userPlaylistPlaybackNowPlaying),bindMusicWidgetOverlayControls();}function hasUserPlaylistAudioSource(){const _0x3bb5dd=_0x2a6210;if(!userPlaylistPlaybackAudio)return![];try{if(typeof userPlaylistPlaybackAudio['getAttribute']===_0x3bb5dd(0x88)){const _0x111de6=String(userPlaylistPlaybackAudio['getAttribute'](_0x3bb5dd(0x655))||'')[_0x3bb5dd(0x14c)]();return!!_0x111de6;}}catch(_0x3e572c){}return![];}function updateMusicWidgetVisibility(_0x27ac15){const _0x5b51ca=_0x2a6210,_0x8a9151=document[_0x5b51ca(0x550)](_0x5b51ca(0x372));if(!_0x8a9151)return;const _0xeabad9=hasUserPlaylistAudioSource();if(musicWidgetForceHidden&&!_0x27ac15){_0x8a9151[_0x5b51ca(0x37e)]['display']='none',_0x8a9151[_0x5b51ca(0x37e)][_0x5b51ca(0x38f)]=_0x5b51ca(0x2ec),_0x8a9151[_0x5b51ca(0x37e)][_0x5b51ca(0x851)]=_0x5b51ca(0x22e);return;}musicWidgetForceHidden&&_0x27ac15&&(musicWidgetForceHidden=![]);const _0x5ebc54=_0x27ac15||_0xeabad9;_0x8a9151['style'][_0x5b51ca(0x712)]=_0x5ebc54?_0x5b51ca(0x8b):_0x5b51ca(0x22e),_0x8a9151[_0x5b51ca(0x37e)][_0x5b51ca(0x38f)]=_0x5ebc54?'visible':_0x5b51ca(0x2ec),_0x8a9151['style'][_0x5b51ca(0x851)]=_0x5ebc54?_0x5b51ca(0x1ea):_0x5b51ca(0x22e);}function updateMusicWidgetPlaybackState(_0x22a4c7){const _0xeb2f1c=_0x2a6210,_0x4d09df=document[_0xeb2f1c(0x550)](_0xeb2f1c(0x290)),_0x268cf9=document[_0xeb2f1c(0x550)](_0xeb2f1c(0x17e));_0x4d09df&&_0x4d09df[_0xeb2f1c(0x2af)][_0xeb2f1c(0x18f)](_0xeb2f1c(0x552),!!_0x22a4c7);_0x268cf9&&(_0x268cf9['innerHTML']=_0x22a4c7?_0xeb2f1c(0x7d6):_0xeb2f1c(0x6fb));const _0x4d0f42=_0x4d09df?_0x4d09df[_0xeb2f1c(0x2ba)]('.star-core'):null;_0x4d0f42&&(_0x4d0f42[_0xeb2f1c(0x37e)][_0xeb2f1c(0x858)]=_0x22a4c7?_0xeb2f1c(0x687):_0xeb2f1c(0x5e9));}function updateMusicWidgetSongInfo(_0x2139cd){const _0x3c70d5=_0x2a6210,_0x3d307a=document[_0x3c70d5(0x550)]('musicWidgetSongTitle'),_0x14ab35=document[_0x3c70d5(0x550)]('musicWidgetArtistName');if(!_0x3d307a||!_0x14ab35)return;if(!_0x2139cd){_0x3d307a[_0x3c70d5(0x2a1)]='',_0x14ab35['textContent']='',refreshMusicWidgetOverlayList(),updateMusicWidgetFloatingLyric(!![]);return;}const _0x96bc82=String(_0x2139cd[_0x3c70d5(0x189)]||_0x2139cd[_0x3c70d5(0x1fa)]||_0x2139cd['label']||'')[_0x3c70d5(0x14c)](),_0x466b4d=buildSongArtistText(_0x2139cd);_0x3d307a[_0x3c70d5(0x2a1)]=_0x96bc82||'\x20',_0x14ab35[_0x3c70d5(0x2a1)]=_0x466b4d||'\x20',refreshMusicWidgetOverlayList(),updateMusicWidgetFloatingLyric(!![]);}function bindMusicWidgetOverlayControls(){const _0x15a9d5=_0x2a6210,_0x440e0f=document['getElementById'](_0x15a9d5(0x2ab));_0x440e0f&&_0x440e0f['dataset']['bound']!=='1'&&(_0x440e0f[_0x15a9d5(0x772)]['bound']='1',_0x440e0f[_0x15a9d5(0x2f7)]('click',()=>{if(Date['now']()<musicWidgetSuppressClickUntil)return;showMusicWidgetPlaylistList();}));}function getMusicWidgetListScrollEl(){const _0x35b788=_0x2a6210;return document[_0x35b788(0x550)](_0x35b788(0x74e));}function resolveMusicWidgetPlaylistIndex(_0x1f83ef){const _0x407b8c=_0x2a6210,_0x2d7375=getUserPlaylistIndicesByOwner('');if(_0x2d7375[_0x407b8c(0x73a)]===0x0)return-0x1;if(Number[_0x407b8c(0x530)](_0x1f83ef)&&_0x2d7375['includes'](_0x1f83ef))return _0x1f83ef;if(Number[_0x407b8c(0x530)](userPlaylistPlaybackIndex)&&_0x2d7375[_0x407b8c(0x3a6)](userPlaylistPlaybackIndex))return userPlaylistPlaybackIndex;if(Number[_0x407b8c(0x530)](userPlaylistCurrentIndex)&&_0x2d7375[_0x407b8c(0x3a6)](userPlaylistCurrentIndex))return userPlaylistCurrentIndex;return _0x2d7375[0x0];}function showMusicWidgetSongList(_0x2eb945){const _0x16a6f7=_0x2a6210,_0x473f52=resolveMusicWidgetPlaylistIndex(_0x2eb945);musicWidgetListMode=_0x16a6f7(0x1c8),musicWidgetListPlaylistIndex=_0x473f52,renderMusicWidgetSongList(_0x473f52);}function showMusicWidgetPlaylistList(){const _0x292c99=_0x2a6210;musicWidgetListMode=_0x292c99(0x236),musicWidgetListPlaylistIndex=-0x1,renderMusicWidgetPlaylistList();}function renderMusicWidgetSongList(_0x10ed66){const _0x5003c0=_0x2a6210,_0x21420b=getMusicWidgetListScrollEl();if(!_0x21420b)return;_0x21420b['innerHTML']='';if(!Array['isArray'](playlists)||playlists[_0x5003c0(0x73a)]===0x0){const _0x30c0d2=document[_0x5003c0(0x24b)](_0x5003c0(0x5ab));_0x30c0d2[_0x5003c0(0x337)]='list-item';const _0x33ef74=document[_0x5003c0(0x24b)]('span');_0x33ef74[_0x5003c0(0x2a1)]=_0x5003c0(0x62e);const _0x4fe148=document['createElement']('span');_0x4fe148[_0x5003c0(0x2a1)]='',_0x30c0d2['appendChild'](_0x33ef74),_0x30c0d2['appendChild'](_0x4fe148),_0x21420b[_0x5003c0(0x744)](_0x30c0d2);return;}const _0x5b85ae=resolveMusicWidgetPlaylistIndex(_0x10ed66);musicWidgetListPlaylistIndex=_0x5b85ae;if(_0x5b85ae<0x0||_0x5b85ae>=playlists[_0x5003c0(0x73a)]){const _0x1eb212=document['createElement'](_0x5003c0(0x5ab));_0x1eb212[_0x5003c0(0x337)]=_0x5003c0(0x399);const _0x23cc37=document[_0x5003c0(0x24b)](_0x5003c0(0x7bf));_0x23cc37['textContent']=_0x5003c0(0x164);const _0x34ddb6=document[_0x5003c0(0x24b)](_0x5003c0(0x7bf));_0x34ddb6[_0x5003c0(0x2a1)]='',_0x1eb212[_0x5003c0(0x744)](_0x23cc37),_0x1eb212[_0x5003c0(0x744)](_0x34ddb6),_0x21420b[_0x5003c0(0x744)](_0x1eb212);return;}const _0x1507d9=playlists[_0x5b85ae],_0x1dfe6b=Array[_0x5003c0(0x14f)](_0x1507d9?.[_0x5003c0(0x1c8)])?_0x1507d9[_0x5003c0(0x1c8)]:[];if(_0x1dfe6b[_0x5003c0(0x73a)]===0x0){const _0x368695=document['createElement'](_0x5003c0(0x5ab));_0x368695['className']=_0x5003c0(0x399);const _0x410961=document[_0x5003c0(0x24b)](_0x5003c0(0x7bf));_0x410961[_0x5003c0(0x2a1)]=_0x5003c0(0x7be);const _0x314174=document['createElement']('span');_0x314174[_0x5003c0(0x2a1)]='',_0x368695[_0x5003c0(0x744)](_0x410961),_0x368695[_0x5003c0(0x744)](_0x314174),_0x21420b[_0x5003c0(0x744)](_0x368695);return;}_0x1dfe6b[_0x5003c0(0x84c)]((_0x6f8b9c,_0xbac798)=>{const _0x5944ac=_0x5003c0,_0x258175=document[_0x5944ac(0x24b)](_0x5944ac(0x5ab));_0x258175['className']=_0x5944ac(0x399);const _0x43c436=buildUserPlaylistSongLabel(_0x6f8b9c)||String(_0x6f8b9c?.[_0x5944ac(0x189)]||_0x6f8b9c?.['title']||_0x6f8b9c||'')[_0x5944ac(0x14c)]()||_0x5944ac(0x101)+(_0xbac798+0x1),_0x12b4f0=document[_0x5944ac(0x24b)](_0x5944ac(0x7bf));_0x12b4f0['textContent']=_0x43c436;const _0x3d639f=document[_0x5944ac(0x24b)]('span'),_0x9217d0=_0x5b85ae===userPlaylistPlaybackIndex&&_0xbac798===userPlaylistPlaybackSongIndex;_0x9217d0?(_0x258175['classList'][_0x5944ac(0x2a8)](_0x5944ac(0x763)),_0x3d639f[_0x5944ac(0x2a1)]='Playing'):_0x3d639f[_0x5944ac(0x2a1)]=String(_0xbac798+0x1)[_0x5944ac(0x6a6)](0x2,'0'),_0x258175[_0x5944ac(0x744)](_0x12b4f0),_0x258175[_0x5944ac(0x744)](_0x3d639f),_0x258175[_0x5944ac(0x2f7)](_0x5944ac(0x810),()=>{const _0x3f543b=_0x5944ac;if(Date[_0x3f543b(0x344)]()<musicWidgetSuppressClickUntil)return;playMusicWidgetSong(_0x5b85ae,_0xbac798);}),_0x21420b['appendChild'](_0x258175);});}function renderMusicWidgetPlaylistList(){const _0x5b1342=_0x2a6210,_0x475d9d=getMusicWidgetListScrollEl();if(!_0x475d9d)return;_0x475d9d[_0x5b1342(0x63f)]='';if(!Array[_0x5b1342(0x14f)](playlists)||playlists[_0x5b1342(0x73a)]===0x0){const _0x175c21=document[_0x5b1342(0x24b)](_0x5b1342(0x5ab));_0x175c21[_0x5b1342(0x337)]=_0x5b1342(0x399);const _0x52d0df=document[_0x5b1342(0x24b)]('span');_0x52d0df[_0x5b1342(0x2a1)]=_0x5b1342(0x39a);const _0x4defa7=document['createElement']('span');_0x4defa7[_0x5b1342(0x2a1)]='',_0x175c21[_0x5b1342(0x744)](_0x52d0df),_0x175c21[_0x5b1342(0x744)](_0x4defa7),_0x475d9d[_0x5b1342(0x744)](_0x175c21);return;}const _0xf2a7bb=getUserPlaylistIndicesByOwner('');if(_0xf2a7bb[_0x5b1342(0x73a)]===0x0){const _0xe75e09=document[_0x5b1342(0x24b)]('div');_0xe75e09['className']='list-item';const _0x109a20=document[_0x5b1342(0x24b)]('span');_0x109a20[_0x5b1342(0x2a1)]='当前聊天暂无歌单';const _0x27b849=document[_0x5b1342(0x24b)](_0x5b1342(0x7bf));_0x27b849[_0x5b1342(0x2a1)]='',_0xe75e09[_0x5b1342(0x744)](_0x109a20),_0xe75e09[_0x5b1342(0x744)](_0x27b849),_0x475d9d['appendChild'](_0xe75e09);return;}_0xf2a7bb[_0x5b1342(0x84c)](_0xbc10df=>{const _0x493933=_0x5b1342,_0x1903ae=playlists[_0xbc10df],_0x4280f9=document['createElement']('div');_0x4280f9[_0x493933(0x337)]=_0x493933(0x399);const _0x6c98f0=document['createElement'](_0x493933(0x7bf));_0x6c98f0[_0x493933(0x2a1)]=_0x1903ae?.[_0x493933(0x1fa)]||_0x493933(0x4e6);const _0x250ff8=document[_0x493933(0x24b)](_0x493933(0x7bf)),_0x58d94a=_0xbc10df===userPlaylistPlaybackIndex;_0x58d94a?(_0x4280f9[_0x493933(0x2af)][_0x493933(0x2a8)](_0x493933(0x763)),_0x250ff8['textContent']=_0x493933(0x31c)):_0x250ff8[_0x493933(0x2a1)]='',_0x4280f9[_0x493933(0x744)](_0x6c98f0),_0x4280f9[_0x493933(0x744)](_0x250ff8),_0x4280f9[_0x493933(0x2f7)](_0x493933(0x810),()=>{const _0x12c126=_0x493933;if(Date[_0x12c126(0x344)]()<musicWidgetSuppressClickUntil)return;showMusicWidgetSongList(_0xbc10df);}),_0x475d9d['appendChild'](_0x4280f9);});}async function playMusicWidgetSong(_0x2e5dd4,_0x35db09){const _0x3b373c=_0x2a6210;if(!Array[_0x3b373c(0x14f)](playlists)||_0x2e5dd4<0x0||_0x2e5dd4>=playlists[_0x3b373c(0x73a)])return;const _0x5eacdc=userPlaylistPlaybackIndex;userPlaylistCurrentIndex=_0x2e5dd4,userPlaylistPlaybackIndex=_0x2e5dd4,userPlaylistPlaybackSongIndex=_0x35db09,userPlaylistPlaybackPendingSwitch=![],persistUserPlaylistPlaybackIndex(),applyUserPlaylistPlaybackHighlight();const _0x438c05=_0x5eacdc!==_0x2e5dd4?_0x3b373c(0x37f):_0x3b373c(0xda),_0x14ebef=playlists[_0x2e5dd4]?.[_0x3b373c(0x1fa)]?String(playlists[_0x2e5dd4][_0x3b373c(0x1fa)]):'';await playUserPlaylistSongAtIndex(_0x35db09,{'autoplay':!![],'emitSystem':!![],'systemAction':_0x438c05,'actorRole':_0x3b373c(0x2c6),'systemPlaylistTitle':_0x14ebef});}function refreshMusicWidgetOverlayList(){const _0x23d25f=_0x2a6210,_0x2ad374=document[_0x23d25f(0x550)](_0x23d25f(0x273));if(!_0x2ad374||!_0x2ad374[_0x23d25f(0x2af)][_0x23d25f(0x353)](_0x23d25f(0x7cc)))return;musicWidgetListMode===_0x23d25f(0x236)?renderMusicWidgetPlaylistList():renderMusicWidgetSongList(musicWidgetListPlaylistIndex);}function getMusicWidgetLyricStageEl(){const _0x47dc24=_0x2a6210;return document[_0x47dc24(0x550)](_0x47dc24(0x4e3));}function getMusicWidgetLyricStyleOverlay(){const _0x5a67e4=_0x2a6210;return document[_0x5a67e4(0x550)](_0x5a67e4(0x37d));}function getMusicWidgetLyricColorPickerEl(){const _0x22bd7f=_0x2a6210;return document[_0x22bd7f(0x550)](_0x22bd7f(0x1c0));}function getMusicWidgetLyricColorSwatchEl(){const _0x539386=_0x2a6210;return document[_0x539386(0x550)]('musicWidgetLyricColorSwatch');}function getMusicWidgetLyricColorBtnEl(){const _0x26457b=_0x2a6210;return document[_0x26457b(0x550)](_0x26457b(0x5e6));}function isValidMusicWidgetLyricColor(_0x8e113b){const _0x54f6b8=_0x2a6210,_0x4fad7e=String(_0x8e113b||'')[_0x54f6b8(0x14c)]();return/^#([0-9a-fA-F]{6}|[0-9a-fA-F]{3})$/['test'](_0x4fad7e);}function applyMusicWidgetLyricColor(_0x56f0d2,_0x5a77a9={}){const _0x575403=_0x2a6210,{persist:persist=!![]}=_0x5a77a9,_0x297798=String(_0x56f0d2||'')[_0x575403(0x14c)](),_0x255428=isValidMusicWidgetLyricColor(_0x297798)?_0x297798:'';musicWidgetLyricColor=_0x255428;const _0xc4227d=getMusicWidgetLyricStageEl();_0xc4227d&&(_0x255428?_0xc4227d[_0x575403(0x37e)][_0x575403(0x63d)](_0x575403(0x54c),_0x255428):_0xc4227d[_0x575403(0x37e)][_0x575403(0x426)](_0x575403(0x54c)));const _0x123050=getMusicWidgetLyricColorSwatchEl();_0x123050&&(_0x123050[_0x575403(0x37e)][_0x575403(0x3c0)]=_0x255428||_0x575403(0x589));const _0x1e91cf=getMusicWidgetLyricColorPickerEl();_0x1e91cf&&_0x255428&&_0x1e91cf[_0x575403(0x4cf)]!==_0x255428&&(_0x1e91cf[_0x575403(0x4cf)]=_0x255428);if(persist)try{localStorage[_0x575403(0x21c)](MUSIC_WIDGET_LYRIC_COLOR_KEY,_0x255428);}catch(_0x130d1d){}}function loadMusicWidgetLyricColor(){const _0x4e03b7=_0x2a6210;if(musicWidgetLyricColorLoaded)return;musicWidgetLyricColorLoaded=!![];let _0x130fdb='';try{_0x130fdb=localStorage[_0x4e03b7(0x401)](MUSIC_WIDGET_LYRIC_COLOR_KEY)||'';}catch(_0x4f088f){_0x130fdb='';}!isValidMusicWidgetLyricColor(_0x130fdb)&&(_0x130fdb='');applyMusicWidgetLyricColor(_0x130fdb,{'persist':![]});const _0x3c74f2=getMusicWidgetLyricColorPickerEl();_0x3c74f2&&!_0x130fdb&&(_0x3c74f2['value']=_0x4e03b7(0x523));}function initMusicWidgetLyricColorPicker(){const _0x3a88c0=_0x2a6210,_0x5b513e=getMusicWidgetLyricColorBtnEl(),_0x500e94=getMusicWidgetLyricColorPickerEl();if(!_0x5b513e||!_0x500e94)return;if(_0x5b513e['dataset']['bound']==='1')return;_0x5b513e[_0x3a88c0(0x772)]['bound']='1',_0x5b513e[_0x3a88c0(0x2f7)](_0x3a88c0(0x810),_0x45175f=>{const _0x5f19c2=_0x3a88c0;_0x45175f[_0x5f19c2(0xf0)](),_0x45175f[_0x5f19c2(0x69e)](),_0x500e94['click']();}),_0x500e94[_0x3a88c0(0x2f7)](_0x3a88c0(0x603),_0x13440c=>{const _0x3625f5=_0x3a88c0;applyMusicWidgetLyricColor(_0x13440c[_0x3625f5(0x66d)]?.['value'],{'persist':!![]});}),_0x500e94[_0x3a88c0(0x2f7)](_0x3a88c0(0x860),_0x51245d=>{const _0x1d4804=_0x3a88c0;applyMusicWidgetLyricColor(_0x51245d[_0x1d4804(0x66d)]?.[_0x1d4804(0x4cf)],{'persist':!![]});}),loadMusicWidgetLyricColor();}function setMusicWidgetLyricStageVisibility(_0xa3456){const _0x1abf1e=_0x2a6210,_0x3dd6c4=getMusicWidgetLyricStageEl();if(!_0x3dd6c4)return;_0x3dd6c4['style'][_0x1abf1e(0x712)]=_0xa3456?_0x1abf1e(0x8b):_0x1abf1e(0x22e),_0x3dd6c4['style'][_0x1abf1e(0x851)]=_0xa3456?_0x1abf1e(0x1ea):_0x1abf1e(0x22e),_0x3dd6c4['classList'][_0x1abf1e(0x18f)](_0x1abf1e(0x33e),!!_0xa3456),!_0xa3456&&(_0x3dd6c4[_0x1abf1e(0x2af)]['remove']('is-dragging'),musicWidgetLyricDragState=null);}function getMusicWidgetSkinOverlayEl(){const _0x5ec51a=_0x2a6210;return document[_0x5ec51a(0x550)](_0x5ec51a(0x824));}function getMusicWidgetOrbEl(){const _0x4b619e=_0x2a6210;return document[_0x4b619e(0x550)](_0x4b619e(0x290));}function getMusicWidgetOrbImageEl(){const _0x5449b7=_0x2a6210;return document[_0x5449b7(0x550)](_0x5449b7(0xad));}function getMusicWidgetOrbFileInputEl(){const _0x33f635=_0x2a6210;return document['getElementById'](_0x33f635(0x6a8));}function getMusicWidgetOrbUrlInputEl(){const _0x254a11=_0x2a6210;return document[_0x254a11(0x550)](_0x254a11(0x217));}function getMusicWidgetOrbUrlApplyBtnEl(){const _0x5188f1=_0x2a6210;return document[_0x5188f1(0x550)](_0x5188f1(0x90));}function getMusicWidgetOrbSizeInputEl(){const _0x2b6255=_0x2a6210;return document['getElementById'](_0x2b6255(0x1ab));}function getMusicWidgetOrbSizeValueEl(){const _0x4db368=_0x2a6210;return document[_0x4db368(0x550)](_0x4db368(0x233));}function applyMusicWidgetOrbSize(_0x1b2d73,_0x436b93={}){const _0x3b9568=_0x2a6210,{persist:persist=!![]}=_0x436b93,_0x177d18=Math[_0x3b9568(0x5b1)](0x20,Math[_0x3b9568(0x596)](0x78,Number['isFinite'](_0x1b2d73)?_0x1b2d73:0x30));musicWidgetOrbSize=_0x177d18;const _0xc0599=getMusicWidgetOrbEl();_0xc0599&&(_0xc0599[_0x3b9568(0x37e)]['width']=_0x177d18+'px',_0xc0599[_0x3b9568(0x37e)]['height']=_0x177d18+'px',_0xc0599[_0x3b9568(0x37e)][_0x3b9568(0x63d)](_0x3b9568(0x5ec),_0x177d18+'px'));const _0x90d156=getMusicWidgetOrbSizeInputEl();if(_0x90d156)_0x90d156[_0x3b9568(0x4cf)]=String(_0x177d18);const _0x17bfc0=getMusicWidgetOrbSizeValueEl();if(_0x17bfc0)_0x17bfc0[_0x3b9568(0x2a1)]=String(_0x177d18);if(persist)try{localStorage[_0x3b9568(0x21c)](MUSIC_WIDGET_ORB_SIZE_KEY,String(_0x177d18));}catch(_0x4159a5){}}function applyMusicWidgetOrbPosition(_0x1434e5,_0xb8d9dc={}){const _0x14d7bf=_0x2a6210,{persist:persist=!![]}=_0xb8d9dc,_0x1ad74a=document[_0x14d7bf(0x550)](_0x14d7bf(0x372));if(!_0x1ad74a||!_0x1434e5||!Number[_0x14d7bf(0x530)](_0x1434e5[_0x14d7bf(0x396)])||!Number['isFinite'](_0x1434e5[_0x14d7bf(0x154)]))return;_0x1ad74a[_0x14d7bf(0x37e)]['left']=_0x1434e5[_0x14d7bf(0x396)]+'px',_0x1ad74a['style'][_0x14d7bf(0x154)]=_0x1434e5['top']+'px',_0x1ad74a[_0x14d7bf(0x37e)][_0x14d7bf(0x131)]=_0x14d7bf(0x1ea),_0x1ad74a[_0x14d7bf(0x37e)][_0x14d7bf(0x3e5)]=_0x14d7bf(0x1ea),_0x1ad74a[_0x14d7bf(0x772)][_0x14d7bf(0x1a5)]='1';if(persist)try{localStorage[_0x14d7bf(0x21c)](MUSIC_WIDGET_ORB_POSITION_KEY,JSON[_0x14d7bf(0x232)]({'left':_0x1434e5[_0x14d7bf(0x396)],'top':_0x1434e5[_0x14d7bf(0x154)]}));}catch(_0x5d8559){}}function applyMusicWidgetLyricPosition(_0x31904e,_0x1171bf={}){const _0x3e6433=_0x2a6210,{persist:persist=!![]}=_0x1171bf,_0x47e061=getMusicWidgetLyricStageEl();if(!_0x47e061||!_0x31904e||!Number[_0x3e6433(0x530)](_0x31904e[_0x3e6433(0x154)]))return;_0x47e061[_0x3e6433(0x37e)][_0x3e6433(0x396)]=_0x3e6433(0x583),_0x47e061[_0x3e6433(0x37e)][_0x3e6433(0x154)]=_0x31904e[_0x3e6433(0x154)]+'px',_0x47e061[_0x3e6433(0x37e)][_0x3e6433(0x131)]=_0x3e6433(0x1ea),_0x47e061[_0x3e6433(0x37e)][_0x3e6433(0x3e5)]=_0x3e6433(0x1ea),_0x47e061[_0x3e6433(0x37e)][_0x3e6433(0x61d)]='translateX(-50%)',_0x47e061[_0x3e6433(0x772)]['dragReady']='1';if(persist)try{localStorage[_0x3e6433(0x21c)](MUSIC_WIDGET_LYRIC_POSITION_KEY,JSON[_0x3e6433(0x232)]({'top':_0x31904e[_0x3e6433(0x154)]}));}catch(_0x5187c2){}}function applyMusicWidgetOrbImage(_0x4b10b5,_0x1b071b={}){const _0x816552=_0x2a6210,{persist:persist=!![]}=_0x1b071b,_0x1a800e=String(_0x4b10b5||'')[_0x816552(0x14c)]();musicWidgetOrbImage=_0x1a800e;const _0x350cb9=getMusicWidgetOrbEl(),_0x3817d9=getMusicWidgetOrbImageEl();_0x3817d9&&(_0x3817d9['src']=_0x1a800e,_0x3817d9[_0x816552(0x37e)][_0x816552(0x712)]=_0x1a800e?'block':_0x816552(0x22e));_0x350cb9&&_0x350cb9[_0x816552(0x2af)][_0x816552(0x18f)](_0x816552(0x1d7),!!_0x1a800e);if(persist)try{localStorage['setItem'](MUSIC_WIDGET_ORB_IMAGE_KEY,_0x1a800e);}catch(_0x5ee170){}}function loadMusicWidgetOrbSkin(){const _0x1313ca=_0x2a6210;if(musicWidgetOrbSkinLoaded)return;musicWidgetOrbSkinLoaded=!![];let _0x55f4bb='',_0x520094=0x30;try{_0x55f4bb=localStorage['getItem'](MUSIC_WIDGET_ORB_IMAGE_KEY)||'';}catch(_0x4606f8){_0x55f4bb='';}try{const _0xde5eb6=Number[_0x1313ca(0x359)](localStorage[_0x1313ca(0x401)](MUSIC_WIDGET_ORB_SIZE_KEY),0xa);if(Number['isFinite'](_0xde5eb6))_0x520094=_0xde5eb6;}catch(_0x439690){}applyMusicWidgetOrbSize(_0x520094,{'persist':![]}),applyMusicWidgetOrbImage(_0x55f4bb,{'persist':![]});}function loadMusicWidgetPositions(){const _0x5963d7=_0x2a6210;try{const _0xaa63df=localStorage['getItem'](MUSIC_WIDGET_ORB_POSITION_KEY);if(_0xaa63df){const _0x7cd240=JSON['parse'](_0xaa63df);_0x7cd240&&Number['isFinite'](_0x7cd240[_0x5963d7(0x396)])&&Number[_0x5963d7(0x530)](_0x7cd240['top'])&&applyMusicWidgetOrbPosition({'left':_0x7cd240[_0x5963d7(0x396)],'top':_0x7cd240['top']},{'persist':![]});}}catch(_0x420515){}try{const _0x3898db=localStorage[_0x5963d7(0x401)](MUSIC_WIDGET_LYRIC_POSITION_KEY);if(_0x3898db){const _0x3d4ace=JSON[_0x5963d7(0x701)](_0x3898db);_0x3d4ace&&Number[_0x5963d7(0x530)](_0x3d4ace[_0x5963d7(0x154)])&&applyMusicWidgetLyricPosition({'top':_0x3d4ace[_0x5963d7(0x154)]},{'persist':![]});}}catch(_0x166323){}}function initMusicWidgetOrbSkinEditor(){const _0x547535=_0x2a6210,_0x70685e=getMusicWidgetOrbFileInputEl(),_0x4e8d73=getMusicWidgetOrbUrlInputEl(),_0x2aa2d9=getMusicWidgetOrbUrlApplyBtnEl(),_0x3903f8=getMusicWidgetOrbSizeInputEl();if(!_0x70685e||!_0x4e8d73||!_0x2aa2d9||!_0x3903f8)return;if(_0x70685e[_0x547535(0x772)][_0x547535(0x29a)]==='1')return;_0x70685e['dataset'][_0x547535(0x29a)]='1',_0x70685e[_0x547535(0x2f7)]('change',_0x2d07b5=>{const _0x2e8a57=_0x547535,_0x34d885=_0x2d07b5['target']?.['files']?.[0x0];if(!_0x34d885)return;const _0x4cdfdd=new FileReader();_0x4cdfdd[_0x2e8a57(0x1b3)]=()=>{const _0xfd587c=_0x2e8a57,_0x3bcc62=String(_0x4cdfdd[_0xfd587c(0x4db)]||'')[_0xfd587c(0x14c)]();if(!_0x3bcc62){showIslandNotification(_0xfd587c(0x808),_0xfd587c(0x369),_0xfd587c(0x4fd));return;}applyMusicWidgetOrbImage(_0x3bcc62,{'persist':!![]});},_0x4cdfdd[_0x2e8a57(0x1b8)]=()=>{const _0x3ca690=_0x2e8a57;showIslandNotification(_0x3ca690(0x808),_0x3ca690(0x369),_0x3ca690(0x4fd));},_0x4cdfdd[_0x2e8a57(0x77c)](_0x34d885),_0x2d07b5[_0x2e8a57(0x66d)][_0x2e8a57(0x4cf)]='';}),_0x2aa2d9[_0x547535(0x2f7)]('click',()=>{const _0x35617e=_0x547535,_0x2bfd33=String(_0x4e8d73[_0x35617e(0x4cf)]||'')[_0x35617e(0x14c)]();if(!_0x2bfd33){applyMusicWidgetOrbImage('',{'persist':!![]});return;}const _0x5bf158=new Image();_0x5bf158[_0x35617e(0x1b3)]=()=>{applyMusicWidgetOrbImage(_0x2bfd33,{'persist':!![]});},_0x5bf158['onerror']=()=>{const _0x40a323=_0x35617e;showIslandNotification(_0x40a323(0x62d),'请检查图片地址','info');},_0x5bf158[_0x35617e(0x655)]=_0x2bfd33;}),_0x3903f8[_0x547535(0x2f7)]('input',_0x37c614=>{const _0xadd8ac=_0x547535,_0x29a744=Number[_0xadd8ac(0x359)](_0x37c614[_0xadd8ac(0x66d)]?.['value'],0xa);applyMusicWidgetOrbSize(_0x29a744,{'persist':!![]});}),loadMusicWidgetOrbSkin();}function toggleMusicWidgetSkinEditor(){const _0x404100=_0x2a6210;if(Date['now']()<musicWidgetSuppressClickUntil)return;const _0x56a438=getMusicWidgetSkinOverlayEl();if(!_0x56a438)return;const _0x162050=!_0x56a438[_0x404100(0x2af)]['contains']('show');if(!_0x162050){_0x56a438['classList']['remove']('show');return;}const _0x5d547d=document[_0x404100(0x550)](_0x404100(0x273));if(_0x5d547d)_0x5d547d[_0x404100(0x2af)][_0x404100(0x5e8)](_0x404100(0x7cc));const _0x380e44=getMusicWidgetLyricStyleOverlay();if(_0x380e44)_0x380e44[_0x404100(0x2af)]['remove'](_0x404100(0x7cc));_0x56a438[_0x404100(0x2af)][_0x404100(0x2a8)](_0x404100(0x7cc)),initMusicWidgetOrbSkinEditor();}function resolveMusicWidgetLyricLine(){const _0xfe5849=_0x2a6210;if(Array[_0xfe5849(0x14f)](userPlaylistPlaybackLyrics)&&userPlaylistPlaybackLyrics[_0xfe5849(0x73a)]>0x0){const _0x32e14b=Math[_0xfe5849(0x5b1)](0x0,Math[_0xfe5849(0x596)](userPlaylistPlaybackLyricIndex,userPlaylistPlaybackLyrics[_0xfe5849(0x73a)]-0x1)),_0x280f1b=userPlaylistPlaybackLyrics[_0x32e14b];return{'index':_0x32e14b,'text':String(_0x280f1b?.[_0xfe5849(0x76c)]||'')[_0xfe5849(0x14c)]()||_0xfe5849(0x38c)};}return{'index':-0x1,'text':_0xfe5849(0x160)};}function updateMusicWidgetLyricContent(_0x257a2f){const _0x5d613b=_0x2a6210,_0x4c3467=getMusicWidgetLyricStageEl();if(!_0x4c3467)return;_0x4c3467[_0x5d613b(0x63f)]='';const _0x17401b=document['createElement'](_0x5d613b(0x5ab));_0x17401b[_0x5d613b(0x337)]='lyric-text';if(musicWidgetLyricStyleActive==='style-stardust'){const _0x5d143e=document['createElement'](_0x5d613b(0x7bf));_0x5d143e['className']=_0x5d613b(0x41c),_0x5d143e[_0x5d613b(0x2a1)]='✦',_0x17401b[_0x5d613b(0x744)](_0x5d143e);}_0x17401b[_0x5d613b(0x744)](document[_0x5d613b(0x758)](_0x257a2f)),_0x4c3467['appendChild'](_0x17401b);}function animateMusicWidgetLyricLine(_0x5f0e36){const _0x3168de=_0x2a6210,_0x11acbc=getMusicWidgetLyricStageEl();if(!_0x11acbc)return;_0x11acbc['classList'][_0x3168de(0x5e8)](_0x3168de(0x41f)),void _0x11acbc[_0x3168de(0x6e3)],updateMusicWidgetLyricContent(_0x5f0e36),_0x11acbc[_0x3168de(0x2af)][_0x3168de(0x2a8)]('animate');}function updateMusicWidgetLyricStyleList(){const _0x297b8d=_0x2a6210,_0x3660f2=document[_0x297b8d(0x854)](_0x297b8d(0x766));_0x3660f2[_0x297b8d(0x84c)](_0x12dc35=>{const _0x250283=_0x297b8d,_0x282285=_0x12dc35?.['dataset']?.[_0x250283(0x37e)]||'';_0x12dc35[_0x250283(0x2af)][_0x250283(0x18f)](_0x250283(0x763),_0x282285&&_0x282285===musicWidgetLyricStyleActive);});const _0x17bf05=document['getElementById'](_0x297b8d(0x3e3));if(_0x17bf05)_0x17bf05[_0x297b8d(0x2af)][_0x297b8d(0x18f)]('active',!!musicWidgetLyricStyleActive);}function updateMusicWidgetFloatingLyric(_0x3ef9cf=![]){const _0x115dbc=_0x2a6210;if(!musicWidgetLyricStyleActive){setMusicWidgetLyricStageVisibility(![]);return;}const _0x17f9f2=resolveMusicWidgetLyricLine();if(!_0x3ef9cf&&_0x17f9f2[_0x115dbc(0x182)]===musicWidgetLyricLineIndex&&_0x17f9f2[_0x115dbc(0x76c)]===musicWidgetLyricLineText)return;musicWidgetLyricLineIndex=_0x17f9f2['index'],musicWidgetLyricLineText=_0x17f9f2[_0x115dbc(0x76c)];const _0x40b0dc=getMusicWidgetLyricStageEl();if(!_0x40b0dc)return;_0x40b0dc['className']=_0x115dbc(0x3d2)+musicWidgetLyricStyleActive,setMusicWidgetLyricStageVisibility(!![]),animateMusicWidgetLyricLine(_0x17f9f2[_0x115dbc(0x76c)]);}function toggleMusicWidgetLyricStyle(_0x4494fa){const _0x3e8f8a=_0x2a6210;if(Date['now']()<musicWidgetSuppressClickUntil)return;const _0x1f87ac=getMusicWidgetLyricStageEl();if(!_0x1f87ac)return;const _0x283457=String(_0x4494fa||'')[_0x3e8f8a(0x14c)]();if(!_0x283457)return;if(musicWidgetLyricStyleActive===_0x283457){musicWidgetLyricStyleActive='',musicWidgetLyricLineIndex=-0x1,musicWidgetLyricLineText='',_0x1f87ac[_0x3e8f8a(0x337)]=_0x3e8f8a(0x3d2)+_0x283457,_0x1f87ac[_0x3e8f8a(0x2af)][_0x3e8f8a(0x5e8)](_0x3e8f8a(0x41f)),_0x1f87ac[_0x3e8f8a(0x63f)]='<div\x20class=\x22lyric-text\x22></div>',setMusicWidgetLyricStageVisibility(![]),updateMusicWidgetLyricStyleList();return;}musicWidgetLyricStyleActive=_0x283457;const _0x145dc4=resolveMusicWidgetLyricLine();musicWidgetLyricLineIndex=_0x145dc4[_0x3e8f8a(0x182)],musicWidgetLyricLineText=_0x145dc4[_0x3e8f8a(0x76c)],_0x1f87ac[_0x3e8f8a(0x337)]=_0x3e8f8a(0x3d2)+_0x283457,setMusicWidgetLyricStageVisibility(!![]),animateMusicWidgetLyricLine(_0x145dc4[_0x3e8f8a(0x76c)]),updateMusicWidgetLyricStyleList();}function initMusicWidgetDrag(_0x598264,_0x332c8b){const _0x1e0743=_0x2a6210;if(!_0x598264||!_0x332c8b)return;const _0x34b9aa=_0x2875cf=>{const _0x2d86ea=_0x18ea;if(_0x2875cf[_0x2d86ea(0x6fc)]!==undefined&&_0x2875cf[_0x2d86ea(0x6fc)]!==0x0)return;_0x2875cf[_0x2d86ea(0xf0)]();const _0x1d4941=_0x598264[_0x2d86ea(0x17a)]();_0x598264[_0x2d86ea(0x772)][_0x2d86ea(0x1a5)]!=='1'&&(_0x598264['style'][_0x2d86ea(0x396)]=_0x1d4941[_0x2d86ea(0x396)]+'px',_0x598264[_0x2d86ea(0x37e)][_0x2d86ea(0x154)]=_0x1d4941[_0x2d86ea(0x154)]+'px',_0x598264[_0x2d86ea(0x37e)][_0x2d86ea(0x131)]=_0x2d86ea(0x1ea),_0x598264['style'][_0x2d86ea(0x3e5)]=_0x2d86ea(0x1ea),_0x598264[_0x2d86ea(0x772)][_0x2d86ea(0x1a5)]='1');musicWidgetDragState={'pointerId':_0x2875cf[_0x2d86ea(0x413)],'offsetX':_0x2875cf[_0x2d86ea(0x1c6)]-_0x1d4941[_0x2d86ea(0x396)],'offsetY':_0x2875cf[_0x2d86ea(0x375)]-_0x1d4941[_0x2d86ea(0x154)],'width':_0x1d4941['width'],'height':_0x1d4941['height'],'startX':_0x2875cf[_0x2d86ea(0x1c6)],'startY':_0x2875cf[_0x2d86ea(0x375)],'moved':![]};try{_0x332c8b[_0x2d86ea(0x39e)](_0x2875cf[_0x2d86ea(0x413)]);}catch(_0x3bfa27){}},_0x5a09c9=_0x1c6007=>{const _0x14788a=_0x18ea;if(!musicWidgetDragState)return;if(musicWidgetDragState[_0x14788a(0x413)]!==undefined&&_0x1c6007['pointerId']!==musicWidgetDragState[_0x14788a(0x413)])return;const _0xcaafb7=_0x1c6007[_0x14788a(0x1c6)]-musicWidgetDragState[_0x14788a(0x679)],_0x28b28a=_0x1c6007[_0x14788a(0x375)]-musicWidgetDragState['startY'];!musicWidgetDragState[_0x14788a(0x2ce)]&&Math['hypot'](_0xcaafb7,_0x28b28a)>0x3&&(musicWidgetDragState['moved']=!![]);if(!musicWidgetDragState['moved'])return;const _0x5773ff=_0x1c6007[_0x14788a(0x1c6)]-musicWidgetDragState[_0x14788a(0x2b5)],_0x3dda75=_0x1c6007[_0x14788a(0x375)]-musicWidgetDragState[_0x14788a(0x3d0)],_0x57290a=window[_0x14788a(0x688)]-musicWidgetDragState['width'],_0x11930e=window[_0x14788a(0x33f)]-musicWidgetDragState[_0x14788a(0x4e9)],_0x57999b=Math[_0x14788a(0x596)](Math['max'](0x0,_0x5773ff),Math[_0x14788a(0x5b1)](0x0,_0x57290a)),_0x58e029=Math[_0x14788a(0x596)](Math[_0x14788a(0x5b1)](0x0,_0x3dda75),Math[_0x14788a(0x5b1)](0x0,_0x11930e));_0x598264[_0x14788a(0x37e)]['left']=_0x57999b+'px',_0x598264[_0x14788a(0x37e)][_0x14788a(0x154)]=_0x58e029+'px';},_0x26658a=_0x1ebe2b=>{const _0x246178=_0x18ea;if(!musicWidgetDragState)return;if(musicWidgetDragState[_0x246178(0x413)]!==undefined&&_0x1ebe2b['pointerId']!==musicWidgetDragState[_0x246178(0x413)])return;if(musicWidgetDragState[_0x246178(0x2ce)]){musicWidgetSuppressClickUntil=Date['now']()+0xfa;const _0x2b20f3=_0x598264[_0x246178(0x17a)]();applyMusicWidgetOrbPosition({'left':_0x2b20f3[_0x246178(0x396)],'top':_0x2b20f3[_0x246178(0x154)]},{'persist':!![]});}try{_0x332c8b[_0x246178(0xea)](_0x1ebe2b[_0x246178(0x413)]);}catch(_0x463849){}musicWidgetDragState=null;};_0x332c8b[_0x1e0743(0x2f7)](_0x1e0743(0x85e),_0x34b9aa),window['addEventListener'](_0x1e0743(0x83),_0x5a09c9),window['addEventListener']('pointerup',_0x26658a),window[_0x1e0743(0x2f7)](_0x1e0743(0x529),_0x26658a);}function initMusicWidgetLyricDrag(_0x34cc38){const _0x3395c9=_0x2a6210;if(!_0x34cc38||_0x34cc38[_0x3395c9(0x772)]['dragBound']==='1')return;_0x34cc38[_0x3395c9(0x772)][_0x3395c9(0x52f)]='1';const _0x39928b=_0x5051bb=>{const _0x363de9=_0x3395c9;if(_0x5051bb[_0x363de9(0x6fc)]!==undefined&&_0x5051bb[_0x363de9(0x6fc)]!==0x0)return;if(!musicWidgetLyricStyleActive)return;_0x5051bb[_0x363de9(0xf0)]();const _0x4d6ace=_0x34cc38[_0x363de9(0x17a)]();_0x34cc38[_0x363de9(0x772)][_0x363de9(0x1a5)]!=='1'&&(_0x34cc38[_0x363de9(0x37e)][_0x363de9(0x396)]=_0x363de9(0x583),_0x34cc38[_0x363de9(0x37e)][_0x363de9(0x154)]=_0x4d6ace[_0x363de9(0x154)]+'px',_0x34cc38[_0x363de9(0x37e)][_0x363de9(0x131)]=_0x363de9(0x1ea),_0x34cc38[_0x363de9(0x37e)][_0x363de9(0x3e5)]=_0x363de9(0x1ea),_0x34cc38[_0x363de9(0x37e)][_0x363de9(0x61d)]=_0x363de9(0x4c4),_0x34cc38['dataset'][_0x363de9(0x1a5)]='1');musicWidgetLyricDragState={'pointerId':_0x5051bb[_0x363de9(0x413)],'offsetY':_0x5051bb[_0x363de9(0x375)]-_0x4d6ace[_0x363de9(0x154)],'height':_0x4d6ace[_0x363de9(0x4e9)],'startY':_0x5051bb[_0x363de9(0x375)],'moved':![]},_0x34cc38[_0x363de9(0x2af)][_0x363de9(0x2a8)](_0x363de9(0x760));try{_0x34cc38['setPointerCapture'](_0x5051bb[_0x363de9(0x413)]);}catch(_0x28a41e){}},_0x3b48b3=_0x2426d0=>{const _0xf04dbb=_0x3395c9;if(!musicWidgetLyricDragState)return;if(musicWidgetLyricDragState['pointerId']!==undefined&&_0x2426d0[_0xf04dbb(0x413)]!==musicWidgetLyricDragState[_0xf04dbb(0x413)])return;const _0x33721d=_0x2426d0[_0xf04dbb(0x375)]-musicWidgetLyricDragState[_0xf04dbb(0x402)];!musicWidgetLyricDragState['moved']&&Math['abs'](_0x33721d)>0x3&&(musicWidgetLyricDragState[_0xf04dbb(0x2ce)]=!![]);if(!musicWidgetLyricDragState[_0xf04dbb(0x2ce)])return;const _0x408a6a=_0x2426d0[_0xf04dbb(0x375)]-musicWidgetLyricDragState[_0xf04dbb(0x3d0)],_0x3c9252=window['innerHeight']-musicWidgetLyricDragState[_0xf04dbb(0x4e9)],_0x15a8d0=Math[_0xf04dbb(0x596)](Math['max'](0x0,_0x408a6a),Math[_0xf04dbb(0x5b1)](0x0,_0x3c9252));_0x34cc38[_0xf04dbb(0x37e)][_0xf04dbb(0x154)]=_0x15a8d0+'px';},_0x3d7a78=_0x291b8b=>{const _0x554582=_0x3395c9;if(!musicWidgetLyricDragState)return;if(musicWidgetLyricDragState[_0x554582(0x413)]!==undefined&&_0x291b8b[_0x554582(0x413)]!==musicWidgetLyricDragState[_0x554582(0x413)])return;if(musicWidgetLyricDragState[_0x554582(0x2ce)]){musicWidgetSuppressClickUntil=Date[_0x554582(0x344)]()+0xfa;const _0x41b2d3=_0x34cc38[_0x554582(0x17a)]();applyMusicWidgetLyricPosition({'top':_0x41b2d3[_0x554582(0x154)]},{'persist':!![]});}_0x34cc38[_0x554582(0x2af)][_0x554582(0x5e8)]('is-dragging');try{_0x34cc38[_0x554582(0xea)](_0x291b8b['pointerId']);}catch(_0x22c1b2){}musicWidgetLyricDragState=null;};_0x34cc38[_0x3395c9(0x2f7)](_0x3395c9(0x85e),_0x39928b),window['addEventListener'](_0x3395c9(0x83),_0x3b48b3),window['addEventListener'](_0x3395c9(0x6ea),_0x3d7a78),window[_0x3395c9(0x2f7)]('pointercancel',_0x3d7a78);}function togglePanel(){const _0x16cbe1=_0x2a6210;if(Date['now']()<musicWidgetSuppressClickUntil)return;const _0x403e15=document[_0x16cbe1(0x550)](_0x16cbe1(0x329)),_0x135fce=document[_0x16cbe1(0x550)](_0x16cbe1(0x290));if(!_0x403e15||!_0x135fce)return;const _0x1daf16=_0x403e15[_0x16cbe1(0x2af)][_0x16cbe1(0x18f)](_0x16cbe1(0xc3));_0x135fce[_0x16cbe1(0x2af)][_0x16cbe1(0x18f)](_0x16cbe1(0x32f),_0x1daf16);if(!_0x1daf16){const _0x52ff16=document[_0x16cbe1(0x550)](_0x16cbe1(0x273));if(_0x52ff16)_0x52ff16[_0x16cbe1(0x2af)][_0x16cbe1(0x5e8)](_0x16cbe1(0x7cc));const _0x584dd9=getMusicWidgetLyricStyleOverlay();if(_0x584dd9)_0x584dd9[_0x16cbe1(0x2af)][_0x16cbe1(0x5e8)](_0x16cbe1(0x7cc));const _0x3a27ca=getMusicWidgetSkinOverlayEl();if(_0x3a27ca)_0x3a27ca[_0x16cbe1(0x2af)][_0x16cbe1(0x5e8)](_0x16cbe1(0x7cc));}}function togglePlay(){const _0x884c77=_0x2a6210;if(Date['now']()<musicWidgetSuppressClickUntil)return;toggleUserPlaylistPlayback({'actorRole':_0x884c77(0x2c6)});}function musicWidgetPrevSong(){const _0x4aa76b=_0x2a6210;if(Date['now']()<musicWidgetSuppressClickUntil)return;playUserPlaylistPrevSong({'emitSystem':!![],'actorRole':_0x4aa76b(0x2c6),'systemAction':_0x4aa76b(0x4c3)});}function musicWidgetNextSong(){const _0x211ee4=_0x2a6210;if(Date['now']()<musicWidgetSuppressClickUntil)return;playUserPlaylistNextSong({'emitSystem':!![],'actorRole':_0x211ee4(0x2c6),'systemAction':_0x211ee4(0x654)});}async function togglePlaylist(){const _0x57f310=_0x2a6210;if(Date[_0x57f310(0x344)]()<musicWidgetSuppressClickUntil)return;const _0x1bfa01=document[_0x57f310(0x550)]('playlistOverlay');if(!_0x1bfa01)return;const _0x4b41dd=!_0x1bfa01[_0x57f310(0x2af)][_0x57f310(0x353)](_0x57f310(0x7cc));if(!_0x4b41dd){_0x1bfa01[_0x57f310(0x2af)][_0x57f310(0x5e8)]('show');return;}try{await loadUserPlaylistData();}catch(_0x49655c){}const _0x4d591d=getMusicWidgetLyricStyleOverlay();if(_0x4d591d)_0x4d591d['classList']['remove'](_0x57f310(0x7cc));const _0xf23cf1=getMusicWidgetSkinOverlayEl();if(_0xf23cf1)_0xf23cf1[_0x57f310(0x2af)]['remove'](_0x57f310(0x7cc));_0x1bfa01[_0x57f310(0x2af)][_0x57f310(0x2a8)](_0x57f310(0x7cc)),showMusicWidgetSongList(userPlaylistPlaybackIndex);}function toggleLyrics(){const _0x3daa0f=_0x2a6210;if(Date[_0x3daa0f(0x344)]()<musicWidgetSuppressClickUntil)return;const _0x1d5e36=getMusicWidgetLyricStyleOverlay();if(!_0x1d5e36)return;const _0x4d3bfb=!_0x1d5e36[_0x3daa0f(0x2af)]['contains']('show');if(!_0x4d3bfb){_0x1d5e36['classList'][_0x3daa0f(0x5e8)]('show');return;}const _0x5c333a=document[_0x3daa0f(0x550)](_0x3daa0f(0x273));if(_0x5c333a)_0x5c333a[_0x3daa0f(0x2af)][_0x3daa0f(0x5e8)](_0x3daa0f(0x7cc));const _0x34ce82=getMusicWidgetSkinOverlayEl();if(_0x34ce82)_0x34ce82[_0x3daa0f(0x2af)][_0x3daa0f(0x5e8)](_0x3daa0f(0x7cc));_0x1d5e36[_0x3daa0f(0x2af)]['add'](_0x3daa0f(0x7cc)),updateMusicWidgetLyricStyleList();}function shutdownMusicWidgetUI(){const _0x170b5a=_0x2a6210,_0x161e4d=document[_0x170b5a(0x550)](_0x170b5a(0x372));_0x161e4d&&(_0x161e4d[_0x170b5a(0x37e)][_0x170b5a(0x712)]=_0x170b5a(0x22e),_0x161e4d[_0x170b5a(0x37e)][_0x170b5a(0x38f)]=_0x170b5a(0x2ec),_0x161e4d[_0x170b5a(0x37e)][_0x170b5a(0x851)]=_0x170b5a(0x22e));const _0x3ce274=getMusicWidgetLyricStyleOverlay();if(_0x3ce274)_0x3ce274[_0x170b5a(0x2af)][_0x170b5a(0x5e8)](_0x170b5a(0x7cc));const _0x415e84=document[_0x170b5a(0x550)](_0x170b5a(0x273));if(_0x415e84)_0x415e84[_0x170b5a(0x2af)][_0x170b5a(0x5e8)]('show');const _0x21f29c=getMusicWidgetSkinOverlayEl();if(_0x21f29c)_0x21f29c['classList'][_0x170b5a(0x5e8)](_0x170b5a(0x7cc));const _0x3acebd=getMusicWidgetLyricStageEl();_0x3acebd&&(_0x3acebd[_0x170b5a(0x337)]=_0x170b5a(0x351),_0x3acebd['classList']['remove'](_0x170b5a(0x41f)),_0x3acebd['innerHTML']=_0x170b5a(0x61b)),setMusicWidgetLyricStageVisibility(![]),updateMusicWidgetLyricStyleList(),updateMusicWidgetVisibility(![]);}async function confirmExit(){const _0x23e588=_0x2a6210;Date[_0x23e588(0x344)]()<musicWidgetSuppressClickUntil&&(musicWidgetSuppressClickUntil=0x0);const _0x197c5e=normalizeId(currentChatId||window[_0x23e588(0x2dd)]||'');let _0x51f788=null;if(_0x197c5e&&db?.['chats'])try{_0x51f788=await db[_0x23e588(0x37c)][_0x23e588(0x60f)](_0x197c5e);}catch(_0x301c70){_0x51f788=null;}const _0x20074e=_0x51f788?getActiveTogetherInviteContext(_0x51f788):null;if(_0x20074e){const _0xc95c1c=String(_0x20074e[_0x23e588(0x42c)]?.[_0x23e588(0x1e4)]?.['initiatorRole']||'')[_0x23e588(0x14c)]()[_0x23e588(0x5bd)]();await exitTogetherListeningForChat(_0x51f788,{'renderToUI':!![]});_0xc95c1c==='character'&&(musicWidgetForceHidden=!![],musicWidgetLyricStyleActive='',musicWidgetLyricLineIndex=-0x1,musicWidgetLyricLineText='',stopUserPlaylistPlayback({'reset':!![],'force':!![]}),shutdownMusicWidgetUI());return;}musicWidgetForceHidden=!![],musicWidgetLyricStyleActive='',musicWidgetLyricLineIndex=-0x1,musicWidgetLyricLineText='',stopUserPlaylistPlayback({'reset':!![],'force':!![]}),shutdownMusicWidgetUI();}function bindUserPlaylistPlayerControls(){const _0x3de5e1=_0x2a6210;if(userPlaylistPlayerControlsBound)return;const _0x544e3f=document[_0x3de5e1(0x550)](_0x3de5e1(0x643)),_0x5ad5f5=document['getElementById'](_0x3de5e1(0x715)),_0x19084c=document['getElementById'](_0x3de5e1(0x29c));if(!_0x544e3f||!_0x5ad5f5||!_0x19084c)return;initMusicWidgetUI(),_0x544e3f[_0x3de5e1(0x2f7)](_0x3de5e1(0x810),()=>toggleUserPlaylistPlayback({'actorRole':_0x3de5e1(0x2c6)})),_0x5ad5f5[_0x3de5e1(0x2f7)]('click',()=>playUserPlaylistPrevSong({'emitSystem':!![],'actorRole':'user','systemAction':_0x3de5e1(0x4c3)})),_0x19084c[_0x3de5e1(0x2f7)]('click',()=>playUserPlaylistNextSong({'emitSystem':!![],'actorRole':_0x3de5e1(0x2c6),'systemAction':_0x3de5e1(0x654)})),userPlaylistPlayerControlsBound=!![];}function toggleUserPlaylistPlayback(_0x248712={}){const _0x651ba8=_0x2a6210;userPlaylistPlaybackForceStop=![];if(!Array['isArray'](playlists)||playlists['length']===0x0||userPlaylistPlaybackIndex<0x0){showIslandNotification(_0x651ba8(0x612),'请先选择一个歌单用于循环播放','info');return;}refreshUserPlaylistPlaybackSongList();if(userPlaylistPlaybackSongList[_0x651ba8(0x73a)]===0x0){showIslandNotification(_0x651ba8(0x411),'歌单内没有可播放的歌曲',_0x651ba8(0x4fd));return;}const _0x4ebea2=ensureUserPlaylistAudio(),_0x570e63=_0x248712[_0x651ba8(0x179)]==='character'?_0x651ba8(0x450):_0x651ba8(0x2c6);if(userPlaylistPlaybackIsPlaying){_0x4ebea2[_0x651ba8(0x1a9)](),void addTogetherMusicSystemMessageForActiveChat({'chat':_0x248712[_0x651ba8(0x3a4)],'action':_0x651ba8(0x1a9),'actorRole':_0x570e63,'actorName':_0x248712['actorName']});return;}if(hasUserPlaylistAudioSource()){_0x4ebea2[_0x651ba8(0x4d2)]()[_0x651ba8(0x56b)](()=>{const _0x2a5a4a=_0x651ba8;void addTogetherMusicSystemMessageForActiveChat({'chat':_0x248712[_0x2a5a4a(0x3a4)],'action':_0x2a5a4a(0x4d2),'actorRole':_0x570e63,'actorName':_0x248712['actorName']});})[_0x651ba8(0x147)](()=>{const _0x29d947=_0x651ba8;showIslandNotification(_0x29d947(0x439),'无法开始播放','info'),updateUserPlaylistPlayButton(![]);});return;}playUserPlaylistSongAtIndex(userPlaylistPlaybackSongIndex,{'autoplay':!![],'emitSystem':!![],'systemAction':_0x651ba8(0x4d2),'actorRole':_0x570e63,'chat':_0x248712[_0x651ba8(0x3a4)],'actorName':_0x248712['actorName']});}function stopUserPlaylistPlayback(_0x444cf3={}){const _0x315b66=_0x2a6210,{reset:reset=![],force:force=![]}=_0x444cf3;force&&(userPlaylistPlaybackForceStop=!![],userPlaylistPlaybackRequestToken+=0x1);if(userPlaylistPlaybackAudio){userPlaylistPlaybackAudio['pause']();if(reset){userPlaylistPlaybackAudio[_0x315b66(0x3d4)]=0x0;try{userPlaylistPlaybackAudio[_0x315b66(0x31d)](_0x315b66(0x655));}catch(_0x14b0e9){}userPlaylistPlaybackAudio[_0x315b66(0x655)]='',userPlaylistPlaybackAudio['__ovoPlaylistId']='',userPlaylistPlaybackAudio[_0x315b66(0x5bb)]='',userPlaylistPlaybackAudio[_0x315b66(0x47d)]=null,userPlaylistPlaybackAudio['__ovoRetryCount']=0x0;try{userPlaylistPlaybackAudio[_0x315b66(0x6ee)]();}catch(_0x4d4b9f){}}}userPlaylistPlaybackIsPlaying=![],updateUserPlaylistPlayButton(![]),reset&&(updateUserPlaylistProgress(0x0,0x0),updateUserPlaylistSongTitle(''),updateMusicWidgetSongInfo(null),renderUserPlaylistLyrics([]),userPlaylistPlaybackLyrics=[],userPlaylistPlaybackLyricIndex=0x0,userPlaylistPlaybackPendingSwitch=![],userPlaylistPlaybackNowPlaying=null);}function refreshUserPlaylistPlaybackSongList(){const _0x54cb8e=_0x2a6210,_0x2186a9=playlists[userPlaylistPlaybackIndex];if(!_0x2186a9||!Array[_0x54cb8e(0x14f)](_0x2186a9[_0x54cb8e(0x1c8)])){userPlaylistPlaybackSongList=[];return;}userPlaylistPlaybackSongList=_0x2186a9[_0x54cb8e(0x1c8)][_0x54cb8e(0x444)](_0x53726a=>normalizeUserPlaylistPlaybackSong(_0x53726a))[_0x54cb8e(0x34c)](_0x4c4dc2=>_0x4c4dc2&&_0x4c4dc2['id']),userPlaylistPlaybackSongIndex>=userPlaylistPlaybackSongList[_0x54cb8e(0x73a)]&&(userPlaylistPlaybackSongIndex=0x0);}function normalizeUserPlaylistPlaybackSong(_0x3e7a7e){const _0x44be65=_0x2a6210;if(typeof _0x3e7a7e===_0x44be65(0x6b0))return{'name':_0x3e7a7e,'id':'','artist':[],'album':'','source':USER_PLAYLIST_DEFAULT_SONG_SOURCE};if(_0x3e7a7e&&typeof _0x3e7a7e==='object')return{'name':_0x3e7a7e[_0x44be65(0x189)]||_0x3e7a7e[_0x44be65(0x1fa)]||_0x3e7a7e['label']||'Untitled','id':String(_0x3e7a7e['id']||'')['trim'](),'artist':Array['isArray'](_0x3e7a7e['artist'])?_0x3e7a7e[_0x44be65(0x665)]:[],'album':_0x3e7a7e['album']||'','source':_0x3e7a7e['source']||USER_PLAYLIST_DEFAULT_SONG_SOURCE};return null;}function playUserPlaylistNextSong(_0x4cb998={}){const _0x147351=_0x2a6210;refreshUserPlaylistPlaybackSongList();if(userPlaylistPlaybackSongList[_0x147351(0x73a)]===0x0){userPlaylistPlaybackPendingSwitch=![];return;}const _0x50082b=_0x4cb998[_0x147351(0x2e5)]===!![],_0x3e9d89=_0x4cb998['actorRole']===_0x147351(0x450)?'character':_0x147351(0x2c6),_0x503d3b=String(_0x4cb998[_0x147351(0x82e)]||_0x147351(0x654))[_0x147351(0x14c)]()[_0x147351(0x5bd)]()||'next',_0x141373=_0x4cb998[_0x147351(0x3a4)]||null,_0x26c6fb=String(_0x4cb998[_0x147351(0x6c8)]||'')['trim']();if(userPlaylistPlaybackPendingSwitch){playUserPlaylistSongAtIndex(0x0,{'autoplay':!![],'emitSystem':_0x50082b,'systemAction':_0x503d3b,'actorRole':_0x3e9d89,'chat':_0x141373,'systemPlaylistTitle':_0x26c6fb});return;}playUserPlaylistSongAtIndex(userPlaylistPlaybackSongIndex+0x1,{'autoplay':!![],'emitSystem':_0x50082b,'systemAction':_0x503d3b,'actorRole':_0x3e9d89,'chat':_0x141373,'systemPlaylistTitle':_0x26c6fb});}function playUserPlaylistPrevSong(_0x47391f={}){const _0x8f378c=_0x2a6210;refreshUserPlaylistPlaybackSongList();if(userPlaylistPlaybackSongList['length']===0x0){userPlaylistPlaybackPendingSwitch=![];return;}const _0x4534a6=_0x47391f[_0x8f378c(0x2e5)]===!![],_0x484129=_0x47391f[_0x8f378c(0x179)]===_0x8f378c(0x450)?_0x8f378c(0x450):_0x8f378c(0x2c6),_0x2a0108=String(_0x47391f[_0x8f378c(0x82e)]||_0x8f378c(0x4c3))[_0x8f378c(0x14c)]()[_0x8f378c(0x5bd)]()||'prev',_0x23d081=_0x47391f[_0x8f378c(0x3a4)]||null,_0x74bfdc=String(_0x47391f[_0x8f378c(0x6c8)]||'')[_0x8f378c(0x14c)]();if(userPlaylistPlaybackPendingSwitch){playUserPlaylistSongAtIndex(0x0,{'autoplay':!![],'emitSystem':_0x4534a6,'systemAction':_0x2a0108,'actorRole':_0x484129,'chat':_0x23d081,'systemPlaylistTitle':_0x74bfdc});return;}playUserPlaylistSongAtIndex(userPlaylistPlaybackSongIndex-0x1,{'autoplay':!![],'emitSystem':_0x4534a6,'systemAction':_0x2a0108,'actorRole':_0x484129,'chat':_0x23d081,'systemPlaylistTitle':_0x74bfdc});}async function playUserPlaylistSongAtIndex(_0x3075bf,_0x5b8083={}){const _0x33f1aa=_0x2a6210;userPlaylistPlaybackForceStop=![],refreshUserPlaylistPlaybackSongList();if(userPlaylistPlaybackSongList[_0x33f1aa(0x73a)]===0x0)return;const _0xe9bdf3=userPlaylistPlaybackSongList[_0x33f1aa(0x73a)],_0x2d1f7e=(_0x3075bf%_0xe9bdf3+_0xe9bdf3)%_0xe9bdf3,_0xdbe516=userPlaylistPlaybackSongList[_0x2d1f7e];if(!_0xdbe516||!_0xdbe516['id']){showIslandNotification(_0x33f1aa(0x439),_0x33f1aa(0x557),_0x33f1aa(0x4fd));return;}userPlaylistPlaybackSongIndex=_0x2d1f7e,userPlaylistPlaybackPendingSwitch=![],userPlaylistPlaybackNowPlaying={'name':_0xdbe516[_0x33f1aa(0x189)]||'','id':_0xdbe516['id']||'','artist':Array[_0x33f1aa(0x14f)](_0xdbe516[_0x33f1aa(0x665)])?_0xdbe516[_0x33f1aa(0x665)]:[],'album':_0xdbe516['album']||'','source':_0xdbe516['source']||USER_PLAYLIST_DEFAULT_SONG_SOURCE};const _0x5b7530=++userPlaylistPlaybackRequestToken,_0x4b02d6=buildUserPlaylistSongLabel(_0xdbe516);updateUserPlaylistSongTitle(_0x4b02d6),updateMusicWidgetSongInfo(userPlaylistPlaybackNowPlaying),updateUserPlaylistPlayButton(!![]);try{const _0x576f1d=Array[_0x33f1aa(0x14f)](playlists)&&userPlaylistPlaybackIndex>=0x0?playlists[userPlaylistPlaybackIndex]:null,_0x393cd7=String(_0x576f1d?.['id']||'')['trim'](),_0x265f2e=buildUserPlaylistSongKey(_0xdbe516),_0x387e19=await fetchUserPlaylistAudioUrl(_0xdbe516,{'playlistId':_0x393cd7});let _0x1b7c39=[];try{_0x1b7c39=await fetchUserPlaylistLyrics(_0xdbe516,{'playlistId':_0x393cd7});}catch(_0x16f3fe){_0x1b7c39=[];}if(_0x5b7530!==userPlaylistPlaybackRequestToken)return;const _0x56420f=ensureUserPlaylistAudio();_0x56420f[_0x33f1aa(0x655)]=_0x387e19;try{_0x56420f['setAttribute'](_0x33f1aa(0x655),_0x387e19);}catch(_0x394923){}_0x265f2e&&(_0x56420f[_0x33f1aa(0x414)]=_0x393cd7,_0x56420f['__ovoSongKey']=_0x265f2e,_0x56420f[_0x33f1aa(0x47d)]=_0x5b7530,_0x56420f[_0x33f1aa(0x55c)]=0x0);_0x56420f[_0x33f1aa(0x3d4)]=0x0,renderUserPlaylistLyrics(_0x1b7c39),userPlaylistPlaybackLyrics=Array[_0x33f1aa(0x14f)](_0x1b7c39)?_0x1b7c39:[],userPlaylistPlaybackLyricIndex=0x0,updateUserPlaylistLyricHighlight(0x0,!![]);const _0x4afca9=Number(_0x5b8083[_0x33f1aa(0x50f)]),_0x4d14a1=Number(_0x5b8083[_0x33f1aa(0xa3)]);if(Number[_0x33f1aa(0x530)](_0x4afca9)&&_0x4afca9>0x0||Number[_0x33f1aa(0x530)](_0x4d14a1)&&_0x4d14a1>0x0){const _0x6ca271=()=>{const _0x3d282f=_0x33f1aa,_0x457341=Number[_0x3d282f(0x530)](_0x56420f[_0x3d282f(0x198)])?_0x56420f['duration']:0x0;if(_0x457341<=0x0)return;const _0x5f2a23=_0x457341>0x2?_0x457341-0x2:0x0,_0xa88db1=Number['isFinite'](_0x4d14a1)?Math[_0x3d282f(0x5b1)](0x0,Math[_0x3d282f(0x596)](0x1,_0x4d14a1)):0x0,_0x1c207e=_0xa88db1>0x0?_0x457341*_0xa88db1:_0x4afca9,_0x24f502=Math[_0x3d282f(0x5b1)](0x0,Math[_0x3d282f(0x596)](_0x1c207e,_0x5f2a23||_0x1c207e));_0x24f502>0x0&&(_0x56420f['currentTime']=_0x24f502);};_0x56420f[_0x33f1aa(0x5c7)]>=0x1&&Number[_0x33f1aa(0x530)](_0x56420f[_0x33f1aa(0x198)])&&_0x56420f[_0x33f1aa(0x198)]>0x0?_0x6ca271():_0x56420f[_0x33f1aa(0x2f7)]('loadedmetadata',_0x6ca271,{'once':!![]});}if(_0x5b8083[_0x33f1aa(0xae)]!==![]){await _0x56420f[_0x33f1aa(0x4d2)](),userPlaylistPlaybackIsPlaying=!![],updateUserPlaylistPlayButton(!![]);if(_0x5b8083[_0x33f1aa(0x2e5)]===!![]){const _0x3950f3=String(_0x5b8083[_0x33f1aa(0x82e)]||'')[_0x33f1aa(0x14c)]()['toLowerCase']()||_0x33f1aa(0xda),_0x1ec6b3=String(_0x5b8083[_0x33f1aa(0x6c8)]||'')['trim']()||(_0x576f1d?.[_0x33f1aa(0x1fa)]?String(_0x576f1d[_0x33f1aa(0x1fa)]):'');void addTogetherMusicSystemMessageForActiveChat({'chat':_0x5b8083[_0x33f1aa(0x3a4)],'action':_0x3950f3,'actorRole':_0x5b8083[_0x33f1aa(0x179)],'actorName':_0x5b8083[_0x33f1aa(0x663)],'playlistTitle':_0x1ec6b3,'songLabel':_0x4b02d6});}}else userPlaylistPlaybackIsPlaying=![],updateUserPlaylistPlayButton(![]);}catch(_0xa52b4d){if(_0x5b7530!==userPlaylistPlaybackRequestToken)return;console[_0x33f1aa(0x5d9)](_0x33f1aa(0x7a2),_0xa52b4d),showIslandNotification(_0x33f1aa(0x439),_0x33f1aa(0x76d),_0x33f1aa(0x4fd)),userPlaylistPlaybackIsPlaying=![],updateUserPlaylistPlayButton(![]);}}function ensureUserPlaylistAudio(){const _0x2085a9=_0x2a6210;if(userPlaylistPlaybackAudio)return userPlaylistPlaybackAudio;const _0xc0f05f=new Audio();return _0xc0f05f['preload']=_0x2085a9(0x1ea),_0xc0f05f[_0x2085a9(0xe6)]=userPlaylistVolume,_0xc0f05f[_0x2085a9(0x2f7)]('timeupdate',()=>{const _0x333604=_0x2085a9;if(!Number['isFinite'](_0xc0f05f['currentTime']))return;updateUserPlaylistProgress(_0xc0f05f[_0x333604(0x3d4)],_0xc0f05f[_0x333604(0x198)]),syncUserPlaylistLyricsByTime(_0xc0f05f['currentTime']);}),_0xc0f05f[_0x2085a9(0x2f7)]('loadedmetadata',()=>{const _0x41c97b=_0x2085a9;updateUserPlaylistProgress(0x0,_0xc0f05f[_0x41c97b(0x198)]);}),_0xc0f05f['addEventListener'](_0x2085a9(0x42b),()=>{if(userPlaylistPlaybackForceStop)return;playUserPlaylistNextSong({'emitSystem':![]});}),_0xc0f05f[_0x2085a9(0x2f7)](_0x2085a9(0x4d2),()=>{userPlaylistPlaybackIsPlaying=!![],updateUserPlaylistPlayButton(!![]);}),_0xc0f05f['addEventListener']('pause',()=>{userPlaylistPlaybackIsPlaying=![],updateUserPlaylistPlayButton(![]);}),_0xc0f05f[_0x2085a9(0x2f7)]('error',()=>{const _0x300dfe=_0x2085a9;userPlaylistPlaybackIsPlaying=![],updateUserPlaylistPlayButton(![]);if(userPlaylistPlaybackForceStop)return;const _0xd24f13=String(_0xc0f05f[_0x300dfe(0x414)]||'')[_0x300dfe(0x14c)](),_0x302488=String(_0xc0f05f[_0x300dfe(0x5bb)]||'')[_0x300dfe(0x14c)](),_0x39c4f3=_0xc0f05f[_0x300dfe(0x47d)],_0x49d43d=Number(_0xc0f05f['__ovoRetryCount']||0x0);if(_0xd24f13&&_0x302488&&_0x49d43d<0x1&&_0x39c4f3===userPlaylistPlaybackRequestToken){_0xc0f05f['__ovoRetryCount']=_0x49d43d+0x1,void((async()=>{await invalidateUserPlaylistAudioCache(_0xd24f13,_0x302488),await playUserPlaylistSongAtIndex(userPlaylistPlaybackSongIndex,{'autoplay':!![],'retrying':!![]});})());return;}showIslandNotification('播放失败',_0x300dfe(0x765),_0x300dfe(0x4fd));}),userPlaylistPlaybackAudio=_0xc0f05f,_0xc0f05f;}function buildUserPlaylistAudioUrl(_0x14bfa9){const _0x361c5e=_0x2a6210,_0x1dd29f=new URLSearchParams({'types':'url','source':_0x14bfa9[_0x361c5e(0x15b)]||USER_PLAYLIST_DEFAULT_SONG_SOURCE,'id':_0x14bfa9['id'],'br':String(USER_PLAYLIST_AUDIO_BITRATE)});return SONG_SEARCH_API+'?'+_0x1dd29f['toString']();}function buildUserPlaylistLyricUrl(_0x39d06f){const _0x393f31=_0x2a6210,_0x194556=new URLSearchParams({'types':_0x393f31(0x648),'source':_0x39d06f[_0x393f31(0x15b)]||USER_PLAYLIST_DEFAULT_SONG_SOURCE,'id':_0x39d06f['id']});return SONG_SEARCH_API+'?'+_0x194556[_0x393f31(0x1ac)]();}async function fetchUserPlaylistAudioUrl(_0x277062,_0x4f7b4a={}){const _0x12c2fa=_0x2a6210,_0x3a546a=String(_0x4f7b4a[_0x12c2fa(0x384)]||'')[_0x12c2fa(0x14c)]()||_0x12c2fa(0x5a0),_0x127e16=buildUserPlaylistSongKey(_0x277062),_0x475ae7=_0x12c2fa(0x3dc)+_0x3a546a+'|'+_0x127e16,_0x23cbe4=getUserPlaylistMediaCache(_0x475ae7,USER_PLAYLIST_AUDIO_CACHE_TTL);if(_0x23cbe4)return _0x23cbe4;if(!_0x127e16)throw new Error('Invalid\x20song\x20key');const _0x3be3b1=await getUserPlaylistMediaCacheRecord(_0x3a546a,_0x127e16);if(_0x3be3b1?.[_0x12c2fa(0x27a)]&&Number[_0x12c2fa(0x530)](_0x3be3b1['audioUpdatedAt'])){if(Date['now']()-_0x3be3b1[_0x12c2fa(0x6eb)]<=USER_PLAYLIST_AUDIO_CACHE_TTL)return setUserPlaylistMediaCache(_0x475ae7,_0x3be3b1['audioUrl']),_0x3be3b1[_0x12c2fa(0x27a)];}try{const _0x295ff3=buildUserPlaylistAudioUrl(_0x277062),_0x29464c=await fetch(_0x295ff3);if(!_0x29464c['ok'])throw new Error(_0x12c2fa(0x714)+_0x29464c['status']);const _0x4b7833=await _0x29464c[_0x12c2fa(0x470)](),_0x375732=_0x4b7833?.[_0x12c2fa(0x852)]||_0x4b7833?.[_0x12c2fa(0x71b)]?.['url']||_0x4b7833?.['data']?.[0x0]?.[_0x12c2fa(0x852)]||'';if(!_0x375732)throw new Error(_0x12c2fa(0x4c5));return setUserPlaylistMediaCache(_0x475ae7,_0x375732),await saveUserPlaylistMediaCacheRecord({'id':buildUserPlaylistMediaCacheId(_0x3a546a,_0x127e16),'playlistId':_0x3a546a,'songKey':_0x127e16,'songId':String(_0x277062['id']||'')['trim'](),'source':String(_0x277062[_0x12c2fa(0x15b)]||USER_PLAYLIST_DEFAULT_SONG_SOURCE),'name':String(_0x277062['name']||_0x277062['title']||_0x277062[_0x12c2fa(0x352)]||'')[_0x12c2fa(0x14c)](),'artist':Array[_0x12c2fa(0x14f)](_0x277062['artist'])?_0x277062[_0x12c2fa(0x665)]:[],'album':String(_0x277062[_0x12c2fa(0x5b3)]||'')[_0x12c2fa(0x14c)](),'audioUrl':_0x375732,'audioUpdatedAt':Date[_0x12c2fa(0x344)](),'lyricLines':_0x3be3b1?.[_0x12c2fa(0x2d4)]||null,'lyricUpdatedAt':_0x3be3b1?.['lyricUpdatedAt']||null,'updatedAt':Date[_0x12c2fa(0x344)]()}),_0x375732;}catch(_0x2322bc){if(_0x3be3b1?.[_0x12c2fa(0x27a)])return setUserPlaylistMediaCache(_0x475ae7,_0x3be3b1[_0x12c2fa(0x27a)]),_0x3be3b1[_0x12c2fa(0x27a)];throw _0x2322bc;}}async function fetchUserPlaylistLyrics(_0x1ea563,_0x3d4490={}){const _0x24feba=_0x2a6210,_0x525ddb=String(_0x3d4490[_0x24feba(0x384)]||'')['trim']()||'unknown',_0x4bbd66=buildUserPlaylistSongKey(_0x1ea563),_0x253992=_0x24feba(0xb0)+_0x525ddb+'|'+_0x4bbd66,_0x21f15e=getUserPlaylistMediaCache(_0x253992,USER_PLAYLIST_LYRIC_CACHE_TTL);if(_0x21f15e)return _0x21f15e;if(!_0x4bbd66)throw new Error('Invalid\x20song\x20key');const _0x20825d=await getUserPlaylistMediaCacheRecord(_0x525ddb,_0x4bbd66);if(_0x20825d?.[_0x24feba(0x2d4)]&&Number[_0x24feba(0x530)](_0x20825d[_0x24feba(0x1ad)])){if(Date['now']()-_0x20825d['lyricUpdatedAt']<=USER_PLAYLIST_LYRIC_CACHE_TTL)return setUserPlaylistMediaCache(_0x253992,_0x20825d['lyricLines']),_0x20825d[_0x24feba(0x2d4)];}const _0xfec1b2=buildUserPlaylistLyricUrl(_0x1ea563),_0x81fb62=await fetch(_0xfec1b2);if(!_0x81fb62['ok'])throw new Error('HTTP\x20'+_0x81fb62['status']);const _0x24c0ca=await _0x81fb62['json'](),_0x328070=extractUserPlaylistLyricText(_0x24c0ca),_0xb68ff0=parseUserPlaylistLyrics(_0x328070);return setUserPlaylistMediaCache(_0x253992,_0xb68ff0),await saveUserPlaylistMediaCacheRecord({'id':buildUserPlaylistMediaCacheId(_0x525ddb,_0x4bbd66),'playlistId':_0x525ddb,'songKey':_0x4bbd66,'songId':String(_0x1ea563['id']||'')[_0x24feba(0x14c)](),'source':String(_0x1ea563[_0x24feba(0x15b)]||USER_PLAYLIST_DEFAULT_SONG_SOURCE),'name':String(_0x1ea563[_0x24feba(0x189)]||_0x1ea563[_0x24feba(0x1fa)]||_0x1ea563[_0x24feba(0x352)]||'')[_0x24feba(0x14c)](),'artist':Array[_0x24feba(0x14f)](_0x1ea563[_0x24feba(0x665)])?_0x1ea563[_0x24feba(0x665)]:[],'album':String(_0x1ea563['album']||'')[_0x24feba(0x14c)](),'audioUrl':_0x20825d?.['audioUrl']||'','audioUpdatedAt':_0x20825d?.[_0x24feba(0x6eb)]||null,'lyricLines':_0xb68ff0,'lyricUpdatedAt':Date[_0x24feba(0x344)](),'updatedAt':Date[_0x24feba(0x344)]()}),_0xb68ff0;}function extractUserPlaylistLyricText(_0x41af77){const _0x5032a1=_0x2a6210;if(!_0x41af77)return'';if(typeof _0x41af77===_0x5032a1(0x6b0))return _0x41af77;return _0x41af77[_0x5032a1(0x648)]||_0x41af77[_0x5032a1(0x43c)]?.[_0x5032a1(0x648)]||_0x41af77['data']?.[_0x5032a1(0x648)]||_0x41af77['data']?.[_0x5032a1(0x43c)]?.[_0x5032a1(0x648)]||'';}function parseUserPlaylistLyrics(_0x4f8460){const _0x9eb44e=_0x2a6210,_0x18d883=String(_0x4f8460||'')['trim']();if(!_0x18d883)return[];const _0x32ce0e=[],_0x307a41=/\[(\d{1,2}):(\d{1,2})(?:\.(\d{1,3}))?\]/g;_0x18d883[_0x9eb44e(0x581)]('\x0a')[_0x9eb44e(0x84c)](_0x236baf=>{const _0x54cbdb=_0x9eb44e,_0x2f2955=[..._0x236baf['matchAll'](_0x307a41)],_0x3a188a=_0x236baf[_0x54cbdb(0x7a9)](_0x307a41,'')[_0x54cbdb(0x14c)]();if(_0x2f2955[_0x54cbdb(0x73a)]===0x0)return;_0x2f2955[_0x54cbdb(0x84c)](_0x73254c=>{const _0x56a83a=_0x54cbdb,_0x38b499=Number(_0x73254c[0x1]||0x0),_0x4e08fc=Number(_0x73254c[0x2]||0x0),_0x1a8e58=_0x73254c[0x3]?Number('0.'+_0x73254c[0x3]):0x0,_0x7b1042=_0x38b499*0x3c+_0x4e08fc+_0x1a8e58;_0x32ce0e[_0x56a83a(0x2b9)]({'time':_0x7b1042,'text':_0x3a188a||_0x56a83a(0x38c)});});});if(_0x32ce0e['length']===0x0){const _0x4a7253=_0x18d883[_0x9eb44e(0x581)]('\x0a')[_0x9eb44e(0x444)](_0x20d271=>_0x20d271[_0x9eb44e(0x14c)]())[_0x9eb44e(0x34c)](Boolean);return _0x4a7253['map']((_0x3b6e97,_0x2c85e2)=>({'time':_0x2c85e2*0x4,'text':_0x3b6e97}));}return _0x32ce0e['sort']((_0x5e61e8,_0x2e109f)=>_0x5e61e8['time']-_0x2e109f[_0x9eb44e(0x595)]),_0x32ce0e;}function renderUserPlaylistLyrics(_0x2c8f8d){const _0x2a4ccd=_0x2a6210,_0x38e4dc=document[_0x2a4ccd(0x550)](_0x2a4ccd(0x188));if(!_0x38e4dc)return;_0x38e4dc[_0x2a4ccd(0x63f)]='';const _0x13afb4=Array[_0x2a4ccd(0x14f)](_0x2c8f8d)&&_0x2c8f8d[_0x2a4ccd(0x73a)]>0x0?_0x2c8f8d:userPlaylistLyricPool[_0x2a4ccd(0x4c1)](0x0,0x4)[_0x2a4ccd(0x444)]((_0x2d625f,_0x28d94c)=>({'time':_0x28d94c*0x4,'text':_0x2d625f}));_0x13afb4[_0x2a4ccd(0x84c)]((_0x39dd45,_0x181d4d)=>{const _0x4d1a1e=_0x2a4ccd,_0x1fe04c=document[_0x4d1a1e(0x24b)](_0x4d1a1e(0x5ab));_0x1fe04c[_0x4d1a1e(0x337)]=_0x4d1a1e(0x4ae),_0x1fe04c[_0x4d1a1e(0x2a1)]=_0x39dd45[_0x4d1a1e(0x76c)]||_0x4d1a1e(0x38c);if(_0x181d4d===0x0)_0x1fe04c[_0x4d1a1e(0x2af)][_0x4d1a1e(0x2a8)](_0x4d1a1e(0x763));_0x38e4dc[_0x4d1a1e(0x744)](_0x1fe04c);}),_0x38e4dc[_0x2a4ccd(0x37e)]['transform']=_0x2a4ccd(0x569);}function updateUserPlaylistLyricHighlight(_0x31fd71,_0x40c9d5=![]){const _0x25f74c=_0x2a6210,_0x8fee76=document[_0x25f74c(0x550)](_0x25f74c(0x188)),_0x341c62=_0x8fee76?Array[_0x25f74c(0x576)](_0x8fee76[_0x25f74c(0x854)]('.lyrics-line')):[],_0x232458=_0x341c62[_0x25f74c(0x73a)]>0x0?_0x341c62['length']:Array[_0x25f74c(0x14f)](userPlaylistPlaybackLyrics)?userPlaylistPlaybackLyrics[_0x25f74c(0x73a)]:0x0;if(_0x232458===0x0){const _0x4a4165=Number['isFinite'](_0x31fd71)?Math[_0x25f74c(0x5b1)](0x0,Math[_0x25f74c(0x5b7)](_0x31fd71)):0x0;userPlaylistPlaybackLyricIndex=_0x4a4165,updateMusicWidgetFloatingLyric(_0x40c9d5);return;}const _0x9986b4=Math[_0x25f74c(0x5b1)](0x0,Math[_0x25f74c(0x596)](_0x31fd71,_0x232458-0x1));if(!_0x40c9d5&&_0x9986b4===userPlaylistPlaybackLyricIndex)return;_0x341c62['forEach']((_0x19405c,_0x230225)=>{const _0x44f531=_0x25f74c;_0x19405c[_0x44f531(0x2af)]['toggle'](_0x44f531(0x763),_0x230225===_0x9986b4);});const _0x15e2e9=0x1a,_0x197e69=_0x8fee76&&_0x8fee76['parentElement']?_0x8fee76['parentElement']['clientHeight']:0x4e,_0x24243d=Math['max'](0x0,_0x9986b4*_0x15e2e9-(_0x197e69/0x2-_0x15e2e9/0x2));if(_0x8fee76)_0x8fee76[_0x25f74c(0x37e)]['transform']=_0x25f74c(0x5d5)+_0x24243d+'px)';userPlaylistPlaybackLyricIndex=_0x9986b4,updateMusicWidgetFloatingLyric(_0x40c9d5);}function syncUserPlaylistLyricsByTime(_0x45fac2){const _0x1aeb78=_0x2a6210;if(!Array[_0x1aeb78(0x14f)](userPlaylistPlaybackLyrics)||userPlaylistPlaybackLyrics[_0x1aeb78(0x73a)]===0x0)return;if(!Number[_0x1aeb78(0x530)](_0x45fac2))return;let _0x3a0003=userPlaylistPlaybackLyricIndex;while(_0x3a0003<userPlaylistPlaybackLyrics['length']-0x1&&_0x45fac2>=userPlaylistPlaybackLyrics[_0x3a0003+0x1][_0x1aeb78(0x595)]-0.05){_0x3a0003+=0x1;}while(_0x3a0003>0x0&&_0x45fac2<userPlaylistPlaybackLyrics[_0x3a0003][_0x1aeb78(0x595)]){_0x3a0003-=0x1;}updateUserPlaylistLyricHighlight(_0x3a0003);}function updateUserPlaylistPlayButton(_0x45425d){const _0x3f8212=_0x2a6210;initMusicWidgetUI(),updateMusicWidgetVisibility(!!_0x45425d),updateMusicWidgetPlaybackState(!!_0x45425d),updateMusicWidgetSongInfo(userPlaylistPlaybackNowPlaying);const _0x398cd5=document['getElementById'](_0x3f8212(0x643));if(!_0x398cd5)return;const _0x2e3fcd='<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M6\x204l12\x208-12\x208V4z\x22/></svg>',_0x5fe849=_0x3f8212(0x2e6);_0x398cd5['innerHTML']=_0x45425d?_0x5fe849:_0x2e3fcd,_0x398cd5[_0x3f8212(0x772)][_0x3f8212(0x6d6)]=_0x45425d?'pause':'play',_0x398cd5[_0x3f8212(0xf8)](_0x3f8212(0x64e),_0x45425d?_0x3f8212(0x13f):_0x3f8212(0x28a));}function updateUserPlaylistSongTitle(_0x1f6953){const _0x5b1aa7=_0x2a6210,_0x2a49b7=document[_0x5b1aa7(0x550)](_0x5b1aa7(0x66e));if(!_0x2a49b7)return;_0x2a49b7[_0x5b1aa7(0x2a1)]=_0x1f6953||'\x20';}function updateUserPlaylistProgress(_0x16ddef,_0x39d21f){const _0x37bb7e=_0x2a6210,_0x10b75b=document[_0x37bb7e(0x550)](_0x37bb7e(0x568)),_0x5d89ed=document[_0x37bb7e(0x550)](_0x37bb7e(0x7d2)),_0x3336dd=document[_0x37bb7e(0x550)](_0x37bb7e(0x135)),_0x312680=Number[_0x37bb7e(0x530)](_0x39d21f)&&_0x39d21f>0x0?_0x39d21f:0x0,_0x330eaa=Number[_0x37bb7e(0x530)](_0x16ddef)&&_0x16ddef>0x0?_0x16ddef:0x0,_0x368719=_0x312680?Math[_0x37bb7e(0x596)](_0x330eaa/_0x312680,0x1):0x0,_0x189642=_0x312680?Math[_0x37bb7e(0x5b1)](_0x312680-_0x330eaa,0x0):0x0;if(_0x10b75b)_0x10b75b[_0x37bb7e(0x2a1)]=formatUserPlaylistTime(_0x330eaa);if(_0x5d89ed)_0x5d89ed[_0x37bb7e(0x2a1)]='-'+formatUserPlaylistTime(_0x189642);if(_0x3336dd)_0x3336dd['style'][_0x37bb7e(0x2fc)]=(_0x368719*0x64)['toFixed'](0x2)+'%';}function formatUserPlaylistTime(_0x59e6db){const _0x332576=_0x2a6210,_0x181340=Number[_0x332576(0x530)](_0x59e6db)?Math['floor'](_0x59e6db):0x0,_0x39172b=Math['floor'](_0x181340/0x3c),_0x52a710=_0x181340%0x3c;return _0x39172b+':'+String(_0x52a710)[_0x332576(0x6a6)](0x2,'0');}function bindUserPlaylistVolumeControl(){const _0x30846d=_0x2a6210;if(userPlaylistVolumeBound)return;const _0x2a5d8e=document[_0x30846d(0x2ba)](_0x30846d(0x5cb)),_0x3bae4b=_0x2a5d8e?_0x2a5d8e[_0x30846d(0x2ba)]('.vol-track'):null;if(!_0x2a5d8e||!_0x3bae4b)return;const _0x2bbd64=_0x2db98f=>{const _0xf131af=_0x30846d,_0xb3f1c8=_0x3bae4b[_0xf131af(0x17a)]();if(!_0xb3f1c8[_0xf131af(0x2fc)])return;const _0x1e06f5=(_0x2db98f-_0xb3f1c8[_0xf131af(0x396)])/_0xb3f1c8[_0xf131af(0x2fc)];setUserPlaylistVolume(_0x1e06f5);},_0x18e297=()=>{const _0x58c450=_0x30846d;_0x2a5d8e[_0x58c450(0x2af)][_0x58c450(0x5e8)](_0x58c450(0x7ea)),window[_0x58c450(0x2a2)](_0x58c450(0x83),_0x3218c2),window[_0x58c450(0x2a2)](_0x58c450(0x6ea),_0x2cfeac);},_0x3218c2=_0x1d5a79=>{const _0x47c0c0=_0x30846d;(_0x1d5a79[_0x47c0c0(0x468)]===_0x47c0c0(0x590)||_0x1d5a79[_0x47c0c0(0x468)]===_0x47c0c0(0x784)||_0x1d5a79[_0x47c0c0(0x468)]===_0x47c0c0(0x213))&&_0x2bbd64(_0x1d5a79['clientX']);},_0x2cfeac=()=>_0x18e297();_0x3bae4b[_0x30846d(0x2f7)](_0x30846d(0x85e),_0x106a3f=>{const _0x3cb64c=_0x30846d;_0x106a3f[_0x3cb64c(0xf0)](),_0x2a5d8e[_0x3cb64c(0x2af)][_0x3cb64c(0x2a8)]('is-adjusting'),_0x2bbd64(_0x106a3f[_0x3cb64c(0x1c6)]),window[_0x3cb64c(0x2f7)](_0x3cb64c(0x83),_0x3218c2),window[_0x3cb64c(0x2f7)]('pointerup',_0x2cfeac,{'once':!![]});}),userPlaylistVolumeBound=!![];}function loadUserPlaylistVolume(){const _0x4e0923=_0x2a6210;let _0x14eb72=0.5;try{const _0xe3c0d6=localStorage[_0x4e0923(0x401)](USER_PLAYLIST_VOLUME_KEY),_0x2d3354=Number[_0x4e0923(0x740)](_0xe3c0d6);if(Number[_0x4e0923(0x530)](_0x2d3354))_0x14eb72=_0x2d3354;}catch(_0x3af3d2){}setUserPlaylistVolume(_0x14eb72,{'persist':![]});}function setUserPlaylistVolume(_0x30dd71,_0x513a10={}){const _0x4c554a=_0x2a6210,{persist:persist=!![]}=_0x513a10,_0x395584=Math[_0x4c554a(0x5b1)](0x0,Math[_0x4c554a(0x596)](0x1,Number[_0x4c554a(0x530)](_0x30dd71)?_0x30dd71:0x0));userPlaylistVolume=_0x395584;userPlaylistPlaybackAudio&&(userPlaylistPlaybackAudio[_0x4c554a(0xe6)]=_0x395584);const _0x16e9de=document[_0x4c554a(0x2ba)](_0x4c554a(0x5cb)),_0xc6eaa2=_0x16e9de?_0x16e9de[_0x4c554a(0x2ba)](_0x4c554a(0x47f)):null;_0xc6eaa2&&(_0xc6eaa2[_0x4c554a(0x37e)][_0x4c554a(0x2fc)]=(_0x395584*0x64)[_0x4c554a(0x252)](0x2)+'%');_0x16e9de&&_0x16e9de[_0x4c554a(0x2af)]['toggle']('is-muted',_0x395584<=0.01);if(persist)try{localStorage[_0x4c554a(0x21c)](USER_PLAYLIST_VOLUME_KEY,String(_0x395584));}catch(_0xd383ff){}}const SONG_SEARCH_API=_0x2a6210(0x390),SONG_SEARCH_SOURCE='netease',SONG_SEARCH_COUNT=0xa,SONG_SEARCH_PAGE=0x1,SONG_SEARCH_CACHE_TTL=0x5*0x3c*0x3e8,SONG_SEARCH_MIN_INTERVAL=0x15e,songSearchCache=new Map();let songSearchLastRequestAt=0x0;function initSongSearchUI(){const _0x4fb21a=_0x2a6210,_0x3afa4d=document[_0x4fb21a(0x550)]('newSongInput'),_0x16fa83=document[_0x4fb21a(0x550)](_0x4fb21a(0x17d)),_0x233abc=document['getElementById'](_0x4fb21a(0x2c0));if(!_0x3afa4d||!_0x16fa83||!_0x233abc)return;_0x16fa83[_0x4fb21a(0x2af)][_0x4fb21a(0x5e8)](_0x4fb21a(0x616)),_0x233abc[_0x4fb21a(0x63f)]='',_0x3afa4d[_0x4fb21a(0x23f)]=_0x2dc4b5=>{const _0x190641=_0x4fb21a;_0x2dc4b5[_0x190641(0x571)]===_0x190641(0x53b)&&(_0x2dc4b5[_0x190641(0xf0)](),triggerSongSearch());};}function getSongSearchCache(_0x3ce5a5){const _0x1948af=_0x2a6210,_0x58d446=songSearchCache[_0x1948af(0x60f)](_0x3ce5a5);if(!_0x58d446)return null;if(Date['now']()-_0x58d446['ts']>SONG_SEARCH_CACHE_TTL)return songSearchCache[_0x1948af(0xfc)](_0x3ce5a5),null;return _0x58d446['data'];}function setSongSearchCache(_0x44e401,_0x23191e){songSearchCache['set'](_0x44e401,{'ts':Date['now'](),'data':_0x23191e});}function buildSongSearchUrl(_0x4a3cff){const _0x4692e6=_0x2a6210,_0x60457e=new URLSearchParams({'types':_0x4692e6(0x838),'source':SONG_SEARCH_SOURCE,'name':_0x4a3cff,'count':String(SONG_SEARCH_COUNT),'pages':String(SONG_SEARCH_PAGE)});return SONG_SEARCH_API+'?'+_0x60457e['toString']();}async function songSearchThrottle(){const _0x2ecd19=_0x2a6210,_0x5e8755=Date[_0x2ecd19(0x344)](),_0x72b923=SONG_SEARCH_MIN_INTERVAL-(_0x5e8755-songSearchLastRequestAt);_0x72b923>0x0&&await new Promise(_0x4dedb8=>setTimeout(_0x4dedb8,_0x72b923)),songSearchLastRequestAt=Date[_0x2ecd19(0x344)]();}async function fetchSongSearch(_0x44e810){const _0x2ca2fe=_0x2a6210,_0x33be8d=SONG_SEARCH_SOURCE+'|'+_0x44e810[_0x2ca2fe(0x5bd)](),_0x5b64c5=getSongSearchCache(_0x33be8d);if(_0x5b64c5)return _0x5b64c5;await songSearchThrottle();const _0x429657=buildSongSearchUrl(_0x44e810),_0x48b3af=await fetch(_0x429657);if(!_0x48b3af['ok'])throw new Error(_0x2ca2fe(0x714)+_0x48b3af['status']);const _0x477e13=await _0x48b3af['json'](),_0x4edf56=Array[_0x2ca2fe(0x14f)](_0x477e13)?_0x477e13:[];return setSongSearchCache(_0x33be8d,_0x4edf56),_0x4edf56;}function renderSongSearchResults(_0x1ce93e){const _0x3fada7=_0x2a6210,_0x1d9123=document[_0x3fada7(0x550)]('songSearchPanel'),_0x515413=document[_0x3fada7(0x550)](_0x3fada7(0x2c0));if(!_0x1d9123||!_0x515413)return;_0x515413[_0x3fada7(0x63f)]='';if(!Array[_0x3fada7(0x14f)](_0x1ce93e)||_0x1ce93e[_0x3fada7(0x73a)]===0x0){const _0x351267=document[_0x3fada7(0x24b)](_0x3fada7(0x5ab));_0x351267[_0x3fada7(0x337)]=_0x3fada7(0x5d0),_0x351267[_0x3fada7(0x2a1)]=_0x3fada7(0x787),_0x515413['appendChild'](_0x351267),_0x1d9123[_0x3fada7(0x2af)][_0x3fada7(0x2a8)](_0x3fada7(0x616));return;}_0x1ce93e[_0x3fada7(0x84c)](_0x546f0d=>{const _0x218aa1=_0x3fada7;if(!_0x546f0d||!_0x546f0d['id'])return;const _0x92d02f=_0x546f0d[_0x218aa1(0x189)]||_0x218aa1(0x4e6),_0x1eab5e=Array[_0x218aa1(0x14f)](_0x546f0d[_0x218aa1(0x665)])?_0x546f0d[_0x218aa1(0x665)][_0x218aa1(0x469)](_0x218aa1(0x6e2)):'',_0x5cb25d=_0x546f0d['album']||'',_0x5e4f54=[];if(_0x1eab5e)_0x5e4f54[_0x218aa1(0x2b9)](_0x1eab5e);if(_0x5cb25d)_0x5e4f54[_0x218aa1(0x2b9)](_0x5cb25d);_0x5e4f54[_0x218aa1(0x2b9)](_0x218aa1(0x29e)+_0x546f0d['id']);const _0x499689=document['createElement'](_0x218aa1(0x6fc));_0x499689['type']=_0x218aa1(0x6fc),_0x499689[_0x218aa1(0x337)]=_0x218aa1(0x13a),_0x499689[_0x218aa1(0x63f)]=_0x218aa1(0x38b)+escapeHtml(_0x92d02f)+_0x218aa1(0x3a8)+escapeHtml(_0x5e4f54['join']('\x20·\x20'))+_0x218aa1(0x112),_0x499689[_0x218aa1(0x2f7)]('click',()=>addSongFromSearch(_0x546f0d)),_0x515413[_0x218aa1(0x744)](_0x499689);}),_0x1d9123[_0x3fada7(0x2af)]['add'](_0x3fada7(0x616));}function addSongFromSearch(_0x3fe042){const _0x5ee712=_0x2a6210;if(userPlaylistCurrentIndex===-0x1)return;const _0x1a53dc={'name':_0x3fe042[_0x5ee712(0x189)]||'Untitled','id':String(_0x3fe042['id']||'')[_0x5ee712(0x14c)](),'artist':Array[_0x5ee712(0x14f)](_0x3fe042['artist'])?_0x3fe042[_0x5ee712(0x665)]:[],'album':_0x3fe042[_0x5ee712(0x5b3)]||'','source':_0x3fe042[_0x5ee712(0x15b)]||USER_PLAYLIST_DEFAULT_SONG_SOURCE};playlists[userPlaylistCurrentIndex][_0x5ee712(0x1c8)][_0x5ee712(0x2b9)](_0x1a53dc),renderSongs(playlists[userPlaylistCurrentIndex][_0x5ee712(0x1c8)]),saveUserPlaylistData();}async function triggerSongSearch(){const _0x305bdb=_0x2a6210,_0x2911fd=document[_0x305bdb(0x550)](_0x305bdb(0x56f));if(!_0x2911fd)return;const _0x5d9fd5=_0x2911fd[_0x305bdb(0x4cf)][_0x305bdb(0x14c)]();if(!_0x5d9fd5)return;showIslandNotification(_0x305bdb(0x2d7),_0x305bdb(0x572),_0x305bdb(0x4fd));try{const _0xe1082b=await fetchSongSearch(_0x5d9fd5);renderSongSearchResults(_0xe1082b);}catch(_0xb238e6){console[_0x305bdb(0x5d9)](_0x305bdb(0x28b),_0xb238e6),renderSongSearchResults([]);}}function escapeHtml(_0xac7f9d){const _0x555883=_0x2a6210;return String(_0xac7f9d)[_0x555883(0x7a9)](/&/g,_0x555883(0x4fe))[_0x555883(0x7a9)](/</g,_0x555883(0x821))[_0x555883(0x7a9)](/>/g,_0x555883(0x676))[_0x555883(0x7a9)](/"/g,_0x555883(0x137))[_0x555883(0x7a9)](/'/g,'&#39;');}function renderSongs(_0x51c620){const _0xcf1cc7=_0x2a6210,_0x54841a=document['getElementById']('songListContainer');if(!_0x54841a)return;const _0x3e8c68=_0x54841a[_0xcf1cc7(0x2ba)](_0xcf1cc7(0x79b));_0x54841a[_0xcf1cc7(0x63f)]='';if(_0x3e8c68)_0x54841a[_0xcf1cc7(0x744)](_0x3e8c68);_0x51c620[_0xcf1cc7(0x84c)]((_0x26307b,_0x107041)=>{const _0x3e85d5=_0xcf1cc7,_0x1e9fb6=document[_0x3e85d5(0x24b)]('div');_0x1e9fb6[_0x3e85d5(0x337)]=_0x3e85d5(0x6ac),_0x1e9fb6[_0x3e85d5(0x37e)][_0x3e85d5(0x45e)]=_0x107041*0.1+'s';const _0xc2e53b=buildUserPlaylistSongLabel(_0x26307b);_0x1e9fb6[_0x3e85d5(0x63f)]=_0x3e85d5(0x4b1)+escapeHtml(_0xc2e53b)+_0x3e85d5(0x6b1)+_0x107041+_0x3e85d5(0x70b),_0x54841a[_0x3e85d5(0x744)](_0x1e9fb6);}),userPlaylistCurrentIndex===userPlaylistPlaybackIndex&&refreshUserPlaylistPlaybackSongList();}function buildUserPlaylistSongLabel(_0x451574){const _0x1fbed4=_0x2a6210;if(typeof _0x451574===_0x1fbed4(0x6b0))return _0x451574;if(_0x451574&&typeof _0x451574===_0x1fbed4(0x18e)){const _0x45c6c2=_0x451574['name']||_0x451574[_0x1fbed4(0x1fa)]||_0x451574[_0x1fbed4(0x352)]||'',_0xa20e87=Array[_0x1fbed4(0x14f)](_0x451574[_0x1fbed4(0x665)])?_0x451574['artist'][_0x1fbed4(0x469)](_0x1fbed4(0x6e2)):'';if(_0x45c6c2&&_0xa20e87)return _0x45c6c2+_0x1fbed4(0x1da)+_0xa20e87;return _0x45c6c2||_0xa20e87||_0x1fbed4(0x4e6);}return'Untitled';}function normalizeUserPlaylistSongForCache(_0x158030){const _0x4cfa2c=_0x2a6210;if(typeof _0x158030===_0x4cfa2c(0x6b0)){const _0x537233=_0x158030[_0x4cfa2c(0x14c)]();return _0x537233?{'name':_0x537233,'source':USER_PLAYLIST_DEFAULT_SONG_SOURCE}:null;}if(_0x158030&&typeof _0x158030===_0x4cfa2c(0x18e))return{'name':_0x158030[_0x4cfa2c(0x189)]||_0x158030['title']||_0x158030[_0x4cfa2c(0x352)]||'','id':String(_0x158030['id']||'')['trim'](),'artist':Array[_0x4cfa2c(0x14f)](_0x158030['artist'])?_0x158030[_0x4cfa2c(0x665)]:[],'album':_0x158030[_0x4cfa2c(0x5b3)]||'','source':_0x158030[_0x4cfa2c(0x15b)]||USER_PLAYLIST_DEFAULT_SONG_SOURCE};return null;}function removePlaylistMediaCacheForSong(_0xe49250,_0xfde27a){const _0x397bd0=_0x2a6210,_0x11d36f=String(_0xe49250?.['id']||'')['trim']();if(!_0x11d36f)return;const _0x4799d0=normalizeUserPlaylistSongForCache(_0xfde27a);if(!_0x4799d0)return;const _0x5aca84=buildUserPlaylistSongKey(_0x4799d0);if(!_0x5aca84)return;userPlaylistMediaCache[_0x397bd0(0xfc)](_0x397bd0(0x3dc)+_0x11d36f+'|'+_0x5aca84),userPlaylistMediaCache[_0x397bd0(0xfc)](_0x397bd0(0xb0)+_0x11d36f+'|'+_0x5aca84),void deleteUserPlaylistMediaCacheRecord(_0x11d36f,_0x5aca84);}function clearPlaylistMediaCache(_0x552861){const _0x30dc71=_0x2a6210,_0x37329f=String(_0x552861||'')['trim']();if(!_0x37329f)return;for(const _0x16b018 of userPlaylistMediaCache[_0x30dc71(0x186)]()){_0x16b018[_0x30dc71(0x3a6)]('|'+_0x37329f+'|')&&userPlaylistMediaCache[_0x30dc71(0xfc)](_0x16b018);}void deleteUserPlaylistMediaCacheByPlaylist(_0x37329f);}function addSong(){const _0x45a128=_0x2a6210,_0x291948=document[_0x45a128(0x550)](_0x45a128(0x56f)),_0x3df793=_0x291948?_0x291948[_0x45a128(0x4cf)][_0x45a128(0x14c)]():'';if(_0x3df793&&userPlaylistCurrentIndex!==-0x1){playlists[userPlaylistCurrentIndex]['songs']['push'](_0x3df793),renderSongs(playlists[userPlaylistCurrentIndex][_0x45a128(0x1c8)]),saveUserPlaylistData();if(_0x291948)_0x291948[_0x45a128(0x4cf)]='';}}function removeSong(_0x26e8df){const _0x52dd2d=_0x2a6210;if(userPlaylistCurrentIndex!==-0x1){const _0x10416c=playlists[userPlaylistCurrentIndex];if(_0x10416c&&Array[_0x52dd2d(0x14f)](_0x10416c[_0x52dd2d(0x1c8)])){const _0x2231df=_0x10416c[_0x52dd2d(0x1c8)][_0x26e8df];removePlaylistMediaCacheForSong(_0x10416c,_0x2231df),_0x10416c['songs'][_0x52dd2d(0x3b7)](_0x26e8df,0x1),renderSongs(_0x10416c[_0x52dd2d(0x1c8)]);}saveUserPlaylistData(),userPlaylistCurrentIndex===userPlaylistPlaybackIndex&&userPlaylistPlaybackSongList[_0x52dd2d(0x73a)]===0x0&&stopUserPlaylistPlayback({'reset':!![]});}}function deletePlaylist(){if(confirm('Tear\x20this\x20page\x20from\x20the\x20book?')){const _0x2617c8=userPlaylistCurrentIndex,_0xc0dbd0=playlists[_0x2617c8];_0xc0dbd0?.['id']&&clearPlaylistMediaCache(_0xc0dbd0['id']);playlists['splice'](_0x2617c8,0x1);if(userPlaylistPlaybackIndex===_0x2617c8)userPlaylistPlaybackIndex=-0x1,persistUserPlaylistPlaybackIndex(),stopUserPlaylistPlayback({'reset':!![]});else userPlaylistPlaybackIndex>_0x2617c8&&(userPlaylistPlaybackIndex-=0x1,persistUserPlaylistPlaybackIndex());initUserPlaylistNodes(),applyUserPlaylistPlaybackHighlight(),closeUserPlaylistOverlay(),saveUserPlaylistData();}}function animateUserPlaylistRain(){const _0x5d0931=_0x2a6210;if(userPlaylistActiveMode!=='song'||!userPlaylistOverlayCtx)return;userPlaylistOverlayCtx['clearRect'](0x0,0x0,userPlaylistWidth,userPlaylistHeight);const _0x33806e=document[_0x5d0931(0x3e4)][_0x5d0931(0x455)](_0x5d0931(0x3e6))===_0x5d0931(0x5f6);userPlaylistOverlayCtx['fillStyle']=_0x33806e?_0x5d0931(0x61a):_0x5d0931(0x3ac);for(let _0x2b9a77=0x0;_0x2b9a77<0x5;_0x2b9a77++){const _0x3b7ca6=Math[_0x5d0931(0x658)]()*userPlaylistWidth,_0x4e53f6=Math[_0x5d0931(0x658)]()*userPlaylistHeight,_0x2cdf0e=Math['random']()*0x32+0x14;userPlaylistOverlayCtx[_0x5d0931(0x48c)](_0x3b7ca6,_0x4e53f6,0x1,_0x2cdf0e);}userPlaylistOverlayAnimationId=requestAnimationFrame(animateUserPlaylistRain);}if(document[_0x2a6210(0x5c7)]===_0x2a6210(0x822))document['addEventListener']('DOMContentLoaded',()=>{document['getElementById']('userPlaylistView')&&initUserPlaylistPage();},{'once':!![]});else document[_0x2a6210(0x550)](_0x2a6210(0x720))&&initUserPlaylistPage();const FIXED_ALBUMS=[{'cover':'https://i.postimg.cc/fbFPR0JD/d2d8bda1c8b18ba3586e26243c33b240.jpg','label':_0x2a6210(0x2b1)},{'cover':_0x2a6210(0x314),'label':_0x2a6210(0x2aa)},{'cover':_0x2a6210(0x4c9),'label':'STORIES'},{'cover':_0x2a6210(0x7d),'label':'DREAMS'}];function extractDominantColor(_0x283850){return new Promise((_0xfc62ad,_0x2478bb)=>{const _0x2a42cb=_0x18ea;try{const _0x55f032=document[_0x2a42cb(0x24b)]('canvas'),_0x1ef91a=_0x55f032[_0x2a42cb(0x846)]('2d');_0x55f032[_0x2a42cb(0x2fc)]=0x32,_0x55f032[_0x2a42cb(0x4e9)]=0x32,_0x1ef91a[_0x2a42cb(0x547)](_0x283850,0x0,0x0,0x32,0x32);const _0x3a31bc=_0x1ef91a[_0x2a42cb(0x49a)](0x0,0x0,0x32,0x32),_0x36f199=_0x3a31bc['data'];let _0x106e3a=0x0,_0x17630d=0x0,_0xab20cb=0x0,_0x1c198d=0x0;for(let _0x5796e8=0x0;_0x5796e8<_0x36f199['length'];_0x5796e8+=0x10){const _0x28327f=_0x36f199[_0x5796e8],_0x3b5cf5=_0x36f199[_0x5796e8+0x1],_0x1771b8=_0x36f199[_0x5796e8+0x2],_0x117511=_0x36f199[_0x5796e8+0x3];if(_0x117511<0x7d)continue;const _0x1b594e=(_0x28327f+_0x3b5cf5+_0x1771b8)/0x3;if(_0x1b594e<0x14||_0x1b594e>0xeb)continue;_0x106e3a+=_0x28327f,_0x17630d+=_0x3b5cf5,_0xab20cb+=_0x1771b8,_0x1c198d++;}if(_0x1c198d===0x0){_0xfc62ad({'r':0x64,'g':0x64,'b':0x78});return;}_0x106e3a=Math[_0x2a42cb(0x272)](_0x106e3a/_0x1c198d),_0x17630d=Math[_0x2a42cb(0x272)](_0x17630d/_0x1c198d),_0xab20cb=Math[_0x2a42cb(0x272)](_0xab20cb/_0x1c198d);const _0x5c8395=rgbToHsl(_0x106e3a,_0x17630d,_0xab20cb);_0x5c8395['s']=Math['min'](_0x5c8395['s']*0.7,0.5);_0x5c8395['l']>0.5?_0x5c8395['l']=Math[_0x2a42cb(0x5b1)](0.8,Math[_0x2a42cb(0x596)](_0x5c8395['l']*0.9,0.95)):_0x5c8395['l']=Math[_0x2a42cb(0x5b1)](0.2,Math[_0x2a42cb(0x596)](_0x5c8395['l']*1.2,0.4));const _0x328471=hslToRgb(_0x5c8395['h'],_0x5c8395['s'],_0x5c8395['l']);_0xfc62ad(_0x328471);}catch(_0x9dcc7e){console[_0x2a42cb(0x5d9)](_0x2a42cb(0x5f4),_0x9dcc7e),_0xfc62ad({'r':0x64,'g':0x64,'b':0x78});}});}function rgbToHsl(_0x334c78,_0x3196ba,_0x1aa4bb){const _0x21d4c2=_0x2a6210;_0x334c78/=0xff,_0x3196ba/=0xff,_0x1aa4bb/=0xff;const _0x183f92=Math['max'](_0x334c78,_0x3196ba,_0x1aa4bb),_0x472728=Math[_0x21d4c2(0x596)](_0x334c78,_0x3196ba,_0x1aa4bb);let _0xf7f7a2,_0x293233,_0x3fdec2=(_0x183f92+_0x472728)/0x2;if(_0x183f92===_0x472728)_0xf7f7a2=_0x293233=0x0;else{const _0x29d229=_0x183f92-_0x472728;_0x293233=_0x3fdec2>0.5?_0x29d229/(0x2-_0x183f92-_0x472728):_0x29d229/(_0x183f92+_0x472728);switch(_0x183f92){case _0x334c78:_0xf7f7a2=((_0x3196ba-_0x1aa4bb)/_0x29d229+(_0x3196ba<_0x1aa4bb?0x6:0x0))/0x6;break;case _0x3196ba:_0xf7f7a2=((_0x1aa4bb-_0x334c78)/_0x29d229+0x2)/0x6;break;case _0x1aa4bb:_0xf7f7a2=((_0x334c78-_0x3196ba)/_0x29d229+0x4)/0x6;break;}}return{'h':_0xf7f7a2,'s':_0x293233,'l':_0x3fdec2};}function hslToRgb(_0x4de6d3,_0x4f5551,_0x486601){const _0x4d95da=_0x2a6210;let _0x3fc8dc,_0xc9f666,_0x3aef3f;if(_0x4f5551===0x0)_0x3fc8dc=_0xc9f666=_0x3aef3f=_0x486601;else{const _0x4acdb3=(_0xe6af54,_0x36e5fc,_0x3acf58)=>{if(_0x3acf58<0x0)_0x3acf58+=0x1;if(_0x3acf58>0x1)_0x3acf58-=0x1;if(_0x3acf58<0x1/0x6)return _0xe6af54+(_0x36e5fc-_0xe6af54)*0x6*_0x3acf58;if(_0x3acf58<0x1/0x2)return _0x36e5fc;if(_0x3acf58<0x2/0x3)return _0xe6af54+(_0x36e5fc-_0xe6af54)*(0x2/0x3-_0x3acf58)*0x6;return _0xe6af54;},_0x4e21bb=_0x486601<0.5?_0x486601*(0x1+_0x4f5551):_0x486601+_0x4f5551-_0x486601*_0x4f5551,_0x3c6b5c=0x2*_0x486601-_0x4e21bb;_0x3fc8dc=_0x4acdb3(_0x3c6b5c,_0x4e21bb,_0x4de6d3+0x1/0x3),_0xc9f666=_0x4acdb3(_0x3c6b5c,_0x4e21bb,_0x4de6d3),_0x3aef3f=_0x4acdb3(_0x3c6b5c,_0x4e21bb,_0x4de6d3-0x1/0x3);}return{'r':Math[_0x4d95da(0x272)](_0x3fc8dc*0xff),'g':Math[_0x4d95da(0x272)](_0xc9f666*0xff),'b':Math[_0x4d95da(0x272)](_0x3aef3f*0xff)};}function applyPlaylistColor(_0x33aca1){const _0x183cbb=_0x2a6210,_0x2a4a31=document[_0x183cbb(0x2ba)](_0x183cbb(0x7d5));if(!_0x2a4a31)return;const {r:_0x87f80f,g:_0xfe144b,b:_0x15c172}=_0x33aca1,_0x37f0f5=_0x183cbb(0x5e5)+_0x87f80f+',\x20'+_0xfe144b+',\x20'+_0x15c172+_0x183cbb(0x6dc)+Math['max'](0x0,_0x87f80f-0x1e)+',\x20'+Math[_0x183cbb(0x5b1)](0x0,_0xfe144b-0x1e)+',\x20'+Math[_0x183cbb(0x5b1)](0x0,_0x15c172-0x1e)+',\x200.95)\x20100%)';_0x2a4a31['style'][_0x183cbb(0x3c0)]=_0x37f0f5,_0x2a4a31['style'][_0x183cbb(0x157)]=_0x183cbb(0x54a);}function loadAlbumCovers(){const _0x4de4cf=_0x2a6210,_0x373de0=document[_0x4de4cf(0x854)](_0x4de4cf(0x7b));let _0x3f40c0=null;FIXED_ALBUMS[_0x4de4cf(0x84c)]((_0x56294e,_0x16f6b0)=>{const _0x187a65=_0x4de4cf;if(_0x16f6b0<_0x373de0['length']){const _0xbcb4d7=_0x373de0[_0x16f6b0],_0x412bee=_0xbcb4d7[_0x187a65(0x2ba)](_0x187a65(0x210)),_0x4f9801=_0xbcb4d7[_0x187a65(0x2ba)](_0x187a65(0x173));_0x412bee&&(_0x412bee[_0x187a65(0x655)]=_0x56294e['cover'],_0x412bee[_0x187a65(0x6c4)]=_0x187a65(0x385),_0x16f6b0===0x0&&(_0x3f40c0=_0x412bee,_0x412bee['onload']=async()=>{const _0x240e75=_0x187a65;try{const _0x38ca25=await extractDominantColor(_0x412bee);applyPlaylistColor(_0x38ca25);}catch(_0x45b268){console['error'](_0x240e75(0x68f),_0x45b268);}},_0x412bee[_0x187a65(0x452)]&&extractDominantColor(_0x412bee)[_0x187a65(0x56b)](_0x5e2ef8=>{applyPlaylistColor(_0x5e2ef8);})[_0x187a65(0x147)](_0x1dbcfa=>{const _0xd9304d=_0x187a65;console[_0xd9304d(0x5d9)](_0xd9304d(0x68f),_0x1dbcfa);}),_0xbcb4d7['onclick']=()=>{const _0x533671=_0x187a65;if(!currentCharProfileData){console[_0x533671(0x5d9)](_0x533671(0x102));return;}const _0x51a5e9=currentCharProfileData['id'];console[_0x533671(0x40b)](_0x533671(0x542),_0x51a5e9),closeCharProfile(),typeof openCharacterDiary===_0x533671(0x88)?openCharacterDiary(_0x51a5e9):console[_0x533671(0x5d9)](_0x533671(0x664));})),_0x4f9801&&(_0x4f9801[_0x187a65(0x2a1)]=_0x56294e[_0x187a65(0x352)]);}});}async function getCurrentChatCharacter(){const _0x59bd9c=_0x2a6210,_0x1e7e89=currentChatId||window[_0x59bd9c(0x2dd)];if(!_0x1e7e89)return null;try{const _0x22d2db=await db[_0x59bd9c(0x37c)][_0x59bd9c(0x60f)](_0x1e7e89);if(!_0x22d2db)return null;const _0xee7436=getCharacterIdFromChat(_0x22d2db);if(!_0xee7436&&!isChatRecord(_0x22d2db))return null;const _0x2ba6ab=_0xee7436?await getCharacterById(_0xee7436):null;if(!_0x2ba6ab)return null;const _0x2396f2=_0x2ba6ab['settings']?.['aiAvatar']||'',_0x32f534=_0x2ba6ab['name']||_0x59bd9c(0x440),_0x40906a=await db[_0x59bd9c(0x5d1)][_0x59bd9c(0x60f)](normalizeId(_0x22d2db['id'])),_0x2ca44c=resolveChatDisplayName(_0x22d2db,{'chatSettings':_0x40906a,'fallbackName':_0x32f534,'defaultName':'Unknown'});let _0x179506=null,_0x29bc16=_0x40906a?.['userProfileId'];if(!_0x29bc16){const _0x556967=await db['globalSettings'][_0x59bd9c(0x60f)](_0x59bd9c(0x40f));_0x29bc16=_0x556967?.['value'];}_0x29bc16&&(_0x179506=await db[_0x59bd9c(0x72b)][_0x59bd9c(0x60f)](_0x29bc16));const _0x10eee1=_0x179506?.[_0x59bd9c(0x77d)]||_0x179506?.[_0x59bd9c(0x189)]?.[_0x59bd9c(0x5bd)]()['replace'](/\s+/g,'_')||'user';return{'id':_0xee7436,'name':_0x2ca44c,'originalName':_0x32f534,'avatar':_0x2396f2,'username':_0x32f534[_0x59bd9c(0x5bd)]()[_0x59bd9c(0x7a9)](/\s+/g,'_'),'bio':_0x2ba6ab['bio']||'','posts':_0x2ba6ab[_0x59bd9c(0x1dd)]||Math[_0x59bd9c(0x5b7)](Math['random']()*0x32)+0x1,'followers':_0x2ba6ab[_0x59bd9c(0x597)]||Math[_0x59bd9c(0x5b7)](Math[_0x59bd9c(0x658)]()*0x2710)+0x64,'following':_0x2ba6ab[_0x59bd9c(0x8d)]||Math[_0x59bd9c(0x5b7)](Math[_0x59bd9c(0x658)]()*0x1f4)+0xa,'pronouns':_0x2ba6ab['pronouns']||'','threads':_0x2ba6ab[_0x59bd9c(0x57f)]||Math['floor'](Math[_0x59bd9c(0x658)]()*0xf4240)+0x2710,'highlights':_0x2ba6ab[_0x59bd9c(0x84e)]||null,'userMention':_0x10eee1};}catch(_0x1f811e){return console['warn'](_0x59bd9c(0x155),_0x1f811e),null;}}function renderCharProfileData(_0x37b425){const _0x21a096=_0x2a6210,_0x3df5e1=document[_0x21a096(0x550)](_0x21a096(0x656));_0x3df5e1&&(_0x3df5e1['textContent']=_0x37b425['username']||_0x37b425[_0x21a096(0x189)]?.['toLowerCase']()[_0x21a096(0x7a9)](/\s+/g,'_')||'username');const _0x23b1af=document['getElementById'](_0x21a096(0x55d));_0x23b1af&&(_0x23b1af['src']=_0x37b425[_0x21a096(0x830)]||_0x21a096(0x502),_0x23b1af['onerror']=function(){const _0x3806db=_0x21a096;this[_0x3806db(0x655)]=_0x3806db(0x502);});const _0x1bb96e=document[_0x21a096(0x550)](_0x21a096(0x725)),_0x5a9d2f=document[_0x21a096(0x550)](_0x21a096(0x6ad)),_0x1f9cbc=document['getElementById'](_0x21a096(0x4f3));if(_0x1bb96e)_0x1bb96e[_0x21a096(0x2a1)]=_0x37b425[_0x21a096(0x1dd)]||Math[_0x21a096(0x5b7)](Math[_0x21a096(0x658)]()*0x32)+0x1;if(_0x5a9d2f)_0x5a9d2f[_0x21a096(0x2a1)]=formatNumber(_0x37b425[_0x21a096(0x597)]||Math[_0x21a096(0x5b7)](Math[_0x21a096(0x658)]()*0x2710)+0x64);if(_0x1f9cbc)_0x1f9cbc[_0x21a096(0x2a1)]=_0x37b425[_0x21a096(0x8d)]||Math[_0x21a096(0x5b7)](Math[_0x21a096(0x658)]()*0x1f4)+0xa;const _0x23cf6c=document[_0x21a096(0x550)](_0x21a096(0x3f9));_0x23cf6c&&(_0x23cf6c[_0x21a096(0x2a1)]=_0x37b425[_0x21a096(0x189)]||_0x21a096(0x2da));const _0x4bbf98=document[_0x21a096(0x550)](_0x21a096(0xff));_0x4bbf98&&(_0x4bbf98[_0x21a096(0x655)]=_0x37b425[_0x21a096(0x830)]||'https://i.pravatar.cc/150?img=1',_0x4bbf98[_0x21a096(0x1b8)]=function(){const _0x49c497=_0x21a096;this[_0x49c497(0x655)]=_0x49c497(0x502);});const _0x36389f=document[_0x21a096(0x550)](_0x21a096(0x832));_0x36389f&&(_0x36389f[_0x21a096(0x2a1)]=_0x37b425[_0x21a096(0x486)]||_0x37b425[_0x21a096(0x189)]||'Character\x20Name');const _0x54fff3=document[_0x21a096(0x550)](_0x21a096(0x1f8));_0x54fff3&&(_0x54fff3[_0x21a096(0x2a1)]=_0x37b425[_0x21a096(0x189)]||_0x21a096(0x1fc));const _0x583fda=document[_0x21a096(0x550)](_0x21a096(0x24a));_0x583fda&&(_0x583fda['textContent']=formatNumber(_0x37b425[_0x21a096(0x57f)]||Math[_0x21a096(0x5b7)](Math['random']()*0xf4240)+0x2710));const _0x571c4a=document['getElementById'](_0x21a096(0x53d));if(_0x571c4a){const _0x5d2cc5=_0x37b425[_0x21a096(0x710)]||'user';_0x571c4a[_0x21a096(0x63f)]='@'+_0x5d2cc5+_0x21a096(0x19a);}renderCharProfileHighlights(_0x37b425);}function formatNumber(_0x3f04ad){const _0x5525d2=_0x2a6210;if(_0x3f04ad>=0xf4240)return(_0x3f04ad/0xf4240)[_0x5525d2(0x252)](0x1)[_0x5525d2(0x7a9)](/\.0$/,'')+'M';if(_0x3f04ad>=0x3e8)return(_0x3f04ad/0x3e8)['toFixed'](0x1)[_0x5525d2(0x7a9)](/\.0$/,'')+'K';return _0x3f04ad[_0x5525d2(0x1ac)]()[_0x5525d2(0x7a9)](/\B(?=(\d{3})+(?!\d))/g,',');}function renderCharProfileHighlights(_0x37046c){const _0x315a9e=_0x2a6210,_0x55835e=document[_0x315a9e(0x550)]('charProfileHighlights');if(!_0x55835e)return;const _0x47632f=[{'icon':_0x315a9e(0x73f),'label':_0x315a9e(0x3ec)},{'icon':'calendar','label':'日程'},{'icon':'file','label':'笔记'},{'icon':_0x315a9e(0x459),'label':'关于'}],_0x17ff9c=_0x37046c[_0x315a9e(0x84e)]||_0x47632f;_0x55835e[_0x315a9e(0x63f)]=_0x17ff9c[_0x315a9e(0x444)](_0xa76e3=>_0x315a9e(0x50e)+_0xa76e3[_0x315a9e(0x608)]+_0x315a9e(0x606)+(_0xa76e3['image']?_0x315a9e(0x23a)+_0xa76e3['image']+_0x315a9e(0x4ac)+_0xa76e3[_0x315a9e(0x352)]+'\x22>':getHighlightIcon(_0xa76e3[_0x315a9e(0x608)]))+_0x315a9e(0x120)+_0xa76e3[_0x315a9e(0x352)]+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20')[_0x315a9e(0x469)]('');}function getHighlightIcon(_0x365987){const _0x43a505=_0x2a6210,_0x57b584={'heart':_0x43a505(0x7e0),'calendar':_0x43a505(0x126),'file':_0x43a505(0x3af),'help':_0x43a505(0x70),'star':_0x43a505(0x248)};return _0x57b584[_0x365987]||_0x57b584['heart'];}function handleCharProfileHighlight(_0x12b8d0){const _0x2a91a5=_0x2a6210;console[_0x2a91a5(0x40b)](_0x2a91a5(0x475),_0x12b8d0);}function charProfilePhone(){const _0x39f4d6=_0x2a6210;if(!currentCharProfileData)return;closeCharProfile(),console[_0x39f4d6(0x40b)](_0x39f4d6(0x178),currentCharProfileData[_0x39f4d6(0x189)]),typeof openPhoneCall===_0x39f4d6(0x88)&&openPhoneCall(currentCharProfileData);}function charProfileNote(){const _0x5c635f=_0x2a6210;if(!currentCharProfileData)return;const _0xd14b67=currentCharProfileData['id'],_0x2a9d7f=currentCharProfileData['name'];closeCharProfile(),console[_0x5c635f(0x40b)](_0x5c635f(0x73e),_0x2a9d7f),typeof openCharacterDiary==='function'?openCharacterDiary(_0xd14b67):console[_0x5c635f(0x40b)](_0x5c635f(0x664));}function animateMusicPlayerLyrics(){const _0x3ec3f0=_0x2a6210,_0x41537c=document[_0x3ec3f0(0x2ba)](_0x3ec3f0(0x675)),_0x4b0ce9=document[_0x3ec3f0(0x854)](_0x3ec3f0(0x1c9));if(!_0x41537c||!_0x4b0ce9['length'])return;musicPlayerLyricsInterval&&(clearInterval(musicPlayerLyricsInterval),musicPlayerLyricsInterval=null),_0x4b0ce9[_0x3ec3f0(0x84c)]((_0x1d5ffc,_0x4ee4be)=>{const _0x1b62c8=_0x3ec3f0;_0x1d5ffc[_0x1b62c8(0x2af)][_0x1b62c8(0x18f)](_0x1b62c8(0x763),_0x4ee4be===0x0);}),_0x41537c[_0x3ec3f0(0x37e)][_0x3ec3f0(0x61d)]=_0x3ec3f0(0x569);}function initMusicPlayerLyrics(){const _0x2b53a5=_0x2a6210;musicPlayerLyricsInterval&&(clearInterval(musicPlayerLyricsInterval),musicPlayerLyricsInterval=null);if(Array[_0x2b53a5(0x14f)](userPlaylistPlaybackLyrics)&&userPlaylistPlaybackLyrics[_0x2b53a5(0x73a)]>0x0)return;setTimeout(()=>{const _0x4084f4=_0x2b53a5;(!userPlaylistPlaybackLyrics||userPlaylistPlaybackLyrics[_0x4084f4(0x73a)]===0x0)&&renderUserPlaylistLyrics([]),animateMusicPlayerLyrics();},0x78);}let currentEditingIndex=0x0;function toggleAlbumEditMode(){const _0x513a47=_0x2a6210,_0x39e0e8=document[_0x513a47(0x550)](_0x513a47(0x2f2));if(!_0x39e0e8)return;_0x39e0e8[_0x513a47(0x2af)][_0x513a47(0x18f)](_0x513a47(0x763));}async function saveCharacterAlbums(_0x3f8ac2,_0x44b46c){const _0x4f4d0f=_0x2a6210;try{const _0x34ce19=await db['characterAlbums'][_0x4f4d0f(0x115)](_0x4f4d0f(0x848))[_0x4f4d0f(0x630)](_0x3f8ac2)[_0x4f4d0f(0x244)]();_0x34ce19?await db[_0x4f4d0f(0x16b)]['update'](_0x3f8ac2,{'covers':_0x44b46c,'updatedAt':new Date()}):await db[_0x4f4d0f(0x16b)][_0x4f4d0f(0x2a8)]({'characterId':_0x3f8ac2,'covers':_0x44b46c,'createdAt':new Date(),'updatedAt':new Date()}),console[_0x4f4d0f(0x40b)](_0x4f4d0f(0x129)),await loadAlbumCoversFromDB();}catch(_0xdc421a){console['error'](_0x4f4d0f(0x1a0),_0xdc421a);}}function triggerAlbumImageUpload(_0x59a5d4){const _0x5c8a23=_0x2a6210;currentEditingIndex=_0x59a5d4;const _0x5b4b1d=document['getElementById']('albumImageUpload');_0x5b4b1d&&_0x5b4b1d[_0x5c8a23(0x810)]();}async function handleAlbumImageUpload(_0x17d914){const _0x19831c=_0x2a6210,_0xcfc507=_0x17d914[_0x19831c(0x66d)]['files'][0x0];if(!_0xcfc507)return;if(!_0xcfc507[_0x19831c(0x1e9)]['startsWith'](_0x19831c(0x2d9))){console['error'](_0x19831c(0x296));return;}if(_0xcfc507[_0x19831c(0x719)]>0x5*0x400*0x400){console[_0x19831c(0x5d9)](_0x19831c(0x1f2));return;}try{const _0x1a4677=new FileReader();_0x1a4677[_0x19831c(0x1b3)]=async _0x3c2365=>{const _0x4a2b60=_0x19831c,_0x9473a7=_0x3c2365['target']['result'],_0x11d29a=document[_0x4a2b60(0x854)](_0x4a2b60(0x7b));if(currentEditingIndex<_0x11d29a[_0x4a2b60(0x73a)]){const _0x12411a=_0x11d29a[currentEditingIndex],_0x778a64=_0x12411a['querySelector'](_0x4a2b60(0x210));_0x778a64&&(_0x778a64[_0x4a2b60(0x655)]=_0x9473a7);}await saveAlbumCover(currentEditingIndex,_0x9473a7);},_0x1a4677[_0x19831c(0x77c)](_0xcfc507);}catch(_0x40f9cb){console[_0x19831c(0x5d9)](_0x19831c(0x4f7),_0x40f9cb);}_0x17d914['target']['value']='';}async function triggerAlbumUrlInput(_0x198c8f){const _0x3f2f98=_0x2a6210;currentEditingIndex=_0x198c8f;const _0x5c2b99=prompt('请输入图片URL：');if(!_0x5c2b99||!_0x5c2b99['trim']())return;try{new URL(_0x5c2b99);const _0x4c995c=document[_0x3f2f98(0x854)](_0x3f2f98(0x7b));if(_0x198c8f<_0x4c995c[_0x3f2f98(0x73a)]){const _0xc8aa05=_0x4c995c[_0x198c8f],_0x2703a7=_0xc8aa05[_0x3f2f98(0x2ba)](_0x3f2f98(0x210));_0x2703a7&&(_0x2703a7[_0x3f2f98(0x655)]=_0x5c2b99,_0x2703a7[_0x3f2f98(0x1b3)]=async()=>{await saveAlbumCover(_0x198c8f,_0x5c2b99);},_0x2703a7[_0x3f2f98(0x1b8)]=()=>{const _0x9480b0=_0x3f2f98;console[_0x9480b0(0x5d9)]('图片加载失败，请检查URL'),loadAlbumCoversFromDB();});}}catch(_0x41d38c){console['error'](_0x3f2f98(0x39b),_0x41d38c);}}async function saveAlbumCover(_0x1a8dc2,_0x1f1dda){const _0x47d6f2=_0x2a6210;if(!currentCharProfileData)return;try{const _0x4cc289=currentCharProfileData['id'],_0x29e0cb=await db[_0x47d6f2(0x16b)][_0x47d6f2(0x115)]('characterId')['equals'](_0x4cc289)[_0x47d6f2(0x244)]();let _0x146e65=[];_0x29e0cb&&_0x29e0cb[_0x47d6f2(0x376)]?_0x146e65=[..._0x29e0cb['covers']]:_0x146e65=FIXED_ALBUMS[_0x47d6f2(0x444)](_0x11a237=>({'url':_0x11a237[_0x47d6f2(0x45c)],'label':_0x11a237[_0x47d6f2(0x352)]})),_0x146e65[_0x1a8dc2]={'url':_0x1f1dda,'label':_0x146e65[_0x1a8dc2]?.[_0x47d6f2(0x352)]||FIXED_ALBUMS[_0x1a8dc2][_0x47d6f2(0x352)]},await saveCharacterAlbums(_0x4cc289,_0x146e65),console[_0x47d6f2(0x40b)](_0x47d6f2(0x35e));}catch(_0x56c4df){console[_0x47d6f2(0x5d9)](_0x47d6f2(0x6e),_0x56c4df);}}async function loadAlbumCoversFromDB(){const _0x309cae=_0x2a6210;if(!currentCharProfileData){loadAlbumCovers();return;}try{const _0x5a1845=currentCharProfileData['id'],_0x50a72a=await db['characterAlbums']['where'](_0x309cae(0x848))[_0x309cae(0x630)](_0x5a1845)[_0x309cae(0x244)]();if(_0x50a72a&&_0x50a72a['covers']){const _0x1beeda=document[_0x309cae(0x854)](_0x309cae(0x7b));_0x50a72a[_0x309cae(0x376)][_0x309cae(0x84c)]((_0x3c5d2d,_0x43c993)=>{const _0xa5211a=_0x309cae;if(_0x43c993<_0x1beeda[_0xa5211a(0x73a)]){const _0x55fcfe=_0x1beeda[_0x43c993],_0x28aac2=_0x55fcfe['querySelector'](_0xa5211a(0x210)),_0x3be80b=_0x55fcfe[_0xa5211a(0x2ba)](_0xa5211a(0x173));_0x28aac2&&_0x3c5d2d[_0xa5211a(0x852)]&&(_0x28aac2[_0xa5211a(0x655)]=_0x3c5d2d[_0xa5211a(0x852)],_0x28aac2[_0xa5211a(0x6c4)]=_0xa5211a(0x385),_0x43c993===0x0&&(_0x28aac2['onload']=async()=>{const _0x188fe9=_0xa5211a;try{const _0x5c96a2=await extractDominantColor(_0x28aac2);applyPlaylistColor(_0x5c96a2);}catch(_0x868b7a){console[_0x188fe9(0x5d9)](_0x188fe9(0x68f),_0x868b7a);}},_0x28aac2[_0xa5211a(0x452)]&&extractDominantColor(_0x28aac2)[_0xa5211a(0x56b)](_0x585601=>{applyPlaylistColor(_0x585601);})[_0xa5211a(0x147)](_0x16b0c3=>{const _0x2ca8bc=_0xa5211a;console[_0x2ca8bc(0x5d9)](_0x2ca8bc(0x68f),_0x16b0c3);}),_0x55fcfe[_0xa5211a(0x7a1)]=()=>{const _0x540750=_0xa5211a;if(!currentCharProfileData){console['error']('无角色数据，无法打开日记本');return;}const _0x3e3288=currentCharProfileData['id'];console[_0x540750(0x40b)]('📔\x20打开日记本，角色ID:',_0x3e3288),closeCharProfile(),typeof openCharacterDiary==='function'?openCharacterDiary(_0x3e3288):console[_0x540750(0x5d9)](_0x540750(0x664));})),_0x3be80b&&_0x3c5d2d[_0xa5211a(0x352)]&&(_0x3be80b['textContent']=_0x3c5d2d[_0xa5211a(0x352)]);}});}else loadAlbumCovers();}catch(_0x602dbe){console[_0x309cae(0x5d9)](_0x309cae(0x275),_0x602dbe),loadAlbumCovers();}}let diaryCurrentPage=0x0,diaryTotalPages=0x2,currentDiaryCharacterId=null,currentDiarySessionId=null,currentDiaryProfileId=null,currentDiaryCharacterMeta=null,diaryDedupeArmed=![],diaryDedupeRunning=![],diaryDedupeArmTimeout=null;function _0x4466(){const _0x157933=['❌\x20Save\x20contact\x20failed:','userProfiles','deleteStrangerOption','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','originalRotate','157','保存分类失败','callTimer','collapsed','role','childElementCount','fillStyle','」\x0a用户回复：','initThreadDetailInteractions','次\x0a最近一次：','.thread-action-count,\x20.thread-comment-action-count','length','):\x20','content','📱\x20创建新短信','Note\x20clicked\x20for:','heart','parseFloat','currentGalleryToggle','<span\x20class=\x22image-gallery-category-badge\x22>','imessage','appendChild','个日期的笔记','📱\x20播放关闭动画','updateBaobaobookCharCount','put','📱\x20选择用户资料:','together-name','boundBaobaobooks','isRandomSmsContact','Thousands\x20of\x20tears\x20falling...','musicWidgetListScroll','togetherInviteStatus','confirmDeleteBaobaobookCategory','12.百宝书-后','❌\x20[Thread]\x20日程表读取失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','grab','deg)','Thursday','missing_gate','createTextNode','\x0a-\x20username:\x20回复者的名字（可以是作者\x22','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22recent-call-tag\x22>','<div\x20class=\x22sms-message-content\x22>','mmpagesPostsContainer','❌\x20随机陌生人通话初始化失败','scrollContainer','Where\x20melody\x20and\x20chaos\x20meet','is-dragging','10.日程表','callUserReplies','active','.sms-date-separator','音频加载出错','#musicWidgetLyricStyleList\x20.lyric-style-item','请输入评论内容','\x22\x20alt=\x22Avatar\x22\x20onerror=\x22this.style.display=\x27none\x27\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-follow-badge\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x205v14\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M5\x2012h14\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-post-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-post-top-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-post-user-time\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22mmpages-post-username\x22>',',\x20sessionId=','getSeconds','主页已更新','text','无法获取音频或歌词','has-reply','-\x20本段用于质控；按要求完成<thinking>后再输出PIPE-LINE\x20v1。','[百宝书]\x20分类已保存:','添加失败','dataset','newContactRealName','📱\x20SMS\x20View\x20Contact:','加载角色失败:','✅\x20删除图库分类成功:','百宝书/默认位置','mmpagesEditDisplayName','<div\x20class=\x22avatar-placeholder\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22><circle\x20cx=\x2212\x22\x20cy=\x228\x22\x20r=\x224\x22/><path\x20d=\x22M20\x2021v-2a4\x204\x200\x200\x200-4-4H8a4\x204\x200\x200\x200-4\x204v2\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','center','获取百宝书条目失败:','readAsDataURL','username','##\x20你们的私聊记录（最近20条）\x0a\x0a以下是你与用户的私聊历史，可作为评论互动的背景参考：\x0a\x0a','\x20has-reply','\x20条重复笔记。\x0a\x0a是否立即清理？（不可撤销）\x0a\x0a规则：优先保留你拖动过位置的便签；其余按文本去重。','📱\x20[iMessage]\x20找到会话数:','newGalleryCategoryName','Ended','pen','199','🤖\x20[Thread]\x20AI原始回复:','No\x20results',',\x20event)\x22\x20title=\x22删除笔记\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-sticky-body\x22>','⚡\x20[日记本]\x20批量添加','startsWith','positionX','\x27)\x22\x20title=\x22删除分类\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22><polyline\x20points=\x223\x206\x205\x206\x2021\x206\x22/><path\x20d=\x22M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Shadows\x20dance\x20on\x20the\x20wall...','✅\x20已删除contacts记录','shiftKey','无提示','\x20条Mmpages动态','.thread-reply-btn','isContact','✅\x20[删除事件]\x20已标记为已消耗:','<div\x20class=\x22overlay-empty-hint\x22>Name\x20a\x20constellation\x20to\x20draw\x20the\x20first\x20line.</div>','用户刚刚评论了：','selectedCallUserProfileId','Monday','</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-mood\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<article\x20class=\x22mmpages-post\x22\x20data-post-id=\x22','.spine-line','请重试','baobaobookEntries','false','start','K\x20followers','onclick','Playback\x20failed:','🖼️\x20打开图片管理:','call','无法拨通','mmpagesEditOverlay','contactDetailStatus','flushChatDetailRefreshIfNeeded:error','replace','inputPlaceholder','分类名称已存在','Yesterday','createOscillator','❌\x20加载图库分类失败:','lastViewedAt','📱\x20[Recent]\x20Failed\x20to\x20load\x20user\x20profile:','📱\x20[Contacts]\x20Failed\x20to\x20load\x20my\x20card:','bio','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-meta\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22thread-comment-username\x22>','is-together','❌\x20[Thread]\x20匹配聊天框失败:','charAt','❌\x20删除联系人失败:','<path\x20d=\x22M17\x207L7\x2017M7\x207h10M7\x207v10\x22/>','Audrey\x20Hepburn','条)</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22diary-idx-page\x22>','high','song','lastTimestamp','歌单暂无歌曲','span','-图片]','找不到条目抽屉','1992vSsMYJ','diary-idx-item\x20diary-idx-note','characterAvatar','✅\x20百宝书条目管理模块加载完成','未接来电','✅\x20[SMS重回]\x20成功生成新回复:','📞\x20号码状态：正在通话中','📱\x20Latest\x20call\x20record:','saveBaobaobookEntry','Since\x20','show','CONTEXT','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20overflow:\x20hidden;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20relative;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20flex-direction:\x20column;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','entryId','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','❌\x20保存删除事件失败:','playerTimeRemain','\x22\x20onclick=\x22if(event.target.closest(\x27.mmpages-action-btn,\x20.mmpages-post-more\x27))\x20return;\x20openThreadDetail(','⚠️\x20警告:\x20Token使用量超过\x208000，可能接近某些模型的上下文限制！','.playlist-section','<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M6\x2019h4V5H6v14zm8-14v14h4V5h-4z\x22/></svg>','diaryCoverName','getDate','❌\x20无效的帖子ID','imessageDeleteBtn','🎯\x20[Thread]\x20楼中楼模式，目标主评论索引:','无法删除笔记，请重试','isDragging','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','THREAD\x20COMMENT\x20SIMULATION\x20-\x20CONTEXT','<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M20.84\x204.61a5.5\x205.5\x200\x200\x200-7.78\x200L12\x205.67l-1.06-1.06a5.5\x205.5\x200\x200\x200-7.78\x207.78l1.06\x201.06L12\x2021.23l7.78-7.78\x201.06-1.06a5.5\x205.5\x200\x200\x200\x200-7.78z\x22></path></svg>','replies','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#c9b8a8;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-top:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20','🗑️\x20开始删除短信对话:','Echoes\x20from\x20the\x20garage.','idx','\x0a兴趣：','正在删除\x20','charSettings','imageGalleries','is-adjusting','198','requestChatDetailRefresh','未命名角色','👤\x20[Thread]\x20当前身份:\x20','FINAL','smsEditBtn','📱\x20Switched\x20to\x20Keypad\x20view','01:42','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22image-gallery-category-actions\x22\x20onclick=\x22event.stopPropagation()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22image-gallery-category-btn\x20delete\x22\x20onclick=\x22deleteGalleryCategory(\x27','category','Message','❌\x20角色ID不存在','✅\x20头像已上传','已选择\x200\x20项','newCatInput','replyToUsername','show-playlist','📱\x20显示\x22删除此号码\x22按钮，陌生人:','option','发送繁忙短信失败:','is-playing','分类已禁用','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M9\x2016.17L4.83\x2012l-1.42\x201.41L9\x2019\x2021\x207l-1.41-1.41z\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','rgba(0,\x200,\x200,\x200.15)','switching-in','📱\x20关闭iMessage','Declined','set','atan2','上传失败','#baobaobookGrid','您拨打的电话正在通话中，请稍后再拨','📱\x20最终\x20records:','_selectedIndex','CHARACTER:\x20','customAvatar','.imessage-checkbox','click','__ovoTogetherInviteDebug','animating-out','latest','localeCompare','132','isRandomSms','translateX(-20px)','<path\x20d=\x22M12\x201a3\x203\x200\x2000-3\x203v8a3\x203\x200\x20006\x200V4a3\x203\x200\x2000-3-3z\x22/><path\x20d=\x22M19\x2010v2a7\x207\x200\x2001-14\x200v-2\x22/><line\x20x1=\x2212\x22\x20y1=\x2219\x22\x20x2=\x2212\x22\x20y2=\x2223\x22/><line\x20x1=\x228\x22\x20y1=\x2223\x22\x20x2=\x2216\x22\x20y2=\x2223\x22/>','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','📱\x20删除旧短信记录:','随机陌生人','unread','确定要删除这条动态吗？\x0a\x0a删除后无法恢复。','📱\x20删除联系人:','-用户提供的图片]','🤖\x20AI回复:','&lt;','loading','user-playlist-close','musicWidgetSkinOverlay','151','长度:','\x22\x20data-comment-index=\x22','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','未知号码','📱\x20[Recent]\x20Failed\x20to\x20load\x20call\x20records:','#000','🔝\x20Token消耗TOP5:','userPlaylistAvatar','systemAction','/100，根据本次互动调整','avatar','📱\x20找到短信历史:','playlistCharName','\x27)\x22>','99NNQkQL','sms_',',\x20x=','reposts','search','activeElement','评论区暂无历史记录','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22imessage-pinned-name\x22>','修改或删除这个知识条目','keywords','获取日记列表失败:','暂无可切换的用户资料','flipped','align','180','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</article>\x0a\x20\x20\x20\x20\x20\x20','.baobaobook-entry-drawer-overlay','Send\x20message','getContext','bounce','characterId','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-profile-arrow\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<polyline\x20points=\x229\x2018\x2015\x2012\x209\x206\x22></polyline>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','baobaobook-empty-state','baobaobookNewCategoryNameInput','forEach','shouldHangup','highlights','📤\x20发送所有回复给AI:','✅\x20使用通讯录自定义头像','pointerEvents','url','日程表系统','querySelectorAll','📱\x20Redial:','together-avatar','📱\x20加载短信历史:','animationPlayState','getHours','✅\x20[Thread]\x20已添加\x20','\x22\x20alt=\x22用户提供的图片\x22\x20loading=\x22lazy\x22\x20onerror=\x22this.style.display=\x27none\x27\x22>','⚠️\x20[chat-refresh]\x20failed:','❌\x20删除随机陌生人号码失败:','pointerdown','width:\x20','change','📱\x20Call\x20contact:','✅\x20Thread\x20Detail功能模块加载完成','保存封面失败:','netease','<svg\x20viewBox=\x220\x200\x2024\x2024\x22><circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x2210\x22></circle><path\x20d=\x22M9.09\x209a3\x203\x200\x200\x201\x205.83\x201c0\x202-3\x203-3\x203\x22></path><line\x20x1=\x2212\x22\x20y1=\x2217\x22\x20x2=\x2212.01\x22\x20y2=\x2217\x22></line></svg>','body','\x20views','after','thread-comment-menu-styles','📱\x20toggleContactHistoryDetail\x20called,\x20index:','previewNewImage','newImageUrl','lastMessageTime','📱\x20❌\x20无法补全\x20transcript','diary-sticky-delete','.album-thumb','openGalleryImages','https://i.postimg.cc/J08Ps3mz/a5c30bff958e9aee2d418c8b3aa090b4.jpg','\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-transcript-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-transcript-time\x22>','CHARACTER\x20KNOWLEDGE\x20-\x20BAOBAOBOOK\x20(MIDDLE)','NOTE','contactHistoryBadge','\x22\x20onclick=\x22handleCallButtonClick(\x27','pointermove','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-history-time\x22>','fillText','.thread-comment-menu','⚠️\x20无效的通话数据（没有callStartTime），跳过保存','function','1.乱码层','确定要删除联系人\x20\x22','flex','class','following','stroke','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-show-replies-icon\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x223\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<polyline\x20points=\x226\x209\x2012\x2015\x2018\x209\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','musicWidgetOrbUrlApply','✅\x20[DEBUG]\x20initCallWithAI函数存在，开始调用...','musicWidgetLyricPosition','📱\x20查询参数:\x20characterId=','\x22\x20data-phone-number=\x22','CURRENT\x20TURN\x20USER\x20COMMENT','3.百宝书-前','songTitle','showTimer','callRecords','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','phoneNumberDisplay','📱\x20Contact\x20saved:','.contact-card-content','📱\x20[iMessage]\x20返回会话列表:','\x0a\x20\x20\x20\x20\x20\x20','153','A\x20map\x20of\x20songs,\x20a\x20wall\x20of\x20clues','笔记已成功删除','startRatio','\x22\x20onclick=\x22filterBaobaobookByCategory(\x27','ownerId','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22freq-card\x20card-synced\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card-meta\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x22\x20及所有相关数据（','433246XRWOkq','<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M15\x2018l-6-6\x206-6\x22/></svg>','SYSTEM\x20INITIALIZATION\x20-\x20SIMULATION_PROTOCOL','-\x20你对用户的当前好感度（只读，评论场景不产出新好感度）。','together-info','musicWidgetCustomOrbImage','autoplay','render','lyric|','imageGalleryAddModal','已删除笔记','13.本轮用户输入','recentPromoAvatar','toDeleteIds','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contacts-item-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contacts-item-name\x22>','threadDetailScreen','\x20\x20↳\x20@','密码错误…再想想？','首次判定：根据人设关系基准确定初始值','\x22\x20onclick=\x22','📱\x20删除随机陌生人号码:','📞\x20AI说完所有话了，准备主动挂断电话','#baobaobookCategoryTabs\x20.worldview-tab','images','grabbing','Connected','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22image-gallery-category-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22image-gallery-category-name\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','open','分类\x22','[百宝书]\x20读取分类失败:',',\x20y=','zIndex','chatSettingsUserAvatar','diary-empty-hint','-\x20用户直接回复了这条主评论。','playlistTitle','-\x20你要基于这些评论历史生成新的评论回复。','zh-CN','155','对方没有应答','[百宝书]\x20关闭分类管理抽屉','\x20回复@','preview','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20','commentIndex','border','🔍\x20[DEBUG]\x20检查initCallWithAI函数:','📱\x20Create\x20new\x20contact\x20for:','SYSTEM\x20OVERRIDE\x20-\x20PRIORITY\x20ALPHA','newGalleryCategoryTarget','select_song','.thread-comment-menu.active','globalSettings','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','chatDetailScreen','私人日记...','\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onclick=\x22switchThreadProfile(\x27','<div\x20class=\x22sms-delivered\x22>Delivered</div>','date','PLOT\x20POINTS','确定删除这张图片？','\x22\x20alt=\x22动态图片\x22\x20loading=\x22lazy\x22\x20onerror=\x22this.style.display=\x27none\x27\x22>','volume','phoneNumbers','\x0a\x0a###\x20你的日记本密码\x0a密码：','\x0a\x0a统计：点赞','releasePointerCapture','❌\x20[iMessage]\x20打开短信聊天失败:','expiresAt','minLeft','End\x20Call','imessage-edit-mode','preventDefault','minimizing','mmpagesBioNote','selected','calc(','__OVO_APPS_BUNDLE_LOADED__','diaryStatDays','STICKER\x20LIBRARY\x20(AVAILABLE\x20EXPRESSIONS)','setAttribute','0:00','</strong>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small>','Copied!','delete','decorHTML','rgba(255,\x20255,\x20255,\x200.4)','playlistAvatar','bulkAdd','Track\x20','无角色数据，无法打开日记本','想你了~','phoneNumber','确定要删除这条评论吗？\x0a\x0a该评论下的所有回复也会被删除。','check','isReply','Connecting\x20stars\x20in\x20vacant\x20heads','Failed\x20to\x20get\x20character\x20data:','newContactAvatarInput','pageEl','\x20条短信记录','PROTOCOL','phone','minute','deletedPost_',',\x20strangerPersona=','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-search-action\x22>ADD</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','getMonth','WISH','where','\x0a\x0a##\x20原帖内容\x0a作者：','156','[UserPlaylist]\x20save\x20db\x20failed:','16.最终输出协议','buttonText','together_','mmpagesEditFollowers','touchmove','\x22\x20吗？\x0a\x0a删除后该号码将从通讯录中移除，但通话记录和聊天记录将保留。','#baobaobookEntryCategorySelect','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22char-profile-highlight-label\x22>','<div\x20class=\x22call-user-reply-item\x20','❌\x20[Thread]\x20好感度保存失败:','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x2210\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<line\x20x1=\x2212\x22\x20y1=\x2216\x22\x20x2=\x2212\x22\x20y2=\x2212\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<line\x20x1=\x2212\x22\x20y1=\x228\x22\x20x2=\x2212.01\x22\x20y2=\x228\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','birthDate','cursor','<svg\x20viewBox=\x220\x200\x2024\x2024\x22><rect\x20x=\x223\x22\x20y=\x224\x22\x20width=\x2218\x22\x20height=\x2218\x22\x20rx=\x222\x22\x20ry=\x222\x22></rect><line\x20x1=\x2216\x22\x20y1=\x222\x22\x20x2=\x2216\x22\x20y2=\x226\x22></line><line\x20x1=\x228\x22\x20y1=\x222\x22\x20x2=\x228\x22\x20y2=\x226\x22></line><line\x20x1=\x223\x22\x20y1=\x2210\x22\x20x2=\x2221\x22\x20y2=\x2210\x22></line></svg>','新建条目','📱\x20[Contacts]\x20Hidden\x20auto\x20contacts:','✅\x20专辑封面已保存','songArtist','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22thread-follow-btn\x22>Follow</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-post-content\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#333;\x0a\x20\x20\x20\x20\x20\x20\x20\x20','❌\x20[Thread]\x20PIPE-LINE解析失败:','\x22\x20data-username=\x22','（已解锁=用户无需再次输入；已上锁=用户需要输入密码）','together-action','right','保存便签位置失败:','bulkDelete','setValueAtTime','playerProgressFilled','📱\x20Opening\x20phone\x20contacts','&quot;','📱\x20点击发送按钮，准备调用AI','</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','song-search-item','#ff3b5c','maxLeft','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20便利贴笔记\x20-\x20绝对定位在页面右侧边缘\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','toLocaleDateString','Pause','\x0a\x0a##\x20🔎\x20已记录笔记（背景知识）\x0a\x0a','imessage-item\x20','213012sWAnYY','📱\x20找到匹配的\x20chatMessages:','📱\x20展开通话页面','<div\x20class=\x22sms-bubble\x22>','insertAdjacentHTML','catch','✅\x20[日记本]\x20渲染完成！','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','deleteGalleryCategory','The\x20static\x20of\x20the\x20universe.','trim','陌生人:','moveTo','isArray','笔记去重','循环播放:\x20','smsEditToolbar','promptText','top','Failed\x20to\x20get\x20chat\x20data:','条消息','transition','imessagePinnedGrid','newContactRealNameGroup','bgText','source','未找到对应歌单','📱\x20取消全选','AI思考中','userProfile:','Waiting\x20for\x20music...','substring','</span>','无法打开短信','歌单不可用','删除成功','10%','📱\x20[SMS重回]\x20删除后的消息长度:','aria-hidden','imessage-avatar-gray','entryIndex','characterAlbums','-文字图]\x20','removeChild','description','2SIGmaj','deletedPostEvent','characterStatus_','<img\x20class=\x22thread-post-image\x22\x20src=\x22','.album-thumb-label','closest','请输入分类名称','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',',\x20isStranger=','Phone\x20clicked\x20for:','actorRole','getBoundingClientRect','❌\x20加载角色列表失败:','❌\x20Thread\x20Detail容器不存在','songSearchPanel','playPauseBtn','has','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22category-item-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22category-item-name\x22>','检测到\x20','index','📝\x20[Thread]\x20变化原因:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22overlay-title\x22>','📱\x20找到通讯录联系人:','keys','custom','lyricsContainer','name','side','isUserSavedContact','contactHistoryList','px;','object','toggle','data:image/svg+xml,%3Csvg\x20xmlns=\x27http://www.w3.org/2000/svg\x27\x20viewBox=\x270\x200\x20100\x20100\x27%3E%3Crect\x20fill=\x27%23ff9500\x27\x20width=\x27100\x27\x20height=\x27100\x27/%3E%3Ccircle\x20cx=\x2750\x27\x20cy=\x2735\x27\x20r=\x2720\x27\x20fill=\x27%23fff\x27/%3E%3Cellipse\x20cx=\x2750\x27\x20cy=\x2780\x27\x20rx=\x2730\x27\x20ry=\x2725\x27\x20fill=\x27%23fff\x27/%3E%3C/svg%3E','182','📋\x20加载用户资料:','contactsMyCardAvatar','✅\x20通讯录陌生人通话已连接:','fill','avatarClass','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20','duration','playlistMediaCache','\x20<span\x20class=\x22star\x22>☆</span>','\x20条消息吗？此操作无法撤销。','contactName','accept','#baobaobookEntryKeywordsInput','\x0a\x0a###\x20你的电话号码\x0a','❌\x20保存专辑封面失败:','✅\x20短信历史已保存:','请输入图片链接','\x0a关于：','POSITIVE_INFINITY','dragReady','apiConfig','[未接来电]\x20','chatbox','pause','185','musicWidgetOrbSize','toString','lyricUpdatedAt','请输入条目内容','callReplyInputContainer','recent','Character\x20Name','playlistOwner','onload','openImageGalleryAddModal','<div\x20class=\x22baobaobook-entry-keywords\x22>','showReplies','Incoming\x20Call','onerror','Follow','📱\x20Content\x20element:','<img\x20class=\x22mmpages-post-image\x22\x20src=\x22','keydown','assistant','-\x20comment|reply:\x20对用户评论的回复（楼中楼），包含username/content/isAuthor/replyTo。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contacts-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M20\x2021v-2a4\x204\x200\x200\x200-4-4H8a4\x204\x200\x200\x200-4\x204v2\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2212\x22\x20cy=\x227\x22\x20r=\x224\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contacts-empty-text\x22>暂无联系人</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contacts-empty-subtext\x22>点击右上角添加新联系人</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','musicWidgetLyricColorPicker','确定删除此分类？分类内的所有图片链接也会被删除。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22category-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x221.5\x22\x20style=\x22width:\x2048px;\x20height:\x2048px;\x20opacity:\x200.3;\x20margin:\x200\x20auto\x2012px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x203h7a2\x202\x200\x200\x201\x202\x202v14a2\x202\x200\x200\x201-2\x202h-7m0-18H5a2\x202\x200\x200\x200-2\x202v14a2\x202\x200\x200\x200\x202\x202h7m0-18v18\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22\x20/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22font-size:\x2013px;\x20color:\x20var(--text-tertiary);\x22>还没有分类</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22font-size:\x2012px;\x20color:\x20var(--text-tertiary);\x20margin-top:\x204px;\x22>在下方输入框创建你的第一个分类</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','\x20right:\x20','data:image','Mute','clientX','mood','songs','.lyrics-line','pending','\x20transform:\x20rotate(','⚠️\x20清理随机号码数据失败（忽略）:','\x0a\x0a##\x20当前评论区\x0a暂无评论','📱\x20Detail\x20element\x20not\x20found\x20for\x20index:','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','[百宝书]\x20分类导航栏已更新','<div\x20class=\x22phone-profile-number\x22>','completed','📱\x20SMS\x20Call:','\x22</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22baobaobook-entry-preview\x22>','Thread评论场景构建器','custom-orb','COMMENT\x20HISTORY\x20(VERBATIM)','Call\x20Again','\x20-\x20','characterName','✅\x20百宝书分类管理模块加载完成','posts','📱\x20[iMessage]\x20未找到联系人:','diary-sticky-dragging','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22imessage-pinned-heart\x22>♡</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20','smsEmptyState','mousemove','📱\x20Contact\x20detail\x20shown\x20for:','_togetherInvite','未找到角色信息','phoneDisplayHint','hasTranscript:','分类不存在','type','auto','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','✅\x20便签已从页面移除','\x20top:\x20','closeCreateBaobaobookModal','🔍\x20[DEBUG]\x20sendCallMessage返回:','rotate(','success','图片大小不能超过5MB','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-avatar-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-avatar\x20imessage-avatar-default\x20','用户资料不存在','ctx_','分类「','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M21\x2015a2\x202\x200\x200\x201-2\x202H7l-4\x204V5a2\x202\x200\x200\x201\x202-2h14a2\x202\x200\x200\x201\x202\x202z\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>暂无短信<br/>点击右上角新建短信</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','playlistArtistName','imessageEditBar','title','📱\x20保存短信历史:','Character\x20Remark','diaryCoverSince','pronouns','callTranscript','Character','block','switching-out','musicWidgetOrbImage','lineTo','❌\x20加载短信历史失败:','en-US','Friday','createdAt','请输入新的分类名称:','新短信','\x20个百宝书条目','✅\x20已删除callRecords:\x20','clear','smsMessagesArea','mmpagesEmptyState','img','2-digit','sms','mouse','📱\x20处理\x20record[','日记本渲染失败，已降级显示','closeImageGalleryAddModal','musicWidgetOrbUrl','smsDeleteBtnText','messages','user-provided','-\x20下方是评论区的历史记录（按时间顺序）。','setItem','✅\x20通话界面已显示','BAOBAOBOOK\x20(FINAL\x20REINFORCEMENT)','Reply\x20to\x20comment...','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22category-item-meta\x22>','##\x20用户资料\x0a姓名：','isAuthor','originalPlaceholder','已发送给\x20','tagsYes','Thread身份：','📱\x20[SMS删除]\x20已同步smsMessages:','(总数:','📊\x20加载角色数据到Mmpages:','phoneScreen','✅\x20动态图库系统加载完成','diaryCoverBio','CORE\x20PERSONA','none','.phone-key','sending','diaryPage','stringify','musicWidgetOrbSizeValue','<div\x20class=\x22imessage-unread-indicator\x22></div>','svg','playlists','##\x20OUTPUT\x20CHECKPOINT\x20-\x20FINAL\x20GATE\x0a\x0a###\x20执行链（强制）\x0a<thinking>\x20→\x20COT全项\x20+\x20<Affection>好感度思考\x20→\x20</thinking>\x20→\x20PIPE-LINE\x20v1\x0a\x0a###\x20COT强制检查（每项必须思考）\x0a├─\x20基础：场景|人设|情感\x0a├─\x20<Affection>好感度分析：\x0a│\x20\x20├─\x20关系层次分析\x0a│\x20\x20├─\x20本轮互动触动层次\x0a│\x20\x20└─\x20好感度变化计算\x0a├─\x20功能触发判断：\x0a│\x20\x20├─\x20comment|reply（对用户评论的回复/楼中楼）\x0a│\x20\x20│\x20\x20├─\x20作者是否需要回复？\x0a│\x20\x20│\x20\x20├─\x20路人是否会加入讨论？\x0a│\x20\x20│\x20\x20└─\x20是否有楼中楼的回复？\x0a│\x20\x20└─\x20comment|main（新的主评论）\x0a│\x20\x20\x20\x20\x20└─\x20是否有其他人发新评论？\x0a└─\x20输出内容规划\x0a\x0a###\x20PIPE-LINE格式锁定\x0a结构：\x0aaffection|value=N|reason=...\x0acomment|reply|username=...|content=...|isAuthor=true|replyTo=...\x0acomment|main|username=...|content=...\x0a规则：每行一条指令\x20/\x20用|分隔\x20/\x20不输出JSON\x20/\x20不输出多余文本\x0a顺序：</thinking>闭合后输出\x20/\x20PIPE-LINE外禁止任何文本\x0a\x0a###\x20字段要求\x0a-\x20affection:\x20必填，0-100整数\x0a-\x20reason:\x20必填，好感度变化原因（角色口吻）\x0a-\x20comment|reply:\x20每条必须有username/content/isAuthor/replyTo\x0a-\x20comment|main:\x20每条必须有username/content\x0a-\x20两类评论都可为空，但必须至少输出affection行\x0a\x0a###\x20违规=输出失败\x0a-\x20跳过<thinking>直接输出\x0a-\x20</thinking>未闭合就输出PIPE-LINE\x0a-\x20COT缺少<Affection>好感度思考\x0a-\x20输出JSON或混入非PIPE-LINE文本\x0a-\x20缺少必要字段（affection/reason/username/content等）','找不到百宝书容器','profession','<img\x20src=\x22','.worldview-tab.active[data-category-id]','threadViews','.contact-card-arrow.expanded','middle','onkeydown','currentGalleryCategoryName','✅\x20Mmpages数据已保存到数据库','lazyLoad','minTop','first','条新评论','webkitAudioContext','📱\x20关闭Mmpages页面','<svg\x20viewBox=\x220\x200\x2024\x2024\x22><polygon\x20points=\x2212\x202\x2015.09\x208.26\x2022\x209.27\x2017\x2014.14\x2018.18\x2021.02\x2012\x2017.77\x205.82\x2021.02\x207\x2014.14\x202\x209.27\x208.91\x208.26\x2012\x202\x22></polygon></svg>','baobaobook-entry-item','charProfileThreadCount','createElement','blur','newContactSheetOverlay','decor','评论区历史记录','Music\x20is\x20the\x20reason\x20why','\x27,\x20event)\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20title=\x22','toFixed','update','CHAT\x20HISTORY\x20WITH\x20USER\x20(REFERENCE\x20ONLY)','❌\x20日记本渲染失败:','✅\x20iMessage模块加载完成','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pin-head\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22track-title\x22>','对方已挂断','⏹️\x20通话状态变为','autoReplies','ownerChatId','baobaobook-create-entry-btn','<span\x20class=\x22thread-author-badge\x22>·\x20Author</span>','CONSTRAINT','views','\x27)\x22\x20title=\x22删除\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','sendTogetherInviteToChat:begin','\x0a-\x20性别：','Add\x20Contact','\x0a当前状态：','minBottom','together-meta','\x0a/*\x20==========================================\x0a\x20\x20\x20日记本CSS样式表\x20-\x20用于渲染日记/笔记内容\x0a\x20\x20\x20注意：不要用\x20:root，会覆盖全局变量导致封面变色！\x0a\x20\x20\x20==========================================\x20*/\x0a\x0a/*\x20日记内容区域（使用全局CSS变量，自动适配暗黑模式）\x20*/\x0a.diary-entry-content\x20{\x0a\x20\x20/*\x20使用全局变量，自动继承Light/Dark\x20Mode配置\x20*/\x0a}\x0a\x0a/*\x20日记内容容器（不要用\x20.diary-page，会和翻页系统的类名冲突！）\x20*/\x0a.diary-entry-wrapper\x20{\x0a\x20\x20background:\x20var(--diary-page);\x0a\x20\x20padding:\x2020px;\x0a\x20\x20min-height:\x20400px;\x0a\x20\x20max-height:\x20500px;\x0a\x20\x20overflow-y:\x20auto;\x0a\x20\x20position:\x20relative;\x0a\x20\x20font-family:\x20\x27Noto\x20Serif\x20SC\x27,\x20Georgia,\x20serif;\x0a\x20\x20color:\x20var(--diary-ink-1);\x0a\x20\x20line-height:\x201.8;\x0a\x20\x20/*\x20滚动条样式\x20*/\x0a\x20\x20scrollbar-width:\x20thin;\x0a\x20\x20scrollbar-color:\x20var(--diary-ink-3)\x20transparent;\x0a}\x0a\x0a.diary-entry-wrapper::-webkit-scrollbar\x20{\x0a\x20\x20width:\x206px;\x0a}\x0a\x0a.diary-entry-wrapper::-webkit-scrollbar-track\x20{\x0a\x20\x20background:\x20transparent;\x0a}\x0a\x0a.diary-entry-wrapper::-webkit-scrollbar-thumb\x20{\x0a\x20\x20background:\x20var(--diary-ink-3);\x0a\x20\x20border-radius:\x203px;\x0a}\x0a\x0a.diary-entry-wrapper::-webkit-scrollbar-thumb:hover\x20{\x0a\x20\x20background:\x20var(--diary-ink-2);\x0a}\x0a\x0a/*\x20日记条目文本\x20*/\x0a.entry-text\x20{\x0a\x20\x20position:\x20relative;\x0a\x20\x20z-index:\x201;\x0a}\x0a\x0a/*\x20时间戳标记\x20*/\x0a.time-mark\x20{\x0a\x20\x20display:\x20inline-block;\x0a\x20\x20font-size:\x2011px;\x0a\x20\x20color:\x20var(--diary-ink-3);\x0a\x20\x20font-family:\x20\x27Courier\x20New\x27,\x20monospace;\x0a\x20\x20margin-right:\x208px;\x0a\x20\x20opacity:\x200.7;\x0a}\x0a\x0a/*\x20墨水颜色层级\x20*/\x0a.ink-2\x20{\x20color:\x20var(--diary-ink-2);\x20}\x0a.ink-3\x20{\x20color:\x20var(--diary-ink-3);\x20}\x0a\x0a/*\x20字体\x20*/\x0a.f-hand\x20{\x20font-family:\x20\x27Ma\x20Shan\x20Zheng\x27,\x20cursive,\x20sans-serif;\x20}\x0a.f-serif\x20{\x20font-family:\x20\x27Noto\x20Serif\x20SC\x27,\x20Georgia,\x20serif;\x20}\x0a.f-mono\x20{\x20font-family:\x20\x27Courier\x20New\x27,\x20\x27Source\x20Code\x20Pro\x27,\x20monospace;\x20}\x0a\x0a/*\x20字号\x20*/\x0a.fs-xs\x20{\x20font-size:\x2010px;\x20}\x0a.fs-sm\x20{\x20font-size:\x2012px;\x20}\x0a.fs-lg\x20{\x20font-size:\x2016px;\x20}\x0a.fs-xl\x20{\x20font-size:\x2020px;\x20}\x0a.fs-2xl\x20{\x20font-size:\x2024px;\x20}\x0a\x0a/*\x20字重\x20*/\x0a.fw-light\x20{\x20font-weight:\x20300;\x20}\x0a.fw-bold\x20{\x20font-weight:\x20700;\x20}\x0a.fw-black\x20{\x20font-weight:\x20900;\x20}\x0a\x0a/*\x20颜色\x20*/\x0a.c-red\x20{\x20color:\x20#dc2626;\x20}\x0a.c-blue\x20{\x20color:\x20#2563eb;\x20}\x0a.c-green\x20{\x20color:\x20#16a34a;\x20}\x0a.c-orange\x20{\x20color:\x20#ea580c;\x20}\x0a.c-purple\x20{\x20color:\x20#9333ea;\x20}\x0a.c-muted\x20{\x20color:\x20var(--diary-ink-3);\x20}\x0a\x0a/*\x20手写效果\x20*/\x0a.del\x20{\x0a\x20\x20text-decoration:\x20line-through;\x0a\x20\x20text-decoration-color:\x20var(--diary-ink-2);\x0a\x20\x20opacity:\x200.7;\x0a}\x0a.ins\x20{\x0a\x20\x20border-bottom:\x201px\x20dashed\x20var(--diary-ink-2);\x0a\x20\x20position:\x20relative;\x0a}\x0a.ins::before\x20{\x0a\x20\x20content:\x20\x27^\x27;\x0a\x20\x20position:\x20absolute;\x0a\x20\x20top:\x20-12px;\x0a\x20\x20left:\x2050%;\x0a\x20\x20transform:\x20translateX(-50%);\x0a\x20\x20font-size:\x2010px;\x0a\x20\x20color:\x20var(--diary-ink-2);\x0a}\x0a.circle\x20{\x0a\x20\x20border:\x201.5px\x20solid\x20var(--diary-ink-1);\x0a\x20\x20border-radius:\x2050%;\x0a\x20\x20padding:\x200\x204px;\x0a}\x0a.hl\x20{\x0a\x20\x20background:\x20linear-gradient(180deg,\x20transparent\x2060%,\x20#fef08a\x2060%);\x0a}\x0a.wavy\x20{\x0a\x20\x20text-decoration:\x20underline\x20wavy\x20var(--diary-ink-2);\x0a\x20\x20text-underline-offset:\x203px;\x0a}\x0a.underline\x20{\x0a\x20\x20text-decoration:\x20underline;\x0a\x20\x20text-underline-offset:\x202px;\x0a}\x0a\x0a/*\x20背景标记\x20*/\x0a.bg-mark-yellow\x20{\x20background:\x20rgba(254,\x20240,\x20138,\x200.6);\x20padding:\x200\x202px;\x20}\x0a.bg-mark-pink\x20{\x20background:\x20rgba(252,\x20231,\x20243,\x200.8);\x20padding:\x200\x202px;\x20}\x0a.bg-mark-blue\x20{\x20background:\x20rgba(219,\x20234,\x20254,\x200.8);\x20padding:\x200\x202px;\x20}\x0a.bg-mark-green\x20{\x20background:\x20rgba(220,\x20252,\x20231,\x200.8);\x20padding:\x200\x202px;\x20}\x0a\x0a/*\x20边框盒子\x20*/\x0a.box-solid\x20{\x20border:\x201.5px\x20solid\x20var(--diary-ink-1);\x20padding:\x204px\x208px;\x20display:\x20inline-block;\x20}\x0a.box-dashed\x20{\x20border:\x201.5px\x20dashed\x20var(--diary-ink-2);\x20padding:\x204px\x208px;\x20display:\x20inline-block;\x20}\x0a.box-double\x20{\x20border:\x203px\x20double\x20var(--diary-ink-1);\x20padding:\x204px\x208px;\x20display:\x20inline-block;\x20}\x0a\x0a/*\x20标签\x20*/\x0a.tag\x20{\x0a\x20\x20display:\x20inline-block;\x0a\x20\x20font-size:\x2010px;\x0a\x20\x20padding:\x201px\x206px;\x0a\x20\x20border-radius:\x203px;\x0a\x20\x20margin:\x200\x202px;\x0a}\x0a.tag-red\x20{\x20background:\x20#fee2e2;\x20color:\x20#dc2626;\x20}\x0a.tag-blue\x20{\x20background:\x20#dbeafe;\x20color:\x20#2563eb;\x20}\x0a.tag-green\x20{\x20background:\x20#dcfce7;\x20color:\x20#16a34a;\x20}\x0a\x0a/*\x20==========================================\x0a\x20\x20\x20排版布局（完整版）\x0a\x20\x20\x20==========================================\x20*/\x0a\x0a/*\x20诗歌排版\x20-\x20文艺角色\x20*/\x0a.layout-poem\x20{\x0a\x20\x20text-align:\x20center;\x0a\x20\x20line-height:\x202.2;\x0a\x20\x20letter-spacing:\x201px;\x0a}\x0a.layout-poem\x20.line\x20{\x0a\x20\x20display:\x20block;\x0a\x20\x20margin:\x204px\x200;\x0a}\x0a.layout-poem\x20.indent\x20{\x20margin-left:\x202em;\x20}\x0a.layout-poem\x20.indent-2\x20{\x20margin-left:\x204em;\x20}\x0a.layout-poem\x20.indent-3\x20{\x20margin-left:\x206em;\x20}\x0a\x0a/*\x20右对齐诗歌\x20*/\x0a.layout-poem-right\x20{\x0a\x20\x20text-align:\x20right;\x0a\x20\x20line-height:\x202;\x0a\x20\x20padding-right:\x2010px;\x0a}\x0a\x0a/*\x20阶梯式排版\x20-\x20每行递进\x20*/\x0a.layout-stairs\x20.line\x20{\x0a\x20\x20display:\x20block;\x0a}\x0a.layout-stairs\x20.line:nth-child(1)\x20{\x20margin-left:\x200;\x20}\x0a.layout-stairs\x20.line:nth-child(2)\x20{\x20margin-left:\x201em;\x20}\x0a.layout-stairs\x20.line:nth-child(3)\x20{\x20margin-left:\x202em;\x20}\x0a.layout-stairs\x20.line:nth-child(4)\x20{\x20margin-left:\x203em;\x20}\x0a.layout-stairs\x20.line:nth-child(5)\x20{\x20margin-left:\x204em;\x20}\x0a.layout-stairs\x20.line:nth-child(6)\x20{\x20margin-left:\x205em;\x20}\x0a.layout-stairs\x20.line:nth-child(7)\x20{\x20margin-left:\x206em;\x20}\x0a\x0a/*\x20反向阶梯\x20*/\x0a.layout-stairs-rev\x20.line\x20{\x0a\x20\x20display:\x20block;\x0a}\x0a.layout-stairs-rev\x20.line:nth-child(1)\x20{\x20margin-left:\x206em;\x20}\x0a.layout-stairs-rev\x20.line:nth-child(2)\x20{\x20margin-left:\x205em;\x20}\x0a.layout-stairs-rev\x20.line:nth-child(3)\x20{\x20margin-left:\x204em;\x20}\x0a.layout-stairs-rev\x20.line:nth-child(4)\x20{\x20margin-left:\x203em;\x20}\x0a.layout-stairs-rev\x20.line:nth-child(5)\x20{\x20margin-left:\x202em;\x20}\x0a.layout-stairs-rev\x20.line:nth-child(6)\x20{\x20margin-left:\x201em;\x20}\x0a.layout-stairs-rev\x20.line:nth-child(7)\x20{\x20margin-left:\x200;\x20}\x0a\x0a/*\x20乱糟糟排版\x20-\x20急躁角色\x20*/\x0a.layout-messy\x20{\x0a\x20\x20position:\x20relative;\x0a}\x0a.layout-messy\x20.chunk\x20{\x0a\x20\x20display:\x20inline-block;\x0a\x20\x20margin:\x202px;\x0a}\x0a.layout-messy\x20.chunk:nth-child(odd)\x20{\x20transform:\x20rotate(-2deg);\x20}\x0a.layout-messy\x20.chunk:nth-child(even)\x20{\x20transform:\x20rotate(2deg);\x20}\x0a.layout-messy\x20.chunk:nth-child(3n)\x20{\x20transform:\x20rotate(-4deg)\x20translateY(-2px);\x20}\x0a.layout-messy\x20.chunk:nth-child(5n)\x20{\x20transform:\x20rotate(3deg)\x20translateY(2px);\x20}\x0a\x0a/*\x20更乱的版本\x20*/\x0a.layout-chaos\x20.chunk\x20{\x0a\x20\x20display:\x20inline-block;\x0a\x20\x20margin:\x203px\x205px;\x0a}\x0a.layout-chaos\x20.chunk:nth-child(1)\x20{\x20transform:\x20rotate(-5deg);\x20}\x0a.layout-chaos\x20.chunk:nth-child(2)\x20{\x20transform:\x20rotate(4deg)\x20translateY(3px);\x20}\x0a.layout-chaos\x20.chunk:nth-child(3)\x20{\x20transform:\x20rotate(-3deg)\x20translateY(-2px);\x20}\x0a.layout-chaos\x20.chunk:nth-child(4)\x20{\x20transform:\x20rotate(6deg);\x20}\x0a.layout-chaos\x20.chunk:nth-child(5)\x20{\x20transform:\x20rotate(-4deg)\x20translateY(4px);\x20}\x0a.layout-chaos\x20.chunk:nth-child(6)\x20{\x20transform:\x20rotate(2deg)\x20translateY(-3px);\x20}\x0a.layout-chaos\x20.chunk:nth-child(7)\x20{\x20transform:\x20rotate(-6deg);\x20}\x0a\x0a/*\x20文字瀑布\x20-\x20垂直书写\x20*/\x0a.layout-vertical\x20{\x0a\x20\x20writing-mode:\x20vertical-rl;\x0a\x20\x20text-orientation:\x20mixed;\x0a\x20\x20height:\x20180px;\x0a\x20\x20line-height:\x201.8;\x0a\x20\x20letter-spacing:\x202px;\x0a}\x0a.layout-vertical-lr\x20{\x0a\x20\x20writing-mode:\x20vertical-lr;\x0a\x20\x20text-orientation:\x20mixed;\x0a\x20\x20height:\x20180px;\x0a\x20\x20line-height:\x201.8;\x0a}\x0a\x0a/*\x20散落式排版\x20*/\x0a.layout-scatter\x20{\x0a\x20\x20position:\x20relative;\x0a\x20\x20min-height:\x20100px;\x0a}\x0a.layout-scatter\x20.word\x20{\x0a\x20\x20position:\x20absolute;\x0a\x20\x20white-space:\x20nowrap;\x0a}\x0a\x0a/*\x20波浪式排版\x20*/\x0a.layout-wave\x20.char\x20{\x0a\x20\x20display:\x20inline-block;\x0a\x20\x20animation:\x20wave\x202s\x20ease-in-out\x20infinite;\x0a}\x0a.layout-wave\x20.char:nth-child(1)\x20{\x20animation-delay:\x200s;\x20}\x0a.layout-wave\x20.char:nth-child(2)\x20{\x20animation-delay:\x200.1s;\x20}\x0a.layout-wave\x20.char:nth-child(3)\x20{\x20animation-delay:\x200.2s;\x20}\x0a.layout-wave\x20.char:nth-child(4)\x20{\x20animation-delay:\x200.3s;\x20}\x0a.layout-wave\x20.char:nth-child(5)\x20{\x20animation-delay:\x200.4s;\x20}\x0a.layout-wave\x20.char:nth-child(6)\x20{\x20animation-delay:\x200.5s;\x20}\x0a.layout-wave\x20.char:nth-child(7)\x20{\x20animation-delay:\x200.6s;\x20}\x0a.layout-wave\x20.char:nth-child(8)\x20{\x20animation-delay:\x200.7s;\x20}\x0a@keyframes\x20wave\x20{\x0a\x20\x200%,\x20100%\x20{\x20transform:\x20translateY(0);\x20}\x0a\x20\x2050%\x20{\x20transform:\x20translateY(-4px);\x20}\x0a}\x0a\x0a/*\x20对话式排版\x20-\x20左右交替\x20*/\x0a.layout-dialog\x20.say\x20{\x0a\x20\x20display:\x20block;\x0a\x20\x20max-width:\x2080%;\x0a\x20\x20margin:\x206px\x200;\x0a\x20\x20padding:\x204px\x208px;\x0a\x20\x20border-radius:\x208px;\x0a\x20\x20background:\x20var(--bg-tertiary,\x20#f1f5f9);\x0a}\x0a.layout-dialog\x20.say-l\x20{\x0a\x20\x20margin-right:\x20auto;\x0a\x20\x20border-bottom-left-radius:\x202px;\x0a}\x0a.layout-dialog\x20.say-r\x20{\x0a\x20\x20margin-left:\x20auto;\x0a\x20\x20text-align:\x20right;\x0a\x20\x20border-bottom-right-radius:\x202px;\x0a}\x0a\x0a/*\x20打字机效果排版\x20*/\x0a.layout-typewriter\x20{\x0a\x20\x20font-family:\x20\x27JetBrains\x20Mono\x27,\x20\x27Courier\x20New\x27,\x20monospace;\x0a\x20\x20letter-spacing:\x200;\x0a\x20\x20line-height:\x201.8;\x0a}\x0a.layout-typewriter\x20.line\x20{\x0a\x20\x20display:\x20block;\x0a\x20\x20border-left:\x202px\x20solid\x20var(--diary-ink-3);\x0a\x20\x20padding-left:\x208px;\x0a\x20\x20margin:\x202px\x200;\x0a}\x0a\x0a/*\x20便签堆叠式\x20*/\x0a.layout-stack\x20{\x0a\x20\x20position:\x20relative;\x0a}\x0a.layout-stack\x20.note\x20{\x0a\x20\x20display:\x20block;\x0a\x20\x20padding:\x204px\x208px;\x0a\x20\x20margin:\x204px\x200;\x0a\x20\x20background:\x20var(--sticky-bg-1);\x0a\x20\x20border-left:\x202px\x20solid\x20var(--sticky-border-1);\x0a\x20\x20transform-origin:\x20left\x20center;\x0a}\x0a.layout-stack\x20.note:nth-child(odd)\x20{\x20transform:\x20rotate(-1deg);\x20}\x0a.layout-stack\x20.note:nth-child(even)\x20{\x20transform:\x20rotate(1deg);\x20}\x0a.layout-stack\x20.note:nth-child(3n)\x20{\x20background:\x20var(--sticky-bg-2);\x20border-color:\x20var(--sticky-border-2);\x20}\x0a.layout-stack\x20.note:nth-child(5n)\x20{\x20background:\x20var(--sticky-bg-3);\x20border-color:\x20var(--sticky-border-3);\x20}\x0a\x0a/*\x20气泡式排版\x20*/\x0a.layout-bubble\x20.bubble\x20{\x0a\x20\x20display:\x20inline-block;\x0a\x20\x20padding:\x203px\x208px;\x0a\x20\x20margin:\x203px;\x0a\x20\x20border-radius:\x2012px;\x0a\x20\x20background:\x20var(--bg-tertiary,\x20#f8fafc);\x0a\x20\x20border:\x201px\x20solid\x20var(--border-color,\x20#e2e8f0);\x0a}\x0a\x0a/*\x20螺旋式排版\x20-\x20渐变旋转\x20*/\x0a.layout-spiral\x20.part\x20{\x0a\x20\x20display:\x20inline-block;\x0a}\x0a.layout-spiral\x20.part:nth-child(1)\x20{\x20transform:\x20rotate(0deg);\x20}\x0a.layout-spiral\x20.part:nth-child(2)\x20{\x20transform:\x20rotate(2deg);\x20}\x0a.layout-spiral\x20.part:nth-child(3)\x20{\x20transform:\x20rotate(4deg);\x20}\x0a.layout-spiral\x20.part:nth-child(4)\x20{\x20transform:\x20rotate(6deg);\x20}\x0a.layout-spiral\x20.part:nth-child(5)\x20{\x20transform:\x20rotate(8deg);\x20}\x0a\x0a/*\x20呼吸效果\x20*/\x0a.layout-breath\x20.word\x20{\x0a\x20\x20display:\x20inline-block;\x0a\x20\x20animation:\x20breath\x203s\x20ease-in-out\x20infinite;\x0a}\x0a.layout-breath\x20.word:nth-child(odd)\x20{\x20animation-delay:\x200s;\x20}\x0a.layout-breath\x20.word:nth-child(even)\x20{\x20animation-delay:\x201.5s;\x20}\x0a@keyframes\x20breath\x20{\x0a\x20\x200%,\x20100%\x20{\x20transform:\x20scale(1);\x20opacity:\x201;\x20}\x0a\x20\x2050%\x20{\x20transform:\x20scale(1.05);\x20opacity:\x200.8;\x20}\x0a}\x0a\x0a/*\x20强调块\x20-\x20大字居中\x20*/\x0a.layout-hero\x20{\x0a\x20\x20text-align:\x20center;\x0a\x20\x20padding:\x2012px\x200;\x0a}\x0a.layout-hero\x20.big\x20{\x0a\x20\x20display:\x20block;\x0a\x20\x20font-size:\x2018px;\x0a\x20\x20font-weight:\x20600;\x0a\x20\x20line-height:\x201.3;\x0a}\x0a.layout-hero\x20.small\x20{\x0a\x20\x20display:\x20block;\x0a\x20\x20font-size:\x208px;\x0a\x20\x20color:\x20var(--diary-ink-3);\x0a\x20\x20margin-top:\x204px;\x0a}\x0a\x0a/*\x20列表式排版\x20*/\x0a.layout-list\x20.item\x20{\x0a\x20\x20display:\x20flex;\x0a\x20\x20align-items:\x20flex-start;\x0a\x20\x20gap:\x206px;\x0a\x20\x20margin:\x204px\x200;\x0a}\x0a.layout-list\x20.item::before\x20{\x0a\x20\x20content:\x20\x27—\x27;\x0a\x20\x20color:\x20var(--diary-ink-3);\x0a\x20\x20flex-shrink:\x200;\x0a}\x0a\x0a/*\x20标签云\x20*/\x0a.layout-cloud\x20{\x0a\x20\x20display:\x20flex;\x0a\x20\x20flex-wrap:\x20wrap;\x0a\x20\x20gap:\x204px;\x0a\x20\x20align-items:\x20center;\x0a}\x0a.layout-cloud\x20.word\x20{\x0a\x20\x20padding:\x202px\x206px;\x0a\x20\x20background:\x20var(--bg-tertiary,\x20#f1f5f9);\x0a\x20\x20border-radius:\x204px;\x0a\x20\x20font-size:\x20inherit;\x0a}\x0a.layout-cloud\x20.word:nth-child(3n)\x20{\x20font-size:\x201.1em;\x20}\x0a.layout-cloud\x20.word:nth-child(5n)\x20{\x20font-size:\x200.9em;\x20}\x0a.layout-cloud\x20.word:nth-child(7n)\x20{\x20font-size:\x201.2em;\x20}\x0a\x0a/*\x20时间线排版\x20*/\x0a.layout-timeline\x20{\x0a\x20\x20border-left:\x202px\x20solid\x20var(--diary-line);\x0a\x20\x20padding-left:\x2012px;\x0a\x20\x20margin-left:\x206px;\x0a}\x0a.layout-timeline\x20.event\x20{\x0a\x20\x20position:\x20relative;\x0a\x20\x20margin:\x208px\x200;\x0a}\x0a.layout-timeline\x20.event::before\x20{\x0a\x20\x20content:\x20\x27\x27;\x0a\x20\x20position:\x20absolute;\x0a\x20\x20left:\x20-16px;\x0a\x20\x20top:\x204px;\x0a\x20\x20width:\x206px;\x0a\x20\x20height:\x206px;\x0a\x20\x20border-radius:\x2050%;\x0a\x20\x20background:\x20var(--diary-ink-2);\x0a}\x0a\x0a/*\x20分栏排版\x20*/\x0a.layout-cols\x20{\x0a\x20\x20display:\x20grid;\x0a\x20\x20grid-template-columns:\x201fr\x201fr;\x0a\x20\x20gap:\x208px;\x0a}\x0a.layout-cols-3\x20{\x0a\x20\x20display:\x20grid;\x0a\x20\x20grid-template-columns:\x201fr\x201fr\x201fr;\x0a\x20\x20gap:\x206px;\x0a}\x0a\x0a/*\x20文字对齐\x20*/\x0a.text-center\x20{\x20text-align:\x20center;\x20}\x0a.text-right\x20{\x20text-align:\x20right;\x20}\x0a.text-left\x20{\x20text-align:\x20left;\x20}\x0a.text-justify\x20{\x20text-align:\x20justify;\x20}\x0a\x0a/*\x20旋转\x20*/\x0a.rotate-cw\x20{\x20transform:\x20rotate(2deg);\x20}\x0a.rotate-ccw\x20{\x20transform:\x20rotate(-2deg);\x20}\x0a\x0a/*\x20==========================================\x0a\x20\x20\x20装饰元素\x0a\x20\x20\x20==========================================\x20*/\x0a\x0a/*\x20便利贴\x20*/\x0a.sticky\x20{\x0a\x20\x20position:\x20absolute;\x0a\x20\x20padding:\x208px;\x0a\x20\x20font-size:\x2011px;\x0a\x20\x20box-shadow:\x202px\x202px\x205px\x20rgba(0,0,0,0.1);\x0a\x20\x20z-index:\x2010;\x0a}\x0a.sticky.s1\x20{\x0a\x20\x20background:\x20var(--sticky-bg-1);\x0a\x20\x20border-left:\x203px\x20solid\x20var(--sticky-border-1);\x0a}\x0a.sticky.s2\x20{\x0a\x20\x20background:\x20var(--sticky-bg-2);\x0a\x20\x20border-left:\x203px\x20solid\x20var(--sticky-border-2);\x0a}\x0a.sticky.s3\x20{\x0a\x20\x20background:\x20var(--sticky-bg-3);\x0a\x20\x20border-left:\x203px\x20solid\x20var(--sticky-border-3);\x0a}\x0a.sticky-head\x20{\x0a\x20\x20display:\x20flex;\x0a\x20\x20justify-content:\x20space-between;\x0a\x20\x20font-size:\x209px;\x0a\x20\x20color:\x20#666;\x0a\x20\x20margin-bottom:\x204px;\x0a\x20\x20font-weight:\x20600;\x0a\x20\x20text-transform:\x20uppercase;\x0a}\x0a.sticky-body\x20{\x0a\x20\x20line-height:\x201.4;\x0a}\x0a\x0a/*\x20旁注\x20*/\x0a.margin-note\x20{\x0a\x20\x20position:\x20absolute;\x0a\x20\x20right:\x20-10px;\x0a\x20\x20width:\x2060px;\x0a\x20\x20font-size:\x2010px;\x0a\x20\x20color:\x20var(--diary-ink-3);\x0a\x20\x20font-style:\x20italic;\x0a\x20\x20transform:\x20rotate(-5deg);\x0a\x20\x20border-left:\x202px\x20solid\x20var(--sticky-border-2);\x0a\x20\x20padding-left:\x204px;\x0a}\x0a\x0a/*\x20胶带\x20*/\x0a.tape\x20{\x0a\x20\x20position:\x20absolute;\x0a\x20\x20height:\x2020px;\x0a\x20\x20background:\x20linear-gradient(90deg,\x0a\x20\x20\x20\x20rgba(255,255,255,0.1)\x200%,\x0a\x20\x20\x20\x20rgba(255,255,255,0.3)\x2050%,\x0a\x20\x20\x20\x20rgba(255,255,255,0.1)\x20100%\x0a\x20\x20);\x0a\x20\x20background-color:\x20rgba(200,\x20200,\x20180,\x200.6);\x0a\x20\x20box-shadow:\x200\x201px\x203px\x20rgba(0,0,0,0.1);\x0a\x20\x20z-index:\x2015;\x0a}\x0a\x0a/*\x20邮戳\x20*/\x0a.stamp\x20{\x0a\x20\x20position:\x20absolute;\x0a\x20\x20width:\x2050px;\x0a\x20\x20height:\x2050px;\x0a\x20\x20border:\x202px\x20dashed\x20var(--diary-ink-3);\x0a\x20\x20border-radius:\x2050%;\x0a\x20\x20display:\x20flex;\x0a\x20\x20flex-direction:\x20column;\x0a\x20\x20align-items:\x20center;\x0a\x20\x20justify-content:\x20center;\x0a\x20\x20font-size:\x208px;\x0a\x20\x20color:\x20var(--diary-ink-3);\x0a\x20\x20opacity:\x200.7;\x0a\x20\x20transform:\x20rotate(-15deg);\x0a}\x0a.stamp\x20strong\x20{\x0a\x20\x20font-size:\x2012px;\x0a\x20\x20font-weight:\x20700;\x0a}\x0a\x0a/*\x20贴纸\x20*/\x0a.sticker\x20{\x0a\x20\x20position:\x20absolute;\x0a\x20\x20z-index:\x2012;\x0a\x20\x20filter:\x20drop-shadow(1px\x201px\x202px\x20rgba(0,0,0,0.2));\x0a}\x0a\x0a/*\x20引用线\x20*/\x0a.quote-line\x20{\x0a\x20\x20display:\x20block;\x0a\x20\x20padding-left:\x2012px;\x0a\x20\x20border-left:\x203px\x20solid\x20var(--diary-ink-3);\x0a\x20\x20font-style:\x20italic;\x0a\x20\x20color:\x20var(--diary-ink-2);\x0a\x20\x20margin:\x208px\x200;\x0a}\x0a\x0a/*\x20行距\x20*/\x0a.leading-tight\x20{\x20line-height:\x201.2;\x20}\x0a.leading-normal\x20{\x20line-height:\x201.5;\x20}\x0a.leading-loose\x20{\x20line-height:\x202;\x20}\x0a.leading-xl\x20{\x20line-height:\x202.5;\x20}\x0a\x0a/*\x20字间距\x20*/\x0a.tracking-tight\x20{\x20letter-spacing:\x20-0.5px;\x20}\x0a.tracking-normal\x20{\x20letter-spacing:\x200;\x20}\x0a.tracking-wide\x20{\x20letter-spacing:\x201px;\x20}\x0a.tracking-wider\x20{\x20letter-spacing:\x202px;\x20}\x0a\x0a/*\x20==========================================\x0a\x20\x20\x20扩展样式\x20-\x20更多自定义选项\x0a\x20\x20\x20==========================================\x20*/\x0a\x0a/*\x20更多字体\x20*/\x0a.f-cute\x20{\x20font-family:\x20\x27Comic\x20Sans\x20MS\x27,\x20\x27Chalkboard\x27,\x20cursive;\x20}\x0a.f-elegant\x20{\x20font-family:\x20\x27Playfair\x20Display\x27,\x20\x27Times\x20New\x20Roman\x27,\x20serif;\x20}\x0a\x0a/*\x20更多字号\x20*/\x0a.fs-3xl\x20{\x20font-size:\x2030px;\x20}\x0a\x0a/*\x20更多颜色\x20*/\x0a.c-pink\x20{\x20color:\x20#ec4899;\x20}\x0a.c-gold\x20{\x20color:\x20#d97706;\x20}\x0a\x0a/*\x20涂鸦划掉效果\x20*/\x0a.scribble\x20{\x0a\x20\x20position:\x20relative;\x0a\x20\x20opacity:\x200.6;\x0a}\x0a.scribble::after\x20{\x0a\x20\x20content:\x20\x27\x27;\x0a\x20\x20position:\x20absolute;\x0a\x20\x20left:\x20-2px;\x0a\x20\x20right:\x20-2px;\x0a\x20\x20top:\x2045%;\x0a\x20\x20height:\x203px;\x0a\x20\x20background:\x20currentColor;\x0a\x20\x20transform:\x20rotate(-2deg);\x0a}\x0a\x0a/*\x20紫色高亮\x20*/\x0a.bg-mark-purple\x20{\x20background:\x20rgba(233,\x20213,\x20255,\x200.8);\x20padding:\x200\x202px;\x20}\x0a\x0a/*\x20更多便利贴颜色\x20*/\x0a.sticky.s4\x20{\x0a\x20\x20background:\x20#dcfce7;\x0a\x20\x20border-left:\x203px\x20solid\x20#22c55e;\x0a}\x0a.sticky.s5\x20{\x0a\x20\x20background:\x20#f3e8ff;\x0a\x20\x20border-left:\x203px\x20solid\x20#a855f7;\x0a}\x0a.sticky.s6\x20{\x0a\x20\x20background:\x20#ffedd5;\x0a\x20\x20border-left:\x203px\x20solid\x20#f97316;\x0a}\x0a\x0a/*\x20便利贴形状\x20*/\x0a.sticky.sticky-square\x20{\x20border-radius:\x200;\x20}\x0a.sticky.sticky-rect\x20{\x20border-radius:\x200;\x20min-width:\x20100px;\x20}\x0a.sticky.sticky-flag\x20{\x0a\x20\x20border-radius:\x200;\x0a\x20\x20clip-path:\x20polygon(0\x200,\x20100%\x200,\x20100%\x2080%,\x2050%\x2095%,\x200\x2080%);\x0a\x20\x20padding:\x208px\x208px\x2018px;\x0a\x20\x20min-width:\x2090px;\x0a\x20\x20height:\x20auto;\x0a\x20\x20max-height:\x20110px;\x0a}\x0a.sticky.sticky-flag\x20.sticky-body\x20{\x0a\x20\x20max-height:\x2070px;\x0a\x20\x20overflow-y:\x20auto;\x0a\x20\x20overflow-x:\x20hidden;\x0a\x20\x20font-size:\x2010px;\x0a\x20\x20line-height:\x201.3;\x0a\x20\x20scrollbar-width:\x20thin;\x0a\x20\x20scrollbar-color:\x20rgba(0,0,0,0.2)\x20transparent;\x0a}\x0a.sticky.sticky-flag\x20.sticky-body::-webkit-scrollbar\x20{\x0a\x20\x20width:\x203px;\x0a}\x0a.sticky.sticky-flag\x20.sticky-body::-webkit-scrollbar-thumb\x20{\x0a\x20\x20background:\x20rgba(0,0,0,0.2);\x0a\x20\x20border-radius:\x202px;\x0a}\x0a.sticky.sticky-heart\x20{\x0a\x20\x20border:\x20none;\x0a\x20\x20background:\x20#fce7f3;\x0a\x20\x20clip-path:\x20path(\x27M12\x2021.35l-1.45-1.32C5.4\x2015.36\x202\x2012.28\x202\x208.5\x202\x205.42\x204.42\x203\x207.5\x203c1.74\x200\x203.41.81\x204.5\x202.09C13.09\x203.81\x2014.76\x203\x2016.5\x203\x2019.58\x203\x2022\x205.42\x2022\x208.5c0\x203.78-3.4\x206.86-8.55\x2011.54L12\x2021.35z\x27);\x0a\x20\x20width:\x2075px;\x0a\x20\x20height:\x2072px;\x0a\x20\x20padding:\x2016px\x2012px\x2022px;\x0a\x20\x20display:\x20flex;\x0a\x20\x20flex-direction:\x20column;\x0a}\x0a.sticky.sticky-heart\x20.sticky-body\x20{\x0a\x20\x20flex:\x201;\x0a\x20\x20max-height:\x2040px;\x0a\x20\x20overflow-y:\x20auto;\x0a\x20\x20overflow-x:\x20hidden;\x0a\x20\x20font-size:\x209px;\x0a\x20\x20line-height:\x201.25;\x0a\x20\x20scrollbar-width:\x20thin;\x0a\x20\x20scrollbar-color:\x20rgba(236,72,153,0.3)\x20transparent;\x0a}\x0a.sticky.sticky-heart\x20.sticky-body::-webkit-scrollbar\x20{\x0a\x20\x20width:\x203px;\x0a}\x0a.sticky.sticky-heart\x20.sticky-body::-webkit-scrollbar-thumb\x20{\x0a\x20\x20background:\x20rgba(236,72,153,0.3);\x0a\x20\x20border-radius:\x202px;\x0a}\x0a.sticky.sticky-star\x20{\x0a\x20\x20border:\x20none;\x0a\x20\x20background:\x20#fef9c3;\x0a\x20\x20clip-path:\x20polygon(50%\x200%,\x2061%\x2035%,\x2098%\x2035%,\x2068%\x2057%,\x2079%\x2091%,\x2050%\x2070%,\x2021%\x2091%,\x2032%\x2057%,\x202%\x2035%,\x2039%\x2035%);\x0a\x20\x20width:\x2085px;\x0a\x20\x20height:\x2085px;\x0a\x20\x20padding:\x2022px\x2016px\x2026px;\x0a\x20\x20text-align:\x20center;\x0a\x20\x20display:\x20flex;\x0a\x20\x20flex-direction:\x20column;\x0a\x20\x20align-items:\x20center;\x0a\x20\x20justify-content:\x20center;\x0a}\x0a.sticky.sticky-star\x20.sticky-body\x20{\x0a\x20\x20max-height:\x2045px;\x0a\x20\x20overflow-y:\x20auto;\x0a\x20\x20overflow-x:\x20hidden;\x0a\x20\x20font-size:\x209px;\x0a\x20\x20line-height:\x201.25;\x0a\x20\x20scrollbar-width:\x20thin;\x0a\x20\x20scrollbar-color:\x20rgba(234,179,8,0.3)\x20transparent;\x0a}\x0a.sticky.sticky-star\x20.sticky-body::-webkit-scrollbar\x20{\x0a\x20\x20width:\x203px;\x0a}\x0a.sticky.sticky-star\x20.sticky-body::-webkit-scrollbar-thumb\x20{\x0a\x20\x20background:\x20rgba(234,179,8,0.3);\x0a\x20\x20border-radius:\x202px;\x0a}\x0a.sticky.sticky-cloud\x20{\x0a\x20\x20border:\x20none;\x0a\x20\x20background:\x20#e0f2fe;\x0a\x20\x20border-radius:\x2050px;\x0a\x20\x20padding:\x2012px\x2016px;\x0a\x20\x20min-width:\x2085px;\x0a\x20\x20max-width:\x20120px;\x0a}\x0a.sticky.sticky-cloud\x20.sticky-body\x20{\x0a\x20\x20max-height:\x2060px;\x0a\x20\x20overflow-y:\x20auto;\x0a\x20\x20overflow-x:\x20hidden;\x0a\x20\x20scrollbar-width:\x20thin;\x0a\x20\x20scrollbar-color:\x20rgba(96,165,250,0.3)\x20transparent;\x0a}\x0a.sticky.sticky-cloud\x20.sticky-body::-webkit-scrollbar\x20{\x0a\x20\x20width:\x203px;\x0a}\x0a.sticky.sticky-cloud\x20.sticky-body::-webkit-scrollbar-thumb\x20{\x0a\x20\x20background:\x20rgba(96,165,250,0.3);\x0a\x20\x20border-radius:\x202px;\x0a}\x0a\x0a/*\x20胶带颜色\x20*/\x0a.tape.tape-yellow\x20{\x20background-color:\x20rgba(254,\x20240,\x20138,\x200.7);\x20}\x0a.tape.tape-pink\x20{\x20background-color:\x20rgba(252,\x20207,\x20224,\x200.7);\x20}\x0a.tape.tape-blue\x20{\x20background-color:\x20rgba(191,\x20219,\x20254,\x200.7);\x20}\x0a.tape.tape-clear\x20{\x20background-color:\x20rgba(255,\x20255,\x20255,\x200.4);\x20}\x0a\x0a/*\x20邮戳样式\x20*/\x0a.stamp.stamp-date\x20{\x20border-color:\x20#64748b;\x20color:\x20#64748b;\x20}\x0a.stamp.stamp-love\x20{\x20border-color:\x20#ec4899;\x20color:\x20#ec4899;\x20}\x0a.stamp.stamp-star\x20{\x20border-color:\x20#eab308;\x20color:\x20#eab308;\x20}\x0a.stamp.stamp-check\x20{\x20border-color:\x20#22c55e;\x20color:\x20#22c55e;\x20}\x0a\x0a/*\x20和纸胶带\x20*/\x0a.washi\x20{\x0a\x20\x20position:\x20absolute;\x0a\x20\x20height:\x2024px;\x0a\x20\x20background-repeat:\x20repeat-x;\x0a\x20\x20opacity:\x200.85;\x0a\x20\x20z-index:\x2014;\x0a}\x0a.washi.washi-dots\x20{\x0a\x20\x20background:\x20repeating-linear-gradient(90deg,\x20#fbbf24\x200px,\x20#fbbf24\x204px,\x20transparent\x204px,\x20transparent\x208px);\x0a\x20\x20background-color:\x20rgba(254,\x20243,\x20199,\x200.8);\x0a}\x0a.washi.washi-stripe\x20{\x0a\x20\x20background:\x20repeating-linear-gradient(45deg,\x20#f472b6\x200px,\x20#f472b6\x202px,\x20transparent\x202px,\x20transparent\x206px);\x0a\x20\x20background-color:\x20rgba(252,\x20231,\x20243,\x200.8);\x0a}\x0a.washi.washi-floral\x20{\x0a\x20\x20background-color:\x20rgba(220,\x20252,\x20231,\x200.8);\x0a\x20\x20background-image:\x20radial-gradient(circle,\x20#86efac\x202px,\x20transparent\x202px);\x0a\x20\x20background-size:\x208px\x208px;\x0a}\x0a\x0a/*\x20涂鸦装饰\x20*/\x0a.doodle\x20{\x0a\x20\x20position:\x20absolute;\x0a\x20\x20z-index:\x2013;\x0a\x20\x20opacity:\x200.6;\x0a}\x0a.doodle.doodle-heart::before\x20{\x20content:\x20\x27♡\x27;\x20font-size:\x2020px;\x20color:\x20#ec4899;\x20}\x0a.doodle.doodle-star::before\x20{\x20content:\x20\x27☆\x27;\x20font-size:\x2020px;\x20color:\x20#eab308;\x20}\x0a.doodle.doodle-cloud::before\x20{\x20content:\x20\x27☁\x27;\x20font-size:\x2020px;\x20color:\x20#60a5fa;\x20}\x0a.doodle.doodle-arrow::before\x20{\x20content:\x20\x27→\x27;\x20font-size:\x2018px;\x20color:\x20#64748b;\x20}\x0a.doodle.doodle-sparkle::before\x20{\x20content:\x20\x27✦\x27;\x20font-size:\x2016px;\x20color:\x20#a855f7;\x20}\x0a\x0a/*\x20照片框\x20*/\x0a.photo-frame\x20{\x0a\x20\x20display:\x20inline-block;\x0a\x20\x20padding:\x208px;\x0a\x20\x20background:\x20white;\x0a\x20\x20border:\x201px\x20solid\x20#e2e8f0;\x0a\x20\x20box-shadow:\x202px\x202px\x208px\x20rgba(0,0,0,0.1);\x0a\x20\x20transform:\x20rotate(-2deg);\x0a\x20\x20margin:\x208px;\x0a\x20\x20font-size:\x2011px;\x0a\x20\x20text-align:\x20center;\x0a\x20\x20color:\x20#64748b;\x0a}\x0a.photo-frame::before\x20{\x0a\x20\x20content:\x20\x27📷\x27;\x0a\x20\x20display:\x20block;\x0a\x20\x20font-size:\x2024px;\x0a\x20\x20margin-bottom:\x204px;\x0a}\x0a\x0a/*\x20票据/票根\x20*/\x0a.ticket\x20{\x0a\x20\x20display:\x20inline-block;\x0a\x20\x20padding:\x206px\x2012px;\x0a\x20\x20background:\x20linear-gradient(90deg,\x20#fef3c7\x200%,\x20#fef9c3\x20100%);\x0a\x20\x20border:\x201px\x20dashed\x20#d97706;\x0a\x20\x20border-radius:\x204px;\x0a\x20\x20font-size:\x2011px;\x0a\x20\x20color:\x20#92400e;\x0a\x20\x20position:\x20relative;\x0a}\x0a.ticket::before,\x0a.ticket::after\x20{\x0a\x20\x20content:\x20\x27\x27;\x0a\x20\x20position:\x20absolute;\x0a\x20\x20width:\x208px;\x0a\x20\x20height:\x208px;\x0a\x20\x20background:\x20var(--diary-page,\x20#fffef5);\x0a\x20\x20border-radius:\x2050%;\x0a\x20\x20top:\x2050%;\x0a\x20\x20transform:\x20translateY(-50%);\x0a}\x0a.ticket::before\x20{\x20left:\x20-4px;\x20}\x0a.ticket::after\x20{\x20right:\x20-4px;\x20}\x0a.ticket-head\x20{\x0a\x20\x20text-align:\x20center;\x0a\x20\x20font-weight:\x20600;\x0a\x20\x20padding-bottom:\x204px;\x0a\x20\x20border-bottom:\x201px\x20dotted\x20#d97706;\x0a\x20\x20margin-bottom:\x204px;\x0a\x20\x20letter-spacing:\x201px;\x0a}\x0a.ticket-row\x20{\x0a\x20\x20display:\x20flex;\x0a\x20\x20justify-content:\x20space-between;\x0a\x20\x20line-height:\x201.5;\x0a}\x0a\x0a/*\x20回形针\x20*/\x0a.clip\x20{\x0a\x20\x20position:\x20absolute;\x0a\x20\x20width:\x2020px;\x0a\x20\x20height:\x2050px;\x0a\x20\x20z-index:\x2053;\x0a}\x0a.clip::before,\x0a.clip::after\x20{\x0a\x20\x20content:\x20\x27\x27;\x0a\x20\x20position:\x20absolute;\x0a\x20\x20border:\x202px\x20solid\x20#94a3b8;\x0a\x20\x20border-radius:\x2010px\x2010px\x200\x200;\x0a}\x0a.clip::before\x20{\x0a\x20\x20width:\x2016px;\x0a\x20\x20height:\x2028px;\x0a\x20\x20top:\x200;\x0a\x20\x20left:\x2050%;\x0a\x20\x20transform:\x20translateX(-50%);\x0a\x20\x20border-bottom:\x20none;\x0a}\x0a.clip::after\x20{\x0a\x20\x20width:\x2010px;\x0a\x20\x20height:\x2020px;\x0a\x20\x20top:\x208px;\x0a\x20\x20left:\x2050%;\x0a\x20\x20transform:\x20translateX(-50%);\x0a\x20\x20border-bottom:\x20none;\x0a}\x0a\x0a/*\x20照片框完整样式\x20*/\x0a.photo-img\x20{\x0a\x20\x20width:\x20100%;\x0a\x20\x20aspect-ratio:\x204/3;\x0a\x20\x20background:\x20#f1f5f9;\x0a\x20\x20border:\x201px\x20solid\x20#e2e8f0;\x0a\x20\x20display:\x20flex;\x0a\x20\x20align-items:\x20center;\x0a\x20\x20justify-content:\x20center;\x0a\x20\x20font-size:\x2020px;\x0a\x20\x20color:\x20#94a3b8;\x0a\x20\x20margin-bottom:\x204px;\x0a}\x0a.photo-caption\x20{\x0a\x20\x20font-size:\x2010px;\x0a\x20\x20color:\x20#64748b;\x0a\x20\x20text-align:\x20center;\x0a\x20\x20font-style:\x20italic;\x0a}\x0a\x0a/*\x20标签贴\x20*/\x0a.label-tag\x20{\x0a\x20\x20position:\x20absolute;\x0a\x20\x20padding:\x203px\x208px\x203px\x206px;\x0a\x20\x20background:\x20#1e293b;\x0a\x20\x20color:\x20#f8fafc;\x0a\x20\x20font-size:\x208px;\x0a\x20\x20font-weight:\x20600;\x0a\x20\x20letter-spacing:\x201px;\x0a\x20\x20text-transform:\x20uppercase;\x0a\x20\x20clip-path:\x20polygon(8px\x200%,\x20100%\x200%,\x20100%\x20100%,\x208px\x20100%,\x200%\x2050%);\x0a\x20\x20z-index:\x2047;\x0a}\x0a\x0a/*\x20箭头注释\x20*/\x0a.arrow-note\x20{\x0a\x20\x20position:\x20absolute;\x0a\x20\x20font-size:\x2010px;\x0a\x20\x20color:\x20var(--diary-ink-3);\x0a\x20\x20display:\x20flex;\x0a\x20\x20align-items:\x20center;\x0a\x20\x20gap:\x203px;\x0a\x20\x20font-style:\x20italic;\x0a}\x0a.arrow-note::before\x20{\x0a\x20\x20content:\x20\x27\x5c2192\x27;\x0a\x20\x20font-size:\x2012px;\x0a\x20\x20font-style:\x20normal;\x0a}\x0a\x0a/*\x20分隔线\x20*/\x0a.divider\x20{\x0a\x20\x20display:\x20flex;\x0a\x20\x20align-items:\x20center;\x0a\x20\x20gap:\x208px;\x0a\x20\x20margin:\x2012px\x200;\x0a\x20\x20font-size:\x2010px;\x0a\x20\x20color:\x20var(--diary-ink-3);\x0a}\x0a.divider::before,\x0a.divider::after\x20{\x0a\x20\x20content:\x20\x27\x27;\x0a\x20\x20flex:\x201;\x0a\x20\x20height:\x201px;\x0a\x20\x20background:\x20var(--diary-line);\x0a}\x0a\x0a/*\x20拼贴布局\x20*/\x0a.layout-collage\x20{\x0a\x20\x20display:\x20grid;\x0a\x20\x20grid-template-columns:\x20repeat(3,\x201fr);\x0a\x20\x20gap:\x208px;\x0a\x20\x20transform:\x20rotate(-1deg);\x0a}\x0a.layout-collage\x20>\x20*\x20{\x0a\x20\x20transform:\x20rotate(var(--rotate,\x200deg));\x0a}\x0a.layout-collage\x20>\x20*:nth-child(odd)\x20{\x20--rotate:\x202deg;\x20}\x0a.layout-collage\x20>\x20*:nth-child(even)\x20{\x20--rotate:\x20-2deg;\x20}\x0a.layout-collage\x20>\x20*:nth-child(3n)\x20{\x20--rotate:\x20-3deg;\x20}\x0a\x0a/*\x20==========================================\x0a\x20\x20\x20深色模式适配\x0a\x20\x20\x20==========================================\x20*/\x0a@media\x20(prefers-color-scheme:\x20dark)\x20{\x0a\x20\x20:root\x20{\x0a\x20\x20\x20\x20--diary-cover:\x20#1a1a2e;\x0a\x20\x20\x20\x20--diary-cover-text:\x20#e2e8f0;\x0a\x20\x20\x20\x20--diary-page:\x20#1e1e2e;\x0a\x20\x20\x20\x20--diary-ink-1:\x20#e2e8f0;\x0a\x20\x20\x20\x20--diary-ink-2:\x20#a0aec0;\x0a\x20\x20\x20\x20--diary-ink-3:\x20#718096;\x0a\x20\x20\x20\x20--diary-line:\x20#2d3748;\x0a\x20\x20\x20\x20--sticky-bg-1:\x20#3d3d1a;\x0a\x20\x20\x20\x20--sticky-bg-2:\x20#3d1a2e;\x0a\x20\x20\x20\x20--sticky-bg-3:\x20#1a2e3d;\x0a\x20\x20}\x0a\x0a\x20\x20.layout-dialog\x20.say-l\x20{\x20background:\x20#2d3748;\x20}\x0a\x20\x20.layout-dialog\x20.say-r\x20{\x20background:\x20#1e3a5f;\x20}\x0a\x20\x20.layout-bubble\x20.bubble\x20{\x20background:\x20#2d3748;\x20border-color:\x20#4a5568;\x20}\x0a\x20\x20.hl\x20{\x20background:\x20linear-gradient(180deg,\x20transparent\x2060%,\x20rgba(254,\x20240,\x20138,\x200.3)\x2060%);\x20}\x0a}\x0a','365tgxdps','Messages','\x0a\x0a###\x20性格与背景','substr','mmpages','[配图','❌\x20更新头像失败:','placeholder','世界观预设/知识库','\x20tokens','round','playlistOverlay','图片已添加','加载角色专辑封面失败:','noteId','https://i.postimg.cc/4xmx7V4R/mmexport1759081128356.jpg','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>','color','audioUrl','mmpagesEditAvatarPreview','#baobaobookEntryDrawerSubtitle','\x0a\x20\x20\x20\x20\x20\x20\x20\x20/*\x20Mmpages\x20动态更多菜单\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-more\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20relative;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-menu\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20absolute;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20right:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20var(--bg-secondary,\x20#fff);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x204px\x2020px\x20rgba(0,\x200,\x200,\x200.15);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20visibility:\x20hidden;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20translateY(-10px)\x20scale(0.95);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20all\x200.2s\x20ease;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x20100;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20overflow:\x20hidden;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-menu.active\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20visibility:\x20visible;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20translateY(5px)\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-menu-item\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20background\x200.15s;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-menu-item:hover\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20var(--bg-tertiary,\x20#f5f5f5);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-menu-item\x20svg\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20flex-shrink:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20block;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-menu-item\x20span\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20white-space:\x20nowrap;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20line-height:\x201;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20block;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-menu-delete\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#888;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-menu-delete:hover\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(128,\x20128,\x20128,\x200.15);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#666;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20/*\x20暗色模式适配\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20@media\x20(prefers-color-scheme:\x20dark)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-menu\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#1a1a1a;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x201px\x20solid\x20#333;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x204px\x2020px\x20rgba(0,\x200,\x200,\x200.5);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-menu-item:hover\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#2a2a2a;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-menu-delete\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#aaa;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.mmpages-post-menu-delete:hover\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#ccc;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20','-\x20只在合适的情绪/反应场景使用。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-pinned-item\x22\x20onclick=\x22openImessageChat(\x27','<p>（无内容）</p>','smsInput',');\x22\x20style=\x22cursor:\x20pointer;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-post-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-post-avatar-wrapper\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-post-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','null','mmpages-menu-styles','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22recent-call-type\x20',')\x22></div>','✅\x20[删除回复]\x20commentIndex=','✅\x20[删除评论]\x20commentIndex=','❌\x20[Thread\x20Detail]\x20获取用户头像失败:','Play','Song\x20search\x20failed:','Black\x20and\x20white\x20keys.','closing','global','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22thread-comment-time\x22>','orbitOrb','baobaobook-entry-list','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','❌\x20删除笔记失败:','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-history-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-history-label\x20','请选择图片文件','hint','callFloatingBall','📜\x20[Thread]\x20读取了\x20','bound','chatId','playlistNextBtn','deg);','ID\x20','📱\x20[Recent]\x20User\x20profile\x20not\x20found:','❌\x20角色不存在:','textContent','removeEventListener','<div\x20class=\x22thread-profile-check\x22>✓</div>','👤\x20Add\x20contact:','diary-entry-content','没有消息记录','default','add','parentElement','MOMENTS','musicWidgetChangeListBtn','touchAction','getFullYear','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-sticky\x20','classList','📱\x20[SMS重回]\x20找到\x20','MEMORIES','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-title\x22>','missed','编辑条目','offsetX','📱\x20返回iMessage列表','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22baobaobook-entry-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22baobaobook-entry-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22baobaobook-entry-name\x22>','toggleThreadReplies','push','querySelector','.phone-main-content','中国联通','hour','\x20-</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-deco\x22><i></i><i></i><i></i></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-btn\x20prev\x22\x20onclick=\x22diaryFlip(-1)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M15\x2018l-6-6\x206-6\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-btn\x20next\x22\x20onclick=\x22diaryFlip(1)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M9\x2018l6-6-6-6\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','sortBy','songSearchList','发送失败:\x20','wxyz','addImageGalleryCategory','\x0a代称：','imageGalleryImagesPanel','user','phone-call-screen\x20state-','[characterId+sessionId+profileId]','-\x20评论风格：简短自然，像真实的社交平台评论；不要写成长篇大论。','⚠️\x20没有当前Mmpages角色','<span\x20class=\x22image-gallery-category-badge\x20universal\x22>通用</span>','📈\x20总计:\x20','✅\x20百宝书条目已保存:','moved','Edit','密码错误，还可以尝试','📱\x20[SMS删除]\x20删除后剩余消息:','角色资料/系统构建','[用户拨通了电话]','lyricLines','📝\x20打开Mmpages编辑弹窗','sin','API\x20来源','\x0a\x0a###\x20你的当前状态\x0a「','image/','Heavenly','toUpperCase','##\x20用户歌单列表\x0a','currentChatId','Playlist','📝\x20[Thread评论]\x20profileId:','✅\x20Thread评论输入框已初始化','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','.thread-reply-avatar','smsDetailScreen','INVITE','emitSystem','<svg\x20viewBox=\x220\x200\x2024\x2024\x22><rect\x20x=\x226\x22\x20y=\x224\x22\x20width=\x224\x22\x20height=\x2216\x22\x20rx=\x221\x22></rect><rect\x20x=\x2214\x22\x20y=\x224\x22\x20width=\x224\x22\x20height=\x2216\x22\x20rx=\x221\x22></rect></svg>','🔍\x20[DEBUG]\x20initCallWithAI返回结果:','percentage',']\x20@','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22thread-post-time\x22>','mmpagesEditBioNote','hidden','#baobaobookEntryDrawerTitleText','\x22或其他被回复者）\x0a\x0a**comment|main（新的主评论）：**\x0a-\x20其他人刷新出来的新主评论\x0a-\x20username:\x20评论者名字\x0a-\x20content:\x20评论内容（10-80字）\x0a\x0a###\x20CRITICAL\x20RULES\x0a\x0a1.\x20**PIPE-LINE\x20v1**\x20-\x20禁止JSON\x0a2.\x20**Close\x20</thinking>\x20BEFORE\x20PIPE-LINE**\x20-\x20thinking标签必须在PIPE-LINE之前关闭\x0a3.\x20**affection\x20+\x20reason**\x20-\x20必填，好感度和变化原因\x0a4.\x20**comment|reply**\x20-\x20通常有2-5条（作者回复和/或路人回复）\x0a5.\x20**comment|main**\x20-\x20必选，1-8条新主评论\x0a6.\x20**NO\x20text\x20outside\x20PIPE-LINE**\x20-\x20PIPE-LINE外不要有任何文字\x0a\x0a###\x20社交圈规则（强制，违反即失败）\x0a\x0a这是私密朋友圈，**绝对禁止陌生人评论**。所有评论者必须：\x0a1.\x20是角色现实生活中认识的人（家人/朋友/同学/同事/网友）\x0a2.\x20评论内容**必须体现熟悉感**：知道角色近况、用昵称称呼、开熟悉的玩笑、提及共同经历\x0a3.\x20username是网名，禁止暴露真实关系\x0a4.\x20口吻符合与角色的关系（长辈关心、朋友调侃、同学熟络）\x0a\x0aEXECUTE\x20NOW.','❌\x20加载图片失败:','📞\x20号码状态：空号','⚠️\x20电话号码为空，使用默认头像','albumEditActions','aboutMe','focus','contactDetailLabel','userName','addEventListener','linear-gradient(90deg,\x20rgba(0,0,0,0.12)\x200%,\x20rgba(0,0,0,0.04)\x2050%,\x20rgba(255,255,255,0.2)\x20100%)','sort','pl_','scrollIntoView','width','No\x20bio','transcript','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22overlay-subtitle\x22>\x22','<svg\x20viewBox=\x220\x200\x2024\x2024\x22><rect\x20x=\x223\x22\x20y=\x223\x22\x20width=\x2218\x22\x20height=\x2218\x22\x20rx=\x222\x22\x20ry=\x222\x22/><circle\x20cx=\x228.5\x22\x20cy=\x228.5\x22\x20r=\x221.5\x22/><polyline\x20points=\x2221\x2015\x2016\x2010\x205\x2021\x22/></svg>','，跳过\x20','entry_','[百宝书]\x20保存分类失败:','baobaobook-entry-btn-delete','通话中','📱\x20Opening\x20SMS\x20detail\x20for:','showEditBaobaobookModal','sine','disabled','联系人','\x20is-last-reply','❌\x20[Thread]\x20聊天记录读取失败:','\x22\x20alt=\x22\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-follow-badge\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x223\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<line\x20x1=\x2212\x22\x20y1=\x225\x22\x20x2=\x2212\x22\x20y2=\x2219\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<line\x20x1=\x225\x22\x20y1=\x2212\x22\x20x2=\x2219\x22\x20y2=\x2212\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22diary-idx-page\x22>','❌\x20[Thread]\x20发送评论失败:','musicWidgetOrbPosition','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','一起听','❌\x20头像元素不存在','https://i.postimg.cc/qMLZCFzL/fdfe79aeae4dc2670be2cce06b6a5ee0.jpg','.thread-reply-input','未设置','sms-message\x20','分类名称不能为空','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22baobaobook-empty-icon\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x206.253v13m0-13C10.832\x205.477\x209.246\x205\x207.5\x205S4.168\x205.477\x203\x206.253v13C4.168\x2018.477\x205.754\x2018\x207.5\x2018s3.332.477\x204.5\x201.253m0-13C13.168\x205.477\x2014.754\x205\x2016.5\x205c1.747\x200\x203.332.477\x204.5\x201.253v13C19.832\x2018.477\x2018.247\x2018\x2016.5\x2018c-1.746\x200-3.332.477-4.5\x201.253\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22baobaobook-empty-text\x22>暂无知识条目</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','files','mmpagesAvatar','Playing','removeAttribute','无标题','openImageGalleryDrawer','<option\x20value=\x22\x22>请选择分类</option>','userPlaylistData_','activity','visible','rgba(255,\x20255,\x20255,\x200.15)','发来一条短信','toLocaleString','replyAvatars','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22image-gallery-image-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22','controlPanel','onclick=\x22toggleContactHistoryDetail(','📱\x20刷新联系人详情，isStranger:','newContactPhone','togetherInvitePlaylistTitle','DAILY\x20SCHEDULE','expanded','mmpagesEditUsername','newMainComments','14px\x20Helvetica\x20Neue','newContactCharacterInfo','updatedAt','pressing','正在生成回复...','className','[百宝书]\x20重命名分类:','\x22\x20style=\x22','清理重复笔记','afterend','contacts','translateY(10px)','is-interactive','innerHeight','<span\x20class=\x22mmpages-hashtag\x22>#$1</span>','60%','sms-date-separator','insertBefore','now','📱\x20SMS\x20Attach\x20Image','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22diary-idx-date\x22>','--diary-','10010','[TogetherInviteDebug]','\x20的主页信息已保存','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20inline-block;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2010px\x2024px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#2d2d2d;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#fff;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-top:\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20','filter','positionY','📱\x20添加用户短信:','imageGalleryCategoryPanel','[百宝书]\x20创建分类:','lyric-stage\x20style-orbit','label','contains','📱\x20显示\x22删除此号码\x22按钮','#baobaobookEntryBtnLeft','randomSmsPersona','请先配置API','commentList','parseInt','动态不存在','choices','<div\x20class=\x22thread-reply-line\x22></div>','style=\x22background-image:\x20url(\x27','✅\x20专辑封面已更新','❌\x20[Thread]\x20获取AI评论失败:','.phone-nav-item','replyTo','\x27)\x22\x20title=\x22重命名\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M11\x204H4a2\x202\x200\x200\x200-2\x202v14a2\x202\x200\x200\x200\x202\x202h14a2\x202\x200\x200\x200\x202-2v-7\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M18.5\x202.5a2.121\x202.121\x200\x200\x201\x203\x203L12\x2015l-4\x201\x201-4\x209.5-9.5z\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22category-item-btn\x20delete\x22\x20onclick=\x22deleteBaobaobookCategoryWithConfirm(\x27','Detectives\x20of\x20the\x20silent\x20beat','\x27)\x22>删除</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20','contactsList','-\x20只读背景：用于连续性/伏笔/进度校验。','call\x20records','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-history-item\x22\x20','无法读取图片','#baobaobookEntryNameInput','sms-unknown','47306VmgMoP','📞\x20通话开始，记录时间:','callStatus','9.5.百宝书强化','>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-history-type\x20','\x0a-\x20生日：','musicWidgetContainer','📱\x20callRecords\x20原始数据:','\x20条楼中楼回复到主评论#','clientY','covers','deleteBaobaobookEntry','.phone-call-btn','137','\x0a用户名：','📝\x20记录陌生人第一句话到通话记录:','chats','lyricStyleOverlay','style','switch_playlist','BAOBAOBOOK\x20(REINFORCEMENT)','⚠️\x20角色没有设置头像，使用默认头像','确定要删除\x20','分类名称长度应在1-20字符之间','playlistId','anonymous','#baobaobookEntrySceneCall','stats','contactDetailNumber','\x0a\x20\x20\x20\x20\x20\x20\x20\x20/*\x20Thread\x20评论更多菜单\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20.thread-comment-more\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20relative;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.thread-comment-menu\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20absolute;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20right:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#1a1a1a;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x201px\x20solid\x20#333;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x204px\x2020px\x20rgba(0,\x200,\x200,\x200.5);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20visibility:\x20hidden;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20translateY(-10px)\x20scale(0.95);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20all\x200.2s\x20ease;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x20100;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20overflow:\x20hidden;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.thread-comment-menu.active\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20visibility:\x20visible;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20translateY(5px)\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.thread-comment-menu-item\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20background\x200.15s;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.thread-comment-menu-item:hover\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#2a2a2a;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.thread-comment-menu-item\x20svg\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20flex-shrink:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20block;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.thread-comment-menu-delete\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#aaa;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20.thread-comment-menu-delete:hover\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#ccc;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20','<span\x20class=\x22thread-author-badge\x22>·\x20To\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-search-main\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-search-name\x22>','...','openImessageChat(\x27','comments','visibility','https://music-api.gdstudio.xyz/api.php','📱\x20[Contacts]\x20Failed\x20to\x20load\x20contacts:','deleteCategoryConfirmModal','backgroundColor','.thread-follow-btn','\x0a\x0a---\x0a**注意**：这是私聊记录，仅供参考你们的关系和聊过的话题。不要在评论区透露私聊内容。','left','Seeking...','model','list-item','暂无歌单','URL格式不正确:','contactsMyCardName','threadReplyBar','setPointerCapture','功能开发中...',');\x22\x20title=\x22删除动态\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22mmpages-post-text\x22>','条\x20=\x20去重后','7380135BUCQkB','deleteGalleryImage','chat','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-history-duration\x22>','includes','userPlaylistSelectedIndex','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22song-search-meta\x22>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20max-width:\x20280px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20overflow:\x20hidden;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x204px\x2020px\x20rgba(0,0,0,0.08);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20#fff;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20-apple-system,\x20sans-serif;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2024px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20','<span\x20style=\x22font-size:\x2014px;\x20font-weight:\x20500;\x22>完成</span>','20670JYeeOQ','rgba(0,0,0,0.05)',',\x20replyIndex=','isEnabled','<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M14\x202H6a2\x202\x200\x200\x200-2\x202v16a2\x202\x200\x200\x200\x202\x202h12a2\x202\x200\x200\x200\x202-2V8z\x22></path><polyline\x20points=\x2214\x202\x2014\x208\x2020\x208\x22></polyline><line\x20x1=\x2216\x22\x20y1=\x2213\x22\x20x2=\x228\x22\x20y2=\x2213\x22></line><line\x20x1=\x2216\x22\x20y1=\x2217\x22\x20x2=\x228\x22\x20y2=\x2217\x22></line></svg>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22preview-placeholder\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22><rect\x20x=\x223\x22\x20y=\x223\x22\x20width=\x2218\x22\x20height=\x2218\x22\x20rx=\x222\x22\x20ry=\x222\x22/><circle\x20cx=\x228.5\x22\x20cy=\x228.5\x22\x20r=\x221.5\x22/><polyline\x20points=\x2221\x2015\x2016\x2010\x205\x2021\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20输入链接后预览\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','通话功能未就绪','Following','callSpeechText','，立即中断AI请求','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-msg-time\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','<!--\x20[TOKEN_MARKER:\x204.核心人设]\x20-->\x0a#\x20核心设定\x0a\x0a','splice','确定要删除这个条目吗？此操作不可恢复。','2.前置Jailbreak','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M21\x2011.5a8.38\x208.38\x200\x200\x201-.9\x203.8\x208.5\x208.5\x200\x200\x201-7.6\x204.7\x208.38\x208.38\x200\x200\x201-3.8-.9L3\x2021l1.9-5.7a8.38\x208.38\x200\x200\x201-.9-3.8\x208.5\x208.5\x200\x200\x201\x204.7-7.6\x208.38\x208.38\x200\x200\x201\x203.8-.9h.5a8.48\x208.48\x200\x200\x201\x208\x208v.5z\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-action\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M20\x2011a8.1\x208.1\x200\x200\x200\x20-15.5\x20-2m-.5\x20-4v4h4\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M4\x2013a8.1\x208.1\x200\x200\x200\x2015.5\x202m.5\x204v-4h-4\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-action\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M4.698\x204.034l16.302\x207.966l-16.302\x207.966a.503\x20.503\x200\x200\x201\x20-.546\x20-.124a.555\x20.555\x200\x200\x201\x20-.12\x20-.568l2.468\x20-7.274l-2.468\x20-7.274a.555\x20.555\x200\x200\x201\x20.12\x20-.568a.503\x20.503\x200\x200\x201\x20.546\x20-.124z\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M6.5\x2012h14.5\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','font','warn','currentCallInitiator','currentGalleryImageCount','together-item','background','inert','baobaobookCategories','Rewinding\x20the\x20memories.','[PlaylistCache]\x20load\x20failed:','thread-liked','📱\x20Send\x20message\x20to:','diaryDedupeBtn','password','❌\x20未找到评论输入框','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-text\x22>','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-transcript-text\x22>','callReplyInput','Tuesday','通话\x20','联系人已保存','offsetY','imessage-avatar-pink','lyric-stage\x20','📱\x20进入SMS编辑模式','currentTime','checked','liked','has-image','chatMessages','isStranger','phoneCallScreen','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22image-gallery-category-thumb\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','audio|','-\x20不要复述这些段落；基于它们继续评论，并按\x20FINAL\x20OUTPUT\x20PROTOCOL\x20输出\x20PIPE-LINE\x20v1。','━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━','clearRect','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22thread-comment-more\x22\x20onclick=\x22event.stopPropagation();\x20toggleThreadCommentMenu(this);\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22currentColor\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x225\x22\x20cy=\x2212\x22\x20r=\x222\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x222\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2219\x22\x20cy=\x2212\x22\x20r=\x222\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','百宝书（结尾强化）','shares','lyricToggle','documentElement','bottom','data-theme','9.历史-AI回复','getThreadCommentAIResponse','🔄\x20切换回复显示:','overlayContent','📖\x20[日记本]\x20共','xoxo','togetherInviteId','<div\x20class=\x22sms-date-label\x22>','Session\x20initialized','findIndex','offsetHeight','interactionBound','backToGalleryCategories','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22freq-card\x20card-broadcast\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card-meta\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-show-replies-text\x22\x20onclick=\x22toggleThreadReplies(','letter','<button\x20class=\x22diary-entry-toggle\x22\x20type=\x22button\x22\x20aria-expanded=\x22false\x22>展开全文</button>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-checkbox\x20','charProfileDeviceName','application/json','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M14\x202H6a2\x202\x200\x200\x200-2\x202v16a2\x202\x200\x200\x200\x202\x202h12a2\x202\x200\x200\x200\x202-2V8z\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<polyline\x20points=\x2214\x202\x2014\x208\x2020\x208\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<line\x20x1=\x2212\x22\x20y1=\x2218\x22\x20x2=\x2212\x22\x20y2=\x2212\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<line\x20x1=\x229\x22\x20y1=\x2215\x22\x20x2=\x2215\x22\x20y2=\x2215\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>还没有日记内容</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>日记会在聊天中自动生成</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','#diaryBook\x20.diary-cover\x20.diary-cover-inner','📝\x20记录AI第一句话到通话记录:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x221.5\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x229\x22></circle>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x208v4M12\x2014h.01\x22></path>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Today\x20','getItem','startY','callType','node-item','\x22或其他路人）\x0a-\x20content:\x20回复内容（10-80字，自然口语化）\x0a-\x20isAuthor:\x20是否是帖子作者（作者回复为true，路人回复为false）\x0a-\x20replyTo:\x20被回复者用户名（填\x22','sms-edit-mode','keypad','clipboard','deleted','\x20left:\x20','log','189','categoryId','all','currentProfileId','linearRampToValueAtTime','暂无歌曲','baobaobookCategoryDrawerOverlay','pointerId','__ovoPlaylistId','--diary-cover','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-sticky-head\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-sticky-head-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22','connected','」已创建','recentPromoName','✅\x20[Thread]\x20PIPE-LINE解析成功:','star-icon','\x22\x20alt=\x22\x22\x20onerror=\x22this.parentNode.innerHTML=\x27<svg\x20viewBox=\x5c\x270\x200\x2024\x2024\x5c\x27><path\x20d=\x5c\x27M20\x2021v-2a4\x204\x200\x200\x200-4-4H8a4\x204\x200\x200\x200-4\x204v2\x5c\x27/><circle\x20cx=\x5c\x2712\x5c\x27\x20cy=\x5c\x277\x5c\x27\x20r=\x5c\x274\x5c\x27/></svg>\x27\x22>','</strong>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small>','animate','pop','connect','短信系统未就绪，请稍后重试','159','📌\x20便签位置已保存:\x20noteId=','diarySharedStyle','removeProperty','Bearer\x20','cssText','AudioContext','🔐\x20showPasswordDialog\x20接收到的数据:','ended','message','保存失败，请重试','<div\x20class=\x22image-gallery-empty-state\x22><p>加载失败，请重试</p></div>','newContactAvatarPreview','Calling','9.历史-用户#','❌\x20initCallWithContactPersona函数不存在！ovo-call.js可能未加载','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','❌\x20删除图库分类失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-face\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-spine\x20diary-spine-inner\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-holes\x22><div\x20class=\x22diary-hole\x22></div><div\x20class=\x22diary-hole\x22></div><div\x20class=\x22diary-hole\x22></div><div\x20class=\x22diary-hole\x22></div></div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-inner\x20diary-content-page\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20日期头部\x20-\x20完全按照\x20preview\x20的\x20entry-head\x20结构\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-head\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-date\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>','页按需加载','150','📱\x20[DEBUG]\x20准备显示通话界面...','播放失败','.recent-search-input','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22playlist-empty-hint\x22\x20id=\x22playlistEmptyHint\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22empty-title\x22>Silence,\x20before\x20the\x20first\x20note.</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22empty-sub\x22>Tap\x20the\x20circle\x20above\x20to\x20name\x20your\x20first\x20playlist.</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20','lrc','<div\x20class=\x22contacts-group\x22\x20id=\x22contacts-group-','unshift','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-sort-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-sort-dropdown\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>Top</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<polyline\x20points=\x226\x209\x2012\x2015\x2018\x209\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-view-activity\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>View\x20activity</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<polyline\x20points=\x229\x2018\x2015\x2012\x209\x206\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20','Unknown','mmpagesBio','toISOString','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-menu\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-menu-item\x20thread-comment-menu-delete\x22\x20onclick=\x22event.stopPropagation();\x20deleteThreadComment(','map','📑\x20切换到Tab:','likes','COMMENT\x20HISTORY','[百宝书]\x20打开分类管理抽屉','⏹️\x20清除拨号延迟定时器','In\x20the\x20fog\x20of\x20time\x20we\x20stand','🎯\x20[Thread]\x20设置回复目标:','diaryAvatarImg','📱\x20已选择消息:','.contact-card-content.expanded','diary-idx-item','character','⚠️\x20电话号码不在电话库中，使用默认头像','complete','删除失败','pointer','getAttribute','frequency','getAvailableGalleryImages','💖\x20[Thread]\x20好感度变化:\x20','help','diary-page\x20diary-inner\x20diary-dynamic','📱\x20[iMessage]\x20加载短信会话列表...','cover','.imessage-item','animationDelay','createDocumentFragment','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-reply-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22thread-reply-action-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x221.8\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<rect\x20x=\x226\x22\x20y=\x226\x22\x20width=\x2214\x22\x20height=\x2214\x22\x20rx=\x222\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M6\x2014l4-4\x206\x206\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2211\x22\x20cy=\x2210\x22\x20r=\x221.5\x22\x20fill=\x22currentColor\x22\x20stroke=\x22none\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<rect\x20x=\x224\x22\x20y=\x224\x22\x20width=\x2214\x22\x20height=\x2214\x22\x20rx=\x222\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22thread-reply-action-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x221.8\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<rect\x20x=\x222\x22\x20y=\x225\x22\x20width=\x2220\x22\x20height=\x2214\x22\x20rx=\x223\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<text\x20x=\x2212\x22\x20y=\x2215.5\x22\x20font-size=\x227\x22\x20font-weight=\x22600\x22\x20text-anchor=\x22middle\x22\x20fill=\x22currentColor\x22\x20stroke=\x22none\x22>GIF</text>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22thread-reply-action-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x221.8\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<polyline\x20points=\x224\x2014\x204\x2020\x2010\x2020\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<polyline\x20points=\x2220\x2010\x2020\x204\x2014\x204\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<line\x20x1=\x2214\x22\x20y1=\x2210\x22\x20x2=\x2220\x22\x20y2=\x224\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<line\x20x1=\x224\x22\x20y1=\x2220\x22\x20x2=\x2210\x22\x20y2=\x2214\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20','.diary-page.diary-dynamic','删除失败:\x20','mmpagesEditBio','status','-\x20用户在某条主评论下发了楼中楼回复，这里是对用户回复的回复（也是楼中楼）\x0a-\x20所有回复都会放到同一条主评论的楼中楼中','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22overlay-title\x22>Universe</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22overlay-subtitle\x22>Managing\x20the\x20chaos\x20of\x20categories</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22newCatInput\x22\x20class=\x22ghost-input\x22\x20placeholder=\x22New\x20Category...\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22action-btn-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22circle-btn\x22\x20onclick=\x22addCategory()\x22>+</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22circle-btn\x22\x20onclick=\x22closeUserPlaylistOverlay()\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','aria-expanded','pointerType','join','#baobaobookEntrySceneSms','isLastReply','var(--thread-text-primary)','.recent-filter-tab','previewText','\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-foot\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22diary-page-num\x22>-\x20','json','.overlay-empty-hint',',\x20event)\x22\x20title=\x22删除笔记\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-sticky-body\x22>','diaryOverlay','🔍\x20查找电话号码对应的角色:','Highlight\x20clicked:','.contact-card-arrow','✅\x20[删除动态]\x20postId:','\x20[图片]','imessage-selected','strokeStyle','imessage-avatar-blue','已删除号码\x20\x22','__ovoRetryToken','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22call-action-btn\x20','.vol-filled','[通话]','\x20张图片','fade-out','note','9.历史-多模态消息','end','originalName','\x0a\x0a---\x0a**笔记创作（仅在捕捉到\x22新增且可复用\x22的用户事实时）：**\x0a-\x20先扫描上面的\x22已记录笔记\x22：禁止同义改写复述。\x0a-\x20若本轮无新增事实：不要输出\x20notes（或输出\x20notes:\x20[]）。\x0a-\x20若有新增：notes\x20最多1-2条；每条10-30字；写\x22事实\x22，不要写感想。','empty','❌\x20切换状态失败:','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</article>\x0a\x20\x20\x20\x20\x20\x20','playlistIndex','fillRect','opacity','recentCallList','渲染\x20','initial','\x20|\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','hypot','items','<span\x20class=\x22heart-icon\x22>','9.历史说明','📞\x20AI主动挂断电话','characterAffection','mmpagesPosts','getImageData','对方正在通话中，请稍后再拨','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20fixed;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20top:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20left:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20right:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20bottom:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20rgba(0,\x200,\x200,\x200.7);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x20100000;\x0a\x20\x20\x20\x20\x20\x20\x20\x20','⚠️\x20没有待发送的短信','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','showCreateBaobaobookModal','✅\x20随机陌生人通话已连接:','width:\x20100px;','📱\x20Found\x20stranger\x20persona:','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22recent-call-info-btn\x22\x20onclick=\x22event.stopPropagation();\x20showCallInfo(\x27','imessagePinnedSection','\x0a\x0a###\x20你的当前状态\x0a尚未设置状态\x0a（建议在首次评论时设置一个初始状态，之后只在状态真正变化时更新）','保存失败：角色ID不存在','true','\x22\x20data-note-id=\x22','newImageBatchInput','baobaobookCategoryManagementList','133','\x22\x20alt=\x22','📱\x20打开iMessage','lyrics-line','contactAvatar','position','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22song-name\x22>','Synced','togetherInviteList','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contacts-item\x22\x20onclick=\x22openContactDetail(\x27','\x20条待发送短信','MEMO',');\x22\x20title=\x22删除评论\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','diaryIndexList','这不是随机陌生人号码','diaryStatNotes','PLOT\x20POINTS\x20/\x20STORY\x20TIMELINE','陌生人','共享联系人','已导入\x20','path[d*=\x22M20.84\x22],\x20path[d*=\x22M12\x2021.35\x22]','📱\x20[SMS重回]\x20已移除smsMessages中的重复用户消息','slice','4.核心人设','prev','translateX(-50%)','No\x20audio\x20url','styles','提示：','strangerPersona','https://i.postimg.cc/43K8qNwS/71fa6fd434f6e4ba8c6bec67d1b6d792.jpg','<div\x20class=\x22thread-post-images\x22>','目标主评论：「','❌\x20[DEBUG]\x20sendCallMessage函数不存在！','💡\x20该号码无人设数据（既不在联系人也不在短信记录）','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22image-gallery-add-image-item\x22\x20onclick=\x22openImageGalleryAddModal()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22><line\x20x1=\x2212\x22\x20y1=\x225\x22\x20x2=\x2212\x22\x20y2=\x2219\x22/><line\x20x1=\x225\x22\x20y1=\x2212\x22\x20x2=\x2219\x22\x20y2=\x2212\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>添加图片</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','value','❌\x20加载Mmpages动态失败:','-\x20</thinking>\x20之后只输出\x20PIPE-LINE\x20v1（PIPE-LINE\x20外禁止任何文字）。','play','📱\x20Detail\x20toggled,\x20expanded:','<span\x20class=\x22thread-mention\x22>@$1</span>','.diary-page-inner','❌未分类\x20#','</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22','Decline','-\x20用户刚发的评论是主评论，这里是对用户评论的回复','destination','result','\x22\x20alt=\x22头像\x22>','确定要删除这条回复吗？','Enter\x20number','touches','getTime','playlist','PIPE-LINE解析失败','lyricBox','❌\x20无效的评论','Error','Untitled','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22category-item\x22\x20data-category=\x22','imessageEditBtn','height','🎨\x20[懒加载]\x20已渲染第','abs','bubblePosition','knowledgeBooks','--diary-spine','isNaN','writeText','已选中歌单','worldview','charProfileFollowing','<span>','records','padEnd','图片上传失败:','📱\x20退出SMS编辑模式','maxBottom','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','#diaryPage1\x20.diary-page-face','newContactNickname','info','&amp;','\x20·\x20','threadProfilePicker','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22image-gallery-category-meta\x22>','https://i.pravatar.cc/150?img=1','📝\x20记录AI回复到通话记录:','diary-idx-action-btn','在忙什么呢？','mousedown','sentences','📱\x20Switched\x20to\x20Recent\x20Calls\x20view','14.思维链质控','#baobaobookEntryPositionSelect','<thinking>','diary-flip-btn\x20next','system','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22char-profile-highlight\x22\x20onclick=\x22handleCharProfileHighlight(\x27','startTime','.contact-history-card','flushChatDetailRefreshIfNeeded:done','data:image/svg+xml,%3Csvg\x20xmlns=\x27http://www.w3.org/2000/svg\x27\x20viewBox=\x270\x200\x20100\x20100\x27%3E%3Crect\x20fill=\x27%234a90d9\x27\x20width=\x27100\x27\x20height=\x27100\x27/%3E%3Ccircle\x20cx=\x2750\x27\x20cy=\x2735\x27\x20r=\x2720\x27\x20fill=\x27%23fff\x27/%3E%3Cellipse\x20cx=\x2750\x27\x20cy=\x2780\x27\x20rx=\x2730\x27\x20ry=\x2725\x27\x20fill=\x27%23fff\x27/%3E%3C/svg%3E','⚠️\x20未找到评论输入框','data-tab','other','-\x20这是用户刚刚发的主评论（本轮输入）。','🎨\x20设置\x20','characterDiary','📱\x20Custom\x20avatar\x20uploaded','currentCharProfileData','closeImageGalleryDrawer','评论已删除','分类已重命名为\x22','条\x20+\x20chat场景默认','lastMessage','playlistStream','some','1000','#ffffff','newImageDescription','outgoing','无法接通','instant','Saturday','pointercancel','parentNode','.thread-action-item,\x20.thread-comment-action','phoneProfileSelectorList','-\x20注意：这是你自己发的帖子，你在评论区回复其他人。','\x0a（仅在需要时提及，不要每次都说）','dragBound','isFinite','📱\x20Contact\x20detail\x20container\x20not\x20found','sendTogetherInviteToChat:done','observe','mmpagesSocialAvatar','owner','deleteContactOption','animating','armed','17.AI预填充','thread-comment-item','Enter','CURRENT\x20TURN\x20USER\x20REPLY\x20(楼中楼)','charProfileMention','calling','__ovoActiveChatRecord','」\x0a（这是你现在显示的状态。只有当状态确实发生变化时才在输出中更新status字段，状态没变就不要输出status）','保存失败，请稍后重试','📔\x20打开日记本，角色ID:','❌\x20[SMS删除]\x20失败:','decline','📱\x20[Recent]\x20No\x20current\x20profile\x20found','currentSticky','drawImage','7953XsNgwT','未找到当前帖子','background\x200.8s\x20cubic-bezier(0.4,\x200,\x200.2,\x201)','📱\x20[Contacts]\x20Loaded','--lyrics-color','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-profile-avatar\x22>','\x20条AI消息需要删除','short','getElementById','Mute\x20toggled','playing','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22diary-idx-title\x22>','.sms-input-area','settings','📱\x20Filter\x20recent\x20calls\x20by:','歌曲缺少\x20ID','diary-entry-content\x20collapsible\x20collapsed','order','166','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22category-item-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22category-item-btn\x20edit\x22\x20onclick=\x22renameBaobaobookCategoryPrompt(\x27','__ovoRetryCount','charProfileAvatar','📱\x20Card\x20not\x20found','<div\x20class=\x22phone-profile-no-number\x22>No\x20phone\x20number</div>','</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-mood\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>📌</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>笔记</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20笔记页标题\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-title\x22\x20style=\x22text-align:\x20center;\x20color:\x20var(--diary-text-muted,\x20#999);\x22>这一天只有笔记，没有写日记</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20空白区域用于贴便利贴\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-body\x22\x20style=\x22min-height:\x20300px;\x20position:\x20relative;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20便利贴笔记\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','nickname','\x22\x20alt=\x22\x22>','条目创建成功','Moon\x20River','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22track-lyric\x22>\x22','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22recent-call-meta\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22recent-call-time\x22>','📱\x20[SMS重回]\x20开始重新生成AI回复...','playerTimeCurrent','translateY(0)','❌\x20initRandomStrangerCall函数不存在！ovo-call.js可能未加载','then','.mmpages-like-btn','currentCallBusyPeriod','<div\x20class=\x22worldview-tab\x22\x20data-category-id=\x22','newSongInput','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-action-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M20\x2011a8.1\x208.1\x200\x200\x200-15.5-2m-.5-4v4h4\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M4\x2013a8.1\x208.1\x200\x200\x200\x2015.5\x202m.5\x204v-4h-4\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','key','music-api.gdstudio.xyz\x20·\x20感谢\x20gdstudio\x20·\x20默认\x20netease','📝\x20[兜底]\x20记录AI第一句话:','11.好感度','\x22\x20alt=\x22AI生成的图片\x22\x20loading=\x22lazy\x22\x20onerror=\x22this.style.display=\x27none\x27\x22>','from','🤖\x20陌生人接听，共','[短信]','」的评论下回复了。','百宝书（临场强化）','replaceWith','<div\x20class=\x22sms-message-time\x22>','📱\x20phoneNumber:','\x22\x20onclick=\x22openGalleryImages(\x27','threads','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','split','[PlaylistCache]\x20save\x20failed:','50%','\x22\x20alt=\x22\x22\x20onerror=\x22this.parentElement.innerHTML=\x27<svg\x20viewBox=\x5c\x270\x200\x2024\x2024\x5c\x27><rect\x20x=\x5c\x273\x5c\x27\x20y=\x5c\x273\x5c\x27\x20width=\x5c\x2718\x5c\x27\x20height=\x5c\x2718\x5c\x27\x20rx=\x5c\x272\x5c\x27\x20ry=\x5c\x272\x5c\x27/><circle\x20cx=\x5c\x278.5\x5c\x27\x20cy=\x5c\x278.5\x5c\x27\x20r=\x5c\x271.5\x5c\x27/><polyline\x20points=\x5c\x2721\x2015\x2016\x2010\x205\x2021\x5c\x27/></svg>\x27\x22>','callSpeechIndicator','.sms-message[data-index=\x22','135','📱\x20加载了\x20','var(--text-color)','📱\x20打开Mmpages页面','\x0a\x0a##\x20当前评论区\x0a','📱\x20Switched\x20to\x20Contacts\x20view','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22diary-sticky-delete\x22\x20onclick=\x22deleteDiaryNote(','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-sticky-head\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-sticky-head-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','Accept','touch','\x22已删除','条目名称不能超过50个字符','gain','❌\x20initSmsWithAI函数不存在！ovo-call.js可能未加载','time','min','followers','scale(0)\x20rotate(45deg)','\x20state-changing','keypress','歌单内没有可播放的歌曲','var(--thread-bg-primary)','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','buttons','-\x20这是一次\x22社交平台帖子评论区\x22的文学/故事创作。你将以角色身份回复帖子评论。','unknown','📱\x20全选消息:','touchend','📱\x20Arrow\x20element:','low','未清理','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-author-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22thread-author-name\x22>','firstElementChild','取消全选','origin','❌\x20保存百宝书条目失败:','div','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-action-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M21\x2011.5a8.38\x208.38\x200\x200\x201-.9\x203.8\x208.5\x208.5\x200\x200\x201-7.6\x204.7\x208.38\x208.38\x200\x200\x201-3.8-.9L3\x2021l1.9-5.7a8.38\x208.38\x200\x200\x201-.9-3.8\x208.5\x208.5\x200\x200\x201\x204.7-7.6\x208.38\x208.38\x200\x200\x201\x203.8-.9h.5a8.48\x208.48\x200\x200\x201\x208\x208v.5z\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22thread-action-count\x22>','\x0a简介：','.diary-sticky[data-note-id]','No\x20characters\x20found','44466VNkqwG','max','mmpagesUsername','album','Coffee\x20and\x20gentle\x20light.','ai-generated','页，剩余','floor','5.百宝书-中','\x0a电话号码：','❌\x20读取随机短信人设失败:','__ovoSongKey','stop','toLowerCase','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22timer\x22\x20data-together-timer=\x221\x22>','replyContent','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','⚠️\x20Web\x20Audio\x20API\x20not\x20supported','confirmAddImage','aiPersona','scale(0.95)','❌\x20删除评论失败:','userHeader','readyState','rgba(255,255,255,0.1)','timestamp','📱\x20从callRecords读取:\x20isStranger=','.volume-slider','userPlaylistVolume','numeric','.diary-entry-toggle','未获得AI回复','song-search-empty','chatSettings','创建失败:\x20','userPlaylistData_global','affection','translateY(-','7.剧情点','replyIndex','contactDetailAvatar','error','<path\x20d=\x22M17\x2017L7\x207M7\x207h10M7\x207v10\x22/>','Silence\x20is\x20the\x20loudest\x20scream.','mmpagesFollowers','❌\x20删除动态失败:','Holding\x20fragments\x20in\x20our\x20hand','showIslandNotification','findLastIndex','action','已删除','\x22\x20alt=\x22Your\x20avatar\x22\x20onclick=\x22toggleThreadProfilePicker(event)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-profile-picker\x22\x20id=\x22threadProfilePicker\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22thread-reply-input\x22\x20placeholder=\x22Reply\x20to\x20','⏹️\x20清除之前的拨号延迟定时器','linear-gradient(135deg,\x0a\x20\x20\x20\x20\x20\x20\x20\x20rgba(','musicWidgetLyricColorBtn','neural-canvas','remove','paused','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-face\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-spine\x20diary-spine-inner\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-holes\x22><div\x20class=\x22diary-hole\x22></div><div\x20class=\x22diary-hole\x22></div><div\x20class=\x22diary-hole\x22></div><div\x20class=\x22diary-hole\x22></div></div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-inner\x20diary-content-page\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-head\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-date\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>','consumed','--orb-custom-size','.phone-contacts-content','callAvatarImage','callName','captureChatId','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-sticky\x20','userProfileId','scroll','颜色提取失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22imessage-msg-arrow\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x208\x2014\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M1\x201l6\x206-6\x206\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-msg-preview\x22>','dark','callAvatarDefaultIcon','功能开发中','together-card','var(--text-primary)','touchstart','hasReply','记录你的知识到百宝书','.sms-message-checkbox','.imessage-nav-title','<path\x20d=\x22M18\x206L6\x2018M6\x206l12\x2012\x22/>','number','beginPath','input','✅\x20笔记已从数据库删除','<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M9\x2018l6-6-6-6\x22/></svg>','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22char-profile-highlight-circle\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','🎨\x20应用封面样式:','icon','\x0a\x0a##\x20配图\x0a','lineCap','state-changing','#baobaobookEntryContentTextarea','<path\x20d=\x22M7\x2017L17\x207M17\x207H7M17\x207v10\x22/>','passwordUI','get','❌\x20获取删除事件失败:','The\x20river\x20flows\x20upwards\x20to\x20the\x20sky','未选中歌单','togetherInviteTitle','mid_after','<div\x20class=\x22sms-message-checkbox\x20','is-visible','未分类','保存失败','hiddenInContactsList','rgba(255,255,255,0.05)','<div\x20class=\x22lyric-text\x22></div>','📞\x20号码状态：随机陌生人接听','transform','maxTop','.mmpages-post-menu.active','\x22\x20alt=\x22Avatar\x22>','REINFORCEMENT','imessageList','📱\x20✅\x20补全\x20transcript:','profileId','_dbMessageId','思维链','<path\x20d=\x22M22\x2016.92v3a2\x202\x200\x2001-2.18\x202\x2019.79\x2019.79\x200\x2001-8.63-3.07\x2019.5\x2019.5\x200\x2001-6-6\x2019.79\x2019.79\x200\x2001-3.07-8.67A2\x202\x200\x20014.11\x202h3a2\x202\x200\x20012\x201.72c.127.96.361\x201.903.7\x202.81a2\x202\x200\x2001-.45\x202.11L8.09\x209.91a16\x2016\x200\x20006\x206l1.27-1.27a2\x202\x200\x20012.11-.45c.907.339\x201.85.573\x202.81.7A2\x202\x200\x200122\x2016.92z\x22/><line\x20x1=\x2223\x22\x20y1=\x221\x22\x20x2=\x221\x22\x20y2=\x2223\x22/>','日记列表加载失败','.sms-date-label','❌\x20创建图库分类失败:','smooth','createGain','链接不可用','暂无可播放的歌单','toUsername','equals','before','No\x20bio\x20available','\x22\x20data-is-reply=\x22','transparent','<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M20\x2021v-2a4\x204\x200\x200\x200-4-4H8a4\x204\x200\x200\x200-4\x204v2\x22/><circle\x20cx=\x2212\x22\x20cy=\x227\x22\x20r=\x224\x22/></svg>','mmpagesDisplayName','targetCommentUsername','elementFromPoint','[主评论','tokens','\x22\x20alt=\x22预览\x22\x20onerror=\x22this.parentElement.innerHTML=\x27<div\x20class=\x5c\x27preview-placeholder\x5c\x27>图片加载失败</div>\x27\x22>','💡\x20提示:\x20Token使用量超过\x204000，建议关注token消耗','setProperty','已删除\x20','innerHTML','getDay','imageGalleryDrawer','avatarUrl','playlistPlayBtn','userCommentReplies','[UserPlaylist]\x20load\x20db\x20failed:','中国移动','linkedCharacterData','lyric','diaryStatSince','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-action-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M20\x2011a8.1\x208.1\x200\x200\x200\x20-15.5\x20-2m-.5\x20-4v4h4\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M4\x2013a8.1\x208.1\x200\x200\x200\x2015.5\x202m.5\x204v-4h-4\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22thread-action-count\x22>','sessionId','❌\x20[iMessage]\x20加载短信列表失败:','##\x20你的角色设定\x0a\x0a###\x20基本信息\x0a-\x20姓名：','aria-label','\x20+\x20','❌\x20[DEBUG]\x20initCallWithAI函数不存在！ovo-call.js可能未加载','toArray',')\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>Show\x20replies</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','undefined','next','src','charProfileUsername','aiAvatar','random','Close','mute','toLocaleTimeString','userPlaylistView\x20mutation','phoneContactDetail','AFFECTION\x20SYSTEM\x20(READ-ONLY)','📱\x20Search\x20recent\x20calls:','--diary-page','✅\x20Token使用量正常','<div\x20class=\x22imessage-avatar-bubble\x20','actorName','日记本功能未找到','artist','phoneProfileSelectorOverlay','userPlaylists','找不到该条目','javascript:','&#039;','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','displayName','target','playerSongTitle','.mmpages-tab','</div>','together','declined','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-post-more\x22\x20onclick=\x22event.stopPropagation();\x20toggleMmpagesPostMenu(this,\x20','请输入正确的11位手机号码','.lyrics-container','&gt;',',\x20event)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22><line\x20x1=\x2218\x22\x20y1=\x226\x22\x20x2=\x226\x22\x20y2=\x2218\x22/><line\x20x1=\x226\x22\x20y1=\x226\x22\x20x2=\x2218\x22\x20y2=\x2218\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','-\x20comment|main:\x20新的主评论（与用户评论同级），包含username/content。','startX','\x22\x20alt=\x22\x22\x20onerror=\x22this.parentElement.innerHTML=\x27<div\x20class=\x5c\x27image-error\x5c\x27>加载失败</div>\x27\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','📱\x20Show\x20contact\x20detail\x20for:','以下是评论历史（不含本轮最新评论）：','smsTypingIndicator','gender','动态已删除','\x20-</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-deco\x22><i></i><i></i><i></i></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-btn\x20prev\x22\x20onclick=\x22diaryFlip(-1)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M15\x2018l-6-6\x206-6\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-btn\x20next\x22\x20onclick=\x22diaryFlip(1)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M9\x2018l6-6-6-6\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20','Sunday','</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-mood\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','📕\x20[Thread]\x20百宝书汇总:\x20角色绑定','FEEL','186','中国电信','running','innerWidth','charProfileBackdrop','181','183','head','图片已移除','Nothing\x20to\x20win\x20and\x20nothing\x20to\x20lose','应用颜色失败:','❌\x20角色不存在，使用默认头像','❌\x20[Thread]\x20好感度读取失败:','FINAL\x20OUTPUT\x20PROTOCOL\x20(THREAD\x20COMMENT)\x20-\x20LAST\x20REMINDER','overlayLayer','thinking','<rect\x20x=\x222\x22\x20y=\x222\x22\x20width=\x2220\x22\x20height=\x2216\x22\x20rx=\x222\x22\x20ry=\x222\x22/><circle\x20cx=\x228\x22\x20cy=\x2214\x22\x20r=\x222\x22/><path\x20d=\x22M8\x206h.01\x22/><path\x20d=\x22M12\x206h.01\x22/><path\x20d=\x22M16\x206h.01\x22/>','12.百宝书强化','15.后置Jailbreak','📱\x20[iMessage]\x20打开短信聊天:','imessageScreen','quadraticCurveTo','📞\x20用户回复，取消AI挂断','has-unread','删除\x20(','stopPropagation','data-category-id','aeiou','minRight','\x27,\x20event)','❌\x20添加图片失败:','138','</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20日记正文容器\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-body\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20日记内容（支持AI生成的HTML）\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22','padStart','❌\x20关闭Mmpages编辑弹窗','musicWidgetOrbFile','-\x20你要重点回复这条评论。','💾\x20保存Mmpages编辑','newImagePreviewBox','song-item','charProfileFollowers','#diaryBook\x20.diary-page','contacts-group-','string','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22delete-x\x22\x20onclick=\x22removeSong(','match','.diary-entry-content.collapsible','✅\x20找到角色头像:','User','inform','var(--bg-primary)','📱\x20[Recent]\x20User\x20profile\x20loaded:','我的名片','一起听邀请','Keypad','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-show-replies-avatars\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','baobaobook-entry-btn-cancel','📞\x20拨通电话，等待AI接听...','find','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M20\x2021v-2a4\x204\x200\x200\x200-4-4H8a4\x204\x200\x200\x200-4\x204v2\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2212\x22\x20cy=\x227\x22\x20r=\x224\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','获取笔记失败:','\x20条...','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-edit-bar-left\x22\x20onclick=\x22toggleImessageSelectAll()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22imessageSelectAllText\x22>全选</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-edit-bar-right\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22imessage-delete-btn\x22\x20id=\x22imessageDeleteBtn\x22\x20onclick=\x22deleteSelectedImessages()\x22\x20disabled>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20删除\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','crossOrigin','tagsNo','coverHTML','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20日记标题\x20-\x20带下划线装饰\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-title\x22>','systemPlaylistTitle','📞\x20用户主动挂断电话','expanding','📜\x20[Thread]\x20找到匹配的聊天记录:\x20chatId=','分类已启用','1px\x20solid\x20var(--thread-border-color)','DAILY\x20SCHEDULE\x20(READ-ONLY)','colors','\x22\x20onclick=\x22toggleSmsMessageSelection(','rgba(0,0,0,0.1)','<div\x20class=\x22imessage-pinned-dot\x22></div>','AFFECTION','\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>','reverse','state','\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22user-playlist-view\x22\x20id=\x22userPlaylistView\x22\x20aria-hidden=\x22true\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22user-playlist-back\x22\x20onclick=\x22closeUserPlaylistView()\x22\x20aria-label=\x22返回\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M15\x2018l-6-6\x206-6\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22poem-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22flowing-text\x22\x20id=\x22bgText\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<canvas\x20id=\x22neural-canvas\x22></canvas>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content-scroll\x22\x20id=\x22scrollContainer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header-section\x22\x20id=\x22userHeader\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22avatar-core\x22\x20onclick=\x22openCategoryManager()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22avatar-img-container\x22\x20id=\x22userPlaylistAvatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22avatar-placeholder\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x221.5\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x2210\x22></circle>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x2016v-4M12\x208h.01\x22></path>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22user-name\x22\x20onclick=\x22openCategoryManager()\x22>Poetic\x20Soul</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22user-bio\x22\x20onclick=\x22openCategoryManager()\x22>Listening\x20to\x20the\x20universe\x20flow.</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22playlist-stream\x22\x20id=\x22playlistStream\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22control-bar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22theme-btn\x22\x20onclick=\x22openTogetherInviteUI()\x22>together</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22overlayLayer\x22\x20class=\x22overlay-layer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<canvas\x20id=\x22overlay-canvas\x22></canvas>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22overlay-content\x22\x20id=\x22overlayContent\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20','📋\x20使用已保存的人设:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-pinned-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','AI生成了','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-action\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M20.84\x204.61a5.5\x205.5\x200\x200\x200-7.78\x200L12\x205.67l-1.06-1.06a5.5\x205.5\x200\x200\x200-7.78\x207.78l1.06\x201.06L12\x2021.23l7.78-7.78\x201.06-1.06a5.5\x205.5\x200\x200\x200\x200-7.78z\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-action\x20thread-reply-btn\x22\x20data-comment-index=\x22',',\x200.85)\x200%,\x0a\x20\x20\x20\x20\x20\x20\x20\x20rgba(','entries','📝\x20添加回复:','imageGalleryCategoryList','.phone-action-btn','proxyUrl','\x20/\x20','offsetWidth','10000','🔴\x20角色正在繁忙中:\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contacts-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M20\x2021v-2a4\x204\x200\x200\x200-4-4H8a4\x204\x200\x200\x200-4\x204v2\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2212\x22\x20cy=\x227\x22\x20r=\x224\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contacts-empty-text\x22>加载失败</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contacts-empty-subtext\x22>请稍后重试</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','❌\x20[DEBUG]\x20AI没有返回有效回复','条日记，懒加载模式：','📞\x20拨通电话，等待陌生人接听...','pointerup','audioUpdatedAt','<div\x20class=\x22image-gallery-image-desc-badge\x22>','共享表情包库','load','✅\x20Mmpages功能模块加载完成','getMinutes','N/A','togetherInviteArtist','test','~\x20Not\x20impersonating\x20anyone!','📱\x20Detail\x20element:','\x0a\x0a---\x0a\x0a','and','_expanded','1609248FRjsKs','请输入备注名称','<svg\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20d=\x22M8\x205v14l11-7z\x22/></svg>','button','incoming','📱\x20[SMS重回]\x20已同步smsMessages:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22irregular-modal\x20active\x22\x20id=\x22deleteCategoryConfirmModal\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-title\x22>确认删除</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22font-size:\x2014px;\x20color:\x20var(--text-secondary);\x20line-height:\x201.6;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20确定要删除分类\x22','phoneDisplayCopyInitialized','parse','❌\x20删除短信对话失败:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22recent-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M22\x2016.92v3a2\x202\x200\x2001-2.18\x202\x2019.79\x2019.79\x200\x2001-8.63-3.07\x2019.5\x2019.5\x200\x2001-6-6\x2019.79\x2019.79\x200\x2001-3.07-8.67A2\x202\x200\x20014.11\x202h3a2\x202\x200\x20012\x201.72c.127.96.361\x201.903.7\x202.81a2\x202\x200\x2001-.45\x202.11L8.09\x209.91a16\x2016\x200\x20006\x206l1.27-1.27a2\x202\x200\x20012.11-.45c.907.339\x201.85.573\x202.81.7A2\x202\x200\x200122\x2016.92z\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22recent-empty-text\x22>暂无通话记录</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22recent-empty-subtext\x22>拨打或接听电话后会显示在这里</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','callFloatingImage','count','shift','AI回复失败','smsContactName','sendThreadComment','✅\x20使用关联角色头像',')\x22>✕</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','primaryKeys','Wednesday','📱\x20找到\x20','WORLDVIEW\x20(READ-ONLY)','userMention','overlay-canvas','display','together-empty','HTTP\x20','playlistPrevBtn','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20block;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x2080%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x2020px\x20auto;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x2010px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x201px\x20solid\x20#e8e8e8;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20','📜\x20[Thread]\x20未找到匹配的聊天记录\x20(characterId=','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','size','这是属于角色的私人日记，记录着与用户相处的点点滴滴...','data','⚠️\x20[Thread]\x20读取用户歌单列表失败:','defaultScenes','清理重复笔记（点一次提示，再点一次执行）','3.创作说明','userPlaylistView','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-action-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M4.698\x204.034l16.302\x207.966l-16.302\x207.966a.503\x20.503\x200\x200\x201\x20-.546\x20-.124a.555\x20.555\x200\x200\x201\x20-.12\x20-.568l2.468\x20-7.274l-2.468\x20-7.274a.555\x20.555\x200\x200\x201\x20.12\x20-.568a.503\x20.503\x200\x200\x201\x20.546\x20-.124z\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M6.5\x2012h14.5\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22thread-action-count\x22>','个页面到DOM','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','sent','charProfilePosts','<img\x20class=\x22thread-show-replies-avatar\x22\x20src=\x22','mmpagesScreen','❌\x20删除图片失败:','callSpeechBubble'];_0x4466=function(){return _0x157933;};return _0x4466();}function ensureDiaryDedupeButton(){const _0x94cdbf=_0x2a6210,_0xc1164a=document[_0x94cdbf(0x2ba)](_0x94cdbf(0x4fb));if(!_0xc1164a)return;let _0x49ca3f=document[_0x94cdbf(0x550)](_0x94cdbf(0x3c7));!_0x49ca3f&&(_0x49ca3f=document['createElement'](_0x94cdbf(0x6fc)),_0x49ca3f['id']=_0x94cdbf(0x3c7),_0x49ca3f[_0x94cdbf(0x1e9)]=_0x94cdbf(0x6fc),_0x49ca3f[_0x94cdbf(0x337)]=_0x94cdbf(0x504),_0x49ca3f[_0x94cdbf(0x1fa)]=_0x94cdbf(0x71e),_0x49ca3f['setAttribute'](_0x94cdbf(0x64e),_0x94cdbf(0x33a)),_0x49ca3f[_0x94cdbf(0x63f)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22diary-note-heart\x22\x20aria-hidden=\x22true\x22>♡</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22diary-note-text\x22>清理重复</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20'[_0x94cdbf(0x14c)]()),_0x49ca3f[_0x94cdbf(0x2a9)]!==_0xc1164a&&_0xc1164a[_0x94cdbf(0x744)](_0x49ca3f),_0x49ca3f[_0x94cdbf(0x2af)][_0x94cdbf(0x18f)](_0x94cdbf(0x538),diaryDedupeArmed),_0x49ca3f[_0x94cdbf(0x309)]=diaryDedupeRunning,_0x49ca3f['setAttribute']('aria-pressed',diaryDedupeArmed?_0x94cdbf(0x4a7):_0x94cdbf(0x79e)),_0x49ca3f[_0x94cdbf(0x7a1)]=async()=>{const _0x4f6b61=_0x94cdbf;if(diaryDedupeRunning)return;if(!diaryDedupeArmed){diaryDedupeArmed=!![],ensureDiaryDedupeButton(),showIslandNotification(_0x4f6b61(0x150),'再次点击爱心：清理重复笔记（不可撤销）','info');if(diaryDedupeArmTimeout)clearTimeout(diaryDedupeArmTimeout);diaryDedupeArmTimeout=setTimeout(()=>{diaryDedupeArmed=![],ensureDiaryDedupeButton();},0x2710);return;}diaryDedupeArmed=![];if(diaryDedupeArmTimeout)clearTimeout(diaryDedupeArmTimeout);diaryDedupeArmTimeout=null,diaryDedupeRunning=!![],ensureDiaryDedupeButton();try{await cleanDuplicateDiaryNotes({'requireConfirm':![]});}finally{diaryDedupeRunning=![],ensureDiaryDedupeButton();}};}async function cleanDuplicateDiaryNotes(_0x2cc88f={}){const _0x413330=_0x2a6210,{mode:mode='sameDate',threshold:threshold=0.9,requireConfirm:requireConfirm=!![]}=_0x2cc88f,_0x4ed048=currentDiaryCharacterId,_0x1a273f=currentDiarySessionId||_0x413330(0x2a7),_0x2cacd1=currentDiaryProfileId||'';if(!_0x4ed048){showIslandNotification(_0x413330(0x4e5),'No\x20diary\x20character\x20selected',_0x413330(0x5d9));return;}try{showIslandNotification('清理重复笔记','正在扫描...',_0x413330(0x4fd));const _0x319db7=await dedupeExistingNoteEntries(_0x4ed048,_0x1a273f,_0x2cacd1,{'dryRun':!![],'mode':mode,'threshold':threshold}),_0x5e835d=_0x319db7?.[_0x413330(0xb5)]?.[_0x413330(0x73a)]||0x0;if(_0x5e835d===0x0){showIslandNotification('完成','未检测到重复笔记',_0x413330(0x1f1));return;}if(requireConfirm){const _0x5ee7e2=confirm(_0x413330(0x181)+_0x5e835d+_0x413330(0x780));if(!_0x5ee7e2){showIslandNotification('已取消',_0x413330(0x5a5),_0x413330(0x4fd));return;}}showIslandNotification('清理重复笔记',_0x413330(0x7e7)+_0x5e835d+_0x413330(0x6c2),_0x413330(0x4fd));const _0x2294e2=await dedupeExistingNoteEntries(_0x4ed048,_0x1a273f,_0x2cacd1,{'dryRun':![],'mode':mode,'threshold':threshold});showIslandNotification('完成','已清理\x20'+(_0x2294e2?.[_0x413330(0x409)]||0x0)+'\x20条重复笔记','success');const _0x3665bd=currentDiaryCharacterMeta||{'id':_0x4ed048,'name':_0x413330(0x200),'avatar':'','bio':''},_0x46fdf3=await getDiaryList(_0x4ed048,_0x1a273f,_0x2cacd1);let _0x4f1920=[],_0x1476a6=0x0;try{_0x4f1920=await db[_0x413330(0x518)][_0x413330(0x115)](_0x413330(0x2c8))[_0x413330(0x630)]([_0x4ed048,_0x1a273f,_0x2cacd1])[_0x413330(0x6f7)](_0x54b6e2=>_0x54b6e2[_0x413330(0x1e9)]===_0x413330(0x483))[_0x413330(0x651)](),_0x1476a6=_0x4f1920['length'];}catch(_0x4dcd2c){console['warn'](_0x413330(0x6c1),_0x4dcd2c);}const _0x1eddb3=await getCoverStyle(_0x4ed048,_0x1a273f,_0x2cacd1);if(_0x1eddb3)applyCoverStyle(_0x1eddb3);renderDiaryCover(_0x3665bd,_0x46fdf3,_0x1476a6,_0x1eddb3);const _0x1e7780=new Set(_0x46fdf3['map'](_0x325488=>_0x325488[_0x413330(0xe2)])),_0x6b3f1e=new Set();_0x4f1920[_0x413330(0x84c)](_0x567d1f=>{const _0x1f5679=_0x413330;if(!_0x1e7780[_0x1f5679(0x17f)](_0x567d1f['date']))_0x6b3f1e['add'](_0x567d1f[_0x1f5679(0xe2)]);}),await renderDiaryPages(_0x46fdf3,_0x4ed048,_0x1a273f,_0x2cacd1,_0x4f1920),diaryCurrentPage=0x0,diaryTotalPages=0x2+_0x46fdf3[_0x413330(0x73a)]+_0x6b3f1e[_0x413330(0x719)];const _0x2ddf8d=document[_0x413330(0x854)](_0x413330(0x6ae));_0x2ddf8d['forEach'](_0x408d2b=>_0x408d2b['classList'][_0x413330(0x5e8)]('flipped')),updateDiaryZ(),ensureDiaryDedupeButton();}catch(_0x4e1ba6){console[_0x413330(0x5d9)]('清理重复笔记失败:',_0x4e1ba6),showIslandNotification(_0x413330(0x4e5),'清理失败',_0x413330(0x5d9));}}let stickyDragState={'isDragging':![],'currentSticky':null,'startX':0x0,'startY':0x0,'offsetX':0x0,'offsetY':0x0,'noteId':null,'originalRotate':'','pageEl':null},saveStickyPositionTimeout=null;function saveStickyPositionDebounced(_0x40f934,_0x5caaff,_0x573452){saveStickyPositionTimeout&&clearTimeout(saveStickyPositionTimeout),saveStickyPositionTimeout=setTimeout(async()=>{const _0xcb5c8=_0x18ea;try{await db[_0xcb5c8(0x518)][_0xcb5c8(0x253)](_0x40f934,{'positionX':_0x5caaff,'positionY':_0x573452}),console[_0xcb5c8(0x40b)](_0xcb5c8(0x424)+_0x40f934+_0xcb5c8(0x836)+_0x5caaff+_0xcb5c8(0xc6)+_0x573452);}catch(_0xe0ee22){console['warn'](_0xcb5c8(0x132),_0xe0ee22);}},0x12c);}let stickyDragGlobalListenersAttached=![];function getStickyDragPageBounds(){const _0x26678a=_0x2a6210,_0x5d8ce2=stickyDragState[_0x26678a(0x10b)];if(!_0x5d8ce2)return null;const _0x1c0512=_0x5d8ce2[_0x26678a(0x2ba)](_0x26678a(0x4d5));if(!_0x1c0512)return null;return _0x1c0512[_0x26678a(0x17a)]();}function handleStickyDragMove(_0x54e2e0){const _0x3bf6a6=_0x2a6210;if(!stickyDragState[_0x3bf6a6(0x7dd)]||!stickyDragState[_0x3bf6a6(0x546)])return;_0x54e2e0[_0x3bf6a6(0xf0)]();const _0x458ff6=stickyDragState[_0x3bf6a6(0x546)],_0x12c22e=_0x54e2e0[_0x3bf6a6(0x4df)]?_0x54e2e0['touches'][0x0]:_0x54e2e0,_0x335a03=getStickyDragPageBounds();if(!_0x335a03)return;let _0x3db4a7=_0x12c22e[_0x3bf6a6(0x1c6)]-_0x335a03['left']-stickyDragState[_0x3bf6a6(0x2b5)],_0x21ffd2=_0x12c22e[_0x3bf6a6(0x375)]-_0x335a03['top']-stickyDragState[_0x3bf6a6(0x3d0)];const _0x2b8c4c=_0x458ff6[_0x3bf6a6(0x6e3)]||0x55,_0x13eeb6=_0x458ff6[_0x3bf6a6(0x3f1)]||0x3c,_0x3c43b6=_0x335a03[_0x3bf6a6(0x2fc)]-_0x2b8c4c-0x5,_0xa997a2=_0x335a03[_0x3bf6a6(0x4e9)]-_0x13eeb6-0x28,_0x3ee352=0x5,_0x1ac48d=0x50;_0x3db4a7=Math[_0x3bf6a6(0x5b1)](_0x3ee352,Math['min'](_0x3c43b6,_0x3db4a7)),_0x21ffd2=Math[_0x3bf6a6(0x5b1)](_0x1ac48d,Math['min'](_0xa997a2,_0x21ffd2)),_0x458ff6['style']['left']=_0x3db4a7+'px',_0x458ff6[_0x3bf6a6(0x37e)]['top']=_0x21ffd2+'px',_0x458ff6['style']['right']='auto',_0x458ff6[_0x3bf6a6(0x37e)][_0x3bf6a6(0x3e5)]=_0x3bf6a6(0x1ea);}function handleStickyDragEnd(){const _0x295317=_0x2a6210;if(!stickyDragState[_0x295317(0x7dd)]||!stickyDragState[_0x295317(0x546)])return;const _0x20372c=stickyDragState[_0x295317(0x546)],_0x3179ca=stickyDragState[_0x295317(0x276)],_0x104ce1=getStickyDragPageBounds();if(_0x104ce1){const _0x122593=_0x20372c['getBoundingClientRect'](),_0x519e8d=_0x122593[_0x295317(0x396)]-_0x104ce1[_0x295317(0x396)],_0x46d521=_0x122593['top']-_0x104ce1[_0x295317(0x154)];_0x3179ca&&saveStickyPositionDebounced(_0x3179ca,Math[_0x295317(0x272)](_0x519e8d),Math[_0x295317(0x272)](_0x46d521));}_0x20372c[_0x295317(0x2af)][_0x295317(0x5e8)](_0x295317(0x1df)),_0x20372c['style'][_0x295317(0xc7)]='',_0x20372c[_0x295317(0x37e)][_0x295317(0x125)]=_0x295317(0x754),stickyDragState[_0x295317(0x72e)]&&(_0x20372c[_0x295317(0x37e)][_0x295317(0x61d)]=stickyDragState['originalRotate']),stickyDragState[_0x295317(0x7dd)]=![],stickyDragState['currentSticky']=null,stickyDragState[_0x295317(0x276)]=null,stickyDragState[_0x295317(0x72e)]='',stickyDragState[_0x295317(0x10b)]=null;}function ensureStickyDragGlobalListeners(){const _0x396e6c=_0x2a6210;if(stickyDragGlobalListenersAttached)return;stickyDragGlobalListenersAttached=!![],document[_0x396e6c(0x2f7)](_0x396e6c(0x1e2),handleStickyDragMove),document[_0x396e6c(0x2f7)](_0x396e6c(0x11d),handleStickyDragMove,{'passive':![]}),document[_0x396e6c(0x2f7)]('mouseup',handleStickyDragEnd),document['addEventListener'](_0x396e6c(0x5a2),handleStickyDragEnd);}function initStickyDrag(_0x13c777,_0x5c59c2,_0x19ccab){const _0x2d862a=_0x2a6210;if(!_0x13c777||!_0x5c59c2)return;ensureStickyDragGlobalListeners(),_0x13c777[_0x2d862a(0x37e)][_0x2d862a(0x125)]=_0x2d862a(0x754),_0x13c777[_0x2d862a(0x772)]['noteId']=_0x5c59c2;let _0x46d9c7='';const _0x33a6d5=window['getComputedStyle'](_0x13c777),_0x5602d0=_0x33a6d5[_0x2d862a(0x61d)];if(_0x5602d0&&_0x5602d0!==_0x2d862a(0x22e)){const _0x2e1703=_0x5602d0[_0x2d862a(0x581)]('(')[0x1][_0x2d862a(0x581)](')')[0x0][_0x2d862a(0x581)](','),_0x3692da=parseFloat(_0x2e1703[0x0]),_0x3396b7=parseFloat(_0x2e1703[0x1]),_0x3344e2=Math[_0x2d862a(0x272)](Math[_0x2d862a(0x807)](_0x3396b7,_0x3692da)*(0xb4/Math['PI'])*0xa)/0xa;_0x46d9c7=_0x2d862a(0x1f0)+_0x3344e2+_0x2d862a(0x755);}const _0x42a3de=_0xb2eb03=>{const _0x1374b0=_0x2d862a;if(_0xb2eb03[_0x1374b0(0x66d)][_0x1374b0(0x2af)][_0x1374b0(0x353)](_0x1374b0(0x7a)))return;_0xb2eb03[_0x1374b0(0xf0)](),_0xb2eb03[_0x1374b0(0x69e)]();const _0x213899=_0xb2eb03[_0x1374b0(0x4df)]?_0xb2eb03['touches'][0x0]:_0xb2eb03,_0x7e345b=_0x13c777[_0x1374b0(0x17a)]();stickyDragState[_0x1374b0(0x7dd)]=!![],stickyDragState['currentSticky']=_0x13c777,stickyDragState[_0x1374b0(0x276)]=_0x5c59c2,stickyDragState[_0x1374b0(0x10b)]=_0x19ccab,stickyDragState['startX']=_0x213899['clientX'],stickyDragState[_0x1374b0(0x402)]=_0x213899[_0x1374b0(0x375)],stickyDragState[_0x1374b0(0x2b5)]=_0x213899[_0x1374b0(0x1c6)]-_0x7e345b[_0x1374b0(0x396)],stickyDragState[_0x1374b0(0x3d0)]=_0x213899[_0x1374b0(0x375)]-_0x7e345b[_0x1374b0(0x154)],stickyDragState[_0x1374b0(0x72e)]=_0x46d9c7,_0x13c777[_0x1374b0(0x2af)]['add'](_0x1374b0(0x1df)),_0x13c777[_0x1374b0(0x37e)][_0x1374b0(0xc7)]=_0x1374b0(0x522),_0x13c777['style'][_0x1374b0(0x125)]=_0x1374b0(0xc0);};_0x13c777[_0x2d862a(0x2f7)](_0x2d862a(0x506),_0x42a3de),_0x13c777[_0x2d862a(0x2f7)](_0x2d862a(0x5fb),_0x42a3de,{'passive':![]});}function applyCoverStyle(_0x54705e){const _0x59d7bd=_0x2a6210;if(!_0x54705e||!_0x54705e[_0x59d7bd(0x6cf)])return;const _0x2735d6=document['getElementById'](_0x59d7bd(0x473));if(!_0x2735d6)return;Object[_0x59d7bd(0x6dd)](_0x54705e[_0x59d7bd(0x6cf)])[_0x59d7bd(0x84c)](([_0x49d679,_0x4ec2aa])=>{const _0x18f37f=_0x59d7bd;if(_0x49d679['startsWith'](_0x18f37f(0x347))){if(_0x49d679===_0x18f37f(0x660)&&!isNeutralDiaryPageColor(_0x4ec2aa)){_0x2735d6[_0x18f37f(0x37e)][_0x18f37f(0x426)](_0x49d679);return;}_0x2735d6['style'][_0x18f37f(0x63d)](_0x49d679,_0x4ec2aa),console[_0x18f37f(0x40b)](_0x18f37f(0x517)+_0x49d679+':\x20'+_0x4ec2aa);}});const _0x40e01c=_0x54705e[_0x59d7bd(0x6cf)][_0x59d7bd(0x415)];if(_0x40e01c){const _0x2fbc2e=isLightColor(_0x40e01c);_0x2fbc2e?_0x2735d6[_0x59d7bd(0x37e)][_0x59d7bd(0x63d)](_0x59d7bd(0x4ee),_0x59d7bd(0x2f8)):_0x2735d6[_0x59d7bd(0x37e)][_0x59d7bd(0x63d)](_0x59d7bd(0x4ee),'linear-gradient(90deg,\x20rgba(0,0,0,0.5)\x200%,\x20rgba(0,0,0,0.15)\x2050%,\x20rgba(255,255,255,0.03)\x20100%)');}}function isLightColor(_0xf47af2){const _0x21a3df=_0x2a6210;if(_0xf47af2[_0x21a3df(0x78a)]('#')){const _0x17fe3e=_0xf47af2[_0x21a3df(0x4c1)](0x1),_0x550cde=parseInt(_0x17fe3e['substr'](0x0,0x2),0x10),_0x101a83=parseInt(_0x17fe3e[_0x21a3df(0x26b)](0x2,0x2),0x10),_0x2d9d9a=parseInt(_0x17fe3e[_0x21a3df(0x26b)](0x4,0x2),0x10),_0xbb2f55=(_0x550cde*0x12b+_0x101a83*0x24b+_0x2d9d9a*0x72)/0x3e8;return _0xbb2f55>0x80;}return!![];}function isNeutralDiaryPageColor(_0x53ab7d){const _0x4cd2ca=_0x2a6210;if(!_0x53ab7d||typeof _0x53ab7d!==_0x4cd2ca(0x6b0))return![];if(!_0x53ab7d[_0x4cd2ca(0x78a)]('#')||_0x53ab7d[_0x4cd2ca(0x73a)]!==0x7)return![];const _0x59f890=_0x53ab7d[_0x4cd2ca(0x4c1)](0x1),_0x309b56=parseInt(_0x59f890[_0x4cd2ca(0x26b)](0x0,0x2),0x10),_0x4e3b2f=parseInt(_0x59f890['substr'](0x2,0x2),0x10),_0x555bb8=parseInt(_0x59f890[_0x4cd2ca(0x26b)](0x4,0x2),0x10);if([_0x309b56,_0x4e3b2f,_0x555bb8][_0x4cd2ca(0x521)](_0x45a73a=>Number[_0x4cd2ca(0x4ef)](_0x45a73a)))return![];const _0x2398b7=Math[_0x4cd2ca(0x5b1)](_0x309b56,_0x4e3b2f,_0x555bb8),_0x3dcb27=Math[_0x4cd2ca(0x596)](_0x309b56,_0x4e3b2f,_0x555bb8);return _0x2398b7-_0x3dcb27<=0x18;}async function showPasswordDialog(_0x29a064){return new Promise(_0x2e0878=>{const _0x5ba871=_0x18ea;console[_0x5ba871(0x40b)](_0x5ba871(0x42a),_0x29a064[_0x5ba871(0x60e)]);let _0x5d2829=0x0;const _0x34da6a=0x5,_0x17ff2b=_0x29a064[_0x5ba871(0x60e)]||{},_0x3b5a67=_0x17ff2b[_0x5ba871(0x4c6)]||{},_0x3e6136=document['createElement'](_0x5ba871(0x5ab));_0x3e6136[_0x5ba871(0x37e)][_0x5ba871(0x428)]=_0x5ba871(0x49c);const _0x5b5171=document[_0x5ba871(0x24b)](_0x5ba871(0x5ab));_0x5b5171[_0x5ba871(0x37e)][_0x5ba871(0x428)]=(_0x3b5a67['container']||_0x5ba871(0x3a9))+';\x20position:\x20relative;';if(_0x17ff2b[_0x5ba871(0xfd)]){const _0x4b166f=document[_0x5ba871(0x24b)](_0x5ba871(0x5ab));_0x4b166f[_0x5ba871(0x63f)]=_0x17ff2b[_0x5ba871(0xfd)],_0x4b166f[_0x5ba871(0x37e)]['cssText']=_0x3b5a67[_0x5ba871(0x24e)]||'',_0x5b5171['appendChild'](_0x4b166f);}const _0x249001=document[_0x5ba871(0x24b)]('div');_0x249001[_0x5ba871(0x2a1)]=_0x17ff2b[_0x5ba871(0x153)]||'请输入日记本密码',_0x249001[_0x5ba871(0x37e)][_0x5ba871(0x428)]=_0x5ba871(0x12c),_0x5b5171[_0x5ba871(0x744)](_0x249001);const _0xe69762=document[_0x5ba871(0x24b)]('input');_0xe69762[_0x5ba871(0x1e9)]=_0x5ba871(0x3c8),_0xe69762[_0x5ba871(0x26f)]=_0x17ff2b[_0x5ba871(0x7aa)]||'Password',_0xe69762[_0x5ba871(0x37e)][_0x5ba871(0x428)]=_0x3b5a67[_0x5ba871(0x603)]||_0x5ba871(0x716),_0x5b5171[_0x5ba871(0x744)](_0xe69762);const _0x37f5b6=document[_0x5ba871(0x24b)]('div');_0x37f5b6[_0x5ba871(0x37e)]['cssText']=_0x3b5a67['error']||'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#e57373;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x2016px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-top:\x208px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x5b5171[_0x5ba871(0x744)](_0x37f5b6);const _0x1c56c9=document[_0x5ba871(0x24b)](_0x5ba871(0x5ab));_0x1c56c9[_0x5ba871(0x37e)][_0x5ba871(0x428)]=(_0x3b5a67[_0x5ba871(0x297)]||_0x5ba871(0x7e2))+';\x20display:\x20none;',_0x1c56c9[_0x5ba871(0x2a1)]=_0x17ff2b['hintText']||_0x5ba871(0x4c7)+(_0x29a064[_0x5ba871(0x297)]||_0x5ba871(0x790)),_0x5b5171[_0x5ba871(0x744)](_0x1c56c9);const _0x47855a=document[_0x5ba871(0x24b)](_0x5ba871(0x6fc));_0x47855a['textContent']=_0x17ff2b[_0x5ba871(0x11a)]||'确认',_0x47855a['style'][_0x5ba871(0x428)]=_0x3b5a67[_0x5ba871(0x6fc)]||_0x5ba871(0x34b),_0x5b5171['appendChild'](_0x47855a);const _0xcc3928=()=>{const _0x24cd23=_0x5ba871,_0xc6eb50=_0xe69762[_0x24cd23(0x4cf)][_0x24cd23(0x14c)]();_0xc6eb50===_0x29a064['password']?(document[_0x24cd23(0x71)]['removeChild'](_0x3e6136),_0x2e0878(!![])):(_0x5d2829++,_0x5d2829>=_0x34da6a?(_0x37f5b6[_0x24cd23(0x2a1)]=_0x17ff2b['errorText']||_0x24cd23(0xb9),_0x1c56c9[_0x24cd23(0x37e)]['display']=_0x24cd23(0x201)):_0x37f5b6[_0x24cd23(0x2a1)]=_0x17ff2b['errorText']||_0x24cd23(0x2d0)+(_0x34da6a-_0x5d2829)+'次',_0xe69762[_0x24cd23(0x4cf)]='',_0xe69762[_0x24cd23(0x2f4)]());};_0x47855a[_0x5ba871(0x2f7)](_0x5ba871(0x810),_0xcc3928),_0xe69762['addEventListener'](_0x5ba871(0x59a),_0x596da1=>{const _0x3c3a98=_0x5ba871;_0x596da1[_0x3c3a98(0x571)]===_0x3c3a98(0x53b)&&_0xcc3928();});const _0x23dc02=_0x564db3=>{const _0x7cfe57=_0x5ba871;_0x564db3[_0x7cfe57(0x571)]==='Escape'&&(document['body'][_0x7cfe57(0x16d)](_0x3e6136),document[_0x7cfe57(0x2a2)](_0x7cfe57(0x1bc),_0x23dc02),_0x2e0878(![]));};document[_0x5ba871(0x2f7)](_0x5ba871(0x1bc),_0x23dc02),_0x3e6136['addEventListener'](_0x5ba871(0x810),_0x21d972=>{const _0x32f4b7=_0x5ba871;_0x21d972['target']===_0x3e6136&&(document[_0x32f4b7(0x71)]['removeChild'](_0x3e6136),document['removeEventListener'](_0x32f4b7(0x1bc),_0x23dc02),_0x2e0878(![]));}),_0x3e6136[_0x5ba871(0x744)](_0x5b5171),document['body'][_0x5ba871(0x744)](_0x3e6136),_0xe69762['focus']();});}async function openCharacterDiary(_0x185e57){const _0x2361c1=_0x2a6210,_0x552580=document[_0x2361c1(0x550)](_0x2361c1(0x473));if(!_0x552580)return;_0x185e57=normalizeId(_0x185e57),currentDiaryCharacterId=_0x185e57;let _0x5debb0=null;try{const _0x2cb0ba=await getCharacterById(_0x185e57);if(_0x2cb0ba){const _0x54c83d=await db[_0x2361c1(0x5d1)][_0x2361c1(0x60f)](normalizeId(currentChatId)),_0x1715e1=resolveChatDisplayName(null,{'chatSettings':_0x54c83d,'fallbackName':_0x2cb0ba[_0x2361c1(0x189)]||'','defaultName':_0x2361c1(0x440)});_0x5debb0={'id':_0x185e57,'name':_0x1715e1,'originalName':_0x2cb0ba[_0x2361c1(0x189)]||'Unknown','avatar':_0x2cb0ba['settings']?.['aiAvatar']||'','bio':_0x2cb0ba[_0x2361c1(0x7b2)]||_0x2361c1(0x71a)};}}catch(_0x156d38){console['warn'](_0x2361c1(0x109),_0x156d38);}!_0x5debb0&&(_0x5debb0={'id':_0x185e57,'name':_0x2361c1(0x440),'avatar':'','bio':_0x2361c1(0x71a)});let _0x34eba3=null;try{const _0x3561a8=await db[_0x2361c1(0x5d1)][_0x2361c1(0x60f)](currentChatId);if(_0x3561a8?.[_0x2361c1(0x5f2)]&&_0x3561a8['userProfileId']!==_0x2361c1(0x653)&&_0x3561a8[_0x2361c1(0x5f2)]!==_0x2361c1(0x283))_0x34eba3=_0x3561a8[_0x2361c1(0x5f2)];else{const _0x5ac8c0=await db['globalSettings']['get']('currentProfileId');_0x34eba3=_0x5ac8c0?.[_0x2361c1(0x4cf)]||null;}}catch(_0x136c18){console[_0x2361c1(0x3bc)]('获取userProfileId失败:',_0x136c18);}const _0x42ea00=currentSessionId||_0x2361c1(0x2a7),_0xbadc14=_0x34eba3||'';currentDiarySessionId=_0x42ea00,currentDiaryProfileId=_0xbadc14,currentDiaryCharacterMeta=_0x5debb0,diaryDedupeArmed=![],diaryDedupeRunning=![];if(diaryDedupeArmTimeout)clearTimeout(diaryDedupeArmTimeout);diaryDedupeArmTimeout=null;const _0x4b6b87=await getDiaryPassword(_0x185e57,_0x42ea00,_0xbadc14);if(_0x4b6b87&&_0x4b6b87[_0x2361c1(0x3c8)]){const _0xa83fd6=await getDiaryUnlockState(_0x185e57,_0x42ea00,_0xbadc14);if(!_0xa83fd6){const _0x514549=await showPasswordDialog(_0x4b6b87);if(!_0x514549)return;await setDiaryUnlockState(_0x185e57,_0x42ea00,_0xbadc14,!![]);}}await recordDiaryView(_0x185e57,_0x42ea00,_0xbadc14);let _0xe335d=[];try{_0xe335d=await getDiaryList(_0x185e57,_0x42ea00,_0xbadc14);}catch(_0x5912d3){console[_0x2361c1(0x5d9)](_0x2361c1(0x83e),_0x5912d3),showIslandNotification('错误',_0x2361c1(0x628),_0x2361c1(0x4fd)),_0xe335d=[];}let _0x15003c=[],_0x178e6f=0x0;try{_0x15003c=await db['characterDiary'][_0x2361c1(0x115)](_0x2361c1(0x2c8))[_0x2361c1(0x630)]([_0x185e57,_0x42ea00,_0xbadc14])['and'](_0x16192b=>_0x16192b['type']==='note')[_0x2361c1(0x651)](),_0x178e6f=_0x15003c[_0x2361c1(0x73a)];}catch(_0x12093d){console[_0x2361c1(0x3bc)]('获取笔记失败:',_0x12093d);}const _0x816ee6=await getCoverStyle(_0x185e57,_0x42ea00,_0xbadc14);_0x816ee6&&(console[_0x2361c1(0x40b)](_0x2361c1(0x607),_0x816ee6[_0x2361c1(0x694)]||_0x2361c1(0x187)),applyCoverStyle(_0x816ee6));renderDiaryCover(_0x5debb0,_0xe335d,_0x178e6f,_0x816ee6),ensureDiaryDedupeButton();const _0x345487=new Set(_0xe335d[_0x2361c1(0x444)](_0x450464=>_0x450464[_0x2361c1(0xe2)])),_0x1bddae=new Set();_0x15003c[_0x2361c1(0x84c)](_0x435183=>{const _0x3b54c3=_0x2361c1;!_0x345487[_0x3b54c3(0x17f)](_0x435183[_0x3b54c3(0xe2)])&&_0x1bddae[_0x3b54c3(0x2a8)](_0x435183[_0x3b54c3(0xe2)]);});const _0x414881=_0x1bddae[_0x2361c1(0x719)];renderDiaryPages(_0xe335d,_0x185e57,_0x42ea00,_0xbadc14,_0x15003c),diaryCurrentPage=0x0,diaryTotalPages=0x2+_0xe335d[_0x2361c1(0x73a)]+_0x414881;const _0x134947=document[_0x2361c1(0x854)](_0x2361c1(0x6ae));_0x134947[_0x2361c1(0x84c)](_0xa95324=>_0xa95324[_0x2361c1(0x2af)][_0x2361c1(0x5e8)](_0x2361c1(0x840))),updateDiaryZ(),_0x552580[_0x2361c1(0x2af)][_0x2361c1(0x2a8)]('active');}function closeDiary(){const _0x7f9717=_0x2a6210,_0x409ccf=document[_0x7f9717(0x550)](_0x7f9717(0x473));_0x409ccf&&_0x409ccf[_0x7f9717(0x2af)][_0x7f9717(0x5e8)]('active');currentDiaryCharacterId=null,currentDiarySessionId=null,currentDiaryProfileId=null,currentDiaryCharacterMeta=null,diaryRenderData=null,diaryPageCache[_0x7f9717(0x20d)](),stickyDragState[_0x7f9717(0x7dd)]=![],stickyDragState[_0x7f9717(0x546)]=null,stickyDragState[_0x7f9717(0x10b)]=null,diaryDedupeArmed=![],diaryDedupeRunning=![];if(diaryDedupeArmTimeout)clearTimeout(diaryDedupeArmTimeout);diaryDedupeArmTimeout=null;}function renderDiaryCover(_0x33d88f,_0x2ccbaf=[],_0x324c63=0x0,_0x52da54=null){const _0x50ccb5=_0x2a6210;if(_0x52da54&&_0x52da54[_0x50ccb5(0x6c6)]){const _0x16223a=document[_0x50ccb5(0x2ba)](_0x50ccb5(0x3fc));if(_0x16223a){let _0x27785f=_0x52da54[_0x50ccb5(0x6c6)][_0x50ccb5(0x7a9)](/\{\{name\}\}/g,_0x33d88f[_0x50ccb5(0x189)]||_0x50ccb5(0x200))[_0x50ccb5(0x7a9)](/\{\{char\}\}/g,_0x33d88f[_0x50ccb5(0x189)]||_0x50ccb5(0x200))[_0x50ccb5(0x7a9)](/\{\{days\}\}/g,_0x2ccbaf[_0x50ccb5(0x73a)][_0x50ccb5(0x1ac)]())['replace'](/\{\{notes\}\}/g,_0x324c63[_0x50ccb5(0x1ac)]())['replace'](/\{\{bio\}\}/g,_0x33d88f[_0x50ccb5(0x7b2)]||_0x50ccb5(0xdf))[_0x50ccb5(0x7a9)](/\{\{date\}\}/g,new Date()['toISOString']()[_0x50ccb5(0x581)]('T')[0x0]);_0x16223a[_0x50ccb5(0x63f)]=_0x50ccb5(0x7ce)+_0x27785f+_0x50ccb5(0x2e1);const _0x2ee0d9=document[_0x50ccb5(0x24b)]('div');_0x2ee0d9[_0x50ccb5(0x337)]='diary-back-btn',_0x2ee0d9[_0x50ccb5(0x7a1)]=closeDiary,_0x2ee0d9['innerHTML']=_0x50ccb5(0xa9),_0x16223a[_0x50ccb5(0x343)](_0x2ee0d9,_0x16223a['firstChild']);const _0xb1b0b=document['createElement'](_0x50ccb5(0x5ab));_0xb1b0b[_0x50ccb5(0x337)]=_0x50ccb5(0x50c),_0xb1b0b[_0x50ccb5(0x7a1)]=()=>diaryFlip(0x1),_0xb1b0b[_0x50ccb5(0x63f)]=_0x50ccb5(0x605),_0x16223a['appendChild'](_0xb1b0b);return;}}const _0xaf9715=document[_0x50ccb5(0x550)](_0x50ccb5(0x7d7));if(_0xaf9715)_0xaf9715[_0x50ccb5(0x2a1)]=_0x33d88f[_0x50ccb5(0x189)]||_0x50ccb5(0x1b1);const _0x1d6afb=document[_0x50ccb5(0x550)]('diaryCoverAvatar');if(_0x1d6afb){if(_0x33d88f[_0x50ccb5(0x830)])_0x1d6afb[_0x50ccb5(0x655)]=_0x33d88f[_0x50ccb5(0x830)],_0x1d6afb['style'][_0x50ccb5(0x712)]=_0x50ccb5(0x201);else{_0x1d6afb[_0x50ccb5(0x37e)][_0x50ccb5(0x712)]='none';const _0x373721=document[_0x50ccb5(0x550)](_0x50ccb5(0x44c));if(_0x373721)_0x373721[_0x50ccb5(0x2a1)]='?';}}const _0x47f872=document[_0x50ccb5(0x550)](_0x50ccb5(0x22c));if(_0x47f872)_0x47f872[_0x50ccb5(0x2a1)]=_0x33d88f[_0x50ccb5(0x7b2)]||_0x50ccb5(0x71a);const _0xd52230=document[_0x50ccb5(0x550)](_0x50ccb5(0xf6)),_0x7fbac1=document[_0x50ccb5(0x550)](_0x50ccb5(0x4ba)),_0x49afb1=document['getElementById'](_0x50ccb5(0x649)),_0x14a578=_0x2ccbaf[_0x50ccb5(0x73a)];if(_0xd52230)_0xd52230[_0x50ccb5(0x2a1)]=_0x14a578[_0x50ccb5(0x1ac)]();if(_0x7fbac1)_0x7fbac1[_0x50ccb5(0x2a1)]=_0x324c63[_0x50ccb5(0x1ac)]();let _0xdef623='--';if(_0x2ccbaf['length']>0x0){const _0x3396b=_0x2ccbaf[_0x2ccbaf[_0x50ccb5(0x73a)]-0x1];if(_0x3396b['date']){const _0x4f70a5=new Date(_0x3396b[_0x50ccb5(0xe2)]);_0xdef623=_0x4f70a5[_0x50ccb5(0x113)]()+0x1+'/'+_0x4f70a5[_0x50ccb5(0x7d8)]();}}if(_0x49afb1)_0x49afb1[_0x50ccb5(0x2a1)]=_0xdef623;const _0x1c22e9=document[_0x50ccb5(0x550)](_0x50ccb5(0x1fd));if(_0x1c22e9){if(_0x2ccbaf[_0x50ccb5(0x73a)]>0x0){const _0x334c69=_0x2ccbaf[_0x2ccbaf[_0x50ccb5(0x73a)]-0x1];_0x1c22e9[_0x50ccb5(0x2a1)]=_0x50ccb5(0x7cb)+(_0x334c69[_0x50ccb5(0xe2)]||'--');}else _0x1c22e9[_0x50ccb5(0x2a1)]='Since\x20--';}const _0x2c7381=document['getElementById']('diaryEmptyHint');_0x2c7381&&(_0x2c7381[_0x50ccb5(0x37e)]['display']=_0x2ccbaf[_0x50ccb5(0x73a)]>0x0?_0x50ccb5(0x22e):'flex');}const diaryPageCache=new Map();let diaryLazyLoadEnabled=!![],diaryRenderData=null;function lazyRenderDiaryPage(_0x82b16d){const _0x39d50e=_0x2a6210;if(!diaryRenderData||!diaryLazyLoadEnabled)return;ensureDiaryStyleInjected();const {diaryEntries:_0x143433,characterId:_0x308d37,sessionId:_0x7e0697,profileId:_0x3e9602,notesByDate:_0x57a10e,moodIcons:_0x5bfd4d,stickyColors:_0x55d896,stickyLabels:_0x15645b}=diaryRenderData,_0x12df17=_0x82b16d-0x2;if(_0x12df17<0x0||_0x12df17>=_0x143433[_0x39d50e(0x73a)])return;const _0x3e4e98=document['getElementById']('diaryPage'+_0x82b16d);if(!_0x3e4e98||!_0x3e4e98[_0x39d50e(0x772)][_0x39d50e(0x242)])return;const _0x203b86=_0x143433[_0x12df17],_0x4275db=_0x57a10e[_0x203b86[_0x39d50e(0xe2)]]||[],_0x4f3557=document[_0x39d50e(0x24b)]('div');_0x4f3557['className']=_0x39d50e(0x45a),_0x4f3557['id']='diaryPage'+_0x82b16d;const _0x197b4f=new Date(_0x203b86[_0x39d50e(0xe2)]),_0x5f4e87=[_0x39d50e(0x681),_0x39d50e(0x798),_0x39d50e(0x3cd),_0x39d50e(0x70d),_0x39d50e(0x756),_0x39d50e(0x207),_0x39d50e(0x528)],_0x6f784f=_0x5f4e87[_0x197b4f[_0x39d50e(0x640)]()],_0x50ec6f=_0x197b4f[_0x39d50e(0x2ad)](),_0x37947e=String(_0x197b4f[_0x39d50e(0x113)]()+0x1)[_0x39d50e(0x6a6)](0x2,'0'),_0x368438=String(_0x197b4f[_0x39d50e(0x7d8)]())[_0x39d50e(0x6a6)](0x2,'0'),_0x1aa794=_0x50ec6f+'.'+_0x37947e+'.'+_0x368438,_0x457d5a=_0x37947e+'/'+_0x368438,_0x42a3e2=_0x203b86[_0x39d50e(0x1c7)]||'',_0x1f4460=_0x5bfd4d[_0x42a3e2]||_0x5bfd4d[_0x42a3e2[_0x39d50e(0x5bd)]()]||'◇',_0x92b22a=normalizeDiaryContentHtml(_0x203b86[_0x39d50e(0x73c)]),_0x229026=shouldCollapseDiaryContent(_0x92b22a),_0x1280e5=_0x229026?_0x39d50e(0x558):_0x39d50e(0x2a5),_0x3dbe61=_0x229026?_0x39d50e(0x3f7):'';let _0x5d14e7='';if(_0x4275db[_0x39d50e(0x73a)]>0x0){const _0x2e4732=_0x238c67=>{const _0x2a6c82=Math['sin'](_0x238c67)*0x2710;return _0x2a6c82-Math['floor'](_0x2a6c82);},_0x54c98a={'right':{'minTop':0xb4,'maxTop':0x1a4,'minRight':0x14,'maxRight':0x28,'side':_0x39d50e(0x131)},'bottom':{'minBottom':0x5a,'maxBottom':0x82,'minLeft':0x28,'maxLeft':0xc8,'side':'bottom'}},_0x52d468=[],_0x30ed94=(_0x52d43d,_0x2c10e4,_0x1b6d8a)=>{const _0x462d40=_0x39d50e;for(const _0x538659 of _0x52d468){const _0x313110=Math[_0x462d40(0x4eb)](_0x52d43d['x']-_0x538659['x']),_0x4ea114=Math[_0x462d40(0x4eb)](_0x52d43d['y']-_0x538659['y']);if(_0x313110<(_0x2c10e4+_0x538659[_0x462d40(0x2fc)])/0x2+0x19&&_0x4ea114<(_0x1b6d8a+_0x538659[_0x462d40(0x4e9)])/0x2+0x19)return!![];}return![];};_0x4275db[_0x39d50e(0x84c)]((_0x23ccbc,_0x53a893)=>{const _0x5c0227=_0x39d50e,_0x346e72=_0x23ccbc['color']||_0x55d896[_0x53a893%_0x55d896[_0x5c0227(0x73a)]],_0x36d6eb=_0x15645b[_0x53a893%_0x15645b[_0x5c0227(0x73a)]],_0x2fc4a7=0x55,_0x5bb1eb=0x3c,_0x379902=_0x23ccbc[_0x5c0227(0x78b)]!==undefined&&_0x23ccbc['positionY']!==undefined;let _0x59961e='width:\x20'+_0x2fc4a7+_0x5c0227(0x18d);if(_0x379902)_0x59961e+='\x20left:\x20'+_0x23ccbc[_0x5c0227(0x78b)]+'px;\x20top:\x20'+_0x23ccbc['positionY']+_0x5c0227(0x18d);else{const _0x1e0c1b=[_0x5c0227(0x131),'bottom'],_0xda12ce=_0x1e0c1b[Math[_0x5c0227(0x5b7)](_0x2e4732(_0x53a893*0x7)*0x2)],_0x3e68d9=_0x54c98a[_0xda12ce];let _0x564a7f=null,_0x4eb6d3=0x0;while(_0x4eb6d3<0xa&&!_0x564a7f){const _0xa2ce26=_0x53a893*0x64+_0x4eb6d3;let _0x2a20db,_0x290d5e,_0xb6d221,_0x435828,_0x522101,_0x499f7f;_0x3e68d9[_0x5c0227(0x18a)]===_0x5c0227(0x131)?(_0xb6d221=_0x3e68d9[_0x5c0227(0x243)]+_0x2e4732(_0xa2ce26)*(_0x3e68d9[_0x5c0227(0x61e)]-_0x3e68d9[_0x5c0227(0x243)]),_0x522101=_0x3e68d9[_0x5c0227(0x6a1)]+_0x2e4732(_0xa2ce26+0x1)*(_0x3e68d9['maxRight']-_0x3e68d9[_0x5c0227(0x6a1)]),_0x2a20db=0x12c-_0x522101-_0x2fc4a7/0x2,_0x290d5e=_0xb6d221+_0x5bb1eb/0x2):(_0x499f7f=_0x3e68d9['minBottom']+_0x2e4732(_0xa2ce26)*(_0x3e68d9['maxBottom']-_0x3e68d9['minBottom']),_0x435828=_0x3e68d9[_0x5c0227(0xed)]+_0x2e4732(_0xa2ce26+0x1)*(_0x3e68d9[_0x5c0227(0x13c)]-_0x3e68d9[_0x5c0227(0xed)]),_0x2a20db=_0x435828+_0x2fc4a7/0x2,_0x290d5e=0x226-_0x499f7f-_0x5bb1eb/0x2),!_0x30ed94({'x':_0x2a20db,'y':_0x290d5e},_0x2fc4a7,_0x5bb1eb)&&(_0x564a7f={'top':_0xb6d221,'left':_0x435828,'right':_0x522101,'bottom':_0x499f7f},_0x52d468['push']({'x':_0x2a20db,'y':_0x290d5e,'width':_0x2fc4a7,'height':_0x5bb1eb})),_0x4eb6d3++;}if(!_0x564a7f){const _0x27e3d2=[{'top':0xc8,'right':0x19},{'top':0x12c,'right':0x1e},{'top':0x17c,'right':0x23},{'bottom':0x64,'left':0x32},{'bottom':0x6e,'left':0x82}];_0x564a7f=_0x27e3d2[_0x53a893%_0x27e3d2['length']];}if(_0x564a7f[_0x5c0227(0x154)]!==undefined)_0x59961e+=_0x5c0227(0x1ed)+Math[_0x5c0227(0x272)](_0x564a7f[_0x5c0227(0x154)])+_0x5c0227(0x18d);if(_0x564a7f['bottom']!==undefined)_0x59961e+='\x20bottom:\x20'+Math[_0x5c0227(0x272)](_0x564a7f[_0x5c0227(0x3e5)])+_0x5c0227(0x18d);if(_0x564a7f[_0x5c0227(0x396)]!==undefined)_0x59961e+='\x20left:\x20'+Math[_0x5c0227(0x272)](_0x564a7f[_0x5c0227(0x396)])+_0x5c0227(0x18d);if(_0x564a7f['right']!==undefined)_0x59961e+=_0x5c0227(0x1c3)+Math['round'](_0x564a7f[_0x5c0227(0x131)])+_0x5c0227(0x18d);}const _0x4b5db6=-0x3+_0x2e4732(_0x53a893*0xd)*0x6;_0x59961e+='\x20transform:\x20rotate('+_0x4b5db6[_0x5c0227(0x252)](0x1)+_0x5c0227(0x29d),_0x5d14e7+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-sticky\x20'+_0x346e72+_0x5c0227(0x4a8)+_0x23ccbc['id']+_0x5c0227(0x339)+_0x59961e+_0x5c0227(0x58e)+_0x36d6eb+_0x5c0227(0x1cf)+_0x457d5a+_0x5c0227(0x58d)+_0x23ccbc['id']+_0x5c0227(0x788)+(_0x23ccbc['content']||'')+_0x5c0227(0x72d);});}_0x4f3557['innerHTML']=_0x39d50e(0x5ea)+_0x1aa794+_0x39d50e(0xfa)+_0x6f784f+_0x39d50e(0x799)+_0x1f4460+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+_0x42a3e2+_0x39d50e(0x2b2)+(_0x203b86['title']||'')+_0x39d50e(0x4d7)+_0x1280e5+_0x39d50e(0x4fa)+_0x92b22a+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x3dbe61+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x5d14e7+'\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-foot\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22diary-page-num\x22>-\x20'+_0x82b16d+_0x39d50e(0x680),_0x3e4e98[_0x39d50e(0x57b)](_0x4f3557);const _0x3f3c26=_0x4f3557[_0x39d50e(0x854)]('.diary-sticky[data-note-id]');_0x3f3c26['forEach'](_0x3a3b3d=>{const _0x484158=_0x39d50e,_0x4f3c6c=parseInt(_0x3a3b3d[_0x484158(0x772)][_0x484158(0x276)]);_0x4f3c6c&&initStickyDrag(_0x3a3b3d,_0x4f3c6c,_0x4f3557);}),bindDiaryEntryToggle(_0x4f3557),console[_0x39d50e(0x40b)](_0x39d50e(0x4ea)+_0x82b16d+'页');}function lazyLoadNearbyPages(_0x18887b){if(!diaryLazyLoadEnabled)return;const _0x5d17e5=0x2;for(let _0xb574b9=-_0x5d17e5;_0xb574b9<=_0x5d17e5;_0xb574b9++){const _0x48953f=_0x18887b+_0xb574b9;_0x48953f>=0x2&&lazyRenderDiaryPage(_0x48953f);}}async function renderDiaryPages(_0x2411a4,_0x2973c1,_0x28d8f2,_0x50793a,_0x4c06c2=[]){const _0x372b33=_0x2a6210,_0x39f9a4=document[_0x372b33(0x550)]('diaryBook');if(!_0x39f9a4)return;ensureDiaryStyleInjected();try{diaryLazyLoadEnabled=_0x2411a4[_0x372b33(0x73a)]>0x1e,console[_0x372b33(0x40b)](_0x372b33(0x3eb)+_0x2411a4[_0x372b33(0x73a)]+_0x372b33(0x6e8)+(diaryLazyLoadEnabled?'启用':'禁用'));const _0x1b8087=_0x39f9a4[_0x372b33(0x854)](_0x372b33(0x461));_0x1b8087[_0x372b33(0x84c)](_0x5224a2=>_0x5224a2[_0x372b33(0x5e8)]()),diaryPageCache['clear']();const _0x3f2513=new Set(_0x2411a4[_0x372b33(0x444)](_0x56c5ff=>_0x56c5ff[_0x372b33(0xe2)])),_0x1ab0a2={};_0x4c06c2['forEach'](_0x2c351d=>{const _0x35c26c=_0x372b33;!_0x3f2513[_0x35c26c(0x17f)](_0x2c351d[_0x35c26c(0xe2)])&&(!_0x1ab0a2[_0x2c351d[_0x35c26c(0xe2)]]&&(_0x1ab0a2[_0x2c351d[_0x35c26c(0xe2)]]=[]),_0x1ab0a2[_0x2c351d[_0x35c26c(0xe2)]][_0x35c26c(0x2b9)](_0x2c351d));});const _0x1e5e39=Object[_0x372b33(0x186)](_0x1ab0a2)[_0x372b33(0x2f9)]((_0x9ef973,_0x5bb6c0)=>new Date(_0x5bb6c0)-new Date(_0x9ef973)),_0x2e0b61=document[_0x372b33(0x550)](_0x372b33(0x4b8));if(_0x2e0b61){_0x2e0b61[_0x372b33(0x63f)]='';const _0x507006=_0x2411a4[_0x372b33(0x73a)]>0x0||_0x1e5e39[_0x372b33(0x73a)]>0x0;if(!_0x507006){const _0x1677a5=document['createElement'](_0x372b33(0x5ab));_0x1677a5[_0x372b33(0x337)]=_0x372b33(0xc9),_0x1677a5['innerHTML']=_0x372b33(0x3fb),_0x2e0b61[_0x372b33(0x744)](_0x1677a5);}else _0x2411a4['forEach']((_0x1e3f76,_0x454613)=>{const _0x5f124d=_0x372b33,_0x3aeda6=_0x454613+0x2,_0x11f763=new Date(_0x1e3f76[_0x5f124d(0xe2)]),_0x1a5084=_0x11f763[_0x5f124d(0x113)]()+0x1+'/'+_0x11f763[_0x5f124d(0x7d8)](),_0x6e79d8=_0x1e3f76[_0x5f124d(0x1fa)]||_0x5f124d(0x31e),_0x782023=_0x1e3f76[_0x5f124d(0x1c7)]||'',_0x52a265=document[_0x5f124d(0x24b)](_0x5f124d(0x5ab));_0x52a265[_0x5f124d(0x337)]=_0x5f124d(0x44f),_0x52a265[_0x5f124d(0x7a1)]=()=>diaryGoToPage(_0x3aeda6),_0x52a265[_0x5f124d(0x63f)]=_0x5f124d(0x346)+_0x1a5084+_0x5f124d(0x553)+_0x6e79d8+'\x20'+(_0x782023?'<span\x20class=\x22diary-idx-mood\x22>'+_0x782023+_0x5f124d(0x162):'')+_0x5f124d(0x30e)+_0x3aeda6+_0x5f124d(0x292),_0x2e0b61[_0x5f124d(0x744)](_0x52a265);}),_0x1e5e39[_0x372b33(0x84c)]((_0x5472fd,_0x3d5bbd)=>{const _0x2ac69b=_0x372b33,_0xd29c14=_0x2411a4[_0x2ac69b(0x73a)]+_0x3d5bbd+0x2,_0x683ef=new Date(_0x5472fd),_0x368674=_0x683ef[_0x2ac69b(0x113)]()+0x1+'/'+_0x683ef[_0x2ac69b(0x7d8)](),_0x1e5bca=_0x1ab0a2[_0x5472fd][_0x2ac69b(0x73a)],_0x494b88=document[_0x2ac69b(0x24b)](_0x2ac69b(0x5ab));_0x494b88['className']=_0x2ac69b(0x7c3),_0x494b88['onclick']=()=>diaryGoToPage(_0xd29c14),_0x494b88[_0x2ac69b(0x63f)]=_0x2ac69b(0x346)+_0x368674+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22diary-idx-title\x22>📌\x20笔记\x20('+_0x1e5bca+_0x2ac69b(0x7ba)+_0xd29c14+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x2e0b61[_0x2ac69b(0x744)](_0x494b88);});}const _0x96a77e={'happy':'★','Happy':'★','开心':'★','高兴':'★','calm':'☆','Calm':'☆','平静':'☆','安静':'☆','excited':'♡','Excited':'♡','兴奋':'♡','激动':'♡','curious':'○','Curious':'○','好奇':'○','sad':'☁','Sad':'☁','难过':'☁','伤心':'☁','angry':'✕','Angry':'✕','生气':'✕','love':'♥','Love':'♥','喜欢':'♥','爱':'♥'},_0x1b32ce=['s1','s2','s3','s4','s5','s6'],_0x6f8a5c=[_0x372b33(0x80),_0x372b33(0x4b6),'TODO',_0x372b33(0x684),_0x372b33(0x114),'IDEA'],_0x4815e5={};_0x4c06c2[_0x372b33(0x84c)](_0x5c0406=>{const _0x5615bb=_0x372b33;!_0x4815e5[_0x5c0406[_0x5615bb(0xe2)]]&&(_0x4815e5[_0x5c0406[_0x5615bb(0xe2)]]=[]),_0x4815e5[_0x5c0406[_0x5615bb(0xe2)]][_0x5615bb(0x2b9)](_0x5c0406);}),console[_0x372b33(0x40b)]('📝\x20[日记本]\x20已分组'+Object[_0x372b33(0x186)](_0x4815e5)[_0x372b33(0x73a)]+_0x372b33(0x745));const _0x3c58c1=document[_0x372b33(0x45f)](),_0x544eab=diaryLazyLoadEnabled?_0x2411a4[_0x372b33(0x73a)]>0x78?0x4:_0x2411a4[_0x372b33(0x73a)]>0x3c?0x6:0xa:_0x2411a4[_0x372b33(0x73a)];console['log']('🚀\x20[日记本]\x20初始渲染'+_0x544eab+_0x372b33(0x5b6)+(_0x2411a4['length']-_0x544eab)+_0x372b33(0x436));for(let _0x250874=0x0;_0x250874<_0x2411a4[_0x372b33(0x73a)];_0x250874++){const _0x191b44=_0x2411a4[_0x250874],_0x5d9288=_0x250874+0x2;if(diaryLazyLoadEnabled&&_0x250874>=_0x544eab){const _0x4111ce=document[_0x372b33(0x24b)](_0x372b33(0x5ab));_0x4111ce[_0x372b33(0x337)]='diary-page\x20diary-inner\x20diary-dynamic\x20diary-lazy',_0x4111ce['id']=_0x372b33(0x231)+_0x5d9288,_0x4111ce[_0x372b33(0x772)][_0x372b33(0x16a)]=_0x250874,_0x4111ce[_0x372b33(0x772)]['lazyLoad']=_0x372b33(0x4a7),_0x3c58c1[_0x372b33(0x744)](_0x4111ce);continue;}const _0x192dd2=_0x4815e5[_0x191b44[_0x372b33(0xe2)]]||[],_0x185fb6=document[_0x372b33(0x24b)]('div');_0x185fb6['className']=_0x372b33(0x45a),_0x185fb6['id']=_0x372b33(0x231)+_0x5d9288;const _0x14d5bf=new Date(_0x191b44[_0x372b33(0xe2)]),_0x20ad99=[_0x372b33(0x681),_0x372b33(0x798),_0x372b33(0x3cd),_0x372b33(0x70d),_0x372b33(0x756),_0x372b33(0x207),_0x372b33(0x528)],_0x456600=_0x20ad99[_0x14d5bf[_0x372b33(0x640)]()],_0x5f2e2f=_0x14d5bf['getFullYear'](),_0x453991=String(_0x14d5bf['getMonth']()+0x1)[_0x372b33(0x6a6)](0x2,'0'),_0x4eeb1c=String(_0x14d5bf[_0x372b33(0x7d8)]())[_0x372b33(0x6a6)](0x2,'0'),_0x2e2bb2=_0x5f2e2f+'.'+_0x453991+'.'+_0x4eeb1c,_0x14ccd6=_0x453991+'/'+_0x4eeb1c,_0x3ee6aa=_0x191b44[_0x372b33(0x1c7)]||'',_0x332979=_0x96a77e[_0x3ee6aa]||_0x96a77e[_0x3ee6aa[_0x372b33(0x5bd)]()]||'◇',_0x2994c0=normalizeDiaryContentHtml(_0x191b44['content']),_0x178659=shouldCollapseDiaryContent(_0x2994c0),_0x1a0625=_0x178659?'diary-entry-content\x20collapsible\x20collapsed':_0x372b33(0x2a5),_0xc6ca5b=_0x178659?_0x372b33(0x3f7):'';let _0x221e91='';if(_0x192dd2['length']>0x0){const _0x2a045a=_0x52224b=>{const _0x432689=_0x372b33,_0x8c0319=Math[_0x432689(0x2d6)](_0x52224b)*0x2710;return _0x8c0319-Math[_0x432689(0x5b7)](_0x8c0319);},_0x390d3f={'right':{'minTop':0xb4,'maxTop':0x1a4,'minRight':0x14,'maxRight':0x28,'side':_0x372b33(0x131)},'bottom':{'minBottom':0x5a,'maxBottom':0x82,'minLeft':0x28,'maxLeft':0xc8,'side':_0x372b33(0x3e5)}},_0x235a47=[],_0x2fa421=(_0x36a263,_0x2aa62d,_0x4dcaf9)=>{const _0x12f9b3=_0x372b33;for(const _0x36206d of _0x235a47){const _0x107bda=Math[_0x12f9b3(0x4eb)](_0x36a263['x']-_0x36206d['x']),_0x4ac1f6=Math[_0x12f9b3(0x4eb)](_0x36a263['y']-_0x36206d['y']);if(_0x107bda<(_0x2aa62d+_0x36206d['width'])/0x2+0x19&&_0x4ac1f6<(_0x4dcaf9+_0x36206d[_0x12f9b3(0x4e9)])/0x2+0x19)return!![];}return![];};_0x192dd2['forEach']((_0x49ad0b,_0x3f3f35)=>{const _0x551c93=_0x372b33,_0x21601a=_0x49ad0b['color']||_0x1b32ce[_0x3f3f35%_0x1b32ce['length']],_0xb4f7e6=_0x6f8a5c[_0x3f3f35%_0x6f8a5c[_0x551c93(0x73a)]],_0x5f2448=0x55,_0x50e064=0x3c,_0xcc903b=_0x49ad0b[_0x551c93(0x78b)]!==undefined&&_0x49ad0b['positionY']!==undefined;let _0x2c88f3=_0x551c93(0x85f)+_0x5f2448+_0x551c93(0x18d);if(_0xcc903b)_0x2c88f3+='\x20left:\x20'+_0x49ad0b[_0x551c93(0x78b)]+'px;\x20top:\x20'+_0x49ad0b['positionY']+_0x551c93(0x18d);else{const _0x572940=[_0x551c93(0x131),_0x551c93(0x3e5)],_0x590ba5=_0x572940[Math['floor'](_0x2a045a(_0x3f3f35*0x7)*0x2)],_0x309056=_0x390d3f[_0x590ba5];let _0x4c325b=null,_0x360768=0x0;while(_0x360768<0xa&&!_0x4c325b){const _0x1f4c02=_0x3f3f35*0x64+_0x360768;let _0x214bd0,_0x43ab67,_0x2a381d,_0x2476e1,_0x1376e2,_0x4337b0;_0x309056[_0x551c93(0x18a)]===_0x551c93(0x131)?(_0x2a381d=_0x309056[_0x551c93(0x243)]+_0x2a045a(_0x1f4c02)*(_0x309056[_0x551c93(0x61e)]-_0x309056[_0x551c93(0x243)]),_0x1376e2=_0x309056[_0x551c93(0x6a1)]+_0x2a045a(_0x1f4c02+0x1)*(_0x309056['maxRight']-_0x309056[_0x551c93(0x6a1)]),_0x214bd0=0x12c-_0x1376e2-_0x5f2448/0x2,_0x43ab67=_0x2a381d+_0x50e064/0x2):(_0x4337b0=_0x309056[_0x551c93(0x265)]+_0x2a045a(_0x1f4c02)*(_0x309056[_0x551c93(0x4f9)]-_0x309056['minBottom']),_0x2476e1=_0x309056[_0x551c93(0xed)]+_0x2a045a(_0x1f4c02+0x1)*(_0x309056[_0x551c93(0x13c)]-_0x309056[_0x551c93(0xed)]),_0x214bd0=_0x2476e1+_0x5f2448/0x2,_0x43ab67=0x226-_0x4337b0-_0x50e064/0x2),!_0x2fa421({'x':_0x214bd0,'y':_0x43ab67},_0x5f2448,_0x50e064)&&(_0x4c325b={'top':_0x2a381d,'left':_0x2476e1,'right':_0x1376e2,'bottom':_0x4337b0},_0x235a47[_0x551c93(0x2b9)]({'x':_0x214bd0,'y':_0x43ab67,'width':_0x5f2448,'height':_0x50e064})),_0x360768++;}if(!_0x4c325b){const _0x3a1f3b=[{'top':0xc8,'right':0x19},{'top':0x12c,'right':0x1e},{'top':0x17c,'right':0x23},{'bottom':0x64,'left':0x32},{'bottom':0x6e,'left':0x82}];_0x4c325b=_0x3a1f3b[_0x3f3f35%_0x3a1f3b[_0x551c93(0x73a)]];}if(_0x4c325b[_0x551c93(0x154)]!==undefined)_0x2c88f3+='\x20top:\x20'+Math[_0x551c93(0x272)](_0x4c325b[_0x551c93(0x154)])+_0x551c93(0x18d);if(_0x4c325b[_0x551c93(0x3e5)]!==undefined)_0x2c88f3+='\x20bottom:\x20'+Math[_0x551c93(0x272)](_0x4c325b[_0x551c93(0x3e5)])+'px;';if(_0x4c325b[_0x551c93(0x396)]!==undefined)_0x2c88f3+=_0x551c93(0x40a)+Math[_0x551c93(0x272)](_0x4c325b[_0x551c93(0x396)])+_0x551c93(0x18d);if(_0x4c325b[_0x551c93(0x131)]!==undefined)_0x2c88f3+='\x20right:\x20'+Math[_0x551c93(0x272)](_0x4c325b[_0x551c93(0x131)])+_0x551c93(0x18d);}const _0x4d9416=-0x3+_0x2a045a(_0x3f3f35*0xd)*0x6;_0x2c88f3+='\x20transform:\x20rotate('+_0x4d9416[_0x551c93(0x252)](0x1)+_0x551c93(0x29d),_0x221e91+=_0x551c93(0x5f1)+_0x21601a+_0x551c93(0x4a8)+_0x49ad0b['id']+_0x551c93(0x339)+_0x2c88f3+_0x551c93(0x416)+_0xb4f7e6+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+_0x14ccd6+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22diary-sticky-delete\x22\x20onclick=\x22deleteDiaryNote('+_0x49ad0b['id']+_0x551c93(0x472)+(_0x49ad0b['content']||'')+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';});}_0x185fb6[_0x372b33(0x63f)]=_0x372b33(0x435)+_0x2e2bb2+_0x372b33(0x41e)+_0x456600+_0x372b33(0x682)+_0x332979+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+_0x3ee6aa+_0x372b33(0x6c7)+(_0x191b44['title']||'')+_0x372b33(0x6a5)+_0x1a0625+_0x372b33(0x718)+_0x2994c0+_0x372b33(0x66b)+_0xc6ca5b+_0x372b33(0x13d)+_0x221e91+_0x372b33(0x46f)+_0x5d9288+_0x372b33(0x2be),_0x3c58c1[_0x372b33(0x744)](_0x185fb6);const _0x11fbf5=_0x185fb6[_0x372b33(0x854)](_0x372b33(0x5ae));_0x11fbf5[_0x372b33(0x84c)](_0x157739=>{const _0x2c6fce=_0x372b33,_0x57a247=parseInt(_0x157739['dataset'][_0x2c6fce(0x276)]);_0x57a247&&initStickyDrag(_0x157739,_0x57a247,_0x185fb6);}),bindDiaryEntryToggle(_0x185fb6);}for(let _0x297c04=0x0;_0x297c04<_0x1e5e39[_0x372b33(0x73a)];_0x297c04++){const _0x17755b=_0x1e5e39[_0x297c04],_0x4e84fe=_0x1ab0a2[_0x17755b],_0x3451b5=_0x2411a4[_0x372b33(0x73a)]+_0x297c04+0x2,_0x4f6ae3=document[_0x372b33(0x24b)](_0x372b33(0x5ab));_0x4f6ae3[_0x372b33(0x337)]='diary-page\x20diary-inner\x20diary-dynamic',_0x4f6ae3['id']='diaryPage'+_0x3451b5;const _0x2fa3c9=new Date(_0x17755b),_0x44208e=[_0x372b33(0x681),_0x372b33(0x798),_0x372b33(0x3cd),_0x372b33(0x70d),_0x372b33(0x756),'Friday',_0x372b33(0x528)],_0x55f314=_0x44208e[_0x2fa3c9['getDay']()],_0x134ff0=_0x2fa3c9[_0x372b33(0x2ad)](),_0x141356=String(_0x2fa3c9[_0x372b33(0x113)]()+0x1)[_0x372b33(0x6a6)](0x2,'0'),_0x54cf9c=String(_0x2fa3c9[_0x372b33(0x7d8)]())[_0x372b33(0x6a6)](0x2,'0'),_0x5f1e07=_0x134ff0+'.'+_0x141356+'.'+_0x54cf9c,_0x2fdc62=_0x141356+'/'+_0x54cf9c;let _0x18d983='';const _0x41f209=_0x49ff00=>{const _0x3038fd=_0x372b33,_0x511e63=Math[_0x3038fd(0x2d6)](_0x49ff00)*0x2710;return _0x511e63-Math['floor'](_0x511e63);},_0x4767d0=[{'top':0x78,'left':0x1e},{'top':0x78,'right':0x1e},{'top':0xfa,'left':0x32},{'top':0xfa,'right':0x32},{'top':0x17c,'left':0x1e},{'top':0x17c,'right':0x1e}];_0x4e84fe[_0x372b33(0x84c)]((_0x2532df,_0x30bdac)=>{const _0x35f96f=_0x372b33,_0x5a9578=_0x2532df[_0x35f96f(0x279)]||_0x1b32ce[_0x30bdac%_0x1b32ce[_0x35f96f(0x73a)]],_0x3c6b87=_0x6f8a5c[_0x30bdac%_0x6f8a5c[_0x35f96f(0x73a)]],_0x2c1ea5=-0x3+_0x41f209(_0x30bdac*0xd)*0x6,_0x1b834f=_0x2532df[_0x35f96f(0x78b)]!==undefined&&_0x2532df[_0x35f96f(0x34d)]!==undefined;let _0x1f5cae=_0x35f96f(0x4a1);if(_0x1b834f)_0x1f5cae+='\x20left:\x20'+_0x2532df[_0x35f96f(0x78b)]+'px;\x20top:\x20'+_0x2532df[_0x35f96f(0x34d)]+_0x35f96f(0x18d);else{const _0x435036=_0x4767d0[_0x30bdac%_0x4767d0[_0x35f96f(0x73a)]];if(_0x435036[_0x35f96f(0x154)]!==undefined)_0x1f5cae+=_0x35f96f(0x1ed)+_0x435036['top']+_0x35f96f(0x18d);if(_0x435036[_0x35f96f(0x396)]!==undefined)_0x1f5cae+='\x20left:\x20'+_0x435036[_0x35f96f(0x396)]+'px;';if(_0x435036[_0x35f96f(0x131)]!==undefined)_0x1f5cae+=_0x35f96f(0x1c3)+_0x435036[_0x35f96f(0x131)]+_0x35f96f(0x18d);}_0x1f5cae+=_0x35f96f(0x1cb)+_0x2c1ea5[_0x35f96f(0x252)](0x1)+_0x35f96f(0x29d),_0x18d983+=_0x35f96f(0x2ae)+_0x5a9578+'\x22\x20data-note-id=\x22'+_0x2532df['id']+'\x22\x20style=\x22'+_0x1f5cae+_0x35f96f(0x58e)+_0x3c6b87+_0x35f96f(0x1cf)+_0x2fdc62+_0x35f96f(0x58d)+_0x2532df['id']+',\x20event)\x22\x20title=\x22删除笔记\x22>×</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-sticky-body\x22>'+(_0x2532df['content']||'')+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';}),_0x4f6ae3[_0x372b33(0x63f)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-face\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-spine\x20diary-spine-inner\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-holes\x22><div\x20class=\x22diary-hole\x22></div><div\x20class=\x22diary-hole\x22></div><div\x20class=\x22diary-hole\x22></div><div\x20class=\x22diary-hole\x22></div></div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-page-inner\x20diary-content-page\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20日期头部\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-head\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22diary-entry-date\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong>'+_0x5f1e07+_0x372b33(0x41e)+_0x55f314+_0x372b33(0x560)+_0x18d983+_0x372b33(0x46f)+_0x3451b5+_0x372b33(0x2be),_0x3c58c1[_0x372b33(0x744)](_0x4f6ae3);const _0x4d3d1e=_0x4f6ae3['querySelectorAll']('.diary-sticky[data-note-id]');_0x4d3d1e['forEach'](_0x3f6538=>{const _0x49809f=_0x372b33,_0x32b19f=parseInt(_0x3f6538['dataset'][_0x49809f(0x276)]);_0x32b19f&&initStickyDrag(_0x3f6538,_0x32b19f,_0x4f6ae3);});}console[_0x372b33(0x40b)](_0x372b33(0x789)+_0x3c58c1[_0x372b33(0x734)]+_0x372b33(0x722)),_0x39f9a4['appendChild'](_0x3c58c1),console[_0x372b33(0x40b)](_0x372b33(0x148)),diaryRenderData={'diaryEntries':_0x2411a4,'characterId':_0x2973c1,'sessionId':_0x28d8f2,'profileId':_0x50793a,'notesByDate':_0x4815e5,'moodIcons':_0x96a77e,'stickyColors':_0x1b32ce,'stickyLabels':_0x6f8a5c},diaryLazyLoadEnabled&&setTimeout(()=>{lazyLoadNearbyPages(0x0),lazyLoadNearbyPages(0x2);},0x64);}catch(_0x542a96){console['error'](_0x372b33(0x255),_0x542a96),diaryRenderData=null,diaryPageCache[_0x372b33(0x20d)](),showIslandNotification('错误',_0x372b33(0x215),_0x372b33(0x4fd));}}function diaryFlip(_0x4a645d){const _0xd0a6e4=_0x2a6210,_0x34d79e=document[_0xd0a6e4(0x854)](_0xd0a6e4(0x6ae));if(_0x4a645d>0x0&&diaryCurrentPage<diaryTotalPages-0x1)_0x34d79e[diaryCurrentPage]['classList'][_0xd0a6e4(0x2a8)](_0xd0a6e4(0x840)),diaryCurrentPage++,lazyLoadNearbyPages(diaryCurrentPage);else _0x4a645d<0x0&&diaryCurrentPage>0x0&&(diaryCurrentPage--,_0x34d79e[diaryCurrentPage]['classList'][_0xd0a6e4(0x5e8)](_0xd0a6e4(0x840)),lazyLoadNearbyPages(diaryCurrentPage));updateDiaryZ();}function updateDiaryZ(){const _0x2bd455=_0x2a6210,_0x2ca896=document[_0x2bd455(0x854)](_0x2bd455(0x6ae));_0x2ca896['forEach']((_0x53279d,_0x571c34)=>{const _0x343c46=_0x2bd455;_0x53279d[_0x343c46(0x37e)]['zIndex']=_0x571c34<diaryCurrentPage?_0x571c34:diaryTotalPages-_0x571c34+diaryCurrentPage;});}function diaryGoToPage(_0x3cc215){const _0x149e43=_0x2a6210,_0x598f84=document[_0x149e43(0x854)](_0x149e43(0x6ae));for(let _0x1443b4=0x0;_0x1443b4<_0x3cc215&&_0x1443b4<diaryTotalPages;_0x1443b4++){_0x598f84[_0x1443b4][_0x149e43(0x2af)][_0x149e43(0x2a8)](_0x149e43(0x840));}for(let _0x46b105=_0x3cc215;_0x46b105<diaryTotalPages;_0x46b105++){_0x598f84[_0x46b105][_0x149e43(0x2af)][_0x149e43(0x5e8)](_0x149e43(0x840));}diaryCurrentPage=_0x3cc215,updateDiaryZ(),lazyLoadNearbyPages(_0x3cc215);}async function deleteDiaryNote(_0x276de7,_0xa27e8){const _0x47e100=_0x2a6210;try{_0xa27e8&&(_0xa27e8['stopPropagation'](),_0xa27e8['preventDefault']());console[_0x47e100(0x40b)]('🗑️\x20准备删除笔记,\x20ID:',_0x276de7),await db[_0x47e100(0x518)][_0x47e100(0xfc)](_0x276de7),console[_0x47e100(0x40b)](_0x47e100(0x604));const _0x56557a=document['querySelector']('.diary-sticky[data-note-id=\x22'+_0x276de7+'\x22]');_0x56557a&&(_0x56557a[_0x47e100(0x37e)]['transition']='transform\x200.3s\x20ease,\x20opacity\x200.3s\x20ease',_0x56557a[_0x47e100(0x37e)]['transform']=_0x47e100(0x598),_0x56557a[_0x47e100(0x37e)][_0x47e100(0x48d)]='0',setTimeout(()=>{const _0x3bf127=_0x47e100;_0x56557a[_0x3bf127(0x5e8)](),console[_0x3bf127(0x40b)](_0x3bf127(0x1ec));},0x12c)),typeof showDynamicIsland===_0x47e100(0x88)&&showDynamicIsland('success',_0x47e100(0xb2),_0x47e100(0xa2));}catch(_0x322e28){console['error'](_0x47e100(0x293),_0x322e28),typeof showDynamicIsland===_0x47e100(0x88)&&showDynamicIsland(_0x47e100(0x5d9),_0x47e100(0x453),_0x47e100(0x7dc));}}const DTMFTones={'1':{'low':0x2b9,'high':0x4b9},'2':{'low':0x2b9,'high':0x538},'3':{'low':0x2b9,'high':0x5c5},'4':{'low':0x302,'high':0x4b9},'5':{'low':0x302,'high':0x538},'6':{'low':0x302,'high':0x5c5},'7':{'low':0x354,'high':0x4b9},'8':{'low':0x354,'high':0x538},'9':{'low':0x354,'high':0x5c5},'*':{'low':0x3ad,'high':0x4b9},'0':{'low':0x3ad,'high':0x538},'#':{'low':0x3ad,'high':0x5c5}};let audioContext=null,isAudioEnabled=!![];function initAudioContext(){const _0x30183f=_0x2a6210;if(!audioContext)try{audioContext=new(window[(_0x30183f(0x429))]||window[(_0x30183f(0x246))])();}catch(_0x4fed0a){console[_0x30183f(0x3bc)](_0x30183f(0x5c1)),isAudioEnabled=![];}return audioContext;}function playDTMFTone(_0x863a40,_0x342bb9=0x78){const _0x45199c=_0x2a6210;if(!isAudioEnabled)return;const _0x4e2f8c=DTMFTones[_0x863a40];if(!_0x4e2f8c)return;const _0x3c4fa0=initAudioContext();if(!_0x3c4fa0)return;try{const _0x34dad7=_0x3c4fa0[_0x45199c(0x7ad)](),_0x53f231=_0x3c4fa0[_0x45199c(0x7ad)](),_0xb91e29=_0x3c4fa0[_0x45199c(0x62c)]();_0x34dad7[_0x45199c(0x456)][_0x45199c(0x4cf)]=_0x4e2f8c[_0x45199c(0x5a4)],_0x53f231[_0x45199c(0x456)][_0x45199c(0x4cf)]=_0x4e2f8c[_0x45199c(0x7bb)],_0x34dad7[_0x45199c(0x1e9)]='sine',_0x53f231['type']=_0x45199c(0x308),_0x34dad7['connect'](_0xb91e29),_0x53f231[_0x45199c(0x421)](_0xb91e29),_0xb91e29['connect'](_0x3c4fa0[_0x45199c(0x4da)]);const _0x2aa44c=_0x3c4fa0[_0x45199c(0x3d4)];_0xb91e29[_0x45199c(0x593)][_0x45199c(0x134)](0x0,_0x2aa44c),_0xb91e29['gain']['linearRampToValueAtTime'](0.12,_0x2aa44c+0.01),_0xb91e29[_0x45199c(0x593)][_0x45199c(0x410)](0.12,_0x2aa44c+_0x342bb9/0x3e8-0.02),_0xb91e29[_0x45199c(0x593)][_0x45199c(0x410)](0x0,_0x2aa44c+_0x342bb9/0x3e8),_0x34dad7[_0x45199c(0x79f)](_0x2aa44c),_0x53f231['start'](_0x2aa44c),_0x34dad7[_0x45199c(0x5bc)](_0x2aa44c+_0x342bb9/0x3e8),_0x53f231['stop'](_0x2aa44c+_0x342bb9/0x3e8);}catch(_0x8355f0){console[_0x45199c(0x3bc)]('⚠️\x20DTMF音效播放失败:',_0x8355f0);}}function togglePhoneSound(){const _0x18f4f8=_0x2a6210;isAudioEnabled=!isAudioEnabled,showIslandNotification(isAudioEnabled?'音效已开启':'音效已关闭','Phone',_0x18f4f8(0x106));}let phoneCurrentNumber='';function pressPhoneKey(_0x49f80d){const _0xbb00af=_0x2a6210;if(phoneCurrentNumber['length']>=0xf)return;playDTMFTone(_0x49f80d);const _0x24cbdd=event?.[_0xbb00af(0x66d)]?.['closest'](_0xbb00af(0x22f));_0x24cbdd&&(_0x24cbdd[_0xbb00af(0x2af)][_0xbb00af(0x2a8)](_0xbb00af(0x335)),setTimeout(()=>_0x24cbdd[_0xbb00af(0x2af)][_0xbb00af(0x5e8)](_0xbb00af(0x335)),0x96)),phoneCurrentNumber+=_0x49f80d,updatePhoneDisplay(),vibrateDevice();}function updatePhoneDisplay(){const _0x183fd1=_0x2a6210,_0x578d3c=document[_0x183fd1(0x550)](_0x183fd1(0x9b)),_0x520cda=document[_0x183fd1(0x550)](_0x183fd1(0x1e6));if(!_0x578d3c)return;if(phoneCurrentNumber){_0x578d3c['textContent']=formatPhoneNumber(phoneCurrentNumber),_0x578d3c[_0x183fd1(0x2af)][_0x183fd1(0x5e8)](_0x183fd1(0x488)),_0x578d3c[_0x183fd1(0x2af)][_0x183fd1(0x2a8)](_0x183fd1(0x847)),setTimeout(()=>_0x578d3c[_0x183fd1(0x2af)][_0x183fd1(0x5e8)](_0x183fd1(0x847)),0x78);if(_0x520cda)_0x520cda[_0x183fd1(0x2af)][_0x183fd1(0x2a8)](_0x183fd1(0x7cc));}else{_0x578d3c[_0x183fd1(0x2a1)]=_0x183fd1(0x4de),_0x578d3c[_0x183fd1(0x2af)][_0x183fd1(0x2a8)](_0x183fd1(0x488));if(_0x520cda)_0x520cda['classList']['remove'](_0x183fd1(0x7cc));}}function setupPhoneDisplayCopy(){const _0x5d7fbf=_0x2a6210,_0x26fa03=document[_0x5d7fbf(0x550)](_0x5d7fbf(0x9b)),_0x266306=document['getElementById'](_0x5d7fbf(0x1e6));_0x26fa03&&(_0x26fa03[_0x5d7fbf(0x2f7)](_0x5d7fbf(0x810),()=>{const _0x4f3d03=_0x5d7fbf;phoneCurrentNumber&&(navigator[_0x4f3d03(0x408)]?.['writeText'](phoneCurrentNumber),_0x266306&&(_0x266306[_0x4f3d03(0x2a1)]='copied!',setTimeout(()=>_0x266306[_0x4f3d03(0x2a1)]='tap\x20to\x20copy',0x5dc)),showDynamicIsland('Copied!',phoneCurrentNumber));}),_0x26fa03[_0x5d7fbf(0x37e)][_0x5d7fbf(0x125)]=_0x5d7fbf(0x454));}setTimeout(()=>{const _0x2d05df=_0x2a6210;!window[_0x2d05df(0x700)]&&(setupPhoneDisplayCopy(),window[_0x2d05df(0x700)]=!![]);},0x64);function formatPhoneNumber(_0x36e31b){const _0x3c7e30=_0x2a6210;if(_0x36e31b['length']<=0x3)return _0x36e31b;if(_0x36e31b[_0x3c7e30(0x73a)]<=0x7)return _0x36e31b[_0x3c7e30(0x4c1)](0x0,0x3)+'\x20'+_0x36e31b[_0x3c7e30(0x4c1)](0x3);return _0x36e31b[_0x3c7e30(0x4c1)](0x0,0x3)+'\x20'+_0x36e31b[_0x3c7e30(0x4c1)](0x3,0x7)+'\x20'+_0x36e31b['slice'](0x7);}function phoneBackspace(){const _0x4b0394=_0x2a6210;phoneCurrentNumber=phoneCurrentNumber[_0x4b0394(0x4c1)](0x0,-0x1),updatePhoneDisplay();}function clearPhoneNumber(){phoneCurrentNumber='',updatePhoneDisplay();}function copyPhoneNumber(){const _0x59f575=_0x2a6210;phoneCurrentNumber&&navigator[_0x59f575(0x408)][_0x59f575(0x4f0)](phoneCurrentNumber)[_0x59f575(0x56b)](()=>{const _0x59829e=_0x59f575,_0x2a1c44=event[_0x59829e(0x66d)]['closest'](_0x59829e(0x6e0));if(_0x2a1c44){_0x2a1c44[_0x59829e(0x37e)]['background']=_0x59829e(0x5fa);const _0x3d6635=_0x2a1c44[_0x59829e(0x2ba)](_0x59829e(0x235));if(_0x3d6635)_0x3d6635['style'][_0x59829e(0x8e)]=_0x59829e(0x6b7);setTimeout(()=>{const _0x4aa854=_0x59829e;_0x2a1c44[_0x4aa854(0x37e)]['background']='';if(_0x3d6635)_0x3d6635[_0x4aa854(0x37e)]['stroke']='';},0x12c);}showDynamicIsland(_0x59829e(0xfb),phoneCurrentNumber);});}async function makePhoneCall(){const _0x1ffbe3=_0x2a6210;if(phoneCurrentNumber){console['log']('📞\x20准备拨号:',phoneCurrentNumber),await showPhoneProfileSelector(phoneCurrentNumber);const _0x4fb97a=event?.[_0x1ffbe3(0x66d)]?.[_0x1ffbe3(0x174)](_0x1ffbe3(0x378));_0x4fb97a&&(_0x4fb97a[_0x1ffbe3(0x37e)][_0x1ffbe3(0x61d)]=_0x1ffbe3(0x5c4),setTimeout(()=>_0x4fb97a[_0x1ffbe3(0x37e)][_0x1ffbe3(0x61d)]='',0x96));}}async function showPhoneProfileSelector(_0x34078c){const _0x5a58a1=_0x2a6210,_0x3ccb1c=document[_0x5a58a1(0x550)]('phoneProfileSelectorOverlay'),_0x133dd3=document[_0x5a58a1(0x550)](_0x5a58a1(0x52c));if(!_0x3ccb1c||!_0x133dd3)return;const _0x536e56=await db['userProfiles'][_0x5a58a1(0x651)]();console[_0x5a58a1(0x40b)](_0x5a58a1(0x192),_0x536e56['length'],'个'),_0x133dd3[_0x5a58a1(0x63f)]='',_0x536e56['length']===0x0?_0x133dd3[_0x5a58a1(0x63f)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-profile-empty\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-profile-empty-icon\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M20\x2021v-2a4\x204\x200\x2000-4-4H8a4\x204\x200\x2000-4\x204v2\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<circle\x20cx=\x2212\x22\x20cy=\x227\x22\x20r=\x224\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-profile-empty-text\x22>No\x20user\x20profiles\x20found</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20':_0x536e56[_0x5a58a1(0x84c)](_0x122a5a=>{const _0xec140a=_0x5a58a1,_0x1a0ded=(_0x122a5a[_0xec140a(0x189)]||_0x122a5a[_0xec140a(0x77d)]||'U')[_0xec140a(0x7b6)](0x0)[_0xec140a(0x2db)](),_0x2644ca=_0x122a5a[_0xec140a(0x189)]||_0x122a5a[_0xec140a(0x77d)]||'User',_0x481f66=_0x122a5a[_0xec140a(0x104)]||'',_0x65aa37=_0x122a5a[_0xec140a(0x830)]||_0x122a5a[_0xec140a(0x642)]||'',_0x310a0d=document['createElement'](_0xec140a(0x5ab));_0x310a0d[_0xec140a(0x337)]='phone-profile-item',_0x310a0d[_0xec140a(0x7a1)]=()=>selectPhoneProfile(_0x122a5a['id'],_0x34078c);const _0x7aeb5b=_0x65aa37?_0xec140a(0x23a)+_0x65aa37+_0xec140a(0x4ac)+_0x2644ca+'\x22>':_0x1a0ded;_0x310a0d[_0xec140a(0x63f)]=_0xec140a(0x54d)+_0x7aeb5b+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-profile-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22phone-profile-name\x22>'+_0x2644ca+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x481f66?_0xec140a(0x1d1)+_0x481f66+_0xec140a(0x670):_0xec140a(0x55f))+_0xec140a(0x849),_0x133dd3[_0xec140a(0x744)](_0x310a0d);}),_0x3ccb1c[_0x5a58a1(0x2af)][_0x5a58a1(0x2a8)](_0x5a58a1(0x763));}function closePhoneProfileSelector(){const _0x130921=_0x2a6210,_0xce5800=document[_0x130921(0x550)](_0x130921(0x666));_0xce5800&&_0xce5800['classList'][_0x130921(0x5e8)](_0x130921(0x763));}async function selectPhoneProfile(_0x5dfec4,_0x4d43cf){const _0x23aac2=_0x2a6210;console['log'](_0x23aac2(0x749),_0x5dfec4);pendingCallTimeout&&(console['log'](_0x23aac2(0x5e4)),clearTimeout(pendingCallTimeout),pendingCallTimeout=null);const _0x275b44=_0x4d43cf[_0x23aac2(0x7a9)](/\s/g,'')['replace'](/-/g,'');console[_0x23aac2(0x40b)]('📞\x20清理后的号码:',_0x275b44,_0x23aac2(0x826),_0x275b44[_0x23aac2(0x73a)]);const _0x148ab6=await db[_0x23aac2(0xe7)]['where'](_0x23aac2(0x601))[_0x23aac2(0x630)](_0x275b44)[_0x23aac2(0x244)](),_0x5c5be5=!!_0x148ab6;if(!_0x5c5be5&&_0x275b44[_0x23aac2(0x73a)]!==0xb){console[_0x23aac2(0x40b)]('❌\x20号码长度不正确，且不在数据库中，无法拨通'),showIslandNotification(_0x23aac2(0x7a5),_0x23aac2(0x674),_0x23aac2(0x5d9)),closePhoneProfileSelector();return;}_0x5c5be5?console['log']('✅\x20号码在数据库中，允许拨打（位数:',_0x275b44['length'],'）'):console[_0x23aac2(0x40b)]('📞\x20随机陌生人号码，已验证11位');closePhoneProfileSelector(),window[_0x23aac2(0x797)]=_0x5dfec4,window[_0x23aac2(0x3bd)]='user';const _0x3ea8d1=await db[_0x23aac2(0x33c)][_0x23aac2(0x60f)](_0x275b44);if(_0x3ea8d1&&_0x3ea8d1[_0x23aac2(0x3d9)]&&_0x3ea8d1[_0x23aac2(0x4c8)]){console['log']('📱\x20发现通讯录陌生人联系人:',_0x3ea8d1['nickname']),console[_0x23aac2(0x40b)](_0x23aac2(0x6d8),_0x3ea8d1['strangerPersona']);if(typeof initCallWithContactPersona!==_0x23aac2(0x88)){console['error'](_0x23aac2(0x432)),showIslandNotification('错误','通话功能未就绪',_0x23aac2(0x5d9));return;}const _0x105481=await initCallWithContactPersona(_0x4d43cf,_0x3ea8d1[_0x23aac2(0x4c8)]);if(_0x105481){console[_0x23aac2(0x40b)](_0x23aac2(0x194),_0x105481[_0x23aac2(0x189)]),showCallScreen('calling',_0x4d43cf);if(typeof sendCallMessage===_0x23aac2(0x88)){console[_0x23aac2(0x40b)](_0x23aac2(0x6e9));const _0x343751=await sendCallMessage(_0x23aac2(0x2d3));_0x343751&&_0x343751['sentences']&&_0x343751[_0x23aac2(0x507)][_0x23aac2(0x73a)]>0x0&&(console[_0x23aac2(0x40b)]('🤖\x20陌生人接听，共',_0x343751['sentences']['length'],'句话'),callSpeeches=_0x343751[_0x23aac2(0x507)],callShouldHangup=_0x343751['shouldHangup']||![],currentCallSpeechIndex=0x0,_0x343751[_0x23aac2(0x507)][_0x23aac2(0x84c)](_0xbb066e=>{const _0x248343=_0x23aac2;callTranscript[_0x248343(0x2b9)]({'role':'ai','text':_0xbb066e,'timestamp':Date[_0x248343(0x344)]()});}),showCallScreen(_0x23aac2(0x418),_0x4d43cf));}}return;}console[_0x23aac2(0x40b)](_0x23aac2(0xd6),typeof initCallWithAI);if(typeof initCallWithAI!==_0x23aac2(0x88)){console['error'](_0x23aac2(0x650)),showIslandNotification('错误',_0x23aac2(0x3b1),_0x23aac2(0x5d9));return;}console[_0x23aac2(0x40b)](_0x23aac2(0x91));const _0xd2c53f=await initCallWithAI(_0x4d43cf);console[_0x23aac2(0x40b)](_0x23aac2(0x2e7),_0xd2c53f);if(_0xd2c53f){console[_0x23aac2(0x40b)]('✅\x20AI通话已连接:',_0xd2c53f[_0x23aac2(0x189)]);const _0x1c80eb=_0xd2c53f['id'],_0x1cdf46=_0x5dfec4||_0x23aac2(0x2a7),_0x1709ae=await checkIfInBusyPeriod(_0x1c80eb,_0x1cdf46,currentSessionId||_0x23aac2(0x2a7));if(_0x1709ae){console[_0x23aac2(0x40b)](_0x23aac2(0x6e5)+_0x1709ae[_0x23aac2(0x322)]);if(Math[_0x23aac2(0x658)]()<0.5){console[_0x23aac2(0x40b)]('📵\x20繁忙时段：角色未接听电话'),showCallScreen('calling',_0x4d43cf),setTimeout(()=>{const _0x49c02d=_0x23aac2;showIslandNotification(_0x49c02d(0x526),_0x49c02d(0x49b),_0x49c02d(0x5d9)),vibrateDevice(),setTimeout(()=>{const _0x5f52e1=_0x49c02d,_0x1c2fce=document['getElementById']('callScreen');_0x1c2fce&&(_0x1c2fce[_0x5f52e1(0x2af)][_0x5f52e1(0x2a8)](_0x5f52e1(0x28d)),setTimeout(()=>{const _0x3bdd49=_0x5f52e1;_0x1c2fce[_0x3bdd49(0x2af)][_0x3bdd49(0x5e8)]('active','closing');},0x12c));},0x7d0);},0x5dc);_0x1709ae[_0x23aac2(0x25a)]&&_0x1709ae[_0x23aac2(0x25a)][_0x23aac2(0x6b6)]&&setTimeout(async()=>{const _0x178199=_0x23aac2;try{const _0x960c1c=await loadSmsHistory(_0x4d43cf);_0x960c1c['push']({'role':_0x178199(0x1bd),'content':_0x178199(0x1a7)+_0x1709ae['autoReplies'][_0x178199(0x6b6)],'timestamp':Date[_0x178199(0x344)]()}),await saveSmsHistory(_0x4d43cf,_0x960c1c),showIslandNotification(_0xd2c53f[_0x178199(0x189)]||'角色',_0x178199(0x325),'info');}catch(_0xc6e011){console[_0x178199(0x5d9)](_0x178199(0x7fe),_0xc6e011);}},0xbb8);return;}else console['log']('📞\x20繁忙时段：角色接听了电话（态度可能不同）'),window['currentCallBusyPeriod']=_0x1709ae;}else window[_0x23aac2(0x56d)]=null;console[_0x23aac2(0x40b)](_0x23aac2(0x438)),showCallScreen('calling',_0x4d43cf),console[_0x23aac2(0x40b)]('🔍\x20[DEBUG]\x20检查sendCallMessage函数:',typeof sendCallMessage);if(typeof sendCallMessage===_0x23aac2(0x88)){console[_0x23aac2(0x40b)](_0x23aac2(0x6be));const _0x532caa=await sendCallMessage(_0x23aac2(0x2d3));console['log'](_0x23aac2(0x1ef),_0x532caa),_0x532caa&&_0x532caa[_0x23aac2(0x507)]&&_0x532caa[_0x23aac2(0x507)][_0x23aac2(0x73a)]>0x0?(console[_0x23aac2(0x40b)]('🤖\x20AI接听，共',_0x532caa[_0x23aac2(0x507)][_0x23aac2(0x73a)],'句话'),callSpeeches=_0x532caa[_0x23aac2(0x507)],callShouldHangup=_0x532caa['shouldHangup']||![],currentCallSpeechIndex=0x0,_0x532caa[_0x23aac2(0x507)][_0x23aac2(0x84c)](_0x1a7133=>{const _0x1e4f0b=_0x23aac2;callTranscript['push']({'role':'ai','text':_0x1a7133,'timestamp':Date[_0x1e4f0b(0x344)]()});}),console[_0x23aac2(0x40b)](_0x23aac2(0x3fd),_0x532caa[_0x23aac2(0x507)]),showCallScreen(_0x23aac2(0x418),_0x4d43cf),showCallSpeech()):console[_0x23aac2(0x5d9)](_0x23aac2(0x6e7));}else console[_0x23aac2(0x5d9)](_0x23aac2(0x4cc));}else console[_0x23aac2(0x40b)]('⚠️\x20未找到号码对应的角色，进入随机状态检测'),showCallScreen('calling',_0x4d43cf),pendingCallTimeout=setTimeout(async()=>{const _0xe0d2cf=_0x23aac2;pendingCallTimeout=null;const _0x571b67=Math['random']();if(_0x571b67<0.33)console[_0xe0d2cf(0x40b)](_0xe0d2cf(0x2f0)),showIslandNotification('空号','您拨打的号码是空号，请核对后再拨',_0xe0d2cf(0x5d9)),vibrateDevice(),setTimeout(()=>{const _0x226cf3=_0xe0d2cf;console[_0x226cf3(0x40b)](_0x226cf3(0x746));const _0x3a7303=document[_0x226cf3(0x550)]('phoneCallScreen');_0x3a7303&&(_0x3a7303['classList'][_0x226cf3(0x2a8)](_0x226cf3(0x28d)),setTimeout(()=>{const _0x7e1ef4=_0x226cf3;_0x3a7303['classList'][_0x7e1ef4(0x5e8)]('closing'),console['log']('📱\x20自动关闭通话界面'),hideCallScreen();},0x12c));},0x7d0);else{if(_0x571b67<0.66)console['log'](_0xe0d2cf(0x7c8)),showIslandNotification(_0xe0d2cf(0x305),_0xe0d2cf(0x80a),'error'),vibrateDevice(),setTimeout(()=>{const _0x90cbc2=_0xe0d2cf;console['log']('📱\x20播放关闭动画');const _0x5f149b=document[_0x90cbc2(0x550)](_0x90cbc2(0x3da));_0x5f149b&&(_0x5f149b[_0x90cbc2(0x2af)]['add']('closing'),setTimeout(()=>{const _0x121491=_0x90cbc2;_0x5f149b[_0x121491(0x2af)]['remove'](_0x121491(0x28d)),console[_0x121491(0x40b)]('📱\x20自动关闭通话界面'),hideCallScreen();},0x12c));},0x7d0);else{console[_0xe0d2cf(0x40b)](_0xe0d2cf(0x61c));if(typeof initRandomStrangerCall!==_0xe0d2cf(0x88)){console[_0xe0d2cf(0x5d9)](_0xe0d2cf(0x56a)),showIslandNotification('错误',_0xe0d2cf(0x3b1),_0xe0d2cf(0x5d9)),setTimeout(()=>hideCallScreen(),0x3e8);return;}const _0x2de755=await initRandomStrangerCall(_0x4d43cf);if(_0x2de755){console['log'](_0xe0d2cf(0x4a0),_0x2de755[_0xe0d2cf(0x189)]);if(typeof sendCallMessage===_0xe0d2cf(0x88)){console['log']('📞\x20拨通电话，等待陌生人接听...');const _0x499cd9=await sendCallMessage(_0xe0d2cf(0x2d3));console['log']('🔍\x20[DEBUG]\x20sendCallMessage返回:',_0x499cd9),_0x499cd9&&_0x499cd9[_0xe0d2cf(0x507)]&&_0x499cd9[_0xe0d2cf(0x507)][_0xe0d2cf(0x73a)]>0x0?(console[_0xe0d2cf(0x40b)](_0xe0d2cf(0x577),_0x499cd9[_0xe0d2cf(0x507)][_0xe0d2cf(0x73a)],'句话'),callSpeeches=_0x499cd9['sentences'],callShouldHangup=_0x499cd9[_0xe0d2cf(0x84d)]||![],currentCallSpeechIndex=0x0,_0x499cd9[_0xe0d2cf(0x507)][_0xe0d2cf(0x84c)](_0x180c3e=>{const _0x2f1198=_0xe0d2cf;callTranscript[_0x2f1198(0x2b9)]({'role':'ai','text':_0x180c3e,'timestamp':Date[_0x2f1198(0x344)]()});}),console[_0xe0d2cf(0x40b)](_0xe0d2cf(0x37b),_0x499cd9[_0xe0d2cf(0x507)]),showCallScreen(_0xe0d2cf(0x418),_0x4d43cf),showCallSpeech()):(console[_0xe0d2cf(0x5d9)]('❌\x20[DEBUG]\x20AI没有返回有效回复'),showIslandNotification('错误',_0xe0d2cf(0xcf),'error'),setTimeout(()=>hideCallScreen(),0x5dc));}else console[_0xe0d2cf(0x5d9)](_0xe0d2cf(0x4cc)),showIslandNotification('错误','通话功能异常','error'),setTimeout(()=>hideCallScreen(),0x5dc);}else console[_0xe0d2cf(0x5d9)](_0xe0d2cf(0x75d)),showIslandNotification('错误','通话连接失败',_0xe0d2cf(0x5d9)),setTimeout(()=>hideCallScreen(),0x5dc);}}},0x5dc);}function addPhoneContact(){const _0x2badba=_0x2a6210;phoneCurrentNumber&&(console[_0x2badba(0x40b)](_0x2badba(0x2a4),phoneCurrentNumber),showDynamicIsland(_0x2badba(0x263),formatPhoneNumber(phoneCurrentNumber)));}function switchPhoneTab(_0x208b86){const _0x6e4172=_0x2a6210;document[_0x6e4172(0x854)]('.phone-nav-item')[_0x6e4172(0x84c)](_0x38ea4b=>_0x38ea4b[_0x6e4172(0x2af)][_0x6e4172(0x5e8)](_0x6e4172(0x763)));if(event&&event[_0x6e4172(0x66d)]){const _0xacb41c=event[_0x6e4172(0x66d)][_0x6e4172(0x174)]('.phone-nav-item');if(_0xacb41c)_0xacb41c['classList'][_0x6e4172(0x2a8)](_0x6e4172(0x763));}const _0x1a3e33=document[_0x6e4172(0x2ba)](_0x6e4172(0x2bb)),_0x27437a=document['querySelector']('.phone-recent-content'),_0x1ea721=document['querySelector'](_0x6e4172(0x5ed));if(!_0x1a3e33||!_0x27437a){console['warn']('📱\x20Phone\x20content\x20containers\x20not\x20found');return;}_0x1a3e33[_0x6e4172(0x37e)]['display']=_0x6e4172(0x22e),_0x27437a[_0x6e4172(0x37e)][_0x6e4172(0x712)]=_0x6e4172(0x22e);if(_0x1ea721)_0x1ea721[_0x6e4172(0x37e)]['display']=_0x6e4172(0x22e);switch(_0x208b86){case _0x6e4172(0x1b0):_0x27437a[_0x6e4172(0x37e)][_0x6e4172(0x712)]=_0x6e4172(0x8b),loadRecentPageUserProfile(),loadCallRecords(),triggerRecentPageAnimation(_0x27437a),console['log'](_0x6e4172(0x508));break;case'contacts':_0x1ea721&&(_0x1ea721[_0x6e4172(0x37e)][_0x6e4172(0x712)]='flex',renderContactsList(),loadContactsMyCard(),initContactsAlphabetIndex(),triggerContactsPageAnimation(_0x1ea721),console[_0x6e4172(0x40b)](_0x6e4172(0x58c)));break;case _0x6e4172(0x407):default:_0x1a3e33['style'][_0x6e4172(0x712)]=_0x6e4172(0x8b),_0x27437a[_0x6e4172(0x2af)]['remove']('animating'),console[_0x6e4172(0x40b)](_0x6e4172(0x7f1));break;}}async function loadRecentPageUserProfile(){const _0x4e1743=_0x2a6210;try{const _0x4767f2=await db['globalSettings'][_0x4e1743(0x60f)](_0x4e1743(0x40f));if(!_0x4767f2){console[_0x4e1743(0x3bc)](_0x4e1743(0x545));return;}const _0x3faa95=await db[_0x4e1743(0x72b)][_0x4e1743(0x60f)](_0x4767f2[_0x4e1743(0x4cf)]);if(!_0x3faa95){console[_0x4e1743(0x3bc)](_0x4e1743(0x29f),_0x4767f2[_0x4e1743(0x4cf)]);return;}const _0x1db9b6=_0x4e1743(0x277),_0x3dd55d=document['getElementById'](_0x4e1743(0xb4)),_0x24e4f6=document[_0x4e1743(0x550)](_0x4e1743(0x41a)),_0x3dc9f5=document['getElementById']('recentPromoBio');_0x3dd55d&&(_0x3dd55d[_0x4e1743(0x655)]=_0x3faa95[_0x4e1743(0x830)]||_0x1db9b6),_0x24e4f6&&(_0x24e4f6[_0x4e1743(0x2a1)]=_0x3faa95['username']||_0x3faa95[_0x4e1743(0x189)]||_0x4e1743(0x6b5)),_0x3dc9f5&&(_0x3dc9f5[_0x4e1743(0x2a1)]=_0x3faa95[_0x4e1743(0x7b2)]||_0x4e1743(0x2fd)),console['log'](_0x4e1743(0x6b8),_0x3faa95[_0x4e1743(0x77d)]||_0x3faa95[_0x4e1743(0x189)]);}catch(_0x22d7ca){console['error'](_0x4e1743(0x7b0),_0x22d7ca);}}function triggerRecentPageAnimation(_0x2f51cc){const _0x5d1f8e=_0x2a6210;_0x2f51cc[_0x5d1f8e(0x2af)]['remove'](_0x5d1f8e(0x537)),void _0x2f51cc[_0x5d1f8e(0x6e3)],_0x2f51cc[_0x5d1f8e(0x2af)]['add'](_0x5d1f8e(0x537));}function triggerContactsPageAnimation(_0x1b625b){const _0x223c38=_0x2a6210;_0x1b625b[_0x223c38(0x2af)][_0x223c38(0x5e8)]('animating'),void _0x1b625b[_0x223c38(0x6e3)],_0x1b625b[_0x223c38(0x2af)][_0x223c38(0x2a8)](_0x223c38(0x537));}function filterRecentCalls(_0x268db9){const _0x2578ed=_0x2a6210,_0x33b634=document[_0x2578ed(0x854)](_0x2578ed(0x46d));_0x33b634[_0x2578ed(0x84c)](_0x530b76=>_0x530b76['classList'][_0x2578ed(0x5e8)]('active')),event[_0x2578ed(0x66d)]['classList'][_0x2578ed(0x2a8)](_0x2578ed(0x763)),currentCallFilter=_0x268db9,console['log'](_0x2578ed(0x556),_0x268db9),renderCallRecords();}function searchRecentCalls(){const _0x1d78a3=_0x2a6210,_0x13c9ee=document[_0x1d78a3(0x2ba)](_0x1d78a3(0x43a)),_0x3719a4=_0x13c9ee?_0x13c9ee['value']['trim']()[_0x1d78a3(0x5bd)]():'';currentSearchQuery=_0x3719a4,console[_0x1d78a3(0x40b)](_0x1d78a3(0x65f),_0x3719a4),renderCallRecords();}function openPhoneContacts(){const _0x1be8a6=_0x2a6210;console['log'](_0x1be8a6(0x136)),switchPhoneTab(_0x1be8a6(0x33c));}let contactsListCache=[];async function renderContactsList(){const _0xd3e2f7=_0x2a6210,_0x3a3049=document[_0xd3e2f7(0x550)](_0xd3e2f7(0x365));if(!_0x3a3049)return;try{const _0xfd921d=await db['contacts'][_0xd3e2f7(0x651)]();console[_0xd3e2f7(0x40b)](_0xd3e2f7(0x54b),_0xfd921d[_0xd3e2f7(0x73a)],_0xd3e2f7(0x33c));const _0x48a83a=_0xfd921d[_0xd3e2f7(0x34c)](_0x4ec09b=>{const _0x501a9c=_0xd3e2f7;if(!_0x4ec09b)return![];if(_0x4ec09b[_0x501a9c(0x848)])return!![];if(_0x4ec09b[_0x501a9c(0x18b)])return!![];if(typeof _0x4ec09b[_0x501a9c(0x208)]===_0x501a9c(0x601))return!![];if(_0x4ec09b[_0x501a9c(0x619)])return![];if(_0x4ec09b['isRandomSmsContact'])return![];if(_0x4ec09b['randomSmsType'])return![];if(_0x4ec09b[_0x501a9c(0x3d9)])return![];return!![];}),_0x5e517e=_0xfd921d['length']-_0x48a83a[_0xd3e2f7(0x73a)];_0x5e517e>0x0&&console['log'](_0xd3e2f7(0x128),_0x5e517e),contactsListCache=_0x48a83a,renderContactsListFromData(_0x48a83a);}catch(_0x3f556c){console[_0xd3e2f7(0x5d9)](_0xd3e2f7(0x391),_0x3f556c),_0x3a3049['innerHTML']=_0xd3e2f7(0x6e6);}}function renderContactsListFromData(_0x24c8ed){const _0x265fd2=_0x2a6210,_0x21aa93=document['getElementById']('contactsList');if(!_0x21aa93)return;if(_0x24c8ed[_0x265fd2(0x73a)]===0x0){_0x21aa93[_0x265fd2(0x63f)]=_0x265fd2(0x1bf);return;}const _0x13ca4d=_0x24c8ed[_0x265fd2(0x2f9)]((_0x839de2,_0x1abf57)=>{const _0x105cf0=_0x265fd2,_0x1b39eb=_0x839de2['nickname']||_0x839de2[_0x105cf0(0x189)]||'',_0x2b914d=_0x1abf57[_0x105cf0(0x561)]||_0x1abf57[_0x105cf0(0x189)]||'';return _0x1b39eb[_0x105cf0(0x814)](_0x2b914d,_0x105cf0(0xcd));}),_0x49aa64={};_0x13ca4d[_0x265fd2(0x84c)](_0x1ad233=>{const _0xe7b6ad=_0x265fd2,_0x472009=_0x1ad233[_0xe7b6ad(0x561)]||_0x1ad233['name']||'?',_0x1db91d=_0x472009[_0xe7b6ad(0x7b6)](0x0)[_0xe7b6ad(0x2db)](),_0x3a49db=getPinyinInitial(_0x1db91d)||'#';!_0x49aa64[_0x3a49db]&&(_0x49aa64[_0x3a49db]=[]),_0x49aa64[_0x3a49db]['push'](_0x1ad233);});const _0x46d1aa=Object[_0x265fd2(0x186)](_0x49aa64)[_0x265fd2(0x2f9)]((_0x32e03f,_0x54fb45)=>{const _0x240ecf=_0x265fd2;if(_0x32e03f==='#')return 0x1;if(_0x54fb45==='#')return-0x1;return _0x32e03f[_0x240ecf(0x814)](_0x54fb45);});let _0x4883f1='';_0x46d1aa['forEach'](_0x2982ab=>{const _0x528c80=_0x265fd2;_0x4883f1+=_0x528c80(0x43d)+_0x2982ab+'\x22>',_0x4883f1+='<div\x20class=\x22contacts-group-letter\x22>'+_0x2982ab+_0x528c80(0x670),_0x49aa64[_0x2982ab][_0x528c80(0x84c)](_0x1bcc3e=>{const _0x201cd8=_0x528c80,_0x487811=_0x1bcc3e['nickname']||_0x1bcc3e[_0x201cd8(0x189)]||'未知',_0x116ece=_0x1bcc3e[_0x201cd8(0x104)]||'',_0x19b0a6=_0x1bcc3e[_0x201cd8(0x4af)]||_0x1bcc3e[_0x201cd8(0x830)]||'',_0x4a20ec=_0x487811[_0x201cd8(0x7b6)](0x0),_0x198546=formatPhoneNumberDisplay(_0x116ece);_0x4883f1+=_0x201cd8(0x4b4)+_0x116ece+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contacts-item-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x19b0a6?'<img\x20src=\x22'+_0x19b0a6+'\x22\x20alt=\x22'+_0x487811+'\x22>':_0x4a20ec)+_0x201cd8(0xb6)+_0x487811+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contacts-item-phone\x22>'+_0x198546+_0x201cd8(0x819);}),_0x4883f1+=_0x528c80(0x670);}),_0x21aa93[_0x265fd2(0x63f)]=_0x4883f1;}function getPinyinInitial(_0x24edac){const _0x2e9a4f=_0x2a6210,_0x2bf643={'阿艾安':'A','巴白百班包宝北贝本必边标表别兵波伯博不步部':'B','才财彩菜蔡参曹草策层曾茶察产昌常超朝潮陈成承程城池迟赤崇初除楚川传船窗床创春纯词此次从村存':'C','达答大代带单但当党刀导到道得德的灯等邓低底地弟第典点电店丁定冬东董动栋都斗读独度段对顿多':'D','俄而尔耳二':'E','发法凡饭方房防访放飞非肥费分丰风封冯佛否夫服福府父复付傅富':'F','改盖甘干刚高告哥歌格个各给根更工公功供宫恭共谷古骨股故顾固瓜挂怪关官观管馆光广归龟规鬼贵桂国果过':'G','海韩寒汉杭航豪好合何河和核贺黑很恨红宏洪后候厚胡湖虎互户护花华划化画话怀坏欢环换皇黄回汇会惠婚混活火或获':'H','机积基极及吉级即急几己纪计记济继加佳家假架嫁坚间简建健剑江将蒋奖讲交郊娇焦角叫教接节杰结解姐介界今金津进近京经井景警静镜九久酒就居局菊举句具俱据剧惧聚军均君':'J','开凯看康考科可克客肯空孔控口苦库快况块宽狂矿':'K','来兰蓝郎浪劳老乐雷蕾类冷李理力历利立丽例连联莲廉脸练良凉两亮谅料列烈林临零灵领另刘流六龙楼陆路露鲁录陆律绿论罗洛落吕旅律':'L','妈麻马吗买卖满慢忙毛茅么没美妹门们孟梦米秘密免面苗描秒妙民敏名明命摩磨模末默某母木目墓幕':'M','拿哪那乃男南难内能尼你年念娘鸟宁牛农弄怒女暖诺':'N','欧偶':'O','拍派潘盘判旁跑培朋鹏批皮片票品平评破普':'P','七妻其奇齐起气器千迁前钱强墙桥巧切且亲青清轻情晴请庆秋丘求球区曲取去全权泉群':'Q','然让饶热人仁认日容荣柔肉如入软瑞润若':'R','撒赛三散桑扫色森沙山杉善伤商上尚少绍社舍设申身深神沈生声胜圣师诗十时实使始士世市示事势视试室是适释收手首守受书舒叔殊术束树数帅双水顺说丝司私死四寺似松宋送搜苏俗素速宿孙损所锁索':'S','他她它台太态泰谈坦探汤唐堂糖逃桃讨特疼腾提题体天田甜条跳铁听廷亭停庭通同童统头投图土团推退托脱':'T','挖娃瓦外弯湾完玩晚万汪王网往忘望危威微为围唯维伟委尾卫未位味温文闻问翁我乌无吴五午伍武舞物误务':'W','西希息悉习席洗喜戏系细虾下夏先仙鲜显县现限线相香箱想向象项像消小晓笑效些谢心新信星行形性姓幸兴雄熊休修秀许叙续选学雪寻训迅':'X','压牙呀雅亚言颜严岩延沿研盐眼演燕央阳洋样摇药要耀爷也冶野业叶页一伊衣依医仪宜移以已艺亿忆义益意易亦异谊译因音阴银印应英樱营影迎赢硬用优由油游友有又右幼于与予雨语玉育郁元园原员圆袁源远院愿月越云允运':'Y','杂灾再在咱赞脏藏早造则泽责怎增曾扎眨炸榨宅窄斋寨战站张章掌丈仗帐障招找召兆赵照者这折哲浙针珍真镇震争正整政证之支只知织职直值植执止指至志致制智中忠终钟众种周洲舟州诸珠株朱竹主住助注祝著筑专转装壮状追准桌着子姿资紫字自宗综总纵走租足族组祖阻最罪醉尊遵作坐座做':'Z'};if(/[A-Z]/['test'](_0x24edac))return _0x24edac;if(/[a-z]/[_0x2e9a4f(0x6f3)](_0x24edac))return _0x24edac[_0x2e9a4f(0x2db)]();for(const [_0x35f40c,_0x2d7fc6]of Object[_0x2e9a4f(0x6dd)](_0x2bf643)){if(_0x35f40c[_0x2e9a4f(0x3a6)](_0x24edac))return _0x2d7fc6;}return'#';}function formatPhoneNumberDisplay(_0x2582f1){const _0x12d77f=_0x2a6210;if(!_0x2582f1)return'';const _0x4dd4bb=_0x2582f1[_0x12d77f(0x7a9)](/\D/g,'');if(_0x4dd4bb['length']===0xb)return _0x4dd4bb[_0x12d77f(0x4c1)](0x0,0x3)+'\x20****\x20'+_0x4dd4bb[_0x12d77f(0x4c1)](0x7);return _0x2582f1;}async function loadContactsMyCard(){const _0xc8c874=_0x2a6210;try{const _0x8ac3bd=await db[_0xc8c874(0xdc)][_0xc8c874(0x60f)]('currentProfileId');if(!_0x8ac3bd)return;const _0x1eed40=await db[_0xc8c874(0x72b)]['get'](_0x8ac3bd[_0xc8c874(0x4cf)]);if(!_0x1eed40)return;const _0x155bf8=document[_0xc8c874(0x550)](_0xc8c874(0x39c)),_0x4500a6=document['getElementById'](_0xc8c874(0x193));_0x155bf8&&(_0x155bf8[_0xc8c874(0x2a1)]=_0x1eed40['name']||_0x1eed40['username']||'用户'),_0x4500a6&&_0x1eed40[_0xc8c874(0x830)]&&(_0x4500a6[_0xc8c874(0x63f)]=_0xc8c874(0x23a)+_0x1eed40[_0xc8c874(0x830)]+_0xc8c874(0x620)),console['log']('📱\x20[Contacts]\x20My\x20card\x20loaded');}catch(_0x329d7f){console[_0xc8c874(0x5d9)](_0xc8c874(0x7b1),_0x329d7f);}}function initContactsAlphabetIndex(){const _0xa22070=_0x2a6210,_0x5a2936=document[_0xa22070(0x854)]('.contacts-index-letter'),_0x11e634=document['getElementById']('contactsLetterIndicator');let _0x117307=![];_0x5a2936[_0xa22070(0x84c)](_0x5f05ea=>{const _0x8ff14=_0xa22070;_0x5f05ea[_0x8ff14(0x2f7)](_0x8ff14(0x810),()=>{const _0x415848=_0x8ff14;scrollToContactsLetter(_0x5f05ea[_0x415848(0x772)][_0x415848(0x3f6)]);}),_0x5f05ea[_0x8ff14(0x2f7)](_0x8ff14(0x5fb),_0x55410b=>{const _0x34b825=_0x8ff14;_0x55410b[_0x34b825(0xf0)](),_0x117307=!![],handleContactsIndexTouch(_0x55410b[_0x34b825(0x4df)][0x0],_0x5a2936,_0x11e634);});}),document[_0xa22070(0x2f7)](_0xa22070(0x11d),_0x3e8d69=>{const _0x41ad75=_0xa22070;_0x117307&&handleContactsIndexTouch(_0x3e8d69[_0x41ad75(0x4df)][0x0],_0x5a2936,_0x11e634);}),document[_0xa22070(0x2f7)](_0xa22070(0x5a2),()=>{_0x117307&&(_0x117307=![],hideContactsIndicator(_0x11e634,_0x5a2936));});}function handleContactsIndexTouch(_0x2b2b98,_0x4d1fbb,_0x31ae05){const _0x4c0dd8=_0x2a6210,_0x4d3249=document[_0x4c0dd8(0x638)](_0x2b2b98[_0x4c0dd8(0x1c6)],_0x2b2b98[_0x4c0dd8(0x375)]);if(_0x4d3249&&_0x4d3249[_0x4c0dd8(0x2af)][_0x4c0dd8(0x353)]('contacts-index-letter')){const _0x2ab2e5=_0x4d3249[_0x4c0dd8(0x772)][_0x4c0dd8(0x3f6)];showContactsIndicator(_0x2ab2e5,_0x31ae05),scrollToContactsLetter(_0x2ab2e5),_0x4d1fbb[_0x4c0dd8(0x84c)](_0x4a5d4a=>_0x4a5d4a['classList'][_0x4c0dd8(0x5e8)]('active')),_0x4d3249[_0x4c0dd8(0x2af)][_0x4c0dd8(0x2a8)](_0x4c0dd8(0x763));}}function scrollToContactsLetter(_0x234e0c){const _0x42b577=_0x2a6210,_0x863073=document[_0x42b577(0x550)](_0x42b577(0x6af)+_0x234e0c);_0x863073&&_0x863073[_0x42b577(0x2fb)]({'behavior':_0x42b577(0x62b),'block':_0x42b577(0x79f)});}function showContactsIndicator(_0x54ec90,_0x15fe17){const _0x4d8a6a=_0x2a6210;_0x15fe17&&(_0x15fe17['textContent']=_0x54ec90,_0x15fe17[_0x4d8a6a(0x2af)][_0x4d8a6a(0x2a8)](_0x4d8a6a(0x7cc)));}function hideContactsIndicator(_0x2eebf0,_0x1b08ba){const _0x180955=_0x2a6210;_0x2eebf0&&_0x2eebf0[_0x180955(0x2af)]['remove'](_0x180955(0x7cc)),_0x1b08ba[_0x180955(0x84c)](_0x4b173d=>_0x4b173d[_0x180955(0x2af)][_0x180955(0x5e8)](_0x180955(0x763)));}function filterContacts(_0x3d82c4){const _0x15600a=_0x2a6210,_0x28ac1d=_0x3d82c4[_0x15600a(0x5bd)]()[_0x15600a(0x14c)]();if(!_0x28ac1d){renderContactsListFromData(contactsListCache);return;}const _0x2961ee=contactsListCache['filter'](_0x5d1e3c=>{const _0x4d3508=_0x15600a,_0x4d1530=(_0x5d1e3c[_0x4d3508(0x561)]||_0x5d1e3c[_0x4d3508(0x189)]||'')[_0x4d3508(0x5bd)](),_0x1d5091=(_0x5d1e3c[_0x4d3508(0x104)]||'')[_0x4d3508(0x7a9)](/\D/g,'');return _0x4d1530['includes'](_0x28ac1d)||_0x1d5091[_0x4d3508(0x3a6)](_0x28ac1d);});renderContactsListFromData(_0x2961ee);}function openContactDetail(_0x3c4803){const _0x47a27f=_0x2a6210;console[_0x47a27f(0x40b)]('📱\x20[Contacts]\x20Opening\x20contact\x20detail:',_0x3c4803),showContactDetail(_0x3c4803);}function showMyCardDetail(){const _0x476efa=_0x2a6210;console['log']('📱\x20[Contacts]\x20Opening\x20my\x20card\x20detail'),showIslandNotification(_0x476efa(0x6b9),_0x476efa(0x5f8),_0x476efa(0x4fd));}let currentCallFilter=_0x2a6210(0x40e),currentSearchQuery='',allCallRecordsCache=[];async function loadCallRecords(){const _0x44d044=_0x2a6210;try{const _0x4f18f2=await db[_0x44d044(0x99)]['orderBy'](_0x44d044(0x5c9))['reverse']()['toArray']();allCallRecordsCache=_0x4f18f2,console[_0x44d044(0x40b)]('📱\x20[Recent]\x20Loaded',_0x4f18f2['length'],_0x44d044(0x367)),await renderCallRecords();}catch(_0x1ec8a8){console[_0x44d044(0x5d9)](_0x44d044(0x82a),_0x1ec8a8);}}async function renderCallRecords(){const _0x3235f=_0x2a6210,_0x52d330=document[_0x3235f(0x550)](_0x3235f(0x48e));if(!_0x52d330)return;let _0x1b7912=allCallRecordsCache;currentCallFilter===_0x3235f(0x2b3)&&(_0x1b7912=_0x1b7912[_0x3235f(0x34c)](_0x355e2e=>_0x355e2e[_0x3235f(0x403)]==='missed'));currentSearchQuery&&(_0x1b7912=_0x1b7912['filter'](_0x28e3df=>{const _0x10698f=_0x3235f,_0x36093b=_0x28e3df[_0x10698f(0x104)]?.[_0x10698f(0x5bd)]()[_0x10698f(0x3a6)](currentSearchQuery),_0x5b557b=_0x28e3df[_0x10698f(0x1db)]?.['toLowerCase']()[_0x10698f(0x3a6)](currentSearchQuery);return _0x36093b||_0x5b557b;}));if(_0x1b7912[_0x3235f(0x73a)]===0x0){_0x52d330[_0x3235f(0x63f)]=_0x3235f(0x703);return;}const _0x14aa33=_0x1b7912['map']((_0x3b7418,_0x1c0226)=>{const _0x2a6282=_0x3235f,{phoneNumber:_0x5d7071,characterName:_0x112452,characterAvatar:_0x5cd742,callType:_0x266f02,timestamp:_0x544874,duration:_0x55045b}=_0x3b7418,_0x3c3a22=_0x112452||formatPhoneNumberDisplay(_0x5d7071),_0x19da82=formatCallTime(_0x544874),_0x12d65f=_0x266f02===_0x2a6282(0x525)?_0x2a6282(0x525):_0x266f02===_0x2a6282(0x6fd)?_0x2a6282(0x6fd):_0x2a6282(0x2b3),_0x22cf71=_0x266f02===_0x2a6282(0x2b3)?'missed':'',_0xb38430=_0x266f02===_0x2a6282(0x525)?_0x2a6282(0x60d):_0x2a6282(0x7b8);let _0x55376d;if(_0x5cd742)_0x55376d=_0x2a6282(0x23a)+_0x5cd742+'\x22\x20alt=\x22\x22\x20style=\x22width:100%;height:100%;object-fit:cover;border-radius:50%;\x22>';else{if(_0x112452){const _0x144792=_0x112452[_0x2a6282(0x7b6)](0x0)[_0x2a6282(0x2db)]();_0x55376d='<span>'+_0x144792+_0x2a6282(0x162);}else _0x55376d=_0x2a6282(0x6c0);}const _0x1b7e0f=_0x266f02===_0x2a6282(0x525)?'呼出':_0x266f02===_0x2a6282(0x6fd)?'来电':'未接',_0x366ff7=_0x55045b?_0x2a6282(0x3ce)+formatCallDuration(_0x55045b):'',_0x4eef90=_0x366ff7?_0x1b7e0f+_0x2a6282(0x4ff)+_0x366ff7:_0x1b7e0f,_0x34b79d=_0x1c0226<_0x1b7912[_0x2a6282(0x73a)]-0x1?'<div\x20class=\x22recent-call-divider\x22></div>':'';return'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22recent-call-item\x22\x20onclick=\x22redialPhoneNumber(\x27'+_0x5d7071+'\x27)\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22recent-call-avatar\x20'+(_0x5cd742?_0x2a6282(0x3d7):'')+_0x2a6282(0x580)+_0x55376d+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22recent-call-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22recent-call-number\x20'+_0x22cf71+_0x2a6282(0x285)+_0x12d65f+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>'+_0xb38430+'</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x3c3a22+_0x2a6282(0x75a)+_0x4eef90+_0x2a6282(0x566)+_0x19da82+_0x2a6282(0x4a3)+_0x5d7071+_0x2a6282(0x123)+_0x34b79d+_0x2a6282(0x3fe);})['join']('');_0x52d330[_0x3235f(0x63f)]=_0x14aa33;}function formatPhoneNumberDisplay(_0x57fbfb){const _0x284440=_0x2a6210;if(!_0x57fbfb)return'';const _0x3b1b7b=_0x57fbfb[_0x284440(0x7a9)](/\s/g,'')['replace'](/-/g,'');if(_0x3b1b7b[_0x284440(0x73a)]===0xb)return _0x3b1b7b[_0x284440(0x4c1)](0x0,0x3)+'\x20'+_0x3b1b7b[_0x284440(0x4c1)](0x3,0x7)+'\x20'+_0x3b1b7b[_0x284440(0x4c1)](0x7);return _0x57fbfb;}function showCallInfo(_0xc3ec12){const _0x134a83=_0x2a6210;console[_0x134a83(0x40b)](_0x134a83(0x67b),_0xc3ec12),showContactDetail(_0xc3ec12);}let currentContactData=null;async function showContactDetail(_0x351ce4){const _0x13a78e=_0x2a6210,_0x1ab952=document['getElementById']('phoneContactDetail');if(!_0x1ab952){console['warn'](_0x13a78e(0x531));return;}console[_0x13a78e(0x40b)]('📱\x20======\x20showContactDetail\x20START\x20======'),console[_0x13a78e(0x40b)](_0x13a78e(0x57d),_0x351ce4);let _0xfe881d=await db[_0x13a78e(0x99)]['where']('phoneNumber')[_0x13a78e(0x630)](_0x351ce4)['reverse']()[_0x13a78e(0x2bf)]('timestamp');console['log'](_0x13a78e(0x373),JSON[_0x13a78e(0x232)](_0xfe881d,null,0x2));const _0x130969=await db[_0x13a78e(0x3d8)][_0x13a78e(0x34c)](_0x56f64f=>_0x56f64f[_0x13a78e(0x1e9)]===_0x13a78e(0x7a4))['toArray']();console[_0x13a78e(0x40b)]('📱\x20chatMessages\x20中的通话记录:',_0x130969[_0x13a78e(0x73a)],'条'),_0x130969[_0x13a78e(0x84c)]((_0x28be49,_0x4df232)=>{const _0x4b997e=_0x13a78e;console[_0x4b997e(0x40b)]('📱\x20chatMessages['+_0x4df232+']:',{'phoneNumber':_0x28be49[_0x4b997e(0x104)],'timestamp':_0x28be49[_0x4b997e(0x5c9)],'hasTranscript':_0x28be49[_0x4b997e(0x1ff)]?.['length']>0x0,'transcriptCount':_0x28be49[_0x4b997e(0x1ff)]?.['length']||0x0});});for(let _0x20ac4d=0x0;_0x20ac4d<_0xfe881d['length'];_0x20ac4d++){console['log'](_0x13a78e(0x214)+_0x20ac4d+']:',{'phoneNumber':_0xfe881d[_0x20ac4d][_0x13a78e(0x104)],'timestamp':_0xfe881d[_0x20ac4d]['timestamp'],'hasTranscript':_0xfe881d[_0x20ac4d]['transcript']?.['length']>0x0});if(!_0xfe881d[_0x20ac4d][_0x13a78e(0x2fe)]||_0xfe881d[_0x20ac4d][_0x13a78e(0x2fe)][_0x13a78e(0x73a)]===0x0){const _0xddedd3=await db[_0x13a78e(0x3d8)]['filter'](_0x235d2a=>_0x235d2a[_0x13a78e(0x1e9)]===_0x13a78e(0x7a4)&&_0x235d2a['phoneNumber']===_0x351ce4&&Math[_0x13a78e(0x4eb)](_0x235d2a[_0x13a78e(0x5c9)]-_0xfe881d[_0x20ac4d]['timestamp'])<0xea60)[_0x13a78e(0x651)]();console['log'](_0x13a78e(0x143),_0xddedd3['length'],'条');const _0x4e066e=_0xddedd3[0x0];_0x4e066e&&_0x4e066e[_0x13a78e(0x1ff)]&&_0x4e066e['callTranscript'][_0x13a78e(0x73a)]>0x0?(_0xfe881d[_0x20ac4d][_0x13a78e(0x2fe)]=_0x4e066e[_0x13a78e(0x1ff)],console[_0x13a78e(0x40b)](_0x13a78e(0x623),_0xfe881d[_0x20ac4d][_0x13a78e(0x2fe)])):console['log'](_0x13a78e(0x79));}}console['log'](_0x13a78e(0x80b),_0xfe881d);const _0x594a8d=_0xfe881d[0x0]||{};let _0x31d021=_0x594a8d[_0x13a78e(0x1db)]||null,_0x388e7a=_0x594a8d[_0x13a78e(0x7c4)]||null,_0xa17aa4=_0x594a8d[_0x13a78e(0x848)]||null,_0x406981=_0x594a8d['isStranger']||![],_0x165442=_0x594a8d[_0x13a78e(0x4c8)]||null;console['log'](_0x13a78e(0x5ca),_0x406981,',\x20strangerPersona=',_0x165442?.[_0x13a78e(0x189)]||_0x13a78e(0x283));const _0x5b35c9=await db[_0x13a78e(0x33c)]['get'](_0x351ce4);let _0x37ef46=![],_0x5df8d2=null,_0x279bdf=null;if(_0x5b35c9){_0x37ef46=!![],_0x5df8d2=_0x5b35c9['nickname'],_0x279bdf=_0x5b35c9[_0x13a78e(0x4af)],_0xa17aa4=_0x5b35c9[_0x13a78e(0x848)]||_0xa17aa4;_0x5b35c9['isStranger']&&(_0x406981=!![]);_0x5b35c9[_0x13a78e(0x4c8)]&&(_0x165442=_0x5b35c9[_0x13a78e(0x4c8)]);console[_0x13a78e(0x40b)](_0x13a78e(0x185),_0x5df8d2);if(!_0x279bdf&&_0x5b35c9['characterId']){const _0xe5e5b1=await getCharacterById(_0x5b35c9['characterId']);_0xe5e5b1&&_0xe5e5b1[_0x13a78e(0x555)]?.[_0x13a78e(0x657)]&&(_0x388e7a=_0xe5e5b1['settings']['aiAvatar']);}}console[_0x13a78e(0x40b)]('📱\x20最终状态:\x20isContact=',_0x37ef46,_0x13a78e(0x177),_0x406981,_0x13a78e(0x111),_0x165442?.[_0x13a78e(0x189)]||_0x13a78e(0x283)),currentContactData={'phoneNumber':_0x351ce4,'characterName':_0x5df8d2||_0x31d021,'characterAvatar':_0x279bdf||_0x388e7a,'characterId':_0xa17aa4,'isContact':_0x37ef46,'isStranger':_0x406981,'strangerPersona':_0x165442,'records':_0xfe881d};const _0x5bb431=document[_0x13a78e(0x550)](_0x13a78e(0x5d8));if(_0x5bb431){if(_0x279bdf)_0x5bb431[_0x13a78e(0x63f)]='<img\x20src=\x22'+_0x279bdf+_0x13a78e(0x41d);else{if(_0x388e7a)_0x5bb431['innerHTML']=_0x13a78e(0x23a)+_0x388e7a+'\x22\x20alt=\x22\x22\x20onerror=\x22this.parentNode.innerHTML=\x27<svg\x20viewBox=\x5c\x270\x200\x2024\x2024\x5c\x27><path\x20d=\x5c\x27M20\x2021v-2a4\x204\x200\x200\x200-4-4H8a4\x204\x200\x200\x200-4\x204v2\x5c\x27/><circle\x20cx=\x5c\x2712\x5c\x27\x20cy=\x5c\x277\x5c\x27\x20r=\x5c\x274\x5c\x27/></svg>\x27\x22>';else{if(_0x5df8d2||_0x31d021){const _0x3531cd=_0x5df8d2||_0x31d021;_0x5bb431[_0x13a78e(0x63f)]=_0x13a78e(0x4f4)+_0x3531cd[_0x13a78e(0x7b6)](0x0)+_0x13a78e(0x162);}else _0x5bb431[_0x13a78e(0x63f)]=_0x13a78e(0x635);}}}const _0x29ee07=document['getElementById'](_0x13a78e(0x7a7)),_0x109e56=document[_0x13a78e(0x550)]('contactDetailLabel'),_0x58c8a0=document[_0x13a78e(0x550)](_0x13a78e(0x388));if(_0x29ee07)_0x29ee07[_0x13a78e(0x2a1)]=_0x37ef46?_0x13a78e(0x30a):'未知';const _0x27663a=_0x5df8d2||_0x31d021;if(_0x109e56)_0x109e56['textContent']=_0x27663a||'未知号码';if(_0x58c8a0)_0x58c8a0['textContent']=formatPhoneNumberDisplay(_0x351ce4);const _0x119cb3=document[_0x13a78e(0x550)](_0x13a78e(0x81)),_0xaddeb3=document['getElementById'](_0x13a78e(0x18c));if(_0x119cb3)_0x119cb3['textContent']=_0xfe881d['length']+'\x20条';_0xaddeb3&&(_0xfe881d[_0x13a78e(0x73a)]===0x0?_0xaddeb3['innerHTML']='<div\x20style=\x22padding:\x2020px;\x20text-align:\x20center;\x20color:\x20var(--text-tertiary);\x22>暂无通话记录</div>':_0xaddeb3[_0x13a78e(0x63f)]=_0xfe881d[_0x13a78e(0x444)]((_0x4b4296,_0x41136c)=>{const _0x23c7b7=_0x13a78e,_0x1840ee=_0x4b4296[_0x23c7b7(0x403)]||_0x23c7b7(0x525),_0x39584b=_0x1840ee===_0x23c7b7(0x2b3)?_0x23c7b7(0x2b3):_0x1840ee===_0x23c7b7(0x6fd)?_0x23c7b7(0x6fd):_0x23c7b7(0x525),_0x382dbe=_0x1840ee===_0x23c7b7(0x2b3)?_0x23c7b7(0x7c6):_0x1840ee===_0x23c7b7(0x6fd)?'来电':'去电',_0x4f8bae=_0x1840ee==='missed'?_0x23c7b7(0x2b3):'',_0x375e5a=_0x1840ee===_0x23c7b7(0x525)?_0x23c7b7(0x60d):_0x1840ee===_0x23c7b7(0x2b3)?_0x23c7b7(0x600):_0x23c7b7(0x5da),_0x210138=formatContactHistoryTime(_0x4b4296['timestamp']),_0x42dc43=_0x4b4296[_0x23c7b7(0x198)]?formatCallDuration(_0x4b4296['duration']):'--',_0x2cfa7d=_0x4b4296[_0x23c7b7(0x2fe)]&&_0x4b4296[_0x23c7b7(0x2fe)]['length']>0x0;console['log']('📱\x20Record',_0x41136c,_0x23c7b7(0x1e7),_0x2cfa7d,'transcript:',_0x4b4296['transcript']);const _0x478b9a=_0x2cfa7d?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-history-detail\x22\x20id=\x22contactHistoryDetail_'+_0x41136c+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-history-detail-inner\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x4b4296[_0x23c7b7(0x2fe)][_0x23c7b7(0x444)](_0x308440=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-transcript-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22contact-transcript-line\x20'+(_0x308440[_0x23c7b7(0x733)]===_0x23c7b7(0x2c6)?'user':'')+_0x23c7b7(0x7e)+formatTranscriptTime(_0x308440[_0x23c7b7(0x5c9)])+_0x23c7b7(0x3cb)+(_0x308440['text']||_0x308440['content']||'')+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20')[_0x23c7b7(0x469)]('')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20':'';return _0x23c7b7(0x368)+(_0x2cfa7d?_0x23c7b7(0x32a)+_0x41136c+')\x22':'')+_0x23c7b7(0x370)+_0x39584b+_0x23c7b7(0x278)+_0x375e5a+_0x23c7b7(0x295)+_0x4f8bae+'\x22>'+_0x382dbe+_0x23c7b7(0x84)+_0x210138+_0x23c7b7(0x3a5)+_0x42dc43+_0x23c7b7(0x433)+_0x478b9a+_0x23c7b7(0x1eb);})[_0x13a78e(0x469)](''));const _0x1a3907=document[_0x13a78e(0x550)]('deleteContactOption');_0x1a3907&&(_0x37ef46?_0x1a3907['style'][_0x13a78e(0x712)]='flex':_0x1a3907[_0x13a78e(0x37e)]['display']=_0x13a78e(0x22e));const _0x1e36ae=document[_0x13a78e(0x550)](_0x13a78e(0x72c));_0x1e36ae&&(_0x406981&&_0x165442?(_0x1e36ae[_0x13a78e(0x37e)][_0x13a78e(0x712)]=_0x13a78e(0x8b),console[_0x13a78e(0x40b)](_0x13a78e(0x7fc),_0x165442[_0x13a78e(0x189)])):_0x1e36ae[_0x13a78e(0x37e)]['display']=_0x13a78e(0x22e)),_0x1ab952[_0x13a78e(0x37e)]['display']=_0x13a78e(0x8b),_0x1ab952[_0x13a78e(0x2af)][_0x13a78e(0x2a8)](_0x13a78e(0x537)),setTimeout(()=>{const _0x346b3b=_0x13a78e;_0x1ab952[_0x346b3b(0x2af)][_0x346b3b(0x5e8)](_0x346b3b(0x537)),_0x1ab952[_0x346b3b(0x2af)][_0x346b3b(0x2a8)]('show');},0x190),console['log'](_0x13a78e(0x1e3),_0x351ce4,'with',_0xfe881d[_0x13a78e(0x73a)],_0x13a78e(0x4f5));}function hideContactDetail(){const _0x38dcde=_0x2a6210,_0x11a34e=document['getElementById'](_0x38dcde(0x65d));if(!_0x11a34e)return;_0x11a34e[_0x38dcde(0x2af)]['remove'](_0x38dcde(0x7cc)),_0x11a34e['classList'][_0x38dcde(0x2a8)](_0x38dcde(0x812)),setTimeout(()=>{const _0xa44880=_0x38dcde;_0x11a34e[_0xa44880(0x37e)][_0xa44880(0x712)]=_0xa44880(0x22e),_0x11a34e['classList']['remove'](_0xa44880(0x812)),document['querySelectorAll'](_0xa44880(0x44e))[_0xa44880(0x84c)](_0x144756=>_0x144756[_0xa44880(0x2af)][_0xa44880(0x5e8)]('expanded')),document[_0xa44880(0x854)](_0xa44880(0x23d))[_0xa44880(0x84c)](_0x546877=>_0x546877[_0xa44880(0x2af)]['remove']('expanded')),document[_0xa44880(0x854)]('.contact-history-detail.expanded')[_0xa44880(0x84c)](_0x49a93c=>_0x49a93c[_0xa44880(0x2af)][_0xa44880(0x5e8)](_0xa44880(0x32f)));},0x15e),currentContactData=null,console[_0x38dcde(0x40b)]('📱\x20Contact\x20detail\x20hidden');}function toggleContactHistoryCard(_0x54ad5b){const _0x25c17a=_0x2a6210;console['log']('📱\x20toggleContactHistoryCard\x20called',_0x54ad5b);const _0x2b2eee=_0x54ad5b[_0x25c17a(0x174)](_0x25c17a(0x510));if(!_0x2b2eee){console['warn'](_0x25c17a(0x55e));return;}const _0x4ee268=_0x2b2eee[_0x25c17a(0x2ba)](_0x25c17a(0x9d)),_0x403cf5=_0x54ad5b[_0x25c17a(0x2ba)](_0x25c17a(0x476));console[_0x25c17a(0x40b)](_0x25c17a(0x1ba),_0x4ee268),console[_0x25c17a(0x40b)](_0x25c17a(0x5a3),_0x403cf5);if(_0x4ee268)_0x4ee268[_0x25c17a(0x2af)][_0x25c17a(0x18f)](_0x25c17a(0x32f));if(_0x403cf5)_0x403cf5[_0x25c17a(0x2af)][_0x25c17a(0x18f)]('expanded');console['log']('📱\x20Card\x20toggled,\x20expanded:',_0x4ee268?.[_0x25c17a(0x2af)][_0x25c17a(0x353)]('expanded'));}function toggleContactHistoryDetail(_0x2d517c){const _0x1ea9c4=_0x2a6210;console[_0x1ea9c4(0x40b)](_0x1ea9c4(0x75),_0x2d517c);const _0x538dec=document['getElementById']('contactHistoryDetail_'+_0x2d517c);console['log'](_0x1ea9c4(0x6f5),_0x538dec),_0x538dec?(_0x538dec[_0x1ea9c4(0x2af)]['toggle'](_0x1ea9c4(0x32f)),console[_0x1ea9c4(0x40b)](_0x1ea9c4(0x4d3),_0x538dec['classList'][_0x1ea9c4(0x353)]('expanded'))):console[_0x1ea9c4(0x3bc)](_0x1ea9c4(0x1ce),_0x2d517c);}function formatContactHistoryTime(_0x29cb30){const _0x49e167=_0x2a6210;if(!_0x29cb30)return'--';const _0x19b1eb=new Date(_0x29cb30);if(isNaN(_0x19b1eb[_0x49e167(0x4e0)]()))return'--';const _0x438f98=_0x19b1eb[_0x49e167(0x2ad)](),_0x5e1f0e=_0x19b1eb[_0x49e167(0x113)]()+0x1,_0x48e1ba=_0x19b1eb[_0x49e167(0x7d8)](),_0x107ed4=String(_0x19b1eb[_0x49e167(0x859)]())[_0x49e167(0x6a6)](0x2,'0'),_0x3db9fd=String(_0x19b1eb[_0x49e167(0x6f0)]())[_0x49e167(0x6a6)](0x2,'0');return _0x438f98+'/'+_0x5e1f0e+'/'+_0x48e1ba+_0x49e167(0x4ff)+_0x107ed4+':'+_0x3db9fd;}function formatTranscriptTime(_0x41c8c3){const _0x39eb40=_0x2a6210;if(!_0x41c8c3)return'';const _0x41e3a7=new Date(_0x41c8c3);if(isNaN(_0x41e3a7[_0x39eb40(0x4e0)]()))return'';const _0x11d27e=String(_0x41e3a7[_0x39eb40(0x859)]())[_0x39eb40(0x6a6)](0x2,'0'),_0x3403eb=String(_0x41e3a7[_0x39eb40(0x6f0)]())['padStart'](0x2,'0'),_0x360039=String(_0x41e3a7[_0x39eb40(0x76a)]())[_0x39eb40(0x6a6)](0x2,'0');return _0x11d27e+':'+_0x3403eb+':'+_0x360039;}function getCarrierFromNumber(_0x105423){const _0x362c4d=_0x2a6210;if(!_0x105423)return'';const _0x36573f=_0x105423[_0x362c4d(0x7a9)](/\s/g,'')['replace'](/-/g,'');if(_0x36573f==='10086')return _0x362c4d(0x646);if(_0x36573f===_0x362c4d(0x348))return _0x362c4d(0x2bc);if(_0x36573f===_0x362c4d(0x6e4))return _0x362c4d(0x686);if(_0x36573f['startsWith']('134')||_0x36573f[_0x362c4d(0x78a)](_0x362c4d(0x587))||_0x36573f[_0x362c4d(0x78a)]('136')||_0x36573f[_0x362c4d(0x78a)](_0x362c4d(0x379))||_0x36573f[_0x362c4d(0x78a)](_0x362c4d(0x6a4))||_0x36573f[_0x362c4d(0x78a)]('139')||_0x36573f[_0x362c4d(0x78a)](_0x362c4d(0x437))||_0x36573f[_0x362c4d(0x78a)](_0x362c4d(0x825))||_0x36573f[_0x362c4d(0x78a)]('152')||_0x36573f[_0x362c4d(0x78a)](_0x362c4d(0x72f))||_0x36573f[_0x362c4d(0x78a)]('158')||_0x36573f[_0x362c4d(0x78a)](_0x362c4d(0x423))||_0x36573f['startsWith'](_0x362c4d(0x191))||_0x36573f['startsWith'](_0x362c4d(0x68b))||_0x36573f['startsWith']('184')||_0x36573f[_0x362c4d(0x78a)]('187')||_0x36573f[_0x362c4d(0x78a)]('188')||_0x36573f[_0x362c4d(0x78a)](_0x362c4d(0x7eb)))return _0x362c4d(0x646);if(_0x36573f[_0x362c4d(0x78a)]('130')||_0x36573f[_0x362c4d(0x78a)]('131')||_0x36573f[_0x362c4d(0x78a)](_0x362c4d(0x815))||_0x36573f['startsWith'](_0x362c4d(0xce))||_0x36573f[_0x362c4d(0x78a)](_0x362c4d(0x117))||_0x36573f[_0x362c4d(0x78a)](_0x362c4d(0x1aa))||_0x36573f['startsWith'](_0x362c4d(0x685))||_0x36573f['startsWith'](_0x362c4d(0x55a)))return _0x362c4d(0x2bc);if(_0x36573f['startsWith'](_0x362c4d(0x4ab))||_0x36573f['startsWith']('149')||_0x36573f[_0x362c4d(0x78a)](_0x362c4d(0xa0))||_0x36573f[_0x362c4d(0x78a)](_0x362c4d(0x842))||_0x36573f[_0x362c4d(0x78a)](_0x362c4d(0x68a))||_0x36573f[_0x362c4d(0x78a)](_0x362c4d(0x40c))||_0x36573f[_0x362c4d(0x78a)](_0x362c4d(0x785)))return'中国电信';return'未知运营商';}function sendMessageToContact(){const _0x29b838=_0x2a6210;if(!currentContactData)return;console['log'](_0x29b838(0x3c6),currentContactData[_0x29b838(0x104)]);const _0x313318=currentContactData[_0x29b838(0x1db)]||currentContactData[_0x29b838(0x104)];openSmsDetail(currentContactData[_0x29b838(0x104)],_0x313318);}let currentSmsData={'phoneNumber':null,'contactName':null,'messages':[]};const smsUiSessionStore=new Map();function getSmsSession(_0x5b0844,_0x55481e){const _0x32c20f=_0x2a6210,_0x1bb851=_0x5b0844||'',_0x5229bf=normalizeId(_0x1bb851);if(!_0x5229bf)return{'phoneNumber':_0x1bb851,'contactName':_0x55481e||'','messages':[]};let _0x44b92a=smsUiSessionStore[_0x32c20f(0x60f)](_0x5229bf);if(!_0x44b92a)_0x44b92a={'phoneNumber':_0x1bb851,'contactName':_0x55481e||'','messages':[]},smsUiSessionStore[_0x32c20f(0x806)](_0x5229bf,_0x44b92a);else{if(_0x1bb851)_0x44b92a['phoneNumber']=_0x1bb851;if(_0x55481e)_0x44b92a[_0x32c20f(0x19c)]=_0x55481e;}return _0x44b92a;}function isSmsDetailActive(){const _0x55c8c0=_0x2a6210,_0x2c5a64=document[_0x55c8c0(0x550)](_0x55c8c0(0x2e3));return!!(_0x2c5a64&&_0x2c5a64[_0x55c8c0(0x2af)][_0x55c8c0(0x353)]('active'));}function isSameSmsSession(_0x540a93){const _0x21fea0=_0x2a6210;if(!_0x540a93)return![];const _0x4f1572=currentSmsData?.[_0x21fea0(0x104)]||'';return normalizeId(_0x4f1572)===normalizeId(_0x540a93);}function getLastSmsAssistantPreview(_0x10c6c1){const _0x575511=_0x2a6210;if(!Array[_0x575511(0x14f)](_0x10c6c1))return'';for(let _0x4ff638=_0x10c6c1[_0x575511(0x73a)]-0x1;_0x4ff638>=0x0;_0x4ff638--){const _0x33362f=_0x10c6c1[_0x4ff638];if(_0x33362f&&_0x33362f[_0x575511(0x733)]==='assistant'&&typeof _0x33362f[_0x575511(0x73c)]===_0x575511(0x6b0)&&_0x33362f['content'][_0x575511(0x14c)]())return _0x33362f[_0x575511(0x73c)][_0x575511(0x14c)]();}for(let _0x441a96=_0x10c6c1[_0x575511(0x73a)]-0x1;_0x441a96>=0x0;_0x441a96--){const _0x189997=_0x10c6c1[_0x441a96];if(_0x189997&&typeof _0x189997[_0x575511(0x73c)]===_0x575511(0x6b0)&&_0x189997[_0x575511(0x73c)][_0x575511(0x14c)]())return _0x189997[_0x575511(0x73c)][_0x575511(0x14c)]();}return'';}async function resolveSmsNotificationAvatar(_0x235a57,_0x5f57d4){const _0x59da17=_0x2a6210;let _0x284ff1='';const _0x2f9399=normalizeId(_0x5f57d4||'');if(_0x2f9399&&db?.['contacts'])try{const _0x5c8fcb=await db[_0x59da17(0x33c)]['get'](_0x2f9399);_0x284ff1=_0x5c8fcb?.[_0x59da17(0x4af)]||_0x5c8fcb?.[_0x59da17(0x830)]||_0x5c8fcb?.[_0x59da17(0x7c4)]||'';}catch(_0x226863){}if(!_0x284ff1&&_0x235a57&&typeof getCharacterById===_0x59da17(0x88))try{const _0x22917a=await getCharacterById(_0x235a57);_0x284ff1=_0x22917a?.['settings']?.[_0x59da17(0x657)]||_0x22917a?.[_0x59da17(0x830)]||'';}catch(_0xa2dc88){}return!_0x284ff1&&typeof currentSmsCharacter!==_0x59da17(0x653)&&(_0x284ff1=currentSmsCharacter?.['settings']?.['aiAvatar']||currentSmsCharacter?.[_0x59da17(0x830)]||''),_0x284ff1||'';}async function showSmsReplyPhoneStyleNotification(_0x3347e7={}){const _0x37994e=_0x2a6210;if(typeof showPhoneStyleNotification!==_0x37994e(0x88))return![];const _0x15960a=_0x3347e7[_0x37994e(0x104)]||currentSmsData?.['phoneNumber']||'',_0x17a5ca=_0x3347e7['characterId']||(typeof currentSmsCharacterId!=='undefined'?currentSmsCharacterId:''),_0xeccfa5=normalizeId(_0x17a5ca||'');let _0x4f33cf=String(_0x3347e7[_0x37994e(0x66c)]||'')[_0x37994e(0x14c)]();!_0x4f33cf&&typeof getCurrentSmsCharacterName===_0x37994e(0x88)&&(_0x4f33cf=String(getCurrentSmsCharacterName(_0x15960a)||'')[_0x37994e(0x14c)]());if(!_0x4f33cf)_0x4f33cf=currentSmsData?.[_0x37994e(0x19c)]||'角色';let _0x23c286=String(_0x3347e7[_0x37994e(0x46e)]||'')[_0x37994e(0x14c)]();!_0x23c286&&(_0x23c286=getLastSmsAssistantPreview(_0x3347e7[_0x37994e(0x219)]||currentSmsData?.[_0x37994e(0x219)]||[]));_0x23c286=String(_0x23c286||'')[_0x37994e(0x7a9)](/\s+/g,'\x20')[_0x37994e(0x14c)]();if(!_0x23c286)_0x23c286=_0x37994e(0x20a);const _0x28dea5=(typeof getAppDisplayName===_0x37994e(0x88)?getAppDisplayName(_0x37994e(0x10e)):'')||'电话';let _0xa1b04b='';if(typeof getAppNotificationIconHtml===_0x37994e(0x88))try{_0xa1b04b=await getAppNotificationIconHtml('phone');}catch(_0x3f2d64){_0xa1b04b='';}const _0x15e069=await resolveSmsNotificationAvatar(_0xeccfa5,_0x15960a);return showPhoneStyleNotification({'title':_0x28dea5,'message':_0x4f33cf+'：'+_0x23c286,'avatar':_0x15e069||null,'leftIcon':_0x37994e(0x187),'leftIconHtml':_0xa1b04b||null,'duration':0xbb8,'showTime':!![]}),!![];}let smsEditMode=![],smsSelectedMessages=new Set(),smsOpenedFrom=_0x2a6210(0x10e);async function openSmsDetail(_0x559d1d,_0x637b51){const _0x1c9073=_0x2a6210;console[_0x1c9073(0x40b)](_0x1c9073(0x306),_0x559d1d,_0x637b51),currentSmsData=getSmsSession(_0x559d1d,_0x637b51);const _0x24d34e=await ensureCallScriptLoaded();if(!_0x24d34e||typeof initSmsWithAI!==_0x1c9073(0x88)){console[_0x1c9073(0x5d9)](_0x1c9073(0x594)),showIslandNotification('错误',_0x1c9073(0x422),_0x1c9073(0x5d9));return;}const _0x3a4be9=currentContactData&&normalizeId(currentContactData[_0x1c9073(0x104)])===normalizeId(_0x559d1d)?currentContactData:{'phoneNumber':_0x559d1d,'characterName':_0x637b51};await initSmsWithAI(_0x559d1d,_0x3a4be9);const _0x1a6bae=Array['isArray'](currentSmsData[_0x1c9073(0x219)])&&currentSmsData[_0x1c9073(0x219)]['length']>0x0,_0x1dcf5b=typeof isSmsSessionBusy===_0x1c9073(0x88)?isSmsSessionBusy(_0x559d1d):![];if(!_0x1a6bae||!_0x1dcf5b)await loadSmsHistory(_0x559d1d);else typeof setSmsSessionMessages===_0x1c9073(0x88)&&setSmsSessionMessages(_0x559d1d,currentSmsData[_0x1c9073(0x219)][_0x1c9073(0x444)](_0x1d7a7c=>({'role':_0x1d7a7c[_0x1c9073(0x733)],'content':_0x1d7a7c[_0x1c9073(0x73c)],'timestamp':_0x1d7a7c['timestamp']})));const _0x208cb4=document['getElementById'](_0x1c9073(0x708)),_0x1fe1cf=document[_0x1c9073(0x550)]('smsContactStatus'),_0x28508e=getCurrentSmsCharacterName(_0x559d1d)||_0x637b51||_0x559d1d;if(_0x208cb4)_0x208cb4['textContent']=_0x28508e;if(_0x1fe1cf)_0x1fe1cf[_0x1c9073(0x2a1)]='iMessage';renderSmsMessages();const _0x41be3e=document['getElementById']('smsDetailScreen');_0x41be3e&&_0x41be3e[_0x1c9073(0x2af)][_0x1c9073(0x2a8)](_0x1c9073(0x763)),setTimeout(()=>{const _0x3e1921=document['getElementById']('smsInput');if(_0x3e1921)_0x3e1921['focus']();},0x12c);}async function closeSmsDetail(){const _0x22b050=_0x2a6210;console[_0x22b050(0x40b)]('📱\x20Closing\x20SMS\x20detail,\x20opened\x20from:',smsOpenedFrom);currentSmsData[_0x22b050(0x104)]&&currentSmsData['messages'][_0x22b050(0x73a)]>0x0&&await saveSmsHistory(currentSmsData[_0x22b050(0x104)],currentSmsData['messages']);const _0x1e62de=document[_0x22b050(0x550)]('smsDetailScreen');_0x1e62de&&_0x1e62de[_0x22b050(0x2af)]['remove'](_0x22b050(0x763));if(smsEditMode){smsEditMode=![],smsSelectedMessages[_0x22b050(0x20d)]();const _0xb0263d=document[_0x22b050(0x550)](_0x22b050(0x7f0)),_0x513537=document[_0x22b050(0x550)](_0x22b050(0x152)),_0x474c45=document[_0x22b050(0x2ba)](_0x22b050(0x554)),_0x3a98ee=document['getElementById'](_0x22b050(0x20e));if(_0xb0263d)_0xb0263d[_0x22b050(0x2a1)]=_0x22b050(0x2cf);if(_0x513537)_0x513537[_0x22b050(0x37e)][_0x22b050(0x712)]=_0x22b050(0x22e);if(_0x474c45)_0x474c45[_0x22b050(0x37e)]['display']='flex';if(_0x3a98ee)_0x3a98ee[_0x22b050(0x2af)][_0x22b050(0x5e8)](_0x22b050(0x406));}hideSmsTyping(),smsOpenedFrom===_0x22b050(0x743)&&(console[_0x22b050(0x40b)](_0x22b050(0x2b6)),await openImessage()),smsOpenedFrom=_0x22b050(0x10e);}function renderSmsMessages(){const _0x34b861=_0x2a6210,_0x162e7e=document['getElementById']('smsMessagesArea'),_0x3dd039=document[_0x34b861(0x550)](_0x34b861(0x1e1)),_0x2ba47a=document['getElementById'](_0x34b861(0x67d));if(!_0x162e7e)return;const _0x2ad34e=_0x162e7e['querySelectorAll']('.sms-message,\x20.sms-date-separator');_0x2ad34e['forEach'](_0x38fb0a=>_0x38fb0a[_0x34b861(0x5e8)]());if(currentSmsData[_0x34b861(0x219)][_0x34b861(0x73a)]===0x0){if(_0x3dd039)_0x3dd039['style']['display']='flex';return;}if(_0x3dd039)_0x3dd039['style'][_0x34b861(0x712)]=_0x34b861(0x22e);let _0x310f3c=null;currentSmsData[_0x34b861(0x219)][_0x34b861(0x84c)]((_0x478d5a,_0x200e36)=>{const _0x20e3d0=_0x34b861,_0x11c716=new Date(_0x478d5a[_0x20e3d0(0x5c9)]),_0x44852f=formatSmsDate(_0x11c716);if(_0x44852f!==_0x310f3c){const _0x4ac305=document['createElement'](_0x20e3d0(0x5ab));_0x4ac305[_0x20e3d0(0x337)]=_0x20e3d0(0x342),_0x4ac305[_0x20e3d0(0x63f)]='<div\x20class=\x22sms-date-label\x22>'+_0x44852f+_0x20e3d0(0x670),_0x162e7e[_0x20e3d0(0x343)](_0x4ac305,_0x2ba47a),_0x310f3c=_0x44852f;}const _0x1f7132=document[_0x20e3d0(0x24b)](_0x20e3d0(0x5ab));_0x1f7132[_0x20e3d0(0x337)]=_0x20e3d0(0x317)+(_0x478d5a[_0x20e3d0(0x733)]==='user'?'user':_0x20e3d0(0x515)),_0x1f7132[_0x20e3d0(0x772)]['index']=_0x200e36;let _0x4d0b3b='';if(smsEditMode){const _0x2f53cf=smsSelectedMessages[_0x20e3d0(0x17f)](_0x200e36);_0x4d0b3b+=_0x20e3d0(0x615)+(_0x2f53cf?_0x20e3d0(0x3d5):'')+_0x20e3d0(0x6d0)+_0x200e36+_0x20e3d0(0x286);}_0x4d0b3b+='<div\x20class=\x22sms-message-content\x22>',_0x4d0b3b+=_0x20e3d0(0x145)+escapeHtml(_0x478d5a[_0x20e3d0(0x73c)])+_0x20e3d0(0x670),_0x4d0b3b+=_0x20e3d0(0x57c)+formatSmsTime(_0x11c716)+'</div>',_0x478d5a['role']===_0x20e3d0(0x2c6)&&_0x200e36===currentSmsData['messages'][_0x20e3d0(0x73a)]-0x1&&(_0x4d0b3b+='<div\x20class=\x22sms-delivered\x22>Delivered</div>'),_0x4d0b3b+=_0x20e3d0(0x670),_0x1f7132[_0x20e3d0(0x63f)]=_0x4d0b3b,_0x162e7e[_0x20e3d0(0x343)](_0x1f7132,_0x2ba47a);}),scrollSmsToBottom();}function addSmsMessage(_0x596da5,_0x344f08='user',_0x2855a7=![]){const _0x1a409d=_0x2a6210,_0x44c4f2={'content':_0x596da5,'role':_0x344f08,'timestamp':Date['now'](),'sent':_0x2855a7};return currentSmsData[_0x1a409d(0x219)][_0x1a409d(0x2b9)](_0x44c4f2),appendSmsMessageToUI(_0x44c4f2,currentSmsData[_0x1a409d(0x219)]['length']-0x1),_0x44c4f2;}function appendSmsMessageToUI(_0x172311,_0x11f0db){const _0x1ac6e0=_0x2a6210,_0x1c6607=document[_0x1ac6e0(0x550)](_0x1ac6e0(0x20e)),_0x29a84d=document[_0x1ac6e0(0x550)](_0x1ac6e0(0x1e1)),_0x3400cb=document[_0x1ac6e0(0x550)]('smsTypingIndicator');if(!_0x1c6607)return;if(_0x29a84d)_0x29a84d['style'][_0x1ac6e0(0x712)]=_0x1ac6e0(0x22e);const _0x479066=new Date(_0x172311['timestamp']),_0x32583a=formatSmsDate(_0x479066),_0x1912a3=_0x1c6607[_0x1ac6e0(0x854)](_0x1ac6e0(0x764)),_0xdea765=_0x1912a3[_0x1912a3['length']-0x1],_0x5cc355=_0xdea765?_0xdea765[_0x1ac6e0(0x2ba)](_0x1ac6e0(0x629))['textContent']:null;if(_0x32583a!==_0x5cc355){const _0x26c6ad=document['createElement']('div');_0x26c6ad[_0x1ac6e0(0x337)]=_0x1ac6e0(0x342),_0x26c6ad[_0x1ac6e0(0x63f)]=_0x1ac6e0(0x3ee)+_0x32583a+_0x1ac6e0(0x670),_0x1c6607[_0x1ac6e0(0x343)](_0x26c6ad,_0x3400cb);}const _0x482c0a=document[_0x1ac6e0(0x24b)](_0x1ac6e0(0x5ab));_0x482c0a[_0x1ac6e0(0x337)]='sms-message\x20'+(_0x172311['role']===_0x1ac6e0(0x2c6)?_0x1ac6e0(0x2c6):_0x1ac6e0(0x515)),_0x482c0a[_0x1ac6e0(0x772)][_0x1ac6e0(0x182)]=_0x11f0db;let _0x5d561f='';if(smsEditMode){const _0x33f700=smsSelectedMessages['has'](_0x11f0db);_0x5d561f+='<div\x20class=\x22sms-message-checkbox\x20'+(_0x33f700?_0x1ac6e0(0x3d5):'')+'\x22\x20onclick=\x22toggleSmsMessageSelection('+_0x11f0db+_0x1ac6e0(0x286);}_0x5d561f+=_0x1ac6e0(0x75b),_0x5d561f+='<div\x20class=\x22sms-bubble\x22>'+escapeHtml(_0x172311[_0x1ac6e0(0x73c)])+_0x1ac6e0(0x670),_0x5d561f+=_0x1ac6e0(0x57c)+formatSmsTime(_0x479066)+_0x1ac6e0(0x670),_0x172311['role']===_0x1ac6e0(0x2c6)&&_0x11f0db===currentSmsData[_0x1ac6e0(0x219)][_0x1ac6e0(0x73a)]-0x1&&(_0x5d561f+=_0x1ac6e0(0xe1)),_0x5d561f+=_0x1ac6e0(0x670),_0x482c0a['innerHTML']=_0x5d561f,_0x482c0a[_0x1ac6e0(0x37e)][_0x1ac6e0(0x48d)]='0',_0x482c0a[_0x1ac6e0(0x37e)][_0x1ac6e0(0x61d)]=_0x1ac6e0(0x33d),_0x1c6607['insertBefore'](_0x482c0a,_0x3400cb),requestAnimationFrame(()=>{const _0x274dbe=_0x1ac6e0;_0x482c0a[_0x274dbe(0x37e)][_0x274dbe(0x157)]='opacity\x200.3s\x20ease,\x20transform\x200.3s\x20ease',_0x482c0a[_0x274dbe(0x37e)][_0x274dbe(0x48d)]='1',_0x482c0a[_0x274dbe(0x37e)][_0x274dbe(0x61d)]=_0x274dbe(0x569);}),scrollSmsToBottom();}function addUserSmsMessage(){const _0x26d5a6=_0x2a6210,_0x267b81=document[_0x26d5a6(0x550)](_0x26d5a6(0x281));if(!_0x267b81)return;const _0x1b17d1=_0x267b81['value']['trim']();if(!_0x1b17d1)return;console[_0x26d5a6(0x40b)](_0x26d5a6(0x34e),_0x1b17d1),_0x267b81[_0x26d5a6(0x4cf)]='',addSmsMessage(_0x1b17d1,_0x26d5a6(0x2c6),![]);}async function sendSmsToAI(){const _0x285437=_0x2a6210;console[_0x285437(0x40b)](_0x285437(0x138));const _0x1faea7=currentSmsData[_0x285437(0x219)][_0x285437(0x34c)](_0x674eaa=>_0x674eaa[_0x285437(0x733)]===_0x285437(0x2c6)&&_0x674eaa[_0x285437(0x724)]===![]);if(_0x1faea7['length']===0x0){console['log'](_0x285437(0x49d));return;}console[_0x285437(0x40b)](_0x285437(0x70e)+_0x1faea7[_0x285437(0x73a)]+_0x285437(0x4b5));const _0x19e9ff=currentSmsData[_0x285437(0x104)],_0x278c38=currentSmsData[_0x285437(0x19c)],_0x4af554=currentSmsData[_0x285437(0x219)],_0x36ce3a=typeof currentSmsCharacterId!==_0x285437(0x653)?currentSmsCharacterId:'',_0x2bfec=typeof getCurrentSmsCharacterName==='function'?getCurrentSmsCharacterName(_0x19e9ff):_0x278c38||_0x19e9ff||'角色',_0x2f8cfd=()=>isSmsDetailActive()&&isSameSmsSession(_0x19e9ff);_0x2f8cfd()&&showSmsTyping();try{const _0x583413=await sendMultipleSmsWithAI(_0x1faea7,{'phoneNumber':_0x19e9ff});_0x1faea7['forEach'](_0x1deb5d=>{_0x1deb5d['sent']=!![];});_0x2f8cfd()&&hideSmsTyping();if(_0x583413&&_0x583413[_0x285437(0x219)]&&_0x583413[_0x285437(0x219)]['length']>0x0){const _0x9be13d=_0x2f8cfd();if(_0x9be13d){const _0x4aa7a4=getCurrentSmsCharacterName(_0x19e9ff),_0x496ae4=document['getElementById'](_0x285437(0x708));_0x496ae4&&_0x4aa7a4&&_0x4aa7a4!==_0x285437(0x4bc)&&(_0x496ae4[_0x285437(0x2a1)]=_0x4aa7a4);}for(let _0x2fdbf7=0x0;_0x2fdbf7<_0x583413['messages'][_0x285437(0x73a)];_0x2fdbf7++){const _0xf6d349=_0x583413[_0x285437(0x219)][_0x2fdbf7];_0x2fdbf7>0x0&&await new Promise(_0x5e9635=>setTimeout(_0x5e9635,0x12c+Math[_0x285437(0x658)]()*0x1f4));const _0x27cdaa={'content':_0xf6d349,'role':'assistant','timestamp':Date[_0x285437(0x344)](),'sent':!![]};_0x4af554[_0x285437(0x2b9)](_0x27cdaa),_0x9be13d&&appendSmsMessageToUI(_0x27cdaa,_0x4af554['length']-0x1);}_0x19e9ff&&await saveSmsHistory(_0x19e9ff,_0x4af554);const _0xb29ecd=_0x583413['messages'][_0x583413[_0x285437(0x219)][_0x285437(0x73a)]-0x1],_0x4ae034=_0x9be13d?typeof getCurrentSmsCharacterName===_0x285437(0x88)?getCurrentSmsCharacterName(_0x19e9ff):_0x278c38||'角色':_0x2bfec||_0x278c38||_0x19e9ff||'角色';await showSmsReplyPhoneStyleNotification({'characterId':_0x36ce3a||'','phoneNumber':_0x19e9ff||'','displayName':_0x4ae034,'previewText':String(_0xb29ecd||'')['trim'](),'messages':_0x4af554});}}catch(_0x1a5800){console[_0x285437(0x5d9)]('❌\x20SMS\x20AI回复失败:',_0x1a5800),_0x2f8cfd()&&hideSmsTyping(),showIslandNotification('短信',_0x285437(0x707),_0x285437(0x5d9));}}async function smsRegenerateAIResponse(){const _0x27e4f0=_0x2a6210;try{console[_0x27e4f0(0x40b)](_0x27e4f0(0x567));if(!currentSmsData[_0x27e4f0(0x104)]){showIslandNotification('错误','未找到当前短信会话',_0x27e4f0(0x4fd));return;}if(!currentSmsData[_0x27e4f0(0x219)]||currentSmsData[_0x27e4f0(0x219)][_0x27e4f0(0x73a)]===0x0){showIslandNotification('提示',_0x27e4f0(0x2a6),_0x27e4f0(0x4fd));return;}let _0x1656e3=-0x1;for(let _0x3d883e=currentSmsData[_0x27e4f0(0x219)][_0x27e4f0(0x73a)]-0x1;_0x3d883e>=0x0;_0x3d883e--){const _0x212fa6=currentSmsData[_0x27e4f0(0x219)][_0x3d883e];if(_0x212fa6[_0x27e4f0(0x733)]===_0x27e4f0(0x2c6)){_0x1656e3=_0x3d883e;break;}}if(_0x1656e3===-0x1){showIslandNotification('提示','没有用户消息','info');return;}if(_0x1656e3===currentSmsData[_0x27e4f0(0x219)][_0x27e4f0(0x73a)]-0x1){showIslandNotification('提示','没有AI回复可以重新生成',_0x27e4f0(0x4fd));return;}const _0x492faf=[];for(let _0x498a0f=_0x1656e3+0x1;_0x498a0f<currentSmsData[_0x27e4f0(0x219)][_0x27e4f0(0x73a)];_0x498a0f++){const _0x299ceb=currentSmsData['messages'][_0x498a0f];(_0x299ceb['role']==='assistant'||_0x299ceb[_0x27e4f0(0x733)]===_0x27e4f0(0x450))&&_0x492faf[_0x27e4f0(0x2b9)](_0x299ceb);}console[_0x27e4f0(0x40b)](_0x27e4f0(0x2b0)+_0x492faf[_0x27e4f0(0x73a)]+_0x27e4f0(0x54e));if(_0x492faf[_0x27e4f0(0x73a)]===0x0){showIslandNotification('提示','没有AI回复可以重新生成','info');return;}currentSmsData['messages']=currentSmsData[_0x27e4f0(0x219)]['slice'](0x0,_0x1656e3+0x1),console[_0x27e4f0(0x40b)](_0x27e4f0(0x167),currentSmsData[_0x27e4f0(0x219)]['length']);typeof smsMessages!=='undefined'&&(smsMessages[_0x27e4f0(0x73a)]=0x0,currentSmsData['messages'][_0x27e4f0(0x84c)](_0x476894=>{const _0x5d3ec3=_0x27e4f0;smsMessages['push']({'role':_0x476894[_0x5d3ec3(0x733)],'content':_0x476894[_0x5d3ec3(0x73c)],'timestamp':_0x476894['timestamp']});}),console[_0x27e4f0(0x40b)](_0x27e4f0(0x6fe),smsMessages['length'],'条'));currentSmsData['phoneNumber']&&await saveSmsHistory(currentSmsData[_0x27e4f0(0x104)],currentSmsData[_0x27e4f0(0x219)]);renderSmsMessages(),showIslandNotification('重回',_0x27e4f0(0x5e2)+_0x492faf[_0x27e4f0(0x73a)]+'条AI回复，正在重新生成...','info'),vibrateDevice(),showSmsTyping();const _0x97474e=currentSmsData[_0x27e4f0(0x219)][_0x1656e3];if(_0x97474e){const _0x378086={'content':_0x97474e[_0x27e4f0(0x73c)],'role':_0x27e4f0(0x2c6),'timestamp':_0x97474e[_0x27e4f0(0x5c9)],'sent':![]};if(typeof smsMessages!==_0x27e4f0(0x653)&&smsMessages['length']>0x0){const _0x3bdb2a=smsMessages[smsMessages[_0x27e4f0(0x73a)]-0x1];_0x3bdb2a['role']==='user'&&_0x3bdb2a[_0x27e4f0(0x73c)]===_0x97474e[_0x27e4f0(0x73c)]&&(smsMessages[_0x27e4f0(0x420)](),console[_0x27e4f0(0x40b)](_0x27e4f0(0x4c0)));}const _0x2a2075=await sendMultipleSmsWithAI([_0x378086],{'phoneNumber':currentSmsData[_0x27e4f0(0x104)]});hideSmsTyping();if(_0x2a2075&&_0x2a2075['messages']&&_0x2a2075[_0x27e4f0(0x219)]['length']>0x0){const _0x110c02=getCurrentSmsCharacterName(currentSmsData[_0x27e4f0(0x104)]),_0x47363c=document['getElementById'](_0x27e4f0(0x708));_0x47363c&&_0x110c02&&_0x110c02!==_0x27e4f0(0x4bc)&&(_0x47363c['textContent']=_0x110c02);for(let _0x53038f=0x0;_0x53038f<_0x2a2075[_0x27e4f0(0x219)]['length'];_0x53038f++){const _0x518f6b=_0x2a2075[_0x27e4f0(0x219)][_0x53038f];_0x53038f>0x0&&await new Promise(_0x5a3655=>setTimeout(_0x5a3655,0x12c+Math[_0x27e4f0(0x658)]()*0x1f4)),addSmsMessage(_0x518f6b,'assistant',!![]);}currentSmsData[_0x27e4f0(0x104)]&&await saveSmsHistory(currentSmsData['phoneNumber'],currentSmsData['messages']),console[_0x27e4f0(0x40b)](_0x27e4f0(0x7c7),_0x2a2075['messages']['length'],'条');}else showIslandNotification('提示',_0x27e4f0(0x5cf),_0x27e4f0(0x4fd));}}catch(_0xf516db){console[_0x27e4f0(0x5d9)]('❌\x20[SMS重回]\x20失败:',_0xf516db),hideSmsTyping(),showIslandNotification('错误','重回失败:\x20'+_0xf516db[_0x27e4f0(0x42c)],_0x27e4f0(0x4fd));}}function toggleSmsEditMode(){const _0x1fce3e=_0x2a6210;smsEditMode=!smsEditMode;const _0x512c78=document['getElementById'](_0x1fce3e(0x7f0)),_0x1dacd4=document['getElementById'](_0x1fce3e(0x152)),_0x391dee=document[_0x1fce3e(0x2ba)]('.sms-input-area'),_0x26c356=document['getElementById']('smsMessagesArea');if(smsEditMode){if(_0x512c78)_0x512c78[_0x1fce3e(0x2a1)]='完成';if(_0x1dacd4)_0x1dacd4[_0x1fce3e(0x37e)][_0x1fce3e(0x712)]=_0x1fce3e(0x8b);if(_0x391dee)_0x391dee[_0x1fce3e(0x37e)][_0x1fce3e(0x712)]='none';if(_0x26c356)_0x26c356[_0x1fce3e(0x2af)][_0x1fce3e(0x2a8)](_0x1fce3e(0x406));smsSelectedMessages['clear'](),console['log'](_0x1fce3e(0x3d3));}else{if(_0x512c78)_0x512c78[_0x1fce3e(0x2a1)]=_0x1fce3e(0x2cf);if(_0x1dacd4)_0x1dacd4[_0x1fce3e(0x37e)][_0x1fce3e(0x712)]='none';if(_0x391dee)_0x391dee[_0x1fce3e(0x37e)][_0x1fce3e(0x712)]=_0x1fce3e(0x8b);if(_0x26c356)_0x26c356['classList'][_0x1fce3e(0x5e8)]('sms-edit-mode');smsSelectedMessages[_0x1fce3e(0x20d)](),console[_0x1fce3e(0x40b)](_0x1fce3e(0x4f8));}renderSmsMessages(),updateSmsEditToolbar();}function toggleSmsMessageSelection(_0x187795){const _0x2d6dab=_0x2a6210;if(!smsEditMode)return;smsSelectedMessages[_0x2d6dab(0x17f)](_0x187795)?smsSelectedMessages[_0x2d6dab(0xfc)](_0x187795):smsSelectedMessages['add'](_0x187795);console[_0x2d6dab(0x40b)](_0x2d6dab(0x44d),Array['from'](smsSelectedMessages));const _0x306939=document[_0x2d6dab(0x550)](_0x2d6dab(0x20e));if(_0x306939){const _0x25cfe1=_0x306939[_0x2d6dab(0x2ba)](_0x2d6dab(0x586)+_0x187795+'\x22]');if(_0x25cfe1){const _0x45d4a3=_0x25cfe1[_0x2d6dab(0x2ba)](_0x2d6dab(0x5fe));_0x45d4a3&&(smsSelectedMessages[_0x2d6dab(0x17f)](_0x187795)?_0x45d4a3[_0x2d6dab(0x2af)][_0x2d6dab(0x2a8)]('checked'):_0x45d4a3['classList'][_0x2d6dab(0x5e8)](_0x2d6dab(0x3d5)));}}updateSmsEditToolbar();}function smsSelectAll(){const _0x3be412=_0x2a6210;if(!smsEditMode)return;const _0x5dabe7=currentSmsData['messages'][_0x3be412(0x73a)];if(smsSelectedMessages[_0x3be412(0x719)]===_0x5dabe7)smsSelectedMessages[_0x3be412(0x20d)](),console[_0x3be412(0x40b)](_0x3be412(0x15d));else{smsSelectedMessages['clear']();for(let _0x783da=0x0;_0x783da<_0x5dabe7;_0x783da++){smsSelectedMessages[_0x3be412(0x2a8)](_0x783da);}console[_0x3be412(0x40b)](_0x3be412(0x5a1),smsSelectedMessages['size'],'条');}renderSmsMessages(),updateSmsEditToolbar();}function updateSmsEditToolbar(){const _0xa56ff9=_0x2a6210;if(!smsEditMode)return;const _0x132a08=document[_0xa56ff9(0x550)]('smsSelectAllBtn'),_0x5d0f6a=document[_0xa56ff9(0x550)]('smsDeleteBtn'),_0x53817f=document['getElementById'](_0xa56ff9(0x218)),_0x3cdcc1=smsSelectedMessages[_0xa56ff9(0x719)],_0x255b49=currentSmsData['messages'][_0xa56ff9(0x73a)];if(_0x132a08){const _0x588a65=_0x132a08[_0xa56ff9(0x2ba)]('span');_0x588a65&&(_0x588a65[_0xa56ff9(0x2a1)]=_0x3cdcc1===_0x255b49?_0xa56ff9(0x5a8):'全选');}_0x5d0f6a&&(_0x5d0f6a['disabled']=_0x3cdcc1===0x0),_0x53817f&&(_0x53817f[_0xa56ff9(0x2a1)]=_0x3cdcc1>0x0?'删除\x20('+_0x3cdcc1+')':'删除');}async function smsDeleteSelected(){const _0x444932=_0x2a6210;if(!smsEditMode||smsSelectedMessages[_0x444932(0x719)]===0x0)return;const _0x9978f2=smsSelectedMessages[_0x444932(0x719)];if(!confirm('确定要删除\x20'+_0x9978f2+_0x444932(0x19b)))return;try{console[_0x444932(0x40b)]('📱\x20[SMS删除]\x20开始删除',_0x9978f2,_0x444932(0x156));const _0x226b7a=Array['from'](smsSelectedMessages)['sort']((_0x225d42,_0x5c8a20)=>_0x5c8a20-_0x225d42);_0x226b7a[_0x444932(0x84c)](_0x3f070a=>{const _0x40c2bc=_0x444932;_0x3f070a>=0x0&&_0x3f070a<currentSmsData[_0x40c2bc(0x219)][_0x40c2bc(0x73a)]&&currentSmsData[_0x40c2bc(0x219)]['splice'](_0x3f070a,0x1);}),console[_0x444932(0x40b)](_0x444932(0x2d1),currentSmsData[_0x444932(0x219)][_0x444932(0x73a)],'条'),typeof smsMessages!=='undefined'&&(smsMessages[_0x444932(0x73a)]=0x0,currentSmsData[_0x444932(0x219)][_0x444932(0x84c)](_0x4ba3f0=>{const _0x90acb1=_0x444932;smsMessages[_0x90acb1(0x2b9)]({'role':_0x4ba3f0[_0x90acb1(0x733)],'content':_0x4ba3f0[_0x90acb1(0x73c)],'timestamp':_0x4ba3f0[_0x90acb1(0x5c9)]});}),console['log'](_0x444932(0x227),smsMessages[_0x444932(0x73a)],'条')),currentSmsData[_0x444932(0x104)]&&(await saveSmsHistory(currentSmsData[_0x444932(0x104)],currentSmsData[_0x444932(0x219)]),console[_0x444932(0x40b)]('✅\x20[SMS删除]\x20已保存到数据库')),smsSelectedMessages[_0x444932(0x20d)](),renderSmsMessages(),currentSmsData[_0x444932(0x219)]['length']===0x0?toggleSmsEditMode():updateSmsEditToolbar(),showIslandNotification('删除',_0x444932(0x63e)+_0x9978f2+'\x20条消息',_0x444932(0x1f1)),vibrateDevice();}catch(_0x425382){console[_0x444932(0x5d9)](_0x444932(0x543),_0x425382),showIslandNotification('错误',_0x444932(0x462)+_0x425382[_0x444932(0x42c)],_0x444932(0x5d9));}}function handleSmsKeyPress(_0x49d3e2){const _0x3039e3=_0x2a6210;_0x49d3e2['key']===_0x3039e3(0x53b)&&!_0x49d3e2[_0x3039e3(0x78f)]&&(_0x49d3e2['preventDefault'](),addUserSmsMessage());}function formatSmsDate(_0x6ff052){const _0x4cd480=_0x2a6210,_0x2b0a50=new Date(),_0xf4285a=new Date(_0x2b0a50[_0x4cd480(0x2ad)](),_0x2b0a50[_0x4cd480(0x113)](),_0x2b0a50['getDate']()),_0x4b8498=new Date(_0xf4285a[_0x4cd480(0x4e0)]()-0x18*0x3c*0x3c*0x3e8),_0x2d3fc7=new Date(_0x6ff052[_0x4cd480(0x2ad)](),_0x6ff052['getMonth'](),_0x6ff052[_0x4cd480(0x7d8)]());if(_0x2d3fc7[_0x4cd480(0x4e0)]()===_0xf4285a['getTime']())return _0x4cd480(0x400)+formatSmsTime(_0x6ff052);else{if(_0x2d3fc7[_0x4cd480(0x4e0)]()===_0x4b8498[_0x4cd480(0x4e0)]())return'Yesterday\x20'+formatSmsTime(_0x6ff052);else{const _0x3abfe7={'month':'short','day':_0x4cd480(0x5cd),'year':_0x4cd480(0x5cd)};return _0x6ff052[_0x4cd480(0x13e)](_0x4cd480(0x206),_0x3abfe7)+'\x20'+formatSmsTime(_0x6ff052);}}}function formatSmsTime(_0x328da9){const _0x3b48ae=_0x2a6210;return _0x328da9['toLocaleTimeString'](_0x3b48ae(0x206),{'hour':_0x3b48ae(0x5cd),'minute':'2-digit','hour12':!![]});}function scrollSmsToBottom(){const _0x4ebff2=_0x2a6210,_0x1f4d51=document['getElementById'](_0x4ebff2(0x20e));_0x1f4d51&&(_0x1f4d51['scrollTop']=_0x1f4d51['scrollHeight']);}function smsCallContact(){const _0x40d117=_0x2a6210;if(!currentSmsData[_0x40d117(0x104)])return;console[_0x40d117(0x40b)](_0x40d117(0x1d3),currentSmsData[_0x40d117(0x104)]);const _0x9e7f25=currentSmsData['phoneNumber'];closeSmsDetail(),phoneCurrentNumber=_0x9e7f25,updatePhoneDisplay(),switchPhoneTab('keypad');}function smsFaceTimeContact(){const _0x2cc7e7=_0x2a6210;if(!currentSmsData[_0x2cc7e7(0x104)])return;console[_0x2cc7e7(0x40b)]('📱\x20SMS\x20FaceTime:',currentSmsData[_0x2cc7e7(0x104)]),showIslandNotification('FaceTime','功能开发中...','info');}async function smsViewContact(){const _0x5470a8=_0x2a6210;if(!currentSmsData['phoneNumber'])return;console[_0x5470a8(0x40b)](_0x5470a8(0x774),currentSmsData['phoneNumber']);let _0xaaba27=null;try{const _0x34720d=normalizeId(currentSmsData['phoneNumber']),_0x3858ac=await db[_0x5470a8(0x33c)][_0x5470a8(0x60f)](_0x34720d);if(_0x3858ac&&_0x3858ac[_0x5470a8(0x4c8)])_0xaaba27=_0x3858ac[_0x5470a8(0x4c8)],console[_0x5470a8(0x40b)]('👤\x20从联系人读取人设:',_0xaaba27['name'],'|',_0xaaba27[_0x5470a8(0x239)]);else{const _0x116a29=await db[_0x5470a8(0x3d8)]['toArray'](),_0xb6d0ca=_0x116a29[_0x5470a8(0x6bf)](_0x1a0aee=>normalizeId(_0x1a0aee[_0x5470a8(0x104)])===_0x34720d&&_0x1a0aee[_0x5470a8(0x816)]===!![]&&_0x1a0aee[_0x5470a8(0x356)]);_0xb6d0ca&&_0xb6d0ca[_0x5470a8(0x356)]?(_0xaaba27=_0xb6d0ca[_0x5470a8(0x356)],console[_0x5470a8(0x40b)]('👤\x20从短信记录读取人设:',_0xaaba27[_0x5470a8(0x189)],'|',_0xaaba27[_0x5470a8(0x239)])):console[_0x5470a8(0x40b)](_0x5470a8(0x4cd));}}catch(_0xbc0aed){console[_0x5470a8(0x5d9)](_0x5470a8(0x5ba),_0xbc0aed);}newContactTempData={'phoneNumber':currentSmsData[_0x5470a8(0x104)],'customAvatar':null,'characterId':null,'characterAvatar':null,'strangerPersona':_0xaaba27,'isStranger':!!_0xaaba27},showNewContactModal();}function smsAttachImage(){const _0x134af7=_0x2a6210;console[_0x134af7(0x40b)](_0x134af7(0x345)),showIslandNotification('附加图片',_0x134af7(0x39f),_0x134af7(0x4fd));}function showSmsTyping(){const _0x35f837=_0x2a6210,_0x180ae2=document[_0x35f837(0x550)](_0x35f837(0x67d));if(_0x180ae2)_0x180ae2['classList'][_0x35f837(0x2a8)](_0x35f837(0x763));scrollSmsToBottom();}function hideSmsTyping(){const _0x38b7d6=_0x2a6210,_0x33a026=document[_0x38b7d6(0x550)](_0x38b7d6(0x67d));if(_0x33a026)_0x33a026['classList']['remove'](_0x38b7d6(0x763));}function escapeHtml(_0x38b619){const _0x542c6d=_0x2a6210,_0x5aabd9=document['createElement']('div');return _0x5aabd9['textContent']=_0x38b619,_0x5aabd9[_0x542c6d(0x63f)];}async function loadSmsHistory(_0x4f7aab){const _0x1d852c=_0x2a6210;try{console[_0x1d852c(0x40b)](_0x1d852c(0x857),_0x4f7aab);const _0x20f701=normalizeId(_0x4f7aab),_0x509bb1=_0x1d852c(0x835)+_0x20f701,_0x41593e=await db[_0x1d852c(0x3d8)][_0x1d852c(0x651)](),_0x453c26=_0x41593e[_0x1d852c(0x34c)](_0x1f4c05=>{const _0x33a0bb=_0x1d852c,_0x181425=normalizeId(_0x1f4c05[_0x33a0bb(0x64b)])===_0x509bb1;return _0x181425;})['sort']((_0xd17c81,_0x363c94)=>new Date(_0xd17c81[_0x1d852c(0x5c9)])[_0x1d852c(0x4e0)]()-new Date(_0x363c94[_0x1d852c(0x5c9)])[_0x1d852c(0x4e0)]());console[_0x1d852c(0x40b)](_0x1d852c(0x831),_0x453c26[_0x1d852c(0x73a)],'条');const _0x197555=currentSmsData&&normalizeId(currentSmsData['phoneNumber']||'')===_0x20f701;_0x197555&&(currentSmsData[_0x1d852c(0x219)][_0x1d852c(0x73a)]=0x0);const _0x535753=[];_0x453c26[_0x1d852c(0x84c)](_0x5d1a04=>{const _0x3c9fef=_0x1d852c,_0x244025=new Date(_0x5d1a04[_0x3c9fef(0x5c9)])['getTime']();_0x197555&&currentSmsData[_0x3c9fef(0x219)]['push']({'content':_0x5d1a04[_0x3c9fef(0x73c)],'role':_0x5d1a04[_0x3c9fef(0x733)],'timestamp':_0x244025,'sent':!![]}),_0x535753[_0x3c9fef(0x2b9)]({'role':_0x5d1a04[_0x3c9fef(0x733)],'content':_0x5d1a04['content'],'timestamp':_0x244025});});if(typeof setSmsSessionMessages===_0x1d852c(0x88))setSmsSessionMessages(_0x4f7aab,_0x535753);else _0x197555&&typeof smsMessages!==_0x1d852c(0x653)&&(smsMessages[_0x1d852c(0x73a)]=0x0,_0x535753['forEach'](_0x298e1c=>smsMessages[_0x1d852c(0x2b9)]({..._0x298e1c})));return _0x453c26;}catch(_0x1d16e3){return console['error'](_0x1d852c(0x205),_0x1d16e3),[];}}async function saveSmsHistory(_0x564c32,_0x353d3e){const _0x57c81a=_0x2a6210;try{console['log'](_0x57c81a(0x1fb),_0x564c32,_0x353d3e['length'],'条');const _0x526ceb=normalizeId(_0x564c32),_0x53cce3='sms_'+_0x526ceb,_0x44955a=typeof currentSmsCharacterId!==_0x57c81a(0x653)?currentSmsCharacterId:_0x57c81a(0x36b),_0x16c9e8=await db[_0x57c81a(0x3d8)]['toArray'](),_0x477ad0=_0x16c9e8[_0x57c81a(0x34c)](_0x34584c=>normalizeId(_0x34584c[_0x57c81a(0x64b)])===_0x53cce3)[_0x57c81a(0x444)](_0x56f3b2=>_0x56f3b2['id']);_0x477ad0[_0x57c81a(0x73a)]>0x0&&(await db[_0x57c81a(0x3d8)]['bulkDelete'](_0x477ad0),console['log'](_0x57c81a(0x81a),_0x477ad0[_0x57c81a(0x73a)],'条'));const _0x5a44f3=_0x353d3e[_0x57c81a(0x444)](_0x17c9f9=>({'characterId':normalizeId(_0x44955a),'sessionId':_0x53cce3,'role':_0x17c9f9['role'],'content':_0x17c9f9[_0x57c81a(0x73c)],'timestamp':new Date(_0x17c9f9[_0x57c81a(0x5c9)])[_0x57c81a(0x442)](),'type':_0x57c81a(0x212)}));return await db['chatMessages'][_0x57c81a(0x100)](_0x5a44f3),console[_0x57c81a(0x40b)](_0x57c81a(0x1a1),_0x5a44f3[_0x57c81a(0x73a)],'条'),!![];}catch(_0x2d4b8a){return console['error']('❌\x20保存短信历史失败:',_0x2d4b8a),![];}}function callContact(){const _0x419e76=_0x2a6210;if(!currentContactData)return;const _0x464c53=currentContactData[_0x419e76(0x104)];console[_0x419e76(0x40b)](_0x419e76(0x861),_0x464c53),hideContactDetail(),setTimeout(()=>{phoneCurrentNumber=_0x464c53,updatePhoneDisplay(),switchPhoneTab('keypad'),makePhoneCall();},0x190);}let newContactTempData={'phoneNumber':'','customAvatar':null,'characterId':null,'characterAvatar':null,'strangerPersona':null,'isStranger':![]};async function createNewContact(){const _0x3a0da5=_0x2a6210;if(!currentContactData)return;console['log'](_0x3a0da5(0xd7),currentContactData[_0x3a0da5(0x104)]),newContactTempData={'phoneNumber':currentContactData[_0x3a0da5(0x104)],'customAvatar':null,'characterId':currentContactData[_0x3a0da5(0x848)]||null,'characterAvatar':currentContactData[_0x3a0da5(0x7c4)]||null,'strangerPersona':null,'isStranger':![]};const _0x4d9b21=await db[_0x3a0da5(0x99)]['where']('phoneNumber')[_0x3a0da5(0x630)](currentContactData['phoneNumber'])[_0x3a0da5(0x6d5)]()[_0x3a0da5(0x244)]();_0x4d9b21&&(console[_0x3a0da5(0x40b)](_0x3a0da5(0x7c9),_0x4d9b21),_0x4d9b21[_0x3a0da5(0x3d9)]&&_0x4d9b21['strangerPersona']&&(newContactTempData[_0x3a0da5(0x3d9)]=!![],newContactTempData[_0x3a0da5(0x4c8)]=_0x4d9b21['strangerPersona'],console[_0x3a0da5(0x40b)](_0x3a0da5(0x4a2),_0x4d9b21['strangerPersona'])),_0x4d9b21[_0x3a0da5(0x848)]&&!newContactTempData[_0x3a0da5(0x848)]&&(newContactTempData['characterId']=_0x4d9b21[_0x3a0da5(0x848)]),_0x4d9b21['characterAvatar']&&!newContactTempData[_0x3a0da5(0x7c4)]&&(newContactTempData[_0x3a0da5(0x7c4)]=_0x4d9b21[_0x3a0da5(0x7c4)]));const _0x4aab2a=await db[_0x3a0da5(0x33c)][_0x3a0da5(0x60f)](currentContactData[_0x3a0da5(0x104)]);if(_0x4aab2a){const _0x37e090=_0x4aab2a[_0x3a0da5(0x18b)]===!![],_0x1458a9=!!_0x4aab2a[_0x3a0da5(0x848)],_0xd6e441=_0x4aab2a[_0x3a0da5(0x619)]===![];if(_0x37e090||_0x1458a9||_0xd6e441){showIslandNotification(_0x3a0da5(0x30a),'这已经是你的联系人了',_0x3a0da5(0x4fd));return;}!newContactTempData[_0x3a0da5(0x3d9)]&&_0x4aab2a[_0x3a0da5(0x3d9)]&&_0x4aab2a[_0x3a0da5(0x4c8)]&&(newContactTempData[_0x3a0da5(0x3d9)]=!![],newContactTempData[_0x3a0da5(0x4c8)]=_0x4aab2a['strangerPersona']),!newContactTempData[_0x3a0da5(0x7c4)]&&_0x4aab2a['contactAvatar']&&(newContactTempData[_0x3a0da5(0x7c4)]=_0x4aab2a[_0x3a0da5(0x4af)]);}showNewContactModal();}function showNewContactModal(){const _0x4d475a=_0x2a6210,_0x51e9b1=document[_0x4d475a(0x550)](_0x4d475a(0x24d));if(!_0x51e9b1)return;const _0xf495af=document['getElementById'](_0x4d475a(0x32c));_0xf495af&&(_0xf495af[_0x4d475a(0x4cf)]=formatPhoneNumberDisplay(newContactTempData['phoneNumber']));const _0x1ed448=document[_0x4d475a(0x550)](_0x4d475a(0x4fc));_0x1ed448&&(_0x1ed448[_0x4d475a(0x4cf)]='',currentContactData&&currentContactData[_0x4d475a(0x1db)]&&!newContactTempData[_0x4d475a(0x3d9)]&&(_0x1ed448['value']=currentContactData['characterName']));const _0x3cb518=document[_0x4d475a(0x550)](_0x4d475a(0x42f));if(_0x3cb518){if(newContactTempData['characterAvatar'])_0x3cb518['innerHTML']=_0x4d475a(0x23a)+newContactTempData['characterAvatar']+_0x4d475a(0x4dc);else{if(newContactTempData[_0x4d475a(0x3d9)]&&newContactTempData[_0x4d475a(0x4c8)]){const _0x366884=newContactTempData[_0x4d475a(0x4c8)][_0x4d475a(0x189)]||'?',_0x3326ab=_0x366884['charAt'](0x0);_0x3cb518[_0x4d475a(0x63f)]=_0x3326ab;}else _0x3cb518[_0x4d475a(0x63f)]=_0x4d475a(0x635);}}const _0x151cf3=document['getElementById'](_0x4d475a(0x159)),_0x55543b=document[_0x4d475a(0x550)](_0x4d475a(0x773)),_0x54345e=document[_0x4d475a(0x550)](_0x4d475a(0x333)),_0x5dae58=document['getElementById']('newContactCharacterName');if(newContactTempData['isStranger']&&newContactTempData[_0x4d475a(0x4c8)]){const _0x51f891=newContactTempData[_0x4d475a(0x4c8)];_0x151cf3&&_0x55543b&&(_0x151cf3[_0x4d475a(0x37e)][_0x4d475a(0x712)]='block',_0x55543b['value']=_0x51f891['name']||'未知');if(_0x54345e)_0x54345e[_0x4d475a(0x37e)][_0x4d475a(0x712)]=_0x4d475a(0x22e);}else{if(newContactTempData[_0x4d475a(0x848)]){if(_0x151cf3)_0x151cf3[_0x4d475a(0x37e)][_0x4d475a(0x712)]=_0x4d475a(0x22e);_0x54345e&&_0x5dae58&&(_0x54345e[_0x4d475a(0x37e)][_0x4d475a(0x712)]='block',_0x5dae58[_0x4d475a(0x2a1)]=currentContactData&&currentContactData[_0x4d475a(0x1db)]||'未知角色');}else{if(_0x151cf3)_0x151cf3[_0x4d475a(0x37e)][_0x4d475a(0x712)]=_0x4d475a(0x22e);if(_0x54345e)_0x54345e[_0x4d475a(0x37e)]['display']='none';}}_0x51e9b1[_0x4d475a(0x2af)]['add'](_0x4d475a(0x763));}function closeNewContactModal(){const _0x27b059=_0x2a6210,_0x6c2eb=document[_0x27b059(0x550)](_0x27b059(0x24d));if(_0x6c2eb)_0x6c2eb['classList'][_0x27b059(0x5e8)](_0x27b059(0x763));newContactTempData={'phoneNumber':'','customAvatar':null,'characterId':null,'characterAvatar':null,'strangerPersona':null,'isStranger':![]};}function triggerNewContactAvatarUpload(){const _0x3a3aa4=_0x2a6210,_0x4f4907=document[_0x3a3aa4(0x550)](_0x3a3aa4(0x10a));if(_0x4f4907)_0x4f4907[_0x3a3aa4(0x810)]();}function handleNewContactAvatarUpload(_0x4dae23){const _0x2a3ce3=_0x2a6210,_0x575ad3=_0x4dae23['target']['files'][0x0];if(!_0x575ad3)return;if(!_0x575ad3['type']['startsWith'](_0x2a3ce3(0x2d9))){showIslandNotification('错误','请选择图片文件','error');return;}if(_0x575ad3[_0x2a3ce3(0x719)]>0x5*0x400*0x400){showIslandNotification('错误',_0x2a3ce3(0x1f2),_0x2a3ce3(0x5d9));return;}const _0x574b55=new FileReader();_0x574b55[_0x2a3ce3(0x1b3)]=function(_0x3711b8){const _0x2ad0ed=_0x2a3ce3,_0x1d9af2=_0x3711b8[_0x2ad0ed(0x66d)]['result'];newContactTempData[_0x2ad0ed(0x80e)]=_0x1d9af2;const _0x5e38ab=document[_0x2ad0ed(0x550)](_0x2ad0ed(0x42f));_0x5e38ab&&(_0x5e38ab['innerHTML']=_0x2ad0ed(0x23a)+_0x1d9af2+'\x22\x20alt=\x22头像\x22>'),console[_0x2ad0ed(0x40b)](_0x2ad0ed(0x519));},_0x574b55[_0x2a3ce3(0x77c)](_0x575ad3);}async function saveNewContact(){const _0x5ba45d=_0x2a6210,_0x51c420=document[_0x5ba45d(0x550)](_0x5ba45d(0x4fc));let _0x3ec7b5=_0x51c420?_0x51c420[_0x5ba45d(0x4cf)]['trim']():'';if(!_0x3ec7b5){if(newContactTempData[_0x5ba45d(0x3d9)]&&newContactTempData['strangerPersona'])_0x3ec7b5=newContactTempData[_0x5ba45d(0x4c8)][_0x5ba45d(0x189)]||'';else currentContactData&&currentContactData[_0x5ba45d(0x1db)]&&(_0x3ec7b5=currentContactData['characterName']);if(!_0x3ec7b5){showIslandNotification('错误',_0x5ba45d(0x6fa),'error');return;}}try{const _0x30b7cd={'phoneNumber':newContactTempData[_0x5ba45d(0x104)],'nickname':_0x3ec7b5,'contactAvatar':newContactTempData[_0x5ba45d(0x80e)]||newContactTempData['characterAvatar']||null,'characterId':newContactTempData[_0x5ba45d(0x848)]||null,'strangerPersona':newContactTempData['strangerPersona']||null,'isStranger':newContactTempData[_0x5ba45d(0x3d9)]||![],'isUserSavedContact':!![],'hiddenInContactsList':![],'createdAt':Date['now']()};await db['contacts'][_0x5ba45d(0x748)](_0x30b7cd),console[_0x5ba45d(0x40b)](_0x5ba45d(0x9c),_0x30b7cd),closeNewContactModal(),await refreshContactDetailAfterSave(),showIslandNotification('成功',_0x5ba45d(0x3cf),_0x5ba45d(0x1f1));}catch(_0x4fc138){console[_0x5ba45d(0x5d9)](_0x5ba45d(0x72a),_0x4fc138),showIslandNotification('错误',_0x5ba45d(0x618),_0x5ba45d(0x5d9));}}async function refreshContactDetailAfterSave(){const _0x5dd803=_0x2a6210;if(!currentContactData)return;const _0x5af23f=await db[_0x5dd803(0x33c)][_0x5dd803(0x60f)](currentContactData[_0x5dd803(0x104)]);if(!_0x5af23f)return;currentContactData[_0x5dd803(0x793)]=!![],currentContactData[_0x5dd803(0x3d9)]=_0x5af23f['isStranger']||![],currentContactData[_0x5dd803(0x4c8)]=_0x5af23f[_0x5dd803(0x4c8)]||null,currentContactData[_0x5dd803(0x1db)]=_0x5af23f[_0x5dd803(0x561)],currentContactData['characterAvatar']=_0x5af23f[_0x5dd803(0x4af)]||currentContactData['characterAvatar'],console[_0x5dd803(0x40b)](_0x5dd803(0x32b),currentContactData['isStranger']);const _0x5b8d04=document[_0x5dd803(0x550)](_0x5dd803(0x7a7));_0x5b8d04&&(_0x5b8d04['textContent']='联系人');const _0x25a3ab=document[_0x5dd803(0x550)]('contactDetailLabel');_0x25a3ab&&(_0x25a3ab[_0x5dd803(0x2a1)]=_0x5af23f[_0x5dd803(0x561)]);if(_0x5af23f['contactAvatar']){const _0x29e63b=document['getElementById'](_0x5dd803(0x5d8));_0x29e63b&&(_0x29e63b[_0x5dd803(0x63f)]=_0x5dd803(0x23a)+_0x5af23f[_0x5dd803(0x4af)]+_0x5dd803(0x41d));}const _0xdb6d6d=document[_0x5dd803(0x550)](_0x5dd803(0x536)),_0x3f5f91=document[_0x5dd803(0x550)](_0x5dd803(0x72c));_0xdb6d6d&&(currentContactData[_0x5dd803(0x793)]?_0xdb6d6d[_0x5dd803(0x37e)]['display']=_0x5dd803(0x8b):_0xdb6d6d[_0x5dd803(0x37e)][_0x5dd803(0x712)]=_0x5dd803(0x22e)),_0x3f5f91&&(currentContactData['isStranger']&&currentContactData[_0x5dd803(0x4c8)]?(_0x3f5f91[_0x5dd803(0x37e)]['display']=_0x5dd803(0x8b),console[_0x5dd803(0x40b)](_0x5dd803(0x354))):_0x3f5f91[_0x5dd803(0x37e)][_0x5dd803(0x712)]=_0x5dd803(0x22e));}function addToExistingContact(){const _0x225fb6=_0x2a6210;if(!currentContactData)return;console[_0x225fb6(0x40b)]('📱\x20Add\x20to\x20existing\x20contact:',currentContactData[_0x225fb6(0x104)]),showIslandNotification('添加联系人',_0x225fb6(0x39f),_0x225fb6(0x4fd));}function shareContact(){const _0x1300d0=_0x2a6210;if(!currentContactData)return;console['log']('📱\x20Share\x20contact:',currentContactData[_0x1300d0(0x104)]),showIslandNotification(_0x1300d0(0x4bd),'功能开发中...',_0x1300d0(0x4fd));}function blockNumber(){const _0x15b8df=_0x2a6210;if(!currentContactData)return;console[_0x15b8df(0x40b)]('📱\x20Block\x20number:',currentContactData[_0x15b8df(0x104)]),showIslandNotification('屏蔽号码','功能开发中...','info');}async function deleteStrangerNumber(){const _0x48b9cd=_0x2a6210;if(!currentContactData)return;if(!currentContactData[_0x48b9cd(0x3d9)]||!currentContactData[_0x48b9cd(0x4c8)]){showIslandNotification('错误',_0x48b9cd(0x4b9),_0x48b9cd(0x5d9));return;}const _0x449f44=currentContactData[_0x48b9cd(0x104)],_0x1717b7=currentContactData[_0x48b9cd(0x4c8)][_0x48b9cd(0x189)]||_0x449f44;if(!confirm('确定要删除此号码\x20\x22'+_0x449f44+'\x22\x20吗？\x0a\x0a这是随机陌生人\x20\x22'+_0x1717b7+'\x22，删除后：\x0a-\x20该号码的所有数据将被清除\x0a-\x20再次拨打此号码会生成新的随机人设\x0a-\x20此操作无法撤销！'))return;try{console[_0x48b9cd(0x40b)](_0x48b9cd(0xbc),_0x449f44,_0x48b9cd(0x14d),_0x1717b7);let _0x551e2c=0x0;await db[_0x48b9cd(0x33c)][_0x48b9cd(0xfc)](_0x449f44),console['log'](_0x48b9cd(0x78e)),_0x551e2c++;if(db[_0x48b9cd(0x99)]){const _0x261aea=await db['callRecords'][_0x48b9cd(0x651)](),_0x5b6080=_0x261aea[_0x48b9cd(0x34c)](_0x24b934=>normalizeId(_0x24b934['phoneNumber'])===normalizeId(_0x449f44));for(const _0x2d78e5 of _0x5b6080){await db[_0x48b9cd(0x99)][_0x48b9cd(0xfc)](_0x2d78e5['id']);}console[_0x48b9cd(0x40b)](_0x48b9cd(0x20c)+_0x5b6080[_0x48b9cd(0x73a)]+'\x20条'),_0x551e2c+=_0x5b6080[_0x48b9cd(0x73a)];}if(db[_0x48b9cd(0x3d8)]){const _0x226317=await db[_0x48b9cd(0x3d8)][_0x48b9cd(0x651)](),_0x18204b=_0x226317[_0x48b9cd(0x34c)](_0x38f8fd=>normalizeId(_0x38f8fd[_0x48b9cd(0x104)])===normalizeId(_0x449f44)&&(_0x38f8fd[_0x48b9cd(0x1e9)]==='call'||_0x38f8fd['type']===_0x48b9cd(0x212)));for(const _0x1bbce7 of _0x18204b){await db[_0x48b9cd(0x3d8)][_0x48b9cd(0xfc)](_0x1bbce7['id']);}console[_0x48b9cd(0x40b)]('✅\x20已删除chatMessages:\x20'+_0x18204b['length']+'\x20条'),_0x551e2c+=_0x18204b[_0x48b9cd(0x73a)];}hideContactDetail(),console[_0x48b9cd(0x40b)]('🔄\x20刷新phone相关界面');typeof renderContactsList===_0x48b9cd(0x88)&&await renderContactsList();if(typeof loadCallRecords==='function')await loadCallRecords();else typeof renderCallRecords===_0x48b9cd(0x88)&&(allCallRecordsCache=(allCallRecordsCache||[])[_0x48b9cd(0x34c)](_0x1f51ec=>normalizeId(_0x1f51ec?.[_0x48b9cd(0x104)])!==normalizeId(_0x449f44)),await renderCallRecords());showIslandNotification('删除成功',_0x48b9cd(0x47c)+_0x449f44+_0x48b9cd(0xa7)+_0x551e2c+'条）','info');}catch(_0x2a16d1){console[_0x48b9cd(0x5d9)](_0x48b9cd(0x85d),_0x2a16d1),showIslandNotification(_0x48b9cd(0x453),_0x48b9cd(0x79c),_0x48b9cd(0x5d9));}}async function deleteCurrentContact(){const _0x4fd976=_0x2a6210;if(!currentContactData)return;if(!currentContactData['isContact']){showIslandNotification('错误','该号码不是联系人',_0x4fd976(0x5d9));return;}const _0x34a202=currentContactData[_0x4fd976(0x104)],_0x2424be=currentContactData[_0x4fd976(0x1db)]||_0x34a202;if(!confirm(_0x4fd976(0x8a)+_0x2424be+_0x4fd976(0x11e)))return;try{console[_0x4fd976(0x40b)](_0x4fd976(0x81e),_0x34a202),await db['contacts']['delete'](_0x34a202),console['log']('✅\x20已从contacts表删除联系人'),currentContactData['isContact']=![],currentContactData[_0x4fd976(0x1db)]=currentContactData[_0x4fd976(0x4f5)]?.[0x0]?.[_0x4fd976(0x1db)]||null;const _0x5d2714=document[_0x4fd976(0x550)](_0x4fd976(0x536));_0x5d2714&&(_0x5d2714[_0x4fd976(0x37e)]['display']=_0x4fd976(0x22e));const _0x41a2ce=document[_0x4fd976(0x550)]('contactDetailStatus');if(_0x41a2ce)_0x41a2ce['textContent']='未知';const _0x4768b6=document['getElementById'](_0x4fd976(0x2f5));_0x4768b6&&!currentContactData['characterName']&&(_0x4768b6['textContent']=_0x4fd976(0x829)),console[_0x4fd976(0x40b)]('🔄\x20刷新phone-contacts页面'),setTimeout(()=>{const _0x35ae7d=_0x4fd976;typeof renderContactsList===_0x35ae7d(0x88)&&renderContactsList(),typeof renderCallRecords===_0x35ae7d(0x88)&&renderCallRecords();},0x12c),showIslandNotification(_0x4fd976(0x165),'已删除联系人\x20\x22'+_0x2424be+'\x22',_0x4fd976(0x4fd));}catch(_0x1f9ddf){console['error'](_0x4fd976(0x7b7),_0x1f9ddf),showIslandNotification('删除失败',_0x4fd976(0x79c),_0x4fd976(0x5d9));}}function formatCallTime(_0x4febcc){const _0x1bcf79=_0x2a6210;if(!_0x4febcc)return'--:--';const _0xeb91b4=new Date(_0x4febcc);if(isNaN(_0xeb91b4['getTime']()))return'--:--';const _0x1073fc=new Date(),_0x1f315a=new Date(_0x1073fc['getFullYear'](),_0x1073fc[_0x1bcf79(0x113)](),_0x1073fc[_0x1bcf79(0x7d8)]()),_0x5dacc4=new Date(_0x1f315a);_0x5dacc4['setDate'](_0x5dacc4[_0x1bcf79(0x7d8)]()-0x1);if(_0xeb91b4>=_0x1f315a){const _0x474401=String(_0xeb91b4[_0x1bcf79(0x859)]())[_0x1bcf79(0x6a6)](0x2,'0'),_0x4dc34a=String(_0xeb91b4['getMinutes']())[_0x1bcf79(0x6a6)](0x2,'0');return _0x474401+':'+_0x4dc34a;}else{if(_0xeb91b4>=_0x5dacc4)return'昨天';else{const _0x516a30=_0xeb91b4['getMonth']()+0x1,_0x5aadfc=_0xeb91b4['getDate']();return _0x516a30+'月'+_0x5aadfc+'日';}}}function formatCallDuration(_0x35bb40){const _0x5846d5=_0x2a6210;if(!_0x35bb40||_0x35bb40===0x0)return _0x5846d5(0xf9);const _0x449ff5=Math['floor'](_0x35bb40/0x3c),_0x34e125=_0x35bb40%0x3c;return _0x449ff5+':'+String(_0x34e125)[_0x5846d5(0x6a6)](0x2,'0');}function redialPhoneNumber(_0x258ad8){const _0x4bb35d=_0x2a6210;console[_0x4bb35d(0x40b)](_0x4bb35d(0x855),_0x258ad8),switchPhoneTab('keypad'),phoneCurrentNumber=_0x258ad8,updatePhoneDisplay(),document[_0x4bb35d(0x854)](_0x4bb35d(0x360))['forEach'](_0x59cde4=>_0x59cde4[_0x4bb35d(0x2af)][_0x4bb35d(0x5e8)]('active'));const _0x4f4d4e=document[_0x4bb35d(0x2ba)]('.phone-nav-item[onclick*=\x22keypad\x22]');if(_0x4f4d4e)_0x4f4d4e[_0x4bb35d(0x2af)][_0x4bb35d(0x2a8)]('active');}let currentCallState=_0x2a6210(0x53e),callTimer=null,callSeconds=0x0,currentCallNumber='',callStartTime=null,callEndTime=null,callTranscript=[],pendingCallTimeout=null,callHangupBy=null;const callIcons={'message':'<rect\x20x=\x223\x22\x20y=\x225\x22\x20width=\x2218\x22\x20height=\x2214\x22\x20rx=\x222\x22/><path\x20d=\x22M3\x209l9\x206\x209-6\x22/>','decline':_0x2a6210(0x627),'accept':'<path\x20d=\x22M22\x2016.92v3a2\x202\x200\x2001-2.18\x202\x2019.79\x2019.79\x200\x2001-8.63-3.07\x2019.5\x2019.5\x200\x2001-6-6\x2019.79\x2019.79\x200\x2001-3.07-8.67A2\x202\x200\x20014.11\x202h3a2\x202\x200\x20012\x201.72c.127.96.361\x201.903.7\x202.81a2\x202\x200\x2001-.45\x202.11L8.09\x209.91a16\x2016\x200\x20006\x206l1.27-1.27a2\x202\x200\x20012.11-.45c.907.339\x201.85.573\x202.81.7A2\x202\x200\x200122\x2016.92z\x22/>','mute':_0x2a6210(0x818),'keypad':_0x2a6210(0x695),'speaker':'<polygon\x20points=\x2211\x205\x206\x209\x202\x209\x202\x2015\x206\x2015\x2011\x2019\x2011\x205\x22/><path\x20d=\x22M15.54\x208.46a5\x205\x200\x20010\x207.07\x22/>'},callStates={'calling':{'status':_0x2a6210(0x430),'showTimer':![],'buttons':[{'text':_0x2a6210(0x7f5),'icon':'message','action':()=>{const _0x263493=_0x2a6210;alert(_0x263493(0x845));}},{'text':_0x2a6210(0x4d8),'icon':_0x2a6210(0x544),'action':()=>{const _0x1498b8=_0x2a6210;changeCallState(_0x1498b8(0x672));}}]},'incoming':{'status':_0x2a6210(0x1b7),'showTimer':![],'buttons':[{'text':'Decline','icon':_0x2a6210(0x544),'action':()=>{const _0x383320=_0x2a6210;changeCallState(_0x383320(0x672));}},{'text':_0x2a6210(0x58f),'icon':_0x2a6210(0x19d),'action':()=>{const _0x493062=_0x2a6210;changeCallState(_0x493062(0x418));}}]},'connected':{'status':_0x2a6210(0xc1),'showTimer':!![],'buttons':[{'text':_0x2a6210(0x1c5),'icon':_0x2a6210(0x65a),'action':()=>{const _0x4d7058=_0x2a6210;alert(_0x4d7058(0x551));}},{'text':_0x2a6210(0x6bb),'icon':_0x2a6210(0x407),'action':()=>{toggleCallReplyInput();}},{'text':_0x2a6210(0x7f5),'icon':_0x2a6210(0x42c),'action':()=>{minimizeCallScreen();}},{'text':_0x2a6210(0xee),'icon':_0x2a6210(0x544),'action':()=>{const _0x57105c=_0x2a6210;changeCallState(_0x57105c(0x42b));},'class':_0x2a6210(0x485)}]},'declined':{'status':'Call\x20Declined','showTimer':![],'buttons':[{'text':_0x2a6210(0x1d9),'icon':_0x2a6210(0x19d),'action':()=>{const _0x2ef5b3=_0x2a6210;changeCallState(_0x2ef5b3(0x53e));}},{'text':'Close','icon':_0x2a6210(0x42c),'action':()=>{hideCallScreen();}}]},'ended':{'status':'Call\x20Ended','showTimer':!![],'buttons':[{'text':'Call\x20Again','icon':_0x2a6210(0x19d),'action':()=>{const _0x43a4c1=_0x2a6210;changeCallState(_0x43a4c1(0x53e));}},{'text':_0x2a6210(0x659),'icon':'message','action':()=>{hideCallScreen();}}]}};function resetCallReplyUI(_0x4a9f73={}){const _0x58aa40=_0x2a6210,{hideInput:hideInput=!![],clearInput:clearInput=![],clearReplies:clearReplies=![],hideReplies:hideReplies=![]}=_0x4a9f73,_0x2e0abb=document['getElementById'](_0x58aa40(0x1af));hideInput&&_0x2e0abb&&_0x2e0abb[_0x58aa40(0x2af)][_0x58aa40(0x2a8)](_0x58aa40(0x2ec));const _0x234736=document[_0x58aa40(0x550)]('callReplyInput');if(_0x234736){if(clearInput)_0x234736[_0x58aa40(0x4cf)]='';try{_0x234736['blur']();}catch(_0x246719){}}const _0x6e22f3=document[_0x58aa40(0x550)]('callUserReplies');if(_0x6e22f3){_0x6e22f3[_0x58aa40(0x2af)][_0x58aa40(0x5e8)](_0x58aa40(0x230));if(hideReplies)_0x6e22f3[_0x58aa40(0x2af)]['add'](_0x58aa40(0x2ec));}if(clearReplies)try{if(Array['isArray'](callUserReplies))callUserReplies=[];if(typeof updateCallRepliesDisplay===_0x58aa40(0x88))updateCallRepliesDisplay();}catch(_0xdba7de){}}async function showCallScreen(_0x5884cd,_0xc6e23f){const _0x2ad81d=_0x2a6210,_0x17ee66=document['getElementById'](_0x2ad81d(0x3da)),_0x3e2fb7=document[_0x2ad81d(0x550)](_0x2ad81d(0x5ef));currentCallNumber=_0xc6e23f||currentCallNumber,resetCallReplyUI({'hideInput':!![],'clearInput':!![],'clearReplies':!![],'hideReplies':!![]}),_0x3e2fb7&&(currentCallCharacter&&currentCallCharacter['name']?_0x3e2fb7['textContent']=currentCallCharacter[_0x2ad81d(0x189)]:_0x3e2fb7[_0x2ad81d(0x2a1)]=formatPhoneNumber(currentCallNumber)),await updateCallAvatar(currentCallNumber),_0x17ee66&&_0x17ee66[_0x2ad81d(0x2af)][_0x2ad81d(0x5e8)](_0x2ad81d(0x2ec)),changeCallState(_0x5884cd);}async function updateCallAvatar(_0x22c553){const _0x56af78=_0x2a6210;try{const _0x50db28=document[_0x56af78(0x550)](_0x56af78(0x5ee)),_0x3b3b1e=document[_0x56af78(0x550)]('callAvatarDefaultIcon'),_0x4f1c63=document[_0x56af78(0x550)](_0x56af78(0x5ef));if(!_0x50db28||!_0x3b3b1e){console[_0x56af78(0x3bc)](_0x56af78(0x313));return;}const _0x435eb7=normalizeId(_0x22c553);if(!_0x435eb7){console[_0x56af78(0x40b)](_0x56af78(0x2f1)),_0x50db28[_0x56af78(0x37e)][_0x56af78(0x712)]=_0x56af78(0x22e),_0x3b3b1e['style'][_0x56af78(0x712)]=_0x56af78(0x201);return;}console[_0x56af78(0x40b)](_0x56af78(0x474),_0x435eb7);const _0x4e8eaf=await db[_0x56af78(0x33c)][_0x56af78(0x60f)](_0x435eb7);if(_0x4e8eaf){console['log'](_0x56af78(0x185),_0x4e8eaf[_0x56af78(0x561)]);_0x4f1c63&&_0x4e8eaf[_0x56af78(0x561)]&&(_0x4f1c63[_0x56af78(0x2a1)]=_0x4e8eaf[_0x56af78(0x561)]);if(_0x4e8eaf['contactAvatar']){console[_0x56af78(0x40b)](_0x56af78(0x850)),_0x50db28[_0x56af78(0x655)]=_0x4e8eaf[_0x56af78(0x4af)],_0x50db28[_0x56af78(0x37e)]['display']='block',_0x3b3b1e[_0x56af78(0x37e)][_0x56af78(0x712)]=_0x56af78(0x22e);return;}if(_0x4e8eaf[_0x56af78(0x3d9)]&&_0x4e8eaf[_0x56af78(0x4c8)]){console[_0x56af78(0x40b)]('📱\x20陌生人联系人，无自定义头像，使用默认'),_0x50db28[_0x56af78(0x37e)][_0x56af78(0x712)]=_0x56af78(0x22e),_0x3b3b1e[_0x56af78(0x37e)][_0x56af78(0x712)]=_0x56af78(0x201);return;}if(_0x4e8eaf['characterId']){const _0x3ee7af=await getCharacterById(_0x4e8eaf[_0x56af78(0x848)]);if(_0x3ee7af&&_0x3ee7af[_0x56af78(0x555)]?.[_0x56af78(0x657)]){console[_0x56af78(0x40b)](_0x56af78(0x70a)),_0x50db28[_0x56af78(0x655)]=_0x3ee7af[_0x56af78(0x555)][_0x56af78(0x657)],_0x50db28['style'][_0x56af78(0x712)]=_0x56af78(0x201),_0x3b3b1e[_0x56af78(0x37e)][_0x56af78(0x712)]=_0x56af78(0x22e);return;}}_0x50db28[_0x56af78(0x37e)][_0x56af78(0x712)]='none',_0x3b3b1e[_0x56af78(0x37e)][_0x56af78(0x712)]=_0x56af78(0x201);return;}const _0x3467f7=await db[_0x56af78(0xe7)][_0x56af78(0x115)](_0x56af78(0x601))[_0x56af78(0x630)](_0x435eb7)[_0x56af78(0x244)]();if(!_0x3467f7){console[_0x56af78(0x40b)](_0x56af78(0x451)),_0x50db28[_0x56af78(0x37e)][_0x56af78(0x712)]=_0x56af78(0x22e),_0x3b3b1e[_0x56af78(0x37e)][_0x56af78(0x712)]='block';return;}console[_0x56af78(0x40b)]('📞\x20找到电话记录:',_0x3467f7);const _0x16d2a8=normalizeId(_0x3467f7[_0x56af78(0x848)]),_0x2698d6=await getCharacterById(_0x16d2a8);if(!_0x2698d6){console[_0x56af78(0x40b)](_0x56af78(0x690)),_0x50db28[_0x56af78(0x37e)][_0x56af78(0x712)]=_0x56af78(0x22e),_0x3b3b1e[_0x56af78(0x37e)][_0x56af78(0x712)]=_0x56af78(0x201);return;}const _0x4d9d94=_0x2698d6['settings']?.[_0x56af78(0x657)]||'';console['log']('📝\x20找到角色信息:',{'id':_0x16d2a8,'name':_0x2698d6[_0x56af78(0x189)]}),_0x4d9d94?(console[_0x56af78(0x40b)](_0x56af78(0x6b4),_0x2698d6[_0x56af78(0x189)],_0x4d9d94),_0x50db28[_0x56af78(0x655)]=_0x4d9d94,_0x50db28[_0x56af78(0x37e)]['display']=_0x56af78(0x201),_0x3b3b1e[_0x56af78(0x37e)][_0x56af78(0x712)]=_0x56af78(0x22e)):(console[_0x56af78(0x40b)](_0x56af78(0x381)),_0x50db28['style'][_0x56af78(0x712)]='none',_0x3b3b1e[_0x56af78(0x37e)][_0x56af78(0x712)]=_0x56af78(0x201));}catch(_0x4049fb){console[_0x56af78(0x5d9)](_0x56af78(0x26e),_0x4049fb);const _0x3cece4=document[_0x56af78(0x550)](_0x56af78(0x5ee)),_0x3907d5=document[_0x56af78(0x550)](_0x56af78(0x5f7));_0x3cece4&&_0x3907d5&&(_0x3cece4[_0x56af78(0x37e)][_0x56af78(0x712)]=_0x56af78(0x22e),_0x3907d5[_0x56af78(0x37e)][_0x56af78(0x712)]='block');}}async function saveCallRecord(){const _0x47b2ec=_0x2a6210;try{if(!callStartTime){console['log'](_0x47b2ec(0x87));return;}const _0x3cbf39=String(window[_0x47b2ec(0x3bd)]||'')[_0x47b2ec(0x5bd)](),_0x3f8e05=_0x3cbf39===_0x47b2ec(0x450)?'incoming':'outgoing';callEndTime=Date[_0x47b2ec(0x344)]();const _0x2e11e7=Math[_0x47b2ec(0x5b7)]((callEndTime-callStartTime)/0x3e8);if(currentCallCharacter){const _0x1294f9={'characterId':normalizeId(currentCallCharacter?.['id'])||'0','sessionId':'default','role':_0x47b2ec(0x50d),'type':_0x47b2ec(0x7a4),'callType':_0x3f8e05,'callStatus':currentCallState==='ended'?_0x47b2ec(0x1d2):'interrupted','callStartTime':callStartTime,'callEndTime':callEndTime,'callDuration':_0x2e11e7,'phoneNumber':currentCallNumber,'hangupBy':callHangupBy||_0x47b2ec(0x2c6),'content':'CALL\x20'+Math[_0x47b2ec(0x5b7)](_0x2e11e7/0x3c)+':'+_0x2e11e7%0x3c,'callTranscript':callTranscript,'timestamp':callStartTime};await db['chatMessages'][_0x47b2ec(0x2a8)](_0x1294f9);}const _0x42ab7a={'phoneNumber':currentCallNumber,'characterId':normalizeId(currentCallCharacter?.['id'])||null,'characterName':currentCallCharacter?.[_0x47b2ec(0x189)]||null,'characterAvatar':currentCallCharacter?.[_0x47b2ec(0x555)]?.[_0x47b2ec(0x657)]||null,'callType':_0x3f8e05,'timestamp':callStartTime,'duration':_0x2e11e7,'date':new Date(callStartTime)['toLocaleDateString']('zh-CN'),'transcript':callTranscript,'isStranger':typeof isRandomStrangerCall!==_0x47b2ec(0x653)?isRandomStrangerCall:![],'strangerPersona':typeof isRandomStrangerCall!==_0x47b2ec(0x653)&&isRandomStrangerCall&&typeof randomStrangerPersona!=='undefined'?randomStrangerPersona:null};await db[_0x47b2ec(0x99)][_0x47b2ec(0x2a8)](_0x42ab7a),console[_0x47b2ec(0x40b)]('📞\x20通话记录已保存:',_0x42ab7a['isStranger']?_0x47b2ec(0x81b):'普通通话');}catch(_0x3ad1cc){console[_0x47b2ec(0x5d9)]('❌\x20保存通话记录失败:',_0x3ad1cc);}}async function hideCallScreen(){const _0x222bf4=_0x2a6210,_0x1cc7ca=document[_0x222bf4(0x550)]('phoneCallScreen');_0x1cc7ca&&_0x1cc7ca[_0x222bf4(0x2af)][_0x222bf4(0x2a8)]('hidden');resetCallReplyUI({'hideInput':!![],'clearInput':!![],'clearReplies':!![],'hideReplies':!![]}),stopCallTimer();pendingCallTimeout&&(console[_0x222bf4(0x40b)](_0x222bf4(0x449)),clearTimeout(pendingCallTimeout),pendingCallTimeout=null);callShouldHangup=![],await saveCallRecord(),callHangupBy=null;const _0x5bf684=document[_0x222bf4(0x550)](_0x222bf4(0x298));_0x5bf684&&(_0x5bf684[_0x222bf4(0x2af)][_0x222bf4(0x5e8)](_0x222bf4(0x7cc),_0x222bf4(0x76e)),_0x5bf684[_0x222bf4(0x2af)][_0x222bf4(0x2a8)](_0x222bf4(0x2ec))),typeof endCallWithAI===_0x222bf4(0x88)&&endCallWithAI(),callStartTime=null,callEndTime=null,callTranscript=[],currentCallNumber='';}function minimizeCallScreen(){const _0x369bca=_0x2a6210,_0x122bd4=document[_0x369bca(0x550)](_0x369bca(0x3da)),_0x4c992f=document[_0x369bca(0x550)](_0x369bca(0x298));if(!_0x122bd4||!_0x4c992f)return;console[_0x369bca(0x40b)]('📱\x20收纳通话页面'),resetCallReplyUI({'hideInput':!![]}),updateFloatingBallAvatar(),_0x122bd4['classList']['add'](_0x369bca(0xf1)),setTimeout(()=>{const _0x34079d=_0x369bca;_0x122bd4[_0x34079d(0x2af)][_0x34079d(0x5e8)]('minimizing'),_0x122bd4[_0x34079d(0x2af)][_0x34079d(0x2a8)](_0x34079d(0x2ec)),_0x4c992f['classList'][_0x34079d(0x5e8)](_0x34079d(0x2ec)),void _0x4c992f[_0x34079d(0x6e3)],_0x4c992f[_0x34079d(0x2af)][_0x34079d(0x2a8)]('show');},0x15e);}function expandCallScreen(){const _0x6b3463=_0x2a6210,_0xacd058=document[_0x6b3463(0x550)]('phoneCallScreen'),_0x7c18d1=document['getElementById'](_0x6b3463(0x298));if(!_0xacd058||!_0x7c18d1){console['error']('❌\x20找不到通话界面或悬浮球元素');return;}console[_0x6b3463(0x40b)](_0x6b3463(0x144)),resetCallReplyUI({'hideInput':!![]}),_0x7c18d1[_0x6b3463(0x2af)][_0x6b3463(0x5e8)](_0x6b3463(0x7cc),_0x6b3463(0x76e)),_0x7c18d1['classList'][_0x6b3463(0x2a8)](_0x6b3463(0x2ec)),_0xacd058['classList'][_0x6b3463(0x5e8)](_0x6b3463(0x2ec)),_0xacd058[_0x6b3463(0x2af)]['add'](_0x6b3463(0x6ca)),console[_0x6b3463(0x40b)](_0x6b3463(0x21d)),setTimeout(()=>{const _0x3fc176=_0x6b3463;_0xacd058[_0x3fc176(0x2af)][_0x3fc176(0x5e8)]('expanding');},0x190);}function updateFloatingBallAvatar(){const _0x1ffdf9=_0x2a6210,_0x56e679=document[_0x1ffdf9(0x550)](_0x1ffdf9(0x704)),_0x2f4afc=document['getElementById']('callFloatingDefaultIcon'),_0x4baef0=document['getElementById'](_0x1ffdf9(0x5ee));if(!_0x56e679||!_0x2f4afc)return;_0x4baef0&&_0x4baef0[_0x1ffdf9(0x37e)][_0x1ffdf9(0x712)]!==_0x1ffdf9(0x22e)&&_0x4baef0[_0x1ffdf9(0x655)]?(_0x56e679[_0x1ffdf9(0x655)]=_0x4baef0[_0x1ffdf9(0x655)],_0x56e679[_0x1ffdf9(0x37e)][_0x1ffdf9(0x712)]=_0x1ffdf9(0x201),_0x2f4afc[_0x1ffdf9(0x37e)][_0x1ffdf9(0x712)]='none'):(_0x56e679[_0x1ffdf9(0x37e)][_0x1ffdf9(0x712)]='none',_0x2f4afc['style'][_0x1ffdf9(0x712)]=_0x1ffdf9(0x201));}function changeCallState(_0x9d5ea){const _0x534a3f=_0x2a6210;(_0x9d5ea===_0x534a3f(0x672)||_0x9d5ea===_0x534a3f(0x42b))&&(!callHangupBy&&(callHangupBy=_0x534a3f(0x2c6),console[_0x534a3f(0x40b)](_0x534a3f(0x6c9))),typeof abortCurrentCallAI===_0x534a3f(0x88)&&(console[_0x534a3f(0x40b)](_0x534a3f(0x259),_0x9d5ea,_0x534a3f(0x3b4)),abortCurrentCallAI()),pendingCallTimeout&&(console[_0x534a3f(0x40b)](_0x534a3f(0x449)),clearTimeout(pendingCallTimeout),pendingCallTimeout=null));_0x9d5ea!=='connected'?resetCallReplyUI({'hideInput':!![],'clearInput':!![],'hideReplies':!![]}):resetCallReplyUI({'hideInput':!![]});currentCallState=_0x9d5ea;const _0x2779d4=callStates[_0x9d5ea],_0x3b6881=document[_0x534a3f(0x550)](_0x534a3f(0x3da)),_0x53c97f=document[_0x534a3f(0x550)](_0x534a3f(0x36e)),_0x1f88ee=document['getElementById']('callTimer'),_0x3d7bc6=document[_0x534a3f(0x550)]('callBtnGrid');if(!_0x3b6881||!_0x2779d4)return;_0x3b6881[_0x534a3f(0x2af)][_0x534a3f(0x2a8)]('state-changing'),_0x3b6881[_0x534a3f(0x337)]=_0x534a3f(0x2c7)+_0x9d5ea+_0x534a3f(0x599),_0x53c97f&&(_0x53c97f['textContent']=_0x2779d4[_0x534a3f(0x464)]),_0x1f88ee&&(_0x2779d4[_0x534a3f(0x98)]?(_0x1f88ee[_0x534a3f(0x2af)]['remove'](_0x534a3f(0x2ec)),_0x9d5ea===_0x534a3f(0x418)?(!callStartTime&&(callStartTime=Date[_0x534a3f(0x344)](),console[_0x534a3f(0x40b)](_0x534a3f(0x36d),new Date(callStartTime)[_0x534a3f(0x326)]())),startCallTimer(),typeof sendCallMessage===_0x534a3f(0x88)&&callMessages&&callMessages[_0x534a3f(0x73a)]===0x0&&setTimeout(async()=>{const _0x43546f=_0x534a3f,_0x2cc113=await sendCallMessage('喂？');_0x2cc113&&_0x2cc113['sentences']&&_0x2cc113[_0x43546f(0x507)][_0x43546f(0x73a)]>0x0&&(callSpeeches=_0x2cc113['sentences'],callShouldHangup=_0x2cc113[_0x43546f(0x84d)]||![],currentCallSpeechIndex=0x0,_0x2cc113['sentences'][_0x43546f(0x84c)](_0x3e37f7=>{const _0xba1411=_0x43546f;callTranscript[_0xba1411(0x2b9)]({'role':'ai','text':_0x3e37f7,'timestamp':Date[_0xba1411(0x344)]()});}),console[_0x43546f(0x40b)](_0x43546f(0x573),_0x2cc113[_0x43546f(0x507)]),showCallSpeech());},0x3e8)):stopCallTimer()):(_0x1f88ee[_0x534a3f(0x2af)][_0x534a3f(0x2a8)](_0x534a3f(0x2ec)),stopCallTimer())),_0x3d7bc6&&(_0x3d7bc6[_0x534a3f(0x63f)]=_0x2779d4[_0x534a3f(0x59e)][_0x534a3f(0x444)](_0x22611a=>_0x534a3f(0x47e)+(_0x22611a[_0x534a3f(0x8c)]||'')+_0x534a3f(0x82)+_0x22611a[_0x534a3f(0x76c)]+_0x534a3f(0x6d4)+callIcons[_0x22611a['icon']]+_0x534a3f(0x139)+_0x22611a[_0x534a3f(0x76c)]+_0x534a3f(0x59d))[_0x534a3f(0x469)]('')),setTimeout(()=>{const _0x1e1397=_0x534a3f;_0x3b6881['classList']['remove'](_0x1e1397(0x60b));},0x1f4);}function handleCallButtonClick(_0x5a2cf3){const _0x559e9c=_0x2a6210,_0x25b119=callStates[currentCallState];if(!_0x25b119)return;const _0x135323=_0x25b119[_0x559e9c(0x59e)]['find'](_0x30d44f=>_0x30d44f[_0x559e9c(0x76c)]===_0x5a2cf3);if(_0x135323)_0x135323[_0x559e9c(0x5e1)]();}function startCallTimer(){callSeconds=0x0,updateCallTimer(),callTimer=setInterval(()=>{callSeconds++,updateCallTimer();},0x3e8);}function stopCallTimer(){callTimer&&(clearInterval(callTimer),callTimer=null);}function updateCallTimer(){const _0x1b2fe3=_0x2a6210,_0x35fc10=document['getElementById'](_0x1b2fe3(0x731));if(_0x35fc10){const _0x20e706=Math['floor'](callSeconds/0x3c)[_0x1b2fe3(0x1ac)]()[_0x1b2fe3(0x6a6)](0x2,'0'),_0x155df1=(callSeconds%0x3c)['toString']()[_0x1b2fe3(0x6a6)](0x2,'0');_0x35fc10[_0x1b2fe3(0x2a1)]=_0x20e706+':'+_0x155df1;}}let callSpeeches=['你好呀~',_0x2a6210(0x505),_0x2a6210(0x103)],currentCallSpeechIndex=0x0,callSpeechAutoTimer=null,callShouldHangup=![],callSpeechIgnoreClick=![],callSpeechSuppressClickUntil=0x0,callSpeechPointerDown=![],callSpeechPointerMoved=![],callSpeechPointerStartX=0x0,callSpeechPointerStartY=0x0;function bindCallSpeechInteraction(){const _0x5b961d=_0x2a6210,_0x22308e=document[_0x5b961d(0x550)](_0x5b961d(0x729)),_0x4985ef=document['getElementById'](_0x5b961d(0x3b3));if(!_0x22308e||_0x22308e[_0x5b961d(0x772)][_0x5b961d(0x3f2)]==='1')return;_0x22308e[_0x5b961d(0x772)][_0x5b961d(0x3f2)]='1',_0x22308e[_0x5b961d(0x2f7)]('pointerdown',_0x59768a=>{const _0x51b49f=_0x5b961d;callSpeechPointerDown=!![],callSpeechPointerMoved=![],callSpeechPointerStartX=_0x59768a[_0x51b49f(0x1c6)],callSpeechPointerStartY=_0x59768a[_0x51b49f(0x375)];}),_0x22308e[_0x5b961d(0x2f7)](_0x5b961d(0x83),_0x4b5143=>{const _0x538288=_0x5b961d;if(!callSpeechPointerDown)return;const _0x3cd04f=Math[_0x538288(0x4eb)](_0x4b5143[_0x538288(0x1c6)]-callSpeechPointerStartX),_0x2a572a=Math[_0x538288(0x4eb)](_0x4b5143['clientY']-callSpeechPointerStartY);(_0x3cd04f>0x6||_0x2a572a>0x6)&&(callSpeechPointerMoved=!![]);});const _0x27aec1=()=>{callSpeechPointerMoved&&(callSpeechIgnoreClick=!![]),callSpeechPointerDown=![],callSpeechPointerMoved=![];};_0x22308e[_0x5b961d(0x2f7)]('pointerup',_0x27aec1),_0x22308e['addEventListener'](_0x5b961d(0x529),_0x27aec1),_0x4985ef&&_0x4985ef[_0x5b961d(0x2f7)](_0x5b961d(0x5f3),()=>{const _0x4ff2a5=_0x5b961d;callSpeechSuppressClickUntil=Date[_0x4ff2a5(0x344)]()+0x190,callSpeechAutoTimer&&clearTimeout(callSpeechAutoTimer),callSpeechAutoTimer=setTimeout(()=>{nextCallSpeech();},0x1388);},{'passive':!![]});}function showCallSpeech(){const _0x14756d=_0x2a6210,_0x587a51=document['getElementById']('callSpeechBubble'),_0x15fa02=document[_0x14756d(0x550)](_0x14756d(0x3b3)),_0x5e79f4=document['getElementById'](_0x14756d(0x585));if(!_0x587a51||!_0x15fa02||!_0x5e79f4||callSpeeches['length']===0x0)return;bindCallSpeechInteraction(),_0x15fa02['textContent']=callSpeeches[currentCallSpeechIndex],_0x5e79f4['textContent']=currentCallSpeechIndex+0x1+'/'+callSpeeches['length'],_0x587a51['classList'][_0x14756d(0x5e8)](_0x14756d(0x2ec),'switching-out','switching-in'),void _0x587a51[_0x14756d(0x6e3)],_0x587a51[_0x14756d(0x2af)][_0x14756d(0x2a8)]('show');const _0x386c2a=document[_0x14756d(0x550)](_0x14756d(0x298));_0x386c2a&&_0x386c2a[_0x14756d(0x2af)][_0x14756d(0x353)](_0x14756d(0x7cc))&&_0x386c2a[_0x14756d(0x2af)]['add'](_0x14756d(0x76e)),callSpeechAutoTimer&&clearTimeout(callSpeechAutoTimer),callSpeechAutoTimer=setTimeout(()=>{nextCallSpeech();},0x1388);}function nextCallSpeech(_0x427f2e){const _0x1ad1cb=_0x2a6210;if(callSpeeches[_0x1ad1cb(0x73a)]===0x0)return;if(_0x427f2e){if(callSpeechIgnoreClick){callSpeechIgnoreClick=![];return;}if(Date[_0x1ad1cb(0x344)]()<callSpeechSuppressClickUntil)return;}const _0x1ff45f=document[_0x1ad1cb(0x550)](_0x1ad1cb(0x729)),_0x670058=document['getElementById'](_0x1ad1cb(0x3b3)),_0x9f2c60=document[_0x1ad1cb(0x550)]('callSpeechIndicator');if(!_0x1ff45f||!_0x670058||!_0x9f2c60)return;const _0x252fbd=currentCallSpeechIndex===callSpeeches[_0x1ad1cb(0x73a)]-0x1;if(_0x252fbd&&callShouldHangup){console[_0x1ad1cb(0x40b)](_0x1ad1cb(0xbd)),callHangupBy='ai',console[_0x1ad1cb(0x40b)](_0x1ad1cb(0x497)),_0x1ff45f[_0x1ad1cb(0x2af)][_0x1ad1cb(0x5e8)](_0x1ad1cb(0x7cc),_0x1ad1cb(0x803)),_0x1ff45f[_0x1ad1cb(0x2af)][_0x1ad1cb(0x2a8)](_0x1ad1cb(0x202)),setTimeout(()=>{const _0x3f6b02=_0x1ad1cb;hideCallSpeech(),showIslandNotification('通话结束',_0x3f6b02(0x258),_0x3f6b02(0x4fd)),setTimeout(()=>{const _0x4a3486=_0x3f6b02;changeCallState(_0x4a3486(0x42b)),callShouldHangup=![];},0x3e8);},0x7d0);return;}_0x1ff45f[_0x1ad1cb(0x2af)][_0x1ad1cb(0x5e8)](_0x1ad1cb(0x7cc),_0x1ad1cb(0x803)),_0x1ff45f['classList'][_0x1ad1cb(0x2a8)](_0x1ad1cb(0x202)),setTimeout(()=>{const _0x20b44d=_0x1ad1cb;currentCallSpeechIndex=(currentCallSpeechIndex+0x1)%callSpeeches[_0x20b44d(0x73a)],_0x670058['textContent']=callSpeeches[currentCallSpeechIndex],_0x9f2c60[_0x20b44d(0x2a1)]=currentCallSpeechIndex+0x1+'/'+callSpeeches[_0x20b44d(0x73a)],_0x1ff45f[_0x20b44d(0x2af)]['remove'](_0x20b44d(0x202)),_0x1ff45f[_0x20b44d(0x2af)]['add']('switching-in','show'),setTimeout(()=>{const _0x104e50=_0x20b44d;_0x1ff45f[_0x104e50(0x2af)][_0x104e50(0x5e8)](_0x104e50(0x803));},0x190),callSpeechAutoTimer&&clearTimeout(callSpeechAutoTimer),callSpeechAutoTimer=setTimeout(()=>{nextCallSpeech();},0x1388);},0xfa);}function hideCallSpeech(){const _0x50afe5=_0x2a6210,_0x2b25fd=document['getElementById'](_0x50afe5(0x729));_0x2b25fd&&(_0x2b25fd['classList'][_0x50afe5(0x5e8)]('show',_0x50afe5(0x803),_0x50afe5(0x202)),_0x2b25fd[_0x50afe5(0x2af)]['add'](_0x50afe5(0x2ec))),callSpeechAutoTimer&&(clearTimeout(callSpeechAutoTimer),callSpeechAutoTimer=null);}let callUserReplies=[];const MAX_CALL_REPLIES=0x5;function toggleCallReplyInput(){const _0x3df62e=_0x2a6210,_0x71ac85=document[_0x3df62e(0x550)](_0x3df62e(0x3da));if(currentCallState!==_0x3df62e(0x418)||!_0x71ac85||_0x71ac85[_0x3df62e(0x2af)]['contains']('hidden')){resetCallReplyUI({'hideInput':!![]});return;}const _0x3a8acd=document[_0x3df62e(0x550)](_0x3df62e(0x1af)),_0x55438b=document[_0x3df62e(0x550)](_0x3df62e(0x762));if(!_0x3a8acd)return;if(_0x3a8acd['classList'][_0x3df62e(0x353)](_0x3df62e(0x2ec))){_0x3a8acd['classList'][_0x3df62e(0x5e8)](_0x3df62e(0x2ec));const _0x139f0d=document[_0x3df62e(0x550)](_0x3df62e(0x3cc));_0x139f0d&&_0x139f0d[_0x3df62e(0x2f4)](),callUserReplies[_0x3df62e(0x73a)]>0x0&&_0x55438b&&_0x55438b['classList'][_0x3df62e(0x5e8)](_0x3df62e(0x2ec));}else _0x3a8acd[_0x3df62e(0x2af)][_0x3df62e(0x2a8)](_0x3df62e(0x2ec)),callUserReplies[_0x3df62e(0x73a)]>0x0&&_0x55438b&&_0x55438b[_0x3df62e(0x2af)][_0x3df62e(0x5e8)](_0x3df62e(0x2ec));}function addCallReply(){const _0x5ec1ab=_0x2a6210,_0x478dbe=document['getElementById'](_0x5ec1ab(0x3cc));if(!_0x478dbe)return;const _0x1ca6c4=_0x478dbe[_0x5ec1ab(0x4cf)][_0x5ec1ab(0x14c)]();if(!_0x1ca6c4)return;callUserReplies[_0x5ec1ab(0x2b9)](_0x1ca6c4);callUserReplies[_0x5ec1ab(0x73a)]>MAX_CALL_REPLIES&&callUserReplies[_0x5ec1ab(0x706)]();updateCallRepliesDisplay(),_0x478dbe[_0x5ec1ab(0x4cf)]='';const _0x2fded6=document[_0x5ec1ab(0x550)](_0x5ec1ab(0x762));_0x2fded6&&_0x2fded6['classList'][_0x5ec1ab(0x5e8)](_0x5ec1ab(0x2ec)),console[_0x5ec1ab(0x40b)](_0x5ec1ab(0x6de),_0x1ca6c4,_0x5ec1ab(0x228),callUserReplies[_0x5ec1ab(0x73a)],')');}async function sendCallReply(){const _0x2ba126=_0x2a6210,_0x58309b=document[_0x2ba126(0x550)](_0x2ba126(0x3cc));if(!_0x58309b)return;callShouldHangup&&(console[_0x2ba126(0x40b)](_0x2ba126(0x69b)),callShouldHangup=![]);const _0x491b9f=_0x58309b[_0x2ba126(0x4cf)]['trim']();_0x491b9f&&addCallReply();if(callUserReplies[_0x2ba126(0x73a)]===0x0)return;console[_0x2ba126(0x40b)](_0x2ba126(0x84f),callUserReplies);const _0x152fab=callUserReplies[_0x2ba126(0x469)]('\x20');callTranscript[_0x2ba126(0x2b9)]({'role':'user','text':_0x152fab,'timestamp':Date['now']()}),console[_0x2ba126(0x40b)]('📝\x20记录用户消息到通话记录:',_0x152fab);const _0x10a3d6=document[_0x2ba126(0x550)]('callUserReplies');if(_0x10a3d6){_0x10a3d6[_0x2ba126(0x2af)][_0x2ba126(0x2a8)](_0x2ba126(0x230));const _0x39aec9=_0x10a3d6[_0x2ba126(0x854)]('.call-user-reply-item');_0x39aec9[_0x2ba126(0x84c)]((_0x3602b2,_0x5a4a1d)=>{setTimeout(()=>{const _0x35d75d=_0x18ea;_0x3602b2[_0x35d75d(0x2af)]['add'](_0x35d75d(0x482));},_0x5a4a1d*0x32);}),setTimeout(()=>{const _0x46cb4a=_0x2ba126;callUserReplies=[],updateCallRepliesDisplay(),_0x10a3d6[_0x46cb4a(0x2af)][_0x46cb4a(0x5e8)]('sending'),_0x10a3d6['classList'][_0x46cb4a(0x2a8)]('hidden');},0x15e+_0x39aec9[_0x2ba126(0x73a)]*0x32);}else callUserReplies=[],updateCallRepliesDisplay();if(typeof sendCallMessage===_0x2ba126(0x88)){const _0x3ccc32=await sendCallMessage(_0x152fab);_0x3ccc32&&_0x3ccc32[_0x2ba126(0x507)]&&_0x3ccc32[_0x2ba126(0x507)]['length']>0x0&&(console[_0x2ba126(0x40b)](_0x2ba126(0x820),_0x3ccc32[_0x2ba126(0x507)][_0x2ba126(0x73a)],'句'),callSpeeches=_0x3ccc32[_0x2ba126(0x507)],callShouldHangup=_0x3ccc32['shouldHangup']||![],currentCallSpeechIndex=0x0,_0x3ccc32['sentences'][_0x2ba126(0x84c)](_0xae3033=>{const _0x1ca572=_0x2ba126;callTranscript['push']({'role':'ai','text':_0xae3033,'timestamp':Date[_0x1ca572(0x344)]()});}),console['log'](_0x2ba126(0x503),_0x3ccc32[_0x2ba126(0x507)][_0x2ba126(0x73a)],'句'),showCallSpeech());}}function updateCallRepliesDisplay(){const _0x4be3b8=_0x2a6210,_0x1d8bfc=document[_0x4be3b8(0x550)](_0x4be3b8(0x762));if(!_0x1d8bfc)return;_0x1d8bfc[_0x4be3b8(0x63f)]=callUserReplies[_0x4be3b8(0x444)]((_0x1ae8cc,_0x3f51c8)=>{const _0x6e3110=_0x4be3b8,_0x2cd720=_0x3f51c8===callUserReplies['length']-0x1;return _0x6e3110(0x121)+(_0x2cd720?_0x6e3110(0x813):'')+'\x22>'+_0x1ae8cc+_0x6e3110(0x670);})[_0x4be3b8(0x469)]('');}const __ovoInitCallReplyInput=()=>{const _0x56c05b=_0x2a6210,_0x44c348=document[_0x56c05b(0x550)]('callReplyInput');_0x44c348&&_0x44c348[_0x56c05b(0x2f7)](_0x56c05b(0x59a),_0x4ab27e=>{const _0x514b8c=_0x56c05b;_0x4ab27e[_0x514b8c(0x571)]==='Enter'&&addCallReply();});};document['readyState']===_0x2a6210(0x822)?document[_0x2a6210(0x2f7)]('DOMContentLoaded',__ovoInitCallReplyInput,{'once':!![]}):__ovoInitCallReplyInput();const originalChangeCallState=changeCallState;changeCallState=function(_0x4bca80){const _0x3f6f4c=_0x2a6210;originalChangeCallState(_0x4bca80),_0x4bca80===_0x3f6f4c(0x418)?setTimeout(()=>{showCallSpeech();},0x3e8):hideCallSpeech();};async function openImessage(){const _0x219cbe=_0x2a6210;console['log'](_0x219cbe(0x4ad));const _0x192897=document[_0x219cbe(0x550)](_0x219cbe(0x22a));_0x192897&&_0x192897[_0x219cbe(0x2af)][_0x219cbe(0x5e8)](_0x219cbe(0x763));const _0x7a3e7d=document[_0x219cbe(0x550)]('imessageScreen');_0x7a3e7d&&(_0x7a3e7d[_0x219cbe(0x2af)][_0x219cbe(0x2a8)](_0x219cbe(0x763)),renderImessagePinned(),await renderImessageList(),_0x7a3e7d[_0x219cbe(0x2af)]['remove'](_0x219cbe(0x537)),void _0x7a3e7d[_0x219cbe(0x6e3)],_0x7a3e7d[_0x219cbe(0x2af)][_0x219cbe(0x2a8)](_0x219cbe(0x537)));}function closeImessage(){const _0x1813a2=_0x2a6210;console[_0x1813a2(0x40b)](_0x1813a2(0x804));const _0x2e8d0d=document[_0x1813a2(0x550)](_0x1813a2(0x699));_0x2e8d0d&&_0x2e8d0d['classList']['remove'](_0x1813a2(0x763));const _0x3fc6cd=document[_0x1813a2(0x550)]('phoneScreen');_0x3fc6cd&&_0x3fc6cd['classList'][_0x1813a2(0x2a8)]('active');}function createNewImessage(){const _0xf8cb2c=_0x2a6210;console[_0xf8cb2c(0x40b)](_0xf8cb2c(0x73d)),showIslandNotification('提示',_0xf8cb2c(0x5f8),_0xf8cb2c(0x4fd));}let imessageEditMode=![],imessageSelectedItems=new Set();function toggleImessageEditMode(){const _0x4d98bf=_0x2a6210;imessageEditMode=!imessageEditMode,console[_0x4d98bf(0x40b)]('📝\x20iMessage编辑模式:',imessageEditMode?'开启':'关闭'),imessageEditMode?enterImessageEditMode():exitImessageEditMode();}function enterImessageEditMode(){const _0x2308a=_0x2a6210;imessageSelectedItems[_0x2308a(0x20d)]();const _0x42aa08=document['querySelector'](_0x2308a(0x5ff)),_0x4475d9=document[_0x2308a(0x550)](_0x2308a(0x4e8));if(_0x42aa08)_0x42aa08[_0x2308a(0x2a1)]=_0x2308a(0x7f8);if(_0x4475d9)_0x4475d9['innerHTML']=_0x2308a(0x3aa);const _0x1cb9ea=document[_0x2308a(0x550)](_0x2308a(0x699));if(_0x1cb9ea)_0x1cb9ea['classList'][_0x2308a(0x2a8)](_0x2308a(0xef));renderImessageList(),showImessageEditBar();}function exitImessageEditMode(){const _0x48f34f=_0x2a6210;imessageEditMode=![],imessageSelectedItems[_0x48f34f(0x20d)]();const _0x368323=document[_0x48f34f(0x2ba)](_0x48f34f(0x5ff)),_0x4bd5af=document[_0x48f34f(0x550)](_0x48f34f(0x4e8));if(_0x368323)_0x368323[_0x48f34f(0x2a1)]=_0x48f34f(0x269);_0x4bd5af&&(_0x4bd5af[_0x48f34f(0x63f)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<rect\x20x=\x223\x22\x20y=\x223\x22\x20width=\x2218\x22\x20height=\x2218\x22\x20rx=\x222\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x208v8M8\x2012h8\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20');const _0x56164a=document[_0x48f34f(0x550)](_0x48f34f(0x699));if(_0x56164a)_0x56164a[_0x48f34f(0x2af)]['remove'](_0x48f34f(0xef));renderImessageList(),hideImessageEditBar();}function showImessageEditBar(){const _0x55eb76=_0x2a6210;let _0x5b23aa=document[_0x55eb76(0x550)](_0x55eb76(0x1f9));if(!_0x5b23aa){_0x5b23aa=document[_0x55eb76(0x24b)](_0x55eb76(0x5ab)),_0x5b23aa['id']=_0x55eb76(0x1f9),_0x5b23aa[_0x55eb76(0x337)]='imessage-edit-bar',_0x5b23aa[_0x55eb76(0x63f)]=_0x55eb76(0x6c3);const _0x3c8d3b=document[_0x55eb76(0x550)](_0x55eb76(0x699));if(_0x3c8d3b)_0x3c8d3b[_0x55eb76(0x744)](_0x5b23aa);}_0x5b23aa[_0x55eb76(0x2af)][_0x55eb76(0x2a8)](_0x55eb76(0x7cc));}function hideImessageEditBar(){const _0x5b6a73=_0x2a6210,_0x4d5e29=document[_0x5b6a73(0x550)]('imessageEditBar');_0x4d5e29&&_0x4d5e29[_0x5b6a73(0x2af)]['remove'](_0x5b6a73(0x7cc));}function toggleImessageItemSelection(_0x133c70,_0x292105){const _0x6889bf=_0x2a6210;if(_0x292105)_0x292105['stopPropagation']();imessageSelectedItems[_0x6889bf(0x17f)](_0x133c70)?imessageSelectedItems[_0x6889bf(0xfc)](_0x133c70):imessageSelectedItems['add'](_0x133c70),updateImessageSelectionUI();}async function toggleImessageSelectAll(){const _0x2113f2=_0x2a6210,_0x12fc48=await getImessageMessages(),_0x4dd150=_0x12fc48[_0x2113f2(0x444)](_0x317840=>_0x317840['id']);imessageSelectedItems[_0x2113f2(0x719)]===_0x4dd150[_0x2113f2(0x73a)]?imessageSelectedItems[_0x2113f2(0x20d)]():_0x4dd150['forEach'](_0x57d111=>imessageSelectedItems['add'](_0x57d111)),updateImessageSelectionUI();}async function updateImessageSelectionUI(){const _0x1ac648=_0x2a6210,_0x535ac7=imessageSelectedItems[_0x1ac648(0x719)],_0x28265c=document['querySelector']('.imessage-nav-title');if(_0x28265c)_0x28265c['textContent']='已选择\x20'+_0x535ac7+'\x20项';const _0x12f8f2=await getImessageMessages(),_0x3831c8=document['getElementById']('imessageSelectAllText');_0x3831c8&&(_0x3831c8[_0x1ac648(0x2a1)]=_0x535ac7===_0x12f8f2[_0x1ac648(0x73a)]&&_0x535ac7>0x0?_0x1ac648(0x5a8):'全选');const _0x5bdc74=document['getElementById'](_0x1ac648(0x7da));_0x5bdc74&&(_0x5bdc74[_0x1ac648(0x309)]=_0x535ac7===0x0,_0x5bdc74[_0x1ac648(0x2a1)]=_0x535ac7>0x0?_0x1ac648(0x69d)+_0x535ac7+')':'删除'),document[_0x1ac648(0x854)](_0x1ac648(0x45d))[_0x1ac648(0x84c)](_0x422fbd=>{const _0x372c0b=_0x1ac648,_0x156ac1=_0x422fbd['dataset'][_0x372c0b(0x104)],_0x1e3afb=_0x422fbd[_0x372c0b(0x2ba)](_0x372c0b(0x80f)),_0x5ef242=imessageSelectedItems[_0x372c0b(0x17f)](_0x156ac1);_0x5ef242?_0x422fbd[_0x372c0b(0x2af)]['add'](_0x372c0b(0x479)):_0x422fbd['classList'][_0x372c0b(0x5e8)]('imessage-selected'),_0x1e3afb&&(_0x5ef242?_0x1e3afb['classList']['add'](_0x372c0b(0x3d5)):_0x1e3afb['classList'][_0x372c0b(0x5e8)](_0x372c0b(0x3d5)));});}async function deleteSelectedImessages(){const _0x463a49=_0x2a6210,_0x3b19f9=imessageSelectedItems[_0x463a49(0x719)];if(_0x3b19f9===0x0)return;const _0x369c4a=confirm(_0x463a49(0x382)+_0x3b19f9+'\x20个对话吗？\x0a\x0a⚠️\x20这将删除所有相关短信记录，此操作不可撤销！');if(!_0x369c4a)return;console[_0x463a49(0x40b)](_0x463a49(0x7e3),[...imessageSelectedItems]);try{for(const _0x16057d of imessageSelectedItems){await deleteImessageConversation(_0x16057d);}showIslandNotification('成功',_0x463a49(0x63e)+_0x3b19f9+'\x20个对话',_0x463a49(0x1f1)),exitImessageEditMode();}catch(_0x1f8ffd){console[_0x463a49(0x5d9)](_0x463a49(0x702),_0x1f8ffd),showIslandNotification('错误',_0x463a49(0x453),'error');}}async function deleteImessageConversation(_0x9aec40){const _0x18b93e=_0x2a6210,_0x6fa468=normalizeId(_0x9aec40),_0x5f1cc6=_0x18b93e(0x835)+_0x6fa468;console[_0x18b93e(0x40b)]('🗑️\x20删除短信对话:',_0x6fa468);const _0x5a2b00=await db['chatMessages'][_0x18b93e(0x115)](_0x18b93e(0x64b))[_0x18b93e(0x630)](_0x5f1cc6)[_0x18b93e(0x70c)]();if(_0x5a2b00[_0x18b93e(0x73a)]>0x0){if(typeof db[_0x18b93e(0x3d8)]['bulkDelete']===_0x18b93e(0x88))await db[_0x18b93e(0x3d8)][_0x18b93e(0x133)](_0x5a2b00);else for(const _0x4822d4 of _0x5a2b00){await db['chatMessages'][_0x18b93e(0xfc)](_0x4822d4);}}console[_0x18b93e(0x40b)]('?\x20已删除\x20'+_0x5a2b00['length']+_0x18b93e(0x10c)),await purgeRandomNumberDataFromImessage(_0x6fa468);}async function purgeRandomNumberDataFromImessage(_0x339daf){const _0x96f740=_0x2a6210;if(!_0x339daf)return;try{const _0x4e8e47=await db['contacts'][_0x96f740(0x60f)](_0x339daf);if(_0x4e8e47){if(_0x4e8e47[_0x96f740(0x848)]||_0x4e8e47[_0x96f740(0x18b)])return;const _0x3eeacc=_0x4e8e47[_0x96f740(0x3d9)]||_0x4e8e47[_0x96f740(0x74c)]||_0x4e8e47['hiddenInContactsList'];if(!_0x3eeacc)return;}if(!_0x4e8e47){let _0x296a29=![];if(db[_0x96f740(0x99)]){const _0x2b6175=await db[_0x96f740(0x99)][_0x96f740(0x115)](_0x96f740(0x104))[_0x96f740(0x630)](_0x339daf)['toArray']();_0x296a29=_0x2b6175['some'](_0xdf164e=>_0xdf164e[_0x96f740(0x3d9)]||_0xdf164e[_0x96f740(0x4c8)]||!_0xdf164e[_0x96f740(0x848)]);}if(!_0x296a29&&db['chatMessages']){const _0x14ed57=await db[_0x96f740(0x3d8)][_0x96f740(0x651)]();_0x296a29=_0x14ed57[_0x96f740(0x521)](_0xa22fbd=>normalizeId(_0xa22fbd[_0x96f740(0x104)])===_0x339daf&&(_0xa22fbd[_0x96f740(0x816)]||_0xa22fbd['randomSmsPersona']||!_0xa22fbd[_0x96f740(0x848)]&&(_0xa22fbd[_0x96f740(0x1e9)]===_0x96f740(0x212)||_0xa22fbd[_0x96f740(0x1e9)]===_0x96f740(0x7a4))));}if(!_0x296a29)return;}_0x4e8e47&&(await db['contacts'][_0x96f740(0xfc)](_0x339daf),console[_0x96f740(0x40b)]('✅\x20已删除随机号码联系人:',_0x339daf));if(db['callRecords']){const _0x1bb655=await db[_0x96f740(0x99)][_0x96f740(0x115)](_0x96f740(0x104))[_0x96f740(0x630)](_0x339daf)['primaryKeys']();await bulkDeleteSafe(db['callRecords'],_0x1bb655);}if(db[_0x96f740(0x3d8)]){const _0x16731f=await db[_0x96f740(0x3d8)][_0x96f740(0x651)](),_0x432174=_0x16731f[_0x96f740(0x34c)](_0x3414b4=>normalizeId(_0x3414b4['phoneNumber'])===_0x339daf&&!isValidIdValue(_0x3414b4[_0x96f740(0x848)]))[_0x96f740(0x444)](_0x2404c9=>_0x2404c9['id']);await bulkDeleteSafe(db[_0x96f740(0x3d8)],_0x432174);}typeof allCallRecordsCache!=='undefined'&&(allCallRecordsCache=(allCallRecordsCache||[])['filter'](_0x1457fe=>normalizeId(_0x1457fe?.[_0x96f740(0x104)])!==_0x339daf),typeof renderCallRecords==='function'&&await renderCallRecords());}catch(_0x3b5ed5){console['warn'](_0x96f740(0x1cc),_0x3b5ed5);}}function renderImessagePinned(){const _0x460c85=_0x2a6210,_0x397ed5=document[_0x460c85(0x550)](_0x460c85(0x158));if(!_0x397ed5)return;const _0xac455e=getImessagePinnedContacts();if(_0xac455e['length']===0x0){_0x397ed5[_0x460c85(0x63f)]='';const _0x154710=document['getElementById']('imessagePinnedSection');if(_0x154710)_0x154710[_0x460c85(0x37e)][_0x460c85(0x712)]='none';return;}const _0x4067f0=document[_0x460c85(0x550)](_0x460c85(0x4a4));if(_0x4067f0)_0x4067f0[_0x460c85(0x37e)][_0x460c85(0x712)]='block';_0x397ed5[_0x460c85(0x63f)]=_0xac455e[_0x460c85(0x444)]((_0x53af0d,_0x32153a)=>_0x460c85(0x27f)+_0x53af0d['id']+_0x460c85(0x1f3)+(_0x53af0d[_0x460c85(0x196)]||_0x460c85(0x169))+'\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x53af0d['avatar']?'style=\x22background-image:\x20url(\x27'+_0x53af0d[_0x460c85(0x830)]+'\x27);\x20background-size:\x20cover;\x22':'')+_0x460c85(0x294)+(_0x53af0d['lastMessage']?_0x460c85(0x662)+(_0x53af0d[_0x460c85(0x4ec)]||'top-center')+'\x22>'+_0x53af0d[_0x460c85(0x51f)]+'</div>':'')+_0x460c85(0x6d9)+(_0x53af0d['unread']?_0x460c85(0x6d2):'')+_0x460c85(0x83b)+_0x53af0d[_0x460c85(0x189)]+_0x460c85(0x1e0))[_0x460c85(0x469)]('');}async function renderImessageList(){const _0x5b4f32=_0x2a6210,_0x1f9393=document[_0x5b4f32(0x550)](_0x5b4f32(0x622));if(!_0x1f9393)return;const _0xee7144=await getImessageMessages();if(_0xee7144[_0x5b4f32(0x73a)]===0x0){_0x1f9393['innerHTML']=_0x5b4f32(0x1f7);return;}const _0x9efd11=imessageEditMode;_0x1f9393[_0x5b4f32(0x63f)]=_0xee7144[_0x5b4f32(0x444)]((_0x163a3d,_0x50bb1f)=>{const _0x4b3d1f=_0x5b4f32,_0x461cfb=imessageSelectedItems['has'](_0x163a3d['id']),_0x20ddd7=_0x4b3d1f(0x141)+(_0x163a3d[_0x4b3d1f(0x81c)]?_0x4b3d1f(0x69c):'')+'\x20'+(_0x9efd11&&_0x461cfb?_0x4b3d1f(0x479):''),_0x1669ce=_0x9efd11?'toggleImessageItemSelection(\x27'+_0x163a3d['id']+_0x4b3d1f(0x6a2):_0x4b3d1f(0x38d)+_0x163a3d['id']+'\x27)';return'\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22'+_0x20ddd7+_0x4b3d1f(0x94)+_0x163a3d['id']+_0x4b3d1f(0xbb)+_0x1669ce+_0x4b3d1f(0xdd)+(_0x9efd11?_0x4b3d1f(0x3f8)+(_0x461cfb?_0x4b3d1f(0x3d5):'')+_0x4b3d1f(0x801):'')+_0x4b3d1f(0x176)+(_0x163a3d[_0x4b3d1f(0x81c)]?_0x4b3d1f(0x234):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-msg-avatar\x20'+(_0x163a3d['avatarClass']||'imessage-avatar-gray')+_0x4b3d1f(0x7d0)+(_0x163a3d['avatar']?_0x4b3d1f(0x35d)+_0x163a3d[_0x4b3d1f(0x830)]+'\x27);\x20background-size:\x20cover;\x22':'')+_0x4b3d1f(0x7de)+(!_0x163a3d[_0x4b3d1f(0x830)]?_0x4b3d1f(0x4f4)+(_0x163a3d[_0x4b3d1f(0x490)]||'')+_0x4b3d1f(0x162):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-msg-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-msg-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22imessage-msg-name\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x163a3d['name']+_0x4b3d1f(0x9a)+(_0x163a3d[_0x4b3d1f(0x73f)]?_0x4b3d1f(0x495)+_0x163a3d['heart']+'</span>':'')+_0x4b3d1f(0x3b5)+_0x163a3d['time']+_0x4b3d1f(0x5f5)+_0x163a3d[_0x4b3d1f(0xd2)]+_0x4b3d1f(0x49e)+(_0x50bb1f<_0xee7144['length']-0x1?'<div\x20class=\x22imessage-divider\x22></div>':'')+_0x4b3d1f(0x9f);})[_0x5b4f32(0x469)]('');}function getImessagePinnedContacts(){return[];}async function getImessageMessages(){const _0x19e0c1=_0x2a6210;try{console[_0x19e0c1(0x40b)](_0x19e0c1(0x45b));const _0x440777=await db[_0x19e0c1(0x3d8)][_0x19e0c1(0x651)](),_0x1bf849=_0x440777['filter'](_0x18103a=>{const _0x5a612c=_0x19e0c1,_0x5afee9=normalizeId(_0x18103a['sessionId'])||'';return _0x5afee9[_0x5a612c(0x78a)]('sms_');});console[_0x19e0c1(0x40b)]('📱\x20[iMessage]\x20找到短信记录:',_0x1bf849['length'],'条');if(_0x1bf849[_0x19e0c1(0x73a)]===0x0)return[];const _0x469f79=new Map();_0x1bf849[_0x19e0c1(0x84c)](_0x5c8669=>{const _0x526410=_0x19e0c1,_0x3cb8fc=normalizeId(_0x5c8669[_0x526410(0x64b)]),_0x237fa0=_0x3cb8fc[_0x526410(0x7a9)]('sms_','');!_0x469f79[_0x526410(0x17f)](_0x237fa0)&&_0x469f79[_0x526410(0x806)](_0x237fa0,{'phoneNumber':_0x237fa0,'messages':[],'lastTimestamp':0x0});const _0x4c322b=_0x469f79[_0x526410(0x60f)](_0x237fa0);_0x4c322b[_0x526410(0x219)]['push'](_0x5c8669);const _0x385fd6=new Date(_0x5c8669[_0x526410(0x5c9)])['getTime']();_0x385fd6>_0x4c322b[_0x526410(0x7bd)]&&(_0x4c322b[_0x526410(0x7bd)]=_0x385fd6,_0x4c322b[_0x526410(0x51f)]=_0x5c8669);}),console[_0x19e0c1(0x40b)](_0x19e0c1(0x781),_0x469f79[_0x19e0c1(0x719)]);const _0x50030f=[];for(const [_0x1d7aa1,_0x5ab853]of _0x469f79){let _0x5b6d85=_0x1d7aa1,_0x44af96=null,_0x3dbb9a=_0x19e0c1(0x169);try{const _0x311d36=await db[_0x19e0c1(0x33c)][_0x19e0c1(0x60f)](_0x1d7aa1);if(_0x311d36){_0x5b6d85=_0x311d36[_0x19e0c1(0x561)]||_0x1d7aa1,_0x44af96=_0x311d36[_0x19e0c1(0x4af)]||null;const _0x1643a2=_0x5b6d85[_0x19e0c1(0x7b6)](0x0)[_0x19e0c1(0x5bd)]();if(_0x19e0c1(0x6a0)[_0x19e0c1(0x3a6)](_0x1643a2))_0x3dbb9a=_0x19e0c1(0x3d1);else _0x19e0c1(0x2c2)['includes'](_0x1643a2)&&(_0x3dbb9a=_0x19e0c1(0x47b));}}catch(_0x3812bd){console[_0x19e0c1(0x40b)](_0x19e0c1(0x1de),_0x1d7aa1);}const _0x2435a4=new Date(_0x5ab853[_0x19e0c1(0x7bd)]),_0x3ca98b=formatImessageTime(_0x2435a4);let _0x56749e=_0x5ab853[_0x19e0c1(0x51f)]?.[_0x19e0c1(0x73c)]||'';_0x56749e['length']>0x28&&(_0x56749e=_0x56749e[_0x19e0c1(0x161)](0x0,0x28)+_0x19e0c1(0x38c));const _0x59ff24=_0x5b6d85['charAt'](0x0)[_0x19e0c1(0x2db)]();_0x50030f['push']({'id':_0x1d7aa1,'name':_0x5b6d85,'avatar':_0x44af96,'avatarClass':_0x3dbb9a,'initial':_0x59ff24,'time':_0x3ca98b,'preview':_0x56749e,'unread':![],'heart':null,'lastTimestamp':_0x5ab853['lastTimestamp']});}return _0x50030f[_0x19e0c1(0x2f9)]((_0x4988ac,_0x139f8e)=>_0x139f8e[_0x19e0c1(0x7bd)]-_0x4988ac[_0x19e0c1(0x7bd)]),console[_0x19e0c1(0x40b)](_0x19e0c1(0x9e),_0x50030f[_0x19e0c1(0x73a)],'个'),_0x50030f;}catch(_0x42833a){return console[_0x19e0c1(0x5d9)](_0x19e0c1(0x64c),_0x42833a),[];}}function formatImessageTime(_0xf7b8ac){const _0x4920bf=_0x2a6210,_0x26ce76=new Date(),_0x4a036a=new Date(_0x26ce76['getFullYear'](),_0x26ce76[_0x4920bf(0x113)](),_0x26ce76['getDate']()),_0x703c55=new Date(_0x4a036a[_0x4920bf(0x4e0)]()-0x18*0x3c*0x3c*0x3e8),_0x3d7b15=new Date(_0xf7b8ac[_0x4920bf(0x2ad)](),_0xf7b8ac[_0x4920bf(0x113)](),_0xf7b8ac[_0x4920bf(0x7d8)]());if(_0x3d7b15['getTime']()===_0x4a036a[_0x4920bf(0x4e0)]())return _0xf7b8ac[_0x4920bf(0x65b)](_0x4920bf(0x206),{'hour':'numeric','minute':_0x4920bf(0x211),'hour12':!![]});else{if(_0x3d7b15['getTime']()===_0x703c55['getTime']())return _0x4920bf(0x7ac);else return _0x26ce76['getTime']()-_0xf7b8ac[_0x4920bf(0x4e0)]()<0x7*0x18*0x3c*0x3c*0x3e8?_0xf7b8ac[_0x4920bf(0x13e)](_0x4920bf(0x206),{'weekday':'long'}):_0xf7b8ac['toLocaleDateString'](_0x4920bf(0x206),{'month':_0x4920bf(0x54f),'day':'numeric'});}}async function openImessageChat(_0x5c51fe){const _0x291549=_0x2a6210;console[_0x291549(0x40b)](_0x291549(0x698),_0x5c51fe);try{smsOpenedFrom=_0x291549(0x743);let _0x1d773f=_0x5c51fe;const _0x4210e4=await db[_0x291549(0x33c)]['get'](_0x5c51fe);_0x4210e4&&(_0x1d773f=_0x4210e4[_0x291549(0x561)]||_0x5c51fe);const _0x190111=document[_0x291549(0x550)](_0x291549(0x22a));_0x190111&&_0x190111[_0x291549(0x2af)][_0x291549(0x2a8)]('active');const _0x23f7fd=document[_0x291549(0x550)]('imessageScreen');_0x23f7fd&&_0x23f7fd[_0x291549(0x2af)]['remove'](_0x291549(0x763)),await openSmsDetail(_0x5c51fe,_0x1d773f);}catch(_0x240a9f){console[_0x291549(0x5d9)](_0x291549(0xeb),_0x240a9f),showIslandNotification('错误',_0x291549(0x163),_0x291549(0x5d9));}}console[_0x2a6210(0x40b)](_0x2a6210(0x256));function getBaobaobookCategories(){const _0x1176e2=_0x2a6210;try{const _0x40d4d8=localStorage[_0x1176e2(0x401)](_0x1176e2(0x3c2));return _0x40d4d8?JSON['parse'](_0x40d4d8):[];}catch(_0x4d06a7){return console[_0x1176e2(0x5d9)](_0x1176e2(0xc5),_0x4d06a7),[];}}function saveBaobaobookCategories(_0x597e40){const _0x467363=_0x2a6210;try{localStorage[_0x467363(0x21c)](_0x467363(0x3c2),JSON[_0x467363(0x232)](_0x597e40)),console['log'](_0x467363(0x770),_0x597e40);}catch(_0x288c16){console[_0x467363(0x5d9)](_0x467363(0x303),_0x288c16),showIslandNotification('错误',_0x467363(0x730),'error');}}function showBaobaobookCategoryManager(){const _0x1fe9aa=_0x2a6210;console[_0x1fe9aa(0x40b)](_0x1fe9aa(0x448));const _0x48e2ae=document[_0x1fe9aa(0x550)](_0x1fe9aa(0x412));_0x48e2ae&&(_0x48e2ae[_0x1fe9aa(0x2af)][_0x1fe9aa(0x2a8)](_0x1fe9aa(0x763)),loadBaobaobookCategoryList(),vibrateDevice());}function closeBaobaobookCategoryManager(){const _0x6ae437=_0x2a6210;console[_0x6ae437(0x40b)](_0x6ae437(0xd0));const _0x49b17e=document[_0x6ae437(0x550)](_0x6ae437(0x412));_0x49b17e&&(_0x49b17e[_0x6ae437(0x2af)][_0x6ae437(0x5e8)](_0x6ae437(0x763)),vibrateDevice());}function loadBaobaobookCategoryList(){const _0x448b83=_0x2a6210,_0x29022d=getBaobaobookCategories(),_0x43482b=document[_0x448b83(0x550)](_0x448b83(0x4aa));if(!_0x43482b)return;if(_0x29022d[_0x448b83(0x73a)]===0x0){_0x43482b[_0x448b83(0x63f)]=_0x448b83(0x1c2);return;}let _0x161ccf='';_0x29022d[_0x448b83(0x84c)]((_0x56a09d,_0x1af07e)=>{const _0xaaba8=_0x448b83;_0x161ccf+=_0xaaba8(0x4e7)+_0x56a09d[_0xaaba8(0x189)]+_0xaaba8(0x180)+_0x56a09d[_0xaaba8(0x189)]+_0xaaba8(0x220)+new Date(_0x56a09d['createdAt'])[_0xaaba8(0x13e)]()+_0xaaba8(0x55b)+_0x56a09d[_0xaaba8(0x189)]+_0xaaba8(0x362)+_0x56a09d[_0xaaba8(0x189)]+_0xaaba8(0x260);}),_0x43482b[_0x448b83(0x63f)]=_0x161ccf;}function createBaobaobookCategory(){const _0x340262=_0x2a6210,_0x1df9b3=document['getElementById'](_0x340262(0x84b));if(!_0x1df9b3)return;const _0x219753=_0x1df9b3[_0x340262(0x4cf)][_0x340262(0x14c)]();if(!_0x219753){showIslandNotification('提示',_0x340262(0x318),_0x340262(0x4fd));return;}if(_0x219753[_0x340262(0x73a)]<0x1||_0x219753['length']>0x14){showIslandNotification('提示','分类名称长度应在1-20字符之间','info');return;}const _0x271468=getBaobaobookCategories();if(_0x271468[_0x340262(0x521)](_0x22ebca=>_0x22ebca['name']===_0x219753)){showIslandNotification('提示','分类名称已存在',_0x340262(0x4fd));return;}const _0x267336={'id':'cat_'+Date[_0x340262(0x344)](),'name':_0x219753,'createdAt':Date[_0x340262(0x344)]()};_0x271468[_0x340262(0x2b9)](_0x267336),saveBaobaobookCategories(_0x271468),loadBaobaobookCategoryList(),updateBaobaobookCategoryTabs(),_0x1df9b3[_0x340262(0x4cf)]='',showIslandNotification('成功',_0x340262(0xc4)+_0x219753+'\x22已创建',_0x340262(0x106)),vibrateDevice(),console[_0x340262(0x40b)](_0x340262(0x350),_0x267336);}function deleteBaobaobookCategoryWithConfirm(_0x2763d5){const _0x49066f=_0x2a6210,_0x1a64d8=_0x49066f(0x6ff)+_0x2763d5+'\x22吗？<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20该分类下的条目将被移到未分类。\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-btn\x22\x20onclick=\x22closeDeleteCategoryConfirm()\x22>取消</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-btn\x20primary\x22\x20onclick=\x22confirmDeleteBaobaobookCategory(\x27'+_0x2763d5+_0x49066f(0x364),_0x2d362c=document[_0x49066f(0x24b)](_0x49066f(0x5ab));_0x2d362c[_0x49066f(0x63f)]=_0x1a64d8,document[_0x49066f(0x71)][_0x49066f(0x744)](_0x2d362c[_0x49066f(0x5a7)]);}window['closeDeleteCategoryConfirm']=function(){const _0x14c807=_0x2a6210,_0x430ee5=document[_0x14c807(0x550)](_0x14c807(0x392));_0x430ee5&&(_0x430ee5[_0x14c807(0x2af)][_0x14c807(0x5e8)]('active'),setTimeout(()=>_0x430ee5[_0x14c807(0x5e8)](),0x12c));},window[_0x2a6210(0x750)]=function(_0x53871d){const _0x2cb305=_0x2a6210,_0x494804=getBaobaobookCategories(),_0x5ac5b7=_0x494804[_0x2cb305(0x34c)](_0x50a836=>_0x50a836['name']!==_0x53871d);if(_0x5ac5b7[_0x2cb305(0x73a)]===_0x494804['length']){showIslandNotification('错误','分类不存在','error'),closeDeleteCategoryConfirm();return;}saveBaobaobookCategories(_0x5ac5b7),loadBaobaobookCategoryList(),updateBaobaobookCategoryTabs(),showIslandNotification('成功',_0x2cb305(0xc4)+_0x53871d+_0x2cb305(0x591),_0x2cb305(0x106)),vibrateDevice(),closeDeleteCategoryConfirm(),console[_0x2cb305(0x40b)]('[百宝书]\x20删除分类:',_0x53871d);};function renameBaobaobookCategoryPrompt(_0x14d51b){const _0xae5e49=_0x2a6210,_0x27f8ce=prompt(_0xae5e49(0x209),_0x14d51b);if(!_0x27f8ce||_0x27f8ce===_0x14d51b)return;const _0x388fd2=_0x27f8ce[_0xae5e49(0x14c)]();if(!_0x388fd2){showIslandNotification('提示','分类名称不能为空',_0xae5e49(0x4fd));return;}if(_0x388fd2[_0xae5e49(0x73a)]<0x1||_0x388fd2['length']>0x14){showIslandNotification('提示',_0xae5e49(0x383),_0xae5e49(0x4fd));return;}const _0x3f7cec=getBaobaobookCategories();if(_0x3f7cec[_0xae5e49(0x521)](_0x3c59ec=>_0x3c59ec[_0xae5e49(0x189)]===_0x388fd2)){showIslandNotification('提示',_0xae5e49(0x7ab),_0xae5e49(0x4fd));return;}const _0x3c8e9b=_0x3f7cec[_0xae5e49(0x6bf)](_0x8d1474=>_0x8d1474[_0xae5e49(0x189)]===_0x14d51b);_0x3c8e9b&&(_0x3c8e9b['name']=_0x388fd2,saveBaobaobookCategories(_0x3f7cec),loadBaobaobookCategoryList(),updateBaobaobookCategoryTabs(),showIslandNotification('成功',_0xae5e49(0x51d)+_0x388fd2+'\x22',_0xae5e49(0x106)),vibrateDevice(),console[_0xae5e49(0x40b)](_0xae5e49(0x338),_0x14d51b,'->',_0x388fd2));}function updateBaobaobookCategoryTabs(){const _0x388704=_0x2a6210,_0x31157d=getBaobaobookCategories(),_0x4f9e87=document[_0x388704(0x550)]('baobaobookCategoryTabs');if(!_0x4f9e87)return;let _0x35f212='<div\x20class=\x22worldview-tab\x20active\x22\x20data-category-id=\x22all\x22\x20onclick=\x22filterBaobaobookByCategory(\x27all\x27)\x22>全部</div>';_0x31157d[_0x388704(0x84c)](_0x1eb1a6=>{const _0x196ff3=_0x388704;_0x35f212+=_0x196ff3(0x56e)+_0x1eb1a6['id']+_0x196ff3(0xa4)+_0x1eb1a6['id']+_0x196ff3(0x833)+_0x1eb1a6['name']+_0x196ff3(0x670);}),_0x4f9e87[_0x388704(0x63f)]=_0x35f212,console[_0x388704(0x40b)](_0x388704(0x1d0));}function filterBaobaobookByCategory(_0x2ec751){const _0x2dd12f=_0x2a6210;console['log']('[百宝书]\x20筛选分类ID:',_0x2ec751);const _0x540d94=document[_0x2dd12f(0x854)](_0x2dd12f(0xbe));_0x540d94[_0x2dd12f(0x84c)](_0x46e356=>{const _0x1bb000=_0x2dd12f;_0x46e356[_0x1bb000(0x455)](_0x1bb000(0x69f))===_0x2ec751?_0x46e356['classList'][_0x1bb000(0x2a8)](_0x1bb000(0x763)):_0x46e356['classList']['remove'](_0x1bb000(0x763));}),renderBaobaobookEntries(_0x2ec751),vibrateDevice();}function getBaobaobookEntries(){const _0x44b8b3=_0x2a6210;try{const _0x3af920=localStorage[_0x44b8b3(0x401)](_0x44b8b3(0x79d));return _0x3af920?JSON[_0x44b8b3(0x701)](_0x3af920):[];}catch(_0x1834a1){return console[_0x44b8b3(0x5d9)](_0x44b8b3(0x77b),_0x1834a1),[];}}function saveBaobaobookEntries(_0x7c71af){const _0x46525c=_0x2a6210;try{localStorage[_0x46525c(0x21c)](_0x46525c(0x79d),JSON[_0x46525c(0x232)](_0x7c71af)),console[_0x46525c(0x40b)](_0x46525c(0x2cd),_0x7c71af[_0x46525c(0x73a)]);}catch(_0x426d6c){console[_0x46525c(0x5d9)](_0x46525c(0x5aa),_0x426d6c),showIslandNotification('错误',_0x46525c(0x541),_0x46525c(0x4fd));}}let currentEditingEntryId=null;function loadBaobaobookCategoryOptions(_0xe13ca2,_0x103186=null){const _0x28de42=_0x2a6210,_0x578f4e=getBaobaobookCategories();_0xe13ca2[_0x28de42(0x63f)]=_0x28de42(0x320),_0x578f4e[_0x28de42(0x84c)](_0x452477=>{const _0x4a3249=_0x28de42,_0x37de69=document['createElement'](_0x4a3249(0x7fd));_0x37de69['value']=_0x452477['id'],_0x37de69[_0x4a3249(0x2a1)]=_0x452477[_0x4a3249(0x189)],_0xe13ca2['appendChild'](_0x37de69);});if(_0x103186)_0xe13ca2['value']=_0x103186;else{const _0x272ab1=document[_0x28de42(0x2ba)](_0x28de42(0x23b));if(_0x272ab1){const _0xd84b1=_0x272ab1[_0x28de42(0x772)][_0x28de42(0x40d)];_0xd84b1&&_0xd84b1!==_0x28de42(0x40e)&&(_0xe13ca2[_0x28de42(0x4cf)]=_0xd84b1);}}}function setDrawerCreateMode(){const _0xaed075=_0x2a6210;document[_0xaed075(0x2ba)]('#baobaobookEntryDrawerTitleText')[_0xaed075(0x2a1)]=_0xaed075(0x127),document['querySelector'](_0xaed075(0x27c))[_0xaed075(0x2a1)]=_0xaed075(0x5fd);const _0x300e35=document[_0xaed075(0x2ba)]('#baobaobookEntryBtnLeft');_0x300e35['textContent']='取消',_0x300e35['className']=_0xaed075(0x6bd),_0x300e35[_0xaed075(0x7a1)]=closeCreateBaobaobookModal;}function setDrawerEditMode(){const _0x1407d8=_0x2a6210;document[_0x1407d8(0x2ba)](_0x1407d8(0x2ed))[_0x1407d8(0x2a1)]=_0x1407d8(0x2b4),document[_0x1407d8(0x2ba)]('#baobaobookEntryDrawerSubtitle')[_0x1407d8(0x2a1)]=_0x1407d8(0x83c);const _0x44f612=document['querySelector'](_0x1407d8(0x355));_0x44f612[_0x1407d8(0x2a1)]='删除',_0x44f612[_0x1407d8(0x337)]=_0x1407d8(0x304),_0x44f612[_0x1407d8(0x7a1)]=deleteBaobaobookEntry;}window[_0x2a6210(0x49f)]=function(){const _0x1afb0d=_0x2a6210,_0x58756b=document[_0x1afb0d(0x2ba)]('.baobaobook-entry-drawer-overlay'),_0x2d19f4=document[_0x1afb0d(0x2ba)](_0x1afb0d(0x11f));if(!_0x58756b){console[_0x1afb0d(0x5d9)](_0x1afb0d(0x7c1));return;}currentEditingEntryId=null,setDrawerCreateMode(),document[_0x1afb0d(0x2ba)](_0x1afb0d(0x36a))[_0x1afb0d(0x4cf)]='',document[_0x1afb0d(0x2ba)](_0x1afb0d(0x19e))[_0x1afb0d(0x4cf)]='',document[_0x1afb0d(0x2ba)](_0x1afb0d(0x60c))[_0x1afb0d(0x4cf)]='',updateBaobaobookCharCount(),_0x2d19f4&&loadBaobaobookCategoryOptions(_0x2d19f4),_0x58756b[_0x1afb0d(0x2af)]['add'](_0x1afb0d(0x763)),vibrateDevice(),setTimeout(()=>{const _0x2c8087=_0x1afb0d;document[_0x2c8087(0x2ba)](_0x2c8087(0x36a))?.['focus']();},0x12c);},window[_0x2a6210(0x307)]=function(_0x1fb018){const _0x42b2f0=_0x2a6210,_0x1f6f0b=getBaobaobookEntries(),_0x2dccc9=_0x1f6f0b['find'](_0x433fdd=>_0x433fdd['id']===_0x1fb018);if(!_0x2dccc9){showIslandNotification('错误',_0x42b2f0(0x668),'error');return;}const _0x108bd7=document['querySelector']('.baobaobook-entry-drawer-overlay'),_0xa85c8=document[_0x42b2f0(0x2ba)](_0x42b2f0(0x11f));if(!_0x108bd7){console[_0x42b2f0(0x5d9)]('找不到条目抽屉');return;}currentEditingEntryId=_0x1fb018,setDrawerEditMode(),document[_0x42b2f0(0x2ba)](_0x42b2f0(0x36a))[_0x42b2f0(0x4cf)]=_0x2dccc9[_0x42b2f0(0x189)],document[_0x42b2f0(0x2ba)]('#baobaobookEntryKeywordsInput')[_0x42b2f0(0x4cf)]=_0x2dccc9['keywords']['join'](',\x20'),document[_0x42b2f0(0x2ba)](_0x42b2f0(0x60c))[_0x42b2f0(0x4cf)]=_0x2dccc9[_0x42b2f0(0x73c)],updateBaobaobookCharCount();_0xa85c8&&loadBaobaobookCategoryOptions(_0xa85c8,_0x2dccc9[_0x42b2f0(0x40d)]);const _0x441289=document[_0x42b2f0(0x2ba)](_0x42b2f0(0x50a));_0x441289&&(_0x441289[_0x42b2f0(0x4cf)]=_0x2dccc9[_0x42b2f0(0x4b0)]||_0x42b2f0(0x23e));const _0x55fb26=_0x2dccc9[_0x42b2f0(0x71d)]||[],_0x33342c=document[_0x42b2f0(0x2ba)]('#baobaobookEntrySceneChat'),_0x4081e5=document[_0x42b2f0(0x2ba)](_0x42b2f0(0x386)),_0x16684e=document[_0x42b2f0(0x2ba)](_0x42b2f0(0x46a));if(_0x33342c)_0x33342c[_0x42b2f0(0x3d5)]=_0x55fb26['includes'](_0x42b2f0(0x3a4));if(_0x4081e5)_0x4081e5[_0x42b2f0(0x3d5)]=_0x55fb26[_0x42b2f0(0x3a6)](_0x42b2f0(0x7a4));if(_0x16684e)_0x16684e[_0x42b2f0(0x3d5)]=_0x55fb26['includes']('sms');_0x108bd7['classList'][_0x42b2f0(0x2a8)](_0x42b2f0(0x763)),vibrateDevice();},window[_0x2a6210(0x1ee)]=function(){const _0x2062ee=_0x2a6210,_0x2dcad1=document[_0x2062ee(0x2ba)](_0x2062ee(0x844));_0x2dcad1&&(_0x2dcad1[_0x2062ee(0x2af)][_0x2062ee(0x5e8)](_0x2062ee(0x763)),currentEditingEntryId=null,vibrateDevice());},window[_0x2a6210(0x747)]=function(){const _0x75f86c=_0x2a6210,_0x11d16b=document[_0x75f86c(0x2ba)]('#baobaobookEntryContentTextarea'),_0x4ac734=document[_0x75f86c(0x2ba)]('#baobaobookEntryCharCount');if(_0x11d16b&&_0x4ac734){const _0x419168=_0x11d16b[_0x75f86c(0x4cf)][_0x75f86c(0x73a)];_0x4ac734[_0x75f86c(0x2a1)]=_0x419168;}},window[_0x2a6210(0x7ca)]=function(){const _0x24ee94=_0x2a6210,_0x3a3a3a=document[_0x24ee94(0x2ba)](_0x24ee94(0x36a)),_0x2e9dd2=document[_0x24ee94(0x2ba)](_0x24ee94(0x19e)),_0x1348f7=document['querySelector'](_0x24ee94(0x11f)),_0x442d0f=document[_0x24ee94(0x2ba)](_0x24ee94(0x50a)),_0x41ee1c=document[_0x24ee94(0x2ba)]('#baobaobookEntryContentTextarea'),_0x4f1cd5=document[_0x24ee94(0x2ba)]('#baobaobookEntrySceneChat'),_0x2bad4a=document[_0x24ee94(0x2ba)](_0x24ee94(0x386)),_0x13f779=document['querySelector']('#baobaobookEntrySceneSms'),_0xb012fb=_0x3a3a3a[_0x24ee94(0x4cf)]['trim']();if(!_0xb012fb){showIslandNotification('提示','请输入条目名称',_0x24ee94(0x4fd)),_0x3a3a3a[_0x24ee94(0x2f4)](),vibrateDevice();return;}if(_0xb012fb[_0x24ee94(0x73a)]>0x32){showIslandNotification('提示',_0x24ee94(0x592),_0x24ee94(0x4fd)),_0x3a3a3a[_0x24ee94(0x2f4)](),vibrateDevice();return;}const _0x1b8145=_0x41ee1c[_0x24ee94(0x4cf)][_0x24ee94(0x14c)]();if(!_0x1b8145){showIslandNotification('提示',_0x24ee94(0x1ae),_0x24ee94(0x4fd)),_0x41ee1c[_0x24ee94(0x2f4)](),vibrateDevice();return;}const _0x1c8be2=_0x2e9dd2['value']['trim']()['split'](',')[_0x24ee94(0x444)](_0x445fd1=>_0x445fd1[_0x24ee94(0x14c)]())[_0x24ee94(0x34c)](_0x3e696c=>_0x3e696c),_0xb67278=[];if(_0x4f1cd5&&_0x4f1cd5[_0x24ee94(0x3d5)])_0xb67278['push'](_0x24ee94(0x3a4));if(_0x2bad4a&&_0x2bad4a[_0x24ee94(0x3d5)])_0xb67278['push']('call');if(_0x13f779&&_0x13f779[_0x24ee94(0x3d5)])_0xb67278['push'](_0x24ee94(0x212));const _0x55cf6b=getBaobaobookEntries();if(currentEditingEntryId){const _0x417a50=_0x55cf6b[_0x24ee94(0x3f0)](_0x5f3ccb=>_0x5f3ccb['id']===currentEditingEntryId);if(_0x417a50===-0x1){showIslandNotification('错误',_0x24ee94(0x668),_0x24ee94(0x5d9));return;}_0x55cf6b[_0x417a50][_0x24ee94(0x189)]=_0xb012fb,_0x55cf6b[_0x417a50][_0x24ee94(0x83d)]=_0x1c8be2,_0x55cf6b[_0x417a50]['categoryId']=_0x1348f7['value']||'',_0x55cf6b[_0x417a50]['position']=_0x442d0f[_0x24ee94(0x4cf)]||_0x24ee94(0x23e),_0x55cf6b[_0x417a50][_0x24ee94(0x71d)]=_0xb67278,_0x55cf6b[_0x417a50]['content']=_0x1b8145,_0x55cf6b[_0x417a50][_0x24ee94(0x334)]=Date[_0x24ee94(0x344)](),saveBaobaobookEntries(_0x55cf6b),showIslandNotification('成功','条目已更新',_0x24ee94(0x106));}else{const _0x4c718c={'id':_0x24ee94(0x302)+Date[_0x24ee94(0x344)]()+'_'+Math[_0x24ee94(0x658)]()['toString'](0x24)['substr'](0x2,0x9),'name':_0xb012fb,'keywords':_0x1c8be2,'categoryId':_0x1348f7[_0x24ee94(0x4cf)]||'','position':_0x442d0f[_0x24ee94(0x4cf)]||_0x24ee94(0x23e),'defaultScenes':_0xb67278,'content':_0x1b8145,'createdAt':Date['now'](),'updatedAt':Date[_0x24ee94(0x344)]()};_0x55cf6b[_0x24ee94(0x2b9)](_0x4c718c),saveBaobaobookEntries(_0x55cf6b),showIslandNotification('成功',_0x24ee94(0x563),_0x24ee94(0x106));}closeCreateBaobaobookModal();const _0x304658=document[_0x24ee94(0x2ba)](_0x24ee94(0x23b)),_0x4bb826=_0x304658?_0x304658[_0x24ee94(0x772)][_0x24ee94(0x40d)]:'all';renderBaobaobookEntries(_0x4bb826),vibrateDevice();},window[_0x2a6210(0x377)]=function(){const _0x10bdd4=_0x2a6210;if(!currentEditingEntryId)return;if(!confirm(_0x10bdd4(0x3b8)))return;const _0x176257=getBaobaobookEntries(),_0x24957e=_0x176257[_0x10bdd4(0x34c)](_0x300e1b=>_0x300e1b['id']!==currentEditingEntryId);if(_0x24957e['length']===_0x176257['length']){showIslandNotification('错误',_0x10bdd4(0x668),_0x10bdd4(0x5d9));return;}saveBaobaobookEntries(_0x24957e),closeCreateBaobaobookModal();const _0x305d3c=document[_0x10bdd4(0x2ba)](_0x10bdd4(0x23b)),_0x55787b=_0x305d3c?_0x305d3c[_0x10bdd4(0x772)]['categoryId']:_0x10bdd4(0x40e);renderBaobaobookEntries(_0x55787b),showIslandNotification('成功','条目已删除',_0x10bdd4(0x106)),vibrateDevice();};function renderBaobaobookEntries(_0x25bb9f=_0x2a6210(0x40e)){const _0x1d1c3e=_0x2a6210,_0x536d9f=document[_0x1d1c3e(0x2ba)](_0x1d1c3e(0x809));if(!_0x536d9f){console[_0x1d1c3e(0x5d9)](_0x1d1c3e(0x238));return;}const _0x126317=getBaobaobookEntries();let _0x54b884=_0x126317;_0x25bb9f&&_0x25bb9f!==_0x1d1c3e(0x40e)&&(_0x54b884=_0x126317['filter'](_0x2f3496=>_0x2f3496['categoryId']===_0x25bb9f));_0x536d9f[_0x1d1c3e(0x63f)]='';const _0x5db179=document[_0x1d1c3e(0x24b)](_0x1d1c3e(0x5ab));_0x5db179[_0x1d1c3e(0x337)]=_0x1d1c3e(0x25c),_0x5db179[_0x1d1c3e(0x7a1)]=window[_0x1d1c3e(0x49f)],_0x5db179[_0x1d1c3e(0x63f)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x204v16m8-8H4\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span>新建条目</span>\x0a\x20\x20\x20\x20\x20\x20',_0x536d9f[_0x1d1c3e(0x744)](_0x5db179);if(_0x54b884[_0x1d1c3e(0x73a)]===0x0){const _0x5159d7=document['createElement'](_0x1d1c3e(0x5ab));_0x5159d7[_0x1d1c3e(0x337)]=_0x1d1c3e(0x84a),_0x5159d7[_0x1d1c3e(0x63f)]=_0x1d1c3e(0x319),_0x536d9f[_0x1d1c3e(0x744)](_0x5159d7);return;}const _0xad2a49=document[_0x1d1c3e(0x24b)](_0x1d1c3e(0x5ab));_0xad2a49[_0x1d1c3e(0x337)]=_0x1d1c3e(0x291);const _0x43a9bc=getBaobaobookCategories();_0x54b884[_0x1d1c3e(0x84c)](_0x3c5187=>{const _0x53de43=_0x1d1c3e,_0x265cb0=document['createElement'](_0x53de43(0x5ab));_0x265cb0[_0x53de43(0x337)]=_0x53de43(0x249),_0x265cb0[_0x53de43(0x772)][_0x53de43(0x7cf)]=_0x3c5187['id'];const _0x48dd39=_0x43a9bc[_0x53de43(0x6bf)](_0x509f94=>_0x509f94['id']===_0x3c5187[_0x53de43(0x40d)]),_0xb2f5=_0x48dd39?_0x48dd39['name']:_0x53de43(0x617),_0xc69ddd=_0x3c5187[_0x53de43(0x189)]['charAt'](0x0)[_0x53de43(0x2db)](),_0x3d3f6b=_0x3c5187[_0x53de43(0x83d)][_0x53de43(0x4c1)](0x0,0x3)['map'](_0x29df6d=>'<span\x20class=\x22baobaobook-entry-keyword\x22>'+escapeHtml(_0x29df6d)+_0x53de43(0x162))[_0x53de43(0x469)](''),_0x56839c=_0x3c5187['content'][_0x53de43(0x73a)]>0x3c?_0x3c5187['content'][_0x53de43(0x161)](0x0,0x3c)+_0x53de43(0x38c):_0x3c5187[_0x53de43(0x73c)];_0x265cb0[_0x53de43(0x63f)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22baobaobook-entry-avatar\x22>'+_0xc69ddd+_0x53de43(0x2b7)+escapeHtml(_0x3c5187[_0x53de43(0x189)])+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22baobaobook-entry-category\x22>'+escapeHtml(_0xb2f5)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x3c5187[_0x53de43(0x83d)]['length']>0x0?_0x53de43(0x1b5)+_0x3d3f6b+_0x53de43(0x670):'')+_0x53de43(0x1d5)+escapeHtml(_0x56839c)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x265cb0[_0x53de43(0x2f7)](_0x53de43(0x810),()=>{showBaobaobookEntryDetail(_0x3c5187['id']);}),_0xad2a49[_0x53de43(0x744)](_0x265cb0);}),_0x536d9f['appendChild'](_0xad2a49),console[_0x1d1c3e(0x40b)](_0x1d1c3e(0x48f)+_0x54b884[_0x1d1c3e(0x73a)]+_0x1d1c3e(0x20b));}function showBaobaobookEntryDetail(_0x1282bb){showEditBaobaobookModal(_0x1282bb);}const entryContentTextarea=document[_0x2a6210(0x2ba)](_0x2a6210(0x60c));entryContentTextarea&&entryContentTextarea['addEventListener'](_0x2a6210(0x603),updateBaobaobookCharCount);const createOverlay=document[_0x2a6210(0x2ba)](_0x2a6210(0x844));createOverlay&&createOverlay['addEventListener'](_0x2a6210(0x810),_0x372ecf=>{const _0x5c7e2f=_0x2a6210;_0x372ecf[_0x5c7e2f(0x66d)]===createOverlay&&closeCreateBaobaobookModal();});console[_0x2a6210(0x40b)](_0x2a6210(0x1dc)),console[_0x2a6210(0x40b)](_0x2a6210(0x7c5));let currentGalleryCategoryId=null;async function openImageGalleryDrawer(){const _0x1408c2=_0x2a6210;console['log']('🖼️\x20打开动态图库抽屉');const _0x8227c8=document['getElementById'](_0x1408c2(0x641));if(!_0x8227c8)return;const _0x461759=document['getElementById']('imageGalleryCategoryPanel'),_0x1f5df0=document['getElementById'](_0x1408c2(0x2c5));if(_0x461759)_0x461759[_0x1408c2(0x37e)][_0x1408c2(0x712)]='block';if(_0x1f5df0)_0x1f5df0['classList']['remove'](_0x1408c2(0x763));await loadImageGalleryCategories(),await populateGalleryCharacterSelect(),_0x8227c8['classList'][_0x1408c2(0x2a8)](_0x1408c2(0x763));}function closeImageGalleryDrawer(){const _0x54c59f=_0x2a6210,_0x2fe5a4=document[_0x54c59f(0x550)]('imageGalleryDrawer');if(_0x2fe5a4)_0x2fe5a4[_0x54c59f(0x2af)][_0x54c59f(0x5e8)]('active');}function closeImageGalleryDrawerOnOverlay(_0x69e62b){const _0x1b65ee=_0x2a6210;_0x69e62b[_0x1b65ee(0x66d)]['id']==='imageGalleryDrawer'&&closeImageGalleryDrawer();}async function populateGalleryCharacterSelect(){const _0x42f17e=_0x2a6210,_0x13603c=document[_0x42f17e(0x550)](_0x42f17e(0xd9));if(!_0x13603c)return;_0x13603c[_0x42f17e(0x63f)]='<option\x20value=\x22\x22>通用（所有角色）</option>';try{const _0x5339e7=await db[_0x42f17e(0x37c)][_0x42f17e(0x651)](),_0x3901bc=getUserCreatedCharactersFromChats(_0x5339e7);_0x3901bc[_0x42f17e(0x84c)](_0x434aaf=>{const _0xc8da71=_0x42f17e,_0x4efc6e=document[_0xc8da71(0x24b)](_0xc8da71(0x7fd));_0x4efc6e[_0xc8da71(0x4cf)]=_0x434aaf['id'],_0x4efc6e['textContent']=_0x434aaf[_0xc8da71(0x189)]||_0xc8da71(0x7ed),_0x13603c[_0xc8da71(0x744)](_0x4efc6e);});}catch(_0xd3b0c4){console[_0x42f17e(0x5d9)](_0x42f17e(0x17b),_0xd3b0c4);}}async function loadImageGalleryCategories(){const _0x2e8231=_0x2a6210,_0x3cb365=document['getElementById'](_0x2e8231(0x6df));if(!_0x3cb365)return;try{const _0x4f8c9c=await db[_0x2e8231(0x7e9)][_0x2e8231(0x651)]();if(_0x4f8c9c['length']===0x0){_0x3cb365[_0x2e8231(0x63f)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22image-gallery-empty-state\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22><rect\x20x=\x223\x22\x20y=\x223\x22\x20width=\x2218\x22\x20height=\x2218\x22\x20rx=\x222\x22\x20ry=\x222\x22/><circle\x20cx=\x228.5\x22\x20cy=\x228.5\x22\x20r=\x221.5\x22/><polyline\x20points=\x2221\x2015\x2016\x2010\x205\x2021\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>暂无图库分类<br>创建一个分类来开始管理图片</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';return;}const _0x57382c=await db[_0x2e8231(0x37c)][_0x2e8231(0x651)](),_0x200606={};getUserCreatedCharactersFromChats(_0x57382c)[_0x2e8231(0x84c)](_0x41897c=>{const _0x3ac574=_0x2e8231;_0x200606[_0x41897c['id']]=_0x41897c[_0x3ac574(0x189)]||'未命名';});let _0x4bd6dd='';_0x4f8c9c['forEach'](_0x21d519=>{const _0x342234=_0x2e8231,_0x45caa8=(_0x21d519[_0x342234(0xbf)]||[])[_0x342234(0x73a)],_0x4742e8=_0x21d519[_0x342234(0xbf)]&&_0x21d519[_0x342234(0xbf)][_0x342234(0x73a)]>0x0?_0x21d519[_0x342234(0xbf)][0x0][_0x342234(0x852)]:null,_0x44247d=_0x21d519['characterId']?_0x200606[_0x21d519[_0x342234(0x848)]]:null,_0x47ca9e=_0x44247d?_0x342234(0x742)+_0x44247d+_0x342234(0x162):_0x342234(0x2cb);_0x4bd6dd+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22image-gallery-category-item\x20'+(_0x21d519[_0x342234(0x3ae)]===![]?_0x342234(0x309):'')+_0x342234(0x57e)+_0x21d519['id']+_0x342234(0x3db)+(_0x4742e8?_0x342234(0x23a)+_0x4742e8+_0x342234(0x584):_0x342234(0x300))+_0x342234(0xc2)+(_0x21d519[_0x342234(0x189)]||'未命名分类')+_0x342234(0x828)+_0x47ca9e+_0x342234(0x501)+_0x45caa8+_0x342234(0x481)+(_0x21d519[_0x342234(0x3ae)]===![]?'\x20·\x20已禁用':'')+_0x342234(0x7f3)+_0x21d519['id']+_0x342234(0x78c);}),_0x3cb365[_0x2e8231(0x63f)]=_0x4bd6dd;}catch(_0x121f26){console[_0x2e8231(0x5d9)](_0x2e8231(0x7ae),_0x121f26),_0x3cb365[_0x2e8231(0x63f)]=_0x2e8231(0x42e);}}async function addImageGalleryCategory(){const _0x4a95cd=_0x2a6210,_0x57d4c7=document[_0x4a95cd(0x550)](_0x4a95cd(0x782)),_0x121bed=document[_0x4a95cd(0x550)]('newGalleryCategoryTarget');if(!_0x57d4c7)return;const _0x3e6851=_0x57d4c7['value']['trim']();if(!_0x3e6851){showIslandNotification('提示',_0x4a95cd(0x175),'info');return;}const _0x5edca=_0x121bed?.[_0x4a95cd(0x4cf)]||null;try{const _0x24d6ae={'id':'gallery_'+Date['now']()+'_'+Math[_0x4a95cd(0x658)]()[_0x4a95cd(0x1ac)](0x24)[_0x4a95cd(0x26b)](0x2,0x6),'name':_0x3e6851,'characterId':_0x5edca,'isEnabled':!![],'createdAt':Date[_0x4a95cd(0x344)](),'images':[]};await db['imageGalleries']['add'](_0x24d6ae),console['log']('✅\x20创建图库分类成功:',_0x24d6ae),_0x57d4c7[_0x4a95cd(0x4cf)]='';if(_0x121bed)_0x121bed[_0x4a95cd(0x4cf)]='';await loadImageGalleryCategories(),showIslandNotification('成功',_0x4a95cd(0x1f6)+_0x3e6851+_0x4a95cd(0x419),_0x4a95cd(0x4fd));}catch(_0x33a363){console[_0x4a95cd(0x5d9)](_0x4a95cd(0x62a),_0x33a363),showIslandNotification('错误',_0x4a95cd(0x5d2)+_0x33a363[_0x4a95cd(0x42c)],'info');}}async function deleteGalleryCategory(_0x56167f){const _0x5ae042=_0x2a6210;if(!confirm(_0x5ae042(0x1c1)))return;try{await db['imageGalleries'][_0x5ae042(0xfc)](_0x56167f),console[_0x5ae042(0x40b)](_0x5ae042(0x776),_0x56167f),await loadImageGalleryCategories(),showIslandNotification(_0x5ae042(0x5e2),'分类已删除',_0x5ae042(0x4fd));}catch(_0x460d58){console[_0x5ae042(0x5d9)](_0x5ae042(0x434),_0x460d58),showIslandNotification('错误','删除失败',_0x5ae042(0x4fd));}}async function openGalleryImages(_0x262f27){const _0x2e42eb=_0x2a6210;console['log'](_0x2e42eb(0x7a3),_0x262f27),currentGalleryCategoryId=_0x262f27;const _0x326f86=document[_0x2e42eb(0x550)](_0x2e42eb(0x34f)),_0x31224c=document[_0x2e42eb(0x550)](_0x2e42eb(0x2c5));if(_0x326f86)_0x326f86[_0x2e42eb(0x37e)][_0x2e42eb(0x712)]='none';if(_0x31224c)_0x31224c[_0x2e42eb(0x2af)]['add'](_0x2e42eb(0x763));await loadGalleryImages(_0x262f27);}async function backToGalleryCategories(){const _0x573add=_0x2a6210;currentGalleryCategoryId=null;const _0x567445=document[_0x573add(0x550)](_0x573add(0x34f)),_0x54babd=document[_0x573add(0x550)](_0x573add(0x2c5));if(_0x54babd)_0x54babd[_0x573add(0x2af)]['remove']('active');if(_0x567445)_0x567445[_0x573add(0x37e)][_0x573add(0x712)]=_0x573add(0x201);await loadImageGalleryCategories();}async function loadGalleryImages(_0xa5339f){const _0x426608=_0x2a6210;try{const _0x3952d7=await db[_0x426608(0x7e9)][_0x426608(0x60f)](_0xa5339f);if(!_0x3952d7){showIslandNotification('错误',_0x426608(0x1e8),_0x426608(0x4fd)),backToGalleryCategories();return;}const _0x20940e=document[_0x426608(0x550)](_0x426608(0x240)),_0x5ecc28=document[_0x426608(0x550)](_0x426608(0x3be)),_0x1a5fad=document[_0x426608(0x550)](_0x426608(0x741));if(_0x20940e)_0x20940e[_0x426608(0x2a1)]=_0x3952d7[_0x426608(0x189)]||'未命名分类';if(_0x5ecc28)_0x5ecc28[_0x426608(0x2a1)]=(_0x3952d7['images']||[])[_0x426608(0x73a)]+_0x426608(0x481);_0x1a5fad&&_0x1a5fad[_0x426608(0x2af)][_0x426608(0x18f)](_0x426608(0x763),_0x3952d7['isEnabled']!==![]);const _0x574bc9=document[_0x426608(0x550)]('imageGalleryImagesGrid');if(!_0x574bc9)return;const _0x1e283b=_0x3952d7[_0x426608(0xbf)]||[];let _0x22747a='';_0x22747a+=_0x426608(0x4ce),_0x1e283b[_0x426608(0x84c)]((_0x4619be,_0xf218ba)=>{const _0xc1ab08=_0x426608,_0x1e134a=_0x4619be[_0xc1ab08(0x16e)]?_0xc1ab08(0x6ec)+_0x4619be[_0xc1ab08(0x16e)]+'</div>':'';_0x22747a+=_0xc1ab08(0x328)+_0x4619be[_0xc1ab08(0x852)]+_0xc1ab08(0x67a)+_0x1e134a+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22image-gallery-image-delete\x22\x20onclick=\x22deleteGalleryImage('+_0xf218ba+_0xc1ab08(0x677);}),_0x574bc9['innerHTML']=_0x22747a;}catch(_0x32ddbe){console[_0x426608(0x5d9)](_0x426608(0x2ef),_0x32ddbe);}}async function toggleCurrentGalleryEnabled(){const _0x39a387=_0x2a6210;if(!currentGalleryCategoryId)return;try{const _0x58bc73=await db['imageGalleries']['get'](currentGalleryCategoryId);if(!_0x58bc73)return;const _0x1bab16=_0x58bc73[_0x39a387(0x3ae)]===![]?!![]:![];await db[_0x39a387(0x7e9)]['update'](currentGalleryCategoryId,{'isEnabled':_0x1bab16});const _0x39f99a=document[_0x39a387(0x550)]('currentGalleryToggle');if(_0x39f99a)_0x39f99a[_0x39a387(0x2af)][_0x39a387(0x18f)](_0x39a387(0x763),_0x1bab16);showIslandNotification('已更新',_0x1bab16?_0x39a387(0x6cc):_0x39a387(0x800),'info');}catch(_0x241597){console[_0x39a387(0x5d9)](_0x39a387(0x489),_0x241597);}}async function deleteGalleryImage(_0x54b02e,_0x2b7366){const _0xe03b5d=_0x2a6210;_0x2b7366?.[_0xe03b5d(0x69e)]();if(!currentGalleryCategoryId)return;if(!confirm(_0xe03b5d(0xe4)))return;try{const _0x349d5e=await db['imageGalleries'][_0xe03b5d(0x60f)](currentGalleryCategoryId);if(!_0x349d5e||!_0x349d5e['images'])return;_0x349d5e[_0xe03b5d(0xbf)][_0xe03b5d(0x3b7)](_0x54b02e,0x1),await db['imageGalleries'][_0xe03b5d(0x253)](currentGalleryCategoryId,{'images':_0x349d5e[_0xe03b5d(0xbf)]}),await loadGalleryImages(currentGalleryCategoryId),showIslandNotification(_0xe03b5d(0x5e2),_0xe03b5d(0x68d),_0xe03b5d(0x4fd));}catch(_0x1e5cec){console[_0xe03b5d(0x5d9)](_0xe03b5d(0x728),_0x1e5cec);}}function openImageGalleryAddModal(){const _0x4a987a=_0x2a6210,_0x4bc140=document[_0x4a987a(0x550)](_0x4a987a(0xb1));if(!_0x4bc140)return;const _0x242867=document[_0x4a987a(0x550)](_0x4a987a(0x77)),_0x56a221=document[_0x4a987a(0x550)]('newImageDescription'),_0x203dbc=document['getElementById'](_0x4a987a(0x4a9)),_0x548421=document[_0x4a987a(0x550)](_0x4a987a(0x6ab));if(_0x242867)_0x242867[_0x4a987a(0x4cf)]='';if(_0x56a221)_0x56a221[_0x4a987a(0x4cf)]='';if(_0x203dbc)_0x203dbc['value']='';_0x548421&&(_0x548421['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22preview-placeholder\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22><rect\x20x=\x223\x22\x20y=\x223\x22\x20width=\x2218\x22\x20height=\x2218\x22\x20rx=\x222\x22\x20ry=\x222\x22/><circle\x20cx=\x228.5\x22\x20cy=\x228.5\x22\x20r=\x221.5\x22/><polyline\x20points=\x2221\x2015\x2016\x2010\x205\x2021\x22/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20输入链接后预览\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20'),_0x4bc140[_0x4a987a(0x2af)][_0x4a987a(0x2a8)](_0x4a987a(0x763));}function closeImageGalleryAddModal(_0x2606d5){const _0x240848=_0x2a6210;if(_0x2606d5&&_0x2606d5[_0x240848(0x66d)]!==_0x2606d5['currentTarget'])return;const _0x1f0e3a=document['getElementById']('imageGalleryAddModal');if(_0x1f0e3a)_0x1f0e3a[_0x240848(0x2af)][_0x240848(0x5e8)]('active');}function previewNewImage(){const _0x455d95=_0x2a6210,_0x2e0c53=document[_0x455d95(0x550)](_0x455d95(0x77)),_0x56b20f=document['getElementById'](_0x455d95(0x6ab));if(!_0x2e0c53||!_0x56b20f)return;const _0x4d9f42=_0x2e0c53[_0x455d95(0x4cf)][_0x455d95(0x14c)]();if(!_0x4d9f42){_0x56b20f[_0x455d95(0x63f)]=_0x455d95(0x3b0);return;}_0x56b20f[_0x455d95(0x63f)]=_0x455d95(0x23a)+_0x4d9f42+_0x455d95(0x63b);}async function confirmAddImage(){const _0x384de0=_0x2a6210;if(!currentGalleryCategoryId)return;const _0x3f0f49=document[_0x384de0(0x550)]('newImageUrl'),_0x428af1=document[_0x384de0(0x550)](_0x384de0(0x524)),_0x1257c1=document[_0x384de0(0x550)]('newImageBatchInput'),_0x450baf=_0x1257c1?.[_0x384de0(0x4cf)]||'',_0x193e6a=typeof _0x450baf===_0x384de0(0x6b0)?_0x450baf[_0x384de0(0x14c)]():'';try{const _0x3734e5=await db[_0x384de0(0x7e9)][_0x384de0(0x60f)](currentGalleryCategoryId);if(!_0x3734e5)return;const _0x5e4e16=_0x3734e5['images']||[];let _0x258cae=0x0,_0x628ac0=0x0;if(_0x193e6a){const _0x140525=_0x193e6a[_0x384de0(0x581)](/\r?\n/);_0x140525[_0x384de0(0x84c)](_0x5b2d16=>{const _0x4b67fb=_0x384de0,_0xb20073=String(_0x5b2d16||'')['trim']();if(!_0xb20073)return;const _0x4eeef2=_0xb20073[_0x4b67fb(0x838)](/[:：]/);if(_0x4eeef2===-0x1){_0x628ac0+=0x1;return;}const _0xf4c2a=_0xb20073[_0x4b67fb(0x4c1)](0x0,_0x4eeef2)[_0x4b67fb(0x14c)](),_0x5d5692=_0xb20073[_0x4b67fb(0x4c1)](_0x4eeef2+0x1)[_0x4b67fb(0x14c)]();if(!_0x5d5692){_0x628ac0+=0x1;return;}_0x5e4e16[_0x4b67fb(0x2b9)]({'url':_0x5d5692,'description':_0xf4c2a,'createdAt':Date[_0x4b67fb(0x344)]()}),_0x258cae+=0x1;});if(_0x258cae===0x0){showIslandNotification('提示','未解析到可用的图片链接',_0x384de0(0x4fd));return;}}else{const _0x4ab021=_0x3f0f49?.['value']['trim']();if(!_0x4ab021){showIslandNotification('提示',_0x384de0(0x1a2),_0x384de0(0x4fd));return;}const _0x453f72=_0x428af1?.[_0x384de0(0x4cf)]['trim']()||'';_0x5e4e16[_0x384de0(0x2b9)]({'url':_0x4ab021,'description':_0x453f72,'createdAt':Date[_0x384de0(0x344)]()}),_0x258cae=0x1;}await db[_0x384de0(0x7e9)][_0x384de0(0x253)](currentGalleryCategoryId,{'images':_0x5e4e16}),closeImageGalleryAddModal(),await loadGalleryImages(currentGalleryCategoryId);if(_0x193e6a){const _0x5933c4=_0x628ac0>0x0?_0x384de0(0x301)+_0x628ac0+'\x20条':'';showIslandNotification('成功',_0x384de0(0x4be)+_0x258cae+'\x20条'+_0x5933c4,'info');}else showIslandNotification('成功',_0x384de0(0x274),'info');}catch(_0x557e43){console[_0x384de0(0x5d9)](_0x384de0(0x6a3),_0x557e43),showIslandNotification('错误',_0x384de0(0x771),_0x384de0(0x4fd));}}async function getAvailableGalleryImages(_0x46d627){const _0x816e27=_0x2a6210;try{const _0x412527=await db[_0x816e27(0x7e9)][_0x816e27(0x651)](),_0x2b6d28=_0x412527['filter'](_0x44faac=>_0x44faac['isEnabled']!==![]),_0x58edd8=_0x2b6d28['filter'](_0x5ba6ab=>!_0x5ba6ab[_0x816e27(0x848)]||_0x5ba6ab[_0x816e27(0x848)]===_0x46d627);let _0x4996fe=[];return _0x58edd8[_0x816e27(0x84c)](_0x23dc3a=>{const _0x414506=_0x816e27;_0x23dc3a[_0x414506(0xbf)]&&_0x23dc3a[_0x414506(0xbf)]['length']>0x0&&(_0x4996fe=_0x4996fe['concat'](_0x23dc3a['images'][_0x414506(0x444)](_0x55abb9=>({'url':_0x55abb9[_0x414506(0x852)],'description':_0x55abb9[_0x414506(0x16e)]||'','categoryName':_0x23dc3a[_0x414506(0x189)]}))));}),_0x4996fe;}catch(_0x1195eb){return console[_0x816e27(0x5d9)]('❌\x20获取图库图片失败:',_0x1195eb),[];}}window[_0x2a6210(0x31f)]=openImageGalleryDrawer,window[_0x2a6210(0x51b)]=closeImageGalleryDrawer,window['closeImageGalleryDrawerOnOverlay']=closeImageGalleryDrawerOnOverlay,window[_0x2a6210(0x2c3)]=addImageGalleryCategory,window[_0x2a6210(0x14a)]=deleteGalleryCategory,window[_0x2a6210(0x7c)]=openGalleryImages,window[_0x2a6210(0x3f3)]=backToGalleryCategories,window['toggleCurrentGalleryEnabled']=toggleCurrentGalleryEnabled,window[_0x2a6210(0x3a3)]=deleteGalleryImage,window[_0x2a6210(0x1b4)]=openImageGalleryAddModal,window[_0x2a6210(0x216)]=closeImageGalleryAddModal,window[_0x2a6210(0x76)]=previewNewImage,window[_0x2a6210(0x5c2)]=confirmAddImage,window[_0x2a6210(0x457)]=getAvailableGalleryImages,console[_0x2a6210(0x40b)](_0x2a6210(0x22b));let currentMmpagesCharacter=null;async function openMmpages(){const _0x1eadc8=_0x2a6210;console[_0x1eadc8(0x40b)](_0x1eadc8(0x58a));const _0x430789=document[_0x1eadc8(0x550)](_0x1eadc8(0x727));if(!_0x430789){console[_0x1eadc8(0x5d9)]('❌\x20找不到mmpagesScreen元素');return;}if(currentCharProfileData&&currentCharProfileData['id'])try{const _0x3c4441=await db['chats'][_0x1eadc8(0x60f)](currentCharProfileData['id']);_0x3c4441?loadMmpagesData(_0x3c4441):loadMmpagesData(currentCharProfileData);}catch(_0xb29f9a){console[_0x1eadc8(0x5d9)]('❌\x20加载角色数据失败:',_0xb29f9a),loadMmpagesData(currentCharProfileData);}else console['warn']('⚠️\x20当前没有角色数据');_0x430789[_0x1eadc8(0x2af)][_0x1eadc8(0x2a8)](_0x1eadc8(0x763)),closeCharProfile();}function closeMmpages(){const _0x4399f0=_0x2a6210;console[_0x4399f0(0x40b)](_0x4399f0(0x247));const _0xe4d82e=document['getElementById'](_0x4399f0(0x727));_0xe4d82e&&_0xe4d82e[_0x4399f0(0x2af)]['remove']('active');}function loadMmpagesData(_0x41848d){const _0x2683e0=_0x2a6210;console['log'](_0x2683e0(0x229),_0x41848d[_0x2683e0(0x189)]),currentMmpagesCharacter=_0x41848d;const _0x273c40=document[_0x2683e0(0x550)](_0x2683e0(0x636)),_0x52c748=document['getElementById'](_0x2683e0(0x5b2)),_0x395a3f=document[_0x2683e0(0x550)](_0x2683e0(0x441)),_0x3c1b1d=document['getElementById'](_0x2683e0(0xf2)),_0x3a7760=document[_0x2683e0(0x550)]('mmpagesFollowers'),_0x1bdc4d=document['getElementById'](_0x2683e0(0x31b));if(_0x273c40)_0x273c40['textContent']=_0x41848d[_0x2683e0(0x636)]||_0x41848d[_0x2683e0(0x189)]||'Character\x20Name';const _0x5a62bf=_0x41848d['mmpagesDisplayName']||_0x41848d[_0x2683e0(0x189)]||_0x2683e0(0x77d),_0x221062=_0x5a62bf['toLowerCase']()['replace'](/\s+/g,'_');if(_0x52c748)_0x52c748[_0x2683e0(0x2a1)]='@'+(_0x41848d['mmpagesUsername']||_0x221062);if(_0x395a3f){if(_0x41848d['mmpagesBio'])_0x395a3f[_0x2683e0(0x2a1)]=_0x41848d[_0x2683e0(0x441)];else{const _0x34aaf0=_0x41848d[_0x2683e0(0x555)]?.[_0x2683e0(0x7e8)]||'',_0x32836=_0x34aaf0[_0x2683e0(0x581)]('\x0a')[0x0]||_0x2683e0(0x632);_0x395a3f['textContent']=_0x32836[_0x2683e0(0x161)](0x0,0x64);}}if(_0x3c1b1d)_0x3c1b1d[_0x2683e0(0x2a1)]=_0x41848d[_0x2683e0(0xf2)]||_0x2683e0(0x6f4);if(_0x3a7760){const _0xc46c=_0x41848d[_0x2683e0(0x5dc)]||Math[_0x2683e0(0x5b7)](Math[_0x2683e0(0x658)]()*0x1f4)+0x64;_0x3a7760[_0x2683e0(0x2a1)]=_0xc46c+_0x2683e0(0x7a0);}if(_0x1bdc4d){const _0x5746c2=_0x41848d[_0x2683e0(0x534)]||_0x41848d['avatar']||_0x41848d['settings']?.['aiAvatar']||'';_0x1bdc4d['src']=_0x5746c2,_0x1bdc4d[_0x2683e0(0x1b8)]=function(){const _0x3a3b87=_0x2683e0;this[_0x3a3b87(0x37e)][_0x3a3b87(0x712)]='none',this[_0x3a3b87(0x52a)][_0x3a3b87(0x2a1)]='?';};}renderMmpagesPosts(_0x41848d),initMmpagesTabs();}async function renderMmpagesPosts(_0x100923){const _0x4d2504=_0x2a6210,_0x17b691=document[_0x4d2504(0x550)](_0x4d2504(0x75c)),_0x423a37=document[_0x4d2504(0x550)]('mmpagesEmptyState');if(!_0x17b691)return;const _0xe47c4e=_0x17b691['querySelectorAll']('.mmpages-post');_0xe47c4e[_0x4d2504(0x84c)](_0x346bec=>_0x346bec[_0x4d2504(0x5e8)]());try{const _0x1aa08a=_0x100923['id'],_0x2c316f=_0x100923[_0x4d2504(0x848)]||getCharacterIdFromChat(_0x100923)||_0x1aa08a,_0x319a17=await db[_0x4d2504(0x5d1)]['get'](_0x1aa08a),_0xc35ca=currentSessionId||_0x1aa08a||_0x4d2504(0x2a7);let _0x344a25=_0x4d2504(0x2a7);if(_0x319a17&&_0x319a17['userProfileId'])_0x344a25=_0x319a17['userProfileId'];else{const _0x55e922=await db[_0x4d2504(0xdc)][_0x4d2504(0x60f)](_0x4d2504(0x40f));_0x55e922&&(_0x344a25=_0x55e922[_0x4d2504(0x4cf)]);}console[_0x4d2504(0x40b)](_0x4d2504(0x93)+_0x2c316f+_0x4d2504(0x769)+_0xc35ca);const _0x303aaf=await db[_0x4d2504(0x26c)]['toArray'](),_0x6c264=_0x303aaf[_0x4d2504(0x34c)](_0x5b549f=>_0x5b549f['characterId']===_0x2c316f&&(_0x5b549f[_0x4d2504(0x64b)]||_0x4d2504(0x2a7))===_0xc35ca)[_0x4d2504(0x2f9)]((_0x36d16d,_0x3ead75)=>(_0x3ead75[_0x4d2504(0x5c9)]||0x0)-(_0x36d16d[_0x4d2504(0x5c9)]||0x0))[_0x4d2504(0x4c1)](0x0,0x32);console[_0x4d2504(0x40b)](_0x4d2504(0x588)+_0x6c264[_0x4d2504(0x73a)]+_0x4d2504(0x791));if(_0x6c264[_0x4d2504(0x73a)]===0x0){if(_0x423a37)_0x423a37[_0x4d2504(0x37e)][_0x4d2504(0x712)]=_0x4d2504(0x8b);return;}if(_0x423a37)_0x423a37[_0x4d2504(0x37e)][_0x4d2504(0x712)]=_0x4d2504(0x22e);let _0x5606e1='';_0x6c264[_0x4d2504(0x84c)](_0x1c68c6=>{_0x5606e1+=generateMmpagesPostHTML(_0x1c68c6,_0x100923);});const _0xec010f=document[_0x4d2504(0x550)](_0x4d2504(0x20f));_0xec010f&&_0xec010f[_0x4d2504(0x146)](_0x4d2504(0x33b),_0x5606e1),initMmpagesLikes();}catch(_0x5b66fe){console[_0x4d2504(0x5d9)](_0x4d2504(0x4d0),_0x5b66fe);if(_0x423a37)_0x423a37['style'][_0x4d2504(0x712)]=_0x4d2504(0x8b);}}function processMmpagesContent(_0x1c17f1){const _0x499a4d=_0x2a6210;if(!_0x1c17f1)return'';let _0x39f456=_0x1c17f1[_0x499a4d(0x7a9)](/&/g,_0x499a4d(0x4fe))[_0x499a4d(0x7a9)](/</g,'&lt;')['replace'](/>/g,'&gt;')[_0x499a4d(0x7a9)](/"/g,_0x499a4d(0x137))[_0x499a4d(0x7a9)](/'/g,_0x499a4d(0x66a));return _0x39f456=_0x39f456[_0x499a4d(0x7a9)](/#([\u4e00-\u9fa5a-zA-Z0-9_]+)/g,_0x499a4d(0x340)),_0x39f456=_0x39f456['replace'](/@([\u4e00-\u9fa5a-zA-Z0-9_]+)/g,'<span\x20class=\x22mmpages-mention\x22>@$1</span>'),_0x39f456;}function processThreadContent(_0x1284b6){const _0x34de3b=_0x2a6210;if(!_0x1284b6)return'';let _0x4f3e9b=_0x1284b6[_0x34de3b(0x7a9)](/&/g,_0x34de3b(0x4fe))[_0x34de3b(0x7a9)](/</g,'&lt;')[_0x34de3b(0x7a9)](/>/g,_0x34de3b(0x676))['replace'](/"/g,_0x34de3b(0x137))[_0x34de3b(0x7a9)](/'/g,_0x34de3b(0x66a));return _0x4f3e9b=_0x4f3e9b[_0x34de3b(0x7a9)](/#([\u4e00-\u9fa5a-zA-Z0-9_]+)/g,'<span\x20class=\x22thread-hashtag\x22>#$1</span>'),_0x4f3e9b=_0x4f3e9b[_0x34de3b(0x7a9)](/@([\u4e00-\u9fa5a-zA-Z0-9_]+)/g,_0x34de3b(0x4d4)),_0x4f3e9b;}function generateMmpagesPostHTML(_0x49fc94,_0x5a8652){const _0x3f574b=_0x2a6210,_0x4ef8bc=_0x5a8652[_0x3f574b(0x636)]||_0x5a8652[_0x3f574b(0x189)]||_0x3f574b(0x6b5),_0x4cdbca=_0x5a8652[_0x3f574b(0x5b2)]||_0x4ef8bc[_0x3f574b(0x7a9)](/\s+/g,'_')[_0x3f574b(0x5bd)](),_0x4374fd=_0x5a8652[_0x3f574b(0x534)]||_0x5a8652['avatar']||_0x5a8652[_0x3f574b(0x555)]?.[_0x3f574b(0x657)]||'',_0x47bc18=_0x49fc94[_0x3f574b(0x5c9)]?getTimeAgo(_0x49fc94[_0x3f574b(0x5c9)]):'1d',_0x2da1b1=_0x49fc94[_0x3f574b(0x387)]||{'likes':0x0,'comments':0x0,'reposts':0x0};let _0x2076d6='';if(_0x49fc94[_0x3f574b(0xbf)]&&_0x49fc94[_0x3f574b(0xbf)][_0x3f574b(0x73a)]>0x0){_0x2076d6='<div\x20class=\x22mmpages-post-images\x22>';const _0x2b0632=_0x49fc94['images'][_0x3f574b(0x4c1)](0x0,0x3);_0x2b0632['forEach'](_0x1899fa=>{const _0x373e92=_0x3f574b;if(_0x1899fa[_0x373e92(0x1e9)]===_0x373e92(0x16e))_0x2076d6+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-post-image\x20mmpages-image-desc\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-image-desc-content\x22>'+processMmpagesContent(_0x1899fa[_0x373e92(0x73c)]||'')+_0x373e92(0x492);else{if(_0x1899fa[_0x373e92(0x1e9)]===_0x373e92(0x5b5)&&_0x1899fa[_0x373e92(0x852)])_0x2076d6+=_0x373e92(0x1bb)+_0x1899fa[_0x373e92(0x852)]+_0x373e92(0x575);else{if(_0x1899fa[_0x373e92(0x1e9)]==='user-provided'&&_0x1899fa[_0x373e92(0x852)])_0x2076d6+=_0x373e92(0x1bb)+_0x1899fa[_0x373e92(0x852)]+_0x373e92(0x85b);else{if(typeof _0x1899fa===_0x373e92(0x6b0))_0x2076d6+=_0x373e92(0x1bb)+_0x1899fa+_0x373e92(0xe5);else _0x1899fa[_0x373e92(0x852)]&&(_0x2076d6+=_0x373e92(0x1bb)+_0x1899fa['url']+_0x373e92(0xe5));}}}}),_0x2076d6+=_0x3f574b(0x670);}return _0x3f574b(0x79a)+(_0x49fc94['id']||'')+_0x3f574b(0x7d3)+(_0x49fc94['id']||0x0)+_0x3f574b(0x282)+_0x4374fd+_0x3f574b(0x768)+_0x4ef8bc+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22mmpages-post-time\x22>'+_0x47bc18+_0x3f574b(0x673)+(_0x49fc94['id']||0x0)+');\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span></span><span></span><span></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-post-menu\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-post-menu-item\x20mmpages-post-menu-delete\x22\x20onclick=\x22event.stopPropagation();\x20deleteMmpagesPost('+(_0x49fc94['id']||0x0)+_0x3f574b(0x3a0)+processMmpagesContent(_0x49fc94[_0x3f574b(0x73c)]||'')+_0x3f574b(0x5c0)+_0x2076d6+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-post-actions\x22\x20onclick=\x22event.stopPropagation();\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-action-btn\x20mmpages-like-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M20.84\x204.61a5.5\x205.5\x200\x200\x200-7.78\x200L12\x205.67l-1.06-1.06a5.5\x205.5\x200\x200\x200-7.78\x207.78l1.06\x201.06L12\x2021.23l7.78-7.78\x201.06-1.06a5.5\x205.5\x200\x200\x200\x200-7.78z\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+(_0x2da1b1[_0x3f574b(0x446)]||0x0)+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-action-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M21\x2011.5a8.38\x208.38\x200\x200\x201-.9\x203.8\x208.5\x208.5\x200\x200\x201-7.6\x204.7\x208.38\x208.38\x200\x200\x201-3.8-.9L3\x2021l1.9-5.7a8.38\x208.38\x200\x200\x201-.9-3.8\x208.5\x208.5\x200\x200\x201\x204.7-7.6\x208.38\x208.38\x200\x200\x201\x203.8-.9h.5a8.48\x208.48\x200\x200\x201\x208\x208v.5z\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+(_0x2da1b1[_0x3f574b(0x38e)]||0x0)+_0x3f574b(0x570)+(_0x2da1b1[_0x3f574b(0x837)]||0x0)+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22mmpages-action-btn\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M4.698\x204.034l16.302\x207.966l-16.302\x207.966a.503\x20.503\x200\x200\x201\x20-.546\x20-.124a.555\x20.555\x200\x200\x201\x20-.12\x20-.568l2.468\x20-7.274l-2.468\x20-7.274a.555\x20.555\x200\x200\x201\x20.12\x20-.568a.503\x20.503\x200\x200\x201\x20.546\x20-.124z\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M6.5\x2012h14.5\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+(_0x2da1b1[_0x3f574b(0x3e2)]||0x0)+_0x3f574b(0x843);}function addMmpagesPost(_0x1042d4){const _0x16c01f=_0x2a6210;if(!currentMmpagesCharacter){console[_0x16c01f(0x3bc)](_0x16c01f(0x2ca));return;}!currentMmpagesCharacter[_0x16c01f(0x499)]&&(currentMmpagesCharacter[_0x16c01f(0x499)]=[]),currentMmpagesCharacter[_0x16c01f(0x499)][_0x16c01f(0x43e)](_0x1042d4),renderMmpagesPosts(currentMmpagesCharacter);}function toggleMmpagesPostMenu(_0x24e6ef,_0x23098d){const _0x31d686=_0x2a6210,_0x18bfb4=_0x24e6ef['querySelector']('.mmpages-post-menu');if(!_0x18bfb4)return;document[_0x31d686(0x854)](_0x31d686(0x61f))['forEach'](_0x408659=>{const _0xe4698e=_0x31d686;if(_0x408659!==_0x18bfb4)_0x408659['classList'][_0xe4698e(0x5e8)](_0xe4698e(0x763));}),_0x18bfb4[_0x31d686(0x2af)][_0x31d686(0x18f)]('active');if(_0x18bfb4[_0x31d686(0x2af)][_0x31d686(0x353)]('active')){const _0x414d2e=_0x1671e9=>{const _0x586f97=_0x31d686;!_0x24e6ef['contains'](_0x1671e9[_0x586f97(0x66d)])&&(_0x18bfb4[_0x586f97(0x2af)][_0x586f97(0x5e8)]('active'),document['removeEventListener'](_0x586f97(0x810),_0x414d2e));};setTimeout(()=>document['addEventListener'](_0x31d686(0x810),_0x414d2e),0xa);}}async function deleteMmpagesPost(_0x427e8c){const _0x54955a=_0x2a6210;if(!_0x427e8c){console['error'](_0x54955a(0x7d9));return;}const _0x58bd48=await db[_0x54955a(0x26c)][_0x54955a(0x60f)](_0x427e8c);if(!_0x58bd48){showIslandNotification('错误',_0x54955a(0x35a),_0x54955a(0x4fd));return;}const _0x3d8692=confirm(_0x54955a(0x81d));if(!_0x3d8692)return;try{const _0x2e798a=Math[_0x54955a(0x658)]()<0.5;_0x2e798a?(await saveDeletedPostEvent(_0x58bd48),console[_0x54955a(0x40b)]('🎲\x20[删除动态]\x20触发50%概率，已保存删除事件通知角色')):console['log']('🎲\x20[删除动态]\x20未触发50%概率，不通知角色');await db[_0x54955a(0x26c)][_0x54955a(0xfc)](_0x427e8c),document['querySelectorAll'](_0x54955a(0x61f))[_0x54955a(0x84c)](_0x38803f=>_0x38803f[_0x54955a(0x2af)][_0x54955a(0x5e8)](_0x54955a(0x763)));const _0x233fc0=document[_0x54955a(0x2ba)]('.mmpages-post[data-post-id=\x22'+_0x427e8c+'\x22]');_0x233fc0&&(_0x233fc0[_0x54955a(0x37e)][_0x54955a(0x157)]='opacity\x200.3s,\x20transform\x200.3s',_0x233fc0[_0x54955a(0x37e)][_0x54955a(0x48d)]='0',_0x233fc0[_0x54955a(0x37e)][_0x54955a(0x61d)]=_0x54955a(0x817),setTimeout(()=>_0x233fc0[_0x54955a(0x5e8)](),0x12c)),showIslandNotification('成功',_0x54955a(0x67f),_0x54955a(0x106)),vibrateDevice(),console[_0x54955a(0x40b)](_0x54955a(0x477),_0x427e8c);}catch(_0x1dff4a){console[_0x54955a(0x5d9)](_0x54955a(0x5dd),_0x1dff4a),showIslandNotification('错误',_0x54955a(0x453),_0x54955a(0x4fd));}}async function saveDeletedPostEvent(_0x59c651){const _0x52b6df=_0x2a6210;try{const _0x17d526=_0x52b6df(0x110)+Date[_0x52b6df(0x344)](),_0x433bfd=_0x59c651[_0x52b6df(0x848)],_0x17c8b9=_0x59c651['sessionId']||'default',_0x3b1681=await db[_0x52b6df(0xdc)][_0x52b6df(0x115)]('id')['startsWith']('deletedPost_')[_0x52b6df(0x651)](),_0x5660ec=_0x3b1681['find'](_0x2b87a2=>_0x2b87a2[_0x52b6df(0x4cf)]?.[_0x52b6df(0x848)]===_0x433bfd&&_0x2b87a2['value']?.['sessionId']===_0x17c8b9&&!_0x2b87a2['value']?.['consumed']);_0x5660ec&&(await db['globalSettings']['delete'](_0x5660ec['id']),console[_0x52b6df(0x40b)]('🗑️\x20[删除事件]\x20覆盖旧的未消耗事件')),await db[_0x52b6df(0xdc)][_0x52b6df(0x748)]({'id':_0x17d526,'value':{'type':'deletedPostEvent','characterId':_0x433bfd,'sessionId':_0x17c8b9,'postContent':_0x59c651['content']||'','postImages':_0x59c651['images']||[],'deletedAt':Date['now'](),'consumed':![],'expiresAt':Date['now']()+0x18*0x3c*0x3c*0x3e8}}),console[_0x52b6df(0x40b)]('📝\x20[删除事件]\x20已保存:',_0x17d526);}catch(_0x26cf0e){console['error'](_0x52b6df(0x7d1),_0x26cf0e);}}async function getUnconsumedDeletedPostEvent(_0x3d1f86,_0x4ad768){const _0x19dbc3=_0x2a6210;try{const _0x195b2e=await db[_0x19dbc3(0xdc)][_0x19dbc3(0x115)]('id')['startsWith'](_0x19dbc3(0x110))[_0x19dbc3(0x651)](),_0x18161d=Date[_0x19dbc3(0x344)](),_0x412f71=_0x195b2e[_0x19dbc3(0x6bf)](_0x1f09d9=>{const _0x505a52=_0x19dbc3,_0x28f7ce=_0x1f09d9['value'];return _0x28f7ce?.[_0x505a52(0x1e9)]===_0x505a52(0x170)&&_0x28f7ce?.[_0x505a52(0x848)]===_0x3d1f86&&_0x28f7ce?.[_0x505a52(0x64b)]===_0x4ad768&&!_0x28f7ce?.[_0x505a52(0x5eb)]&&_0x28f7ce?.[_0x505a52(0xec)]>_0x18161d;});return _0x412f71||null;}catch(_0x1f4cdb){return console[_0x19dbc3(0x5d9)](_0x19dbc3(0x610),_0x1f4cdb),null;}}async function markDeletedPostEventConsumed(_0x59f8fc){const _0x99f8a3=_0x2a6210;try{const _0x105cea=await db[_0x99f8a3(0xdc)][_0x99f8a3(0x60f)](_0x59f8fc);_0x105cea&&_0x105cea['value']&&(_0x105cea[_0x99f8a3(0x4cf)][_0x99f8a3(0x5eb)]=!![],await db[_0x99f8a3(0xdc)][_0x99f8a3(0x748)](_0x105cea),console[_0x99f8a3(0x40b)](_0x99f8a3(0x794),_0x59f8fc));}catch(_0x9292c1){console[_0x99f8a3(0x5d9)]('❌\x20标记删除事件失败:',_0x9292c1);}}(function injectMmpagesMenuStyles(){const _0x5101f8=_0x2a6210,_0x51ccdb=_0x5101f8(0x284);if(document[_0x5101f8(0x550)](_0x51ccdb))return;const _0x3081c9=document[_0x5101f8(0x24b)]('style');_0x3081c9['id']=_0x51ccdb,_0x3081c9[_0x5101f8(0x2a1)]=_0x5101f8(0x27d),document[_0x5101f8(0x68c)][_0x5101f8(0x744)](_0x3081c9);}());function toggleThreadCommentMenu(_0x37f857){const _0x71941d=_0x2a6210,_0x1b090d=_0x37f857[_0x71941d(0x2ba)](_0x71941d(0x86));if(!_0x1b090d)return;document[_0x71941d(0x854)]('.thread-comment-menu.active,\x20.mmpages-post-menu.active')[_0x71941d(0x84c)](_0x18af07=>{const _0x3c94f2=_0x71941d;if(_0x18af07!==_0x1b090d)_0x18af07[_0x3c94f2(0x2af)][_0x3c94f2(0x5e8)](_0x3c94f2(0x763));}),_0x1b090d[_0x71941d(0x2af)][_0x71941d(0x18f)](_0x71941d(0x763));if(_0x1b090d['classList'][_0x71941d(0x353)](_0x71941d(0x763))){const _0x472d67=_0x4533c2=>{const _0x1db3bb=_0x71941d;!_0x37f857[_0x1db3bb(0x353)](_0x4533c2['target'])&&(_0x1b090d['classList'][_0x1db3bb(0x5e8)](_0x1db3bb(0x763)),document[_0x1db3bb(0x2a2)]('click',_0x472d67));};setTimeout(()=>document[_0x71941d(0x2f7)](_0x71941d(0x810),_0x472d67),0xa);}}async function deleteThreadComment(_0x1c1637,_0x1c0f45,_0x7a9330){const _0x4e5257=_0x2a6210;if(!currentThreadPost||_0x1c1637<0x0){console[_0x4e5257(0x5d9)](_0x4e5257(0x4e4));return;}const _0x55e2b2=_0x1c0f45?_0x4e5257(0x4dd):_0x4e5257(0x105),_0x50b752=confirm(_0x55e2b2);if(!_0x50b752)return;try{document[_0x4e5257(0x854)](_0x4e5257(0xdb))[_0x4e5257(0x84c)](_0x583a23=>_0x583a23['classList'][_0x4e5257(0x5e8)](_0x4e5257(0x763)));if(_0x1c0f45){const _0x38fde5=currentThreadPost['commentList'][_0x1c1637];_0x38fde5&&_0x38fde5[_0x4e5257(0x7e1)]&&_0x7a9330>=0x0&&(_0x38fde5['replies']['splice'](_0x7a9330,0x1),console[_0x4e5257(0x40b)](_0x4e5257(0x287)+_0x1c1637+_0x4e5257(0x3ad)+_0x7a9330));}else currentThreadPost[_0x4e5257(0x358)][_0x4e5257(0x3b7)](_0x1c1637,0x1),console[_0x4e5257(0x40b)](_0x4e5257(0x288)+_0x1c1637);currentThreadPost['stats']&&(currentThreadPost['stats'][_0x4e5257(0x38e)]=Math[_0x4e5257(0x5b1)](0x0,(currentThreadPost[_0x4e5257(0x387)][_0x4e5257(0x38e)]||0x0)-0x1));await db[_0x4e5257(0x26c)][_0x4e5257(0x748)](currentThreadPost);const _0x2a1352=await db[_0x4e5257(0x37c)][_0x4e5257(0x60f)](currentThreadPost[_0x4e5257(0x848)]);_0x2a1352&&await renderThreadDetail(currentThreadPost,_0x2a1352),showIslandNotification('成功',_0x4e5257(0x51c),_0x4e5257(0x106)),vibrateDevice();}catch(_0x215ac6){console[_0x4e5257(0x5d9)](_0x4e5257(0x5c5),_0x215ac6),showIslandNotification('错误',_0x4e5257(0x453),_0x4e5257(0x4fd));}}(function injectThreadCommentMenuStyles(){const _0x3fdc1d=_0x2a6210,_0x7f10d4=_0x3fdc1d(0x74);if(document[_0x3fdc1d(0x550)](_0x7f10d4))return;const _0x2d773e=document[_0x3fdc1d(0x24b)](_0x3fdc1d(0x37e));_0x2d773e['id']=_0x7f10d4,_0x2d773e[_0x3fdc1d(0x2a1)]=_0x3fdc1d(0x389),document['head'][_0x3fdc1d(0x744)](_0x2d773e);}());let currentThreadPost=null,threadReplyTarget=null,threadCurrentProfileId=null;async function openThreadDetail(_0x5dbcb3){const _0xed2bab=_0x2a6210;try{const _0x588884=await db[_0xed2bab(0x26c)]['get'](_0x5dbcb3);if(!_0x588884){console[_0xed2bab(0x5d9)]('❌\x20帖子不存在:',_0x5dbcb3);return;}const _0x595687=await db[_0xed2bab(0x37c)][_0xed2bab(0x60f)](_0x588884[_0xed2bab(0x848)]);if(!_0x595687){console['error'](_0xed2bab(0x2a0),_0x588884[_0xed2bab(0x848)]);return;}currentThreadPost=_0x588884,await renderThreadDetail(_0x588884,_0x595687);const _0x183ccd=document[_0xed2bab(0x550)](_0xed2bab(0xb7));_0x183ccd&&_0x183ccd[_0xed2bab(0x2af)][_0xed2bab(0x2a8)]('active');}catch(_0x173978){console[_0xed2bab(0x5d9)]('❌\x20打开Thread\x20Detail失败:',_0x173978);}}function closeThreadDetail(){const _0x45abe9=_0x2a6210,_0x26c15a=document[_0x45abe9(0x550)]('threadDetailScreen');_0x26c15a&&(_0x26c15a['classList'][_0x45abe9(0x2a8)](_0x45abe9(0x28d)),setTimeout(()=>{const _0xacfab7=_0x45abe9;_0x26c15a['classList'][_0xacfab7(0x5e8)](_0xacfab7(0x763),_0xacfab7(0x28d));},0x15e)),currentThreadPost=null,threadReplyTarget=null;}function normalizeThreadNameValue(_0x572b0d){const _0x3764d5=_0x2a6210;return String(_0x572b0d||'')[_0x3764d5(0x14c)]()[_0x3764d5(0x5bd)]();}async function buildThreadCharacterIdentityMap(){const _0x272185=_0x2a6210,_0x172b40=new Map();try{const _0x5d2a54=await db[_0x272185(0x37c)][_0x272185(0x651)](),_0x1fa362=getUserCreatedCharactersFromChats(_0x5d2a54),_0x28a30a=new Map();await Promise['all'](_0x1fa362[_0x272185(0x444)](async _0x43be5d=>{const _0x75915b=_0x272185,_0x2a0411=normalizeId(_0x43be5d?.['id']);if(!isValidIdValue(_0x2a0411))return;const _0x1735af=await db['chatSettings'][_0x75915b(0x60f)](_0x2a0411);_0x28a30a['set'](_0x2a0411,_0x1735af||null);})),_0x1fa362[_0x272185(0x84c)](_0x10a9f6=>{const _0x2afc00=_0x272185,_0x1d7483=normalizeId(_0x10a9f6?.['id']);if(!isValidIdValue(_0x1d7483))return;const _0x524d71=_0x28a30a['get'](_0x1d7483),_0x38c51a=String(_0x524d71?.[_0x2afc00(0x561)]||'')['trim'](),_0x51d108=_0x10a9f6?.[_0x2afc00(0x636)]||_0x38c51a||_0x10a9f6?.[_0x2afc00(0x189)]||_0x10a9f6?.[_0x2afc00(0x486)]||'角色',_0x544f32=_0x10a9f6?.['mmpagesSocialAvatar']||_0x10a9f6?.[_0x2afc00(0x830)]||_0x10a9f6?.[_0x2afc00(0x555)]?.[_0x2afc00(0x657)]||'',_0x57343c=[_0x10a9f6?.[_0x2afc00(0x636)],_0x38c51a,_0x10a9f6?.[_0x2afc00(0x189)],_0x10a9f6?.[_0x2afc00(0x486)],_0x10a9f6?.[_0x2afc00(0x5b2)]][_0x2afc00(0x444)](_0x19b5ad=>String(_0x19b5ad||'')[_0x2afc00(0x14c)]())[_0x2afc00(0x34c)](Boolean);_0x57343c[_0x2afc00(0x84c)](_0x55f09f=>{const _0xfbdb57=_0x2afc00,_0x27e1da=normalizeThreadNameValue(_0x55f09f);if(!_0x27e1da)return;!_0x172b40[_0xfbdb57(0x17f)](_0x27e1da)&&_0x172b40[_0xfbdb57(0x806)](_0x27e1da,{'displayName':_0x51d108,'avatar':_0x544f32,'characterId':_0x1d7483});});});}catch(_0x3dcbeb){console[_0x272185(0x3bc)]('[Thread\x20Detail]\x20构建角色身份映射失败:',_0x3dcbeb);}return _0x172b40;}async function renderThreadDetail(_0x225fea,_0x433c77){const _0x57def5=_0x2a6210,_0x22f244=document['getElementById']('threadDetailScroll'),_0x579eef=document[_0x57def5(0x550)](_0x57def5(0x39d)),_0x540220=document[_0x57def5(0x550)](_0x57def5(0x23c));if(!_0x22f244||!_0x579eef){console['error'](_0x57def5(0x17c));return;}if(_0x540220){const _0xbe411a=_0x225fea['stats']?.[_0x57def5(0x25f)]||Math[_0x57def5(0x5b7)](Math[_0x57def5(0x658)]()*0x1388)+0x64;_0x540220[_0x57def5(0x2a1)]=_0xbe411a+_0x57def5(0x72);}let _0xfef4bb='';const _0x5d2e9d='https://i.postimg.cc/4xmx7V4R/mmexport1759081128356.jpg';let _0x264312=threadCurrentProfileId||null;if(!_0x264312){const _0x2d3eec=await db[_0x57def5(0xdc)]['get']('currentProfileId');_0x264312=_0x2d3eec?.[_0x57def5(0x4cf)]||_0x225fea[_0x57def5(0x624)]||null;}if(!_0x264312&&_0x433c77['id']){const _0x3545db=await db['chatSettings'][_0x57def5(0x60f)](_0x433c77['id']);_0x3545db&&_0x3545db['userProfileId']&&(_0x264312=_0x3545db[_0x57def5(0x5f2)]);}!threadCurrentProfileId&&_0x264312&&(threadCurrentProfileId=_0x264312);if(_0x264312&&_0x264312!==''&&_0x264312!==_0x57def5(0x653)&&_0x264312!==_0x57def5(0x283))try{const _0x473496=await db[_0x57def5(0x72b)][_0x57def5(0x60f)](_0x264312);_0x473496&&_0x473496[_0x57def5(0x830)]&&(_0xfef4bb=_0x473496[_0x57def5(0x830)]);}catch(_0x8dd7e2){console[_0x57def5(0x3bc)](_0x57def5(0x289),_0x8dd7e2[_0x57def5(0x42c)]);}!_0xfef4bb&&(_0xfef4bb=_0x5d2e9d);const _0x3dc1a3=generateThreadOriginalPost(_0x225fea,_0x433c77),_0x509e13=_0x57def5(0x43f),_0x4738e5=await buildThreadCharacterIdentityMap(),_0x231d8a=_0x36e1ce=>_0x4738e5[_0x57def5(0x60f)](normalizeThreadNameValue(_0x36e1ce));let _0x1130da='';if(_0x225fea['commentList']&&_0x225fea['commentList'][_0x57def5(0x73a)]>0x0){const _0x3c61f6=[];_0x225fea[_0x57def5(0x358)][_0x57def5(0x84c)]((_0x4d779f,_0x2704f)=>{const _0x47505a=_0x57def5;_0x4d779f[_0x47505a(0x5fc)]&&_0x4d779f[_0x47505a(0x5bf)]&&!_0x4d779f[_0x47505a(0x7e1)]&&(_0x4d779f['replies']=[{'username':_0x433c77[_0x47505a(0x636)]||_0x433c77['name']||'Author','content':_0x4d779f[_0x47505a(0x5bf)],'time':_0x4d779f['timestamp']?formatTimeAgo(_0x4d779f[_0x47505a(0x5c9)]):_0x4d779f['time']||'1h','isAuthor':!![]}]);const _0x45acad=_0x4d779f[_0x47505a(0x7e1)]||[],_0x3ffc34=_0x45acad[_0x47505a(0x73a)]>0x0,_0x34e535=_0x45acad['length']>0x3&&!_0x4d779f['_expanded'],_0x34957d=_0x4d779f[_0x47505a(0x6f8)]||![],_0x200cfd=_0x4d779f[_0x47505a(0x733)]===_0x47505a(0x2c6)?null:_0x231d8a(_0x4d779f['username']),_0x5b587b=_0x200cfd?.[_0x47505a(0x66c)]||_0x4d779f[_0x47505a(0x77d)],_0x2220da=_0x200cfd?.[_0x47505a(0x830)]||_0x4d779f['avatar']||'',_0x2f4d8a=_0x34e535?_0x45acad[_0x47505a(0x4c1)](0x1)[_0x47505a(0x444)](_0x15b710=>{const _0x468c35=_0x47505a;if(_0x15b710[_0x468c35(0x222)])return _0x433c77['mmpagesSocialAvatar']||_0x433c77['avatar']||'';const _0x1d75ca=_0x231d8a(_0x15b710[_0x468c35(0x77d)]);return _0x1d75ca?.[_0x468c35(0x830)]||_0x15b710[_0x468c35(0x830)]||'';})[_0x47505a(0x34c)](Boolean)['slice'](0x0,0x1):[];_0x3c61f6[_0x47505a(0x2b9)]({..._0x4d779f,'username':_0x5b587b,'avatar':_0x2220da,'hasReply':_0x3ffc34,'isReply':![],'showReplies':_0x34e535,'commentIndex':_0x2704f,'replyAvatars':_0x2f4d8a});if(_0x3ffc34){const _0x1408ea=_0x34957d||_0x45acad[_0x47505a(0x73a)]<=0x3?_0x45acad:_0x45acad[_0x47505a(0x4c1)](0x0,0x1);_0x1408ea[_0x47505a(0x84c)]((_0x4d8894,_0xdbfa40)=>{const _0x77a2cc=_0x47505a;let _0x574307=_0xdbfa40===0x0?_0x4d779f[_0x77a2cc(0x77d)]:_0x1408ea[_0xdbfa40-0x1]['username'],_0x547c23=null;_0x4d8894[_0x77a2cc(0x361)]&&_0x4d8894[_0x77a2cc(0x361)]!==_0x574307&&(_0x547c23=_0x4d8894[_0x77a2cc(0x361)]);const _0x4e6752=_0xdbfa40===_0x1408ea[_0x77a2cc(0x73a)]-0x1,_0x5e5ab9=_0x4d8894[_0x77a2cc(0x733)]===_0x77a2cc(0x2c6)?null:_0x231d8a(_0x4d8894[_0x77a2cc(0x77d)]),_0x2f47d1=_0x5e5ab9?.[_0x77a2cc(0x66c)]||_0x4d8894[_0x77a2cc(0x77d)],_0x4a6b9f=_0x4d8894[_0x77a2cc(0x222)]?_0x433c77['mmpagesSocialAvatar']||_0x433c77[_0x77a2cc(0x830)]||'':_0x5e5ab9?.['avatar']||_0x4d8894[_0x77a2cc(0x830)]||'',_0x1acf6a=_0x547c23?_0x231d8a(_0x547c23)?.[_0x77a2cc(0x66c)]||_0x547c23:null;_0x3c61f6['push']({'username':_0x2f47d1,'content':_0x4d8894[_0x77a2cc(0x73c)],'time':_0x4d8894[_0x77a2cc(0x5c9)]?formatTimeAgo(_0x4d8894[_0x77a2cc(0x5c9)]):_0x4d8894[_0x77a2cc(0x595)]||'1h','avatar':_0x4a6b9f,'hasReply':![],'isReply':!![],'isAuthor':_0x4d8894['isAuthor']||![],'showReplies':![],'commentIndex':_0x2704f,'replyIndex':_0xdbfa40,'role':_0x4d8894[_0x77a2cc(0x733)]||null,'toUsername':_0x1acf6a,'isLastReply':_0x4e6752});});}});const _0x494222=_0x3c61f6[_0x57def5(0x444)](_0x4a9789=>generateThreadCommentHTML(_0x4a9789,_0x433c77))[_0x57def5(0x469)]('');_0x1130da='<div\x20class=\x22thread-comments-list\x22>'+_0x494222+_0x57def5(0x670);}_0x22f244[_0x57def5(0x63f)]=_0x3dc1a3+_0x509e13+_0x1130da,_0x579eef[_0x57def5(0x63f)]=generateThreadReplyBar(_0x225fea,_0x433c77,_0xfef4bb),window[_0x57def5(0x737)]&&initThreadDetailInteractions();}function _0x18ea(_0x2e385c,_0x7fbfd3){const _0x446669=_0x4466();return _0x18ea=function(_0x18ea1b,_0x2a4de6){_0x18ea1b=_0x18ea1b-0x6d;let _0x196971=_0x446669[_0x18ea1b];return _0x196971;},_0x18ea(_0x2e385c,_0x7fbfd3);}function generateThreadOriginalPost(_0x149f5d,_0x8686d2){const _0x4a0329=_0x2a6210,_0x309122=_0x149f5d[_0x4a0329(0x387)]||{},_0x132c96=_0x8686d2[_0x4a0329(0x636)]||_0x8686d2[_0x4a0329(0x189)]||'User',_0x515e64=_0x8686d2['mmpagesUsername']||_0x132c96[_0x4a0329(0x7a9)](/\s+/g,'_')[_0x4a0329(0x5bd)](),_0x4975d4=_0x8686d2[_0x4a0329(0x534)]||_0x8686d2[_0x4a0329(0x830)]||_0x4a0329(0x190);let _0x4cd8fb='';if(_0x149f5d[_0x4a0329(0xbf)]&&_0x149f5d[_0x4a0329(0xbf)][_0x4a0329(0x73a)]>0x0){_0x4cd8fb=_0x4a0329(0x4ca);const _0x108821=_0x149f5d[_0x4a0329(0xbf)];_0x108821[_0x4a0329(0x84c)](_0x25b542=>{const _0x2bc94d=_0x4a0329;if(_0x25b542[_0x2bc94d(0x1e9)]===_0x2bc94d(0x16e))_0x4cd8fb+='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-post-image\x20thread-image-desc\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-image-desc-content\x22>'+processThreadContent(_0x25b542[_0x2bc94d(0x73c)]||'')+_0x2bc94d(0x492);else{if(_0x25b542[_0x2bc94d(0x1e9)]===_0x2bc94d(0x5b5)&&_0x25b542[_0x2bc94d(0x852)])_0x4cd8fb+=_0x2bc94d(0x172)+_0x25b542[_0x2bc94d(0x852)]+_0x2bc94d(0x575);else{if(_0x25b542[_0x2bc94d(0x1e9)]===_0x2bc94d(0x21a)&&_0x25b542[_0x2bc94d(0x852)])_0x4cd8fb+=_0x2bc94d(0x172)+_0x25b542[_0x2bc94d(0x852)]+_0x2bc94d(0x85b);else{if(typeof _0x25b542===_0x2bc94d(0x6b0))_0x4cd8fb+=_0x2bc94d(0x172)+_0x25b542+'\x22\x20alt=\x22动态图片\x22\x20loading=\x22lazy\x22\x20onerror=\x22this.style.display=\x27none\x27\x22>';else _0x25b542['url']&&(_0x4cd8fb+='<img\x20class=\x22thread-post-image\x22\x20src=\x22'+_0x25b542['url']+_0x2bc94d(0xe5));}}}}),_0x4cd8fb+='</div>';}return'\x0a\x20\x20\x20\x20\x20\x20\x20\x20<article\x20class=\x22thread-original-post\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-post-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-post-author\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-avatar-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20class=\x22thread-avatar\x22\x20src=\x22'+_0x4975d4+_0x4a0329(0x4ac)+_0x132c96+_0x4a0329(0x5a6)+_0x132c96+_0x4a0329(0x2ea)+formatTimeAgo(_0x149f5d[_0x4a0329(0x5c9)])+_0x4a0329(0x12b)+processThreadContent(_0x149f5d[_0x4a0329(0x73c)]||'')+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x4cd8fb+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-post-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-action-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20d=\x22M12\x2021.35l-1.45-1.32C5.4\x2015.36\x202\x2012.28\x202\x208.5\x202\x205.42\x204.42\x203\x207.5\x203c1.74\x200\x203.41.81\x204.5\x202.09C13.09\x203.81\x2014.76\x203\x2016.5\x203\x2019.58\x203\x2022\x205.42\x2022\x208.5c0\x203.78-3.4\x206.86-8.55\x2011.54L12\x2021.35z\x22/>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22thread-action-count\x22>'+(_0x309122[_0x4a0329(0x446)]||0x84)+_0x4a0329(0x5ac)+(_0x309122[_0x4a0329(0x38e)]||0xf)+_0x4a0329(0x64a)+(_0x309122[_0x4a0329(0x837)]||0xa)+_0x4a0329(0x721)+(_0x309122[_0x4a0329(0x3e2)]||0x7)+_0x4a0329(0x48a);}function generateThreadCommentHTML(_0x8ea21e,_0xd9894b){const _0x121c82=_0x2a6210,_0x44eb52=_0x8ea21e[_0x121c82(0x5fc)]||![],_0xaa9c55=_0x8ea21e[_0x121c82(0x107)]||![],_0xa809d9=_0x8ea21e[_0x121c82(0x222)]||![],_0x3bf2b8=_0x8ea21e[_0x121c82(0x1b6)]||![],_0x49be19=_0x8ea21e['commentIndex']!==undefined?_0x8ea21e['commentIndex']:-0x1,_0x5ea23d=_0x8ea21e[_0x121c82(0x62f)]||null,_0x20476f=_0x8ea21e[_0x121c82(0x46b)]||![],_0x1375c8=_0x8ea21e[_0x121c82(0x733)]===_0x121c82(0x2c6),_0x26ccba=_0x8ea21e[_0x121c82(0x5d7)]!==undefined?_0x8ea21e[_0x121c82(0x5d7)]:-0x1;let _0x3e671c='';(_0x44eb52&&!_0xaa9c55||_0xaa9c55&&!_0x20476f)&&(_0x3e671c=_0x121c82(0x35c));let _0x191577='';if(_0x3bf2b8){const _0x1bffa7=_0x8ea21e[_0x121c82(0x327)]||[],_0x449e10=_0x1bffa7[_0x121c82(0x444)](_0x15ff81=>_0x121c82(0x726)+_0x15ff81+_0x121c82(0x562))[_0x121c82(0x469)]('');_0x191577=_0x121c82(0x6bc)+_0x449e10+_0x121c82(0x8f);}let _0x127700='';if(_0x5ea23d)_0x127700=_0x121c82(0x38a)+_0x5ea23d+_0x121c82(0x162);else _0xa809d9&&(_0x127700=_0x121c82(0x25d));let _0x2b3eda='';_0x3bf2b8&&(_0x2b3eda=_0x121c82(0x3f5)+_0x49be19+_0x121c82(0x652));const _0x4adb02=_0x121c82(0x53a)+(_0x44eb52?_0x121c82(0x77f):'')+(_0xaa9c55?'\x20is-reply':'')+(_0x20476f?_0x121c82(0x30b):'');return _0x121c82(0x417)+_0x4adb02+_0x121c82(0x827)+_0x49be19+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-wrapper\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-avatar-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-comment-avatar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+(_0x8ea21e['avatar']||'data:image/svg+xml,%3Csvg\x20xmlns=\x27http://www.w3.org/2000/svg\x27\x20viewBox=\x270\x200\x20100\x20100\x27%3E%3Crect\x20fill=\x27%23999\x27\x20width=\x27100\x27\x20height=\x27100\x27/%3E%3C/svg%3E')+_0x121c82(0x30d)+_0x3e671c+_0x121c82(0x753)+_0x191577+_0x121c82(0x7b3)+(_0x8ea21e[_0x121c82(0x77d)]||_0x121c82(0x440))+_0x121c82(0x28f)+(_0x8ea21e[_0x121c82(0x5c9)]?formatTimeAgo(_0x8ea21e['timestamp']):_0x8ea21e[_0x121c82(0x595)]||'1h')+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x127700+_0x121c82(0x3e0)+(_0x1375c8?_0x121c82(0x443)+_0x49be19+',\x20'+_0xaa9c55+',\x20'+_0x26ccba+_0x121c82(0x4b7):'')+_0x121c82(0x3ca)+processThreadContent(_0x8ea21e[_0x121c82(0x73c)]||'')+_0x121c82(0x6db)+_0x49be19+_0x121c82(0x12e)+(_0x8ea21e[_0x121c82(0x77d)]||'')+_0x121c82(0x633)+_0xaa9c55+_0x121c82(0x3ba)+_0x2b3eda+_0x121c82(0xd3);}function generateThreadReplyBar(_0x1c90d7,_0x26204c,_0x325334){const _0xf41ec9=_0x2a6210,_0x2d5d7f=_0x26204c['mmpagesDisplayName']||_0x26204c[_0xf41ec9(0x189)]||'User',_0x275b58=_0x26204c[_0xf41ec9(0x5b2)]||_0x2d5d7f[_0xf41ec9(0x7a9)](/\s+/g,'_')[_0xf41ec9(0x5bd)](),_0x416ea5=_0x325334||_0xf41ec9(0x277);return'\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-reply-input-wrapper\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-profile-picker-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20class=\x22thread-reply-avatar\x22\x20src=\x22'+_0x416ea5+_0xf41ec9(0x5e3)+_0x2d5d7f+_0xf41ec9(0x460);}async function toggleThreadProfilePicker(_0x167085){const _0x25a40a=_0x2a6210;_0x167085['stopPropagation']();const _0xba511b=document[_0x25a40a(0x550)](_0x25a40a(0x500));if(!_0xba511b)return;if(_0xba511b[_0x25a40a(0x2af)][_0x25a40a(0x353)](_0x25a40a(0x763))){_0xba511b[_0x25a40a(0x2af)]['remove'](_0x25a40a(0x763));return;}try{const _0xc37c5b=await db[_0x25a40a(0x72b)][_0x25a40a(0x651)]();if(!_0xc37c5b||_0xc37c5b['length']===0x0){showIslandNotification('提示',_0x25a40a(0x83f),_0x25a40a(0x4fd));return;}let _0xa4bde=threadCurrentProfileId;if(!_0xa4bde){const _0x1a82ba=await db['globalSettings'][_0x25a40a(0x60f)]('currentProfileId');_0xa4bde=_0x1a82ba?.[_0x25a40a(0x4cf)]||null;}const _0x3f3f58=_0xc37c5b['map'](_0x479fe2=>{const _0x3cbd1f=_0x25a40a,_0x134b28=_0x479fe2['id']===_0xa4bde,_0x3a76ec=_0x479fe2[_0x3cbd1f(0x830)]||_0x3cbd1f(0x277);return'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22thread-profile-option\x20'+(_0x134b28?_0x3cbd1f(0xf3):'')+_0x3cbd1f(0xe0)+_0x479fe2['id']+_0x3cbd1f(0x251)+(_0x479fe2[_0x3cbd1f(0x189)]||_0x479fe2['username']||'用户')+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20src=\x22'+_0x3a76ec+_0x3cbd1f(0x4ac)+(_0x479fe2[_0x3cbd1f(0x189)]||'')+_0x3cbd1f(0x580)+(_0x134b28?_0x3cbd1f(0x2a3):'')+_0x3cbd1f(0x2e1);})[_0x25a40a(0x469)]('');_0xba511b['innerHTML']=_0x3f3f58,_0xba511b[_0x25a40a(0x2af)][_0x25a40a(0x2a8)]('active'),setTimeout(()=>{const _0x3a7362=_0x25a40a;document[_0x3a7362(0x2f7)](_0x3a7362(0x810),closeThreadProfilePicker,{'once':!![]});},0xa);}catch(_0x1b77c6){console['error']('❌\x20加载用户资料失败:',_0x1b77c6);}}function closeThreadProfilePicker(_0x4fa472){const _0x257ec0=_0x2a6210,_0x4ea788=document[_0x257ec0(0x550)]('threadProfilePicker');_0x4ea788&&!_0x4ea788['contains'](_0x4fa472?.[_0x257ec0(0x66d)])&&_0x4ea788['classList'][_0x257ec0(0x5e8)]('active');}async function switchThreadProfile(_0x2261f1,_0xfa91dd){const _0x1f905b=_0x2a6210;_0xfa91dd?.[_0x1f905b(0x69e)]();try{const _0x56d465=await db[_0x1f905b(0x72b)][_0x1f905b(0x60f)](_0x2261f1);if(!_0x56d465){showIslandNotification('错误',_0x1f905b(0x1f4),_0x1f905b(0x4fd));return;}threadCurrentProfileId=_0x2261f1;const _0xca8c32=document[_0x1f905b(0x2ba)](_0x1f905b(0x2e2));_0xca8c32&&_0x56d465[_0x1f905b(0x830)]&&(_0xca8c32[_0x1f905b(0x655)]=_0x56d465[_0x1f905b(0x830)]);const _0x38c247=document[_0x1f905b(0x550)](_0x1f905b(0x500));if(_0x38c247)_0x38c247[_0x1f905b(0x2af)][_0x1f905b(0x5e8)](_0x1f905b(0x763));showIslandNotification('已切换',_0x1f905b(0x226)+(_0x56d465[_0x1f905b(0x189)]||_0x56d465[_0x1f905b(0x77d)]||'用户'),_0x1f905b(0x4fd));}catch(_0x20ee2a){console[_0x1f905b(0x5d9)]('❌\x20切换用户资料失败:',_0x20ee2a);}}function formatTimeAgo(_0x4c3e97){const _0x2f573a=_0x2a6210;if(!_0x4c3e97)return'1h';const _0x532023=Date[_0x2f573a(0x344)](),_0x1313f4=_0x532023-_0x4c3e97,_0x222d44=Math['floor'](_0x1313f4/0x3e8),_0x5565ae=Math[_0x2f573a(0x5b7)](_0x222d44/0x3c),_0x117c85=Math['floor'](_0x5565ae/0x3c),_0x94c31f=Math['floor'](_0x117c85/0x18);if(_0x94c31f>0x0)return _0x94c31f+'d';if(_0x117c85>0x0)return _0x117c85+'h';if(_0x5565ae>0x0)return _0x5565ae+'m';return'now';}function initMmpagesTabs(){const _0x372e15=_0x2a6210,_0xce4854=document[_0x372e15(0x854)](_0x372e15(0x66f));_0xce4854[_0x372e15(0x84c)](_0xdd5ae6=>{const _0x2a7418=_0x372e15;_0xdd5ae6['addEventListener'](_0x2a7418(0x810),function(){const _0x309068=_0x2a7418;_0xce4854['forEach'](_0x34c9e2=>_0x34c9e2[_0x309068(0x2af)][_0x309068(0x5e8)](_0x309068(0x763))),this[_0x309068(0x2af)][_0x309068(0x2a8)](_0x309068(0x763));const _0xe2375d=this[_0x309068(0x455)](_0x309068(0x514));console['log'](_0x309068(0x445),_0xe2375d);});});}function initMmpagesLikes(){const _0x15b517=_0x2a6210,_0x1857e2=document[_0x15b517(0x854)](_0x15b517(0x56c));_0x1857e2[_0x15b517(0x84c)](_0x16bfce=>{const _0x3d1250=_0x15b517;_0x16bfce[_0x3d1250(0x2f7)](_0x3d1250(0x810),function(){const _0x21868e=_0x3d1250,_0x10667b=this['querySelector'](_0x21868e(0x235));this[_0x21868e(0x2af)][_0x21868e(0x18f)](_0x21868e(0x3d6))?(_0x10667b['style'][_0x21868e(0x195)]=_0x21868e(0x13b),_0x10667b[_0x21868e(0x37e)]['stroke']='#ff3b5c'):(_0x10667b[_0x21868e(0x37e)][_0x21868e(0x195)]=_0x21868e(0x22e),_0x10667b[_0x21868e(0x37e)][_0x21868e(0x8e)]=_0x21868e(0x5fa));});});}let mmpagesEditAvatar=null;async function openMmpagesEditModal(){const _0x58d030=_0x2a6210;console['log'](_0x58d030(0x2d5));const _0x139bd7=document[_0x58d030(0x550)]('mmpagesEditOverlay');if(!_0x139bd7)return;if(currentMmpagesCharacter&&currentMmpagesCharacter['id'])try{const _0x2082ac=await db[_0x58d030(0x37c)]['get'](currentMmpagesCharacter['id']);_0x2082ac&&(currentMmpagesCharacter=_0x2082ac);}catch(_0xd4a9fb){console[_0x58d030(0x5d9)]('❌\x20加载最新角色数据失败:',_0xd4a9fb);}if(currentMmpagesCharacter){const _0x1dcf01=document[_0x58d030(0x550)](_0x58d030(0x778)),_0x35549f=document[_0x58d030(0x550)](_0x58d030(0x330)),_0x484b48=document[_0x58d030(0x550)](_0x58d030(0x463)),_0x58806c=document[_0x58d030(0x550)]('mmpagesEditBioNote'),_0x20a000=document[_0x58d030(0x550)](_0x58d030(0x11c)),_0x4011c2=document[_0x58d030(0x550)](_0x58d030(0x27b));if(_0x1dcf01)_0x1dcf01['value']=currentMmpagesCharacter[_0x58d030(0x636)]||currentMmpagesCharacter[_0x58d030(0x189)]||'';const _0x2b496=currentMmpagesCharacter[_0x58d030(0x636)]||currentMmpagesCharacter[_0x58d030(0x189)]||_0x58d030(0x77d),_0x30e37f=_0x2b496['toLowerCase']()[_0x58d030(0x7a9)](/\s+/g,'_');if(_0x35549f)_0x35549f[_0x58d030(0x4cf)]=currentMmpagesCharacter[_0x58d030(0x5b2)]||_0x30e37f;if(_0x484b48){const _0x1fb453=currentMmpagesCharacter['settings']?.[_0x58d030(0x7e8)]||'',_0x3b8fe4=_0x1fb453[_0x58d030(0x581)]('\x0a')[0x0]||'';_0x484b48[_0x58d030(0x4cf)]=currentMmpagesCharacter[_0x58d030(0x441)]||_0x3b8fe4[_0x58d030(0x161)](0x0,0x64);}if(_0x58806c)_0x58806c[_0x58d030(0x4cf)]=currentMmpagesCharacter['mmpagesBioNote']||_0x58d030(0x6f4);if(_0x20a000){const _0x1605ff=currentMmpagesCharacter['mmpagesFollowers']||Math['floor'](Math[_0x58d030(0x658)]()*0x1f4)+0x64;_0x20a000['value']=_0x1605ff;}if(_0x4011c2){const _0xdc1c4=currentMmpagesCharacter[_0x58d030(0x534)]||currentMmpagesCharacter[_0x58d030(0x830)]||currentMmpagesCharacter[_0x58d030(0x555)]?.[_0x58d030(0x657)]||'';_0x4011c2['src']=_0xdc1c4,mmpagesEditAvatar=null;}}_0x139bd7[_0x58d030(0x2af)]['add'](_0x58d030(0x763));}function closeMmpagesEditModal(){const _0x4a0b44=_0x2a6210;console[_0x4a0b44(0x40b)](_0x4a0b44(0x6a7));const _0xf80f62=document[_0x4a0b44(0x550)](_0x4a0b44(0x7a6));_0xf80f62&&_0xf80f62[_0x4a0b44(0x2af)][_0x4a0b44(0x5e8)]('active'),mmpagesEditAvatar=null;}function handleMmpagesAvatarUpload(_0x4fe557){const _0x2bcf3c=_0x2a6210,_0x3b5503=_0x4fe557[_0x2bcf3c(0x66d)][_0x2bcf3c(0x31a)][0x0];if(!_0x3b5503)return;if(!_0x3b5503[_0x2bcf3c(0x1e9)][_0x2bcf3c(0x78a)](_0x2bcf3c(0x2d9))){alert(_0x2bcf3c(0x296));return;}const _0x4539cf=new FileReader();_0x4539cf[_0x2bcf3c(0x1b3)]=function(_0x47be68){const _0x51d8b2=_0x2bcf3c,_0x31a978=_0x47be68[_0x51d8b2(0x66d)][_0x51d8b2(0x4db)];mmpagesEditAvatar=_0x31a978;const _0x280c37=document[_0x51d8b2(0x550)](_0x51d8b2(0x27b));_0x280c37&&(_0x280c37[_0x51d8b2(0x655)]=_0x31a978),console[_0x51d8b2(0x40b)](_0x51d8b2(0x7f7));},_0x4539cf[_0x2bcf3c(0x77c)](_0x3b5503);}async function saveMmpagesEdit(){const _0x339162=_0x2a6210;console[_0x339162(0x40b)](_0x339162(0x6aa));if(!currentMmpagesCharacter){console['warn']('⚠️\x20没有当前角色');return;}const _0xd400f7=document[_0x339162(0x550)](_0x339162(0x778))?.['value']||'',_0xfa4790=document[_0x339162(0x550)](_0x339162(0x330))?.['value']||'',_0xdc2c49=document[_0x339162(0x550)]('mmpagesEditBio')?.[_0x339162(0x4cf)]||'',_0xc2a8bc=document['getElementById'](_0x339162(0x2eb))?.['value']||'',_0x419170=document[_0x339162(0x550)]('mmpagesEditFollowers')?.[_0x339162(0x4cf)]||'0';if(!_0xd400f7[_0x339162(0x14c)]()){alert('请输入名字');return;}currentMmpagesCharacter[_0x339162(0x636)]=_0xd400f7['trim'](),currentMmpagesCharacter[_0x339162(0x5b2)]=_0xfa4790[_0x339162(0x14c)]()||_0xd400f7['toLowerCase']()[_0x339162(0x7a9)](/\s+/g,'_'),currentMmpagesCharacter[_0x339162(0x441)]=_0xdc2c49[_0x339162(0x14c)](),currentMmpagesCharacter[_0x339162(0xf2)]=_0xc2a8bc[_0x339162(0x14c)](),currentMmpagesCharacter[_0x339162(0x5dc)]=parseInt(_0x419170)||0x0;mmpagesEditAvatar&&(currentMmpagesCharacter['mmpagesSocialAvatar']=mmpagesEditAvatar);try{const _0x5b3e6b=currentMmpagesCharacter['id'];if(!_0x5b3e6b){console['error'](_0x339162(0x7f6)),alert(_0x339162(0x4a6));return;}currentMmpagesCharacter['updatedAt']=Date[_0x339162(0x344)](),await db[_0x339162(0x37c)][_0x339162(0x748)](currentMmpagesCharacter),window['syncLinkedCharacterData']&&await syncLinkedCharacterData(_0x5b3e6b,{'settings':currentMmpagesCharacter[_0x339162(0x555)],'mmpagesDisplayName':currentMmpagesCharacter[_0x339162(0x636)],'mmpagesUsername':currentMmpagesCharacter['mmpagesUsername'],'mmpagesBio':currentMmpagesCharacter[_0x339162(0x441)],'mmpagesBioNote':currentMmpagesCharacter[_0x339162(0xf2)],'mmpagesFollowers':currentMmpagesCharacter['mmpagesFollowers'],'mmpagesSocialAvatar':currentMmpagesCharacter['mmpagesSocialAvatar']}),console[_0x339162(0x40b)](_0x339162(0x241)),window['currentCharProfileData']&&window[_0x339162(0x51a)]['id']===_0x5b3e6b&&(window[_0x339162(0x51a)]=currentMmpagesCharacter),window[_0x339162(0x5df)]&&showIslandNotification(_0x339162(0x76b),currentMmpagesCharacter[_0x339162(0x189)]+_0x339162(0x34a),_0x339162(0x106)),loadMmpagesData(currentMmpagesCharacter),closeMmpagesEditModal();}catch(_0x587f3b){console[_0x339162(0x5d9)]('❌\x20保存Mmpages数据失败:',_0x587f3b),alert(_0x339162(0x42d));}}console[_0x2a6210(0x40b)](_0x2a6210(0x6ef));function initThreadLikeInteractions(){const _0x1088d1=_0x2a6210;document[_0x1088d1(0x854)](_0x1088d1(0x52b))[_0x1088d1(0x84c)](_0x585c64=>{const _0x3a130d=_0x1088d1;_0x585c64[_0x3a130d(0x2f7)]('click',function(){const _0x1987de=_0x3a130d,_0x4b0181=this[_0x1987de(0x2ba)](_0x1987de(0x235)),_0x59623d=this[_0x1987de(0x2ba)](_0x1987de(0x739));this['classList'][_0x1987de(0x353)](_0x1987de(0x3c5))?(this['classList'][_0x1987de(0x5e8)](_0x1987de(0x3c5)),_0x59623d&&(_0x59623d['textContent']=parseInt(_0x59623d['textContent'])-0x1)):_0x4b0181&&_0x4b0181['querySelector'](_0x1987de(0x4bf))&&(this['classList']['add']('thread-liked'),_0x59623d&&(_0x59623d[_0x1987de(0x2a1)]=parseInt(_0x59623d['textContent']||0x0)+0x1));});});}function initThreadFollowButtons(){const _0x2c07f0=_0x2a6210;document[_0x2c07f0(0x854)](_0x2c07f0(0x394))[_0x2c07f0(0x84c)](_0x54d6ca=>{const _0x3057ce=_0x2c07f0;_0x54d6ca[_0x3057ce(0x2f7)](_0x3057ce(0x810),function(){const _0x319f38=_0x3057ce;this[_0x319f38(0x2a1)]==='Follow'?(this[_0x319f38(0x2a1)]=_0x319f38(0x3b2),this[_0x319f38(0x37e)]['backgroundColor']=_0x319f38(0x634),this[_0x319f38(0x37e)]['color']=_0x319f38(0x46c),this['style'][_0x319f38(0xd5)]=_0x319f38(0x6cd)):(this[_0x319f38(0x2a1)]=_0x319f38(0x1b9),this[_0x319f38(0x37e)][_0x319f38(0x393)]=_0x319f38(0x46c),this[_0x319f38(0x37e)][_0x319f38(0x279)]=_0x319f38(0x59c),this[_0x319f38(0x37e)][_0x319f38(0xd5)]='none');});});}window[_0x2a6210(0x2b8)]=async function(_0x1630ec){const _0x39b782=_0x2a6210;console[_0x39b782(0x40b)](_0x39b782(0x3e9),_0x1630ec);if(!currentThreadPost){console[_0x39b782(0x5d9)]('❌\x20当前没有打开的帖子');return;}const _0x3fd0dc=currentThreadPost[_0x39b782(0x358)][_0x1630ec];if(!_0x3fd0dc||!_0x3fd0dc[_0x39b782(0x7e1)]||_0x3fd0dc[_0x39b782(0x7e1)]['length']<=0x3)return;_0x3fd0dc['_expanded']=!_0x3fd0dc[_0x39b782(0x6f8)];const _0x1d6a2d=await db[_0x39b782(0x37c)][_0x39b782(0x60f)](currentThreadPost['characterId']);await renderThreadDetail(currentThreadPost,_0x1d6a2d),initThreadDetailInteractions();};function initThreadShowReplies(){}async function sendThreadComment(_0x10cf09=!![]){const _0x831d60=_0x2a6210;try{const _0x29e4df=document[_0x831d60(0x2ba)](_0x831d60(0x315));if(!_0x29e4df){console['error'](_0x831d60(0x3c9));return;}const _0xec2e37=_0x29e4df['value'][_0x831d60(0x14c)]();if(!_0xec2e37){showIslandNotification('提示',_0x831d60(0x767),_0x831d60(0x4fd));return;}if(!currentThreadPost){showIslandNotification('错误','未找到当前帖子',_0x831d60(0x4fd));return;}let _0x4be885=threadCurrentProfileId;if(!_0x4be885){const _0x51ee29=await db[_0x831d60(0xdc)]['get'](_0x831d60(0x40f));_0x4be885=_0x51ee29?.[_0x831d60(0x4cf)];}let _0x14980a=_0x4be885?await db['userProfiles'][_0x831d60(0x60f)](_0x4be885):null;console['log'](_0x831d60(0x2df),_0x4be885,_0x831d60(0x15f),_0x14980a);const _0x2fbd4d=_0x14980a?.['username']||'用户',_0xd8feef=_0x14980a?.[_0x831d60(0x830)]||_0x831d60(0x512),_0x35e273=Date[_0x831d60(0x344)]();!currentThreadPost[_0x831d60(0x358)]&&(currentThreadPost['commentList']=[]);if(threadReplyTarget&&threadReplyTarget[_0x831d60(0xd4)]>=0x0){const _0x53e5d6=currentThreadPost[_0x831d60(0x358)][threadReplyTarget['commentIndex']];if(_0x53e5d6){!_0x53e5d6[_0x831d60(0x7e1)]&&(_0x53e5d6[_0x831d60(0x7e1)]=[]);const _0x174d45={'username':_0x2fbd4d,'avatar':_0xd8feef,'content':_0xec2e37,'time':formatTimeAgo(_0x35e273),'timestamp':_0x35e273,'replyTo':threadReplyTarget[_0x831d60(0x7fa)]||null,'role':_0x831d60(0x2c6)};_0x53e5d6['replies']['push'](_0x174d45);}}else{const _0x399b26={'id':_0x35e273,'username':_0x2fbd4d,'avatar':_0xd8feef,'content':_0xec2e37,'time':formatTimeAgo(_0x35e273),'timestamp':_0x35e273,'replies':[],'role':_0x831d60(0x2c6)};currentThreadPost[_0x831d60(0x358)]['push'](_0x399b26);}currentThreadPost[_0x831d60(0x387)]&&(currentThreadPost[_0x831d60(0x387)][_0x831d60(0x38e)]=(currentThreadPost[_0x831d60(0x387)][_0x831d60(0x38e)]||0x0)+0x1);const _0x340501=threadReplyTarget?{...threadReplyTarget}:null;threadReplyTarget=null;_0x29e4df['dataset'][_0x831d60(0x223)]&&(_0x29e4df[_0x831d60(0x26f)]=_0x29e4df[_0x831d60(0x772)][_0x831d60(0x223)]);await db[_0x831d60(0x26c)][_0x831d60(0x748)](currentThreadPost),_0x29e4df[_0x831d60(0x4cf)]='';const _0x240a6e=await db[_0x831d60(0x37c)]['get'](currentThreadPost[_0x831d60(0x848)]);_0x240a6e&&(await renderThreadDetail(currentThreadPost,_0x240a6e),initThreadDetailInteractions()),showIslandNotification('成功','评论已发送','info'),_0x10cf09&&setTimeout(()=>{getThreadCommentAIResponse(_0x340501);},0x1f4);}catch(_0xdd59e6){console[_0x831d60(0x5d9)](_0x831d60(0x30f),_0xdd59e6),showIslandNotification('错误',_0x831d60(0x2c1)+_0xdd59e6['message'],_0x831d60(0x4fd));}}function formatTimeAgo(_0x5cd704){const _0x1e4acf=_0x2a6210,_0x54fe69=Date['now'](),_0x3b1e83=_0x54fe69-_0x5cd704,_0x5ddf0b=Math[_0x1e4acf(0x5b7)](_0x3b1e83/0xea60),_0x41b72e=Math['floor'](_0x3b1e83/0x36ee80),_0x1252a2=Math['floor'](_0x3b1e83/0x5265c00);if(_0x5ddf0b<0x1)return _0x1e4acf(0x344);if(_0x5ddf0b<0x3c)return _0x5ddf0b+'m';if(_0x41b72e<0x18)return _0x41b72e+'h';if(_0x1252a2<0x7)return _0x1252a2+'d';if(_0x1252a2<0x1e)return Math[_0x1e4acf(0x5b7)](_0x1252a2/0x7)+'w';return Math['floor'](_0x1252a2/0x1e)+'mo';}async function getThreadCommentAIResponse(_0x346c22=null,_0x1d1c45={}){const _0x50ff1a=_0x2a6210;try{if(!currentThreadPost){showIslandNotification('错误',_0x50ff1a(0x549),_0x50ff1a(0x4fd));return;}const _0x35bc23=_0x346c22&&_0x346c22[_0x50ff1a(0xd4)]>=0x0;showIslandNotification(_0x50ff1a(0x15e),_0x50ff1a(0x336),_0x50ff1a(0x4fd));const _0x51433c=await db[_0x50ff1a(0x1a6)][_0x50ff1a(0x60f)]('main');if(!_0x51433c||!_0x51433c[_0x50ff1a(0x6e1)]||!_0x51433c['apiKey']||!_0x51433c[_0x50ff1a(0x398)]){showIslandNotification('错误',_0x50ff1a(0x357),_0x50ff1a(0x4fd));return;}const _0x3fd362=await db[_0x50ff1a(0x37c)][_0x50ff1a(0x60f)](currentThreadPost['characterId']);if(!_0x3fd362){showIslandNotification('错误',_0x50ff1a(0x1e5),'info');return;}const _0x120e22=getCharacterIdFromChat(_0x3fd362),_0x237d00=await getCharacterById(_0x120e22)||{},_0x513133=_0x237d00[_0x50ff1a(0x189)]||'AI',_0x14e870=_0x237d00[_0x50ff1a(0x555)]?.[_0x50ff1a(0x5c3)]||'',_0x22c67b=_0x237d00[_0x50ff1a(0x239)]||'',_0xee4c0f=_0x237d00[_0x50ff1a(0x67e)]||'',_0x2b7784=_0x237d00[_0x50ff1a(0x124)]||'',_0x366399=_0x237d00[_0x50ff1a(0x4f2)]||'',_0x39cb0b='default';let _0x4d4a35=threadCurrentProfileId;if(!_0x4d4a35){const _0x4d3caa=await db[_0x50ff1a(0xdc)]['get'](_0x50ff1a(0x40f));_0x4d4a35=_0x4d3caa?.[_0x50ff1a(0x4cf)];}let _0xddad04=null,_0x2d5aca='';if(_0x4d4a35){_0xddad04=await db[_0x50ff1a(0x72b)]['get'](_0x4d4a35);if(_0xddad04){console[_0x50ff1a(0x40b)](_0x50ff1a(0x7ee)+(_0xddad04[_0x50ff1a(0x189)]||_0xddad04[_0x50ff1a(0x77d)])+'\x20('+_0x4d4a35+')'),_0x2d5aca=_0x50ff1a(0x221)+(_0xddad04[_0x50ff1a(0x189)]||_0x50ff1a(0x316))+_0x50ff1a(0x37a)+(_0xddad04[_0x50ff1a(0x77d)]||'未设置')+_0x50ff1a(0x2c4)+(_0xddad04[_0x50ff1a(0x1fe)]||_0x50ff1a(0x316))+_0x50ff1a(0x5ad)+(_0xddad04[_0x50ff1a(0x7b2)]||'未设置')+_0x50ff1a(0x1a3)+(_0xddad04[_0x50ff1a(0x2f3)]||_0x50ff1a(0x316));_0xddad04[_0x50ff1a(0x104)]&&(_0x2d5aca+=_0x50ff1a(0x5b9)+_0xddad04['phoneNumber']);_0xddad04['tagsYes']&&_0xddad04[_0x50ff1a(0x225)][_0x50ff1a(0x73a)]>0x0&&(_0x2d5aca+=_0x50ff1a(0x7e6)+_0xddad04[_0x50ff1a(0x225)][_0x50ff1a(0x469)]('、'));_0xddad04[_0x50ff1a(0x6c5)]&&_0xddad04[_0x50ff1a(0x6c5)][_0x50ff1a(0x73a)]>0x0&&(_0x2d5aca+='\x0a不喜欢：'+_0xddad04[_0x50ff1a(0x6c5)][_0x50ff1a(0x469)]('、'));const _0x2486cd=await getAllNoteTexts(_0x120e22,_0x39cb0b,_0x4d4a35);_0x2486cd&&(_0x2d5aca+=_0x50ff1a(0x140)+_0x2486cd+_0x50ff1a(0x487));}}const _0x52ba92=getBeijingTimeContext();let _0x59a1f=null,_0x24c60f=null;if(_0x366399){const _0x2b2c6e=await db[_0x50ff1a(0xdc)][_0x50ff1a(0x60f)](_0x366399);if(_0x2b2c6e&&_0x2b2c6e['worldview']){_0x59a1f=_0x2b2c6e[_0x50ff1a(0x4f2)];const _0x48eeac=_0x2b2c6e[_0x50ff1a(0x4ed)]||[];_0x24c60f=generateWorldviewPrompt(_0x59a1f,_0x48eeac);}}const _0x3ca9e4=getBaobaobookEntries(),_0x3b19f7=_0x237d00?.[_0x50ff1a(0x74b)]||[];let _0x31204a=[];_0x3b19f7['length']>0x0&&(_0x31204a=_0x3ca9e4[_0x50ff1a(0x34c)](_0x2d6af3=>_0x3b19f7[_0x50ff1a(0x3a6)](_0x2d6af3['id'])));const _0x533e3e=_0x3ca9e4[_0x50ff1a(0x34c)](_0x4aea7d=>{const _0x28c41f=_0x50ff1a,_0x51049d=_0x4aea7d[_0x28c41f(0x71d)]||[];return _0x51049d['includes'](_0x28c41f(0x3a4));}),_0x19f4c0=[..._0x31204a],_0x427f7d=new Set(_0x31204a[_0x50ff1a(0x444)](_0x3318f8=>_0x3318f8['id']));_0x533e3e[_0x50ff1a(0x84c)](_0x298467=>{const _0x4bac3a=_0x50ff1a;!_0x427f7d[_0x4bac3a(0x17f)](_0x298467['id'])&&(_0x19f4c0['push'](_0x298467),_0x427f7d[_0x4bac3a(0x2a8)](_0x298467['id']));}),console[_0x50ff1a(0x40b)](_0x50ff1a(0x683)+_0x31204a[_0x50ff1a(0x73a)]+_0x50ff1a(0x51e)+_0x533e3e[_0x50ff1a(0x73a)]+_0x50ff1a(0x3a1)+_0x19f4c0[_0x50ff1a(0x73a)]+'条');const _0x2e5ac5=_0x19f4c0['length']>0x0?generateBaobaobookPrompt(_0x19f4c0):null,_0x3ce5dd=await generatePlotPointsPrompt(_0x3fd362['id']||_0x120e22,_0x39cb0b),_0x2d115d=generateStickerListPrompt();let _0x32e369=_0x50ff1a(0x3b6);_0x2d5aca&&(_0x32e369+=_0x2d5aca+'\x0a\x0a');try{const _0x5586a1=await getUserPlaylistNamesForPrompt();if(_0x5586a1[_0x50ff1a(0x73a)]>0x0){const _0x347791=_0x5586a1[_0x50ff1a(0x444)]((_0xe3be55,_0x46d6b8)=>'-\x20'+(_0x46d6b8+0x1)+'.\x20'+_0xe3be55)['join']('\x0a');_0x32e369+=_0x50ff1a(0x2dc)+_0x347791+'\x0a\x0a';}}catch(_0x15d6d7){console[_0x50ff1a(0x3bc)](_0x50ff1a(0x71c),_0x15d6d7);}_0x32e369+=_0x50ff1a(0x64d)+_0x513133;if(_0xee4c0f)_0x32e369+=_0x50ff1a(0x262)+_0xee4c0f;if(_0x2b7784)_0x32e369+=_0x50ff1a(0x371)+_0x2b7784;if(_0x22c67b)_0x32e369+='\x0a-\x20职业：'+_0x22c67b;_0x32e369+=_0x50ff1a(0x26a);_0x14e870&&(_0x32e369+='\x0a'+_0x14e870);const _0x5b1bd2=await getPhoneNumber(_0x120e22,_0x39cb0b,_0x4d4a35);_0x5b1bd2&&_0x5b1bd2[_0x50ff1a(0x601)]&&(_0x32e369+=_0x50ff1a(0x19f)+_0x5b1bd2['number']);const _0x721866=await getDiaryPassword(_0x120e22,_0x39cb0b,_0x4d4a35);if(_0x721866&&_0x721866[_0x50ff1a(0x3c8)]){const _0xb21a24=await getDiaryUnlockState(_0x120e22,_0x39cb0b,_0x4d4a35);_0x32e369+=_0x50ff1a(0xe8)+_0x721866[_0x50ff1a(0x3c8)]+'\x0a提示：'+_0x721866[_0x50ff1a(0x297)]+_0x50ff1a(0x264)+(_0xb21a24?'已解锁':'已上锁')+_0x50ff1a(0x12f);}const _0x363ff7=await getDiaryViewStats(_0x120e22,_0x39cb0b,_0x4d4a35),_0x33f756=Number(_0x363ff7?.[_0x50ff1a(0x705)]||0x0),_0xb99002=_0x363ff7?.[_0x50ff1a(0x7af)]?formatDiaryViewAgo(_0x363ff7['lastViewedAt']):'从未';_0x32e369+='\x0a\x0a###\x20你知道用户看过你日记的记录\x0a偷看次数：'+_0x33f756+_0x50ff1a(0x738)+_0xb99002+_0x50ff1a(0x52e);const _0x2bc23d=normalizeId(_0x120e22),_0x1c8c55=normalizeId(_0x39cb0b)||'default',_0x33c6bc=_0x50ff1a(0x171)+_0x2bc23d+'_'+_0x1c8c55,_0x1e1da7=await db['globalSettings']['get'](_0x33c6bc),_0x32361d=_0x1e1da7?.['value']||null;_0x32361d?_0x32e369+=_0x50ff1a(0x2d8)+_0x32361d+_0x50ff1a(0x540):_0x32e369+=_0x50ff1a(0x4a5);const _0x2c75f6=(currentThreadPost[_0x50ff1a(0x358)]||[])['slice'](-0x14);let _0x2ca466='';const _0x13a3ab=_0xddad04?.[_0x50ff1a(0x77d)]||_0xddad04?.[_0x50ff1a(0x189)]||'用户';_0x2c75f6[_0x50ff1a(0x73a)]>0x0&&_0x2c75f6[_0x50ff1a(0x84c)]((_0x1a7356,_0x154570)=>{const _0x43633b=_0x50ff1a,_0x487cc3=new Date(_0x1a7356[_0x43633b(0x5c9)]||Date['now']())['toLocaleString'](_0x43633b(0xcd),{'month':_0x43633b(0x211),'day':_0x43633b(0x211),'hour':'2-digit','minute':_0x43633b(0x211)}),_0x3b689d=_0x1a7356[_0x43633b(0x733)]===_0x43633b(0x2c6)?_0x13a3ab:_0x1a7356['isAuthor']?_0x513133+'(作者)':_0x1a7356[_0x43633b(0x77d)]||'路人';_0x2ca466+=_0x43633b(0x639)+(_0x154570+0x1)+_0x43633b(0x2e9)+_0x3b689d+'\x20('+_0x487cc3+'):\x20'+_0x1a7356['content']+'\x0a',_0x1a7356[_0x43633b(0x7e1)]&&_0x1a7356[_0x43633b(0x7e1)][_0x43633b(0x73a)]>0x0&&_0x1a7356[_0x43633b(0x7e1)][_0x43633b(0x84c)](_0x19efa7=>{const _0x218f2f=_0x43633b,_0x17f481=new Date(_0x19efa7[_0x218f2f(0x5c9)]||Date['now']())[_0x218f2f(0x326)](_0x218f2f(0xcd),{'month':_0x218f2f(0x211),'day':'2-digit','hour':_0x218f2f(0x211),'minute':'2-digit'}),_0xccd9fe=_0x19efa7[_0x218f2f(0x733)]===_0x218f2f(0x2c6)?_0x13a3ab:_0x19efa7[_0x218f2f(0x222)]?_0x513133+'(作者)':_0x19efa7[_0x218f2f(0x77d)]||'路人',_0x8087ea=_0x19efa7[_0x218f2f(0x361)]?_0x218f2f(0xd1)+_0x19efa7['replyTo']:'';_0x2ca466+=_0x218f2f(0xb8)+_0xccd9fe+_0x8087ea+'\x20('+_0x17f481+_0x218f2f(0x73b)+_0x19efa7[_0x218f2f(0x73c)]+'\x0a';});});const _0x3475c4=[];_0x2c75f6[_0x50ff1a(0x73a)]>0x0&&_0x2c75f6['forEach'](_0x533ef2=>{const _0x3200f8=_0x50ff1a,_0x46fb09=new Date(_0x533ef2[_0x3200f8(0x5c9)]||Date[_0x3200f8(0x344)]())['toLocaleString'](_0x3200f8(0xcd),{'month':_0x3200f8(0x211),'day':'2-digit','hour':_0x3200f8(0x211),'minute':_0x3200f8(0x211)}),_0x563e1a=_0x533ef2[_0x3200f8(0x733)]===_0x3200f8(0x2c6)?_0x13a3ab:_0x513133,_0x13ad34='['+_0x46fb09+']\x20'+_0x563e1a+':\x20'+_0x533ef2[_0x3200f8(0x73c)];_0x3475c4['push']({'role':_0x533ef2[_0x3200f8(0x733)]===_0x3200f8(0x2c6)?_0x3200f8(0x2c6):_0x3200f8(0x1bd),'content':_0x13ad34});});let _0x43bbad=null,_0x5cef8d=null;if(_0x35bc23&&_0x346c22){const _0x376dfc=currentThreadPost[_0x50ff1a(0x358)][_0x346c22[_0x50ff1a(0xd4)]];if(_0x376dfc&&_0x376dfc[_0x50ff1a(0x7e1)]&&_0x376dfc['replies'][_0x50ff1a(0x73a)]>0x0){const _0x466b4b=_0x376dfc[_0x50ff1a(0x7e1)][_0x376dfc[_0x50ff1a(0x7e1)]['length']-0x1];_0x466b4b[_0x50ff1a(0x733)]===_0x50ff1a(0x2c6)&&(_0x43bbad=_0x466b4b,_0x5cef8d={'targetCommentIndex':_0x346c22[_0x50ff1a(0xd4)],'targetCommentUsername':_0x376dfc['username'],'targetCommentContent':_0x376dfc[_0x50ff1a(0x73c)],'replyToUsername':_0x346c22[_0x50ff1a(0x7fa)]});}}else _0x2c75f6[_0x50ff1a(0x73a)]>0x0&&_0x2c75f6[_0x2c75f6[_0x50ff1a(0x73a)]-0x1]['role']===_0x50ff1a(0x2c6)&&(_0x43bbad=_0x2c75f6[_0x2c75f6['length']-0x1]);const _0x525a49=!_0x35bc23&&_0x43bbad?_0x3475c4[_0x50ff1a(0x4c1)](0x0,-0x1):_0x3475c4;let _0xa56908=null;try{const _0x3433bc=await getTodaySchedule(_0x120e22,_0x4d4a35,_0x39cb0b);if(_0x3433bc&&_0x3433bc['length']>0x0){const _0x2c14d6=findCurrentActivity(_0x3433bc,_0x52ba92[_0x50ff1a(0x2bd)],_0x52ba92[_0x50ff1a(0x10f)]),_0x254b54=await getTodayBusyPeriods(_0x120e22,_0x4d4a35,_0x39cb0b);_0xa56908=generateScheduleUsagePrompt(_0x3433bc,_0x2c14d6,_0x52ba92,_0x254b54);}}catch(_0x8b935b){console[_0x50ff1a(0x5d9)](_0x50ff1a(0x752),_0x8b935b);}let _0x378334=null,_0x4262fc=null,_0x352b7b=!![],_0x482ecc=null;try{const _0x3a541b=await db[_0x50ff1a(0x37c)]['toArray']();_0x482ecc=_0x3a541b[_0x50ff1a(0x6bf)](_0x2958ae=>_0x2958ae[_0x50ff1a(0x647)]&&isSameId(getCharacterIdFromChat(_0x2958ae),_0x120e22)&&isSameId(_0x2958ae[_0x50ff1a(0x624)],_0x4d4a35));}catch(_0x577d1){console[_0x50ff1a(0x3bc)](_0x50ff1a(0x7b5),_0x577d1),_0x482ecc=null;}try{const _0x2867a8=normalizeId(_0x120e22),_0xe8019c=normalizeId(_0x4d4a35),_0x42ce76=normalizeId(_0x39cb0b)||_0x50ff1a(0x2a7),_0x2b414b=_0x2867a8+'_'+_0xe8019c+'_'+_0x42ce76,_0x2838ac=await db[_0x50ff1a(0x498)][_0x50ff1a(0x60f)](_0x2b414b);_0x2838ac&&_0x2838ac['affectionLevel']!==undefined&&(_0x4262fc=_0x2838ac['affectionLevel'],_0x352b7b=![]);const _0x1f42eb=_0x482ecc?await isAffectionModeEnabledForChat(normalizeId(_0x482ecc['id'])):![];_0x378334=generateAffectionPrompt(_0x4262fc,_0x513133,_0x352b7b,![],null,_0x1f42eb);}catch(_0x3c0e1e){console[_0x50ff1a(0x5d9)](_0x50ff1a(0x691),_0x3c0e1e);}let _0x1dba60=null;try{if(_0x482ecc){console[_0x50ff1a(0x40b)](_0x50ff1a(0x6cb)+_0x482ecc['id']);const _0x1bb7b4=await getActiveSessionIdForChat(_0x482ecc['id']);console['log']('📂\x20[Thread]\x20使用会话:\x20'+_0x1bb7b4);const _0x5bec31=await db['chatMessages']['toArray']();let _0xcca2cc=[];_0x1bb7b4===_0x50ff1a(0x2a7)?_0xcca2cc=_0x5bec31[_0x50ff1a(0x34c)](_0x577c1c=>{const _0xbdf8dc=_0x50ff1a,_0x3f8932=normalizeId(_0x577c1c['sessionId'])||_0xbdf8dc(0x2a7);return isSameId(_0x577c1c[_0xbdf8dc(0x848)],_0x120e22)&&(_0x3f8932==='default'||!_0x577c1c[_0xbdf8dc(0x64b)]);}):_0xcca2cc=_0x5bec31['filter'](_0x4d750c=>{const _0x4fb493=_0x50ff1a;return isSameId(_0x4d750c[_0x4fb493(0x848)],_0x120e22)&&normalizeId(_0x4d750c[_0x4fb493(0x64b)])===_0x1bb7b4;});_0xcca2cc['sort']((_0x5a747e,_0x232502)=>(_0x5a747e[_0x50ff1a(0x5c9)]||0x0)-(_0x232502[_0x50ff1a(0x5c9)]||0x0));const _0x44ddeb=_0xcca2cc[_0x50ff1a(0x4c1)](-0x14);if(_0x44ddeb[_0x50ff1a(0x73a)]>0x0){console[_0x50ff1a(0x40b)](_0x50ff1a(0x299)+_0x44ddeb[_0x50ff1a(0x73a)]+'\x20条聊天记录');let _0x3575e8=_0x44ddeb[_0x50ff1a(0x444)](_0x2f3ca=>{const _0x3866ab=_0x50ff1a,_0x3b0383=new Date(_0x2f3ca[_0x3866ab(0x5c9)]||Date['now']())['toLocaleString'](_0x3866ab(0xcd),{'month':_0x3866ab(0x211),'day':'2-digit','hour':_0x3866ab(0x211),'minute':_0x3866ab(0x211)}),_0x399c92=_0x2f3ca['role']==='user'?_0xddad04?.[_0x3866ab(0x189)]||'用户':_0x513133,_0x301d60=_0x2f3ca[_0x3866ab(0x1e9)]==='call'?_0x3866ab(0x480):_0x2f3ca[_0x3866ab(0x1e9)]===_0x3866ab(0x212)?_0x3866ab(0x578):'';return'['+_0x3b0383+']\x20'+_0x399c92+_0x301d60+':\x20'+(_0x2f3ca[_0x3866ab(0x73c)]||'');})[_0x50ff1a(0x469)]('\x0a');_0x1dba60=_0x50ff1a(0x77e)+_0x3575e8+_0x50ff1a(0x395);}}else console[_0x50ff1a(0x40b)](_0x50ff1a(0x717)+_0x120e22+',\x20profileId='+_0x4d4a35+')');}catch(_0x35a13b){console[_0x50ff1a(0x5d9)](_0x50ff1a(0x30c),_0x35a13b);}const _0x122216='##\x20OUTPUT\x20FORMAT\x20-\x20THREAD\x20COMMENT\x20(MANDATORY)\x0a\x0aSTEP\x201:\x20Complete\x20<thinking>\x20with\x20structured\x20analysis\x0aSTEP\x202:\x20Output\x20PIPE-LINE\x20v1\x20ONLY\x0a\x0a###\x20PIPE-LINE\x20v1\x20STRUCTURE\x20-\x20帖子评论回复\x0a\x0a每行一条指令（禁止JSON）。字段用\x20`|`\x20分隔，键值用\x20`=`。\x0a\x0a```\x0aaffection|value=数字(0-100)|reason=好感度变化原因\x0acomment|reply|username=回复者名字|content=回复内容|isAuthor=true|replyTo=被回复者用户名\x0acomment|main|username=评论者名字|content=新主评论内容\x0a```\x0a\x0a###\x20字段说明\x0a\x0a**affection（好感度）：**\x0a-\x20必填，0-100的整数\x0a-\x20'+(_0x352b7b?_0x50ff1a(0xba):'当前好感度：'+_0x4262fc+_0x50ff1a(0x82f))+'\x0a\x0a**reason（变化原因）：**\x0a-\x20必填，以'+_0x513133+'口吻说明好感度变化原因\x0a\x0a**comment|reply（对用户评论的回复/楼中楼）：**\x0a'+(_0x35bc23?_0x50ff1a(0x465):_0x50ff1a(0x4d9))+_0x50ff1a(0x759)+_0x513133+_0x50ff1a(0x405)+_0x13a3ab+_0x50ff1a(0x2ee),_0x5a4721=_0x50ff1a(0x237);let _0x344bb1='';if(currentThreadPost[_0x50ff1a(0xbf)]&&currentThreadPost[_0x50ff1a(0xbf)][_0x50ff1a(0x73a)]>0x0){const _0x2ba8b0=[];currentThreadPost['images'][_0x50ff1a(0x84c)]((_0x473aba,_0x1faf37)=>{const _0x392e15=_0x50ff1a;if(_0x473aba[_0x392e15(0x1e9)]===_0x392e15(0x16e)&&_0x473aba['content'])_0x2ba8b0['push'](_0x392e15(0x26d)+(_0x1faf37+0x1)+_0x392e15(0x16c)+_0x473aba[_0x392e15(0x73c)]);else{if(_0x473aba[_0x392e15(0x1e9)]===_0x392e15(0x21a))_0x2ba8b0[_0x392e15(0x2b9)](_0x392e15(0x26d)+(_0x1faf37+0x1)+_0x392e15(0x81f));else(_0x473aba[_0x392e15(0x1e9)]===_0x392e15(0x5b5)||typeof _0x473aba==='string'||_0x473aba['url'])&&_0x2ba8b0[_0x392e15(0x2b9)]('[配图'+(_0x1faf37+0x1)+_0x392e15(0x7c0));}}),_0x2ba8b0[_0x50ff1a(0x73a)]>0x0&&(_0x344bb1=_0x50ff1a(0x609)+_0x2ba8b0['join']('\x0a'));}const _0x4fc5a6=[{'role':_0x50ff1a(0x50d),'content':generateObfuscationLayer()},..._0x2e5ac5?.[_0x50ff1a(0x631)]?[{'role':'system','content':_0x2e5ac5['before']}]:[],{'role':_0x50ff1a(0x50d),'content':generatePreJailbreak(_0x513133,_0x52ba92)},{'role':_0x50ff1a(0x50d),'content':wrapSystemSection({'id':_0x50ff1a(0x71f),'title':_0x50ff1a(0x7df),'type':_0x50ff1a(0x10d),'source':_0x50ff1a(0x1d6),'instructions':[_0x50ff1a(0x59f),'-\x20接下来你会收到多段\x20SECTION（人设/世界观/知识/历史/功能/输出协议）。每段都有标题和\x20TYPE。','-\x20CONSTRAINT:\x20必须遵守。CONTEXT:\x20只读背景。EXECUTE:\x20本轮需要产出字段。PROTOCOL:\x20输出/流程协议。',_0x50ff1a(0x2c9),_0x50ff1a(0x3dd)][_0x50ff1a(0x469)]('\x0a'),'content':_0x50ff1a(0x80d)+_0x513133+'\x0aTIME:\x20'+_0x52ba92['detailString']+_0x50ff1a(0x116)+_0x513133+'\x0a正文：'+(currentThreadPost[_0x50ff1a(0x73c)]||'')+_0x344bb1+_0x50ff1a(0xe9)+(currentThreadPost[_0x50ff1a(0x387)]?.['likes']||0x0)+'\x20|\x20评论'+(currentThreadPost[_0x50ff1a(0x387)]?.[_0x50ff1a(0x38e)]||0x0)+'\x20|\x20转发'+(currentThreadPost[_0x50ff1a(0x387)]?.[_0x50ff1a(0x3e2)]||0x0)+(_0x2ca466?_0x50ff1a(0x58b)+_0x2ca466:_0x50ff1a(0x1cd))})},{'role':_0x50ff1a(0x50d),'content':wrapSystemSection({'id':'4.核心人设','title':'CORE\x20PERSONA\x20/\x20CHARACTER\x20CONSTRAINTS','type':_0x50ff1a(0x25e),'source':_0x50ff1a(0x2d2),'instructions':['-\x20这是你身份与口吻的最高约束（不可违背、不可改写）。','-\x20你必须以此为准理解\x22你是谁\x22、你与用户的关系、说话方式与边界。'][_0x50ff1a(0x469)]('\x0a'),'content':stripLeadingTokenMarker(_0x32e369)})},..._0x2e5ac5?.[_0x50ff1a(0x23e)]?[{'role':_0x50ff1a(0x50d),'content':wrapSystemSection({'id':_0x50ff1a(0x5b8),'title':_0x50ff1a(0x7f),'type':_0x50ff1a(0x7cd),'source':_0x50ff1a(0x777),'instructions':['-\x20角色补充资料：用于补全核心人设中未提及的细节。','-\x20严禁捏造不存在的条目；没有写到的就当不知道。'][_0x50ff1a(0x469)]('\x0a'),'content':stripLeadingTokenMarker(_0x2e5ac5[_0x50ff1a(0x23e)])})}]:[],..._0x24c60f?[{'role':_0x50ff1a(0x50d),'content':wrapSystemSection({'id':'6.世界观','title':_0x50ff1a(0x70f),'type':_0x50ff1a(0x7cd),'source':_0x50ff1a(0x270),'instructions':['-\x20只读背景：用于统一设定与常识框架。','-\x20不要复述整段；只在需要时引用关键设定。']['join']('\x0a'),'content':stripLeadingTokenMarker(_0x24c60f)})}]:[],..._0x3ce5dd?[{'role':_0x50ff1a(0x50d),'content':wrapSystemSection({'id':_0x50ff1a(0x5d6),'title':_0x50ff1a(0x4bb),'type':_0x50ff1a(0x7cd),'source':'剧情点系统','instructions':[_0x50ff1a(0x366),'-\x20不要与剧情点冲突；若历史与剧情点矛盾，以剧情点为准。'][_0x50ff1a(0x469)]('\x0a'),'content':stripLeadingTokenMarker(_0x3ce5dd)})}]:[],..._0x2d115d?[{'role':_0x50ff1a(0x50d),'content':wrapSystemSection({'id':'8.表情包库','title':_0x50ff1a(0xf7),'type':'TOOLS','source':_0x50ff1a(0x6ed),'instructions':['-\x20这是可用的表情包清单；只能使用列表中存在的表情包。',_0x50ff1a(0x27e)][_0x50ff1a(0x469)]('\x0a'),'content':stripLeadingTokenMarker(_0x2d115d)})}]:[],..._0x1dba60?[{'role':_0x50ff1a(0x50d),'content':wrapSystemSection({'id':'8.5.私聊记录','title':_0x50ff1a(0x254),'type':_0x50ff1a(0x7cd),'source':'私聊记录','instructions':['-\x20这是你与用户的私聊历史，仅供参考你们的关系和聊过的话题。','-\x20不要在评论区透露私聊内容，但可以体现你们的熟悉程度。'][_0x50ff1a(0x469)]('\x0a'),'content':stripLeadingTokenMarker(_0x1dba60)})}]:[],{'role':_0x50ff1a(0x50d),'content':wrapSystemSection({'id':'9.历史说明','title':_0x50ff1a(0x1d8),'type':_0x50ff1a(0x7cd),'source':_0x50ff1a(0x24f),'instructions':[_0x50ff1a(0x21b),_0x50ff1a(0xcc),_0x50ff1a(0x52d)][_0x50ff1a(0x469)]('\x0a'),'content':_0x525a49[_0x50ff1a(0x73a)]>0x0?_0x50ff1a(0x67c):_0x50ff1a(0x83a)})},..._0x525a49,..._0x2e5ac5?.['mid_after']?[{'role':_0x50ff1a(0x50d),'content':wrapSystemSection({'id':_0x50ff1a(0x36f),'title':_0x50ff1a(0x380),'type':_0x50ff1a(0x7cd),'source':_0x50ff1a(0x57a),'instructions':['-\x20临场强化提醒：关键信息再次确认。']['join']('\x0a'),'content':stripLeadingTokenMarker(_0x2e5ac5[_0x50ff1a(0x614)])})}]:[],..._0xa56908?[{'role':_0x50ff1a(0x50d),'content':wrapSystemSection({'id':_0x50ff1a(0x761),'title':_0x50ff1a(0x6ce),'type':'CONTEXT','source':_0x50ff1a(0x853),'instructions':['-\x20你的今日行程安排（只读，不产出新日程）。']['join']('\x0a'),'content':stripLeadingTokenMarker(_0xa56908)})}]:[],..._0x378334?[{'role':_0x50ff1a(0x50d),'content':wrapSystemSection({'id':'11.好感度','title':_0x50ff1a(0x65e),'type':_0x50ff1a(0x7cd),'source':'好感度系统','instructions':[_0x50ff1a(0xab)][_0x50ff1a(0x469)]('\x0a'),'content':stripLeadingTokenMarker(_0x378334)})}]:[],..._0x2e5ac5?.[_0x50ff1a(0x73)]?[{'role':_0x50ff1a(0x50d),'content':wrapSystemSection({'id':_0x50ff1a(0x696),'title':_0x50ff1a(0x21e),'type':'CONTEXT','source':_0x50ff1a(0x3e1),'instructions':['-\x20最后强化：确保关键信息不被遗忘。'][_0x50ff1a(0x469)]('\x0a'),'content':stripLeadingTokenMarker(_0x2e5ac5[_0x50ff1a(0x73)])})}]:[],..._0x43bbad?[{'role':_0x50ff1a(0x50d),'content':wrapSystemSection({'id':_0x50ff1a(0xb3),'title':_0x35bc23?_0x50ff1a(0x53c):_0x50ff1a(0x95),'type':_0x50ff1a(0x10d),'source':'本轮用户评论','instructions':_0x35bc23?['-\x20用户在「'+_0x5cef8d?.[_0x50ff1a(0x637)]+_0x50ff1a(0x579),_0x5cef8d?.[_0x50ff1a(0x7fa)]?'-\x20用户回复的是楼中楼中的「'+_0x5cef8d[_0x50ff1a(0x7fa)]+'」。':_0x50ff1a(0xca),'-\x20AI的回复应放到同一个主评论的楼中楼中。'][_0x50ff1a(0x469)]('\x0a'):[_0x50ff1a(0x516),_0x50ff1a(0x6a9)][_0x50ff1a(0x469)]('\x0a'),'content':_0x35bc23?_0x50ff1a(0x4cb)+_0x5cef8d?.['targetCommentContent']+_0x50ff1a(0x736)+_0x43bbad[_0x50ff1a(0x73c)]+(_0x5cef8d?.['replyToUsername']?'\x0a（回复对象：@'+_0x5cef8d['replyToUsername']+'）':''):_0x50ff1a(0x796)+_0x43bbad[_0x50ff1a(0x73c)]})},{'role':'user','content':'['+new Date(_0x43bbad['timestamp'])[_0x50ff1a(0x326)](_0x50ff1a(0xcd),{'month':'2-digit','day':'2-digit','hour':_0x50ff1a(0x211),'minute':_0x50ff1a(0x211)})+']\x20'+(_0xddad04?.[_0x50ff1a(0x189)]||'用户')+':\x20'+_0x43bbad[_0x50ff1a(0x73c)]}]:[],{'role':_0x50ff1a(0x50d),'content':wrapSystemSection({'id':_0x50ff1a(0x509),'title':'THINKING\x20QUALITY\x20CONTROL','type':'PROTOCOL','source':'质控协议','instructions':_0x50ff1a(0x76f),'content':stripLeadingTokenMarker(generateThinkingQualityControl({'shouldWriteDiary':![],'shouldWriteMmpages':![]}))})},{'role':'system','content':wrapSystemSection({'id':_0x50ff1a(0x119),'title':_0x50ff1a(0x692),'type':_0x50ff1a(0x10d),'source':'输出协议（评论：格式+检查）','instructions':['-\x20先完整完成\x20<thinking>（含质控要求），再关闭\x20</thinking>。',_0x50ff1a(0x4d1),_0x50ff1a(0x1be),_0x50ff1a(0x678)]['join']('\x0a'),'content':_0x122216+_0x50ff1a(0x6f6)+_0x5a4721})},{'role':_0x50ff1a(0x1bd),'content':generateAIPrefill(_0x513133,_0x52ba92,_0x43bbad||(_0x2c75f6['length']>0x0?_0x2c75f6[_0x2c75f6[_0x50ff1a(0x73a)]-0x1]:null))}];let _0x1d3cc0=0x0;const _0x546c26=[];let _0x534615=0x0;_0x4fc5a6[_0x50ff1a(0x84c)]((_0x415ec7,_0x2a0040)=>{const _0x4b84fa=_0x50ff1a,_0xea530d=_0x415ec7[_0x4b84fa(0x73c)];let _0x2ee676;if(Array[_0x4b84fa(0x14f)](_0xea530d))_0x2ee676=0x64;else typeof _0xea530d!=='string'?_0x2ee676=0x0:_0x2ee676=estimateTokens(_0xea530d);_0x1d3cc0+=_0x2ee676;let _0x3a592a;if(Array[_0x4b84fa(0x14f)](_0xea530d))_0x415ec7[_0x4b84fa(0x733)]===_0x4b84fa(0x2c6)?(_0x534615++,_0x3a592a=_0x4b84fa(0x431)+_0x534615+_0x4b84fa(0x478)):_0x3a592a=_0x4b84fa(0x484);else{if(typeof _0xea530d!==_0x4b84fa(0x6b0))_0x3a592a='❌异常消息类型\x20#'+_0x2a0040;else{const _0x77842d=_0xea530d[_0x4b84fa(0x6b2)](/\[TOKEN_MARKER:\s*([^\]]+)\]/);if(_0x77842d)_0x3a592a=_0x77842d[0x1][_0x4b84fa(0x14c)]();else{if(_0xea530d[_0x4b84fa(0x3a6)](_0x4b84fa(0x1f5))||_0xea530d[_0x4b84fa(0x3a6)](_0x4b84fa(0x3ef))||_0xea530d['includes']('Ψ(x)'))_0x3a592a=_0x4b84fa(0x89);else{if(_0xea530d[_0x4b84fa(0x3a6)](_0x4b84fa(0xaa)))_0x3a592a=_0x4b84fa(0x3b9);else{if(_0xea530d['includes']('WORLDVIEW\x20(READ-ONLY)'))_0x3a592a='6.世界观';else{if(_0xea530d[_0x4b84fa(0x3a6)]('STICKER\x20LIBRARY'))_0x3a592a='8.表情包库';else{if(_0xea530d[_0x4b84fa(0x3a6)]('角色核心设定')||_0xea530d[_0x4b84fa(0x3a6)](_0x4b84fa(0x22d)))_0x3a592a=_0x4b84fa(0x4c2);else{if(_0xea530d[_0x4b84fa(0x3a6)]('FINAL\x20OUTPUT\x20PROTOCOL'))_0x3a592a=_0x4b84fa(0x119);else{if(_0xea530d['includes'](_0x4b84fa(0x626))||_0xea530d[_0x4b84fa(0x3a6)]('THINKING\x20QUALITY'))_0x3a592a=_0x4b84fa(0x509);else{if(_0xea530d[_0x4b84fa(0x3a6)](_0x4b84fa(0xe3)))_0x3a592a='7.剧情点';else{if(_0xea530d[_0x4b84fa(0x3a6)](_0x4b84fa(0x32e)))_0x3a592a=_0x4b84fa(0x761);else{if(_0xea530d[_0x4b84fa(0x3a6)]('好感度')||_0xea530d['includes'](_0x4b84fa(0x6d3)))_0x3a592a=_0x4b84fa(0x574);else{if(_0xea530d['includes'](_0x4b84fa(0x447)))_0x3a592a=_0x4b84fa(0x496);else{if(_0xea530d[_0x4b84fa(0x3a6)](_0x4b84fa(0x95)))_0x3a592a='13.本轮用户输入';else{if(_0xea530d[_0x4b84fa(0x3a6)](_0x4b84fa(0xd8)))_0x3a592a=_0x4b84fa(0x697);else{if(_0xea530d[_0x4b84fa(0x3a6)]('BAOBAOBOOK')){if(_0xea530d[_0x4b84fa(0x3a6)](_0x4b84fa(0x7ef)))_0x3a592a=_0x4b84fa(0x751);else{if(_0xea530d['includes'](_0x4b84fa(0x621)))_0x3a592a=_0x4b84fa(0x36f);else _0xea530d[_0x4b84fa(0x3a6)]('MIDDLE')?_0x3a592a=_0x4b84fa(0x5b8):_0x3a592a=_0x4b84fa(0x96);}}else{if(_0x415ec7['role']==='user')_0x534615++,_0x3a592a=_0x4b84fa(0x431)+_0x534615;else{if(_0x415ec7[_0x4b84fa(0x733)]===_0x4b84fa(0x1bd)&&_0x2a0040===_0x4fc5a6[_0x4b84fa(0x73a)]-0x1&&_0xea530d[_0x4b84fa(0x3a6)](_0x4b84fa(0x50b)))_0x3a592a=_0x4b84fa(0x539);else _0x415ec7['role']===_0x4b84fa(0x1bd)&&_0x2a0040<_0x4fc5a6['length']-0x1?_0x3a592a=_0x4b84fa(0x3e7):_0x3a592a=_0x4b84fa(0x4d6)+_0x2a0040;}}}}}}}}}}}}}}}}}}_0x546c26[_0x4b84fa(0x2b9)]({'name':_0x3a592a,'tokens':_0x2ee676,'percentage':0x0}),console['log'](_0x3a592a[_0x4b84fa(0x4f6)](0x19)+_0x4b84fa(0x491)+_0x2ee676[_0x4b84fa(0x1ac)]()[_0x4b84fa(0x6a6)](0x5)+_0x4b84fa(0x271));}),_0x546c26[_0x50ff1a(0x84c)](_0x455169=>{const _0x3396fc=_0x50ff1a;_0x455169[_0x3396fc(0x2e8)]=(_0x455169['tokens']/_0x1d3cc0*0x64)['toFixed'](0x1);}),console[_0x50ff1a(0x40b)](_0x50ff1a(0x3de)),console[_0x50ff1a(0x40b)](_0x50ff1a(0x2cc)+_0x1d3cc0+'\x20tokens\x20(100%)'),console[_0x50ff1a(0x40b)](_0x50ff1a(0x3de));if(_0x1d3cc0>0x1f40)console[_0x50ff1a(0x40b)](_0x50ff1a(0x7d4));else _0x1d3cc0>0xfa0?console[_0x50ff1a(0x40b)](_0x50ff1a(0x63c)):console['log'](_0x50ff1a(0x661));const _0x3bc689=[..._0x546c26][_0x50ff1a(0x2f9)]((_0x57e765,_0x56baa8)=>_0x56baa8['tokens']-_0x57e765[_0x50ff1a(0x63a)])[_0x50ff1a(0x4c1)](0x0,0x5);console[_0x50ff1a(0x40b)](''),console['log'](_0x50ff1a(0x82c)),_0x3bc689[_0x50ff1a(0x84c)]((_0xc36716,_0x5a6f0e)=>{const _0x5df7e8=_0x50ff1a;console[_0x5df7e8(0x40b)]('\x20\x20\x20'+(_0x5a6f0e+0x1)+'.\x20'+_0xc36716[_0x5df7e8(0x189)]+':\x20'+_0xc36716[_0x5df7e8(0x63a)]+'\x20tokens\x20('+_0xc36716['percentage']+'%)');}),console['log'](_0x50ff1a(0x3de)),console[_0x50ff1a(0x40b)]('');const _0x4ba60a=await fetch(_0x51433c[_0x50ff1a(0x6e1)]+'/v1/chat/completions',{'method':'POST','headers':{'Content-Type':_0x50ff1a(0x3fa),'Authorization':_0x50ff1a(0x427)+_0x51433c['apiKey']},'body':JSON['stringify']({'model':_0x51433c[_0x50ff1a(0x398)],'messages':_0x4fc5a6,'temperature':0.9,'max_tokens':0xfa0})});if(!_0x4ba60a['ok'])throw new Error('API错误\x20'+_0x4ba60a[_0x50ff1a(0x464)]);const _0x2e9a28=await _0x4ba60a[_0x50ff1a(0x470)]();let _0x1752e2=_0x2e9a28[_0x50ff1a(0x35b)]?.[0x0]?.['message']?.[_0x50ff1a(0x73c)]||'';console[_0x50ff1a(0x40b)](_0x50ff1a(0x786),_0x1752e2);let _0x5862da={'affection':null,'reason':null,'comments':{'userCommentReplies':[],'newMainComments':[]}};try{let _0x57f7a2=_0x1752e2;const _0x2a84=_0x1752e2[_0x50ff1a(0x6b2)](/<thinking>[\s\S]*?<\/thinking>/i);_0x2a84&&(_0x57f7a2=_0x1752e2[_0x50ff1a(0x7a9)](_0x2a84[0x0],'')[_0x50ff1a(0x14c)](),console[_0x50ff1a(0x40b)]('✂️\x20[Thread]\x20移除thinking标签，剩余长度:',_0x57f7a2['length']));const _0x20cd1e=parseThreadCommentsPipeLine(_0x57f7a2);if(_0x20cd1e)_0x5862da=_0x20cd1e,console[_0x50ff1a(0x40b)](_0x50ff1a(0x41b),{'affection':_0x5862da[_0x50ff1a(0x5d4)],'replies':_0x5862da[_0x50ff1a(0x38e)][_0x50ff1a(0x644)][_0x50ff1a(0x73a)],'newMain':_0x5862da[_0x50ff1a(0x38e)][_0x50ff1a(0x331)][_0x50ff1a(0x73a)]});else throw new Error(_0x50ff1a(0x4e2));}catch(_0x4c8846){console[_0x50ff1a(0x5d9)](_0x50ff1a(0x12d),_0x4c8846[_0x50ff1a(0x42c)]),showIslandNotification('解析失败','无法解析AI回复','error');return;}const _0x5d28dc=_0x5862da['comments']||{},_0x4113c4=_0x5d28dc[_0x50ff1a(0x644)]||[],_0x3a3367=_0x5d28dc[_0x50ff1a(0x331)]||[],_0x455228=_0x5862da[_0x50ff1a(0x5d4)],_0x5dfda3=_0x5862da['reason'];if(_0x455228!==undefined&&_0x455228!==null)try{const _0x2bc840=_0x4262fc!==null?_0x4262fc:_0x50ff1a(0x6f1),_0x178b20=_0x4262fc!==null?_0x455228-_0x4262fc:_0x455228,_0x174917=_0x178b20>0x0?'+'+_0x178b20:_0x178b20;console['log'](_0x50ff1a(0x458)+_0x2bc840+'\x20→\x20'+_0x455228+'\x20('+_0x174917+')');if(_0x5dfda3)console[_0x50ff1a(0x40b)](_0x50ff1a(0x183)+_0x5dfda3);await saveAffectionLevel(_0x120e22,_0x4d4a35,_0x455228,_0x39cb0b||'default',_0x5dfda3,null,null),typeof renderChatAffectionIndicator==='function'&&renderChatAffectionIndicator();}catch(_0xe76df1){console[_0x50ff1a(0x5d9)](_0x50ff1a(0x122),_0xe76df1);}if(_0x4113c4['length']===0x0&&_0x3a3367['length']===0x0){showIslandNotification('提示','AI未生成评论',_0x50ff1a(0x4fd));return;}const _0x10c1cf=_0x3fd362['mmpagesDisplayName']||_0x513133,_0x369013=_0x3fd362[_0x50ff1a(0x534)]||_0x3fd362[_0x50ff1a(0x830)]||_0x50ff1a(0x190);let _0x498c5f;_0x35bc23&&_0x346c22?(_0x498c5f=_0x346c22[_0x50ff1a(0xd4)],console[_0x50ff1a(0x40b)](_0x50ff1a(0x7db),_0x498c5f)):(_0x498c5f=currentThreadPost[_0x50ff1a(0x358)][_0x50ff1a(0x5e0)](_0x4cc5a8=>_0x4cc5a8[_0x50ff1a(0x733)]===_0x50ff1a(0x2c6)),console[_0x50ff1a(0x40b)]('🎯\x20[Thread]\x20主评论模式，用户评论索引:',_0x498c5f));_0x498c5f!==-0x1&&_0x4113c4[_0x50ff1a(0x73a)]>0x0&&(!currentThreadPost[_0x50ff1a(0x358)][_0x498c5f]['replies']&&(currentThreadPost[_0x50ff1a(0x358)][_0x498c5f]['replies']=[]),_0x4113c4[_0x50ff1a(0x84c)](_0x550537=>{const _0x1cd89b=_0x50ff1a,_0x2c8020=Date[_0x1cd89b(0x344)](),_0x77403a={'username':_0x550537['username']||_0x10c1cf,'content':_0x550537[_0x1cd89b(0x73c)],'time':formatTimeAgo(_0x2c8020),'timestamp':_0x2c8020,'isAuthor':_0x550537[_0x1cd89b(0x222)]!==undefined?_0x550537[_0x1cd89b(0x222)]:_0x550537[_0x1cd89b(0x77d)]===_0x10c1cf,'replyTo':_0x550537[_0x1cd89b(0x361)]||_0x13a3ab,'role':_0x1cd89b(0x1bd)};currentThreadPost[_0x1cd89b(0x358)][_0x498c5f][_0x1cd89b(0x7e1)][_0x1cd89b(0x2b9)](_0x77403a);}),console[_0x50ff1a(0x40b)](_0x50ff1a(0x85a)+_0x4113c4['length']+_0x50ff1a(0x374)+_0x498c5f));_0x3a3367[_0x50ff1a(0x73a)]>0x0&&(_0x3a3367[_0x50ff1a(0x84c)](_0x325410=>{const _0xa2e56b=_0x50ff1a,_0x1e8f6e=Date['now']()+Math[_0xa2e56b(0x658)](),_0x4cede8={'id':_0x1e8f6e,'username':_0x325410['username'],'content':_0x325410[_0xa2e56b(0x73c)],'time':formatTimeAgo(_0x1e8f6e),'timestamp':_0x1e8f6e,'replies':[],'role':_0xa2e56b(0x1bd)};currentThreadPost['commentList'][_0xa2e56b(0x2b9)](_0x4cede8);}),console[_0x50ff1a(0x40b)](_0x50ff1a(0x85a)+_0x3a3367[_0x50ff1a(0x73a)]+'\x20条新主评论'));const _0x39d1e6=_0x4113c4[_0x50ff1a(0x73a)]+_0x3a3367['length'];await db['mmpages'][_0x50ff1a(0x748)](currentThreadPost);const _0x525939=_0x1d1c45&&_0x1d1c45[_0x50ff1a(0xaf)]!==![];_0x525939&&(await renderThreadDetail(currentThreadPost,_0x3fd362),initThreadDetailInteractions());const _0x1af9c4=_0x4113c4[_0x50ff1a(0x73a)]>0x0?_0x4113c4[_0x50ff1a(0x73a)]+'条回复':'',_0x308f33=_0x3a3367[_0x50ff1a(0x73a)]>0x0?_0x3a3367['length']+_0x50ff1a(0x245):'',_0x4f28fb=[_0x1af9c4,_0x308f33][_0x50ff1a(0x34c)](Boolean)[_0x50ff1a(0x469)]('，');showIslandNotification('成功',_0x50ff1a(0x6da)+_0x4f28fb,_0x50ff1a(0x4fd)),console[_0x50ff1a(0x40b)]('✅\x20[Thread]\x20AI评论已添加:',{'userCommentReplies':_0x4113c4,'newMainComments':_0x3a3367});}catch(_0x48fc39){console[_0x50ff1a(0x5d9)](_0x50ff1a(0x35f),_0x48fc39),showIslandNotification('错误','AI回复失败:\x20'+_0x48fc39['message'],_0x50ff1a(0x4fd));}}function initThreadCommentInput(){const _0x49ef53=_0x2a6210,_0x3e860e=document[_0x49ef53(0x2ba)](_0x49ef53(0x315));if(!_0x3e860e){console[_0x49ef53(0x40b)](_0x49ef53(0x513));return;}_0x3e860e[_0x49ef53(0x2f7)](_0x49ef53(0x1bc),_0x38b871=>{const _0x163303=_0x49ef53;_0x38b871[_0x163303(0x571)]==='Enter'&&!_0x38b871[_0x163303(0x78f)]&&(_0x38b871[_0x163303(0xf0)](),sendThreadComment(!![]));}),document[_0x49ef53(0x854)](_0x49ef53(0x792))[_0x49ef53(0x84c)](_0x1586dd=>{const _0x1129d9=_0x49ef53;_0x1586dd[_0x1129d9(0x2f7)](_0x1129d9(0x810),_0x93f60f=>{const _0x42ab7f=_0x1129d9;_0x93f60f[_0x42ab7f(0x69e)]();const _0x4e9c6f=parseInt(_0x1586dd['dataset'][_0x42ab7f(0xd4)]),_0x26de00=_0x1586dd[_0x42ab7f(0x772)][_0x42ab7f(0x77d)],_0x26458e=_0x1586dd[_0x42ab7f(0x772)]['isReply']===_0x42ab7f(0x4a7);threadReplyTarget={'commentIndex':_0x4e9c6f,'replyToUsername':_0x26458e?_0x26de00:null,'isReplyToReply':_0x26458e},!_0x3e860e[_0x42ab7f(0x772)]['originalPlaceholder']&&(_0x3e860e[_0x42ab7f(0x772)][_0x42ab7f(0x223)]=_0x3e860e['placeholder']),_0x3e860e[_0x42ab7f(0x26f)]=_0x26458e?'Reply\x20to\x20@'+_0x26de00+_0x42ab7f(0x38c):_0x42ab7f(0x21f),_0x3e860e[_0x42ab7f(0x2f4)](),console['log'](_0x42ab7f(0x44b),threadReplyTarget);});}),console['log'](_0x49ef53(0x2e0));}window[_0x2a6210(0x709)]=sendThreadComment,window[_0x2a6210(0x3e8)]=getThreadCommentAIResponse;function initThreadDetailInteractions(){initThreadLikeInteractions(),initThreadFollowButtons(),initThreadShowReplies(),initThreadCommentInput();}window[_0x2a6210(0x737)]=initThreadDetailInteractions,console['log'](_0x2a6210(0x6d));try{window[_0x2a6210(0xf5)]=!![];}catch(_0x230d64){}